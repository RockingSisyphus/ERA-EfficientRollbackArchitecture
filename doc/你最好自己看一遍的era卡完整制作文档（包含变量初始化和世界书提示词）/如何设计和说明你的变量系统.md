# 如何设计和说明你的 ERA 变量系统（快速入门）

本文档旨在帮助你——角色卡作者——用最简单的方式，为你的角色卡设计一套清晰、可维护的变量系统，并指导你如何向 AI 说明这套系统，以便 AI 能够正确地理解和操作它们。

---

## 第一步：在开场白中初始化你的变量

变量系统的第一步是在角色卡的**开场白**（First Message）中使用 `<VariableInsert>` 标签定义所有变量的初始状态。这是 AI 理解你的数据结构的起点。

**核心建议**：使用**对象**来管理物品集合（如背包），而不是数组。对象同样支持增删改，且更容易与 ERA 的模板功能（进阶）结合。

这是一个典型的角色扮演游戏（RPG）变量结构，你可以直接复制并根据你的需求修改。

```json
<VariableInsert>
{
  "player": {
    "name": "勇者",
    "level": 1,
    "hp": 100,
    "max_hp": 100,
    "mp": 50,
    "max_mp": 50,
    "stats": {
      "strength": 10,
      "agility": 8,
      "intelligence": 5
    }
  },
  "inventory": {
    "item_001": {
      "name": "初级治疗药水",
      "quantity": 3
    }
  },
  "game_time": {
    "day": 1,
    "hour": 8
  },
  "world_state": {
    "location": "起始的村庄",
    "npcs": {
      "npc_001": { "name": "村民A", "mood": "平常" },
      "npc_002": { "name": "卫兵B", "mood": "警惕" }
    }
  }
}
</VariableInsert>
```

在将以上示例变量初始化复制入开场白后，请开启一个新聊天以使其生效

---

## 第二步：在世界书中向 AI 说明你的设计

这是至关重要的一步。你需要在一个专门的世界书条目中，用自然语言向 AI 解释你的变量系统。这将极大地影响 AI 生成变量操作指令的准确性。

**目标条目**：`ERA变量意图说明`

**核心技巧**：在条目开头使用 `{{ERA:$ALLDATA}}` 宏。这会自动将当前所有变量的最新状态（JSON格式）展示给 AI，让它在做决策时总能看到最新数据。

以下是一个根据上述变量结构编写的“ERA变量意图说明”示例。

# ERA 变量意图说明

这是当前所有变量的状态：
{{ERA:$ALLDATA}}

## 变量意图解释

### 玩家 (`player`)

- `player.hp`: 玩家当前生命值。受伤时减少，使用药水或休息时恢复。不能超过 `player.max_hp`。
- `player.level`: 玩家等级。通常在获得足够经验值后提升。
- `player.stats`: 玩家的核心属性，影响战斗和检定。

### 背包 (`inventory`)

- 这是一个**对象**，存放玩家拥有的物品。每个物品都是一个键值对，键是物品的唯一ID（如 `item_001`），值是物品信息。
- **特殊规则**: 当向背包中添加物品时，如果是同名物品，应优先增加已有物品的 `quantity`（数量），而不是添加一个新物品。

### 游戏时间 (`game_time`)

- `day`, `hour`: 分别代表天和小时。
- **特殊规则**: 时间会随着剧情自然流逝。`hour` 达到 24 时归零并使 `day` 加 1。

### 世界状态 (`world_state`)

- `location`: 玩家当前所在的地点。
- `npcs`: 一个对象，包含当前场景中所有重要的 NPC。键是 NPC 的唯一 ID，值是他们的状态信息。
  - **更新NPC状态**: 当与NPC互动后，应更新其内部状态，如`mood`（心情）。例如，如果玩家帮助了村民A，他的心情可能会变为“感激”。
  - **新增NPC**: 当新的NPC进入场景时，应在`npcs`对象中为他们添加一个新的条目，并分配一个唯一的ID（如`npc_003`）。
  - **移除NPC**: 当NPC离开场景时，应从`npcs`对象中删除对应的条目。

---

## 需要更强大的功能？

本文档只涵盖了最基础的变量设置。如果你需要实现更进阶的功能，例如：

- 使用模板来创建标准化的物品
- 为变量增加保护限制以防止ai的更新错误破坏结构。
- 使用宏和ejs脚本优化提示词、降低token、实现更复杂的状态栏功能

请阅读以下文档：

- `构建era角色卡需要阅读和使用的文件/ERA_document.md`
- `进阶角色卡构建需要阅读和使用的文件/EJS与动态数据示例.txt`
