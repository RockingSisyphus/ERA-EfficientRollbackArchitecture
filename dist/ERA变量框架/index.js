import{ERA_EVENT_EMITTER as e}from'https://testingcf.jsdelivr.net/npm/ERAå˜é‡æ¡†æ¶/utils/constants/+esm';import{Converter as n}from'https://testingcf.jsdelivr.net/npm/opencc-js/+esm';import{createPinia as t,defineStore as a,storeToRefs as r}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var s={54:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,r,s){'string'==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&o[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=s),t&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=t):d[2]=t),r&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=r):d[4]=''.concat(r)),n.push(d))}},n}},88:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.era-shell[data-v-7634a531]{display:flex;align-items:flex-start;gap:12px;flex-wrap:nowrap}[data-v-7634a531] .era-panel{flex:0 1 auto}@media (max-width:992px){.era-shell[data-v-7634a531]{flex-wrap:wrap}[data-v-7634a531] .era-panel,[data-v-7634a531] .right-rail{width:100%;flex-basis:auto}[data-v-7634a531] .right-rail{position:static;margin-top:12px;height:auto;max-height:40vh}}[data-v-7634a531] .floating-ball{position:fixed;right:max(16px,env(safe-area-inset-right));bottom:max(90px,env(safe-area-inset-bottom));z-index:2147483647;pointer-events:auto;touch-action:manipulation;will-change:transform}.era-expanded-layer[data-v-7634a531]{position:fixed;inset:0;display:grid;place-items:center;padding:clamp(12px,2.5vw,24px);pointer-events:auto;z-index:2147483646;background:transparent;overflow:auto}@media (max-width:640px){[data-v-7634a531] .era-panel{width:min(92vw,560px);height:min(88vh,calc(100svh - 32px))}.panel-body[data-v-7634a531]{overscroll-behavior:contain}}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/App.vue'],names:[],mappings:'AAoFA,4BAEE,YAAa,CACb,sBAAuB,CACvB,QAAS,CACT,gBACF,CAGA,6BACE,aACF,CAGA,yBAEE,4BACE,cACF,CACA,2DAEE,UAAW,CACX,eACF,CACA,8BACE,eAAgB,CAChB,eAAgB,CAChB,WAAY,CACZ,eACF,CACF,CAGA,iCAEE,cAAe,CACf,0CAA4C,CAC5C,4CAA8C,CAC9C,kBAAmB,CACnB,mBAAoB,CACpB,yBAA0B,CAC1B,qBACF,CAGA,qCAEE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,kBAAmB,CACnB,8BAAiC,CACjC,mBAAoB,CACpB,kBAAmB,CACnB,sBAAuB,CACvB,aACF,CAGA,yBAEE,6BAEE,qBAAuB,CACvB,oCACF,CACA,6BAEE,2BACF,CACF',sourcesContent:['<template>\n  <div class="era-app-container" :class="{ \'dark-theme\': isDarkMode }">\n    <ThemeManager ref="themeManager" />\n    <FloatingBall v-show="currentComponent === \'FloatingBall\'" @click="requestSwitchView(\'ExpandedView\')" />\n    <div v-show="currentComponent === \'ExpandedView\'" class="era-expanded-layer">\n      \x3c!-- è§†å£çº§å±•å¼€å±‚ï¼šæ‚¬æµ®æ¨¡æ€å®¹å™¨ --\x3e\n      <div class="era-shell">\n        \x3c!-- æ–°å¢æ¨ªå‘å£³å®¹å™¨ï¼šå·¦é¢æ¿ + å³ä¾§æ  --\x3e\n        <EraPanel :data="dataRef" />\n        <RightRail />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { onBeforeUnmount, onMounted, ref } from \'vue\';\nimport { settings } from \'../utils/era_data\';\nimport { Logger } from \'../utils/log\';\nimport EraPanel from \'./components/EraPanel.vue\';\nimport FloatingBall from \'./components/FloatingBall.vue\';\nimport RightRail from \'./components/RightRail.vue\';\nimport ThemeManager from \'./components/ThemeManager.vue\';\nimport { useUiStore } from \'./store\';\n\nconst logger = new Logger();\n\n// ä» Pinia store è·å–çŠ¶æ€å’Œ action\nconst uiStore = useUiStore();\nconst { currentView: currentComponent, eventData: dataRef } = storeToRefs(uiStore);\n\n// ä¸»é¢˜çŠ¶æ€ç®¡ç†\nconst themeManager = ref<InstanceType<typeof ThemeManager> | null>(null);\nconst isDarkMode = ref(false);\n\nconst loadThemeSetting = () => {\n  try {\n    const darkModeValue = settings.value?.[\'å¼€å¯é»‘å¤œæ¨¡å¼\'] ?? false;\n    isDarkMode.value = darkModeValue;\n    if (themeManager.value) {\n      themeManager.value.isDarkMode = darkModeValue;\n    }\n    logger.debug(\'loadThemeSetting\', `ä¸»é¢˜å·²æ›´æ–°ä¸º: ${darkModeValue ? \'Dark\' : \'Light\'}`);\n  } catch (e) {\n    logger.error(\'loadThemeSetting\', \'åŠ è½½ä¸»é¢˜è®¾ç½®å¤±è´¥\', e);\n    isDarkMode.value = false; // Fallback to light mode\n  }\n};\n\nonMounted(() => {\n  loadThemeSetting();\n  window.addEventListener(\'era-settings-updated\', loadThemeSetting);\n});\n\nonBeforeUnmount(() => {\n  window.removeEventListener(\'era-settings-updated\', loadThemeSetting);\n});\n\nconst requestSwitchView = (viewName: \'FloatingBall\' | \'ExpandedView\') => {\n  logger.debug(\'requestSwitchView\', `è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${viewName}`);\n  uiStore.switchView(viewName);\n};\n<\/script>\n\n<style>\n/* App.vue è§†å£çº§æ‚¬æµ®å®¹å™¨ï¼ˆæ›¿æ¢åŸæœ‰ .era-app-containerï¼‰ */\n.era-app-container {\n  /* ä½œä¸ºå…¨å±€æ‚¬æµ®å±‚æ ¹å®¹å™¨ */\n  position: fixed; /* å›ºå®šåœ¨è§†å£ï¼Œä¸å—å¤–å±‚å¸ƒå±€å½±å“ */\n  inset: 0; /* è¦†ç›–æ•´ä¸ªè§†å£åŒºåŸŸï¼ˆtop/right/bottom/left å…¨ 0ï¼‰ */\n  z-index: 2147483646; /* è¶…é«˜å±‚çº§ï¼Œç›–ä½ç«™ç‚¹å…¶å®ƒå±‚ */\n  pointer-events: none; /* é»˜è®¤ä¸æˆªè·ç‚¹å‡»ï¼Œé¿å…é˜»æŒ¡é¡µé¢ */\n  isolation: isolate; /* æ–°å»ºç‹¬ç«‹å±‚å ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢è¢«å¤–å±‚æ··åˆå½±å“ */\n  contain: layout style paint; /* åˆ›å»ºæ¸²æŸ“å°è£…ï¼Œå‡å°‘å¤–ç•Œå¹²æ‰° */\n  width: 100svw; /* é€‚é…ç§»åŠ¨ç«¯åŠ¨æ€è§†å£å®½åº¦ */\n  height: 100svh; /* é€‚é…ç§»åŠ¨ç«¯åŠ¨æ€è§†å£é«˜åº¦ */\n}\n</style>\n\n<style scoped>\n/* ä» EraDataPanel.vue è¿ç§»è¿‡æ¥çš„æ ·å¼ */\n\n/* ===[æ–°å¢] æ¨ªå‘å£³ï¼šå·¦é¢æ¿ + å³ä¾§æ ï¼ˆæŒ‰é’®ï¼‰=== */\n.era-shell {\n  /* æ¨ªå‘åŒ…è£¹å®¹å™¨ */ /* ä¸­æ–‡æ³¨é‡Šï¼šæ¨ªå‘æ’åˆ—å®¹å™¨ */\n  display: flex; /* æ¨ªå‘å¸ƒå±€ */ /* ä¸­æ–‡æ³¨é‡Šï¼šflex æ¨ªæ’ */\n  align-items: flex-start; /* é¡¶å¯¹é½ */ /* ä¸­æ–‡æ³¨é‡Šï¼šä¸Šç¼˜å¯¹é½ */\n  gap: 12px; /* å·¦å³é—´è· */ /* ä¸­æ–‡æ³¨é‡Šï¼šå…ƒç´ é—´è· */\n  flex-wrap: nowrap; /* é»˜è®¤ä¸æ¢è¡Œ */ /* ä¸­æ–‡æ³¨é‡Šï¼šä¿æŒå¹¶æ’ */\n}\n\n/* ä¿æŒé¢æ¿å®½é«˜ï¼ˆåŸæ ·ï¼‰ï¼Œä½†è®©å®ƒæ›´å¥½åœ°åœ¨æ¨ªå‘ä¸­è‡ªé€‚åº” */\n:deep(.era-panel) {\n  flex: 0 1 auto; /* é¢æ¿æŒ‰è‡ªèº«å®½åº¦å¸ƒå±€ */\n}\n\n/* å°å±å›è½ï¼šæ”¹ä¸ºä¸Šä¸‹å †å ï¼ˆæŒ‰é’®åœ¨ä¸‹ï¼‰ */\n@media (max-width: 992px) {\n  /* 992px (å¹³æ¿) ä»¥ä¸‹å›è½ */\n  .era-shell {\n    flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n  }\n  :deep(.era-panel),\n  :deep(.right-rail) {\n    width: 100%; /* å„å ä¸€è¡Œ */\n    flex-basis: auto; /* é‡ç½® flex-basis */\n  }\n  :deep(.right-rail) {\n    position: static; /* å–æ¶ˆå¸é¡¶ */\n    margin-top: 12px; /* ä¸ä¸Šæ–¹ç•™ç™½ */\n    height: auto; /* é«˜åº¦è‡ªé€‚åº” */\n    max-height: 40vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œé¿å…è¿‡é•¿ */\n  }\n}\n\n/* ===[æ–°å¢] æ‚¬æµ®çƒï¼šå›ºå®šåœ¨å³ä¸‹è§’ + å¼€å¯ç‚¹å‡» === */\n:deep(.floating-ball) {\n  /* é€‰ä¸­å­ç»„ä»¶æ ¹å…ƒç´ ï¼ˆscoped ä¸‹ç”¨ deepï¼‰ */\n  position: fixed; /* å›ºå®šå®šä½åˆ°è§†å£ */\n  right: max(16px, env(safe-area-inset-right)); /* å³ä¾§å®‰å…¨åŒº + åŸºç¡€è¾¹è· */\n  bottom: max(90px, env(safe-area-inset-bottom)); /* åº•éƒ¨å®‰å…¨åŒº + åŸºç¡€è¾¹è· */\n  z-index: 2147483647; /* é«˜äºå®¹å™¨æ ¹ï¼Œç¡®ä¿å§‹ç»ˆå¯ç‚¹ */\n  pointer-events: auto; /* å¯ç”¨ç‚¹å‡»ï¼ˆçˆ¶å®¹å™¨æ˜¯ noneï¼‰ */\n  touch-action: manipulation; /* ç§»åŠ¨ç«¯å‡å°‘ç‚¹å‡»å»¶è¿Ÿ */\n  will-change: transform; /* æå‰åˆ†å±‚ï¼Œé¿å…ç«™ç‚¹ 3D/æ»¤é•œå½±å“ */\n}\n\n/* ===[æ–°å¢] å±•å¼€å±‚ï¼šè§†å£çº§æ¨¡æ€å®¹å™¨ï¼ˆåªåœ¨ ExpandedView v-show ä¸º true æ—¶å­˜åœ¨ï¼‰ === */\n.era-expanded-layer {\n  /* ç»‘å®šåœ¨æ¨¡æ¿æ–°å¢çš„ class */\n  position: fixed; /* å›ºå®šåœ¨è§†å£ï¼ˆä¸å—å¤–å±‚å¸ƒå±€çº¦æŸï¼‰ */\n  inset: 0; /* é“ºæ»¡è§†å£ */\n  display: grid; /* ç”¨ grid å±…ä¸­å†…å®¹ */\n  place-items: center; /* æ°´å¹³å‚ç›´ç½®ä¸­ */\n  padding: clamp(12px, 2.5vw, 24px); /* è§†å£è‡ªé€‚åº”å†…è¾¹è· */\n  pointer-events: auto; /* å¯ç”¨ç‚¹å‡»ï¼ˆä¸çˆ¶å®¹å™¨çš„ none åŒºåˆ†ï¼‰ */\n  z-index: 2147483646; /* ä»…æ¬¡äºæ‚¬æµ®çƒï¼Œä¿è¯åœ¨æœ€ä¸Šå±‚ */\n  background: transparent; /* å¦‚éœ€åŠé€æ˜é®ç½©å¯æ”¹ä¸º rgba(0,0,0,.25) */\n  overflow: auto; /* å†…å®¹è¶…å‡ºæ—¶ï¼Œå®¹å™¨è‡ªèº«æ»šåŠ¨ï¼Œä¸è¢«è£å‰ª */\n}\n\n/* ===[æ–°å¢] å°å±é€‚é…ï¼šé¢æ¿åœ¨ç§»åŠ¨ç«¯æ›´â€œå¡«å……â€å¯è§†åŒº === */\n@media (max-width: 640px) {\n  /* é’ˆå¯¹æ‰‹æœºå®½åº¦ */\n  :deep(.era-panel) {\n    /* é‡è®¾é¢æ¿å®½é«˜æ›´è´´åˆæ‰‹æœº */\n    width: min(92vw, 560px); /* æ”¾å®½åˆ° 92vwï¼Œé¿å… 60vw å¤ªçª„ */\n    height: min(88vh, calc(100svh - 32px)); /* å…¼é¡¾çŠ¶æ€æ /åœ°å€æ åŠ¨æ€é«˜åº¦ */\n  }\n  .panel-body {\n    /* ä¸»è¦å†…å®¹åŒºæ»šåŠ¨å®¹å™¨ */\n    overscroll-behavior: contain; /* é˜²æ­¢æ»šåŠ¨ç‰µåŠ¨èƒŒæ™¯é¡µé¢ */\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=o},90:(e,n,t)=>{var a=t(421);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('3754a394',a,!1,{ssrId:!0})},99:(e,n,t)=>{var a=t(608);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('0ffac0cc',a,!1,{ssrId:!0})},145:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.acc[data-v-f723f6d6]{border:1px solid var(--border-soft);border-radius:12px;background:var(--accordion-bg);overflow:hidden;transition:background 0.3s ease,border-color 0.3s ease}.acc-head[data-v-f723f6d6]{width:100%;display:flex;align-items:center;gap:10px;background:var(--mk-pill-null-bg);border-bottom:1px solid var(--border-soft);padding:10px 12px;cursor:pointer;font-weight:800;color:var(--text-subtitle);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.caret[data-v-f723f6d6]{transition:transform 0.18s ease}.caret.open[data-v-f723f6d6]{transform:rotate(90deg)}.title[data-v-f723f6d6]{font-size:13px}.spacer[data-v-f723f6d6]{flex:1}.hint[data-v-f723f6d6]{font-size:12px;color:var(--text-normal);transition:color 0.3s ease}.acc-body[data-v-f723f6d6]{max-height:0;overflow:hidden;transition:max-height 0.28s ease-in-out;background:var(--accordion-body-bg)}.acc-body.open[data-v-f723f6d6]{max-height:600px;overflow-y:auto}.inner[data-v-f723f6d6]{padding:10px 12px}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/template/EraAccordion.vue'],names:[],mappings:'AAkCA,sBACE,mCAAoC,CACpC,kBAAmB,CACnB,8BAA+B,CAC/B,eAAgB,CAChB,sDAGF,CAEA,2BACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,iCAAkC,CAClC,0CAA2C,CAC3C,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,0BAA2B,CAC3B,sEAIF,CACA,wBACE,+BACF,CACA,6BACE,uBACF,CACA,wBACE,cACF,CACA,yBACE,MACF,CACA,uBACE,cAAe,CACf,wBAAyB,CACzB,0BACF,CAEA,2BACE,YAAa,CACb,eAAgB,CAChB,uCAAwC,CACxC,mCACF,CACA,gCACE,gBAAiB,CACjB,eACF,CAEA,wBACE,iBACF',sourcesContent:['<template>\n  <section class="acc">\n    \x3c!-- æŠ˜å å¤´ï¼šç‚¹å‡»åˆ‡æ¢ --\x3e\n    <button class="acc-head" :aria-expanded="open ? \'true\' : \'false\'" @click="open = !open">\n      <span class="caret" :class="{ open }">â–¸</span>\n      \x3c!-- æŒ‡ç¤ºç®­å¤´ --\x3e\n      <span class="title">{{ title }}</span>\n      \x3c!-- æ ‡é¢˜æ–‡æœ¬ --\x3e\n      <span class="spacer"></span>\n      \x3c!-- å¼¹æ€§ç©ºéš™ --\x3e\n      <span class="hint">{{ open ? \'æ”¶èµ·\' : \'å±•å¼€\' }}</span>\n      \x3c!-- å³ä¾§æç¤º --\x3e\n    </button>\n\n    \x3c!-- å†…å®¹ï¼šé«˜åº¦è¿‡æ¸¡ï¼ˆä½¿ç”¨ CSS Gridï¼‰ --\x3e\n    <div class="acc-body" :class="{ open }">\n      <div class="inner">\n        <slot />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\nimport { ref } from \'vue\';\n\nconst props = withDefaults(defineProps<{ title: string; defaultOpen?: boolean }>(), {\n  defaultOpen: false,\n});\n\nconst open = ref<boolean>(props.defaultOpen);\n<\/script>\n\n<style scoped>\n.acc {\n  border: 1px solid var(--border-soft);\n  border-radius: 12px;\n  background: var(--accordion-bg);\n  overflow: hidden;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n.acc-head {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  background: var(--mk-pill-null-bg);\n  border-bottom: 1px solid var(--border-soft);\n  padding: 10px 12px;\n  cursor: pointer;\n  font-weight: 800;\n  color: var(--text-subtitle);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n.caret {\n  transition: transform 0.18s ease;\n}\n.caret.open {\n  transform: rotate(90deg);\n}\n.title {\n  font-size: 13px;\n}\n.spacer {\n  flex: 1;\n}\n.hint {\n  font-size: 12px;\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n}\n\n.acc-body {\n  max-height: 0;\n  overflow: hidden;\n  transition: max-height 0.28s ease-in-out;\n  background: var(--accordion-body-bg);\n}\n.acc-body.open {\n  max-height: 600px; /* ä¸ºå±•å¼€çš„å†…å®¹æä¾›ä¸€ä¸ªæ›´å¤§çš„æœ€å¤§é«˜åº¦ */\n  overflow-y: auto; /* å½“å†…å®¹è¶…å‡ºæœ€å¤§é«˜åº¦æ—¶ï¼Œæ˜¾ç¤ºæ»šåŠ¨æ¡ */\n}\n\n.inner {\n  padding: 10px 12px;\n}\n</style>\n'],sourceRoot:''}]);const i=o},223:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,':where(#era-snapshot-ui){--snapshot-text:var(--text-normal);--snapshot-muted:var(--muted);--snapshot-bg:var(--paper);--snapshot-bg-gradient:linear-gradient(to bottom,color-mix(in oklab,var(--paper),transparent 92%),transparent);--snapshot-stroke:var(--line);--snapshot-accent:var(--primary,var(--accent,#4f46e5));--on-accent:var(--on-accent,#ffffff);--snapshot-accent-soft:color-mix(in oklab,var(--snapshot-accent),transparent 82%);--snapshot-outer-shadow:0 6px 18px color-mix(in oklab,#000,transparent 90%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 92%);--snapshot-focus-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 90%);--snapshot-danger:var(--danger,#e11d48);--snapshot-danger-soft:color-mix(in oklab,var(--snapshot-danger),transparent 88%)}:where(html[data-theme=\'dark\'] #era-snapshot-ui),:where(body[data-theme=\'dark\'] #era-snapshot-ui){--snapshot-outer-shadow:0 8px 22px color-mix(in oklab,#000,transparent 70%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 94%)}@media (prefers-color-scheme:dark){#era-snapshot-ui{--snapshot-outer-shadow:0 8px 22px color-mix(in oklab,#000,transparent 72%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 94%)}}#era-snapshot-ui.snapshot-manager{display:flex;flex-direction:column;gap:16px}#era-snapshot-ui .selector-wrapper{display:block;margin-bottom:4px}#era-snapshot-ui .select-field{position:relative;display:block}#era-snapshot-ui .selector-label{font-size:14px;font-weight:700;color:var(--text-title);flex-shrink:0;letter-spacing:0.2px}#era-snapshot-ui .select-container{position:relative;flex-grow:1;isolation:isolate}#era-snapshot-ui .select-container::after{content:\'â–¾\';position:absolute;top:50%;right:12px;transform:translateY(-50%) rotate(0deg);font-size:14px;color:var(--snapshot-muted);pointer-events:none;transition:transform 0.18s ease,color 0.2s ease;z-index:1}#era-snapshot-ui .select-container:focus-within::after{transform:translateY(-50%) rotate(180deg);color:var(--snapshot-accent)}#era-snapshot-ui .mk-selector{width:100%;padding:10px 36px 10px 12px;border-radius:10px;border:1px solid var(--snapshot-stroke);background:var(--snapshot-bg-gradient),var(--snapshot-bg);backdrop-filter:saturate(1.05) blur(2px);color:var(--snapshot-text);font-family:inherit;font-size:14px;line-height:1.2;cursor:pointer;-webkit-appearance:none;appearance:none;transition:border-color 0.18s ease,box-shadow 0.18s ease,background 0.25s ease;box-shadow:var(--snapshot-inner-shadow),var(--snapshot-outer-shadow)}#era-snapshot-ui .mk-selector:hover{border-color:color-mix(in oklab,var(--snapshot-stroke),var(--snapshot-accent) 22%)}#era-snapshot-ui .mk-selector:focus{outline:none;border-color:var(--snapshot-accent);box-shadow:0 0 0 3px var(--snapshot-accent-soft),var(--snapshot-focus-inner-shadow)}#era-snapshot-ui .mk-selector:focus-visible{outline:none}#era-snapshot-ui .mk-selector option{color:var(--snapshot-text);background:var(--snapshot-bg)}#era-snapshot-ui .loading-indicator,#era-snapshot-ui .error-message{padding:18px;text-align:center;border-radius:12px;border:1px dashed var(--line,rgba(0,0,0,0.12));background:var(--bg-empty,rgba(0,0,0,0.03));color:var(--text-normal,#2a2a2a)}#era-snapshot-ui .error-message{color:var(--snapshot-danger);background:var(--snapshot-danger-soft);border-color:color-mix(in oklab,var(--snapshot-danger),transparent 55%)}@media (prefers-reduced-motion:reduce){#era-snapshot-ui .select-container::after,#era-snapshot-ui .mk-selector{transition:none}}#era-snapshot-ui .field-label{position:absolute;top:0;left:12px;transform:translateY(-50%);padding:0 6px;font-size:12px;line-height:1;color:var(--snapshot-muted);background:var(--snapshot-bg);border-radius:6px;pointer-events:none;z-index:1}#era-snapshot-ui .mk-selector{padding-top:22px}#era-snapshot-ui .select-field:focus-within .field-label{color:var(--snapshot-accent)}#era-snapshot-ui .select-container::after{content:\'â–¾\';position:absolute;top:50%;right:12px;transform:translateY(-50%);font-size:14px;color:var(--snapshot-muted);pointer-events:none;transition:transform 0.18s ease,color 0.2s ease}#era-snapshot-ui .select-container:focus-within::after{transform:translateY(-50%) rotate(180deg);color:var(--snapshot-accent)}#era-snapshot-ui .id-query-container{display:flex;border-radius:10px;transition:box-shadow 0.18s ease}#era-snapshot-ui .id-query-container:focus-within{box-shadow:0 0 0 3px var(--snapshot-accent-soft)}#era-snapshot-ui .id-input{flex-grow:1;border-top-right-radius:0;border-bottom-right-radius:0;border-right-width:0}#era-snapshot-ui .id-input:focus{box-shadow:none;border-color:var(--snapshot-stroke)}#era-snapshot-ui .query-button{flex-shrink:0;padding:22px 16px 10px;border-radius:10px;border-top-left-radius:0;border-bottom-left-radius:0;background-color:var(--snapshot-btn-bg);color:var(--snapshot-btn-text);border:1px solid var(--snapshot-stroke);font-family:inherit;font-size:14px;line-height:1.2;font-weight:700;cursor:pointer;transition:background-color 0.2s ease,border-color 0.2s ease,transform 0.1s ease}#era-snapshot-ui .query-button:hover{background-color:var(--snapshot-btn-hover-bg);border-color:color-mix(in oklab,var(--snapshot-stroke),var(--snapshot-text) 10%)}#era-snapshot-ui .query-button:active{transform:scale(0.97);background-color:var(--snapshot-btn-active-bg)}#era-snapshot-ui .query-button:focus-visible{outline:none;z-index:1;box-shadow:0 0 0 3px var(--snapshot-accent-soft)}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/SnapshotManager.vue'],names:[],mappings:'AAmNA,yBAEE,kCAAmC,CACnC,6BAA8B,CAC9B,0BAA2B,CAC3B,8GAAmH,CAGnH,6BAA8B,CAG9B,sDAAyD,CACzD,oCAAsC,CAGtC,iFAAoF,CACpF,2EAA8E,CAC9E,8EAAiF,CACjF,oFAAuF,CAGvF,uCAAyC,CACzC,iFACF,CAGA,kGAEE,2EAA8E,CAC9E,8EACF,CAGA,mCACE,iBACE,2EAA8E,CAC9E,8EACF,CACF,CAQA,kCAEE,YAAa,CACb,qBAAsB,CACtB,QACF,CAGA,mCAEE,aAAc,CACd,iBACF,CACA,+BAEE,iBAAkB,CAClB,aACF,CAGA,iCAEE,cAAe,CACf,eAAgB,CAChB,uBAAwB,CACxB,aAAc,CACd,oBACF,CAGA,mCAEE,iBAAkB,CAClB,WAAY,CACZ,iBACF,CAGA,0CAEE,WAAY,CACZ,iBAAkB,CAClB,OAAQ,CACR,UAAW,CACX,uCAAwC,CACxC,cAAe,CACf,2BAA4B,CAC5B,mBAAoB,CACpB,+CAEiB,CACjB,SACF,CAGA,uDAEE,yCAA0C,CAC1C,4BACF,CAGA,8BAEE,UAAW,CACX,2BAA4B,CAC5B,kBAAmB,CACnB,uCAAwC,CACxC,yDAA2D,CAC3D,wCAAyC,CACzC,0BAA2B,CAC3B,mBAAoB,CACpB,cAAe,CACf,eAAgB,CAChB,cAAe,CACf,uBAAwB,CAExB,eAAgB,CAChB,8EAGuB,CACvB,oEACF,CAGA,oCAEE,kFACF,CAGA,oCAEE,YAAa,CACb,mCAAoC,CACpC,mFAGF,CACA,4CAEE,YACF,CAGA,qCAEE,0BAA2B,CAC3B,6BACF,CAGA,oEAGE,YAAa,CACb,iBAAkB,CAClB,kBAAmB,CACnB,8CAAmD,CACnD,2CAAgD,CAChD,gCACF,CAGA,gCAEE,4BAA6B,CAC7B,sCAAuC,CACvC,uEACF,CAGA,uCACE,wEAEE,eACF,CACF,CAGA,8BAEE,iBAAkB,CAClB,KAAM,CACN,SAAU,CACV,0BAA2B,CAC3B,aAAc,CACd,cAAe,CACf,aAAc,CACd,2BAA4B,CAC5B,6BAA8B,CAC9B,iBAAkB,CAClB,mBAAoB,CACpB,SACF,CAGA,8BACE,gBACF,CAGA,yDACE,4BACF,CAGA,0CACE,WAAY,CACZ,iBAAkB,CAClB,OAAQ,CACR,UAAW,CACX,0BAA2B,CAC3B,cAAe,CACf,2BAA4B,CAC5B,mBAAoB,CACpB,+CAGF,CAGA,uDACE,yCAA0C,CAC1C,4BACF,CAOA,qCACE,YAAa,CACb,kBAAmB,CACnB,gCACF,CACA,kDACE,gDACF,CAGA,2BACE,WAAY,CACZ,yBAA0B,CAC1B,4BAA6B,CAC7B,oBACF,CAEA,iCACE,eAAgB,CAChB,mCACF,CAGA,+BACE,aAAc,CACd,sBAAuB,CACvB,kBAAmB,CACnB,wBAAyB,CACzB,2BAA4B,CAC5B,uCAAwC,CACxC,8BAA+B,CAC/B,uCAAwC,CACxC,mBAAoB,CACpB,cAAe,CACf,eAAgB,CAChB,eAAgB,CAChB,cAAe,CACf,gFAIF,CACA,qCACE,6CAA8C,CAC9C,gFACF,CACA,sCACE,qBAAsB,CACtB,8CACF,CACA,6CACE,YAAa,CACb,SAAU,CACV,gDACF',sourcesContent:['<template>\n  \x3c!-- â˜… æ–°å¢å”¯ä¸€ idï¼šä¸æ”¹å˜ä»»ä½•é€»è¾‘ï¼Œä»…ç”¨äºé™åˆ¶æ ·å¼ä½œç”¨åŸŸ --\x3e\n  <div id="era-snapshot-ui" class="snapshot-manager">\n    <div class="selector-wrapper">\n      \x3c!-- å¤–å±‚å®¹å™¨ï¼šä¿ç•™ï¼Œæ”¹ä¸ºçºµå‘å¸ƒå±€æ›´åè°ƒ --\x3e\n      <div class="select-field" role="group" aria-labelledby="mk-label">\n        \x3c!-- å­—æ®µå®¹å™¨ï¼šç”¨äºæµ®åŠ¨æ ‡é¢˜ --\x3e\n        <label id="mk-label" for="mk-selector" class="field-label">æŒ‰æ¶ˆæ¯å¯†é’¥(MK)æŸ¥çœ‹</label>\n        \x3c!-- æµ®åŠ¨å°æ ‡é¢˜ï¼šä¸å†å ç”¨æ°´å¹³ç©ºé—´ --\x3e\n        <div class="select-container">\n          \x3c!-- ä¸‹æ‹‰å®¹å™¨ï¼šä¿ç•™å³ä¾§ç®­å¤´ä¸é˜´å½±æ•ˆæœ --\x3e\n          <select id="mk-selector" v-model="selectedMk" class="mk-selector" @change="handleSelectionChange">\n            <option :value="null" disabled>-- ä»åˆ—è¡¨ä¸­é€‰æ‹© --</option>\n            <option v-for="(mk, index) in reversedSelectedMks" :key="mk || `null-${index}`" :value="mk">\n              {{ formatMkForDisplay(mk, index) }}\n              \x3c!-- é€‰é¡¹æ˜¾ç¤ºæ–‡æœ¬ --\x3e\n            </option>\n          </select>\n        </div>\n      </div>\n    </div>\n\n    <div class="selector-wrapper">\n      <div class="select-field" role="group" aria-labelledby="mid-label">\n        <label id="mid-label" for="mid-input" class="field-label">æŒ‰æ¶ˆæ¯IDæŸ¥çœ‹</label>\n        <div class="id-query-container">\n          <input\n            id="mid-input"\n            v-model.number="messageIdInput"\n            type="number"\n            class="mk-selector id-input"\n            placeholder="è¾“å…¥æ¶ˆæ¯ ID..."\n            @keyup.enter="queryByMId"\n          />\n          <button class="query-button" @click="queryByMId">æŸ¥æ‰¾</button>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="loading" class="loading-indicator">æ­£åœ¨åŠ è½½å¿«ç…§...</div>\n    <div v-if="error" class="error-message">{{ error }}</div>\n\n    <template v-if="displayData">\n      <EraAccordion title="æ¶ˆæ¯å…ƒæ•°æ®" :default-open="true">\n        <MetaHeader :mk="displayData.mk" :message-id="displayData.message_id" :is-user="isUserMessageComputed" />\n      </EraAccordion>\n\n      <TabSwitch v-model:active="activeTab" :tabs="tabs">\n        <template #pure>\n          <PrettyJsonViewer :value="displayData.statWithoutMeta" :default-collapsed="true" :max-depth="Infinity" />\n        </template>\n        <template #full>\n          <PrettyJsonViewer :value="displayData.stat" :default-collapsed="true" :max-depth="Infinity" />\n        </template>\n      </TabSwitch>\n    </template>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, onMounted, onUnmounted, ref, watch } from \'vue\';\nimport type { QueryResultItem, QueryResultPayload, WriteDonePayload } from \'../../utils/constants\';\nimport { Logger } from \'../../utils/log\';\nimport { isUserMessage } from \'../../utils/message\';\nimport EraAccordion from \'../template/EraAccordion.vue\';\nimport PrettyJsonViewer from \'../template/PrettyJsonViewer.vue\';\nimport TabSwitch from \'../template/TabSwitch.vue\';\nimport MetaHeader from \'./EraPanelContent/MetaHeader.vue\';\n\ntype DisplayData = Pick<WriteDonePayload, \'mk\' | \'message_id\' | \'stat\' | \'statWithoutMeta\'>;\ntype TabItem = { key: \'pure\' | \'full\'; label: string };\n\nconst props = defineProps<{\n  latestData: WriteDonePayload | null;\n}>();\n\nconst logger = new Logger();\n\nconst latestMkFromProps = computed(() => props.latestData?.mk ?? null);\nconst selectedMk = ref<string | null>(latestMkFromProps.value);\nconst messageIdInput = ref<number | null>(null);\nconst historicalSnapshot = ref<QueryResultItem | null>(null);\nconst loading = ref(false);\nconst error = ref<string | null>(null);\n\nconst tabs: TabItem[] = [\n  { key: \'pure\', label: \'çº¯å‡€çŠ¶æ€æ•°æ®\' },\n  { key: \'full\', label: \'å®Œæ•´çŠ¶æ€æ•°æ®\' },\n];\nconst activeTab = ref<\'pure\' | \'full\'>(\'pure\');\n\nconst reversedSelectedMks = computed(() => {\n  return props.latestData?.selectedMks?.slice().reverse() ?? [];\n});\n\nconst displayData = computed<DisplayData | null>(() => {\n  // ä¼˜å…ˆæ˜¾ç¤ºæŸ¥è¯¢åˆ°çš„å†å²å¿«ç…§\n  if (historicalSnapshot.value) {\n    return historicalSnapshot.value;\n  }\n  // å¦‚æœæ²¡æœ‰å†å²å¿«ç…§ï¼Œä¸”å½“å‰é€‰ä¸­äº†æœ€æ–°çš„MKï¼ˆæˆ–é»˜è®¤çŠ¶æ€ï¼‰ï¼Œåˆ™æ˜¾ç¤ºæœ€æ–°çš„æ•°æ®\n  if (selectedMk.value === latestMkFromProps.value) {\n    return props.latestData;\n  }\n  // å…¶ä»–æƒ…å†µï¼ˆå¦‚åˆ—è¡¨é€‰ä¸­äº†éæœ€æ–°é¡¹ä½†è¿˜æ²¡è¿”å›ç»“æœï¼‰ä¸æ˜¾ç¤º\n  return null;\n});\n\nconst isUserMessageComputed = computed(() => {\n  if (!displayData.value) return false;\n  // å¦‚æœæ˜¯å†å²å¿«ç…§(QueryResultItem)ï¼Œå®ƒä¼šåŒ…å« is_user å±æ€§\n  if (\'is_user\' in displayData.value) {\n    return (displayData.value as QueryResultItem).is_user;\n  }\n  // å¦åˆ™ï¼Œè¿™æ˜¯æœ€æ–°æ•°æ®(WriteDonePayload)ï¼Œæˆ‘ä»¬éœ€è¦ä»æ¶ˆæ¯ä¸­è·å–å®ƒ\n  const message = getChatMessages(displayData.value.message_id, { include_swipes: false })[0];\n  return message ? isUserMessage(message) : false;\n});\n\nwatch(\n  () => latestMkFromProps.value,\n  newLatestMk => {\n    // å½“å¤–éƒ¨æ•°æ®æ›´æ–°æ—¶ï¼Œé‡ç½®UIåˆ°æœ€æ–°çŠ¶æ€\n    selectedMk.value = newLatestMk;\n    historicalSnapshot.value = null;\n    messageIdInput.value = null;\n    error.value = null;\n    loading.value = false;\n  },\n  { immediate: true },\n);\n\nconst handleSelectionChange = () => {\n  const mk = selectedMk.value;\n  // æ¸…ç†å…¶ä»–æŸ¥è¯¢æ–¹å¼çš„çŠ¶æ€\n  messageIdInput.value = null;\n  historicalSnapshot.value = null;\n  error.value = null;\n\n  if (!mk || mk === latestMkFromProps.value) {\n    loading.value = false;\n    return;\n  }\n\n  loading.value = true;\n  logger.debug(\'SnapshotManager\', `(MK Select) è¯·æ±‚å¿«ç…§, mk: ${mk}`);\n  eventEmit(\'era:getSnapshotAtMk\', { mk });\n};\n\nconst queryByMId = () => {\n  if (messageIdInput.value === null || messageIdInput.value < 0) {\n    error.value = \'è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„ã€éè´Ÿçš„æ¶ˆæ¯ IDã€‚\';\n    return;\n  }\n  // æ¸…ç†å…¶ä»–æŸ¥è¯¢æ–¹å¼çš„çŠ¶æ€\n  selectedMk.value = null; // ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­å–æ¶ˆé€‰æ‹©\n  historicalSnapshot.value = null;\n  error.value = null;\n  loading.value = true;\n\n  logger.debug(\'SnapshotManager\', `(ID Query) è¯·æ±‚å¿«ç…§, message_id: ${messageIdInput.value}`);\n  eventEmit(\'era:getSnapshotAtMId\', { message_id: messageIdInput.value });\n};\n\nconst handleQueryResult = (detail: QueryResultPayload) => {\n  loading.value = false;\n\n  const handleResult = (result: QueryResultItem | null, errorMsg: string) => {\n    if (result) {\n      historicalSnapshot.value = result;\n      // åŒæ­¥ä¸‹æ‹‰æ¡†çš„é€‰ä¸­é¡¹\n      selectedMk.value = result.mk;\n      error.value = null;\n    } else {\n      historicalSnapshot.value = null;\n      error.value = errorMsg;\n    }\n  };\n\n  if (detail.queryType === \'getSnapshotAtMk\' && detail.request.mk === selectedMk.value) {\n    handleResult(detail.result as QueryResultItem | null, `æœªæ‰¾åˆ°ä¸ MK "${selectedMk.value}" ç›¸å…³çš„å¿«ç…§ã€‚`);\n  } else if (detail.queryType === \'getSnapshotAtMId\' && detail.request.message_id === messageIdInput.value) {\n    handleResult(detail.result as QueryResultItem | null, `æœªæ‰¾åˆ°ä¸æ¶ˆæ¯ ID "${messageIdInput.value}" ç›¸å…³çš„å¿«ç…§ã€‚`);\n  }\n};\n\nconst formatMkForDisplay = (mk: string | null, index: number): string => {\n  const total = reversedSelectedMks.value.length;\n  const msgId = total - 1 - index;\n  const isLatest = mk === latestMkFromProps.value;\n\n  if (!mk) return `æ¶ˆæ¯ ${msgId} (æ— MK)`;\n\n  const shortMk = mk.substring(mk.length - 6);\n  const label = `æ¶ˆæ¯ ${msgId} (...${shortMk})`;\n\n  return isLatest ? `${label} (æœ€æ–°)` : label;\n};\n\nonMounted(() => {\n  eventOn(\'era:queryResult\', handleQueryResult);\n});\n\nonUnmounted(() => {\n  eventRemoveListener(\'era:queryResult\', handleQueryResult);\n});\n<\/script>\n\n\x3c!-- â˜… å–æ¶ˆ scopedï¼Œç»Ÿä¸€ä»¥ #era-snapshot-ui ä½œä¸ºâ€œä¼ªä½œç”¨åŸŸâ€æ ¹é€‰æ‹©å™¨ --\x3e\n<style>\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ å±€éƒ¨ä¸»é¢˜å˜é‡æ˜ å°„ï¼šè®©æœ¬ç»„ä»¶éšå…¨å±€æ˜/æš—ä¸»é¢˜è‡ªåŠ¨å˜è‰² â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n:where(#era-snapshot-ui) {\n  /* æ–‡æœ¬ä¸èƒŒæ™¯ï¼ˆæ˜ å°„å…¨å±€å˜é‡ï¼‰ */\n  --snapshot-text: var(--text-normal); /* å¸¸è§„æ–‡å­—è‰² */\n  --snapshot-muted: var(--muted); /* æ¬¡çº§æ–‡å­—è‰² */\n  --snapshot-bg: var(--paper); /* æ§ä»¶/å¡ç‰‡åº•è‰² */\n  --snapshot-bg-gradient: linear-gradient(to bottom, color-mix(in oklab, var(--paper), transparent 92%), transparent);\n\n  /* çº¿æ¡ä¸æè¾¹ */\n  --snapshot-stroke: var(--line); /* ç»Ÿä¸€æè¾¹è‰² */\n\n  /* å“ç‰Œ/å¼ºè°ƒè‰²ï¼ˆä¼˜å…ˆä½¿ç”¨ --primaryï¼›å¦åˆ™é€€å› --accentï¼Œå†é€€å›ä¸€ä¸ªå®‰å…¨ç´«é›ï¼‰ */\n  --snapshot-accent: var(--primary, var(--accent, #4f46e5));\n  --on-accent: var(--on-accent, #ffffff); /* å¼ºè°ƒåº•ä¸Šçš„å¯è¯»å‰æ™¯è‰² */\n\n  /* è½¯å…‰ç¯/é˜´å½±ï¼ˆéšä¸»é¢˜å¾®è°ƒï¼‰ */\n  --snapshot-accent-soft: color-mix(in oklab, var(--snapshot-accent), transparent 82%);\n  --snapshot-outer-shadow: 0 6px 18px color-mix(in oklab, #000, transparent 90%);\n  --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 92%);\n  --snapshot-focus-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 90%);\n\n  /* å±é™©/é”™è¯¯è‰²ï¼ˆæ˜ å°„å…¨å±€ dangerï¼Œæ²¡æœ‰åˆ™å›é€€çº¢è‰²ç³»ï¼‰ */\n  --snapshot-danger: var(--danger, #e11d48);\n  --snapshot-danger-soft: color-mix(in oklab, var(--snapshot-danger), transparent 88%);\n}\n\n/* ï¼ˆå¯é€‰ï¼‰è‹¥ä½ çš„ ThemeToggle é€šè¿‡ data-theme åˆ‡æ¢ï¼Œè¿™æ®µè®©æš—è‰²é˜´å½±å±‚æ¬¡æ›´è‡ªç„¶ */\n:where(html[data-theme=\'dark\'] #era-snapshot-ui),\n:where(body[data-theme=\'dark\'] #era-snapshot-ui) {\n  --snapshot-outer-shadow: 0 8px 22px color-mix(in oklab, #000, transparent 70%);\n  --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 94%);\n}\n\n/* ï¼ˆäº¦å¯é€‰ï¼‰ç³»ç»Ÿçº§æš—è‰²åå¥½æ—¶çš„å¾®è°ƒï¼šåŒä¿é™© */\n@media (prefers-color-scheme: dark) {\n  #era-snapshot-ui {\n    --snapshot-outer-shadow: 0 8px 22px color-mix(in oklab, #000, transparent 72%);\n    --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 94%);\n  }\n}\n\n/* =========================\n   ERA Snapshot ä¸‹æ‹‰æ¡†ä¸»é¢˜ï¼ˆä»…é™æœ¬ç»„ä»¶ï¼‰\n   é€šè¿‡å”¯ä¸€æ ¹é€‰æ‹©å™¨ #era-snapshot-ui çº¦æŸä½œç”¨èŒƒå›´\n   ========================= */\n\n/* ---- æ ¹å®¹å™¨ï¼šä¿ç•™åŸå¸ƒå±€ï¼Œå¢å¼ºå¯è¯»é—´è· ---- */\n#era-snapshot-ui.snapshot-manager {\n  /* ä»…é™æœ¬ç»„ä»¶æ ¹å®¹å™¨ */\n  display: flex; /* å¼¹æ€§å¸ƒå±€ï¼šç«–å‘æ ˆ */\n  flex-direction: column; /* çºµå‘æ’åˆ— */\n  gap: 16px; /* è¡Œè· */\n}\n\n/* ---- é€‰æ‹©å™¨åŒºåŸŸï¼šæ ‡ç­¾ä¸ä¸‹æ‹‰å¹¶æ’ ---- */\n#era-snapshot-ui .selector-wrapper {\n  /* é€‰æ‹©å™¨å¤–å±‚å®¹å™¨ */\n  display: block; /* çºµå‘å †å ï¼Œæ ‡é¢˜åœ¨ä¸Šï¼Œä¸‹æ‹‰åœ¨ä¸‹ */\n  margin-bottom: 4px; /* åº•éƒ¨ç•™ä¸€ç‚¹å‘¼å¸ */\n}\n#era-snapshot-ui .select-field {\n  /* å­—æ®µå®¹å™¨ */\n  position: relative; /* ä½œä¸ºæµ®åŠ¨æ ‡é¢˜çš„å®šä½ä¸Šä¸‹æ–‡ */\n  display: block; /* ç‹¬å ä¸€è¡Œï¼Œä¾¿äºå¯¹é½å…¶ä»–æ§ä»¶ */\n}\n\n/* ---- å·¦ä¾§æ ‡ç­¾ï¼šç•¥ææƒé‡ä¸å¯¹æ¯”åº¦ ---- */\n#era-snapshot-ui .selector-label {\n  /* â€œæŸ¥çœ‹å¿«ç…§:â€ æ ‡ç­¾ */\n  font-size: 14px; /* å­—å· */\n  font-weight: 700; /* åŠ ç²—ï¼Œä¾¿äºè¯†åˆ« */\n  color: var(--text-title); /* ä½¿ç”¨æ ‡é¢˜è‰² */\n  flex-shrink: 0; /* ä¸éšå®¹å™¨æ”¶ç¼© */\n  letter-spacing: 0.2px; /* å¾®è°ƒå­—è·ï¼Œå¢å¼ºç²¾è‡´æ„Ÿ */\n}\n\n/* ---- ä¸‹æ‹‰å®¹å™¨ï¼šåšâ€œè¾“å…¥æ¡†å¡ç‰‡â€è§†è§‰ ---- */\n#era-snapshot-ui .select-container {\n  /* ä¸‹æ‹‰å®¹å™¨ */\n  position: relative; /* ç”¨äºæ”¾ç½®å†…ç½®ç®­å¤´ */\n  flex-grow: 1; /* å æ»¡å‰©ä½™å®½åº¦ */\n  isolation: isolate; /* é˜²æ­¢å­å±‚æ··åˆåˆ°å¤–éƒ¨ */\n}\n\n/* ---- è‡ªå®šä¹‰ä¸‹æ‹‰ç®­å¤´ï¼šè·Ÿéšç„¦ç‚¹æ—‹è½¬ ---- */\n#era-snapshot-ui .select-container::after {\n  /* å³ä¾§ç®­å¤´ */\n  content: \'â–¾\'; /* ä½¿ç”¨æ›´çº¤ç»†çš„ä¸‰è§’å­—ç¬¦ */\n  position: absolute; /* ç»å¯¹å®šä½åˆ°å³ä¾§ */\n  top: 50%; /* å‚ç›´å±…ä¸­åŸºå‡† */\n  right: 12px; /* å³ä¾§å†…è¾¹è· */\n  transform: translateY(-50%) rotate(0deg); /* å±…ä¸­ä¸åˆå§‹è§’åº¦ */\n  font-size: 14px; /* ç®­å¤´å­—å· */\n  color: var(--snapshot-muted); /* ç®­å¤´é¢œè‰² */\n  pointer-events: none; /* ä¸é®æŒ¡ç‚¹å‡» */\n  transition:\n    transform 0.18s ease,\n    color 0.2s ease; /* æ—‹è½¬ä¸é¢œè‰²è¿‡æ¸¡ */\n  z-index: 1; /* åœ¨ä¸‹æ‹‰ä¹‹ä¸Šä½†ä»åœ¨å®¹å™¨å†… */\n}\n\n/* ---- ç„¦ç‚¹æ—¶ç®­å¤´æ—‹è½¬ï¼Œæç¤ºâ€œå·²æ¿€æ´»â€ ---- */\n#era-snapshot-ui .select-container:focus-within::after {\n  /* å®¹å™¨è·ç„¦ */\n  transform: translateY(-50%) rotate(180deg); /* ç®­å¤´ç¿»è½¬ */\n  color: var(--snapshot-accent); /* ç”¨ä¸»è‰²æç¤ºæ¿€æ´» */\n}\n\n/* ---- ä¸‹æ‹‰æœ¬ä½“ï¼šåšâ€œåŠç»ç’ƒè¾“å…¥æ¡† + ç»†æè¾¹ + é˜´å½±â€ ---- */\n#era-snapshot-ui .mk-selector {\n  /* åŸä¸‹æ‹‰å…ƒç´  */\n  width: 100%; /* å æ»¡å®¹å™¨å®½åº¦ */\n  padding: 10px 36px 10px 12px; /* ç•™å‡ºå³ä¾§ç®­å¤´ç©ºé—´ */\n  border-radius: 10px; /* åœ†è§’è¾“å…¥æ¡† */\n  border: 1px solid var(--snapshot-stroke); /* ç»†æè¾¹ */\n  background: var(--snapshot-bg-gradient), var(--snapshot-bg); /* åŸºåº•è‰²ï¼ˆå¡ç‰‡è‰²ï¼‰ */\n  backdrop-filter: saturate(1.05) blur(2px); /* è½»ç»ç’ƒæ•ˆæœï¼ˆæœ‰æ”¯æŒçš„æµè§ˆå™¨ï¼‰ */\n  color: var(--snapshot-text); /* æ–‡æœ¬é¢œè‰² */\n  font-family: inherit; /* ç»§æ‰¿å­—ä½“ */\n  font-size: 14px; /* å­—å· */\n  line-height: 1.2; /* è¡Œé«˜ */\n  cursor: pointer; /* æŒ‡é’ˆå½¢æ€ */\n  -webkit-appearance: none; /* å»é™¤é»˜è®¤å¤–è§‚ï¼šSafari/Chrome */\n  -moz-appearance: none; /* å»é™¤é»˜è®¤å¤–è§‚ï¼šFirefox */\n  appearance: none; /* æ ‡å‡†å»é™¤é»˜è®¤å¤–è§‚ */\n  transition:\n    border-color 0.18s ease,\n    box-shadow 0.18s ease,\n    background 0.25s ease; /* äº¤äº’è¿‡æ¸¡ */\n  box-shadow: var(--snapshot-inner-shadow), var(--snapshot-outer-shadow); /* è½»å¤–é˜´å½±ï¼Œæµ®èµ·æ„Ÿ */\n}\n\n/* ---- æ‚¬åœï¼šæè¾¹åŠ æ·±ï¼Œæç¤ºå¯äº¤äº’ ---- */\n#era-snapshot-ui .mk-selector:hover {\n  /* æ‚¬åœæ€ */\n  border-color: color-mix(in oklab, var(--snapshot-stroke), var(--snapshot-accent) 22%); /* æ··åˆä¸€ç‚¹ä¸»è‰² */\n}\n\n/* ---- ç„¦ç‚¹/é”®ç›˜è®¿é—®ï¼šä¸»è‰²æè¾¹ + æŸ”å…‰å¤–ç¯ ---- */\n#era-snapshot-ui .mk-selector:focus {\n  /* ç„¦ç‚¹æ€ï¼ˆå«é¼ æ ‡ï¼‰ */\n  outline: none; /* ç§»é™¤ç³»ç»Ÿå¤–æè¾¹ */\n  border-color: var(--snapshot-accent); /* ä¸»è‰²æè¾¹ */\n  box-shadow:\n    0 0 0 3px var(--snapshot-accent-soft),\n    /* æŸ”å…‰å¤–ç¯ */ var(--snapshot-focus-inner-shadow); /* ä¿ç•™å†…é«˜å…‰ */\n}\n#era-snapshot-ui .mk-selector:focus-visible {\n  /* é”®ç›˜å¯è§ç„¦ç‚¹æ€ */\n  outline: none; /* ä¿æŒä¸€è‡´ */\n}\n\n/* ---- é€‰é¡¹æ ·å¼ï¼ˆå¯æ§æ€§æœ‰é™ï¼Œä¸åŒç³»ç»Ÿç•¥æœ‰å·®å¼‚ï¼‰ ---- */\n#era-snapshot-ui .mk-selector option {\n  /* ä¸‹æ‹‰åˆ—è¡¨é¡¹ */\n  color: var(--snapshot-text); /* æ–‡æœ¬è‰² */\n  background: var(--snapshot-bg); /* èƒŒæ™¯è‰² */\n}\n\n/* ---- åŠ è½½ / é”™è¯¯å—ï¼šç»Ÿä¸€å¡ç‰‡åŒ–è§‚æ„Ÿ ---- */\n#era-snapshot-ui .loading-indicator,\n#era-snapshot-ui .error-message {\n  /* ä¿¡æ¯å¡ç‰‡ */\n  padding: 18px; /* å†…è¾¹è· */\n  text-align: center; /* å±…ä¸­å±•ç¤º */\n  border-radius: 12px; /* åœ†è§’ */\n  border: 1px dashed var(--line, rgba(0, 0, 0, 0.12)); /* è™šçº¿è¾¹ç•Œ */\n  background: var(--bg-empty, rgba(0, 0, 0, 0.03)); /* ç©ºæ€èƒŒæ™¯ */\n  color: var(--text-normal, #2a2a2a); /* æ–‡å­—è‰² */\n}\n\n/* ---- é”™è¯¯æ€ï¼šæ›´é†’ç›®çš„çº¢ç³»æç¤ºï¼Œä½†ä¿æŒæŸ”å’Œ ---- */\n#era-snapshot-ui .error-message {\n  /* â—ä¸‰ä»¶å¥—å…¨éƒ¨æ”¹ä¸º snapshot danger ç³»åˆ—ï¼Œè‡ªåŠ¨éšä¸»é¢˜é€‚é… */\n  color: var(--snapshot-danger);\n  background: var(--snapshot-danger-soft);\n  border-color: color-mix(in oklab, var(--snapshot-danger), transparent 55%);\n}\n\n/* ---- ç»†èŠ‚ä¼˜åŒ–ï¼šåœ¨ä½è¿åŠ¨åå¥½ä¸‹å…³é—­åŠ¨ç”» ---- */\n@media (prefers-reduced-motion: reduce) {\n  #era-snapshot-ui .select-container::after,\n  #era-snapshot-ui .mk-selector {\n    transition: none; /* å…³é—­è¿‡æ¸¡ */\n  }\n}\n\n/* â”€â”€ æµ®åŠ¨æ ‡é¢˜ï¼šå¾®å‹æ ‡ç­¾ï¼Œæ‚¬åœäºè¾“å…¥æ¡†ä¸Šè¾¹ç¼˜ â”€â”€ */\n#era-snapshot-ui .field-label {\n  /* æµ®åŠ¨æ ‡é¢˜æ–‡æœ¬â€œæŸ¥çœ‹å¿«ç…§â€ */\n  position: absolute; /* ç»å¯¹å®šä½åˆ°è¾“å…¥æ¡†ä¹‹ä¸Š */\n  top: 0; /* è´´è¿‘å®¹å™¨é¡¶éƒ¨ */\n  left: 12px; /* ä¸è¾“å…¥æ¡†å·¦å†…è¾¹è·å¯¹é½ */\n  transform: translateY(-50%); /* ä¸Šç§»åŠè¡Œï¼Œå‘ˆâ€œè´´è¾¹æ‚¬æµ®â€æ•ˆæœ */\n  padding: 0 6px; /* å°å£è¢‹èƒŒæ™¯ï¼Œé¿å…ä¸è¾“å…¥æ¡†è¾¹çº¿é‡å  */\n  font-size: 12px; /* å¾®å°å­—å·ï¼Œä½œä¸ºå­—æ®µå */\n  line-height: 1; /* ç´§å‡‘è¡Œé«˜ */\n  color: var(--snapshot-muted); /* æ¬¡è¦æ–‡å­—è‰² */\n  background: var(--snapshot-bg); /* èƒŒæ™¯åŒå¡ç‰‡è‰²ï¼Œè¥é€ â€œæŒ–ç©ºâ€æ•ˆæœ */\n  border-radius: 6px; /* åœ†æ¶¦è§’ */\n  pointer-events: none; /* ä¸é®æŒ¡ç‚¹å‡»åˆ° select */\n  z-index: 1; /* ç›–åœ¨è¾“å…¥æ¡†æè¾¹ä¹‹ä¸Š */\n}\n\n/* â”€â”€ è®©ä¸‹æ‹‰æœ¬ä½“ä¸ºæµ®åŠ¨æ ‡é¢˜â€œè…¾ä½â€ï¼šåŠ ä¸Šè¶³å¤Ÿçš„ä¸Šå†…è¾¹è· â”€â”€ */\n#era-snapshot-ui .mk-selector {\n  padding-top: 22px;\n}\n\n/* â”€â”€ å¯é€‰ï¼šå½“è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ ‡é¢˜é¢œè‰²è”åŠ¨å¼ºè°ƒ â”€â”€ */\n#era-snapshot-ui .select-field:focus-within .field-label {\n  color: var(--snapshot-accent);\n}\n\n/* â”€â”€ ç®­å¤´ï¼šä¿æŒä½ å…ˆå‰çš„å³ä¾§å†…ç½®ç®­å¤´æ ·å¼ä¸å˜ï¼ˆå¼•ç”¨å·²æœ‰è§„åˆ™ï¼‰ â”€â”€ */\n#era-snapshot-ui .select-container::after {\n  content: \'â–¾\';\n  position: absolute;\n  top: 50%;\n  right: 12px;\n  transform: translateY(-50%);\n  font-size: 14px;\n  color: var(--snapshot-muted);\n  pointer-events: none;\n  transition:\n    transform 0.18s ease,\n    color 0.2s ease;\n}\n\n/* â”€â”€ è·ç„¦æ—¶ç®­å¤´è”åŠ¨æ—‹è½¬é«˜äº®ï¼ˆå¦‚æœä½ ä¹‹å‰å·²æœ‰æ­¤è§„åˆ™ï¼Œå¯ä¿ç•™ä»»ä¸€ç‰ˆæœ¬ï¼‰ â”€â”€ */\n#era-snapshot-ui .select-container:focus-within::after {\n  transform: translateY(-50%) rotate(180deg);\n  color: var(--snapshot-accent);\n}\n\n/* =========================\n   ID æŸ¥è¯¢è¾“å…¥æ¡†ä¸æŒ‰é’®\n   ========================= */\n\n/* å®¹å™¨ï¼šå®ç°æ— ç¼æ‹¼æ¥å’Œæ•´ä½“ç„¦ç‚¹æ•ˆæœ */\n#era-snapshot-ui .id-query-container {\n  display: flex;\n  border-radius: 10px;\n  transition: box-shadow 0.18s ease;\n}\n#era-snapshot-ui .id-query-container:focus-within {\n  box-shadow: 0 0 0 3px var(--snapshot-accent-soft);\n}\n\n/* è¾“å…¥æ¡†ï¼šç»§æ‰¿ .mk-selector æ ·å¼ï¼Œå¹¶è°ƒæ•´æ‹¼æ¥ä¾§çš„åœ†è§’å’Œè¾¹æ¡† */\n#era-snapshot-ui .id-input {\n  flex-grow: 1;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  border-right-width: 0;\n}\n/* è¾“å…¥æ¡†è·ç„¦æ—¶ï¼Œç”±çˆ¶å®¹å™¨å¤„ç†é˜´å½± */\n#era-snapshot-ui .id-input:focus {\n  box-shadow: none;\n  border-color: var(--snapshot-stroke);\n}\n\n/* æŸ¥è¯¢æŒ‰é’®ï¼šç‹¬ç«‹ä¸”å®Œæ•´çš„æ ·å¼ï¼Œç¡®ä¿é«˜åº¦ä¸€è‡´ */\n#era-snapshot-ui .query-button {\n  flex-shrink: 0;\n  padding: 22px 16px 10px; /* ç»Ÿä¸€å‚ç›´ padding ä»¥å¯¹é½è¾“å…¥æ¡† */\n  border-radius: 10px;\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n  background-color: var(--snapshot-btn-bg);\n  color: var(--snapshot-btn-text);\n  border: 1px solid var(--snapshot-stroke);\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.2;\n  font-weight: 700;\n  cursor: pointer;\n  transition:\n    background-color 0.2s ease,\n    border-color 0.2s ease,\n    transform 0.1s ease;\n}\n#era-snapshot-ui .query-button:hover {\n  background-color: var(--snapshot-btn-hover-bg);\n  border-color: color-mix(in oklab, var(--snapshot-stroke), var(--snapshot-text) 10%);\n}\n#era-snapshot-ui .query-button:active {\n  transform: scale(0.97);\n  background-color: var(--snapshot-btn-active-bg);\n}\n#era-snapshot-ui .query-button:focus-visible {\n  outline: none;\n  z-index: 1; /* ç¡®ä¿ç„¦ç‚¹é˜´å½±åœ¨æœ€ä¸Šå±‚ */\n  box-shadow: 0 0 0 3px var(--snapshot-accent-soft);\n}\n</style>\n'],sourceRoot:''}]);const i=o},236:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.settings-card[data-v-e1f9e9e0]{width:100%;padding:12px;background:var(--settings-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--settings-shadow-card),var(--settings-shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-header[data-v-e1f9e9e0]{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;border:1px solid var(--border-soft);background:var(--chip-bg);color:var(--text-title);font-weight:800;font-size:13px;cursor:pointer;box-shadow:var(--settings-shadow-inset),var(--shadow-button);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.card-header[data-v-e1f9e9e0]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--shadow-button-hover)}.title[data-v-e1f9e9e0]{pointer-events:none}.chev[data-v-e1f9e9e0]{opacity:0.7}.content[data-v-e1f9e9e0]{display:flex;flex-direction:column;gap:10px}.toolbar[data-v-e1f9e9e0]{display:flex;align-items:center;gap:8px}.spacer[data-v-e1f9e9e0]{flex:1}.mini-btn[data-v-e1f9e9e0]{padding:6px 10px;border-radius:8px;border:1px solid var(--border-normal);background:var(--chip-bg);color:var(--text-normal);cursor:pointer;font-size:12px;font-weight:700;box-shadow:var(--settings-shadow-inset),var(--settings-shadow-minibtn);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.mini-btn[data-v-e1f9e9e0]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--settings-shadow-minibtn-hover)}.mini-btn.primary[data-v-e1f9e9e0]{background:var(--settings-bg-btn-primary);border-color:var(--settings-border-btn-primary);color:var(--settings-text-primary-btn)}.mini-btn.subtle[data-v-e1f9e9e0]{background:var(--settings-bg-btn-subtle);border-color:var(--settings-border-input)}.vars[data-v-e1f9e9e0]{display:flex;flex-direction:column;gap:8px}.var-row[data-v-e1f9e9e0]{display:grid;grid-template-columns:1fr minmax(120px,1.2fr) auto;align-items:center;gap:10px;padding:8px 10px;border:1px solid var(--border-soft);border-radius:10px;background:var(--settings-bg-var-row);transition:background 0.3s ease,border-color 0.3s ease}.var-key[data-v-e1f9e9e0]{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;color:var(--text-subtitle);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:color 0.3s ease}.var-editor[data-v-e1f9e9e0]{display:flex;align-items:center;gap:8px}.ipt[data-v-e1f9e9e0]{width:100%;padding:8px 10px;border-radius:8px;border:1px solid var(--settings-border-input);background:var(--bg-solid);font-size:12px;color:var(--settings-text-input);box-shadow:var(--settings-shadow-inset);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.ta[data-v-e1f9e9e0]{min-height:64px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}.type-chip[data-v-e1f9e9e0]{font-size:11px;color:var(--text-subtitle);background:var(--settings-bg-type-chip);border:1px solid var(--settings-border-type-chip);border-radius:999px;padding:4px 8px;white-space:nowrap;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.switch[data-v-e1f9e9e0]{position:relative;width:42px;height:24px;display:inline-block}.switch input[data-v-e1f9e9e0]{opacity:0;width:0;height:0}.switch .track[data-v-e1f9e9e0]{position:absolute;inset:0;border-radius:999px;background:var(--settings-bg-switch-track);box-shadow:var(--settings-shadow-inset);transition:background 0.2s ease}.switch .track[data-v-e1f9e9e0]::after{content:\'\';position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:var(--settings-bg-switch-handle);box-shadow:var(--settings-shadow-switch-handle);transition:transform 0.2s ease,background 0.3s ease}.switch input:checked+.track[data-v-e1f9e9e0]{background:var(--settings-bg-switch-checked)}.switch input:checked+.track[data-v-e1f9e9e0]::after{transform:translateX(18px)}.hint[data-v-e1f9e9e0]{font-size:11px;color:var(--text-normal);transition:color 0.3s ease}.hint.ok[data-v-e1f9e9e0]{color:var(--settings-text-hint-ok)}.hint.bad[data-v-e1f9e9e0]{color:var(--settings-text-hint-bad)}.placeholder[data-v-e1f9e9e0]{padding:10px;color:var(--text-normal);font-size:12px;border:1px dashed var(--border-dashed);border-radius:10px;background:var(--bg-placeholder);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/RightRailContent/EraSettingsPanel.vue'],names:[],mappings:'AAiSA,gCAEE,UAAW,CACX,YAAa,CACb,mCAAoC,CACpC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,mEAAqE,CACrE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAGA,8BAEE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,gBAAiB,CACjB,kBAAmB,CACnB,mCAAoC,CACpC,yBAA0B,CAC1B,uBAAwB,CACxB,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,4DAA8D,CAC9D,+GAMF,CACA,oCACE,0BAA2B,CAC3B,kEACF,CACA,wBACE,mBACF,CACA,uBACE,WACF,CAGA,0BACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAGA,0BACE,YAAa,CACb,kBAAmB,CACnB,OACF,CACA,yBACE,MACF,CAEA,2BAEE,gBAAiB,CACjB,iBAAkB,CAClB,qCAAsC,CACtC,yBAA0B,CAC1B,wBAAyB,CACzB,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,sEAAwE,CACxE,+GAMF,CACA,iCACE,0BAA2B,CAC3B,4EACF,CACA,mCACE,yCAA0C,CAC1C,+CAAgD,CAChD,sCACF,CACA,kCACE,wCAAyC,CACzC,yCACF,CAGA,uBACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,0BAEE,YAAa,CACb,kDAAoD,CACpD,kBAAmB,CACnB,QAAS,CACT,gBAAiB,CACjB,mCAAoC,CACpC,kBAAmB,CACnB,qCAAsC,CACtC,sDAGF,CACA,0BACE,gEAAqE,CACrE,cAAe,CACf,0BAA2B,CAC3B,eAAgB,CAChB,sBAAuB,CACvB,kBAAmB,CACnB,0BACF,CACA,6BACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,sBAEE,UAAW,CACX,gBAAiB,CACjB,iBAAkB,CAClB,6CAA8C,CAC9C,0BAA2B,CAC3B,cAAe,CACf,gCAAiC,CACjC,uCAAwC,CACxC,sEAIF,CACA,qBACE,eAAgB,CAChB,gEACF,CAEA,4BAEE,cAAe,CACf,0BAA2B,CAC3B,uCAAwC,CACxC,iDAAkD,CAClD,mBAAoB,CACpB,eAAgB,CAChB,kBAAmB,CACnB,sEAIF,CAGA,yBACE,iBAAkB,CAClB,UAAW,CACX,WAAY,CACZ,oBACF,CACA,+BACE,SAAU,CACV,OAAQ,CACR,QACF,CACA,gCACE,iBAAkB,CAClB,OAAQ,CACR,mBAAoB,CACpB,0CAA2C,CAC3C,uCAAwC,CACxC,+BACF,CACA,uCACE,UAAW,CACX,iBAAkB,CAClB,OAAQ,CACR,QAAS,CACT,UAAW,CACX,WAAY,CACZ,iBAAkB,CAClB,2CAA4C,CAC5C,+CAAgD,CAChD,mDAGF,CACA,8CACE,4CACF,CACA,qDACE,0BACF,CAEA,uBACE,cAAe,CACf,wBAAyB,CACzB,0BACF,CACA,0BACE,kCACF,CACA,2BACE,mCACF,CAEA,8BACE,YAAa,CACb,wBAAyB,CACzB,cAAe,CACf,sCAAuC,CACvC,kBAAmB,CACnB,gCAAiC,CACjC,sEAIF',sourcesContent:['<template>\n  \x3c!-- å¤–å±‚å¡ç‰‡ï¼šä¸ ActionButtons ä¿æŒä¸€è‡´çš„ç»ç’ƒå¡é£æ ¼ï¼Œä½†é»˜è®¤æ”¶èµ· --\x3e\n  <section class="settings-card" role="region" aria-label="ERA è®¾ç½®">\n    \x3c!-- è®¾ç½®å¡ç‰‡å®¹å™¨ --\x3e\n    \x3c!-- æ ‡é¢˜è¡Œï¼šå¯ç‚¹å‡»æŠ˜å /å±•å¼€ --\x3e\n    <button class="card-header" :aria-expanded="isOpen" @click="onToggle">\n      \x3c!-- ç‚¹å‡»åˆ‡æ¢å±•å¼€çŠ¶æ€ --\x3e\n      <span class="title">ERA è®¾ç½®</span>\n      \x3c!-- æ ‡é¢˜æ–‡å­— --\x3e\n      <span class="chev" aria-hidden="true">{{ isOpen ? \'â–¾\' : \'â–¸\' }}</span>\n      \x3c!-- å±•å¼€ç®­å¤´ --\x3e\n    </button>\n\n    \x3c!-- å†…å®¹ä½“ï¼šé»˜è®¤æ”¶èµ·ï¼›å±•å¼€åæ˜¾ç¤ºå˜é‡åˆ—è¡¨ä¸æ“ä½œ --\x3e\n    <div v-show="isOpen" class="content">\n      \x3c!-- å±•å¼€å†…å®¹å®¹å™¨ --\x3e\n      \x3c!-- é¡¶éƒ¨æ“ä½œåŒºï¼šåˆ·æ–°/ä¿å­˜/é‡ç½®ç¼–è¾‘ --\x3e\n      <div class="toolbar">\n        \x3c!-- å·¥å…·æ¡ --\x3e\n        <button class="mini-btn" title="é‡æ–°è¯»å–è„šæœ¬å˜é‡" @click.stop="loadVars">ğŸ”„ é‡æ–°è¯»å–</button>\n        \x3c!-- è¯»å–æŒ‰é’® --\x3e\n        <div class="spacer"></div>\n        \x3c!-- å ä½æ’‘å¼€ --\x3e\n        <button class="mini-btn subtle" title="ä¸¢å¼ƒæœªä¿å­˜çš„ä¿®æ”¹" @click.stop="discardEdits">â†©ï¸ ä¸¢å¼ƒä¿®æ”¹</button>\n        \x3c!-- ä¸¢å¼ƒç¼–è¾‘ --\x3e\n        <button class="mini-btn primary" title="ä¿å­˜ä¿®æ”¹åˆ°è„šæœ¬å˜é‡" @click.stop="saveEdits">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>\n        \x3c!-- ä¿å­˜ä¿®æ”¹ --\x3e\n      </div>\n\n      \x3c!-- å˜é‡åˆ—è¡¨ï¼šé€é¡¹æ¸²æŸ“ --\x3e\n      <div class="vars">\n        <template v-if="rows.length > 0">\n          \x3c!-- æœ‰å˜é‡æ—¶æ¸²æŸ“åˆ—è¡¨ --\x3e\n          <div v-for="row in rows" :key="row.key" class="var-row">\n            \x3c!-- æ¯ä¸ªå˜é‡ä¸€è¡Œ --\x3e\n            <label class="var-key" :title="row.key">{{ row.key }}</label>\n            \x3c!-- å˜é‡å --\x3e\n            \x3c!-- æ ¹æ®å˜é‡ç±»å‹é€‰æ‹©ä¸åŒçš„ç¼–è¾‘æ§ä»¶ --\x3e\n            <div class="var-editor">\n              \x3c!-- ç¼–è¾‘å™¨å®¹å™¨ --\x3e\n              \x3c!-- å¸ƒå°”ï¼šå‹¾é€‰æ¡† --\x3e\n              <template v-if="row.type === \'boolean\'">\n                <label class="switch">\n                  \x3c!-- è‡ªå®šä¹‰å¼€å…³å¤–è§‚ --\x3e\n                  <input v-model="edits[row.key]" type="checkbox" />\n                  \x3c!-- å‹¾é€‰å€¼ --\x3e\n                  <span class="track"></span>\n                  \x3c!-- è½¨é“ --\x3e\n                </label>\n              </template>\n\n              \x3c!-- æ•°å­—ï¼šnumber è¾“å…¥ --\x3e\n              <template v-else-if="row.type === \'number\'">\n                <input v-model.number="edits[row.key]" type="number" class="ipt" :placeholder="String(row.value)" />\n                \x3c!-- æ•°å­—è¾“å…¥ --\x3e\n              </template>\n\n              \x3c!-- å­—ç¬¦ä¸²ï¼štext è¾“å…¥ --\x3e\n              <template v-else-if="row.type === \'string\'">\n                <input v-model="edits[row.key]" type="text" class="ipt" :placeholder="String(row.value)" />\n                \x3c!-- æ–‡æœ¬è¾“å…¥ --\x3e\n              </template>\n\n              \x3c!-- å…¶ä»–ï¼ˆå¯¹è±¡/æ•°ç»„/null/æœªçŸ¥ï¼‰ï¼šJSON æ–‡æœ¬åŸŸ --\x3e\n              <template v-else>\n                <textarea\n                  v-model="jsonBuffers[row.key]"\n                  class="ipt ta"\n                  :placeholder="safeStringify(row.value)"\n                  @input="markJsonTouched(row.key)"\n                ></textarea>\n                \x3c!-- JSON æ–‡æœ¬åŸŸ --\x3e\n                <span class="hint" :class="{ ok: jsonState[row.key]?.ok, bad: jsonState[row.key]?.bad }">{{\n                  jsonState[row.key]?.msg ?? \'ä»¥ JSON æ ¼å¼ç¼–è¾‘æ­¤å€¼\'\n                }}</span>\n                \x3c!-- JSON æ ¡éªŒæç¤º --\x3e\n              </template>\n            </div>\n            \x3c!-- ç±»å‹å¾½æ ‡ --\x3e\n            <span class="type-chip">{{ humanType(row.type) }}</span>\n            \x3c!-- ç±»å‹å±•ç¤º --\x3e\n          </div>\n        </template>\n\n        <template v-else>\n          \x3c!-- æ²¡æœ‰å˜é‡æ—¶çš„å ä½ --\x3e\n          <div class="placeholder">\n            <p>æœªè¯»å–åˆ°ä»»ä½•è„šæœ¬å˜é‡ã€‚</p>\n            \x3c!-- æ–‡æœ¬æç¤º --\x3e\n            <p class="dim">\n              è¯·å…ˆç¡®ä¿åœ¨ <code>app_ready</code> æˆ–åˆå§‹åŒ–é˜¶æ®µé€šè¿‡\n              <code>initializeExternalSettings()</code> å†™å…¥é»˜è®¤å˜é‡ã€‚\n            </p>\n            \x3c!-- è¾…åŠ©è¯´æ˜ --\x3e\n          </div>\n        </template>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\n/* å—å¤´ï¼šé€»è¾‘è¯´æ˜\n   - é»˜è®¤æ”¶èµ·ï¼Œå±•å¼€æ—¶è¯»å–è„šæœ¬åŸŸå˜é‡ï¼›\n   - æ”¯æŒ boolean/number/string/json å››ç±»ç¼–è¾‘ï¼›\n   - ä¿å­˜æ—¶æŒ‰åŸç±»å‹å›å†™åˆ°è„šæœ¬åŸŸã€‚\n*/\nimport { reactive, ref } from \'vue\'; // ä¸­æ–‡æ³¨é‡Šï¼šVue å“åº”å¼ API\nimport toastr from \'toastr\';\nimport { z } from \'zod\';\nimport { SettingsSchema } from \'../../../utils/constants\';\nimport { settings, updateScriptSettings } from \'../../../utils/era_data\';\nimport { Logger } from \'../../../utils/log\'; // ä¸­æ–‡æ³¨é‡Šï¼šé¡¹ç›®å†…æ—¥å¿—å·¥å…·\n\nconst logger = new Logger(); // ä¸­æ–‡æ³¨é‡Šï¼šå®ä¾‹åŒ–æ—¥å¿—\n\n// === æŠ˜å çŠ¶æ€ ===\nconst isOpen = ref(false); // ä¸­æ–‡æ³¨é‡Šï¼šæ˜¯å¦å±•å¼€\n\n// === åŸå§‹æ•°æ®ä¸ç¼–è¾‘ç¼“å­˜ ===\ntype Row = { key: string; value: any; type: \'boolean\' | \'number\' | \'string\' | \'json\' }; // ä¸­æ–‡æ³¨é‡Šï¼šä¸€è¡Œå˜é‡çš„ç»“æ„\nconst rows = ref<Row[]>([]); // ä¸­æ–‡æ³¨é‡Šï¼šå¯æ¸²æŸ“çš„å˜é‡è¡Œ\nconst edits = reactive<Record<string, any>>({}); // ä¸­æ–‡æ³¨é‡Šï¼šé’ˆå¯¹ç®€å•ç±»å‹çš„ç¼–è¾‘ç¼“å­˜ï¼ˆå¸ƒå°”/æ•°å­—/å­—ç¬¦ä¸²ï¼‰\nconst jsonBuffers = reactive<Record<string, string>>({}); // ä¸­æ–‡æ³¨é‡Šï¼šé’ˆå¯¹ JSON ç±»å‹çš„æ–‡æœ¬ç¼“å­˜\nconst jsonState = reactive<Record<string, { ok?: boolean; bad?: boolean; msg?: string }>>({}); // ä¸­æ–‡æ³¨é‡Šï¼šJSON æ ¡éªŒçŠ¶æ€\n\n// === å·¥å…·ï¼šç±»å‹åˆ¤å®šä¸äººç±»å¯è¯»å ===\nfunction detectType(v: any): Row[\'type\'] {\n  // ä¸­æ–‡æ³¨é‡Šï¼šæ£€æµ‹å˜é‡ç±»å‹\n  if (typeof v === \'boolean\') return \'boolean\'; // ä¸­æ–‡æ³¨é‡Šï¼šå¸ƒå°”\n  if (typeof v === \'number\' && Number.isFinite(v)) return \'number\'; // ä¸­æ–‡æ³¨é‡Šï¼šæœ‰é™æ•°\n  if (typeof v === \'string\') return \'string\'; // ä¸­æ–‡æ³¨é‡Šï¼šå­—ç¬¦ä¸²\n  return \'json\'; // ä¸­æ–‡æ³¨é‡Šï¼šå…¶ä»–ä¸€å¾‹å½’ä¸º jsonï¼ˆå¯¹è±¡/æ•°ç»„/null/ç‰¹æ®Šæ•°ç­‰ï¼‰\n}\nfunction humanType(t: Row[\'type\']): string {\n  // ä¸­æ–‡æ³¨é‡Šï¼šç±»å‹ä¸­æ–‡å\n  return t === \'boolean\' ? \'å¸ƒå°”\' : t === \'number\' ? \'æ•°å­—\' : t === \'string\' ? \'å­—ç¬¦ä¸²\' : \'JSON\'; // ä¸­æ–‡æ³¨é‡Šï¼šæ˜ å°„\n}\nfunction safeStringify(v: any): string {\n  // ä¸­æ–‡æ³¨é‡Šï¼šå®‰å…¨ JSON åºåˆ—åŒ–\n  try {\n    return JSON.stringify(v, null, 2);\n  } catch {\n    return String(v);\n  } // ä¸­æ–‡æ³¨é‡Šï¼šå¤±è´¥åˆ™è½¬å­—ç¬¦ä¸²\n}\n\n// === åŠ è½½å˜é‡åˆ—è¡¨ ===\nfunction loadVars() {\n  try {\n    logger.debug(\'loadVars\', \'å°è¯•è¯»å–è„šæœ¬è®¾ç½®...\');\n    const obj = settings.value;\n    logger.debug(\'loadVars\', \'æˆåŠŸè¯»å–è„šæœ¬è®¾ç½®:\', obj);\n\n    if (!obj || Object.keys(obj).length === 0) {\n      logger.warn(\'loadVars\', \'è®¾ç½®å¯¹è±¡ä¸ºç©ºï¼ŒUI å°†ä¸ä¼šè¢«å¡«å……ã€‚\');\n      rows.value = [];\n      toastr.info(\'æœªæ‰¾åˆ°ä»»ä½•è„šæœ¬å˜é‡ã€‚\');\n      return;\n    }\n\n    // æ¸…ç©ºæ—§ç¼“å­˜\n    rows.value = [];\n    for (const k of Object.keys(edits)) delete edits[k];\n    for (const k of Object.keys(jsonBuffers)) delete jsonBuffers[k];\n    for (const k of Object.keys(jsonState)) delete jsonState[k];\n\n    // æ„å»ºå¯ç¼–è¾‘è¡Œ\n    Object.entries(obj)\n      .filter(([key]) => key !== \'å¼€å¯æ‚¬æµ®çƒ\')\n      .forEach(([key, value]) => {\n        const t = detectType(value);\n        rows.value.push({ key, value, type: t });\n        if (t === \'json\') {\n          jsonBuffers[key] = safeStringify(value);\n        } else {\n          edits[key] = value;\n        }\n      });\n    toastr.success(\'å·²ä»è„šæœ¬å˜é‡ä¸­åŠ è½½æœ€æ–°è®¾ç½®ã€‚\', \'è¯»å–æˆåŠŸ\');\n  } catch (e) {\n    logger.error(\'loadVars\', \'è¯»å–è„šæœ¬å˜é‡å¤±è´¥:\', e);\n    toastr.error(\'è¯»å– ERA è®¾ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ã€‚\', \'è¯»å–å¤±è´¥\');\n  }\n}\n\n// === å±•å¼€æŠ˜å  ===\nfunction onToggle() {\n  // ä¸­æ–‡æ³¨é‡Šï¼šåˆ‡æ¢å±•å¼€\n  isOpen.value = !isOpen.value; // ä¸­æ–‡æ³¨é‡Šï¼šç¿»è½¬çŠ¶æ€\n  if (isOpen.value && rows.value.length === 0) loadVars(); // ä¸­æ–‡æ³¨é‡Šï¼šé¦–æ¬¡å±•å¼€æ—¶è¯»å–æ•°æ®\n}\n\n// === JSON æ–‡æœ¬åŸŸç¼–è¾‘æ ‡è®° + æ ¡éªŒ ===\nfunction markJsonTouched(key: string) {\n  // ä¸­æ–‡æ³¨é‡Šï¼šæ ‡è®° JSON æ–‡æœ¬æ”¹åŠ¨å¹¶æ ¡éªŒ\n  const txt = jsonBuffers[key] ?? \'\'; // ä¸­æ–‡æ³¨é‡Šï¼šè¯»å–æ–‡æœ¬\n  if (txt.trim() === \'\') {\n    // ä¸­æ–‡æ³¨é‡Šï¼šç©ºæ–‡æœ¬æç¤º\n    jsonState[key] = { bad: true, ok: false, msg: \'ä¸èƒ½ä¸ºç©ºï¼ˆè‹¥è¦è®¾ä¸º null è¯·å†™ nullï¼‰\' }; // ä¸­æ–‡æ³¨é‡Šï¼šç©ºæç¤º\n    return; // ä¸­æ–‡æ³¨é‡Šï¼šè¿”å›\n  }\n  try {\n    JSON.parse(txt);\n    jsonState[key] = { ok: true, bad: false, msg: \'JSON æ ¼å¼æœ‰æ•ˆ\' };\n  } catch (e: any) {\n    // ä¸­æ–‡æ³¨é‡Šï¼šæ ¡éªŒé€šè¿‡\n    jsonState[key] = { bad: true, ok: false, msg: `JSON æ ¼å¼é”™è¯¯ï¼š${e?.message ?? \'\'}` };\n  } // ä¸­æ–‡æ³¨é‡Šï¼šæ ¡éªŒå¤±è´¥\n}\n\n// === ä¸¢å¼ƒæœªä¿å­˜çš„ç¼–è¾‘ ===\nfunction discardEdits() {\n  // ä¸­æ–‡æ³¨é‡Šï¼šä¸¢å¼ƒç¼–è¾‘\n  logger.log(\'discardEdits\', \'ç‚¹å‡»â€œä¸¢å¼ƒä¿®æ”¹â€\');\n  loadVars(); // ä¸­æ–‡æ³¨é‡Šï¼šé‡æ–°è¯»å–è¦†ç›–æœ¬åœ°æ”¹åŠ¨\n  toastr.info(\'æ‰€æœ‰æœªä¿å­˜çš„ä¿®æ”¹å·²è¢«ä¸¢å¼ƒã€‚\', \'æ“ä½œå®Œæˆ\');\n}\n\n// === ä¿å­˜ä¿®æ”¹ ===\nasync function saveEdits() {\n  // ä¸­æ–‡æ³¨é‡Šï¼šä¿å­˜åˆ°è„šæœ¬åŸŸ\n  const originalRows = JSON.parse(JSON.stringify(rows.value)); // æ·±æ‹·è´åŸå§‹æ•°æ®ç”¨äºå›æ»š\n\n  try {\n    // 1. ä¹è§‚æ›´æ–° UI\n    const updatedSettings: Record<string, any> = {};\n    rows.value.forEach(row => {\n      if (row.type === \'json\') {\n        if (jsonState[row.key]?.bad) {\n          throw new Error(`é”® ${row.key} çš„ JSON æ ¼å¼ä¸æ­£ç¡®`);\n        }\n        if (jsonBuffers[row.key] != null) {\n          const newValue = JSON.parse(jsonBuffers[row.key]);\n          row.value = newValue;\n          updatedSettings[row.key] = newValue;\n        }\n      } else if (edits[row.key] !== undefined) {\n        row.value = edits[row.key];\n        updatedSettings[row.key] = edits[row.key];\n      }\n    });\n    toastr.success(\'ç•Œé¢å·²æ›´æ–°ã€‚æ­£åœ¨åå°ä¿å­˜...\', \'æ“ä½œæˆåŠŸ\');\n\n    // 2. å¼‚æ­¥åå°ä¿å­˜\n    await updateScriptSettings(currentSettings => {\n      const next: z.infer<typeof SettingsSchema> = { ...currentSettings };\n\n      // åˆå¹¶ç®€å•ç±»å‹çš„æ”¹åŠ¨ï¼ˆå¸ƒå°”/æ•°å­—/å­—ç¬¦ä¸²ï¼‰\n      Object.entries(edits).forEach(([k, v]) => {\n        const key = k as keyof z.infer<typeof SettingsSchema>;\n        (next as any)[key] = v;\n      });\n\n      // åˆå¹¶ JSON æ–‡æœ¬æ”¹åŠ¨ï¼ˆéœ€å…ˆé€šè¿‡æ ¡éªŒï¼‰\n      Object.entries(jsonBuffers).forEach(([k, txt]) => {\n        if (txt != null) {\n          if (jsonState[k]?.bad) throw new Error(`é”® ${k} çš„ JSON æ ¼å¼ä¸æ­£ç¡®`);\n          const key = k as keyof z.infer<typeof SettingsSchema>;\n          (next as any)[key] = JSON.parse(txt);\n        }\n      });\n\n      return next;\n    });\n\n    logger.log(\'saveEdits\', \'è„šæœ¬å˜é‡å·²ä¿å­˜\');\n    toastr.success(\'è®¾ç½®å·²æˆåŠŸä¿å­˜åˆ°è„šæœ¬å˜é‡ã€‚\', \'ä¿å­˜æˆåŠŸ\');\n    window.dispatchEvent(new CustomEvent(\'era-settings-updated\'));\n    // ä¹è§‚æ›´æ–°æˆåŠŸï¼Œä¸éœ€è¦å† loadVars()\n  } catch (e) {\n    logger.error(\'saveEdits\', \'ä¿å­˜å¤±è´¥ï¼š\', e);\n    toastr.error(`ä¿å­˜å¤±è´¥ï¼š${(e as any)?.message ?? e}ã€‚æ­£åœ¨å›æ»šç•Œé¢ã€‚`, \'ä¿å­˜å¤±è´¥\');\n    // 3. é”™è¯¯å¤„ç†ï¼šå›æ»š UI\n    rows.value = originalRows;\n    // é‡æ–°å¡«å…… edits å’Œ jsonBuffers ä»¥åŒ¹é…å›æ»šåçš„ UI\n    originalRows.forEach((row: Row) => {\n      if (row.type === \'json\') {\n        jsonBuffers[row.key] = safeStringify(row.value);\n      } else {\n        edits[row.key] = row.value;\n      }\n    });\n  }\n}\n<\/script>\n\n<style scoped>\n/* === å¤–å±‚å¡ç‰‡å®¹å™¨ï¼ˆä¸ ActionButtons ä¿æŒåŒç³»å¤–è§‚ï¼‰ === */\n.settings-card {\n  /* ç»ç’ƒå¡å®¹å™¨ */\n  width: 100%; /* å æ»¡ä¾§æ å®½åº¦ */\n  padding: 12px; /* å†…è¾¹è· */\n  background: var(--settings-bg-glass);\n  border: 1px solid var(--border-strong);\n  border-radius: 16px; /* åœ†è§’ */\n  backdrop-filter: blur(10px); /* æ¯›ç»ç’ƒ */\n  box-shadow: var(--settings-shadow-card), var(--settings-shadow-inset);\n  display: flex; /* çºµå‘å¸ƒå±€ */\n  flex-direction: column; /* å‚ç›´æ’å¸ƒ */\n  gap: 10px; /* é—´è· */\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n/* æ ‡é¢˜æŒ‰é’®ï¼šæ”¶èµ·/å±•å¼€æ§åˆ¶ */\n.card-header {\n  /* æ ‡é¢˜è¡ŒæŒ‰é’® */\n  display: flex; /* æ¨ªå‘å¸ƒå±€ */\n  align-items: center; /* å‚ç›´å±…ä¸­ */\n  justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */\n  padding: 8px 10px; /* å†…è¾¹è· */\n  border-radius: 10px; /* åœ†è§’ */\n  border: 1px solid var(--border-soft);\n  background: var(--chip-bg);\n  color: var(--text-title);\n  font-weight: 800; /* åŠ ç²— */\n  font-size: 13px; /* å­—å· */\n  cursor: pointer; /* å¯ç‚¹ */\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease,\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n.card-header:hover {\n  transform: translateY(-1px);\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button-hover);\n} /* æ‚¬åœæ€ */\n.title {\n  pointer-events: none;\n} /* é¿å…å­å…ƒç´ æˆªè·ç‚¹å‡» */\n.chev {\n  opacity: 0.7;\n} /* ç®­å¤´æ·¡åŒ– */\n\n/* å†…å®¹ä½“ */\n.content {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n} /* å†…å®¹å®¹å™¨ */\n\n/* å·¥å…·æ¡ */\n.toolbar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n} /* å·¥å…·æ¡å¸ƒå±€ */\n.spacer {\n  flex: 1;\n} /* å³å¯¹é½æŒ‰é’®ç”¨ */\n\n.mini-btn {\n  /* é€šç”¨å°æŒ‰é’® */\n  padding: 6px 10px; /* å†…è¾¹è· */\n  border-radius: 8px; /* åœ†è§’ */\n  border: 1px solid var(--border-normal);\n  background: var(--chip-bg);\n  color: var(--text-normal);\n  cursor: pointer; /* å¯ç‚¹å‡» */\n  font-size: 12px; /* å­—å· */\n  font-weight: 700; /* åŠ ç²— */\n  box-shadow: var(--settings-shadow-inset), var(--settings-shadow-minibtn);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease,\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n.mini-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: var(--settings-shadow-inset), var(--settings-shadow-minibtn-hover);\n} /* æ‚¬åœ */\n.mini-btn.primary {\n  background: var(--settings-bg-btn-primary);\n  border-color: var(--settings-border-btn-primary);\n  color: var(--settings-text-primary-btn);\n} /* ä¸»è¦ */\n.mini-btn.subtle {\n  background: var(--settings-bg-btn-subtle);\n  border-color: var(--settings-border-input);\n} /* æ¬¡è¦ */\n\n/* å˜é‡åˆ—è¡¨ */\n.vars {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n} /* åˆ—è¡¨å®¹å™¨ */\n\n.var-row {\n  /* ä¸€è¡Œå˜é‡ */\n  display: grid; /* ç½‘æ ¼å¸ƒå±€ */\n  grid-template-columns: 1fr minmax(120px, 1.2fr) auto; /* ä¸‰åˆ—ï¼šé”® / ç¼–è¾‘å™¨ / ç±»å‹ */\n  align-items: center; /* å‚ç›´å±…ä¸­ */\n  gap: 10px; /* åˆ—é—´è· */\n  padding: 8px 10px; /* å†…è¾¹è· */\n  border: 1px solid var(--border-soft);\n  border-radius: 10px; /* åœ†è§’ */\n  background: var(--settings-bg-var-row);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n.var-key {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\n  font-size: 12px;\n  color: var(--text-subtitle);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  transition: color 0.3s ease;\n} /* é”®åæ ·å¼ */\n.var-editor {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n} /* ç¼–è¾‘å™¨å®¹å™¨ */\n\n.ipt {\n  /* é€šç”¨è¾“å…¥æ¡† */\n  width: 100%; /* æ‹‰æ»¡å¯ç”¨å®½åº¦ */\n  padding: 8px 10px; /* å†…è¾¹è· */\n  border-radius: 8px; /* åœ†è§’ */\n  border: 1px solid var(--settings-border-input);\n  background: var(--bg-solid);\n  font-size: 12px; /* å­—å· */\n  color: var(--settings-text-input);\n  box-shadow: var(--settings-shadow-inset);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n.ta {\n  min-height: 64px;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\n} /* JSON æ–‡æœ¬åŸŸ */\n\n.type-chip {\n  /* ç±»å‹æ ‡ç­¾ */\n  font-size: 11px; /* å­—å· */\n  color: var(--text-subtitle);\n  background: var(--settings-bg-type-chip);\n  border: 1px solid var(--settings-border-type-chip);\n  border-radius: 999px; /* èƒ¶å›Š */\n  padding: 4px 8px; /* å†…è¾¹è· */\n  white-space: nowrap; /* ä¸æ¢è¡Œ */\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n\n/* è‡ªå®šä¹‰å¼€å…³ï¼ˆå¸ƒå°”ï¼‰ */\n.switch {\n  position: relative;\n  width: 42px;\n  height: 24px;\n  display: inline-block;\n} /* å¼€å…³å®¹å™¨ */\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n} /* éšè—åŸç”Ÿæ¡† */\n.switch .track {\n  position: absolute;\n  inset: 0;\n  border-radius: 999px;\n  background: var(--settings-bg-switch-track);\n  box-shadow: var(--settings-shadow-inset);\n  transition: background 0.2s ease;\n} /* è½¨é“ */\n.switch .track::after {\n  content: \'\';\n  position: absolute;\n  top: 3px;\n  left: 3px;\n  width: 18px;\n  height: 18px;\n  border-radius: 50%;\n  background: var(--settings-bg-switch-handle);\n  box-shadow: var(--settings-shadow-switch-handle);\n  transition:\n    transform 0.2s ease,\n    background 0.3s ease;\n} /* æ‹–å¤´ */\n.switch input:checked + .track {\n  background: var(--settings-bg-switch-checked);\n} /* é€‰ä¸­è½¨é“è‰² */\n.switch input:checked + .track::after {\n  transform: translateX(18px);\n} /* æ‹–å¤´å³ç§» */\n\n.hint {\n  font-size: 11px;\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n} /* JSON æç¤º */\n.hint.ok {\n  color: var(--settings-text-hint-ok);\n} /* é€šè¿‡æç¤ºè‰² */\n.hint.bad {\n  color: var(--settings-text-hint-bad);\n} /* é”™è¯¯æç¤ºè‰² */\n\n.placeholder {\n  padding: 10px;\n  color: var(--text-normal);\n  font-size: 12px;\n  border: 1px dashed var(--border-dashed);\n  border-radius: 10px;\n  background: var(--bg-placeholder);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n} /* ç©ºçŠ¶æ€ */\n</style>\n'],sourceRoot:''}]);const i=o},238:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.era-app-container{position:fixed;inset:0;z-index:2147483646;pointer-events:none;isolation:isolate;contain:layout style paint;width:100svw;height:100svh}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/App.vue'],names:[],mappings:'AAmEA,mBAEE,cAAe,CACf,OAAQ,CACR,kBAAmB,CACnB,mBAAoB,CACpB,iBAAkB,CAClB,0BAA2B,CAC3B,YAAa,CACb,aACF',sourcesContent:['<template>\n  <div class="era-app-container" :class="{ \'dark-theme\': isDarkMode }">\n    <ThemeManager ref="themeManager" />\n    <FloatingBall v-show="currentComponent === \'FloatingBall\'" @click="requestSwitchView(\'ExpandedView\')" />\n    <div v-show="currentComponent === \'ExpandedView\'" class="era-expanded-layer">\n      \x3c!-- è§†å£çº§å±•å¼€å±‚ï¼šæ‚¬æµ®æ¨¡æ€å®¹å™¨ --\x3e\n      <div class="era-shell">\n        \x3c!-- æ–°å¢æ¨ªå‘å£³å®¹å™¨ï¼šå·¦é¢æ¿ + å³ä¾§æ  --\x3e\n        <EraPanel :data="dataRef" />\n        <RightRail />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { storeToRefs } from \'pinia\';\nimport { onBeforeUnmount, onMounted, ref } from \'vue\';\nimport { settings } from \'../utils/era_data\';\nimport { Logger } from \'../utils/log\';\nimport EraPanel from \'./components/EraPanel.vue\';\nimport FloatingBall from \'./components/FloatingBall.vue\';\nimport RightRail from \'./components/RightRail.vue\';\nimport ThemeManager from \'./components/ThemeManager.vue\';\nimport { useUiStore } from \'./store\';\n\nconst logger = new Logger();\n\n// ä» Pinia store è·å–çŠ¶æ€å’Œ action\nconst uiStore = useUiStore();\nconst { currentView: currentComponent, eventData: dataRef } = storeToRefs(uiStore);\n\n// ä¸»é¢˜çŠ¶æ€ç®¡ç†\nconst themeManager = ref<InstanceType<typeof ThemeManager> | null>(null);\nconst isDarkMode = ref(false);\n\nconst loadThemeSetting = () => {\n  try {\n    const darkModeValue = settings.value?.[\'å¼€å¯é»‘å¤œæ¨¡å¼\'] ?? false;\n    isDarkMode.value = darkModeValue;\n    if (themeManager.value) {\n      themeManager.value.isDarkMode = darkModeValue;\n    }\n    logger.debug(\'loadThemeSetting\', `ä¸»é¢˜å·²æ›´æ–°ä¸º: ${darkModeValue ? \'Dark\' : \'Light\'}`);\n  } catch (e) {\n    logger.error(\'loadThemeSetting\', \'åŠ è½½ä¸»é¢˜è®¾ç½®å¤±è´¥\', e);\n    isDarkMode.value = false; // Fallback to light mode\n  }\n};\n\nonMounted(() => {\n  loadThemeSetting();\n  window.addEventListener(\'era-settings-updated\', loadThemeSetting);\n});\n\nonBeforeUnmount(() => {\n  window.removeEventListener(\'era-settings-updated\', loadThemeSetting);\n});\n\nconst requestSwitchView = (viewName: \'FloatingBall\' | \'ExpandedView\') => {\n  logger.debug(\'requestSwitchView\', `è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${viewName}`);\n  uiStore.switchView(viewName);\n};\n<\/script>\n\n<style>\n/* App.vue è§†å£çº§æ‚¬æµ®å®¹å™¨ï¼ˆæ›¿æ¢åŸæœ‰ .era-app-containerï¼‰ */\n.era-app-container {\n  /* ä½œä¸ºå…¨å±€æ‚¬æµ®å±‚æ ¹å®¹å™¨ */\n  position: fixed; /* å›ºå®šåœ¨è§†å£ï¼Œä¸å—å¤–å±‚å¸ƒå±€å½±å“ */\n  inset: 0; /* è¦†ç›–æ•´ä¸ªè§†å£åŒºåŸŸï¼ˆtop/right/bottom/left å…¨ 0ï¼‰ */\n  z-index: 2147483646; /* è¶…é«˜å±‚çº§ï¼Œç›–ä½ç«™ç‚¹å…¶å®ƒå±‚ */\n  pointer-events: none; /* é»˜è®¤ä¸æˆªè·ç‚¹å‡»ï¼Œé¿å…é˜»æŒ¡é¡µé¢ */\n  isolation: isolate; /* æ–°å»ºç‹¬ç«‹å±‚å ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢è¢«å¤–å±‚æ··åˆå½±å“ */\n  contain: layout style paint; /* åˆ›å»ºæ¸²æŸ“å°è£…ï¼Œå‡å°‘å¤–ç•Œå¹²æ‰° */\n  width: 100svw; /* é€‚é…ç§»åŠ¨ç«¯åŠ¨æ€è§†å£å®½åº¦ */\n  height: 100svh; /* é€‚é…ç§»åŠ¨ç«¯åŠ¨æ€è§†å£é«˜åº¦ */\n}\n</style>\n\n<style scoped>\n/* ä» EraDataPanel.vue è¿ç§»è¿‡æ¥çš„æ ·å¼ */\n\n/* ===[æ–°å¢] æ¨ªå‘å£³ï¼šå·¦é¢æ¿ + å³ä¾§æ ï¼ˆæŒ‰é’®ï¼‰=== */\n.era-shell {\n  /* æ¨ªå‘åŒ…è£¹å®¹å™¨ */ /* ä¸­æ–‡æ³¨é‡Šï¼šæ¨ªå‘æ’åˆ—å®¹å™¨ */\n  display: flex; /* æ¨ªå‘å¸ƒå±€ */ /* ä¸­æ–‡æ³¨é‡Šï¼šflex æ¨ªæ’ */\n  align-items: flex-start; /* é¡¶å¯¹é½ */ /* ä¸­æ–‡æ³¨é‡Šï¼šä¸Šç¼˜å¯¹é½ */\n  gap: 12px; /* å·¦å³é—´è· */ /* ä¸­æ–‡æ³¨é‡Šï¼šå…ƒç´ é—´è· */\n  flex-wrap: nowrap; /* é»˜è®¤ä¸æ¢è¡Œ */ /* ä¸­æ–‡æ³¨é‡Šï¼šä¿æŒå¹¶æ’ */\n}\n\n/* ä¿æŒé¢æ¿å®½é«˜ï¼ˆåŸæ ·ï¼‰ï¼Œä½†è®©å®ƒæ›´å¥½åœ°åœ¨æ¨ªå‘ä¸­è‡ªé€‚åº” */\n:deep(.era-panel) {\n  flex: 0 1 auto; /* é¢æ¿æŒ‰è‡ªèº«å®½åº¦å¸ƒå±€ */\n}\n\n/* å°å±å›è½ï¼šæ”¹ä¸ºä¸Šä¸‹å †å ï¼ˆæŒ‰é’®åœ¨ä¸‹ï¼‰ */\n@media (max-width: 992px) {\n  /* 992px (å¹³æ¿) ä»¥ä¸‹å›è½ */\n  .era-shell {\n    flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n  }\n  :deep(.era-panel),\n  :deep(.right-rail) {\n    width: 100%; /* å„å ä¸€è¡Œ */\n    flex-basis: auto; /* é‡ç½® flex-basis */\n  }\n  :deep(.right-rail) {\n    position: static; /* å–æ¶ˆå¸é¡¶ */\n    margin-top: 12px; /* ä¸ä¸Šæ–¹ç•™ç™½ */\n    height: auto; /* é«˜åº¦è‡ªé€‚åº” */\n    max-height: 40vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œé¿å…è¿‡é•¿ */\n  }\n}\n\n/* ===[æ–°å¢] æ‚¬æµ®çƒï¼šå›ºå®šåœ¨å³ä¸‹è§’ + å¼€å¯ç‚¹å‡» === */\n:deep(.floating-ball) {\n  /* é€‰ä¸­å­ç»„ä»¶æ ¹å…ƒç´ ï¼ˆscoped ä¸‹ç”¨ deepï¼‰ */\n  position: fixed; /* å›ºå®šå®šä½åˆ°è§†å£ */\n  right: max(16px, env(safe-area-inset-right)); /* å³ä¾§å®‰å…¨åŒº + åŸºç¡€è¾¹è· */\n  bottom: max(90px, env(safe-area-inset-bottom)); /* åº•éƒ¨å®‰å…¨åŒº + åŸºç¡€è¾¹è· */\n  z-index: 2147483647; /* é«˜äºå®¹å™¨æ ¹ï¼Œç¡®ä¿å§‹ç»ˆå¯ç‚¹ */\n  pointer-events: auto; /* å¯ç”¨ç‚¹å‡»ï¼ˆçˆ¶å®¹å™¨æ˜¯ noneï¼‰ */\n  touch-action: manipulation; /* ç§»åŠ¨ç«¯å‡å°‘ç‚¹å‡»å»¶è¿Ÿ */\n  will-change: transform; /* æå‰åˆ†å±‚ï¼Œé¿å…ç«™ç‚¹ 3D/æ»¤é•œå½±å“ */\n}\n\n/* ===[æ–°å¢] å±•å¼€å±‚ï¼šè§†å£çº§æ¨¡æ€å®¹å™¨ï¼ˆåªåœ¨ ExpandedView v-show ä¸º true æ—¶å­˜åœ¨ï¼‰ === */\n.era-expanded-layer {\n  /* ç»‘å®šåœ¨æ¨¡æ¿æ–°å¢çš„ class */\n  position: fixed; /* å›ºå®šåœ¨è§†å£ï¼ˆä¸å—å¤–å±‚å¸ƒå±€çº¦æŸï¼‰ */\n  inset: 0; /* é“ºæ»¡è§†å£ */\n  display: grid; /* ç”¨ grid å±…ä¸­å†…å®¹ */\n  place-items: center; /* æ°´å¹³å‚ç›´ç½®ä¸­ */\n  padding: clamp(12px, 2.5vw, 24px); /* è§†å£è‡ªé€‚åº”å†…è¾¹è· */\n  pointer-events: auto; /* å¯ç”¨ç‚¹å‡»ï¼ˆä¸çˆ¶å®¹å™¨çš„ none åŒºåˆ†ï¼‰ */\n  z-index: 2147483646; /* ä»…æ¬¡äºæ‚¬æµ®çƒï¼Œä¿è¯åœ¨æœ€ä¸Šå±‚ */\n  background: transparent; /* å¦‚éœ€åŠé€æ˜é®ç½©å¯æ”¹ä¸º rgba(0,0,0,.25) */\n  overflow: auto; /* å†…å®¹è¶…å‡ºæ—¶ï¼Œå®¹å™¨è‡ªèº«æ»šåŠ¨ï¼Œä¸è¢«è£å‰ª */\n}\n\n/* ===[æ–°å¢] å°å±é€‚é…ï¼šé¢æ¿åœ¨ç§»åŠ¨ç«¯æ›´â€œå¡«å……â€å¯è§†åŒº === */\n@media (max-width: 640px) {\n  /* é’ˆå¯¹æ‰‹æœºå®½åº¦ */\n  :deep(.era-panel) {\n    /* é‡è®¾é¢æ¿å®½é«˜æ›´è´´åˆæ‰‹æœº */\n    width: min(92vw, 560px); /* æ”¾å®½åˆ° 92vwï¼Œé¿å… 60vw å¤ªçª„ */\n    height: min(88vh, calc(100svh - 32px)); /* å…¼é¡¾çŠ¶æ€æ /åœ°å€æ åŠ¨æ€é«˜åº¦ */\n  }\n  .panel-body {\n    /* ä¸»è¦å†…å®¹åŒºæ»šåŠ¨å®¹å™¨ */\n    overscroll-behavior: contain; /* é˜²æ­¢æ»šåŠ¨ç‰µåŠ¨èƒŒæ™¯é¡µé¢ */\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=o},301:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.era-panel[data-v-1e3782f8]{flex:2 1 600px;min-width:320px;height:min(680px,86vh);display:flex;flex-direction:column;background:var(--bg-blur-heavy);border:1px solid var(--border-strong);backdrop-filter:blur(10px);border-radius:16px;box-shadow:var(--shadow-panel),var(--shadow-inset);overflow:hidden;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;transition:background 0.3s ease,border-color 0.3s ease}.panel-top[data-v-1e3782f8]{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border-soft);background:var(--bg-blur-light);transition:background 0.3s ease,border-color 0.3s ease}.panel-title[data-v-1e3782f8]{font-size:16px;font-weight:800;letter-spacing:0.5px;color:var(--text-title);transition:color 0.3s ease}.btn-close[data-v-1e3782f8]{width:32px;height:32px;line-height:30px;text-align:center;border-radius:8px;border:1px solid var(--border-normal);background:var(--bg-solid);cursor:pointer;font-size:18px;color:var(--text-normal);box-shadow:var(--shadow-button);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.btn-close[data-v-1e3782f8]:hover{transform:translateY(-1px);box-shadow:var(--shadow-button-hover)}.panel-body[data-v-1e3782f8]{padding:0;overflow:hidden;flex-grow:1;display:flex;flex-direction:column}.panel-content-wrapper[data-v-1e3782f8]{padding:14px 14px 16px;overflow-y:auto;flex-grow:1}.panel-content-wrapper[data-v-1e3782f8]>*+*{margin-top:12px}.empty[data-v-1e3782f8]{height:100%;display:grid;place-items:center;color:var(--text-normal);font-size:14px;border:1px dashed var(--border-dashed);border-radius:12px;background:var(--bg-empty);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/EraPanel.vue'],names:[],mappings:'AAoDA,4BACE,cAAe,CACf,eAAgB,CAChB,sBAAwB,CACxB,YAAa,CACb,qBAAsB,CACtB,+BAAgC,CAChC,qCAAsC,CACtC,0BAA2B,CAC3B,kBAAmB,CACnB,kDAAoD,CACpD,eAAgB,CAChB,gEAAqE,CACrE,sDAGF,CAEA,4BACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,0CAA2C,CAC3C,+BAAgC,CAChC,sDAGF,CACA,8BACE,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CACA,4BACE,UAAW,CACX,WAAY,CACZ,gBAAiB,CACjB,iBAAkB,CAClB,iBAAkB,CAClB,qCAAsC,CACtC,0BAA2B,CAC3B,cAAe,CACf,cAAe,CACf,wBAAyB,CACzB,+BAAgC,CAChC,+GAMF,CACA,kCACE,0BAA2B,CAC3B,qCACF,CAEA,6BACE,SAAU,CACV,eAAgB,CAChB,WAAY,CACZ,YAAa,CACb,qBACF,CAEA,wCACE,sBAAuB,CACvB,eAAgB,CAChB,WACF,CAGA,4CACE,eACF,CAEA,wBACE,WAAY,CACZ,YAAa,CACb,kBAAmB,CACnB,wBAAyB,CACzB,cAAe,CACf,sCAAuC,CACvC,kBAAmB,CACnB,0BAA2B,CAC3B,sEAIF',sourcesContent:['<template>\n  <div class="era-panel">\n    <header class="panel-top">\n      <h3 class="panel-title">ERA æ•°æ®é¢æ¿</h3>\n      <button class="btn-close" aria-label="å…³é—­" @click="requestSwitchView(\'FloatingBall\')">Ã—</button>\n    </header>\n    <div class="panel-body">\n      <div class="panel-content-wrapper">\n        <template v-if="data">\n          <EraAccordion title="æœ€æ–°æ¶ˆæ¯å…ƒæ•°æ®" :default-open="false">\n            <MetaHeader :mk="data.mk" :message-id="data.message_id" :is-user="data.is_user" />\n          </EraAccordion>\n\n          <OperationDetails :data="data" />\n\n          <SnapshotManager :latest-data="data" />\n        </template>\n        <template v-else>\n          <div class="empty">ç­‰å¾… era:writeDone äº‹ä»¶æ•°æ®â€¦</div>\n        </template>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport type { WriteDonePayload } from \'../../utils/constants\';\nimport { Logger } from \'../../utils/log\';\nimport EraAccordion from \'../template/EraAccordion.vue\';\nimport MetaHeader from \'./EraPanelContent/MetaHeader.vue\';\nimport OperationDetails from \'./EraPanelContent/OperationDetails.vue\';\nimport SnapshotManager from \'./SnapshotManager.vue\';\n\ntype TabItem = { key: \'pure\' | \'full\'; label: string };\n\nconst logger = new Logger();\n\ndefineProps<{\n  data: WriteDonePayload | null;\n}>();\n\nconst requestSwitchView = (viewName: \'FloatingBall\' | \'ExpandedView\') => {\n  logger.debug(\'requestSwitchView\', `è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${viewName}`);\n  if ((window as any).eraUiSwitchView) {\n    (window as any).eraUiSwitchView(viewName);\n  } else {\n    logger.warn(\'requestSwitchView\', \'å…¨å±€åˆ‡æ¢å‡½æ•° eraUiSwitchView æœªæ‰¾åˆ°\');\n  }\n};\n<\/script>\n\n<style scoped>\n.era-panel {\n  flex: 2 1 600px;\n  min-width: 320px;\n  height: min(680px, 86vh);\n  display: flex;\n  flex-direction: column;\n  background: var(--bg-blur-heavy);\n  border: 1px solid var(--border-strong);\n  backdrop-filter: blur(10px);\n  border-radius: 16px;\n  box-shadow: var(--shadow-panel), var(--shadow-inset);\n  overflow: hidden;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n.panel-top {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 14px 16px;\n  border-bottom: 1px solid var(--border-soft);\n  background: var(--bg-blur-light);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n.panel-title {\n  font-size: 16px;\n  font-weight: 800;\n  letter-spacing: 0.5px;\n  color: var(--text-title);\n  transition: color 0.3s ease;\n}\n.btn-close {\n  width: 32px;\n  height: 32px;\n  line-height: 30px;\n  text-align: center;\n  border-radius: 8px;\n  border: 1px solid var(--border-normal);\n  background: var(--bg-solid);\n  cursor: pointer;\n  font-size: 18px;\n  color: var(--text-normal);\n  box-shadow: var(--shadow-button);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease,\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n.btn-close:hover {\n  transform: translateY(-1px);\n  box-shadow: var(--shadow-button-hover);\n}\n\n.panel-body {\n  padding: 0;\n  overflow: hidden;\n  flex-grow: 1;\n  display: flex; /* ç¡®ä¿ wrapper èƒ½æ’‘æ»¡ */\n  flex-direction: column;\n}\n\n.panel-content-wrapper {\n  padding: 14px 14px 16px;\n  overflow-y: auto; /* å†…éƒ¨æ»šåŠ¨ */\n  flex-grow: 1;\n}\n\n/* ç”¨ margin æ›¿ä»£ gap */\n.panel-content-wrapper > * + * {\n  margin-top: 12px;\n}\n\n.empty {\n  height: 100%; /* æ’‘æ»¡çˆ¶å®¹å™¨ */\n  display: grid;\n  place-items: center;\n  color: var(--text-normal);\n  font-size: 14px;\n  border: 1px dashed var(--border-dashed);\n  border-radius: 12px;\n  background: var(--bg-empty);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n</style>\n'],sourceRoot:''}]);const i=o},316:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.action-buttons-card[data-v-3cd160a6]{width:100%;padding:12px;background:var(--actions-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--actions-shadow-card),var(--shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-title[data-v-3cd160a6]{margin:0 0 4px;font-size:14px;font-weight:800;letter-spacing:0.3px;color:var(--text-title);transition:color 0.3s ease}.btns[data-v-3cd160a6]{display:flex;flex-direction:column;gap:16px}.btn-group[data-v-3cd160a6]{display:flex;flex-direction:column;gap:6px}.btn-desc[data-v-3cd160a6]{font-size:11px;color:var(--text-soft);padding:0 4px;line-height:1.5;margin:0;transition:color 0.3s ease}.btn[data-v-3cd160a6]{display:grid;grid-template-columns:22px 1fr;align-items:center;-moz-column-gap:8px;column-gap:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--border-soft);background:var(--actions-btn-bg);color:var(--actions-btn-text);font-weight:700;font-size:13px;cursor:pointer;box-shadow:var(--settings-shadow-inset),var(--shadow-button);transition:transform 0.12s ease,box-shadow 0.12s ease,background 0.2s ease,color 0.3s ease,border-color 0.3s ease;text-align:left}.btn.primary[data-v-3cd160a6]{background:var(--actions-btn-primary-bg);border-color:var(--actions-btn-primary-border);color:var(--actions-btn-primary-text)}.btn.subtle[data-v-3cd160a6]{background:var(--actions-btn-subtle-bg);border-color:var(--actions-btn-subtle-border)}.btn.danger[data-v-3cd160a6]{background:var(--actions-btn-danger-bg);border-color:var(--actions-btn-danger-border);color:var(--actions-btn-danger-text)}.btn[data-v-3cd160a6]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--shadow-button-hover)}.btn[data-v-3cd160a6]:active{transform:translateY(0);box-shadow:var(--settings-shadow-inset),var(--actions-shadow-btn-active)}.btn[data-v-3cd160a6]:focus-visible{outline:2px solid var(--actions-outline-focus);outline-offset:2px}.ico[data-v-3cd160a6]{display:inline-grid;place-items:center;width:22px;height:22px;filter:saturate(0.95)}.label[data-v-3cd160a6]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/RightRailContent/ActionButtons.vue'],names:[],mappings:'AAwJA,sCAEE,UAAW,CACX,YAAa,CACb,kCAAmC,CACnC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,yDAA2D,CAC3D,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAGA,6BAEE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CAGA,uBAEE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,4BACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,2BACE,cAAe,CACf,sBAAuB,CACvB,aAAc,CACd,eAAgB,CAChB,QAAS,CACT,0BACF,CAGA,sBAEE,YAAa,CACb,8BAA+B,CAC/B,kBAAmB,CACnB,mBAAe,CAAf,cAAe,CACf,iBAAkB,CAClB,kBAAmB,CACnB,mCAAoC,CACpC,gCAAiC,CACjC,6BAA8B,CAC9B,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,4DAA8D,CAC9D,iHAKwB,CACxB,eACF,CAGA,8BAEE,wCAAyC,CACzC,8CAA+C,CAC/C,qCACF,CAGA,6BAEE,uCAAwC,CACxC,6CACF,CAGA,6BACE,uCAAwC,CACxC,6CAA8C,CAC9C,oCACF,CAGA,4BAEE,0BAA2B,CAC3B,kEACF,CACA,6BAEE,uBAAwB,CACxB,wEACF,CAGA,oCAEE,8CAA+C,CAC/C,kBACF,CAGA,sBAEE,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,WAAY,CACZ,qBACF,CACA,wBAEE,kBAAmB,CACnB,eAAgB,CAChB,sBACF',sourcesContent:['<template>\n  \x3c!-- å³ä¾§æ“ä½œå¡ï¼šå¤–å±‚è‡ªåŒ…å«ï¼Œä¸ä¾èµ–çˆ¶ç»„ä»¶æ ·å¼ --\x3e\n  <section class="action-buttons-card" role="complementary" aria-label="ERA å¿«æ·æ“ä½œ">\n    \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šæ“ä½œå¡å®¹å™¨ --\x3e\n    <h4 class="card-title">å¿«æ·æ“ä½œ</h4>\n    \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šå¡ç‰‡æ ‡é¢˜ --\x3e\n    <div class="btns">\n      \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šæŒ‰é’®å‚ç›´æ ˆ --\x3e\n      <div class="btn-group">\n        <button class="btn primary" title="é‡æ–°è®¡ç®—æ‰€æœ‰å˜é‡" @click.stop="onFullSync">\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šä¸»æŒ‰é’® --\x3e\n          <span class="ico" aria-hidden="true">ğŸ”„</span>\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡ --\x3e\n          <span class="label">å®Œå…¨é‡ç®—å˜é‡</span>\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šæ–‡å­— --\x3e\n        </button>\n        <p class="btn-desc">\n          å½“å˜é‡ä¸é¢„æœŸä¸ç¬¦æ—¶ï¼Œç‚¹å‡»æ­¤æŒ‰é’®å¯ä»**ç¬¬ä¸€æ¡æ¶ˆæ¯**å¼€å§‹é‡æ–°è®¡ç®—æ‰€æœ‰æ¶ˆæ¯ï¼Œä»¥ç¡®ä¿æ•°æ®å®Œå…¨åŒæ­¥ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„æ“ä½œã€‚\n        </p>\n      </div>\n\n      <div class="btn-group">\n        <button class="btn subtle" title="åªé‡ç®—æœ€æ–°ä¸€æ¥¼çš„å˜é‡" @click.stop="onLastSync">\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šæ¬¡æŒ‰é’® --\x3e\n          <span class="ico" aria-hidden="true">â™»ï¸</span>\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡ --\x3e\n          <span class="label">é‡ç®—æœ€åä¸€æ¥¼å˜é‡</span>\n          \x3c!-- ä¸­æ–‡æ³¨é‡Šï¼šæ–‡å­— --\x3e\n        </button>\n        <p class="btn-desc">\n          ä»…æ ¹æ®æœ€æ–°ä¸€æ¡æ¶ˆæ¯é‡æ–°è®¡ç®—å˜é‡ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚é€‚ç”¨äºä¿®å¤æœ€è¿‘ä¸€æ¬¡æ“ä½œå¯¼è‡´çš„å°é—®é¢˜æˆ–åœ¨æ‰‹åŠ¨ç¼–è¾‘äº†æœ€åä¸€æ¡æ¶ˆæ¯åé‡æ–°å†™å…¥å˜é‡ï¼ˆæ³¨æ„ï¼Œeraä¼šæ— è§†æ‰€æœ‰**ç”¨æˆ·å‘é€çš„æ¶ˆæ¯**ä¸­çš„å˜é‡æ›´æ–°è¯­å¥ï¼‰ã€‚\n        </p>\n      </div>\n\n      <div class="btn-group">\n        <button class="btn danger" title="ä¸ºè§’è‰²å¡æ³¨å…¥ ERA è§„åˆ™" @click.stop="onInjectRegex">\n          <span class="ico" aria-hidden="true">ğŸ¥½</span>\n          <span class="label">ERA å¿«é€Ÿåˆå§‹åŒ–</span>\n        </button>\n        <p class="btn-desc">\n          ã€è§’è‰²å¡ä½œè€…ä¸“ç”¨ã€‘ç‚¹å‡»åï¼Œä¼šå‘å½“å‰è§’è‰²å¡æ³¨å…¥å››æ¡è§„åˆ™ï¼š<br />\n          1. æ·»åŠ â€œERA æ•°æ®éšè—æ­£åˆ™â€ä»¥éšè—èŠå¤©ä¸­çš„æ•°æ®æ ‡ç­¾ã€‚<br />\n          2. æ·»åŠ â€œERAçŠ¶æ€æ æ¨¡æ¿â€ä»¥å°†æ¨¡æ¿çŠ¶æ€æ æ›¿æ¢è‡³æ¶ˆæ¯ã€‚<br />\n          3. å‘è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­æ·»åŠ â€œERAå˜é‡æ“ä½œè§„åˆ™â€æ¡ç›®ä»¥ä»¤aiæ˜ç™½eraå˜é‡çš„æ“ä½œè§„åˆ™ã€‚<br />\n          4. å‘è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­æ·»åŠ â€œERAå˜é‡æ„å›¾è¯´æ˜â€æ¡ç›®ä»¥å­˜æ”¾å˜é‡æ„å›¾è¯´æ˜ã€‚<br />\n          æ³¨æ„ï¼šä½œè€…å¯ä»¥ç”¨è¯¥åŠŸèƒ½å¿«é€Ÿæ³¨å…¥ä½¿ç”¨eraçš„å‡ ä¸ªåŸºç¡€é…ç½®ã€‚ä½†ä½ ä»æ—§éœ€è¦ï¼š<br />\n          1. è‡ªå·±è®¾è®¡è§’è‰²å¡ç”¨åˆ°çš„å˜é‡ç»“æ„å¹¶å†™å…¥è§’è‰²çš„å¼€åœºç™½ã€‚<br />\n          2. åœ¨è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­â€˜ERAå˜é‡æ„å›¾è¯´æ˜â€™æ¡ç›®ä¸­æ·»åŠ å‘aiè¯´æ˜å„ä¸ªå˜é‡çš„æ„å›¾çš„æç¤ºè¯ã€‚<br />\n          3. ä¿®æ”¹â€˜ERAçŠ¶æ€æ æ¨¡æ¿â€™æ­£åˆ™ä¸­çš„çŠ¶æ€æ ä»£ç ï¼Œä»¤å…¶ä¸**ä½ è®¾è®¡çš„å˜é‡ç³»ç»ŸåŒ¹é…**ã€‚\n        </p>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\nimport toastr from \'toastr\';\nimport { initEraCharacterRegexes } from \'../../../initer/manual/regex\';\nimport { initEraWorldbookEntries } from \'../../../initer/manual/worldbook\';\nimport { Logger } from \'../../../utils/log\'; // ä¸­æ–‡æ³¨é‡Šï¼šæ—¥å¿—å·¥å…·\nimport { ui } from \'jquery\';\n\nconst logger = new Logger(); // ä¸­æ–‡æ³¨é‡Šï¼šå®ä¾‹åŒ–æ—¥å¿—\n\nasync function onInjectRegex() {\n  logger.log(\'onInjectRegex\', \'ç‚¹å‡»â€œERA å¿«é€Ÿåˆå§‹åŒ–â€ï¼Œå¼€å§‹æ³¨å…¥...\');\n  try {\n    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¬¬ 0 æ¡æ¶ˆæ¯\n    try {\n      const firstMessage = getChatMessages(0);\n      if (!firstMessage || firstMessage.length === 0) {\n        throw new Error(\'No messages found\');\n      }\n    } catch (e) {\n      toastr.error(\'ç„¶åå†æ¬¡ç‚¹å‡»å¿«é€Ÿåˆå§‹åŒ–\', \'è¯·åœ¨è§’è‰²å¡çš„å¼€åœºç™½ä¸­æ·»åŠ ä»»æ„å†…å®¹ã€‚\');\n      logger.warn(\'onInjectRegex\', \'è·å–ç¬¬ 0 æ¡æ¶ˆæ¯å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºèŠå¤©è®°å½•ä¸ºç©ºã€‚\', e);\n      return;\n    }\n\n    // åˆå§‹åŒ–æ­£åˆ™\n    const regexResult = await initEraCharacterRegexes();\n    if (!regexResult.success) {\n      toastr.error(regexResult.reason ?? \'æœªçŸ¥é”™è¯¯\', \'æ­£åˆ™åˆå§‹åŒ–å¤±è´¥\');\n      logger.error(\'onInjectRegex\', \'æ­£åˆ™æ³¨å…¥å¤±è´¥:\', regexResult.reason);\n      return;\n    } else {\n      const injectedCount = regexResult.details.filter(d => d.status === \'injected\').length;\n      const existsCount = regexResult.details.filter(d => d.status === \'exists\').length;\n      let message = \'\';\n      if (injectedCount > 0) {\n        message += `æˆåŠŸæ³¨å…¥ ${injectedCount} ä¸ªæ–°æ­£åˆ™ã€‚`;\n      }\n      if (existsCount > 0) {\n        message += ` ${existsCount} ä¸ªæ­£åˆ™å·²å­˜åœ¨ã€‚`;\n      }\n      if (message) {\n        toastr.success(message.trim(), \'æ­£åˆ™åˆå§‹åŒ–å®Œæˆ\');\n      }\n    }\n\n    // åˆå§‹åŒ–ä¸–ç•Œä¹¦\n    const worldbookResult = await initEraWorldbookEntries();\n    if (!worldbookResult.success) {\n      toastr.error(worldbookResult.reason ?? \'ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ç•Œä¹¦æ¡ç›®æ³¨å…¥å¤±è´¥ã€‚\', \'ä¸–ç•Œä¹¦åˆå§‹åŒ–å¤±è´¥\');\n      logger.error(\'onInjectRegex\', \'ä¸–ç•Œä¹¦æ³¨å…¥å¤±è´¥:\', worldbookResult);\n    } else {\n      const injectedCount = worldbookResult.details.filter(d => d.status === \'injected\').length;\n      const existsCount = worldbookResult.details.filter(d => d.status === \'exists\').length;\n      let message = \'\';\n      if (injectedCount > 0) {\n        message += `æˆåŠŸæ³¨å…¥ ${injectedCount} ä¸ªæ–°æ¡ç›®ã€‚`;\n      }\n      if (existsCount > 0) {\n        message += ` ${existsCount} ä¸ªæ¡ç›®å·²å­˜åœ¨ã€‚`;\n      }\n      toastr.success(message.trim(), \'ä¸–ç•Œä¹¦åˆå§‹åŒ–å®Œæˆ\');\n    }\n\n    logger.log(\'onInjectRegex\', \'åˆå§‹åŒ–æµç¨‹å®Œæˆã€‚\');\n  } catch (error) {\n    logger.error(\'onInjectRegex\', \'æ‰§è¡Œåˆå§‹åŒ–æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯:\', error);\n    toastr.error(\'å‘ç”Ÿæ„å¤–é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚\', \'åˆå§‹åŒ–å¤±è´¥\');\n  }\n}\n\nfunction onFullSync() {\n  // ä¸­æ–‡æ³¨é‡Šï¼šå®Œå…¨é‡ç®—äº‹ä»¶\n  logger.log(\'onFullSync\', \'ç‚¹å‡»â€œå®Œå…¨é‡ç®—å˜é‡â€ï¼Œå‘é€ manual_full_sync äº‹ä»¶ã€‚\'); // ä¸­æ–‡æ³¨é‡Šï¼šæ—¥å¿—\n  try {\n    eventEmit(\'manual_full_sync\'); // ä¸­æ–‡æ³¨é‡Šï¼šå‘é€å…¨é‡é‡ç®—äº‹ä»¶ï¼ˆä¿æŒä¸å˜ï¼‰\n    toastr.success(\'å·²å‘é€â€œå®Œå…¨é‡ç®—å˜é‡â€è¯·æ±‚ã€‚\', \'æ“ä½œæˆåŠŸ\');\n  } catch (error) {\n    logger.error(\'onFullSync\', \'å‘é€ manual_full_sync äº‹ä»¶æ—¶å‡ºé”™:\', error);\n    toastr.error(\'å‘é€è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚\', \'æ“ä½œå¤±è´¥\');\n  }\n}\n\nfunction onLastSync() {\n  // ä¸­æ–‡æ³¨é‡Šï¼šå±€éƒ¨é‡ç®—äº‹ä»¶\n  logger.log(\'onLastSync\', \'ç‚¹å‡»â€œé‡ç®—æœ€åä¸€æ¥¼å˜é‡â€ï¼Œå‘é€ manual_sync äº‹ä»¶ã€‚\'); // ä¸­æ–‡æ³¨é‡Šï¼šæ—¥å¿—\n  try {\n    eventEmit(\'manual_sync\'); // ä¸­æ–‡æ³¨é‡Šï¼šå‘é€å•æ¥¼é‡ç®—äº‹ä»¶ï¼ˆä¿æŒä¸å˜ï¼‰\n    toastr.success(\'å·²å‘é€â€œé‡ç®—æœ€åä¸€æ¥¼å˜é‡â€è¯·æ±‚ã€‚\', \'æ“ä½œæˆåŠŸ\');\n  } catch (error) {\n    logger.error(\'onLastSync\', \'å‘é€ manual_sync äº‹ä»¶æ—¶å‡ºé”™:\', error);\n    toastr.error(\'å‘é€è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚\', \'æ“ä½œå¤±è´¥\');\n  }\n}\n<\/script>\n\n<style scoped>\n/* === å¤–å±‚å¡ç‰‡ï¼šä¸å·¦ä¾§ ERA é¢æ¿åŒé£æ ¼ï¼ˆç»ç’ƒå¡ + è½»æµ®é›•ï¼‰ === */\n.action-buttons-card {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šå¡ç‰‡å®¹å™¨ */\n  width: 100%; /* å æ»¡ä¾§æ  */ /* ä¸­æ–‡æ³¨é‡Šï¼šè‡ªé€‚åº”å®½åº¦ */\n  padding: 12px; /* å†…è¾¹è· */ /* ä¸­æ–‡æ³¨é‡Šï¼šç•™ç™½ */\n  background: var(--actions-bg-glass);\n  border: 1px solid var(--border-strong);\n  border-radius: 16px; /* ä¸­æ–‡æ³¨é‡Šï¼šåœ†è§’ */\n  backdrop-filter: blur(10px); /* ä¸­æ–‡æ³¨é‡Šï¼šæ¯›ç»ç’ƒæ•ˆæœ */\n  box-shadow: var(--actions-shadow-card), var(--shadow-inset);\n  display: flex; /* ä¸­æ–‡æ³¨é‡Šï¼šçºµå‘å¸ƒå±€ */\n  flex-direction: column; /* ä¸­æ–‡æ³¨é‡Šï¼šå‚ç›´æ’åˆ— */\n  gap: 10px; /* ä¸­æ–‡æ³¨é‡Šï¼šå…ƒç´ é—´è· */\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n/* æ ‡é¢˜ï¼šä¸é¢æ¿æ ‡é¢˜æƒé‡æ¥è¿‘ä½†ç•¥è½» */\n.card-title {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šå¡ç‰‡æ ‡é¢˜ */\n  margin: 0 0 4px; /* ä¸­æ–‡æ³¨é‡Šï¼šåº•éƒ¨ç•™ç™½ */\n  font-size: 14px; /* ä¸­æ–‡æ³¨é‡Šï¼šå­—å· */\n  font-weight: 800; /* ä¸­æ–‡æ³¨é‡Šï¼šåŠ ç²— */\n  letter-spacing: 0.3px; /* ä¸­æ–‡æ³¨é‡Šï¼šå­—è· */\n  color: var(--text-title);\n  transition: color 0.3s ease;\n}\n\n/* æŒ‰é’®æ ˆï¼šç«–ç›´æ’åˆ— */\n.btns {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šæŒ‰é’®å®¹å™¨ */\n  display: flex; /* ä¸­æ–‡æ³¨é‡Šï¼šflex å¸ƒå±€ */\n  flex-direction: column; /* ä¸­æ–‡æ³¨é‡Šï¼šå‚ç›´æ’åˆ— */\n  gap: 16px; /* ä¸­æ–‡æ³¨é‡Šï¼šä¸Šä¸‹é—´è· */\n}\n\n.btn-group {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.btn-desc {\n  font-size: 11px;\n  color: var(--text-soft);\n  padding: 0 4px;\n  line-height: 1.5;\n  margin: 0;\n  transition: color 0.3s ease;\n}\n\n/* é€šç”¨æŒ‰é’®é€ å‹ï¼šå¤§å·ã€æ˜“ç‚¹ã€å¯èšç„¦ */\n.btn {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šé€šç”¨æŒ‰é’® */\n  display: grid; /* ä¸­æ–‡æ³¨é‡Šï¼šç½‘æ ¼æ–¹ä¾¿å¯¹é½å›¾æ ‡ä¸æ–‡å­— */\n  grid-template-columns: 22px 1fr; /* ä¸­æ–‡æ³¨é‡Šï¼šå·¦ 22px å›¾æ ‡ + å³ä¾§æ–‡å­— */\n  align-items: center; /* ä¸­æ–‡æ³¨é‡Šï¼šå‚ç›´å±…ä¸­ */\n  column-gap: 8px; /* ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡ä¸æ–‡å­—é—´è· */\n  padding: 10px 12px; /* ä¸­æ–‡æ³¨é‡Šï¼šè§¦æ§å‹å¥½å°ºå¯¸ */\n  border-radius: 12px; /* ä¸­æ–‡æ³¨é‡Šï¼šåœ†è§’ */\n  border: 1px solid var(--border-soft);\n  background: var(--actions-btn-bg);\n  color: var(--actions-btn-text);\n  font-weight: 700; /* ä¸­æ–‡æ³¨é‡Šï¼šå­—é‡ */\n  font-size: 13px; /* ä¸­æ–‡æ³¨é‡Šï¼šå­—å· */\n  cursor: pointer; /* ä¸­æ–‡æ³¨é‡Šï¼šå¯ç‚¹å‡» */\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button);\n  transition:\n    transform 0.12s ease,\n    box-shadow 0.12s ease,\n    background 0.2s ease,\n    color 0.3s ease,\n    border-color 0.3s ease;\n  text-align: left; /* ä¸­æ–‡æ³¨é‡Šï¼šé å·¦ */\n}\n\n/* ä¸»æŒ‰é’®ï¼šç•¥å¸¦å“ç‰Œè‰²è°ƒï¼ˆè“é’ï¼‰ */\n.btn.primary {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šä¸»æŒ‰é’® */\n  background: var(--actions-btn-primary-bg);\n  border-color: var(--actions-btn-primary-border);\n  color: var(--actions-btn-primary-text);\n}\n\n/* æ¬¡æŒ‰é’®ï¼šæ›´ç´ é›… */\n.btn.subtle {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šæ¬¡æŒ‰é’® */\n  background: var(--actions-btn-subtle-bg);\n  border-color: var(--actions-btn-subtle-border);\n}\n\n/* å±é™©æŒ‰é’®ï¼šç”¨äºç‰¹æ®Šæˆ–ç ´åæ€§æ“ä½œ */\n.btn.danger {\n  background: var(--actions-btn-danger-bg);\n  border-color: var(--actions-btn-danger-border);\n  color: var(--actions-btn-danger-text);\n}\n\n/* æ‚¬åœä¸æŒ‰å‹åé¦ˆ */\n.btn:hover {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šæ‚¬åœæ€ */\n  transform: translateY(-1px); /* ä¸­æ–‡æ³¨é‡Šï¼šè½»æµ®èµ· */\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button-hover);\n}\n.btn:active {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šæŒ‰ä¸‹æ€ */\n  transform: translateY(0); /* ä¸­æ–‡æ³¨é‡Šï¼šå›è½ */\n  box-shadow: var(--settings-shadow-inset), var(--actions-shadow-btn-active);\n}\n\n/* ç„¦ç‚¹å¯è§æ€§ï¼ˆæ— éšœç¢ï¼‰ */\n.btn:focus-visible {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šé”®ç›˜èšç„¦æ€ */\n  outline: 2px solid var(--actions-outline-focus);\n  outline-offset: 2px; /* ä¸­æ–‡æ³¨é‡Šï¼šæè¾¹åç§» */\n}\n\n/* å›¾æ ‡ä¸æ–‡å­— */\n.ico {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡æ¡† */\n  display: inline-grid; /* ä¸­æ–‡æ³¨é‡Šï¼šç½‘æ ¼æ”¾ç½® */\n  place-items: center; /* ä¸­æ–‡æ³¨é‡Šï¼šå±…ä¸­ */\n  width: 22px; /* ä¸­æ–‡æ³¨é‡Šï¼šå®½åº¦ */\n  height: 22px; /* ä¸­æ–‡æ³¨é‡Šï¼šé«˜åº¦ */\n  filter: saturate(0.95); /* ä¸­æ–‡æ³¨é‡Šï¼šè½»é¥±å’Œ */\n}\n.label {\n  /* ä¸­æ–‡æ³¨é‡Šï¼šæ–‡å­— */\n  white-space: nowrap; /* ä¸­æ–‡æ³¨é‡Šï¼šä¸æ¢è¡Œï¼ˆæ–‡å­—çŸ­ï¼‰ */\n  overflow: hidden; /* ä¸­æ–‡æ³¨é‡Šï¼šæº¢å‡ºè£å‰ª */\n  text-overflow: ellipsis; /* ä¸­æ–‡æ³¨é‡Šï¼šçœç•¥å· */\n}\n</style>\n'],sourceRoot:''}]);const i=o},317:(e,n,t)=>{var a=t(760);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('56649935',a,!1,{ssrId:!0})},330:(e,n,t)=>{var a=t(793);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('eb324e66',a,!1,{ssrId:!0})},372:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.json-root[data-v-6fc9ef75]{font-size:12px;color:var(--settings-text-input);transition:color 0.3s ease}.json-line[data-v-6fc9ef75]{position:relative;display:flex;align-items:center;gap:6px;padding:2px 6px;border-radius:6px;transition:background 0.2s ease}.json-line[data-v-6fc9ef75]:hover{background:var(--json-hover-bg)}.json-children[data-v-6fc9ef75]{border-left:1px dashed var(--json-tree-line);transition:border-color 0.3s ease}.key[data-v-6fc9ef75]{color:var(--json-key-color);font-weight:700;transition:color 0.3s ease}.colon[data-v-6fc9ef75]{color:var(--text-normal);transition:color 0.3s ease}.brace[data-v-6fc9ef75]{color:var(--text-normal);transition:color 0.3s ease}.val.string[data-v-6fc9ef75]{color:var(--json-val-string)}.val.number[data-v-6fc9ef75]{color:var(--json-val-number)}.val.boolean[data-v-6fc9ef75]{color:var(--json-val-boolean)}.val.null[data-v-6fc9ef75]{color:var(--json-val-null)}.val.undefined[data-v-6fc9ef75]{color:var(--json-val-null)}.json-root[data-v-6fc9ef75]{overflow:clip;contain:layout paint;min-height:0}.json-children[data-v-6fc9ef75]{overflow:clip;contain:paint}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/template/PrettyJsonViewer.vue'],names:[],mappings:'AAkIA,4BACE,cAAe,CACf,gCAAiC,CACjC,0BACF,CACA,4BACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,eAAgB,CAChB,iBAAkB,CAClB,+BACF,CACA,kCACE,+BACF,CACA,gCACE,4CAA6C,CAC7C,iCACF,CAEA,sBACE,2BAA4B,CAC5B,eAAgB,CAChB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CAEA,6BACE,4BACF,CACA,6BACE,4BACF,CACA,8BACE,6BACF,CACA,2BACE,0BACF,CACA,gCACE,0BACF,CAGA,4BAEE,aAAc,CACd,oBAAqB,CACrB,YACF,CAEA,gCAEE,aAAc,CACd,aACF',sourcesContent:['<template>\n  <div class="json-root">\n    <div class="json-line">\n      <span class="brace">{{ rootOpen }}</span>\n      \x3c!-- æ ¹å¼€æ‹¬å·ï¼šå¯¹è±¡{ / æ•°ç»„[ --\x3e\n    </div>\n\n    <div class="json-children">\n      <template v-if="isPlainObjectOrArray">\n        <JsonNode\n          v-for="(v, k) in value"\n          :key="String(k)"\n          :k="String(k)"\n          :v="v"\n          :path="String(k)"\n          :level="1"\n          :default-collapsed="defaultCollapsed"\n          :max-depth="maxDepth"\n        />\n      </template>\n\n      <template v-else>\n        <div class="json-line" :style="{ paddingLeft: 1 * 14 + \'px\' }">\n          <span class="key">value</span><span class="colon">:</span>\n          <span class="val" :class="primitiveType">{{ primitiveText }}</span>\n        </div>\n      </template>\n    </div>\n\n    <div class="json-line">\n      <span class="brace">{{ rootClose }}</span>\n      \x3c!-- æ ¹é—­æ‹¬å·ï¼šå¯¹è±¡} / æ•°ç»„] --\x3e\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed } from \'vue\'; // è®¡ç®—å±æ€§å·¥å…·\nimport { Logger } from \'../../utils/log\';\nimport JsonNode from \'./JsonNode.vue\'; // âœ… æ”¹ä¸ºå¯¼å…¥ç‹¬ç«‹ SFC çš„é€’å½’èŠ‚ç‚¹ç»„ä»¶\n\nconst logger = new Logger();\n\nconst props = withDefaults(\n  defineProps<{\n    value: any; // è¦å±•ç¤ºçš„ JSON å€¼\n    defaultCollapsed?: boolean; // é»˜è®¤æ˜¯å¦æŠ˜å \n    maxDepth?: number; // åˆæ¬¡å±•å¼€æœ€å¤§å±‚æ•°\n  }>(),\n  {\n    defaultCollapsed: true, // é»˜è®¤æŠ˜å \n    maxDepth: 3, // é»˜è®¤å±•å¼€åˆ° 3 å±‚\n  },\n);\n\nconst isPlainObjectOrArray = computed(() => {\n  const v = props.value; // å–å…¥å‚å€¼\n  const result = v !== null && typeof v === \'object\'; // ä»…å¯¹è±¡/æ•°ç»„æ‰è¿›å…¥é€é”®æ¸²æŸ“\n  logger.debug(\'isPlainObjectOrArray\', `è®¡ç®—ç»“æœ: ${result}ã€‚è¯¥å€¼${result ? \'æ˜¯\' : \'ä¸æ˜¯\'}æ™®é€šå¯¹è±¡æˆ–æ•°ç»„ã€‚`, {\n    ä¼ å…¥å€¼: v,\n  });\n  return result;\n}); // æ˜¯å¦å¯¹è±¡/æ•°ç»„\n\nconst primitiveType = computed(() => {\n  const v = props.value; // å–å…¥å‚å€¼\n  let result: string;\n  if (v === null) {\n    result = \'null\';\n  } else if (Array.isArray(v)) {\n    result = \'array\'; // æ•°ç»„ï¼ˆä¸ä¼šèµ°åˆ°è¯¥åˆ†æ”¯ï¼Œå› ä¸ºä¸Šé¢ isPlainObjectOrArray åˆ¤æ–­è¿‡ï¼‰\n  } else {\n    const t = typeof v; // åŸå§‹ç±»å‹\n    result = t === \'undefined\' ? \'undefined\' : t;\n  }\n  logger.debug(\'primitiveType\', `è®¡ç®—åŸå§‹å€¼ç±»å‹: ${result}`, { ä¼ å…¥å€¼: v });\n  return result;\n}); // åŸå§‹å€¼ç±»å‹åï¼ˆç”¨äºç€è‰²ï¼‰\n\nconst primitiveText = computed(() => {\n  const v = props.value; // å–å…¥å‚å€¼\n  let result: string;\n  switch (\n    primitiveType.value // æŒ‰ç±»å‹æ ¼å¼åŒ–æ–‡æœ¬\n  ) {\n    case \'string\':\n      result = JSON.stringify(v); // å­—ç¬¦ä¸²å¸¦å¼•å·\n      break;\n    case \'number\':\n      result = String(v); // æ•°å­—\n      break;\n    case \'boolean\':\n      result = v ? \'true\' : \'false\'; // å¸ƒå°”\n      break;\n    case \'null\':\n      result = \'null\'; // null\n      break;\n    case \'undefined\':\n      result = \'undefined\'; // undefined\n      break;\n    case \'bigint\':\n      result = String(v) + \'n\'; // bigint\n      break;\n    case \'symbol\':\n      result = String(v); // symbol\n      break;\n    case \'function\':\n      result = \'Æ’()\'; // å‡½æ•°\n      break;\n    default:\n      result = \'\'; // å…œåº•\n      break;\n  }\n  logger.debug(\'primitiveText\', `æ ¼å¼åŒ–åŸå§‹å€¼æ–‡æœ¬: "${result}"`, {\n    ä¼ å…¥å€¼: v,\n    ç±»å‹: primitiveType.value,\n  });\n  return result;\n}); // åŸå§‹å€¼æ–‡æœ¬\n\nconst isArrayRoot = computed(() => {\n  const result = Array.isArray(props.value);\n  logger.debug(\'isArrayRoot\', `è®¡ç®—æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºæ•°ç»„: ${result}`, { ä¼ å…¥å€¼: props.value });\n  return result;\n}); // æ ¹æ˜¯å¦æ•°ç»„\nconst rootOpen = computed(() => (isArrayRoot.value ? \'[\' : \'{\')); // æ ¹å¼€æ‹¬å·\nconst rootClose = computed(() => (isArrayRoot.value ? \']\' : \'}\')); // æ ¹é—­æ‹¬å·\n<\/script>\n\n<style scoped>\n.json-root {\n  font-size: 12px;\n  color: var(--settings-text-input);\n  transition: color 0.3s ease;\n}\n.json-line {\n  position: relative;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 2px 6px;\n  border-radius: 6px;\n  transition: background 0.2s ease;\n}\n.json-line:hover {\n  background: var(--json-hover-bg);\n}\n.json-children {\n  border-left: 1px dashed var(--json-tree-line);\n  transition: border-color 0.3s ease;\n}\n\n.key {\n  color: var(--json-key-color);\n  font-weight: 700;\n  transition: color 0.3s ease;\n}\n.colon {\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n}\n.brace {\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n}\n\n.val.string {\n  color: var(--json-val-string);\n}\n.val.number {\n  color: var(--json-val-number);\n}\n.val.boolean {\n  color: var(--json-val-boolean);\n}\n.val.null {\n  color: var(--json-val-null);\n}\n.val.undefined {\n  color: var(--json-val-null);\n}\n\n/* ===[æ–°å¢] é˜²æº¢å‡ºï¼šæ ¹ä¸å­å®¹å™¨éƒ½è£å‰ªç»˜åˆ¶ï¼Œé¿å…åœ¨å¤–éƒ¨å®¹å™¨é«˜åº¦ä¸º 0 æ—¶â€œé€å‡ºâ€ === */\n.json-root {\n  /* JSON æ ¹å®¹å™¨ï¼šè‡ªèº«æˆä¸ºä¸€ä¸ªç»˜åˆ¶è¾¹ç•Œ */\n  overflow: clip; /* è£å‰ªä¸€åˆ‡æº¢å‡ºï¼ˆæ¯” hidden æ›´çœæ€§èƒ½ã€æ— æ»šåŠ¨æ¡ï¼‰ */\n  contain: layout paint; /* éš”ç¦»å¸ƒå±€ä¸ç»˜åˆ¶ï¼Œé˜²å¤–éƒ¨é«˜åº¦è®¡ç®—è¯¯å·® */\n  min-height: 0; /* é˜²æ­¢ flex åœºæ™¯ min-content é¡¶é«˜çˆ¶çº§ */\n}\n\n.json-children {\n  /* å­åŒºï¼šåŒæ ·è£å‰ªï¼Œè§£å†³å·¦ä¾§è™šçº¿åœ¨æ”¶èµ·æ—¶å¤–éœ² */\n  overflow: clip; /* å­çº§å†ä¿é™©è£å‰ª */\n  contain: paint; /* è¿›ä¸€æ­¥éš”ç¦»ç»˜åˆ¶ */\n}\n</style>\n'],sourceRoot:''}]);const i=o},399:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,':root{--bg-blur-heavy:linear-gradient(180deg,rgba(255,255,255,0.75),rgba(255,255,255,0.65));--bg-blur-light:linear-gradient(90deg,rgba(255,255,255,0.65),rgba(255,255,255,0.45));--bg-solid:#fff;--bg-soft:rgba(255,255,255,0.6);--bg-empty:rgba(255,255,255,0.5);--paper:#fff;--border-strong:rgba(255,255,255,0.6);--border-normal:rgba(0,0,0,0.08);--border-soft:rgba(0,0,0,0.06);--border-dashed:rgba(0,0,0,0.08);--line:rgba(0,0,0,0.08);--text-title:#1f2937;--text-subtitle:#374151;--text-normal:#6b7280;--muted:#6b7280;--shadow-panel:0 10px 40px rgba(0,0,0,0.18);--shadow-button:0 2px 8px rgba(0,0,0,0.08);--shadow-button-hover:0 6px 16px rgba(0,0,0,0.12);--shadow-inset:inset 0 1px 0 rgba(255,255,255,0.6);--chip-bg:linear-gradient(180deg,#fafafa,#f4f4f4);--chip-text:#6b7280;--chip-border:rgba(0,0,0,0.06);--chip-ok-bg:linear-gradient(180deg,#ecfdf5,#d1fae5);--chip-ok-text:#065f46;--chip-ok-border:#a7f3d0;--mk-pill-bg:linear-gradient(180deg,#eef2ff,#e0e7ff);--mk-pill-text:#4338ca;--mk-pill-border:#c7d2fe;--mk-pill-null-bg:linear-gradient(180deg,#f9fafb,#f3f4f6);--mk-pill-null-text:#6b7280;--mk-pill-null-border:#e5e7eb;--settings-bg-glass:linear-gradient(180deg,rgba(255,255,255,0.76),rgba(255,255,255,0.62));--settings-shadow-card:0 10px 40px rgba(0,0,0,0.16);--settings-shadow-inset:inset 0 1px 0 #fff;--settings-shadow-minibtn:0 2px 6px rgba(0,0,0,0.06);--settings-shadow-minibtn-hover:0 5px 12px rgba(0,0,0,0.1);--settings-bg-var-row:linear-gradient(180deg,#ffffff,#f8fafc);--settings-text-input:#111827;--settings-text-primary-btn:#0f172a;--settings-border-input:#e5e7eb;--settings-bg-btn-primary:linear-gradient(180deg,#e0f2fe,#bfdbfe);--settings-border-btn-primary:#93c5fd;--settings-bg-btn-subtle:linear-gradient(180deg,#f9fafb,#f3f4f6);--settings-bg-type-chip:#eef2ff;--settings-border-type-chip:#c7d2fe;--settings-bg-switch-track:#e5e7eb;--settings-bg-switch-handle:#fff;--settings-shadow-switch-handle:0 1px 3px rgba(0,0,0,0.2);--settings-bg-switch-checked:#93c5fd;--settings-text-hint-ok:#065f46;--settings-text-hint-bad:#b91c1c;--actions-bg-glass:linear-gradient(180deg,rgba(255,255,255,0.76),rgba(255,255,255,0.62));--actions-shadow-card:0 10px 40px rgba(0,0,0,0.16);--actions-btn-bg:linear-gradient(180deg,#fafafa,#f3f4f6);--actions-btn-text:#374151;--actions-btn-primary-bg:linear-gradient(180deg,#e0f2fe,#bfdbfe);--actions-btn-primary-border:#93c5fd;--actions-btn-primary-text:#0f172a;--actions-btn-subtle-bg:linear-gradient(180deg,#f9fafb,#f3f4f6);--actions-btn-subtle-border:#e5e7eb;--actions-btn-danger-bg:linear-gradient(180deg,#fee2e2,#fecaca);--actions-btn-danger-border:#fca5a5;--actions-btn-danger-text:#991b1b;--actions-shadow-btn-active:0 2px 8px rgba(0,0,0,0.1);--actions-outline-focus:#60a5fa;--text-soft:#6b7280;--accordion-bg:linear-gradient(180deg,#fff,#fafafa);--accordion-body-bg:rgba(255,255,255,0.82);--meta-bg:linear-gradient(180deg,#ffffff,#f9fafb);--meta-shadow:0 6px 18px rgba(0,0,0,0.06);--meta-key-bg:#f3f4f6;--meta-glow-bg:linear-gradient(90deg,#60a5fa,#a78bfa,#34d399,#f472b6);--json-hover-bg:rgba(59,130,246,0.06);--json-tree-line:rgba(107,114,128,0.25);--json-key-color:#1f2937;--json-val-string:#047857;--json-val-number:#7c3aed;--json-val-boolean:#0369a1;--json-val-null:#9ca3af;--json-caret-shadow:0 1px 0 #fff,0 2px 6px rgba(0,0,0,0.06);--json-caret-open-shadow:0 3px 10px rgba(0,0,0,0.12);--tab-active-shadow:0 0 0 3px rgba(147,197,253,0.35);--tab-content-bg:rgba(255,255,255,0.86);--ball-hue:210;--ball-sat:15%;--ball-lum:95%;--ball-shadow-color:rgba(0,0,0,0.15);--ball-glow-color:rgba(180,200,220,0.55);--ball-inner-shadow-color:rgba(0,0,0,0.1);--ball-specular-color:rgba(255,255,255,0.9);--ball-glass-color:rgba(255,255,255,0.1);--ball-focus-outline:rgba(180,200,220,0.85);--ball-logo-bg:linear-gradient(180deg,#8899aa 0%,#556677 100%);--ball-logo-shadow-top:rgba(0,0,0,0.25);--ball-logo-shadow-near:rgba(255,255,255,0.6);--ball-logo-shadow-far:rgba(0,0,0,0.1);--ball-logo-filter-glow:drop-shadow(0 0 1px rgba(0,0,0,0.2));--snapshot-accent:#5b8cff;--snapshot-accent-soft:rgba(91,140,255,0.25);--snapshot-bg:#fff;--snapshot-stroke:rgba(0,0,0,0.12);--snapshot-text:#2a2a2a;--snapshot-muted:#777;--snapshot-bg-gradient:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.3));--snapshot-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.45);--snapshot-outer-shadow:0 1px 2px rgba(0,0,0,0.04);--snapshot-focus-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.5);--snapshot-btn-bg:#f5f5f0;--snapshot-btn-text:#333;--snapshot-btn-hover-bg:#e9e9e0;--snapshot-btn-active-bg:#dcdccf}.dark-theme{--bg-blur-heavy:linear-gradient(180deg,rgba(35,37,43,0.8),rgba(28,29,33,0.75));--bg-blur-light:linear-gradient(90deg,rgba(50,52,59,0.7),rgba(42,43,48,0.6));--bg-solid:#2d2f37;--bg-soft:rgba(60,63,73,0.5);--bg-empty:rgba(60,63,73,0.25);--paper:#2d2f37;--border-strong:rgba(255,255,255,0.12);--border-normal:rgba(255,255,255,0.1);--border-soft:rgba(255,255,255,0.08);--border-dashed:rgba(255,255,255,0.1);--line:rgba(255,255,255,0.1);--text-title:#f9fafb;--text-subtitle:#d1d5db;--text-normal:#9ca3af;--muted:#9ca3af;--shadow-panel:0 10px 40px rgba(0,0,0,0.3);--shadow-button:0 2px 8px rgba(0,0,0,0.25);--shadow-button-hover:0 6px 16px rgba(0,0,0,0.35);--shadow-inset:inset 0 1px 0 rgba(255,255,255,0.1);--chip-bg:linear-gradient(180deg,#4b5563,#374151);--chip-text:#e5e7eb;--chip-border:rgba(255,255,255,0.1);--chip-ok-bg:linear-gradient(180deg,#064e3b,#052e22);--chip-ok-text:#a7f3d0;--chip-ok-border:#047857;--mk-pill-bg:linear-gradient(180deg,#3730a3,#312e81);--mk-pill-text:#c7d2fe;--mk-pill-border:#4f46e5;--mk-pill-null-bg:linear-gradient(180deg,#4b5563,#374151);--mk-pill-null-text:#9ca3af;--mk-pill-null-border:#6b7280;--settings-bg-glass:linear-gradient(180deg,rgba(40,42,48,0.8),rgba(33,34,38,0.75));--settings-shadow-card:0 10px 40px rgba(0,0,0,0.3);--settings-shadow-inset:inset 0 1px 0 rgba(255,255,255,0.05);--settings-shadow-minibtn:0 2px 6px rgba(0,0,0,0.2);--settings-shadow-minibtn-hover:0 5px 12px rgba(0,0,0,0.3);--settings-bg-var-row:#2d2f37;--settings-text-input:#f9fafb;--settings-text-primary-btn:#e0f2fe;--settings-border-input:#4b5563;--settings-bg-btn-primary:linear-gradient(180deg,#3b82f6,#2563eb);--settings-border-btn-primary:#1d4ed8;--settings-bg-btn-subtle:linear-gradient(180deg,#4b5563,#374151);--settings-bg-type-chip:#3730a3;--settings-border-type-chip:#4f46e5;--settings-bg-switch-track:#4b5563;--settings-bg-switch-handle:#d1d5db;--settings-shadow-switch-handle:0 1px 3px rgba(0,0,0,0.4);--settings-bg-switch-checked:#3b82f6;--settings-text-hint-ok:#34d399;--settings-text-hint-bad:#ef4444;--actions-bg-glass:linear-gradient(180deg,rgba(40,42,48,0.8),rgba(33,34,38,0.75));--actions-shadow-card:0 10px 40px rgba(0,0,0,0.3);--actions-btn-bg:linear-gradient(180deg,#4b5563,#374151);--actions-btn-text:#d1d5db;--actions-btn-primary-bg:linear-gradient(180deg,#3b82f6,#2563eb);--actions-btn-primary-border:#1d4ed8;--actions-btn-primary-text:#f1f5f9;--actions-btn-subtle-bg:linear-gradient(180deg,#4b5563,#374151);--actions-btn-subtle-border:#6b7280;--actions-shadow-btn-active:0 2px 8px rgba(0,0,0,0.2);--actions-outline-focus:#2563eb;--accordion-bg:var(--bg-solid);--accordion-body-bg:rgba(45,47,55,0.5);--meta-bg:linear-gradient(180deg,#2d2f37,#24262b);--meta-shadow:0 6px 18px rgba(0,0,0,0.2);--meta-key-bg:#374151;--meta-glow-bg:linear-gradient(90deg,#3b82f6,#8b5cf6,#10b981,#ec4899);--json-hover-bg:rgba(147,197,253,0.1);--json-tree-line:rgba(107,114,128,0.4);--json-key-color:#e5e7eb;--json-val-string:#6ee7b7;--json-val-number:#c4b5fd;--json-val-boolean:#7dd3fc;--json-val-null:#9ca3af;--json-caret-shadow:0 1px 0 rgba(255,255,255,0.05),0 2px 6px rgba(0,0,0,0.2);--json-caret-open-shadow:0 3px 10px rgba(0,0,0,0.3);--tab-active-shadow:0 0 0 3px rgba(59,130,246,0.4);--tab-content-bg:rgba(45,47,55,0.5);--ball-hue:220;--ball-sat:10%;--ball-lum:25%;--ball-shadow-color:rgba(0,0,0,0.3);--ball-glow-color:rgba(150,180,210,0.4);--ball-inner-shadow-color:rgba(0,0,0,0.4);--ball-specular-color:rgba(255,255,255,0.15);--ball-glass-color:rgba(255,255,255,0.05);--ball-focus-outline:rgba(150,180,210,0.7);--ball-logo-bg:linear-gradient(180deg,rgba(255,255,255,0.9) 0%,rgba(233,213,255,0.6) 45%,rgba(220,200,255,0.5) 65%,rgba(191,128,255,0.65) 100%),linear-gradient(180deg,rgba(0,0,0,0.45),rgba(0,0,0,0) 60%);--ball-logo-shadow-top:rgba(255,255,255,0.6);--ball-logo-shadow-near:rgba(0,0,0,0.3);--ball-logo-shadow-far:rgba(138,43,226,0.45);--ball-logo-filter-glow:drop-shadow(0 0 3px rgba(191,128,255,0.35));--snapshot-accent:#3b82f6;--snapshot-accent-soft:rgba(59,130,246,0.3);--snapshot-bg:#2d2f37;--snapshot-stroke:rgba(255,255,255,0.1);--snapshot-text:#f9fafb;--snapshot-muted:#9ca3af;--snapshot-bg-gradient:linear-gradient(180deg,rgba(255,255,255,0.08),transparent);--snapshot-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.05);--snapshot-outer-shadow:0 1px 2px rgba(0,0,0,0.2);--snapshot-focus-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.1);--snapshot-btn-bg:#4a4a4a;--snapshot-btn-text:#eee;--snapshot-btn-hover-bg:#5a5a5a;--snapshot-btn-active-bg:#3a3a3a}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/ThemeManager.vue'],names:[],mappings:'AAmBA,MAEE,qFAA8F,CAC9F,oFAA6F,CAC7F,eAAgB,CAChB,+BAAmC,CACnC,gCAAoC,CACpC,YAAa,CACb,qCAAyC,CACzC,gCAAoC,CACpC,8BAAkC,CAClC,gCAAoC,CACpC,uBAA2B,CAC3B,oBAAqB,CACrB,uBAAwB,CACxB,qBAAsB,CACtB,eAAgB,CAChB,2CAA+C,CAC/C,0CAA8C,CAC9C,iDAAqD,CACrD,kDAAsD,CACtD,iDAAoD,CACpD,mBAAoB,CACpB,8BAAkC,CAClC,oDAAuD,CACvD,sBAAuB,CACvB,wBAAyB,CACzB,oDAAuD,CACvD,sBAAuB,CACvB,wBAAyB,CACzB,yDAA4D,CAC5D,2BAA4B,CAC5B,6BAA8B,CAG9B,yFAAkG,CAClG,mDAAuD,CACvD,0CAA2C,CAC3C,oDAAwD,CACxD,0DAA8D,CAC9D,6DAAgE,CAChE,6BAA8B,CAC9B,mCAAoC,CACpC,+BAAgC,CAChC,iEAAoE,CACpE,qCAAsC,CACtC,gEAAmE,CACnE,+BAAgC,CAChC,mCAAoC,CACpC,kCAAmC,CACnC,gCAAiC,CACjC,yDAA6D,CAC7D,oCAAqC,CACrC,+BAAgC,CAChC,gCAAiC,CAGjC,wFAAiG,CACjG,kDAAsD,CACtD,wDAA2D,CAC3D,0BAA2B,CAC3B,gEAAmE,CACnE,oCAAqC,CACrC,kCAAmC,CACnC,+DAAkE,CAClE,mCAAoC,CACpC,+DAAkE,CAClE,mCAAoC,CACpC,iCAAkC,CAClC,qDAAyD,CACzD,+BAAgC,CAChC,mBAAoB,CAGpB,mDAAsD,CACtD,0CAA8C,CAG9C,iDAAoD,CACpD,yCAA6C,CAC7C,qBAAsB,CACtB,qEAA0E,CAG1E,qCAAyC,CACzC,uCAA2C,CAC3C,wBAAyB,CACzB,yBAA0B,CAC1B,yBAA0B,CAC1B,0BAA2B,CAC3B,uBAAwB,CACxB,2DAAgE,CAChE,oDAAwD,CAGxD,oDAAwD,CACxD,uCAA2C,CAG3C,cAAe,CACf,cAAe,CACf,cAAe,CACf,oCAAwC,CACxC,wCAA4C,CAC5C,yCAA6C,CAC7C,2CAA+C,CAC/C,wCAA4C,CAC5C,2CAA+C,CAC/C,8DAAiE,CACjE,uCAA2C,CAC3C,6CAAiD,CACjD,sCAA0C,CAC1C,4DAAgE,CAGhE,yBAA0B,CAC1B,4CAAgD,CAChD,kBAAmB,CACnB,kCAAsC,CACtC,uBAAwB,CACxB,qBAAsB,CACtB,0FAAmG,CACnG,4DAAgE,CAChE,kDAAsD,CACtD,iEAAqE,CAGrE,yBAA0B,CAC1B,wBAAyB,CACzB,+BAAgC,CAChC,gCACF,CAGA,YAEE,8EAAuF,CACvF,4EAAqF,CACrF,kBAAmB,CACnB,4BAAgC,CAChC,8BAAkC,CAClC,eAAgB,CAChB,sCAA0C,CAC1C,qCAAyC,CACzC,oCAAwC,CACxC,qCAAyC,CACzC,4BAAgC,CAChC,oBAAqB,CACrB,uBAAwB,CACxB,qBAAsB,CACtB,eAAgB,CAChB,0CAA8C,CAC9C,0CAA8C,CAC9C,iDAAqD,CACrD,kDAAsD,CACtD,iDAAoD,CACpD,mBAAoB,CACpB,mCAAuC,CACvC,oDAAuD,CACvD,sBAAuB,CACvB,wBAAyB,CACzB,oDAAuD,CACvD,sBAAuB,CACvB,wBAAyB,CACzB,yDAA4D,CAC5D,2BAA4B,CAC5B,6BAA8B,CAG9B,kFAA2F,CAC3F,kDAAsD,CACtD,4DAAgE,CAChE,mDAAuD,CACvD,0DAA8D,CAC9D,6BAA8B,CAC9B,6BAA8B,CAC9B,mCAAoC,CACpC,+BAAgC,CAChC,iEAAoE,CACpE,qCAAsC,CACtC,gEAAmE,CACnE,+BAAgC,CAChC,mCAAoC,CACpC,kCAAmC,CACnC,mCAAoC,CACpC,yDAA6D,CAC7D,oCAAqC,CACrC,+BAAgC,CAChC,gCAAiC,CAGjC,iFAA0F,CAC1F,iDAAqD,CACrD,wDAA2D,CAC3D,0BAA2B,CAC3B,gEAAmE,CACnE,oCAAqC,CACrC,kCAAmC,CACnC,+DAAkE,CAClE,mCAAoC,CACpC,qDAAyD,CACzD,+BAAgC,CAGhC,8BAA+B,CAC/B,sCAA0C,CAG1C,iDAAoD,CACpD,wCAA4C,CAC5C,qBAAsB,CACtB,qEAA0E,CAG1E,qCAAyC,CACzC,sCAA0C,CAC1C,wBAAyB,CACzB,yBAA0B,CAC1B,yBAA0B,CAC1B,0BAA2B,CAC3B,uBAAwB,CACxB,4EAAoF,CACpF,mDAAuD,CAGvD,kDAAsD,CACtD,mCAAuC,CAGvC,cAAe,CACf,cAAe,CACf,cAAe,CACf,mCAAuC,CACvC,uCAA2C,CAC3C,yCAA6C,CAC7C,4CAAgD,CAChD,yCAA6C,CAC7C,0CAA8C,CAC9C,0MAQoE,CACpE,4CAAgD,CAChD,uCAA2C,CAC3C,4CAAgD,CAChD,mEAAuE,CAGvE,yBAA0B,CAC1B,2CAA+C,CAC/C,qBAAsB,CACtB,uCAA2C,CAC3C,uBAAwB,CACxB,wBAAyB,CACzB,iFAAuF,CACvF,4DAAgE,CAChE,iDAAqD,CACrD,iEAAqE,CAGrE,yBAA0B,CAC1B,wBAAyB,CACzB,+BAAgC,CAChC,gCACF',sourcesContent:['<script setup lang="ts">\nimport { defineExpose, ref } from \'vue\';\n\nconst isDarkMode = ref(false);\n\n// é€šè¿‡ defineExpose å°†çŠ¶æ€å’Œæ–¹æ³•æš´éœ²ç»™çˆ¶ç»„ä»¶\ndefineExpose({\n  isDarkMode,\n});\n<\/script>\n\n<style>\n/*\n  è¿™ä¸ª style æ ‡ç­¾æ²¡æœ‰ \'scoped\' å±æ€§ï¼Œ\n  å› æ­¤å½“ ThemeManager ç»„ä»¶è¢«æŒ‚è½½æ—¶ï¼Œ\n  è¿™é‡Œçš„æ‰€æœ‰æ ·å¼éƒ½ä¼šä½œä¸ºå…¨å±€æ ·å¼æ³¨å…¥åˆ°é¡µé¢ä¸­ã€‚\n*/\n\n/* äº®è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰ */\n:root {\n  /* === App.vue & General Styles === */\n  --bg-blur-heavy: linear-gradient(180deg, rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.65));\n  --bg-blur-light: linear-gradient(90deg, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.45));\n  --bg-solid: #fff;\n  --bg-soft: rgba(255, 255, 255, 0.6);\n  --bg-empty: rgba(255, 255, 255, 0.5);\n  --paper: #fff; /* Component/Card background color */\n  --border-strong: rgba(255, 255, 255, 0.6);\n  --border-normal: rgba(0, 0, 0, 0.08);\n  --border-soft: rgba(0, 0, 0, 0.06);\n  --border-dashed: rgba(0, 0, 0, 0.08);\n  --line: rgba(0, 0, 0, 0.08); /* Generic line color */\n  --text-title: #1f2937;\n  --text-subtitle: #374151;\n  --text-normal: #6b7280;\n  --muted: #6b7280; /* Muted text color */\n  --shadow-panel: 0 10px 40px rgba(0, 0, 0, 0.18);\n  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.08);\n  --shadow-button-hover: 0 6px 16px rgba(0, 0, 0, 0.12);\n  --shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.6);\n  --chip-bg: linear-gradient(180deg, #fafafa, #f4f4f4);\n  --chip-text: #6b7280;\n  --chip-border: rgba(0, 0, 0, 0.06);\n  --chip-ok-bg: linear-gradient(180deg, #ecfdf5, #d1fae5);\n  --chip-ok-text: #065f46;\n  --chip-ok-border: #a7f3d0;\n  --mk-pill-bg: linear-gradient(180deg, #eef2ff, #e0e7ff);\n  --mk-pill-text: #4338ca;\n  --mk-pill-border: #c7d2fe;\n  --mk-pill-null-bg: linear-gradient(180deg, #f9fafb, #f3f4f6);\n  --mk-pill-null-text: #6b7280;\n  --mk-pill-null-border: #e5e7eb;\n\n  /* === EraSettingsPanel.vue Styles === */\n  --settings-bg-glass: linear-gradient(180deg, rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.62));\n  --settings-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.16);\n  --settings-shadow-inset: inset 0 1px 0 #fff;\n  --settings-shadow-minibtn: 0 2px 6px rgba(0, 0, 0, 0.06);\n  --settings-shadow-minibtn-hover: 0 5px 12px rgba(0, 0, 0, 0.1);\n  --settings-bg-var-row: linear-gradient(180deg, #ffffff, #f8fafc);\n  --settings-text-input: #111827;\n  --settings-text-primary-btn: #0f172a;\n  --settings-border-input: #e5e7eb;\n  --settings-bg-btn-primary: linear-gradient(180deg, #e0f2fe, #bfdbfe);\n  --settings-border-btn-primary: #93c5fd;\n  --settings-bg-btn-subtle: linear-gradient(180deg, #f9fafb, #f3f4f6);\n  --settings-bg-type-chip: #eef2ff;\n  --settings-border-type-chip: #c7d2fe;\n  --settings-bg-switch-track: #e5e7eb;\n  --settings-bg-switch-handle: #fff;\n  --settings-shadow-switch-handle: 0 1px 3px rgba(0, 0, 0, 0.2);\n  --settings-bg-switch-checked: #93c5fd;\n  --settings-text-hint-ok: #065f46;\n  --settings-text-hint-bad: #b91c1c;\n\n  /* === ActionButtons.vue & AboutEra.vue Styles === */\n  --actions-bg-glass: linear-gradient(180deg, rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.62));\n  --actions-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.16);\n  --actions-btn-bg: linear-gradient(180deg, #fafafa, #f3f4f6);\n  --actions-btn-text: #374151;\n  --actions-btn-primary-bg: linear-gradient(180deg, #e0f2fe, #bfdbfe);\n  --actions-btn-primary-border: #93c5fd;\n  --actions-btn-primary-text: #0f172a;\n  --actions-btn-subtle-bg: linear-gradient(180deg, #f9fafb, #f3f4f6);\n  --actions-btn-subtle-border: #e5e7eb;\n  --actions-btn-danger-bg: linear-gradient(180deg, #fee2e2, #fecaca);\n  --actions-btn-danger-border: #fca5a5;\n  --actions-btn-danger-text: #991b1b;\n  --actions-shadow-btn-active: 0 2px 8px rgba(0, 0, 0, 0.1);\n  --actions-outline-focus: #60a5fa;\n  --text-soft: #6b7280;\n\n  /* === EraAccordion.vue Styles === */\n  --accordion-bg: linear-gradient(180deg, #fff, #fafafa);\n  --accordion-body-bg: rgba(255, 255, 255, 0.82);\n\n  /* === MetaHeader.vue Styles === */\n  --meta-bg: linear-gradient(180deg, #ffffff, #f9fafb);\n  --meta-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);\n  --meta-key-bg: #f3f4f6;\n  --meta-glow-bg: linear-gradient(90deg, #60a5fa, #a78bfa, #34d399, #f472b6);\n\n  /* === JsonNode.vue Styles === */\n  --json-hover-bg: rgba(59, 130, 246, 0.06);\n  --json-tree-line: rgba(107, 114, 128, 0.25);\n  --json-key-color: #1f2937;\n  --json-val-string: #047857;\n  --json-val-number: #7c3aed;\n  --json-val-boolean: #0369a1;\n  --json-val-null: #9ca3af;\n  --json-caret-shadow: 0 1px 0 #fff, 0 2px 6px rgba(0, 0, 0, 0.06);\n  --json-caret-open-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);\n\n  /* === TabSwitch.vue Styles === */\n  --tab-active-shadow: 0 0 0 3px rgba(147, 197, 253, 0.35);\n  --tab-content-bg: rgba(255, 255, 255, 0.86);\n\n  /* === FloatingBall.vue Styles === */\n  --ball-hue: 210;\n  --ball-sat: 15%;\n  --ball-lum: 95%;\n  --ball-shadow-color: rgba(0, 0, 0, 0.15);\n  --ball-glow-color: rgba(180, 200, 220, 0.55);\n  --ball-inner-shadow-color: rgba(0, 0, 0, 0.1);\n  --ball-specular-color: rgba(255, 255, 255, 0.9);\n  --ball-glass-color: rgba(255, 255, 255, 0.1);\n  --ball-focus-outline: rgba(180, 200, 220, 0.85);\n  --ball-logo-bg: linear-gradient(180deg, #8899aa 0%, #556677 100%);\n  --ball-logo-shadow-top: rgba(0, 0, 0, 0.25);\n  --ball-logo-shadow-near: rgba(255, 255, 255, 0.6);\n  --ball-logo-shadow-far: rgba(0, 0, 0, 0.1);\n  --ball-logo-filter-glow: drop-shadow(0 0 1px rgba(0, 0, 0, 0.2));\n\n  /* === SnapshotManager.vue Styles === */\n  --snapshot-accent: #5b8cff;\n  --snapshot-accent-soft: rgba(91, 140, 255, 0.25);\n  --snapshot-bg: #fff;\n  --snapshot-stroke: rgba(0, 0, 0, 0.12);\n  --snapshot-text: #2a2a2a;\n  --snapshot-muted: #777;\n  --snapshot-bg-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));\n  --snapshot-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45);\n  --snapshot-outer-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\n  --snapshot-focus-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5);\n\n  /* Custom Button Colors */\n  --snapshot-btn-bg: #f5f5f0;\n  --snapshot-btn-text: #333;\n  --snapshot-btn-hover-bg: #e9e9e0;\n  --snapshot-btn-active-bg: #dcdccf;\n}\n\n/* æš—è‰²ä¸»é¢˜ */\n.dark-theme {\n  /* === App.vue & General Styles === */\n  --bg-blur-heavy: linear-gradient(180deg, rgba(35, 37, 43, 0.8), rgba(28, 29, 33, 0.75));\n  --bg-blur-light: linear-gradient(90deg, rgba(50, 52, 59, 0.7), rgba(42, 43, 48, 0.6));\n  --bg-solid: #2d2f37;\n  --bg-soft: rgba(60, 63, 73, 0.5);\n  --bg-empty: rgba(60, 63, 73, 0.25);\n  --paper: #2d2f37; /* Component/Card background color */\n  --border-strong: rgba(255, 255, 255, 0.12);\n  --border-normal: rgba(255, 255, 255, 0.1);\n  --border-soft: rgba(255, 255, 255, 0.08);\n  --border-dashed: rgba(255, 255, 255, 0.1);\n  --line: rgba(255, 255, 255, 0.1); /* Generic line color */\n  --text-title: #f9fafb;\n  --text-subtitle: #d1d5db;\n  --text-normal: #9ca3af;\n  --muted: #9ca3af; /* Muted text color */\n  --shadow-panel: 0 10px 40px rgba(0, 0, 0, 0.3);\n  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.25);\n  --shadow-button-hover: 0 6px 16px rgba(0, 0, 0, 0.35);\n  --shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.1);\n  --chip-bg: linear-gradient(180deg, #4b5563, #374151);\n  --chip-text: #e5e7eb;\n  --chip-border: rgba(255, 255, 255, 0.1);\n  --chip-ok-bg: linear-gradient(180deg, #064e3b, #052e22);\n  --chip-ok-text: #a7f3d0;\n  --chip-ok-border: #047857;\n  --mk-pill-bg: linear-gradient(180deg, #3730a3, #312e81);\n  --mk-pill-text: #c7d2fe;\n  --mk-pill-border: #4f46e5;\n  --mk-pill-null-bg: linear-gradient(180deg, #4b5563, #374151);\n  --mk-pill-null-text: #9ca3af;\n  --mk-pill-null-border: #6b7280;\n\n  /* === EraSettingsPanel.vue Styles === */\n  --settings-bg-glass: linear-gradient(180deg, rgba(40, 42, 48, 0.8), rgba(33, 34, 38, 0.75));\n  --settings-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.3);\n  --settings-shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.05);\n  --settings-shadow-minibtn: 0 2px 6px rgba(0, 0, 0, 0.2);\n  --settings-shadow-minibtn-hover: 0 5px 12px rgba(0, 0, 0, 0.3);\n  --settings-bg-var-row: #2d2f37;\n  --settings-text-input: #f9fafb;\n  --settings-text-primary-btn: #e0f2fe;\n  --settings-border-input: #4b5563;\n  --settings-bg-btn-primary: linear-gradient(180deg, #3b82f6, #2563eb);\n  --settings-border-btn-primary: #1d4ed8;\n  --settings-bg-btn-subtle: linear-gradient(180deg, #4b5563, #374151);\n  --settings-bg-type-chip: #3730a3;\n  --settings-border-type-chip: #4f46e5;\n  --settings-bg-switch-track: #4b5563;\n  --settings-bg-switch-handle: #d1d5db;\n  --settings-shadow-switch-handle: 0 1px 3px rgba(0, 0, 0, 0.4);\n  --settings-bg-switch-checked: #3b82f6;\n  --settings-text-hint-ok: #34d399;\n  --settings-text-hint-bad: #ef4444;\n\n  /* === ActionButtons.vue & AboutEra.vue Styles === */\n  --actions-bg-glass: linear-gradient(180deg, rgba(40, 42, 48, 0.8), rgba(33, 34, 38, 0.75));\n  --actions-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.3);\n  --actions-btn-bg: linear-gradient(180deg, #4b5563, #374151);\n  --actions-btn-text: #d1d5db;\n  --actions-btn-primary-bg: linear-gradient(180deg, #3b82f6, #2563eb);\n  --actions-btn-primary-border: #1d4ed8;\n  --actions-btn-primary-text: #f1f5f9;\n  --actions-btn-subtle-bg: linear-gradient(180deg, #4b5563, #374151);\n  --actions-btn-subtle-border: #6b7280;\n  --actions-shadow-btn-active: 0 2px 8px rgba(0, 0, 0, 0.2);\n  --actions-outline-focus: #2563eb;\n\n  /* === EraAccordion.vue Styles === */\n  --accordion-bg: var(--bg-solid);\n  --accordion-body-bg: rgba(45, 47, 55, 0.5);\n\n  /* === MetaHeader.vue Styles === */\n  --meta-bg: linear-gradient(180deg, #2d2f37, #24262b);\n  --meta-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);\n  --meta-key-bg: #374151;\n  --meta-glow-bg: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981, #ec4899);\n\n  /* === JsonNode.vue Styles === */\n  --json-hover-bg: rgba(147, 197, 253, 0.1);\n  --json-tree-line: rgba(107, 114, 128, 0.4);\n  --json-key-color: #e5e7eb;\n  --json-val-string: #6ee7b7;\n  --json-val-number: #c4b5fd;\n  --json-val-boolean: #7dd3fc;\n  --json-val-null: #9ca3af;\n  --json-caret-shadow: 0 1px 0 rgba(255, 255, 255, 0.05), 0 2px 6px rgba(0, 0, 0, 0.2);\n  --json-caret-open-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);\n\n  /* === TabSwitch.vue Styles === */\n  --tab-active-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);\n  --tab-content-bg: rgba(45, 47, 55, 0.5);\n\n  /* === FloatingBall.vue Styles === */\n  --ball-hue: 220;\n  --ball-sat: 10%;\n  --ball-lum: 25%;\n  --ball-shadow-color: rgba(0, 0, 0, 0.3);\n  --ball-glow-color: rgba(150, 180, 210, 0.4);\n  --ball-inner-shadow-color: rgba(0, 0, 0, 0.4);\n  --ball-specular-color: rgba(255, 255, 255, 0.15);\n  --ball-glass-color: rgba(255, 255, 255, 0.05);\n  --ball-focus-outline: rgba(150, 180, 210, 0.7);\n  --ball-logo-bg:\n    linear-gradient(\n      180deg,\n      rgba(255, 255, 255, 0.9) 0%,\n      rgba(233, 213, 255, 0.6) 45%,\n      rgba(220, 200, 255, 0.5) 65%,\n      rgba(191, 128, 255, 0.65) 100%\n    ),\n    linear-gradient(180deg, rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0) 60%);\n  --ball-logo-shadow-top: rgba(255, 255, 255, 0.6);\n  --ball-logo-shadow-near: rgba(0, 0, 0, 0.3);\n  --ball-logo-shadow-far: rgba(138, 43, 226, 0.45);\n  --ball-logo-filter-glow: drop-shadow(0 0 3px rgba(191, 128, 255, 0.35));\n\n  /* === SnapshotManager.vue Styles === */\n  --snapshot-accent: #3b82f6;\n  --snapshot-accent-soft: rgba(59, 130, 246, 0.3);\n  --snapshot-bg: #2d2f37;\n  --snapshot-stroke: rgba(255, 255, 255, 0.1);\n  --snapshot-text: #f9fafb;\n  --snapshot-muted: #9ca3af;\n  --snapshot-bg-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.08), transparent);\n  --snapshot-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);\n  --snapshot-outer-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n  --snapshot-focus-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);\n\n  /* Custom Button Colors */\n  --snapshot-btn-bg: #4a4a4a;\n  --snapshot-btn-text: #eee;\n  --snapshot-btn-hover-bg: #5a5a5a;\n  --snapshot-btn-active-bg: #3a3a3a;\n}\n</style>\n'],sourceRoot:''}]);const i=o},421:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.floating-ball[data-v-3bb5cc6c]{--size:50px;--hue:var(--ball-hue,212);--sat:var(--ball-sat,100%);--lum:var(--ball-lum,52%);--surface:hsl(var(--hue) var(--sat) var(--lum));--surface-2:hsl(var(--hue) 95% 64%);--ring:hsl(calc(var(--hue) + 20) 95% 65%);--shadow:var(--ball-shadow-color,rgba(0,123,255,0.36));--glow:var(--ball-glow-color,rgba(102,200,255,0.55));--inner-shadow:var(--ball-inner-shadow-color,rgba(0,0,0,0.22));--specular:var(--ball-specular-color,rgba(255,255,255,0.75));--glass:var(--ball-glass-color,rgba(255,255,255,0.18));width:var(--size);height:var(--size);border-radius:50%;position:relative;display:grid;place-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;background:radial-gradient(120% 120% at 30% 28%,rgba(255,255,255,0.85) 0%,rgba(255,255,255,0.22) 18%,rgba(255,255,255,0) 36%),radial-gradient(120% 120% at 70% 72%,rgba(0,0,0,0.18) 0%,rgba(0,0,0,0) 38%),conic-gradient(from 210deg at 50% 50%,var(--surface),var(--surface-2),var(--surface));box-shadow:inset 0 2px 6px var(--inner-shadow),0 2px 4px rgba(0,0,0,0.08),0 10px 22px var(--shadow);transition:transform 0.28s ease,box-shadow 0.28s ease,filter 0.28s ease;will-change:transform,box-shadow,filter;animation:ball-bob-3bb5cc6c 3.2s ease-in-out infinite}.floating-ball[data-v-3bb5cc6c]::after{content:\'\';position:absolute;inset:-8px;border-radius:50%;background:conic-gradient(from 0deg,var(--ring),transparent 30%,transparent 70%,var(--ring));filter:blur(6px);opacity:0.55;pointer-events:none;-webkit-mask:radial-gradient(farthest-side,transparent calc(100% - 12px),#000 0);mask:radial-gradient(farthest-side,transparent calc(100% - 12px),#000 0);animation:ring-spin-3bb5cc6c 12s linear infinite}.floating-ball[data-v-3bb5cc6c]::before{content:\'\';position:absolute;inset:2px;border-radius:50%;background:radial-gradient(120% 80% at 26% 24%,var(--specular) 0%,rgba(255,255,255,0.2) 26%,rgba(255,255,255,0) 46%),linear-gradient(160deg,var(--glass) 0%,rgba(255,255,255,0) 50%);mix-blend-mode:screen;pointer-events:none;transition:opacity 0.28s ease,transform 0.28s ease}.floating-ball[data-v-3bb5cc6c]:hover{transform:translateY(-2px) scale(1.04);box-shadow:inset 0 2px 8px rgba(0,0,0,0.22),0 4px 10px rgba(0,0,0,0.12),0 16px 36px rgba(0,123,255,0.45);filter:saturate(1.08)}.floating-ball[data-v-3bb5cc6c]:hover::before{opacity:0.95;animation:shimmer-3bb5cc6c 1.2s ease-out}.floating-ball[data-v-3bb5cc6c]:active{transform:translateY(0) scale(0.98);box-shadow:inset 0 2px 10px rgba(0,0,0,0.28),0 2px 6px rgba(0,0,0,0.12),0 10px 22px rgba(0,123,255,0.35)}.floating-ball[data-v-3bb5cc6c]:focus-visible{outline:2px solid var(--ball-focus-outline,rgba(102,200,255,0.85));outline-offset:2px}@media (prefers-reduced-motion:reduce){.floating-ball[data-v-3bb5cc6c]{animation:none}.floating-ball[data-v-3bb5cc6c]::after{animation:none}}@keyframes ball-bob-3bb5cc6c{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes ring-spin-3bb5cc6c{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes shimmer-3bb5cc6c{0%{transform:translateY(-1px) scale(0.98);opacity:0.6}50%{transform:translateY(-2px) scale(1.02);opacity:1}100%{transform:translateY(-1px) scale(0.99);opacity:0.85}}.floating-ball[data-v-3bb5cc6c]{--logo-scale:0.38}.era-logo[data-v-3bb5cc6c]{font-weight:800;font-size:calc(var(--size) * var(--logo-scale));letter-spacing:0.02em;line-height:1;transform:translateY(-1px);white-space:nowrap;-webkit-user-select:none;user-select:none;pointer-events:none;z-index:1;background:var(--ball-logo-bg,linear-gradient(180deg,rgba(255,255,255,0.96) 0%,rgba(255,255,255,0.55) 45%,rgba(220,240,255,0.4) 65%,rgba(120,195,255,0.55) 100%),linear-gradient(180deg,rgba(0,0,0,0.38),rgba(0,0,0,0) 60%));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 1px 0 var(--ball-logo-shadow-top,rgba(255,255,255,0.75)),0 2px 4px var(--ball-logo-shadow-near,rgba(0,0,0,0.25)),0 8px 18px var(--ball-logo-shadow-far,rgba(0,123,255,0.35));filter:var(--ball-logo-filter-glow,drop-shadow(0 0 2px rgba(102,200,255,0.25)));animation:era-sheen-3bb5cc6c 4s ease-in-out infinite;transition:text-shadow 0.3s ease,filter 0.3s ease}.floating-ball:hover .era-logo[data-v-3bb5cc6c]{text-shadow:0 1px 0 var(--ball-logo-shadow-top,rgba(255,255,255,0.85)),0 3px 8px var(--ball-logo-shadow-near,rgba(0,0,0,0.28)),0 10px 26px var(--ball-logo-shadow-far,rgba(0,123,255,0.55));filter:var(--ball-logo-filter-glow,drop-shadow(0 0 3px rgba(102,200,255,0.38)))}@keyframes era-sheen-3bb5cc6c{0%,100%{background-position:0% 0%,0% 0%}50%{background-position:0% 40%,0% 0%}}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/FloatingBall.vue'],names:[],mappings:'AAuBA,gCACE,WAAY,CACZ,yBAA2B,CAC3B,0BAA4B,CAC5B,yBAA2B,CAC3B,+CAAgD,CAChD,mCAAoC,CACpC,yCAA0C,CAC1C,sDAA2D,CAC3D,oDAAyD,CACzD,8DAAmE,CACnE,4DAAiE,CACjE,sDAA2D,CAC3D,iBAAkB,CAClB,kBAAmB,CACnB,iBAAkB,CAClB,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,uCAAwC,CACxC,+RAQ0G,CAC1G,mGAG0C,CAC1C,uEAGmB,CACnB,uCAA0C,CAC1C,qDACF,CAGA,uCACE,UAAW,CACX,iBAAkB,CAClB,UAAW,CACX,iBAAkB,CAClB,4FAMC,CACD,gBAAiB,CACjB,YAAa,CACb,mBAAoB,CACpB,gFAA2E,CAA3E,wEAA2E,CAC3E,gDACF,CAGA,wCACE,UAAW,CACX,iBAAkB,CAClB,SAAU,CACV,iBAAkB,CAClB,oLAE+E,CAC/E,qBAAsB,CACtB,mBAAoB,CACpB,kDAGF,CAGA,sCACE,sCAAuC,CACvC,wGAGgD,CAChD,qBACF,CAGA,8CACE,YAAa,CACb,wCACF,CAGA,uCACE,mCAAoC,CACpC,wGAIF,CAGA,8CACE,kEAAuE,CACvE,kBACF,CAGA,uCACE,gCACE,cACF,CACA,uCACE,cACF,CACF,CAGA,6BACE,QAEE,uBACF,CACA,IACE,0BACF,CACF,CAGA,8BACE,GACE,sBACF,CACA,KACE,wBACF,CACF,CAGA,4BACE,GACE,sCAAuC,CACvC,WACF,CACA,IACE,sCAAuC,CACvC,SACF,CACA,KACE,sCAAuC,CACvC,YACF,CACF,CAGA,gCACE,iBACF,CAEA,2BACE,eAAgB,CAChB,+CAAgD,CAChD,qBAAsB,CACtB,aAAc,CACd,0BAA2B,CAC3B,kBAAmB,CACnB,wBAAiB,CAAjB,gBAAiB,CACjB,mBAAoB,CACpB,SAAU,CAGV,4NAUC,CACD,4BAA6B,CAC7B,oBAAqB,CACrB,iBAAkB,CAClB,0LAG2E,CAC3E,+EAAoF,CACpF,oDAA4C,CAC5C,iDAGF,CAEA,gDACE,2LAGkE,CAClE,+EACF,CAGA,8BACE,QAEE,+BAGF,CACA,IACE,gCAGF,CACF',sourcesContent:['<template>\n  <div class="floating-ball" @click="$emit(\'click\')">\n    <span class="era-logo" aria-hidden="true">ERA</span>\n    \x3c!-- ä»…æ˜¾ç¤ºç”¨ï¼›ä¸æ‹¦æˆªäº‹ä»¶ --\x3e\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { onMounted } from \'vue\';\nimport { Logger } from \'../../utils/log\';\n\nconst logger = new Logger();\ndefineEmits([\'click\']);\n\nonMounted(() => {\n  //logger.debug(\'onMounted\', \'FloatingBall.vue ç»„ä»¶å·²æŒ‚è½½\');\n});\n<\/script>\n\n<style scoped>\n/* =========================\n   å¯è°ƒå¤–è§‚å˜é‡ï¼ˆå±€éƒ¨ä½œç”¨åŸŸï¼‰\n   ========================= */\n.floating-ball {\n  --size: 50px; /* ç›´å¾„ï¼šä¿æŒé»˜è®¤ 50pxï¼Œä¸åŸå§‹ä¸€è‡´ */\n  --hue: var(--ball-hue, 212); /* ä¸»è‰²ç›¸ï¼š212â‰ˆ#007bffï¼Œæ–¹ä¾¿å…¨å±€åè°ƒè‰²ç›¸ */\n  --sat: var(--ball-sat, 100%); /* é¥±å’Œåº¦ï¼šæ›´é²œäº® */\n  --lum: var(--ball-lum, 52%); /* æ˜åº¦ï¼šä¸»è‰²çš„æ˜åº¦ */\n  --surface: hsl(var(--hue) var(--sat) var(--lum)); /* ä¸»è¡¨é¢è‰² */\n  --surface-2: hsl(var(--hue) 95% 64%); /* æ¸å˜ç¬¬äºŒè‰²ï¼Œç•¥äº® */\n  --ring: hsl(calc(var(--hue) + 20) 95% 65%); /* å¤–ç¯çš„ç‚¹ç¼€è‰²ï¼Œåé’ä¸€ç‚¹ */\n  --shadow: var(--ball-shadow-color, rgba(0, 123, 255, 0.36)); /* é˜´å½±é¢œè‰²ï¼ˆä¸ä¸»è‰²ç›¸è¿‘ï¼‰ */\n  --glow: var(--ball-glow-color, rgba(102, 200, 255, 0.55)); /* å¤–å‘å…‰é¢œè‰² */\n  --inner-shadow: var(--ball-inner-shadow-color, rgba(0, 0, 0, 0.22)); /* å†…é˜´å½±å¢å¼ºä½“ç§¯æ„Ÿ */\n  --specular: var(--ball-specular-color, rgba(255, 255, 255, 0.75)); /* é«˜å…‰ */\n  --glass: var(--ball-glass-color, rgba(255, 255, 255, 0.18)); /* ç»ç’ƒè´¨æ„Ÿè¦†ç›–å±‚ */\n  width: var(--size); /* å®½åº¦è®¾ä¸ºå¯å˜é‡ */\n  height: var(--size); /* é«˜åº¦è®¾ä¸ºå¯å˜é‡ */\n  border-radius: 50%; /* åœ†å½¢ */\n  position: relative; /* ä½œä¸ºä¼ªå…ƒç´ å®šä½å‚ç…§ */\n  display: grid; /* ç”¨ grid å®ç°ç²¾ç¡®å±…ä¸­ */\n  place-items: center; /* å±…ä¸­å¯¹é½ */\n  cursor: pointer; /* æ‰‹å‹å…‰æ ‡ï¼ˆä»…è§†è§‰ï¼Œä¸æ”¹é€»è¾‘ï¼‰ */\n  user-select: none; /* é˜²æ­¢è¯¯é€‰ä¸­æ–‡æœ¬ */\n  -webkit-tap-highlight-color: transparent; /* ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº®å»é™¤ */\n  background:\n    radial-gradient(\n      120% 120% at 30% 28%,\n      rgba(255, 255, 255, 0.85) 0%,\n      rgba(255, 255, 255, 0.22) 18%,\n      rgba(255, 255, 255, 0) 36%\n    ),\n    /* ç»ç’ƒé«˜å…‰ */ radial-gradient(120% 120% at 70% 72%, rgba(0, 0, 0, 0.18) 0%, rgba(0, 0, 0, 0) 38%),\n    /* å¾®å†…é˜´å½±ï¼Œå¢åŠ ä½“ç§¯ */ conic-gradient(from 210deg at 50% 50%, var(--surface), var(--surface-2), var(--surface)); /* ä¸»è¡¨é¢æ¸å˜ï¼šæŸ”å’ŒæµåŠ¨æ„Ÿ */\n  box-shadow:\n    inset 0 2px 6px var(--inner-shadow),\n    /* å†…é˜´å½±ï¼šçƒä½“è¾¹ç¼˜æ”¶æŸ */ 0 2px 4px rgba(0, 0, 0, 0.08),\n    /* åŸºç¡€æŠ•å½±ï¼šè´´åœ°æ„Ÿ */ 0 10px 22px var(--shadow); /* è¿œæŠ•å½±ï¼šæ‚¬æµ®æ„Ÿ */\n  transition:\n    transform 0.28s ease,\n    box-shadow 0.28s ease,\n    filter 0.28s ease; /* æ‚¬åœæ—¶çš„å¹³æ»‘è¿‡æ¸¡ */\n  will-change: transform, box-shadow, filter; /* æç¤ºæµè§ˆå™¨ä¼˜åŒ– */\n  animation: ball-bob 3.2s ease-in-out infinite; /* è½»å¾®ä¸Šä¸‹æµ®åŠ¨ */\n}\n\n/* å…‰æ™•å¤–ç¯ï¼ˆçº¯è§†è§‰å±‚ï¼‰ï¼Œä¸å ç‚¹å‡»åŒºåŸŸ */\n.floating-ball::after {\n  content: \'\'; /* ç”Ÿæˆå¤–ç¯å±‚ */\n  position: absolute; /* ç»å¯¹å®šä½è´´åˆçˆ¶å…ƒç´  */\n  inset: -8px; /* å‘å¤–å»¶å±• 8pxï¼Œåˆ¶é€ å‘å…‰è¾¹ç¼˜ */\n  border-radius: 50%; /* ä¿æŒåœ†å½¢ */\n  background: conic-gradient(\n    from 0deg,\n    var(--ring),\n    transparent 30%,\n    transparent 70%,\n    var(--ring)\n  ); /* ç»†è…»çš„è‰²ç¯é—ªçƒ */\n  filter: blur(6px); /* æ¨¡ç³ŠæˆæŸ”å’Œå…‰æ™• */\n  opacity: 0.55; /* åŠé€æ˜ï¼Œé¿å…å–§å®¾ */\n  pointer-events: none; /* ä¸æ‹¦æˆªé¼ æ ‡äº‹ä»¶ */\n  mask: radial-gradient(farthest-side, transparent calc(100% - 12px), #000 0); /* æç©ºä¸­å¿ƒå½¢æˆç¯ */\n  animation: ring-spin 12s linear infinite; /* æ…¢é€Ÿæ—‹è½¬ï¼Œä½ä¾µæ‰° */\n}\n\n/* ç»ç’ƒé«˜å…‰å±‚ï¼ˆæ›´ç«‹ä½“ï¼‰ */\n.floating-ball::before {\n  content: \'\'; /* ç”Ÿæˆé«˜å…‰å±‚ */\n  position: absolute; /* ç»å¯¹å®šä½ */\n  inset: 2px; /* ç¼©è¿›ä¸€ç‚¹ï¼Œä¿ç•™è¾¹ç¼˜ */\n  border-radius: 50%; /* åœ†å½¢ */\n  background:\n    radial-gradient(120% 80% at 26% 24%, var(--specular) 0%, rgba(255, 255, 255, 0.2) 26%, rgba(255, 255, 255, 0) 46%),\n    /* äº®æ–‘ */ linear-gradient(160deg, var(--glass) 0%, rgba(255, 255, 255, 0) 50%); /* ç»ç’ƒè’™å±‚ */\n  mix-blend-mode: screen; /* ä¸åº•è‰²å åŠ æ›´è‡ªç„¶ */\n  pointer-events: none; /* ä¸æ‹¦æˆªäº‹ä»¶ */\n  transition:\n    opacity 0.28s ease,\n    transform 0.28s ease; /* æ‚¬åœè”åŠ¨ */\n}\n\n/* æ‚¬åœæ€ï¼šè½»å¾®æŠ¬å‡+å¢å¼ºå…‰å½± */\n.floating-ball:hover {\n  transform: translateY(-2px) scale(1.04); /* è½»å¾®å‡èµ·å¹¶æ”¾å¤§ */\n  box-shadow:\n    inset 0 2px 8px rgba(0, 0, 0, 0.22),\n    /* å†…é˜´å½±ç•¥åŠ å¼º */ 0 4px 10px rgba(0, 0, 0, 0.12),\n    /* è¿‘å½±å¢å¼º */ 0 16px 36px rgba(0, 123, 255, 0.45); /* è¿œå½±æ›´äº®ï¼Œå‘ˆç°å‘å…‰ */\n  filter: saturate(1.08); /* æå‡é¥±å’Œåº¦ä¸€ç‚¹ç‚¹ */\n}\n\n/* æ‚¬åœæ—¶çš„å¾®å…‰æ‰«è¿‡æ•ˆæœ */\n.floating-ball:hover::before {\n  opacity: 0.95; /* é«˜å…‰æ›´æ˜¾è‘— */\n  animation: shimmer 1.2s ease-out; /* ä¸€æ¬¡æ€§é«˜å…‰æ è¿‡ */\n}\n\n/* æŒ‰ä¸‹æ€ï¼šç•¥å‹ä½ */\n.floating-ball:active {\n  transform: translateY(0) scale(0.98); /* å›è½ä¸€ç‚¹å¹¶è½»å¾®å‹æ‰ */\n  box-shadow:\n    inset 0 2px 10px rgba(0, 0, 0, 0.28),\n    0 2px 6px rgba(0, 0, 0, 0.12),\n    0 10px 22px rgba(0, 123, 255, 0.35); /* å›åˆ°æ¥è¿‘åˆå§‹çš„é˜´å½± */\n}\n\n/* å¯è¾¾æ€§ï¼šé”®ç›˜èšç„¦æ—¶çš„å¯è§æè¾¹ï¼ˆä¸æ”¹å˜å¸ƒå±€ï¼‰ */\n.floating-ball:focus-visible {\n  outline: 2px solid var(--ball-focus-outline, rgba(102, 200, 255, 0.85)); /* é«˜äº®æè¾¹ */\n  outline-offset: 2px; /* å¤–ç§» 2pxï¼Œé¿å…é®æŒ¡çƒä½“ */\n}\n\n/* å‡å°‘åŠ¨æ€åå¥½ï¼šå…³é—­åŠ¨ç”»ä¿æŒé™æ€ä¼˜é›… */\n@media (prefers-reduced-motion: reduce) {\n  .floating-ball {\n    animation: none;\n  } /* å»é™¤ä¸Šä¸‹æµ®åŠ¨ */\n  .floating-ball::after {\n    animation: none;\n  } /* åœæ­¢å¤–ç¯æ—‹è½¬ */\n}\n\n/* è½»å¾®ä¸Šä¸‹æµ®åŠ¨ï¼ˆå¾ªç¯ï¼‰ */\n@keyframes ball-bob {\n  0%,\n  100% {\n    transform: translateY(0);\n  } /* èµ·ç‚¹/ç»ˆç‚¹ï¼šåŸä½ */\n  50% {\n    transform: translateY(-2px);\n  } /* ä¸­ç‚¹ï¼šä¸Šæµ® 2px */\n}\n\n/* å¤–ç¯æ…¢é€Ÿæ—‹è½¬ï¼ˆä¸åˆºçœ¼ï¼‰ */\n@keyframes ring-spin {\n  0% {\n    transform: rotate(0deg);\n  } /* èµ·ç‚¹ï¼š0 åº¦ */\n  100% {\n    transform: rotate(360deg);\n  } /* ç»ˆç‚¹ï¼šæ•´å‘¨æ—‹è½¬ */\n}\n\n/* æ‚¬åœæ—¶çš„é«˜å…‰æ‰«è¿‡ */\n@keyframes shimmer {\n  0% {\n    transform: translateY(-1px) scale(0.98);\n    opacity: 0.6;\n  } /* åˆå§‹ï¼šå¼±ä¸€ç‚¹çš„é«˜å…‰ */\n  50% {\n    transform: translateY(-2px) scale(1.02);\n    opacity: 1;\n  } /* ä¸­æ®µï¼šæœ€äº®æœ€å¤§ */\n  100% {\n    transform: translateY(-1px) scale(0.99);\n    opacity: 0.85;\n  } /* ç»“æŸï¼šå›è½ */\n}\n\n/* ======= ERA å†…æ ‡ï¼ˆä»…è§†è§‰å±‚ï¼‰ ======= */\n.floating-ball {\n  --logo-scale: 0.38;\n} /* å¯è°ƒï¼šå­—ä½“å çƒç›´å¾„æ¯”ä¾‹ */\n\n.era-logo {\n  font-weight: 800; /* ç²—ä½“ï¼Œå¢å¼ºåˆ»æ„Ÿ */\n  font-size: calc(var(--size) * var(--logo-scale)); /* è·Ÿéšçƒå¤§å°ç¼©æ”¾ */\n  letter-spacing: 0.02em; /* è½»å¾®å­—è·ï¼Œé¿å…ç³Š */\n  line-height: 1; /* ç´§å‡‘å¯¹é½ */\n  transform: translateY(-1px); /* è§†è§‰å¾®è°ƒå±…ä¸­ */\n  white-space: nowrap; /* é˜²æ­¢æ¢è¡Œ */\n  user-select: none;\n  pointer-events: none; /* ä¸æŠ¢äº‹ä»¶ã€ä¸é€‰ä¸­ */\n  z-index: 1; /* ä½äºèƒŒæ™¯ä¹‹ä¸Šï¼ˆä»åœ¨ ::after å…‰ç¯ä¹‹ä¸‹ï¼‰ */\n\n  /* æ¸å˜é•‚ç©ºå­— + ç«‹ä½“é˜´å½± */\n  background: var(\n    --ball-logo-bg,\n    linear-gradient(\n      180deg,\n      rgba(255, 255, 255, 0.96) 0%,\n      rgba(255, 255, 255, 0.55) 45%,\n      rgba(220, 240, 255, 0.4) 65%,\n      rgba(120, 195, 255, 0.55) 100%\n    ),\n    linear-gradient(180deg, rgba(0, 0, 0, 0.38), rgba(0, 0, 0, 0) 60%)\n  );\n  -webkit-background-clip: text;\n  background-clip: text; /* æ¸å˜è£å‰ªåˆ°æ–‡å­— */\n  color: transparent; /* é•‚ç©ºå¡«å……ç”±èƒŒæ™¯æä¾› */\n  text-shadow:\n    0 1px 0 var(--ball-logo-shadow-top, rgba(255, 255, 255, 0.75)),\n    /* é¡¶éƒ¨æ£å…‰ */ 0 2px 4px var(--ball-logo-shadow-near, rgba(0, 0, 0, 0.25)),\n    /* è¿‘é˜´å½± */ 0 8px 18px var(--ball-logo-shadow-far, rgba(0, 123, 255, 0.35)); /* è¿œå‘å…‰é˜´å½± */\n  filter: var(--ball-logo-filter-glow, drop-shadow(0 0 2px rgba(102, 200, 255, 0.25))); /* æŸ”å…‰æ™• */\n  animation: era-sheen 4s ease-in-out infinite; /* è½»å¾®é«˜å…‰æµåŠ¨ */\n  transition:\n    text-shadow 0.3s ease,\n    filter 0.3s ease;\n}\n\n.floating-ball:hover .era-logo {\n  text-shadow:\n    0 1px 0 var(--ball-logo-shadow-top, rgba(255, 255, 255, 0.85)),\n    0 3px 8px var(--ball-logo-shadow-near, rgba(0, 0, 0, 0.28)),\n    0 10px 26px var(--ball-logo-shadow-far, rgba(0, 123, 255, 0.55)); /* æ‚¬åœå¢å¼ºç«‹ä½“æ„Ÿ */\n  filter: var(--ball-logo-filter-glow, drop-shadow(0 0 3px rgba(102, 200, 255, 0.38))); /* å‘å…‰ç•¥åŠ å¼º */\n}\n\n/* é«˜å…‰ç¼“æ…¢ä¸Šç§»ï¼Œåˆ¶é€ ç»ç’ƒæµå…‰æ„Ÿï¼ˆä½ä¾µæ‰°ï¼‰ */\n@keyframes era-sheen {\n  0%,\n  100% {\n    background-position:\n      0% 0%,\n      0% 0%;\n  }\n  50% {\n    background-position:\n      0% 40%,\n      0% 0%;\n  }\n}\n</style>\n'],sourceRoot:''}]);const i=o},424:(e,n,t)=>{function a(e,n){for(var t=[],a={},r=0;r<n.length;r++){var s=n[r],o=s[0],i={id:e+':'+r,css:s[1],media:s[2],sourceMap:s[3]};a[o]?a[o].parts.push(i):t.push(a[o]={id:o,parts:[i]})}return t}t.d(n,{A:()=>g});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var s={},o=r&&(document.head||document.getElementsByTagName('head')[0]),i=null,l=0,c=!1,d=function(){},p=null,A='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(e,n,t,r){c=t,p=r||{};var o=a(e,n);return C(o),function(n){for(var t=[],r=0;r<o.length;r++){var i=o[r];(l=s[i.id]).refs--,t.push(l)}n?C(o=a(e,n)):o=[];for(r=0;r<t.length;r++){var l;if(0===(l=t[r]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete s[l.id]}}}}function C(e){for(var n=0;n<e.length;n++){var t=e[n],a=s[t.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](t.parts[r]);for(;r<t.parts.length;r++)a.parts.push(m(t.parts[r]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var o=[];for(r=0;r<t.parts.length;r++)o.push(m(t.parts[r]));s[t.id]={id:t.id,refs:1,parts:o}}}}function b(){var e=document.createElement('style');return e.type='text/css',o.appendChild(e),e}function m(e){var n,t,a=document.querySelector('style['+A+'~="'+e.id+'"]');if(a){if(c)return d;a.parentNode.removeChild(a)}if(u){var r=l++;a=i||(i=b()),n=v.bind(null,a,r,!1),t=v.bind(null,a,r,!0)}else a=b(),n=x.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var f,h=(f=[],function(e,n){return f[e]=n,f.filter(Boolean).join('\n')});function v(e,n,t,a){var r=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=h(n,r);else{var s=document.createTextNode(r),o=e.childNodes;o[n]&&e.removeChild(o[n]),o.length?e.insertBefore(s,o[n]):e.appendChild(s)}}function x(e,n){var t=n.css,a=n.media,r=n.sourceMap;if(a&&e.setAttribute('media',a),p.ssrId&&e.setAttribute(A,n.id),r&&(t+='\n/*# sourceURL='+r.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},426:(e,n,t)=>{var a=t(883);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('c3f2796c',a,!1,{ssrId:!0})},427:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.details-wrapper[data-v-6079192c]{display:flex;flex-direction:column;gap:10px}.detail-block[data-v-6079192c]{padding:10px 12px;background:var(--bg-soft);border:1px solid var(--border-soft);border-radius:10px;transition:background 0.3s ease,border-color 0.3s ease}.detail-title[data-v-6079192c]{margin:0 0 8px;font-size:13px;font-weight:800;color:var(--text-subtitle);transition:color 0.3s ease}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/EraPanelContent/OperationDetails.vue'],names:[],mappings:'AA4BA,kCACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,+BACE,iBAAkB,CAClB,yBAA0B,CAC1B,mCAAoC,CACpC,kBAAmB,CACnB,sDAGF,CAEA,+BACE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,0BAA2B,CAC3B,0BACF',sourcesContent:['<template>\n  <EraAccordion title="ERA æœ€æ–°æ“ä½œè¯¦æƒ…" :default-open="false">\n    <template #default>\n      <div class="details-wrapper">\n        <div class="detail-block">\n          <h4 class="detail-title">SelectedMksï¼ˆæ•°ç»„ï¼‰</h4>\n          <PrettyJsonViewer :value="data.selectedMks" :default-collapsed="true" :max-depth="3" />\n        </div>\n        <div class="detail-block">\n          <h4 class="detail-title">EditLogsï¼ˆå¯¹è±¡ï¼‰</h4>\n          <PrettyJsonViewer :value="data.editLogs" :default-collapsed="true" :max-depth="2" />\n        </div>\n      </div>\n    </template>\n  </EraAccordion>\n</template>\n\n<script setup lang="ts">\nimport type { WriteDonePayload } from \'../../../utils/constants\';\nimport EraAccordion from \'../../template/EraAccordion.vue\';\nimport PrettyJsonViewer from \'../../template/PrettyJsonViewer.vue\';\n\ndefineProps<{\n  data: WriteDonePayload;\n}>();\n<\/script>\n\n<style scoped>\n.details-wrapper {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.detail-block {\n  padding: 10px 12px;\n  background: var(--bg-soft);\n  border: 1px solid var(--border-soft);\n  border-radius: 10px;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n.detail-title {\n  margin: 0 0 8px;\n  font-size: 13px;\n  font-weight: 800;\n  color: var(--text-subtitle);\n  transition: color 0.3s ease;\n}\n</style>\n'],sourceRoot:''}]);const i=o},498:(e,n,t)=>{var a=t(223);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('07590416',a,!1,{ssrId:!0})},608:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.meta[data-v-9a5820b4]{position:relative;border:1px solid var(--border-soft);border-radius:12px;background:var(--meta-bg);box-shadow:var(--meta-shadow),var(--settings-shadow-inset);transition:background 0.3s ease,border-color 0.3s ease}.kv[data-v-9a5820b4]{display:grid;grid-template-columns:120px 1fr;gap:8px 12px}.item[data-v-9a5820b4]{display:contents}.k[data-v-9a5820b4]{justify-self:start;align-self:center;font-size:12px;color:var(--text-normal);background:var(--meta-key-bg);border:1px solid var(--settings-border-input);padding:4px 8px;border-radius:8px;font-weight:700;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.v[data-v-9a5820b4]{align-self:center;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:var(--settings-text-input);background:var(--bg-solid);border:1px solid var(--settings-border-input);padding:6px 8px;border-radius:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/EraPanelContent/MetaHeader.vue'],names:[],mappings:'AAgDA,uBACE,iBAAkB,CAElB,mCAAoC,CACpC,kBAAmB,CACnB,yBAA0B,CAC1B,0DAA4D,CAC5D,sDAGF,CAEA,qBACE,YAAa,CACb,+BAAgC,CAChC,YACF,CACA,uBACE,gBACF,CACA,oBACE,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,6BAA8B,CAC9B,6CAA8C,CAC9C,eAAgB,CAChB,iBAAkB,CAClB,eAAgB,CAChB,sEAIF,CACA,oBACE,iBAAkB,CAClB,iDAAqD,CACrD,cAAe,CACf,gCAAiC,CACjC,0BAA2B,CAC3B,6CAA8C,CAC9C,eAAgB,CAChB,iBAAkB,CAClB,eAAgB,CAChB,sBAAuB,CACvB,kBAAmB,CACnB,sEAIF',sourcesContent:['<template>\n  <section class="meta">\n    <div class="kv">\n      <div class="item">\n        <span class="k">mk</span>\n        \x3c!-- é”®ï¼šmk --\x3e\n        <span class="v" :title="mk">{{ mk || \'â€”\' }}</span>\n        \x3c!-- å€¼ï¼šmk --\x3e\n      </div>\n      <div class="item">\n        <span class="k">message_id</span>\n        \x3c!-- é”®ï¼šmessage_id --\x3e\n        <span class="v">{{ messageId ?? \'â€”\' }}</span>\n        \x3c!-- å€¼ï¼šmessage_id --\x3e\n      </div>\n      <div class="item">\n        <span class="k">æ¥æº</span>\n        \x3c!-- é”®ï¼šæ¥æº --\x3e\n        <span class="v">{{ isUser ? \'ç”¨æˆ·\' : \'AI\' }}</span>\n        \x3c!-- å€¼ï¼šæ¥æº --\x3e\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\nimport { onMounted, watch } from \'vue\';\nimport { Logger } from \'../../../utils/log\';\n\nconst logger = new Logger();\n\n// æ¥æ”¶çˆ¶ç»„ä»¶ä¼ å…¥çš„ä¸¤ä¸ªå­—æ®µ\nconst props = defineProps<{ mk: string; messageId: number; isUser: boolean }>(); // ç®€å•çš„åªè¯»å±•ç¤º\n\nonMounted(() => {\n  //logger.debug(\'onMounted\', \'ç»„ä»¶å·²æŒ‚è½½\', { props });\n});\n\nwatch(\n  () => props,\n  newProps => {\n    logger.debug(\'watch:props\', \'Props å‘ç”Ÿå˜åŒ–\', { newProps });\n  },\n  { deep: true },\n);\n<\/script>\n\n<style scoped>\n.meta {\n  position: relative;\n  /* padding is handled by EraAccordion\'s .inner */\n  border: 1px solid var(--border-soft);\n  border-radius: 12px;\n  background: var(--meta-bg);\n  box-shadow: var(--meta-shadow), var(--settings-shadow-inset);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n.kv {\n  display: grid;\n  grid-template-columns: 120px 1fr;\n  gap: 8px 12px;\n}\n.item {\n  display: contents;\n}\n.k {\n  justify-self: start;\n  align-self: center;\n  font-size: 12px;\n  color: var(--text-normal);\n  background: var(--meta-key-bg);\n  border: 1px solid var(--settings-border-input);\n  padding: 4px 8px;\n  border-radius: 8px;\n  font-weight: 700;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n.v {\n  align-self: center;\n  font-family: ui-monospace, Menlo, Consolas, monospace;\n  font-size: 12px;\n  color: var(--settings-text-input);\n  background: var(--bg-solid);\n  border: 1px solid var(--settings-border-input);\n  padding: 6px 8px;\n  border-radius: 8px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n</style>\n'],sourceRoot:''}]);const i=o},639:(e,n,t)=>{var a=t(88);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('61e87139',a,!1,{ssrId:!0})},644:(e,n,t)=>{var a=t(713);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('29beb0f2',a,!1,{ssrId:!0})},713:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.right-rail[data-v-61d00544]{flex:1 1 420px;min-width:400px;height:min(680px,86vh);position:sticky;top:10px;align-self:flex-start;z-index:1;display:flex;flex-direction:column}.right-rail-content-wrapper[data-v-61d00544]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;flex-grow:1}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/RightRail.vue'],names:[],mappings:'AAiBA,6BACE,cAAe,CACf,eAAgB,CAChB,sBAAwB,CACxB,eAAgB,CAChB,QAAS,CACT,qBAAsB,CACtB,SAAU,CACV,YAAa,CACb,qBACF,CAEA,6CACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,eAAgB,CAChB,WACF',sourcesContent:['<template>\n  <aside class="right-rail">\n    <div class="right-rail-content-wrapper">\n      <ActionButtons />\n      <EraSettingsPanel />\n      <AboutEra />\n    </div>\n  </aside>\n</template>\n\n<script setup lang="ts">\nimport AboutEra from \'./RightRailContent/AboutEra.vue\';\nimport ActionButtons from \'./RightRailContent/ActionButtons.vue\';\nimport EraSettingsPanel from \'./RightRailContent/EraSettingsPanel.vue\';\n<\/script>\n\n<style scoped>\n.right-rail {\n  flex: 1 1 420px;\n  min-width: 400px;\n  height: min(680px, 86vh);\n  position: sticky;\n  top: 10px;\n  align-self: flex-start;\n  z-index: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.right-rail-content-wrapper {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  overflow-y: auto;\n  flex-grow: 1;\n}\n</style>\n'],sourceRoot:''}]);const i=o},741:(e,n,t)=>{var a=t(236);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('27f92df2',a,!1,{ssrId:!0})},751:(e,n,t)=>{var a=t(316);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('6c3d592e',a,!1,{ssrId:!0})},760:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.tabs[data-v-2874077c]{border:1px solid var(--border-soft);border-radius:12px;overflow:hidden;background:var(--accordion-bg);transition:background 0.3s ease,border-color 0.3s ease}.tab-bar[data-v-2874077c]{display:flex;gap:8px;padding:8px;border-bottom:1px solid var(--border-soft);background:var(--mk-pill-null-bg);transition:background 0.3s ease,border-color 0.3s ease}.tab-btn[data-v-2874077c]{padding:8px 12px;font-weight:800;font-size:13px;color:var(--text-normal);background:var(--bg-solid);border:1px solid var(--settings-border-input);border-radius:10px;cursor:pointer;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,box-shadow 0.3s ease}.tab-btn.active[data-v-2874077c]{color:var(--settings-text-input);border-color:var(--settings-border-btn-primary);box-shadow:var(--settings-shadow-inset),var(--tab-active-shadow)}.tab-content[data-v-2874077c]{padding:10px 12px;background:var(--tab-content-bg);transition:background 0.3s ease}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/template/TabSwitch.vue'],names:[],mappings:'AA+DA,uBACE,mCAAoC,CACpC,kBAAmB,CACnB,eAAgB,CAChB,8BAA+B,CAC/B,sDAGF,CACA,0BACE,YAAa,CACb,OAAQ,CACR,WAAY,CACZ,0CAA2C,CAC3C,iCAAkC,CAClC,sDAGF,CACA,0BACE,gBAAiB,CACjB,eAAgB,CAChB,cAAe,CACf,wBAAyB,CACzB,0BAA2B,CAC3B,6CAA8C,CAC9C,kBAAmB,CACnB,cAAe,CACf,2FAKF,CACA,iCACE,gCAAiC,CACjC,+CAAgD,CAChD,gEACF,CACA,8BACE,iBAAkB,CAClB,gCAAiC,CACjC,+BACF',sourcesContent:['<template>\n  <section class="tabs">\n    \x3c!-- é¡µç­¾è¡Œ --\x3e\n    <div class="tab-bar" role="tablist">\n      <button\n        v-for="t in tabs"\n        :key="t.key"\n        class="tab-btn"\n        :class="{ active: t.key === innerActive }"\n        role="tab"\n        @click="setActive(t.key)"\n      >\n        {{ t.label }}\n      </button>\n    </div>\n\n    \x3c!-- å†…å®¹åŒºï¼šæ ¹æ®æ´»åŠ¨é”®æ¸²æŸ“å¯¹åº”æ’æ§½ --\x3e\n    <div class="tab-content">\n      <div v-if="innerActive === \'pure\'">\n        <slot name="pure" />\n        \x3c!-- çº¯å‡€çŠ¶æ€æ•°æ®å†…å®¹ --\x3e\n      </div>\n      <div v-else>\n        <slot name="full" />\n        \x3c!-- å®Œæ•´çŠ¶æ€æ•°æ®å†…å®¹ --\x3e\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\nimport { onMounted, ref, watch } from \'vue\'; // å¼•å…¥å“åº”å¼å·¥å…·\nimport { Logger } from \'../../utils/log\';\n\ntype TabItem = { key: \'pure\' | \'full\'; label: string }; // Tab é¡¹ç±»å‹\n\nconst logger = new Logger();\nconst props = defineProps<{ tabs: TabItem[]; active?: \'pure\' | \'full\' }>(); // è¾“å…¥ tabs ä¸å¯é€‰ active\nconst emit = defineEmits<{ \'update:active\': [\'pure\' | \'full\'] }>(); // v-model:active\n\nconst innerActive = ref<\'pure\' | \'full\'>(props.active ?? \'pure\'); // å†…éƒ¨æ´»åŠ¨é”®\n\nwatch(\n  () => props.active,\n  v => {\n    if (v) {\n      logger.debug(\'watch:active\', `å¤–éƒ¨åŒæ­¥ active tab ä¸º: ${v}`);\n      innerActive.value = v;\n    }\n  },\n); // å¤–éƒ¨å˜æ›´æ—¶åŒæ­¥\nfunction setActive(k: \'pure\' | \'full\') {\n  logger.debug(\'setActive\', `ç”¨æˆ·ç‚¹å‡»ï¼Œåˆ‡æ¢ tab åˆ°: ${k}`);\n  innerActive.value = k;\n  emit(\'update:active\', k);\n} // åˆ‡æ¢å¹¶æŠ›å‡º\n\nonMounted(() => {\n  //logger.debug(\'onMounted\', \'ç»„ä»¶å·²æŒ‚è½½\', { props });\n});\n<\/script>\n\n<style scoped>\n.tabs {\n  border: 1px solid var(--border-soft);\n  border-radius: 12px;\n  overflow: hidden;\n  background: var(--accordion-bg);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n.tab-bar {\n  display: flex;\n  gap: 8px;\n  padding: 8px;\n  border-bottom: 1px solid var(--border-soft);\n  background: var(--mk-pill-null-bg);\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n.tab-btn {\n  padding: 8px 12px;\n  font-weight: 800;\n  font-size: 13px;\n  color: var(--text-normal);\n  background: var(--bg-solid);\n  border: 1px solid var(--settings-border-input);\n  border-radius: 10px;\n  cursor: pointer;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease,\n    box-shadow 0.3s ease;\n}\n.tab-btn.active {\n  color: var(--settings-text-input);\n  border-color: var(--settings-border-btn-primary);\n  box-shadow: var(--settings-shadow-inset), var(--tab-active-shadow);\n}\n.tab-content {\n  padding: 10px 12px;\n  background: var(--tab-content-bg);\n  transition: background 0.3s ease;\n}\n</style>\n'],sourceRoot:''}]);const i=o},766:(e,n,t)=>{var a=t(301);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('fe9eba16',a,!1,{ssrId:!0})},776:(e,n,t)=>{var a=t(399);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('0010a921',a,!1,{ssrId:!0})},790:e=>{e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),s='/*# '.concat(r,' */');return[n].concat([s]).join('\n')}return[n].join('\n')}},793:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.json-line[data-v-6c2ac46e]{position:relative;display:flex;align-items:center;gap:6px;padding:2px 6px;border-radius:6px;transition:background 0.2s ease}.json-line[data-v-6c2ac46e]:hover{background:var(--json-hover-bg)}.json-children[data-v-6c2ac46e]{border-left:1px dashed var(--json-tree-line);transition:border-color 0.3s ease}.key[data-v-6c2ac46e]{color:var(--json-key-color);font-weight:700;transition:color 0.3s ease}.colon[data-v-6c2ac46e]{color:var(--text-normal);transition:color 0.3s ease}.brace[data-v-6c2ac46e]{color:var(--text-normal);transition:color 0.3s ease}.summary[data-v-6c2ac46e]{color:var(--text-normal);margin-left:4px;transition:color 0.3s ease}.val.string[data-v-6c2ac46e]{color:var(--json-val-string)}.val.number[data-v-6c2ac46e]{color:var(--json-val-number)}.val.boolean[data-v-6c2ac46e]{color:var(--json-val-boolean)}.val.null[data-v-6c2ac46e]{color:var(--json-val-null)}.val.undefined[data-v-6c2ac46e]{color:var(--json-val-null)}.caret[data-v-6c2ac46e]{width:18px;height:18px;border:1px solid var(--border-soft);border-radius:4px;background:var(--bg-solid);line-height:16px;text-align:center;font-size:10px;color:var(--text-normal);cursor:pointer;box-shadow:var(--json-caret-shadow);transition:transform 0.18s ease,box-shadow 0.18s ease,background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.caret.open[data-v-6c2ac46e]{transform:rotate(90deg);box-shadow:var(--json-caret-open-shadow)}.node[data-v-6c2ac46e]{overflow:clip;contain:paint;min-height:0}.json-children[data-v-6c2ac46e]{overflow:clip;contain:paint}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/template/JsonNode.vue'],names:[],mappings:'AAoJA,4BACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,eAAgB,CAChB,iBAAkB,CAClB,+BACF,CACA,kCACE,+BACF,CACA,gCACE,4CAA6C,CAC7C,iCACF,CAGA,sBACE,2BAA4B,CAC5B,eAAgB,CAChB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,0BACE,wBAAyB,CACzB,eAAgB,CAChB,0BACF,CACA,6BACE,4BACF,CACA,6BACE,4BACF,CACA,8BACE,6BACF,CACA,2BACE,0BACF,CACA,gCACE,0BACF,CAGA,wBACE,UAAW,CACX,WAAY,CACZ,mCAAoC,CACpC,iBAAkB,CAClB,0BAA2B,CAC3B,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,cAAe,CACf,mCAAoC,CACpC,iHAMF,CACA,6BACE,uBAAwB,CACxB,wCACF,CAGA,uBAEE,aAAc,CACd,aAAc,CACd,YACF,CAEA,gCAEE,aAAc,CACd,aACF',sourcesContent:['<template>\n  \x3c!-- å•æ¡èŠ‚ç‚¹ï¼ˆæ”¯æŒé€’å½’ï¼‰ --\x3e\n  <div class="node">\n    \x3c!-- æ¯ä¸ªé”®å€¼å¯¹ / æ•°ç»„é¡¹çš„å®¹å™¨ --\x3e\n    <div class="json-line" :style="{ paddingLeft: level * 14 + \'px\' }">\n      \x3c!-- è¡Œ+ç¼©è¿› --\x3e\n      <button v-if="foldable" class="caret" :class="{ open }" aria-label="toggle" @click="open = !open">â–¸</button>\n      \x3c!-- æŠ˜å ç®­å¤´æŒ‰é’® --\x3e\n\n      <span class="key">{{ k }}</span\n      ><span class="colon">:</span>\n      \x3c!-- é”®ä¸å†’å· --\x3e\n\n      \x3c!-- å¯æŠ˜å å®¹å™¨ï¼šåªæ˜¾ç¤ºæ‹¬å·ä¸æ‘˜è¦ï¼›å±•å¼€åç”±ä¸‹æ–¹ children åŒºåŸŸé€’å½’æ¸²æŸ“ --\x3e\n      <template v-if="foldable">\n        <span class="brace">{{ isArray ? \'[\' : \'{\' }}</span>\n        \x3c!-- å®¹å™¨èµ·å§‹æ‹¬å· --\x3e\n        <span v-if="!open" class="summary">{{ summary }}</span>\n        \x3c!-- æ”¶èµ·æ—¶çš„æ‘˜è¦ --\x3e\n      </template>\n\n      \x3c!-- åŸå§‹å€¼ï¼šç›´æ¥ç€è‰²æ¸²æŸ“ --\x3e\n      <template v-else>\n        <span class="val" :class="type">{{ primitiveText }}</span>\n        \x3c!-- åŸå§‹å€¼æ–‡æœ¬ --\x3e\n      </template>\n    </div>\n\n    \x3c!-- å­å…ƒç´ åŒºåŸŸï¼šä»…å½“å¯æŠ˜å ä¸”å¤„äºå±•å¼€æ€æ—¶æ˜¾ç¤º --\x3e\n    <template v-if="foldable && open">\n      <div class="json-children">\n        \x3c!-- é€’å½’ï¼šè‡ªå¼•ç”¨åŒåç»„ä»¶ JsonNodeï¼ˆä¾èµ– name: \'JsonNode\' å®ç°è‡ªé€’å½’ï¼‰ --\x3e\n        <JsonNode\n          v-for="(childVal, childKey) in childEntries"\n          :key="path + \'/\' + String(childKey)"\n          :k="String(childKey)"\n          :v="childVal"\n          :path="path + \'/\' + String(childKey)"\n          :level="level + 1"\n          :default-collapsed="defaultCollapsed"\n          :max-depth="maxDepth"\n        />\n        <div class="json-line" :style="{ paddingLeft: level * 14 + \'px\' }">\n          <span class="brace">{{ isArray ? \']\' : \'}\' }}</span>\n          \x3c!-- å®¹å™¨é—­åˆæ‹¬å· --\x3e\n        </div>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script lang="ts">\nimport { computed, defineComponent, onMounted, ref, watch } from \'vue\'; // å¼•å…¥å“åº”å¼/ç»„ä»¶å·¥å…·\nimport { Logger } from \'../../utils/log\';\n\nexport default defineComponent({\n  name: \'JsonNode\', // å…³é”®ï¼šä¸ºè‡ªé€’å½’æä¾›ç»„ä»¶å\n  props: {\n    k: { type: [String, Number], required: true }, // å½“å‰é”®ï¼ˆæˆ–æ•°ç»„ä¸‹æ ‡ï¼‰\n    v: { required: true }, // å½“å‰å€¼\n    path: { type: String, required: true }, // è·¯å¾„ï¼ˆä»…ç”¨äº key/è°ƒè¯•ï¼‰\n    level: { type: Number, required: true }, // å±‚çº§ï¼ˆç”¨äºç¼©è¿›ï¼‰\n    defaultCollapsed: { type: Boolean, default: true }, // é»˜è®¤æ˜¯å¦æŠ˜å \n    maxDepth: { type: Number, default: 3 }, // åˆæ¬¡å±•å¼€çš„æœ€å¤§æ·±åº¦\n  },\n  setup(p) {\n    const logger = new Logger();\n\n    onMounted(() => {\n      //logger.debug(\'onMounted\', \'ç»„ä»¶å·²æŒ‚è½½\', { props: p });\n    });\n\n    // èŠ‚ç‚¹ç±»å‹åˆ¤å®š\n    const type = computed(() => {\n      const val = p.v;\n      if (val === null) return \'null\';\n      if (Array.isArray(val)) return \'array\';\n      const t = typeof val;\n      if (t === \'object\') return \'object\';\n      if (t === \'undefined\') return \'undefined\';\n      return t as \'string\' | \'number\' | \'boolean\' | \'bigint\' | \'symbol\' | \'function\';\n    });\n\n    // æ˜¯å¦æ•°ç»„/å¯¹è±¡\n    const isArray = computed(() => type.value === \'array\');\n    const isObject = computed(() => type.value === \'object\');\n\n    // æ˜¯å¦å¯æŠ˜å \n    const foldable = computed(() => isArray.value || isObject.value);\n\n    // åˆå§‹å¼€åˆï¼šä¸è¶…è¿‡ maxDepth çš„å±‚çº§é»˜è®¤å±•å¼€ï¼›å¦åˆ™éµå¾ª defaultCollapsed\n    const open = ref<boolean>(p.level <= (p.maxDepth ?? 3) ? true : !p.defaultCollapsed);\n\n    watch(open, newOpenState => {\n      logger.debug(\'watch:open\', `æŠ˜å çŠ¶æ€æ”¹å˜ä¸º: ${newOpenState ? \'å±•å¼€\' : \'æ”¶èµ·\'}`);\n    });\n\n    // åŸå§‹å€¼æ¸²æŸ“æ–‡æœ¬ï¼ˆè¡¥è¶³ undefined / bigint / symbolï¼‰\n    const primitiveText = computed(() => {\n      const val = p.v as any;\n      switch (type.value) {\n        case \'string\':\n          return JSON.stringify(val);\n        case \'number\':\n          return String(val);\n        case \'boolean\':\n          return val ? \'true\' : \'false\';\n        case \'null\':\n          return \'null\';\n        case \'undefined\':\n          return \'undefined\';\n        case \'bigint\':\n          return String(val) + \'n\';\n        case \'symbol\':\n          return String(val);\n        case \'function\':\n          return \'Æ’()\';\n        default:\n          return \'\';\n      }\n    });\n\n    // æ”¶èµ·æ—¶çš„æ‘˜è¦ä¿¡æ¯\n    const summary = computed(() => {\n      if (isArray.value) return `Array[${(p.v as any[]).length}]`;\n      if (isObject.value) return `Object{${Object.keys(p.v || {}).length}}`;\n      return \'\';\n    });\n\n    // å­é¡¹åˆ—è¡¨ï¼šå¯¹è±¡ â†’ å…¶ entriesï¼›æ•°ç»„ â†’ ç›´æ¥æšä¸¾ç´¢å¼•å’Œå€¼\n    const childEntries = computed<Record<string, any>>(() => {\n      if (isObject.value) return p.v as Record<string, any>;\n      if (isArray.value) {\n        const out: Record<string, any> = {};\n        (p.v as any[]).forEach((cv, idx) => {\n          out[String(idx)] = cv;\n        });\n        return out;\n      }\n      return {};\n    });\n\n    return { type, isArray, foldable, open, primitiveText, summary, childEntries };\n  },\n});\n<\/script>\n\n<style scoped>\n.json-line {\n  position: relative;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 2px 6px;\n  border-radius: 6px;\n  transition: background 0.2s ease;\n}\n.json-line:hover {\n  background: var(--json-hover-bg);\n}\n.json-children {\n  border-left: 1px dashed var(--json-tree-line);\n  transition: border-color 0.3s ease;\n}\n\n/* ç»“æ„å…ƒç´ ä¸ç€è‰² */\n.key {\n  color: var(--json-key-color);\n  font-weight: 700;\n  transition: color 0.3s ease;\n}\n.colon {\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n}\n.brace {\n  color: var(--text-normal);\n  transition: color 0.3s ease;\n}\n.summary {\n  color: var(--text-normal);\n  margin-left: 4px;\n  transition: color 0.3s ease;\n}\n.val.string {\n  color: var(--json-val-string);\n}\n.val.number {\n  color: var(--json-val-number);\n}\n.val.boolean {\n  color: var(--json-val-boolean);\n}\n.val.null {\n  color: var(--json-val-null);\n}\n.val.undefined {\n  color: var(--json-val-null);\n}\n\n/* æŠ˜å ç®­å¤´ */\n.caret {\n  width: 18px;\n  height: 18px;\n  border: 1px solid var(--border-soft);\n  border-radius: 4px;\n  background: var(--bg-solid);\n  line-height: 16px;\n  text-align: center;\n  font-size: 10px;\n  color: var(--text-normal);\n  cursor: pointer;\n  box-shadow: var(--json-caret-shadow);\n  transition:\n    transform 0.18s ease,\n    box-shadow 0.18s ease,\n    background 0.3s ease,\n    border-color 0.3s ease,\n    color 0.3s ease;\n}\n.caret.open {\n  transform: rotate(90deg);\n  box-shadow: var(--json-caret-open-shadow);\n}\n\n/* ===[æ–°å¢] é˜²æº¢å‡ºï¼šèŠ‚ç‚¹ä¸å­æ ‘éƒ½è£å‰ªï¼ˆé…åˆä¸Šå±‚æŠ˜å æ—¶å½»åº•çœ‹ä¸è§ï¼‰ === */\n.node {\n  /* å•ä¸ªèŠ‚ç‚¹å®¹å™¨ */\n  overflow: clip; /* è£å‰ªèŠ‚ç‚¹å†…éƒ¨æ‰€æœ‰ç»˜åˆ¶ */\n  contain: paint; /* éš”ç¦»ç»˜åˆ¶ï¼Œé¿å… 1px æ¸²æŸ“å¤–æ³„ */\n  min-height: 0; /* é˜²â€œæœ€å°é«˜åº¦â€æŠŠçˆ¶çº§æ’‘å¼€ */\n}\n\n.json-children {\n  /* å­èŠ‚ç‚¹åŒºåŸŸ */\n  overflow: clip; /* è£å‰ªå­æ ‘ï¼ˆå«å·¦ä¾§è™šçº¿ç­‰è£…é¥°ï¼‰ */\n  contain: paint; /* é˜²æ­¢å­å…ƒç´ é˜´å½±/è¾¹æ¡†è¶…ç•Œ */\n}\n</style>\n'],sourceRoot:''}]);const i=o},800:(e,n)=>{n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},854:(e,n,t)=>{var a=t(145);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('3b5a8a69',a,!1,{ssrId:!0})},883:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var a=t(790),r=t.n(a),s=t(54),o=t.n(s)()(r());o.push([e.id,'.about-era-card[data-v-9b1026a6]{width:100%;padding:12px;background:var(--actions-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--actions-shadow-card),var(--shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-title[data-v-9b1026a6]{margin:0 0 4px;font-size:14px;font-weight:800;letter-spacing:0.3px;color:var(--text-title);transition:color 0.3s ease}.info-list[data-v-9b1026a6]{font-size:13px;color:var(--text-normal)}.info-list ul[data-v-9b1026a6]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.info-list li[data-v-9b1026a6]{display:flex;justify-content:space-between}.info-list a[data-v-9b1026a6]{color:var(--text-subtitle);text-decoration:none;font-weight:600;transition:color 0.3s ease}.info-list a[data-v-9b1026a6]:hover{color:var(--text-title);text-decoration:underline}\n','',{version:3,sources:['webpack://./src/ERAå˜é‡æ¡†æ¶/ui/components/RightRailContent/AboutEra.vue'],names:[],mappings:'AAqCA,iCACE,UAAW,CACX,YAAa,CACb,kCAAmC,CACnC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,yDAA2D,CAC3D,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAEA,6BACE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CAEA,4BACE,cAAe,CACf,wBACF,CAEA,+BACE,eAAgB,CAChB,SAAU,CACV,QAAS,CACT,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,+BACE,YAAa,CACb,6BACF,CAEA,8BACE,0BAA2B,CAC3B,oBAAqB,CACrB,eAAgB,CAChB,0BACF,CAEA,oCACE,uBAAwB,CACxB,yBACF',sourcesContent:['<template>\n  <section class="about-era-card" role="complementary" aria-label="å…³äº ERA">\n    <h4 class="card-title">å…³äº ERA</h4>\n    <div class="info-list">\n      <ul>\n        <li>\n          <strong>ERA é¡¹ç›®åœ°å€:</strong>\n          <a\n            href="https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master"\n            target="_blank"\n            rel="noopener noreferrer"\n          >\n            GitHub\n          </a>\n        </li>\n        <li>\n          <strong>ERA ä»‹ç»å¸–:</strong>\n          <a\n            href="https://discord.com/channels/1134557553011998840/1423319849400270928"\n            target="_blank"\n            rel="noopener noreferrer"\n          >\n            Discord\n          </a>\n        </li>\n        <li><strong>ä½œè€…:</strong> ä¸–ç•Œçš„å±±ç”°</li>\n        <li><strong>ERA æ¡†æ¶äº¤æµç¾¤:</strong> 1006127516</li>\n      </ul>\n    </div>\n  </section>\n</template>\n\n<script setup lang="ts">\n// This component is purely informational.\n<\/script>\n\n<style scoped>\n.about-era-card {\n  width: 100%;\n  padding: 12px;\n  background: var(--actions-bg-glass);\n  border: 1px solid var(--border-strong);\n  border-radius: 16px;\n  backdrop-filter: blur(10px);\n  box-shadow: var(--actions-shadow-card), var(--shadow-inset);\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  transition:\n    background 0.3s ease,\n    border-color 0.3s ease;\n}\n\n.card-title {\n  margin: 0 0 4px;\n  font-size: 14px;\n  font-weight: 800;\n  letter-spacing: 0.3px;\n  color: var(--text-title);\n  transition: color 0.3s ease;\n}\n\n.info-list {\n  font-size: 13px;\n  color: var(--text-normal);\n}\n\n.info-list ul {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.info-list li {\n  display: flex;\n  justify-content: space-between;\n}\n\n.info-list a {\n  color: var(--text-subtitle);\n  text-decoration: none;\n  font-weight: 600;\n  transition: color 0.3s ease;\n}\n\n.info-list a:hover {\n  color: var(--text-title);\n  text-decoration: underline;\n}\n</style>\n'],sourceRoot:''}]);const i=o},924:(e,n,t)=>{var a=t(427);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('0a8d101c',a,!1,{ssrId:!0})},987:(e,n,t)=>{var a=t(372);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('23f01bd0',a,!1,{ssrId:!0})},997:(e,n,t)=>{var a=t(238);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('5cd43e4f',a,!1,{ssrId:!0})}},o={};function i(e){var n=o[e];if(void 0!==n)return n.exports;var t=o[e]={id:e,exports:{}};return s[e](t,t.exports,i),t.exports}i.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return i.d(n,{a:n}),n},i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const l=z,c=l.z.object({åœ¨aiæ¶ˆæ¯å°¾éƒ¨ç”Ÿæˆç‰¹æ®Šç¬¦å·:l.z.boolean().default(!0),ç‰¹æ®Šç¬¦å·å€¼:l.z.string().default('<StatusPlaceHolderImpl/>'),å¼€å¯æ‚¬æµ®çƒ:l.z.boolean().default(!0),å¼€å¯é»‘å¤œæ¨¡å¼:l.z.boolean().default(!1),å¼ºåˆ¶é‡è½½åŠŸèƒ½:l.z.boolean().default(!1),å¼ºåˆ¶é‡è½½æ¶ˆæ¯æ•°:l.z.number().default(2),ç¹ä½“è½¬ç®€ä½“:l.z.boolean().default(!1),è°ƒè¯•æ¨¡å¼:l.z.boolean().default(!1)}),d={type:'chat'},p='ERAMetaData',A='stat_data',u='EditLogs',g='SelectedMks',C='era_data',b=new RegExp(`<${C}>({.*?})<\\/${C}>`),m={INSERT_BY_OBJECT:'era:insertByObject',UPDATE_BY_OBJECT:'era:updateByObject',INSERT_BY_PATH:'era:insertByPath',UPDATE_BY_PATH:'era:updateByPath',DELETE_BY_OBJECT:'era:deleteByObject',DELETE_BY_PATH:'era:deleteByPath',GET_CURRENT_VARS:'era:getCurrentVars',GET_SNAPSHOT_AT_MK:'era:getSnapshotAtMk',GET_SNAPSHOTS_BETWEEN_MKS:'era:getSnapshotsBetweenMks',GET_SNAPSHOT_AT_MID:'era:getSnapshotAtMId',GET_SNAPSHOTS_BETWEEN_MIDS:'era:getSnapshotsBetweenMIds',REQUEST_WRITE_DONE:'era:requestWriteDone'},f='era:writeDone',h='era:apiWrite',v='era:queryResult',x=_;var B=i.n(x);const y=Vue,w=(0,y.ref)(c.parse({})),E=(0,y.readonly)(w);function k(e){if(!B().isObject(e))return e;const n=B().cloneDeep(e);return function e(n){if(Array.isArray(n))n.forEach(n=>e(n));else if(B().isPlainObject(n))for(const t in n)t.startsWith('$')?delete n[t]:e(n[t])}(n),n}function S(){const e=getVariables(d)||{};return{meta:B().get(e,p,{}),stat:B().get(e,A,{})}}async function D(e){await updateVariablesWith(async n=>{const t=B().get(n,p,{}),a=await e(t);return B().set(n,p,a),n},d)}async function M(e){await updateVariablesWith(async n=>{const t=c.parse(n??{}),a=await e(t);return w.value=a,a},{type:'script',script_id:getScriptId()})}const N='era_debug_config';let V=[],R=[];function I(){try{const e=globalThis.localStorage?.getItem(N)||'{"enabled":[],"disabled":[]}',n=JSON.parse(e),t=e=>new RegExp(`^${e.replace(/\*/g,'.*?')}$`);V=(n.enabled||[]).map(t),R=(n.disabled||[]).map(t)}catch(e){console.error('ã€ŠERA-Logã€‹: åŠ è½½è°ƒè¯•é…ç½®å¤±è´¥ã€‚',e),V=[],R=[]}}function F(e){const n={enabled:[...new Set(e.enabled)],disabled:[...new Set(e.disabled)]};globalThis.localStorage?.setItem(N,JSON.stringify(n)),I(),console.log('%cã€ŠERA-Logã€‹è°ƒè¯•æ¨¡å¼å·²æ›´æ–°ã€‚','color: #3498db; font-weight: bold;',{'å¯ç”¨ (Enabled)':n.enabled,'ç¦ç”¨ (Disabled)':n.disabled})}if(I(),'undefined'!=typeof globalThis){const e={add(e){const n=globalThis.localStorage?.getItem(N)||'{"enabled":[],"disabled":[]}',t=JSON.parse(n),a=new Set(t.enabled||[]),r=new Set(t.disabled||[]);a.add(e),r.delete(e),F({enabled:Array.from(a),disabled:Array.from(r)})},remove(e){const n=globalThis.localStorage?.getItem(N)||'{"enabled":[],"disabled":[]}',t=JSON.parse(n),a=new Set(t.enabled||[]),r=new Set(t.disabled||[]);r.add(e),a.delete(e),F({enabled:Array.from(a),disabled:Array.from(r)})},status(){const e=globalThis.localStorage?.getItem(N)||'{"enabled":[],"disabled":[]}',n=JSON.parse(e);console.log('%cã€ŠERA-Logã€‹å½“å‰è°ƒè¯•é…ç½®:','color: #3498db; font-weight: bold;',n)},clear(){F({enabled:[],disabled:[]})}};globalThis.eraDebug=e}const T={mk:''};class j{moduleName;constructor(e){this.moduleName=e||this._getModuleNameFromStack()||'unknown'}_getModuleNameFromStack(){try{const e=((new Error).stack||'').split('\n').find(e=>(e.includes('/src/ERAå˜é‡æ¡†æ¶/')||e.includes('/dist/ERAå˜é‡æ¡†æ¶/')||e.includes('\\src\\ERAå˜é‡æ¡†æ¶\\')||e.includes('\\dist\\ERAå˜é‡æ¡†æ¶\\'))&&!e.includes('/utils/log.ts'));if(!e)return null;const n=e.match(new RegExp('(src|dist)[\\\\/]ERAå˜é‡æ¡†æ¶[\\\\/]([^?:]+)'));if(!n||!n[2])return null;return n[2].replace(/\\/g,'/').replace(/\.(vue|ts|js)$/,'').replace(/\/index$/,'')}catch(e){return console.error('ã€ŠERA-Log-Debugã€‹: è§£ææ¨¡å—åæ—¶å‘ç”Ÿæ„å¤–é”™è¯¯ã€‚',e),null}}formatMessage(e,n){return`ã€ŠERAã€‹${T.mk?`ï¼ˆ${T.mk}ï¼‰`:''}ã€Œ${this.moduleName}ã€ã€${e}ã€‘${String(n)}`}debug(e,n,t){if(!(a=this.moduleName)||R.some(e=>e.test(a))||0===V.length||!V.some(e=>e.test(a)))return;var a;const r=this.formatMessage(e,n);void 0!==t?console.debug(r,t):console.debug(r)}log(e,n,t){const a=this.formatMessage(e,n);void 0!==t?console.log(`%c${a}`,'color: #3498db;',t):console.log(`%c${a}`,'color: #3498db;')}warn(e,n,t){const a=this.formatMessage(e,n);void 0!==t?console.warn(`%c${a}`,'color: #f39c12;',t):console.warn(`%c${a}`,'color: #f39c12;'),E.value.è°ƒè¯•æ¨¡å¼&&toastr.warning(a)}error(e,n,t){const a=this.formatMessage(e,n);void 0!==t?console.error(`%c${a}`,'color: #e74c3c; font-weight: bold;',t):console.error(`%c${a}`,'color: #e74c3c; font-weight: bold;'),E.value.è°ƒè¯•æ¨¡å¼&&toastr.error(a)}}const O=new j('ERAå˜é‡æ¡†æ¶/events/merger'),P={INIT:[tavern_events.APP_READY],SYNC:['manual_write',h,tavern_events.MESSAGE_RECEIVED,tavern_events.MESSAGE_DELETED,tavern_events.MESSAGE_SWIPED,tavern_events.CHAT_CHANGED,'manual_sync','manual_full_sync','combo_edit_and_continue'],API:Object.values(m),UPDATE_MK_ONLY:[tavern_events.MESSAGE_SENT],COLLISION_DETECTORS:[tavern_events.GENERATION_STARTED],COMBO_STARTERS:[tavern_events.MESSAGE_UPDATED],DIRECTED_SYNC:[tavern_events.MESSAGE_EDITED,'combo_swipe_and_regenerate']},L=new Map([]),G=new Map([[tavern_events.MESSAGE_UPDATED,{next:tavern_events.GENERATION_STARTED,resultType:'combo_edit_and_continue',maxInterval:1600}],[tavern_events.MESSAGE_SWIPED,{next:tavern_events.GENERATION_STARTED,resultType:'combo_swipe_and_regenerate',maxInterval:600}]]),q=new Map([[tavern_events.MESSAGE_SWIPED,500],[tavern_events.MESSAGE_UPDATED,1500]]);function Y(e){return P.INIT.includes(e)?'INIT':P.SYNC.includes(e)?'SYNC':P.API.includes(e)?'API':P.UPDATE_MK_ONLY.includes(e)?'UPDATE_MK_ONLY':P.COLLISION_DETECTORS.includes(e)?'COLLISION_DETECTORS':P.COMBO_STARTERS.includes(e)?'COMBO_STARTERS':P.DIRECTED_SYNC.includes(e)?'DIRECTED_SYNC':'UNKNOWN'}function U(e){const n=_.cloneDeep(e),t=[];for(const n of e){if(0===t.length){t.push(n);continue}const e=t[t.length-1],a=n.timestamp-e.timestamp,r=G.get(e.type);if(r&&n.type===r.next){if(a<=r.maxInterval){O.debug('mergeEventBatch',`æ£€æµ‹åˆ°äº‹ä»¶ç»„åˆ: ${e.type} å’Œ ${n.type} (æ—¶é—´å·®: ${a}ms <= ${r.maxInterval}ms)ã€‚å°†åˆå¹¶ä¸º ${r.resultType} äº‹ä»¶ã€‚`),t.pop(),t.push({type:r.resultType,timestamp:n.timestamp,detail:n.detail});continue}O.debug('mergeEventBatch',`æ£€æµ‹åˆ°æ½œåœ¨çš„äº‹ä»¶ç»„åˆï¼Œä½†å› è¶…æ—¶è€Œå¤±è´¥: ${e.type} å’Œ ${n.type} (æ—¶é—´å·®: ${a}ms > ${r.maxInterval}ms)ã€‚`)}const s=L.get(e.type);if(s&&n.type===s.next){if(a<=s.maxInterval){O.debug('mergeEventBatch',`æ£€æµ‹åˆ°ç›¸é‚»äº‹ä»¶å¯¹å†²: ${e.type} å’Œ ${n.type} (æ—¶é—´å·®: ${a}ms <= ${s.maxInterval}ms)ã€‚å°†å¿½ç•¥è¿™ä¸¤ä¸ªäº‹ä»¶ã€‚`),t.pop();continue}O.debug('mergeEventBatch',`æ£€æµ‹åˆ°æ½œåœ¨çš„äº‹ä»¶å¯¹å†²ï¼Œä½†å› è¶…æ—¶è€Œå¤±è´¥: ${e.type} å’Œ ${n.type} (æ—¶é—´å·®: ${a}ms > ${s.maxInterval}ms)ã€‚`)}const o=Y(e.type);o===Y(n.type)&&'SYNC'===o?t[t.length-1]=n:t.push(n)}const a=t.filter(e=>{const n=Y(e.type),t='COLLISION_DETECTORS'===n,a='COMBO_STARTERS'===n;return(t||a)&&O.debug('mergeEventBatch',`æ¸…ç†æœªé…å¯¹çš„äº‹ä»¶: ${e.type}`),!t&&!a});return O.debug('mergeEventBatch',`äº‹ä»¶åˆå¹¶: ${n.length} -> ${a.length}`,{before:n.map(e=>e.type),after:a.map(e=>e.type)}),a}const W=new j('ERAå˜é‡æ¡†æ¶/utils/data'),J={'.':'__DOT__','"':'__DQUOTE__','\'':'__SQUOTE__'},K=_.invert(J),H=new RegExp(Object.keys(J).map(_.escapeRegExp).join('|'),'g'),Q=new RegExp(Object.values(J).map(_.escapeRegExp).join('|'),'g');function Z(e){if(Array.isArray(e))return e.map(e=>Z(e));if(_.isPlainObject(e)){const n={};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){n[t.replace(H,e=>J[e])]=Z(e[t])}return n}return'string'==typeof e?e.replace(H,e=>J[e]):e}function X(e){if(Array.isArray(e))return e.map(e=>X(e));if(_.isPlainObject(e)){const n={};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){n[t.replace(Q,e=>K[e])]=X(e[t])}return n}return'string'==typeof e?e.replace(Q,e=>K[e]):e}function ee(e){if(Array.isArray(e))return e.map(e=>Array.isArray(e)||_.isPlainObject(e)?JSON.stringify(e):e);if(_.isPlainObject(e)){const n={};for(const t in e)n[t]=ee(e[t]);return n}return e}function ne(e,n){return _.mergeWith(_.cloneDeep(e),_.cloneDeep(n),(e,n)=>{if(Array.isArray(e)||Array.isArray(n))return n})}function te(e){if(Array.isArray(e))return e;if(e&&'object'==typeof e)return[e];if('string'==typeof e){const n=e.replace(/^\s*```(?:json)?\s*|\s*```\s*$/g,'');try{const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch{return[]}}return[]}function ae(e){const n=[];if(!e||'string'!=typeof e)return n;const t=function(e){if(!e)return'';let n='',t=!1;for(let a=0;a<e.length;a++){const r=e[a];if('"'!==r||0!==a&&'\\'===e[a-1]||(t=!t),t){n+=r;continue}const s=e[a+1];if('/'===r&&'/'===s){const t=e.indexOf('\n',a+2);if(-1===t)break;n+='\n',a=t;continue}if('/'===r&&'*'===s){const n=e.indexOf('*/',a+2);if(-1===n)break;a=n+1;continue}if('<'===r&&'\x3c!--'===e.substring(a,a+4)){const n=e.indexOf('--\x3e',a+4);if(-1===n)break;a=n+2;continue}n+=r}return n}(e),a=t.trim();let r=0,s=-1,o=!1;for(let e=0;e<a.length;e++){const t=a[e];if('"'!==t||0!==e&&'\\'===a[e-1]||(o=!o),!o)if('{'===t)0===r&&(s=e),r++;else if('}'===t&&r>0&&(r--,0===r&&-1!==s)){const t=a.substring(s,e+1);try{const e=JSON.parse(t);n.push(e)}catch(e){W.error(`JSONL è§£æå¤±è´¥: ${e?.message||e}. å¤±è´¥çš„ç‰‡æ®µ: ${t}`,e)}s=-1}}return n}function re(e){if(!e)return e;let n=String(e).trim();return n=n.replace(/^\s*(?:```|~~~)\[a-zA-Z0-9_-\]*\s*\r?\n/,''),n=n.replace(/\r?\n(?:```|~~~)\s*$/,''),n.trim()}function se(e='',n='exact'){if('any'===n||'*'===e)return/([a-zA-Z][a-zA-Z0-9_]*)/;const t=e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');switch(n){case'exact':return new RegExp(`(${t})`);case'prefix':return new RegExp(`(${t}[a-zA-Z0-9_]*)`);case'suffix':return new RegExp(`([a-zA-Z0-9_]*${t})`);default:return new RegExp(`([a-zA-Z0-9_]*${t}[a-zA-Z0-9_]*)`)}}function oe(e,n,t=e.length){const a=new RegExp(`</${n.source}>`,'g');let r,s=null;for(;null!==(r=a.exec(e))&&r.index<t;)s=r;if(!s)return null;const o=s[1],i=s.index,l=`<${o}>`,c=e.lastIndexOf(l,i);return-1===c?oe(e,n,i):{startIndex:c,endIndex:i+`</${o}>`.length,content:e.substring(c+l.length,i),tagName:o}}function ie(e,n){if(!e)return!1;const t=n?new RegExp(`</?${n.source}>`):/<\/?\s*[a-zA-Z][a-zA-Z0-9_]*\s*>/;let a=!1,r=!1,s=0;for(let n=0;n<e.length;n++){const o=e[n];if('\\'===o){s+=1;continue}const i=s%2==1;if(s=0,'"'!==o||i||a)if('\''!==o||i||r){if('<'===o&&!i&&!a&&!r){let a=n+1,r=!1,o=!1,i=0;for(;a<e.length;a++){const s=e[a];if('\\'===s){i+=1;continue}const l=i%2==1;if(i=0,'"'!==s||l||r)if('\''!==s||l||o){if('>'===s&&!l&&!r&&!o){const r=e.slice(n,a+1);if(t.test(r))return!0;break}}else r=!r;else o=!o}n=a,s=0}}else a=!a;else r=!r}return!1}function le(e,n,t=!1){const a=function(e,n){let t=e;for(;;){const e=oe(t,n);if(!e)break;t=t.slice(0,e.startIndex)+t.slice(e.endIndex)}return t}(e,se('think','contains')),r=function(e,n){const t=[];let a=e.length;for(;a>0;){const r=oe(e,n,a);if(!r)break;t.unshift(r.content),a=r.startIndex}return t}(a,n),s=[];for(const e of r){const n=re(e.trim());if(!ie(n)&&n)if(t){const e=de(n);s.push(e)}else s.push(n)}return s}const ce=n({from:'tw',to:'cn'});function de(e){return ce(e)}function pe(e){if(!e.includes('{{'))return e;let n=e;return n=n.replace(/{{user}}/gi,SillyTavern.name1),n=n.replace(/{{char}}/gi,SillyTavern.name2),n}const Ae=new j('ERAå˜é‡æ¡†æ¶/utils/message');function ue(e){if(!e)return null;let n=null;if('string'==typeof e.mes)n=e.mes;else if(Array.isArray(e.swipes)){const t=Number(e.swipe_id??0);n=e.swipes[t]||null}else'string'==typeof e.message&&(n=e.message);return null===n?null:pe(n)}function ge(e){const n=function(e){if('string'!=typeof e)return null;const n=e.match(b);if(!n||!n[1])return null;try{const e=n[1],t=e.match(/"era-message-key"\s*=\s*"(.*?)"/),a=e.match(/"era-message-type"\s*=\s*"(.*?)"/);if(t?.[1]&&a?.[1]){const e={'era-message-key':t[1],'era-message-type':a[1]};return Ae.debug('parseEraData','æˆåŠŸè§£æ EraData',e),e}return Ae.debug('parseEraData','æœªèƒ½åœ¨ EraData å—ä¸­æ‰¾åˆ°å®Œæ•´çš„é”®å€¼å¯¹',{customFormatBlock:e}),null}catch(e){return Ae.warn('parseEraData','è§£æ EraData å—æ—¶å‘ç”Ÿå¼‚å¸¸',e),null}}(ue(e));return n?'user'===n['era-message-type']:'user'===e?.role}function Ce(){const e=getChatMessages('0-{{lastMessageId}}',{include_swipes:!0});if(!e||0===e.length)return Ae.debug('findLastAiMessage','èŠå¤©è®°å½•ä¸ºç©º, æœªæ‰¾åˆ°ä»»ä½•æ¶ˆæ¯ã€‚'),null;for(let n=e.length-1;n>=0;n--){const t=e[n];if(!ge(t))return Ae.debug('findLastAiMessage',`æ‰¾åˆ°æœ€åä¸€æ¡ AI æ¶ˆæ¯, ID: ${t.message_id}`),t}return Ae.debug('findLastAiMessage','æœªåœ¨èŠå¤©è®°å½•ä¸­æ‰¾åˆ°ä»»ä½• AI æ¶ˆæ¯ã€‚'),null}async function be(e,n,t='none'){ue(e);const a={message_id:e.message_id};if(Array.isArray(e.swipes)){const t=Number(e.swipe_id??0),r=[...e.swipes];r[t]=n,a.swipes=r}else a.message=n;await setChatMessages([a],{refresh:t})}const me=new j('ERAå˜é‡æ¡†æ¶/core/key/mk');function fe(e){if(!e)return'';const n=ue(e);return function(e){if('string'!=typeof e)return null;const n=e.match(b);if(!n||!n[1])return null;try{const e=n[1],t=e.match(/"era-message-key"\s*=\s*"(.*?)"/),a=e.match(/"era-message-type"\s*=\s*"(.*?)"/);return t?.[1]&&a?.[1]?{'era-message-key':t[1],'era-message-type':a[1]}:null}catch{return null}}(n)?.['era-message-key']||''}async function he(e){if(!e||'number'!=typeof e.message_id||!e.role)return me.warn('ensureMessageKey','æ— æ•ˆçš„æ¶ˆæ¯å¯¹è±¡ç»“æ„ï¼Œæ— æ³•ç¡®ä¿Keyã€‚',{msg:e}),{mk:'',isNew:!1};const n=fe(e);if(n)return{mk:n,isNew:!1};const t=`era_mk_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,a='user'===e.role?'user':'assistant',r=`<${C}>{"era-message-key"="${t}","era-message-type"="${a}"}</${C}>`;me.debug('ensureMessageKey',`ä¸ºæ¶ˆæ¯ (ID: ${e.message_id}) æ³¨å…¥æ–°çš„Key: ${t}`);const s=(ue(e)??'')+'\n'+r;return await be(e,s),{mk:t,isNew:!0}}const ve=async e=>{const n=getChatMessages(-1,{include_swipes:!0})?.[0];n&&'number'==typeof n.message_id&&e&&await D(t=>{const a=_.get(t,g,[]);return a[n.message_id]!==e&&(a[n.message_id]=e,_.set(t,g,a)),t})},xe=new j('ERAå˜é‡æ¡†æ¶/initer/auto/settings');async function Be(){!function(){const e=getVariables({type:'script',script_id:getScriptId()});w.value=c.parse(e??{})}(),xe.log('initializeExternalSettings','å¼€å§‹åˆå§‹åŒ–è„šæœ¬è®¾ç½®...'),await M(async e=>(xe.debug('initializeExternalSettings','å½“å‰è®¾ç½®:',e),e)),xe.log('initializeExternalSettings','è„šæœ¬è®¾ç½®åˆå§‹åŒ–å®Œæˆã€‚')}$(()=>{Be()});const ye=new j('ERAå˜é‡æ¡†æ¶/macro/placeholder');const we=new j('ERAå˜é‡æ¡†æ¶/core/timetravel');function Ee(e,n){if(!n||!n.length)return e;for(let t=n.length-1;t>=0;t--){const a=n[t],r=String(a?.op||'').toLowerCase(),s=String(a?.path||'');s&&('insert'===r?_.unset(e,s):'update'!==r&&'delete'!==r||(void 0===a.value_old?_.unset(e,s):_.set(e,s,_.cloneDeep(a.value_old))))}return e}function ke(e,n){if(!n||!n.length)return e;for(const t of n){if(!t||!t.path)continue;const n=String(t?.op||'').toLowerCase();'insert'===n||'update'===n?_.set(e,t.path,_.cloneDeep(t.value_new)):'delete'===n&&_.unset(e,t.path)}return e}function _e(e,n,t){const a=n.indexOf(e);if(-1===a){const t=`åœ¨åºåˆ—ä¸­æœªæ‰¾åˆ°ç›®æ ‡MK: ${e}`;throw we.error('calculateStatAt',t,{targetMK:e,selectedMks:n}),new Error(t)}let r={};for(let e=0;e<=a;e++){const a=n[e];if(!a)continue;r=ke(r,te(t[a]))}return r}function Se(e,n,t,a){if(we?.debug('findLatestNewValue',`å¼€å§‹ä¸ºè·¯å¾„ <${e}> ä»æ¶ˆæ¯ç´¢å¼• <${n}> å‘ä¸Šè¿½æº¯å†å²å€¼...`),n<0||n>t.length)return we?.warn('findLatestNewValue',`é”™è¯¯ï¼šèµ·å§‹æ¶ˆæ¯ç´¢å¼• ${n} è¶…å‡ºèŒƒå›´ã€‚`,{path:e,startMessageId:n,selectedMksCount:t.length}),null;for(let r=n-1;r>=0;r--){const n=t[r];if(!n)continue;const s=te(a[n]);if(s&&0!==s.length)for(let t=s.length-1;t>=0;t--){const a=s[t];if(a&&a.path){if(a.path===e)return'delete'===a.op?(we?.warn('findLatestNewValue',`>> åœ¨ MK:${n} ä¸­ä¸ºè·¯å¾„ <${e}> æ‰¾åˆ°äº† 'delete' è®°å½•ã€‚è¿™å¯èƒ½æ„å‘³ç€æ­£åœ¨å°è¯•ç¼–è¾‘ä¸€ä¸ªå·²è¢«åˆ é™¤çš„å˜é‡ï¼Œå› æ­¤å…¶æ—§å€¼åº”ä¸º nullã€‚`),null):(we?.debug('findLatestNewValue',`>> æˆåŠŸ! åœ¨ MK:${n} ä¸­æ‰¾åˆ°ç²¾ç¡®è·¯å¾„ <${e}> çš„å€¼ä¸º: `,a.value_new),_.cloneDeep(a.value_new));if(e.startsWith(a.path+'.')){const t=e.substring(a.path.length+1),r=a.value_new;if(_.isPlainObject(r)&&_.has(r,t)){const e=_.get(r,t);return we?.debug('findLatestNewValue',`>> æˆåŠŸ! åœ¨ MK:${n} ä¸­æ‰¾åˆ°çˆ¶çº§è·¯å¾„ <${a.path}>, å¹¶ä»ä¸­æå–å­è·¯å¾„ <${t}> çš„å€¼ä¸º:`,e),_.cloneDeep(e)}}}}}return we?.debug('findLatestNewValue',`å‘ä¸Šè¿½æº¯æœªæ‰¾åˆ°è·¯å¾„ ${e} çš„ä»»ä½•å†å²å€¼ï¼Œå°†ä½¿ç”¨ null ä½œä¸ºæ—§å€¼`),null}const De=new j('ERAå˜é‡æ¡†æ¶/core/snapshot');function Me(e){try{const{meta:n}=S(),t=_.get(n,g,[]),a=_.get(n,u,{});if(!e)return De.error('getStatAtMK','ç›®æ ‡ MK ä¸èƒ½ä¸ºç©ºã€‚',{targetMK:e}),null;if(!t.includes(e))return De.error('getStatAtMK',`æä¾›çš„ targetMK "${e}" æ— æ•ˆæˆ–ä¸å­˜åœ¨äº selectedMks ä¸­ã€‚`,{targetMK:e,selectedMks:t}),null;return _e(e,t,a)}catch(n){return De.error('getStatAtMK',`è®¡ç®—çŠ¶æ€å¿«ç…§æ—¶å‡ºé”™: ${n?.message||n}`,{error:n,targetMK:e,eraData:S()}),null}}function Ne(e,n){try{const{meta:t}=S(),a=_.get(t,g,[]),r=_.get(t,u,{}),s=a.filter(e=>!!e);if(0===s.length)return[];if(e&&!s.includes(e))return De.error('getStatsBetweenMKs',`æä¾›çš„ startMk "${e}" æ— æ•ˆæˆ–ä¸å­˜åœ¨äº selectedMks ä¸­ã€‚`,{startMk:e,validMks:s}),null;if(n&&!s.includes(n))return De.error('getStatsBetweenMKs',`æä¾›çš„ endMk "${n}" æ— æ•ˆæˆ–ä¸å­˜åœ¨äº selectedMks ä¸­ã€‚`,{endMk:n,validMks:s}),null;const o=e||s[0],i=function(e,n,t,a){const r=t.indexOf(e),s=t.indexOf(n);if(-1===r||-1===s||r>s)return we.error('calculateAllStatsBetweenMks','æ— æ•ˆçš„ startMk æˆ– endMkã€‚',{startMk:e,endMk:n,selectedMks:t}),[];let o=_e(e,t,a);const i=[{mk:e,message_id:r,stat:_.cloneDeep(o)}];for(let e=r+1;e<=s;e++){const n=t[e];n&&(o=ke(o,te(a[n])),i.push({mk:n,message_id:e,stat:_.cloneDeep(o)}))}return i}(o,n||s[s.length-1],a,r);return i}catch(t){return De.error('getStatsBetweenMKs',`è®¡ç®—æ‰¹é‡å¿«ç…§æ—¶å‡ºé”™: ${t?.message||t}`,{error:t,startMk:e,endMk:n,eraData:S()}),null}}const Ve=new j('ERAå˜é‡æ¡†æ¶/events/emitters/events'),Re=_.debounce(()=>{eventEmit(h),Ve.log('debouncedEmitApiWrite',`å·²è§¦å‘åˆå¹¶åçš„ ${h} äº‹ä»¶ã€‚`)},50,{leading:!1,trailing:!0});function Ie(e){const{stat:n,meta:t}=S(),a=k(n);Ve.debug('emitWriteDoneEvent','è·å–äº†æœ€æ–°çš„ ERA æ•°æ®å¹¶ç”Ÿæˆäº†çº¯å‡€ç‰ˆ',{stat:n,meta:t,statWithoutMeta:a});const r={...e,stat:X(n),statWithoutMeta:X(a),selectedMks:_.get(t,g,[]),editLogs:_.get(t,u,{})};Ve.debug('emitWriteDoneEvent','æ„å»ºäº†å®Œæ•´çš„äº‹ä»¶è½½è·',{inputPayload:e,fullPayload:r}),eventEmit(f,r),Ve.log('emitWriteDoneEvent',`å·²è§¦å‘ ${f} äº‹ä»¶ã€‚`,r)}function Fe(e,n,t){const{meta:a}=S(),r={queryType:e,request:n,result:t,selectedMks:_.get(a,g,[]),editLogs:_.get(a,u,{})};eventEmit(v,r),Ve.log('emitQueryResultEvent',`å·²ä¸ºæŸ¥è¯¢ [${e}] å‘é€ ${v} äº‹ä»¶ã€‚`)}const Te=new j('ERAå˜é‡æ¡†æ¶/events/handlers/api/handler');let $e=null;async function je(e){const n=(e=>{try{return JSON.stringify(e,null,2)}catch(e){return`<<stringifyå¤±è´¥: ${e?.message||e}>>`}})(e.blockContent),t=`\n<${e.blockTag}>\n${n}\n</${e.blockTag}>`,a=await Ce();if(!a)return void Te.warn('performApiWrite','æ‰¾ä¸åˆ°ä»»ä½• AI æ¶ˆæ¯ï¼Œæ— æ³•æ‰§è¡Œ API å†™å…¥ã€‚');const r=(ue(a)??'')+t;Te.debug('performApiWrite',`å®æ—¶å†™å…¥ API ä»»åŠ¡ (${e.blockTag}) åˆ°æ¶ˆæ¯ ID ${a.message_id}...`),await be(a,r),Re()}function Oe(e,n,t){const{type:a,detail:r}=e;var s,o;n.api=!0,a===m.INSERT_BY_OBJECT?je({blockTag:'VariableInsert',blockContent:r}):a===m.UPDATE_BY_OBJECT?function(e){je({blockTag:'VariableEdit',blockContent:e})}(r):a===m.INSERT_BY_PATH?(s=r.path,o=r.value,je({blockTag:'VariableInsert',blockContent:_.set({},s,o)})):a===m.UPDATE_BY_PATH?function(e,n){je({blockTag:'VariableEdit',blockContent:_.set({},e,n)})}(r.path,r.value):a===m.DELETE_BY_OBJECT?function(e){je({blockTag:'VariableDelete',blockContent:e})}(r):a===m.DELETE_BY_PATH?function(e){je({blockTag:'VariableDelete',blockContent:_.set({},e,{})})}(r.path):a===m.GET_CURRENT_VARS?function(e){let n;Te.debug('handleGetCurrentVars','è¯·æ±‚è·å–å½“å‰å˜é‡ã€‚');try{const{stat:e,meta:t}=S(),a=_.get(t,g,[]),r=a[a.length-1]||'',s=a.length-1,o=getChatMessages('0-{{lastMessageId}}',{include_swipes:!1})[s];n={mk:r,message_id:s,is_user:!!o&&ge(o),stat:X(e),statWithoutMeta:X(k(e))}}catch(e){const t=`è·å–å½“å‰å˜é‡æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:String(e)}`;Te.error('handleGetCurrentVars',t),n={error:t}}Fe('getCurrentVars',e,n)}(r):a===m.GET_SNAPSHOT_AT_MK?function(e){let n;Te.debug('handleGetSnapshotAtMk','è¯·æ±‚è·å–å†å²å¿«ç…§...');try{const t=e?.mk;if(!t)throw new Error('è¯·æ±‚ç¼ºå°‘ "mk" å‚æ•°ã€‚');Te.debug('handleGetSnapshotAtMk',`MK: ${t}`);const a=Me(t);if(a){const{meta:e}=S(),r=_.get(e,g,[]).indexOf(t),s=getChatMessages('0-{{lastMessageId}}',{include_swipes:!1})[r];n={mk:t,message_id:r,is_user:!!s&&ge(s),stat:X(a),statWithoutMeta:X(k(a))}}else{const e=`æ‰¾ä¸åˆ° MK "${t}" å¯¹åº”çš„å¿«ç…§ã€‚`;Te.warn('handleGetSnapshotAtMk',e),n={error:e,stat:null}}}catch(e){const t=`è·å–å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:String(e)}`;Te.error('handleGetSnapshotAtMk',t),n={error:t}}Fe('getSnapshotAtMk',e,n)}(r):a===m.GET_SNAPSHOTS_BETWEEN_MKS?function(e){const{startMk:n,endMk:t}=e||{};let a;Te.debug('handleGetSnapshotsBetweenMks',`è¯·æ±‚è·å–æ‰¹é‡å¿«ç…§ï¼Œä»: ${n||'å¼€å§‹'}, åˆ°: ${t||'ç»“æŸ'}`);try{const e=Ne(n,t);if(e){const n=getChatMessages('0-{{lastMessageId}}',{include_swipes:!1});a=e.map(e=>{const t=n[e.message_id];return{...e,is_user:!!t&&ge(t),stat:X(e.stat),statWithoutMeta:X(k(e.stat))}})}else Te.warn('handleGetSnapshotsBetweenMks','åœ¨æŒ‡å®šèŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°å¿«ç…§ï¼Œæˆ–èŒƒå›´æ— æ•ˆã€‚'),a=[]}catch(e){const n=`è·å–æ‰¹é‡å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:String(e)}`;Te.error('handleGetSnapshotsBetweenMks',n),a={error:n}}Fe('getSnapshotsBetweenMks',e,a)}(r):a===m.GET_SNAPSHOT_AT_MID?function(e){let n;Te.debug('handleGetSnapshotAtMId','è¯·æ±‚è·å–å†å²å¿«ç…§...');try{const t=e?.message_id;if('number'!=typeof t)throw new Error('è¯·æ±‚ç¼ºå°‘ "message_id" å‚æ•°æˆ–ç±»å‹ä¸æ­£ç¡®ã€‚');Te.debug('handleGetSnapshotAtMId',`Message ID: ${t}`);const{meta:a}=S(),r=_.get(a,g,[]);if(t<0||t>=r.length)throw new Error(`Message ID ${t} è¶…å‡ºèŒƒå›´ [0, ${r.length-1}]ã€‚`);const s=r[t];if(s){const e=Me(s);if(e){const a=getChatMessages('0-{{lastMessageId}}',{include_swipes:!1})[t];n={mk:s,message_id:t,is_user:!!a&&ge(a),stat:X(e),statWithoutMeta:X(k(e))}}else{const e=`è·å–å¿«ç…§å¤±è´¥ï¼ŒMK: ${s} (æ¥è‡ª Message ID: ${t})ã€‚å¯èƒ½è¯¥å¿«ç…§å·²è¢«æ¸…ç†ã€‚`;Te.error('handleGetSnapshotAtMId',e),n={error:e,stat:null}}}else{const e=`Message ID ${t} å¤„æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„ MKã€‚`;Te.warn('handleGetSnapshotAtMId',e),n={error:e,stat:null}}}catch(e){const t=`è·å–å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:String(e)}`;Te.error('handleGetSnapshotAtMId',t),n={error:t}}Fe('getSnapshotAtMId',e,n)}(r):a===m.GET_SNAPSHOTS_BETWEEN_MIDS?function(e){const{startId:n,endId:t}=e||{};let a;Te.debug('handleGetSnapshotsBetweenMIds',`è¯·æ±‚è·å–æ‰¹é‡å¿«ç…§ï¼Œä» ID: ${n??'å¼€å§‹'}, åˆ° ID: ${t??'ç»“æŸ'}`);try{const{meta:e}=S(),r=_.get(e,g,[]),s=n??0,o=t??r.length-1;if(s>o||s<0||o>=r.length)throw new Error(`ID èŒƒå›´ [${s}, ${o}] æ— æ•ˆæˆ–è¶…å‡ºèŒƒå›´ [0, ${r.length-1}]ã€‚`);const i=r[s],l=r[o];if(!i||!l)throw new Error('æŒ‡å®šçš„ ID èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„èµ·å§‹æˆ–ç»“æŸ MKã€‚');const c=Ne(i,l);if(c){const e=getChatMessages('0-{{lastMessageId}}',{include_swipes:!1});a=c.map(n=>{const t=e[n.message_id];return{...n,is_user:!!t&&ge(t),stat:X(n.stat),statWithoutMeta:X(k(n.stat))}})}else Te.warn('handleGetSnapshotsBetweenMIds','åœ¨æŒ‡å®š ID èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°å¿«ç…§ã€‚'),a=[]}catch(e){const n=`è·å–æ‰¹é‡å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯: ${e instanceof Error?e.message:String(e)}`;Te.error('handleGetSnapshotsBetweenMIds',n),a={error:n}}Fe('getSnapshotsBetweenMIds',e,a)}(r):a===m.REQUEST_WRITE_DONE&&(Te.debug('handleRequestWriteDone','æ¥æ”¶åˆ° writeDone é‡æ’­è¯·æ±‚ã€‚'),$e?(Te.debug('handleRequestWriteDone','æ­£åœ¨é‡æ’­ä¸Šä¸€æ¬¡çš„ writeDone äº‹ä»¶ã€‚'),Ie($e)):Te.warn('handleRequestWriteDone','æ²¡æœ‰å¯ä¾›é‡æ’­çš„ writeDone äº‹ä»¶ã€‚'))}eventOn('era:writeDone',e=>{$e=e});const Pe=new j('ERAå˜é‡æ¡†æ¶/core/crud/delete');function Le(e,n,t,a){const r=n?_.get(e,n):e;if(void 0===r)return void Pe.warn('applyDeleteAtLevel',`VariableDelete è·³è¿‡ï¼šè·¯å¾„ä¸å­˜åœ¨ -> ${n||'(root)'}`,{basePath:n,patchObj:t});const s=_.get(r,['$meta','necessary']),o=_.get(t,'$meta'),i=_.isPlainObject(o)&&_.isEmpty(o)||_.has(t,['$meta','necessary']);if(_.isPlainObject(t)&&!_.isEmpty(t)){if('all'===s&&!i)return void Pe.warn('applyDeleteAtLevel',`VariableDelete å¤±è´¥ï¼šè·¯å¾„ <${n}> å— "necessary: all" ä¿æŠ¤ï¼Œå…¶å­èŠ‚ç‚¹æ— æ³•è¢«åˆ é™¤ã€‚`,{basePath:n,patchObj:t,currentNodeInVars:r});for(const r of Object.keys(t)){Le(e,n?`${n}.${r}`:r,t[r],a)}return}if('self'===s||'all'===s)return void Pe.warn('applyDeleteAtLevel',`VariableDelete å¤±è´¥ï¼šè·¯å¾„ <${n}> å— "necessary: ${s}" ä¿æŠ¤ï¼Œæ— æ³•è¢«ç›´æ¥åˆ é™¤ã€‚`,{basePath:n,patchObj:t,currentNodeInVars:r});if(''===n)return void Pe.error('applyDeleteAtLevel','VariableDelete å¤±è´¥ï¼šä¸å…è®¸åˆ é™¤æ ¹å¯¹è±¡ã€‚',{patchObj:t});const l=_.cloneDeep(r);_.unset(e,n),a.push({op:'delete',path:n,value_old:l}),Pe.debug('applyDeleteAtLevel',`æˆåŠŸåˆ é™¤èŠ‚ç‚¹: ${n}`)}const Ge=new j('ERAå˜é‡æ¡†æ¶/core/crud/insert/template');function ze(e,n){if(!e)return;const t=_.get(e,'$template'),a=_.get(e,n);if(_.isPlainObject(t)&&_.isPlainObject(a)){Ge.debug('getInheritedTemplateContent',`ä¸ºå­èŠ‚ç‚¹ "${n}" åŒæ—¶æ‰¾åˆ°åŸå‹å’Œç‰¹å¼‚æ€§å†…å®¹ã€‚\n      - åŸå‹: ${JSON.stringify(t)}\n      - ç‰¹å¼‚æ€§: ${JSON.stringify(a)}`);const e=ne(_.cloneDeep(t),a);return Ge.debug('getInheritedTemplateContent',`  - åˆå¹¶å: ${JSON.stringify(e)}`),e}return _.isPlainObject(a)?(Ge.debug('getInheritedTemplateContent',`ä¸ºå­èŠ‚ç‚¹ "${n}" åªæ‰¾åˆ°ç‰¹å¼‚æ€§å†…å®¹: ${JSON.stringify(a)}`),a):_.isPlainObject(t)?(Ge.debug('getInheritedTemplateContent',`ä¸ºå­èŠ‚ç‚¹ "${n}" åªæ‰¾åˆ°åŸå‹å†…å®¹: ${JSON.stringify(t)}`),t):void Ge.debug('getInheritedTemplateContent',`åœ¨çˆ¶çº§æ¨¡æ¿å†…å®¹ä¸­æœªä¸ºå­èŠ‚ç‚¹ "${n}" æ‰¾åˆ°ä»»ä½•å¯ç»§æ‰¿çš„è§„åˆ™ã€‚`)}const qe=new j('ERAå˜é‡æ¡†æ¶/core/crud/insert/insert');function Ye(e,n,t,a,r,s){const o=function(e,n){const t=_.get(n,'$template');Ge.debug('resolveTemplate',`è§£æå‡ºçš„æ¨¡æ¿å†…å®¹:\n    - ç»§æ‰¿: ${JSON.stringify(e)}\n    - çˆ¶èŠ‚ç‚¹å˜é‡: ${JSON.stringify(t)}`);let a={};return a=ne(a,e),a=ne(a,t),Ge.debug('resolveTemplate',`åˆå¹¶åçš„æœ€ç»ˆæ¨¡æ¿å†…å®¹: ${JSON.stringify(a)}`),_.isEmpty(a)?null:a}(r,s);qe.debug('applyInsertAtLevel',`[å…¥å£] basePath: "${n||'root'}"`,{statData:_.cloneDeep(e)});const i=n?_.get(e,n):e,l=_.get(i,['$meta','unInsertAble']);if(qe.debug('applyInsertAtLevel',`[è·¯å¾„æ£€æŸ¥] at path: "${n||'root'}". currentNodeInVars çš„å€¼:`,i),n&&void 0===i){const r=function(e,n){if(Ge.debug('applyTemplateToPatch',`[è¿›å…¥] æ¨¡æ¿å†…å®¹: ${JSON.stringify(e)}, è¡¥ä¸: ${JSON.stringify(n)}`),!_.isPlainObject(n))return Ge.debug('applyTemplateToPatch','[é€€å‡º] è¡¥ä¸ä¸æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œç›´æ¥è¿”å›ã€‚'),n;if(!e)return Ge.debug('applyTemplateToPatch','[é€€å‡º] æ¨¡æ¿å†…å®¹æ— æ•ˆï¼Œç›´æ¥è¿”å›è¡¥ä¸ã€‚'),n;if(_.isEmpty(n))return Ge.debug('applyTemplateToPatch','è¡¥ä¸ä¸ºç©ºå¯¹è±¡ï¼Œå®Œå…¨ä½¿ç”¨æ¨¡æ¿å†…å®¹ã€‚'),_.cloneDeep(e);const t=ne(_.cloneDeep(e),n);return Ge.debug('applyTemplateToPatch',`åˆå¹¶æ¨¡æ¿ä¸è¡¥ä¸åçš„ç»“æœ: ${JSON.stringify(t)}`),t}(o,t),s=ee(r);return qe.debug('applyInsertAtLevel',`æœ€ç»ˆæ’å…¥æ•°æ® at ${n}:\n${JSON.stringify(s,null,2)}`),_.set(e,n,s),a.push({op:'insert',path:n,value_new:_.cloneDeep(s)}),void qe.debug('applyInsertAtLevel',`åŸå­æ€§æ’å…¥åˆ°æ–°è·¯å¾„: ${n}`)}if(_.isPlainObject(i)&&_.isPlainObject(t)){const r=Object.keys(t),s=r.every(e=>'$meta'===e),c=r.length>0;if('all'===l&&c&&!s)return void qe.warn('applyInsertAtLevel',`VariableInsert å¤±è´¥ <${n||'root'}> å—åˆ° "$meta.unInsertAble: all" çš„ä¿æŠ¤ï¼Œä¸å…è®¸æ’å…¥`,{basePath:n,patchObj:t,currentNodeInVars:i});qe.debug('applyInsertAtLevel',`[é€’å½’è¡¥å……] at path: "${n||'root'}"\n      - å½“å‰å±‚çº§æ¨¡æ¿ (localTplContent): ${JSON.stringify(o)}`);for(const s of r){if('self'===l&&'$meta'!==s&&!_.has(i,s)){qe.warn('applyInsertAtLevel',`VariableInsert å¤±è´¥ <${n||'root'}> å—åˆ° "$meta.unInsertAble: self" ä¸å…è®¸æ’å…¥ "${s}"`,{basePath:n,patchObj:t,currentNodeInVars:i,rejectedKey:s});continue}const r=n?`${n}.${s}`:s,c=t[s],d=ze(o,s);qe.debug('applyInsertAtLevel',`  - å‡†å¤‡é€’å½’å­èŠ‚ç‚¹: "${s}"\n      - å°†ä¼ é€’ç»™å­èŠ‚ç‚¹çš„æ¨¡æ¿ (subInheritedContent): ${JSON.stringify(d)}`),Ye(e,r,c,a,d,i)}}else n&&qe.warn('applyInsertAtLevel',`VariableInsert å¤±è´¥ï¼šè·¯å¾„å·²å­˜åœ¨ä¸”æ— æ³•é€’å½’è¡¥å…… -> ${n}`,{basePath:n,patchObj:t,currentNodeInVars:i})}const Ue=new j('ERAå˜é‡æ¡†æ¶/core/crud/update');async function We(e,n,t,a,r,s,o){const i=n?_.get(e,n):e;if(void 0===i)return void Ue.warn('applyEditAtLevel',`VariableEdit è·³è¿‡ï¼šè·¯å¾„ä¸å­˜åœ¨ -> ${n||'(root)'}`,{basePath:n,patchObj:t});const l=_.get(i,['$meta','updatable'],!0),c=!1===l&&!0===_.get(t,['$meta','updatable']);if(!1!==l||c)for(const i of Object.keys(t)){const l=n?`${n}.${i}`:i,c=t[i];if(_.isPlainObject(c)){await We(e,l,c,a,r,s,o);continue}if(!_.has(e,l)){Ue.warn('applyEditAtLevel',`VariableEdit å¤±è´¥ï¼šè·¯å¾„éæ³•ï¼Œæ— æ³•å†™å…¥ -> ${l}`,{subPath:l,valNew:c,statData:e});continue}Ue.debug('applyEditAtLevel',`[æ—§å€¼æŸ¥æ‰¾] å‡†å¤‡ä¸ºè·¯å¾„ <${l}> ä»æ¶ˆæ¯ ID <${r}> å‘ä¸Šè¿½æº¯...`);let d=Se(l,r,s,o);null===d?(d=_.get(e,l),Ue.debug('applyEditAtLevel',`[æ—§å€¼æŸ¥æ‰¾] è¿½æº¯æœªæ‰¾åˆ°å†å²å€¼ï¼Œä»å½“å‰ stat_data ä¸­è·å–åˆ°æ—§å€¼: ${JSON.stringify(d)}`)):Ue.debug('applyEditAtLevel',`[æ—§å€¼æŸ¥æ‰¾] è¿½æº¯æˆåŠŸï¼Œæ‰¾åˆ°å†å²æ—§å€¼: ${JSON.stringify(d)}`);const p=ee(c);_.set(e,l,p),a.push({op:'update',path:l,value_old:_.cloneDeep(d),value_new:_.cloneDeep(p)})}else Ue.warn('applyEditAtLevel',`VariableEdit å¤±è´¥ï¼šè·¯å¾„ <${n}> å— "$meta.updatable: false" ä¿æŠ¤ï¼Œæ— æ³•è¢«ä¿®æ”¹ã€‚`,{basePath:n,patchObj:t,currentNodeInVars:i})}const Je=new j('ERAå˜é‡æ¡†æ¶/core/crud/patcher'),Ke=async(e,n,t,a={})=>{Je.debug('ApplyVarChangeForMessage (Pure)',`å¼€å§‹è®¡ç®—æ¶ˆæ¯ (ID: ${e.message_id})...`);const r=fe(e);Je.debug('ApplyVarChangeForMessage (Pure)','è·å–åˆ°å½“å‰æ¶ˆæ¯mk',r);try{Je.debug('ApplyVarChangeForMessage (Pure)','å¼€å§‹æŒ‡ä»¤è½¬ä¹‰');const{allInserts:s,allEdits:o,allDeletes:i}=function(e,n=!1){const t=ue(e)||'',a=le(t,se('VariableInsert','exact'),n),r=le(t,se('VariableEdit','exact'),n),s=le(t,se('VariableDelete','exact'),n);Ae.debug('extractAndParseCommands','æ‹¿åˆ°çš„æ¶ˆæ¯æŒ‡ä»¤å—',{insertBlocks:a,editBlocks:r,deleteBlocks:s}),a.length||r.length||s.length||Ae.debug('extractAndParseCommands',`æ¶ˆæ¯ (ID: ${e.message_id}) æœªæ£€æµ‹åˆ°å˜é‡ä¿®æ”¹æ ‡ç­¾ã€‚`);const o=a.flatMap(e=>ae(e)),i=r.flatMap(e=>ae(e)),l=s.flatMap(e=>ae(e));Ae.debug('extractAndParseCommands','è½¬ä¸ºjsonåçš„æŒ‡ä»¤å—',{rawInserts:o,rawEdits:i,rawDeletes:l});const c=Z(o),d=Z(i),p=Z(l);return Ae.debug('extractAndParseCommands','åŸå§‹æ•°æ®è½¬ä¹‰åçš„æŒ‡ä»¤å—',{allInserts:c,allEdits:d,allDeletes:p}),{allInserts:c,allEdits:d,allDeletes:p}}(e,a.ç¹ä½“è½¬ç®€ä½“);Je.debug('ApplyVarChangeForMessage (Pure)','å‡†å¤‡å¼€å§‹å¤„ç†å˜é‡æ›´æ”¹è¯­å¥ï¼Œå½“å‰è¯­å¥ä¸ºï¼š',{allInserts:s,allEdits:o,allDeletes:i});const{finalStat:l,editLog:c}=await async function(e,n){if(!e||0===e.length)return{finalStat:n,editLog:[]};qe.debug('processInsertBlocks','[åˆå§‹çŠ¶æ€] è¿›å…¥ processInsertBlocks æ—¶çš„ statData:',_.cloneDeep(n));const t=_.cloneDeep(n),a=[];for(const n of e)if(_.isPlainObject(n)&&!_.isEmpty(n))try{qe.debug('processInsertBlocks',`å¤„ç† insertRoot: ${JSON.stringify(n)}`),Ye(t,'',n,a,null,null)}catch(e){qe.error('processInsertBlocks',`å¤„ç† insertRoot å¤±è´¥: ${e?.message||e}`,{error:e,insertRoot:n,currentStat:t})}return qe.debug('processInsertBlocks','æ‰€æœ‰ VariableInsert æ“ä½œå®Œæˆ'),{finalStat:t,editLog:a}}(s,n);Je.debug('ApplyVarChangeForMessage (Pure)','å®Œæˆæ’å…¥ï¼Œè¾“å‡ºstatå’ŒeditLogä¸ºï¼š',{statAfterInsert:l,insertLog:c});const{finalStat:d,editLog:p}=await async function(e,n,t,a){if(!e||0===e.length)return{finalStat:_.cloneDeep(t),editLog:[]};const r=_.cloneDeep(t),s=[],o=_.get(a,g,[]),i=_.get(a,u,{});for(const t of e)if(_.isPlainObject(t)&&!_.isEmpty(t))try{Ue.debug('processEditBlocks','å¤„ç† editRoot: ',t),await We(r,'',t,s,n,o,i)}catch(e){Ue.error('processEditBlocks',`å¤„ç† editRoot å¤±è´¥: ${e?.message||e}`,{error:e,editRoot:t,finalStat:r})}return Ue.debug('processEditBlocks','æ‰€æœ‰ VariableEdit æ“ä½œå®Œæˆ'),{finalStat:r,editLog:s}}(o,e.message_id,l,t);Je.debug('ApplyVarChangeForMessage (Pure)','å®Œæˆç¼–è¾‘ï¼Œè¾“å‡ºstatå’ŒeditLogä¸ºï¼š',{statAfterEdit:d,editBlockLog:p});const{finalStat:A,editLog:C}=await async function(e,n){if(!e||0===e.length)return{finalStat:n,editLog:[]};const t=_.cloneDeep(n),a=[];for(const n of e)if(_.isPlainObject(n)&&!_.isEmpty(n))try{Pe.debug('processDeleteBlocks',`å¤„ç† deleteRoot: ${JSON.stringify(n)}`),Le(t,'',n,a)}catch(e){Pe.error('processDeleteBlocks',`å¤„ç† deleteRoot å¤±è´¥: ${e?.message||e}`,{error:e,deleteRoot:n,currentStat:t})}return Pe.debug('processDeleteBlocks','æ‰€æœ‰ VariableDelete æ“ä½œå®Œæˆ'),{finalStat:t,editLog:a}}(i,d);Je.debug('ApplyVarChangeForMessage (Pure)','å®Œæˆåˆ é™¤ï¼Œè¾“å‡ºstatå’ŒeditLogä¸ºï¼š',{statAfterDelete:A,deleteLog:C});return{finalStat:A,finalEditLog:[...c||[],...p||[],...C||[]],mk:r}}catch(a){return Je.error('ApplyVarChangeForMessage (Pure)',`å˜é‡è®¡ç®—å¼‚å¸¸: ${a?.message||a}`,{error:a,message:e,initialStat:n,meta:t}),{finalStat:n,finalEditLog:[],mk:r}}},He=new j('ERAå˜é‡æ¡†æ¶/core/sync'),Qe=e=>{const n=fe(e);return n||null},Ze=(e,n,t,a)=>{if(a)return He.debug('findDivergencePoint','å¼ºåˆ¶æ¨¡å¼ï¼šè®¾ç½®é‡ç®—èµ·ç‚¹ä¸º 0ã€‚'),{type:'FULL_RECALC',recalcId:0};const r=e.map(Qe);let s=-1;const o=Math.min(r.length,n.length);for(let e=0;e<o;e++)if(r[e]!==n[e]){s=e;break}if(-1===s&&r.length!==n.length&&(s=o),-1===s){const n=e.length>0?e.length-1:0;return He.debug('findDivergencePoint',`æ‰€æœ‰MKå‡åŒ¹é…ã€‚å¯åŠ¨æ¨¡æ‹Ÿå†™å…¥ï¼Œå¼ºåˆ¶é‡ç®—æœ€åä¸€æ¡æ¶ˆæ¯ (ID: ${n})ã€‚`),{type:'FULL_RECALC',recalcId:n}}const i=_.difference(n,r);return 0===_.difference(r,n).length&&i.length>0&&((e,n)=>{for(const t of e)if(t&&te(_.get(n,[u,t])).length>0)return!1;return!0})(i,t)?(He.debug('findDivergencePoint','æ£€æµ‹åˆ°çº¯ç²¹çš„æ— å®³åˆ é™¤ã€‚å»ºè®®æ‰§è¡Œå¿«é€ŸåŒæ­¥ã€‚'),{type:'FAST_SYNC',newSelectedMks:r}):(He.debug('findDivergencePoint',`æ£€æµ‹åˆ°éœ€è¦åˆ†æ­§ç‚¹é‡ç®—ã€‚å°†ä»æœ€æ—©çš„åˆ†æ­§ç‚¹ (ID: ${s}) å¼€å§‹ã€‚`),{type:'FULL_RECALC',recalcId:s})},Xe=async(e=!1,n,t=!1)=>{try{e?He.warn('resyncStateOnHistoryChange','å¼ºåˆ¶å®Œå…¨é‡ç®—æ¨¡å¼å·²å¯åŠ¨ï¼'):He.debug('resyncStateOnHistoryChange','èŠå¤©è®°å½•å˜æ›´ï¼Œå¯åŠ¨çŠ¶æ€åŒæ­¥...');const a={ç¹ä½“è½¬ç®€ä½“:E.value.ç¹ä½“è½¬ç®€ä½“},r=getChatMessages('0-{{lastMessageId}}',{include_swipes:!0});He.debug('resyncStateOnHistoryChange','è·å–åˆ°çš„ allMessages:',r);const{stat:s,meta:o}=S(),i=_.cloneDeep(_.get(o,g,[]));if(He.debug('resyncStateOnHistoryChange',`çŠ¶æ€å¿«ç…§: oldSelectedMks.length=${i.length}, allMessages.length=${r?.length??0}`),!r||0===r.length)return void He.debug('resyncStateOnHistoryChange','å½“å‰èŠå¤©è®°å½•ä¸ºç©ºï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒæ­¥ç»ˆæ­¢ã€‚');let l;if('number'==typeof n&&Number.isFinite(n)){const e=Number(n);He.debug('resyncStateOnHistoryChange',`æ£€æµ‹åˆ°å®šå‘åŒæ­¥è¯·æ±‚ï¼Œç›´æ¥ä»¥æ¶ˆæ¯ ID ${e} ä½œä¸ºé‡ç®—èµ·ç‚¹ã€‚`),l={type:'FULL_RECALC',recalcId:e}}else l=Ze(r,i,o,e);if('FAST_SYNC'===l.type)return He.debug('resyncStateOnHistoryChange','æ‰§è¡Œå¿«é€ŸåŒæ­¥...'),await D(e=>(_.set(e,g,l.newSelectedMks),e)),void He.debug('resyncStateOnHistoryChange','å¿«é€ŸåŒæ­¥å®Œæˆï¼Œä»…ä¿®æ­£ SelectedMks æ•°ç»„ã€‚');const c=l.recalcId;let p=s;if(c>-1&&c<i.length){const e=_.get(o,u,{}),n=i[i.length-1],t=c>0?i[c-1]:void 0;n&&(He.debug('resyncStateOnHistoryChange',`å‡†å¤‡ä¸€æ¬¡æ€§å›æ»šã€‚ä»: ${n}, åˆ°: ${t||'åˆå§‹çŠ¶æ€'}`),p=function(e,n,t,a,r){const s=a.indexOf(n),o=e?a.indexOf(e):-1;if(-1===s){const e=`åœ¨åºåˆ—ä¸­æœªæ‰¾åˆ°å½“å‰MK: ${n}`;throw we.error('rollbackStatToMK',e,{currentMK:n,selectedMks:a}),new Error(e)}if(e&&-1===o){const n=`åœ¨åºåˆ—ä¸­æœªæ‰¾åˆ°ç›®æ ‡MK: ${e}`;throw we.error('rollbackStatToMK',n,{targetMK:e,selectedMks:a}),new Error(n)}if(o>s)return we.warn('rollbackStatToMK','ç›®æ ‡MKä¸åœ¨è¿‡å»ï¼Œè¿”å›å½“å‰çŠ¶æ€ã€‚',{targetMK:e,currentMK:n,targetIndex:o,currentIndex:s}),_.cloneDeep(t);if(o===s)return _.cloneDeep(t);let i=_.cloneDeep(t);for(let e=s;e>o;e--){const n=a[e];n&&(i=Ee(i,te(r[n])))}return i}(t,n,s,i,e),He.debug('resyncStateOnHistoryChange','é€†åºå›æ»šå®Œæˆï¼ˆå†…å­˜ä¸­ï¼‰ã€‚'))}He.debug('resyncStateOnHistoryChange',`ä» ID ${c} å¼€å§‹é¡ºåºé‡ç®—...`);const C=i.slice(0,c),b=_.cloneDeep(o);for(let e=c;e<r.length;e++){if(t&&e>c){He.debug('resyncStateOnHistoryChange',`å®šå‘åŒæ­¥å®Œæˆï¼Œå·²å¤„ç†è‡³ç›®æ ‡æ¶ˆæ¯ ID: ${c}ã€‚ä¸­æ­¢é‡ç®—ã€‚`);break}const n=r[e],s=_.cloneDeep(b);_.set(s,g,C.slice(0,e));let o=fe(n)||null;if(!o){He.debug('resyncStateOnHistoryChange',`å½“å‰æ¶ˆæ¯id: ${n?.message_id??'unknown'}) ç¼ºå°‘ MKã€‚ä¸ºå…¶ç”Ÿæˆ.`);try{const{mk:e}=await he(n);o=e}catch(e){He.error('resyncStateOnHistoryChange','mkæ³¨å…¥å¤±è´¥ï¼Œè·³è¿‡æ¶ˆæ¯',{ensureError:e,message_id:n?.message_id});continue}}const{finalStat:i,finalEditLog:l,mk:d}=await Ke(n,p,s,a);C[e]=o,p=i,_.set(b,[u,o],l)}He.debug('resyncStateOnHistoryChange','é¡ºåºé‡ç®—å®Œæˆã€‚'),_.set(b,g,C),await async function(e){await updateVariablesWith(async n=>{const t=B().get(n,A,{}),a=await e(t);return B().set(n,A,a),n},d)}(()=>p),await D(()=>b),He.debug('resyncStateOnHistoryChange','çŠ¶æ€åŒæ­¥å®Œæˆã€‚')}catch(n){He.error('resyncStateOnHistoryChange',`çŠ¶æ€åŒæ­¥æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯: ${n?.message||n}`,{error:n,forceFullResync:e,eraData:S(),allMessages:getChatMessages('0-{{lastMessageId}}',{include_swipes:!0})})}},en=new j('ERAå˜é‡æ¡†æ¶/ui/patch');async function nn(e){const n=getChatMessages(e);if(!n||0===n.length)return void en.warn('forceRenderMessage',`æ‰¾ä¸åˆ°æ¶ˆæ¯IDä¸º ${e} çš„æ¶ˆæ¯ã€‚`);const t=n[0];await setChatMessages([{message_id:e,message:t.message}]),en.debug('forceRenderMessage',`å·²ä½¿ç”¨ setChatMessages åˆ·æ–°æ¶ˆæ¯ ${e}ã€‚`)}const tn=new j('ERAå˜é‡æ¡†æ¶/events/handlers/sync');async function an(e,n,t,a,r=!1){const{type:s}=e;tn.debug('handleSyncEvent',`äº‹ä»¶ ${s} è§¦å‘çŠ¶æ€åŒæ­¥æµç¨‹...`);const o='manual_full_sync'===s;await Xe(o,a,r),n.resync=!0,'combo_sync'!=s&&async function(){const e=getVariables({type:'script',script_id:getScriptId()});if(!_.get(e,'å¼ºåˆ¶é‡è½½åŠŸèƒ½',!1))return void en.debug('forceRenderRecentMessages','å¼ºåˆ¶é‡è½½åŠŸèƒ½æœªå¯ç”¨, è·³è¿‡ã€‚');const n=_.get(e,'å¼ºåˆ¶é‡è½½æ¶ˆæ¯æ•°',1);en.log('forceRenderRecentMessages',`å¼€å§‹å¼ºåˆ¶é‡è½½, æ•°é‡: ${n}`),await new Promise(e=>setTimeout(e,1e3));const t=getChatMessages('0-{{lastMessageId}}');if(!t||0===t.length)return void en.warn('forceRenderRecentMessages','æ— æ³•è·å–åˆ°ä»»ä½•æ¶ˆæ¯, ç»ˆæ­¢é‡è½½ã€‚');const a=t.slice(-n);for(const e of a)en.debug('forceRenderRecentMessages',`æ­£åœ¨å¼ºåˆ¶æ¸²æŸ“æ¶ˆæ¯: ${e.message_id}`),await nn(e.message_id),await new Promise(e=>setTimeout(e,100));en.log('forceRenderRecentMessages','å¼ºåˆ¶é‡è½½å®Œæˆã€‚')}(),await ve(t.mk);const i=getChatMessages('0-{{lastMessageId}}',{include_swipes:!0});tn.debug('handleSyncEvent','å®Œæˆsyncå¤„ç†åçš„æ¶ˆæ¯åˆ—è¡¨',i),Ie(t)}const rn=new j('ERAå˜é‡æ¡†æ¶/events/dispatcher');let sn=null;function on(){const e=T.mk;return e&&sn&&sn.mk===e?(rn.debug('updateConsecutiveMkCount',`è¿ç»­å¤„ç†å†™å…¥/åŒæ­¥æ“ä½œçš„ MK: ${e}ã€‚æ—§è®¡æ•°: ${sn.count}ï¼Œæ–°è®¡æ•°: ${sn.count+1}`),sn.count++):(rn.debug('updateConsecutiveMkCount',`æ–°çš„å†™å…¥/åŒæ­¥æ“ä½œçš„ MK: ${e}ã€‚é‡ç½®è®¡æ•°ä¸º 1ã€‚å‰ä¸€ä¸ª MK æ˜¯: ${sn?.mk}`),sn={mk:e,count:1}),sn.count}async function ln(n,t){const{type:a}=n,r=Y(a);let s=null;const o=n.detail;rn.debug('dispatchAndExecuteTask','å…¨å¤„ç†å¼€å§‹å‰å¿«ç…§ï¼Œæ‰€æœ‰æ¶ˆæ¯',getChatMessages('0-{{lastMessageId}}',{include_swipes:!0}));const i={rollback:!1,apply:!1,resync:!1,api:!1,apiWrite:!1,editedResync:!1,swipedRollback:!1};try{await async function(e,n=20,t=50){let a;if(e)if('number'==typeof e){const n=getChatMessages(e,{include_swipes:!0});a=n?n[0]:null}else a=e;else a=Ce();if(!a)return Ae.warn('getMessageContentWithRetry','æ‰¾ä¸åˆ°æœ‰æ•ˆçš„æ¶ˆæ¯å¯¹è±¡',{messageOrId:e}),null;for(let e=0;e<n;e++){const n=ue(a);if(n)return n;Ae.log('getMessageContentWithRetry',`è·å–æ¶ˆæ¯å†…å®¹å¤±è´¥ï¼Œå°†åœ¨ ${t}ms åé‡è¯• (ç¬¬ ${e+1} æ¬¡)`),await new Promise(e=>setTimeout(e,t))}return Ae.warn('getMessageContentWithRetry',`é‡è¯• ${n} æ¬¡åä»æ— æ³•è·å–æ¶ˆæ¯å†…å®¹`,{message_id:a.message_id}),ue(a)}();const t=getChatMessages(-1,{include_swipes:!0})?.[0];if(!t)return rn.warn('dispatchAndExecuteTask','æ— æ³•è·å–æœ€æ–°æ¶ˆæ¯ï¼Œè·³è¿‡ä»»åŠ¡æ‰§è¡Œã€‚'),null;let l,c;if('combo_swipe_and_regenerate'===a||'API'===Y(a))rn.log('dispatchAndExecuteTask',`æ£€æµ‹åˆ° ${a} äº‹ä»¶ï¼Œè·³è¿‡ MK å’Œå ä½ç¬¦æ³¨å…¥ã€‚`),c=t.message_id,l='';else{rn.log('dispatchAndExecuteTask','è°ƒç”¨ ensureMkForLatestMessage');const{mk:e,message_id:n,isNewKey:a}=await(async e=>{try{if(me.debug('ensureMkForLatestMessage','æ¥æ”¶åˆ°çš„æœ€æ–°æ¶ˆæ¯å¯¹è±¡ (msg)',e),!e||'number'!=typeof e.message_id)return me.warn('ensureMkForLatestMessage','æ— æ•ˆçš„æœ€æ–°æ¶ˆæ¯å¯¹è±¡æˆ–å…¶IDï¼Œé€€å‡º',{latestMessage:e}),{mk:'',message_id:null,isNewKey:!1};const{mk:n,isNew:t}=await he(e);return me.debug('ensureMkForLatestMessage',`å·²ä¸ºæœ€æ–°æ¶ˆæ¯ ${e.message_id} ç¡®ä¿ MK å­˜åœ¨ã€‚ (æ˜¯å¦æ–°å»º: ${t})`),{mk:n,message_id:e.message_id,isNewKey:t}}catch(n){return me.error('ensureMkForLatestMessage',`ç¡®ä¿MKæ—¶å¼‚å¸¸: ${n?.message||n}`,{error:n,latestMessage:e}),{mk:'',message_id:null,isNewKey:!1}}})(t);if(!e||null===n)return rn.warn('dispatchAndExecuteTask','æ— æ³•è·å–æœ‰æ•ˆçš„ MK æˆ–æ¶ˆæ¯ IDï¼Œè·³è¿‡ä»»åŠ¡æ‰§è¡Œã€‚'),null;l=e,c=n,rn.log('dispatchAndExecuteTask','è°ƒç”¨ ensurePlaceholder'),await async function(e){const n='ensurePlaceholder';if(ye.debug(n,`æ‰§è¡Œå ä½ç¬¦ä¿éšœï¼Œæ¶ˆæ¯ ID: ${e}`),!E.value.åœ¨aiæ¶ˆæ¯å°¾éƒ¨ç”Ÿæˆç‰¹æ®Šç¬¦å·)return void ye.debug(n,'åŠŸèƒ½æœªå¯ç”¨ï¼Œå·²è·³è¿‡ã€‚');ye.debug(n,'åŠŸèƒ½å·²å¯ç”¨ï¼Œç»§ç»­æ‰§è¡Œã€‚');const t=getChatMessages(e,{include_swipes:!0})[0];if(!t)return void ye.warn(n,`æ— æ³•æ‰¾åˆ°æ¶ˆæ¯ ID: ${e} å¯¹åº”çš„æ¶ˆæ¯ã€‚`);if(ye.debug(n,`è·å–åˆ°æ¶ˆæ¯å¯¹è±¡ (ID: ${e})`,t),ge(t))return void ye.debug(n,`æ¶ˆæ¯ ${e} æ˜¯ç”¨æˆ·æ¶ˆæ¯ï¼Œå·²è·³è¿‡ã€‚`);ye.debug(n,`æ¶ˆæ¯ ${e} æ˜¯ AI æ¶ˆæ¯ï¼Œç»§ç»­å¤„ç†ã€‚`);const a=E.value.ç‰¹æ®Šç¬¦å·å€¼,r=ue(t);if(ye.debug(n,'è¯»å–åˆ°æ¶ˆæ¯å†…å®¹:',{content:r}),ye.debug(n,'ä½¿ç”¨çš„å ä½ç¬¦:',{placeholder:a}),r&&r.includes(a))return void ye.debug(n,'æ¶ˆæ¯å·²åŒ…å«å ä½ç¬¦ï¼Œæ— éœ€æ“ä½œã€‚');const s=(r||'').trimEnd()+'\n'+a;ye.debug(n,'å‡†å¤‡æ›´æ–°æ¶ˆæ¯ï¼Œæ·»åŠ å ä½ç¬¦ã€‚',{newMessage:s});try{await be(t,s,'affected'),ye.debug(n,'æ¶ˆæ¯æ›´æ–°æˆåŠŸã€‚')}catch(e){ye.error(n,'æ›´æ–°æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯ã€‚',e)}}(c)}if(null===c)return rn.warn('dispatchAndExecuteTask','æ— æ³•è·å–æœ‰æ•ˆçš„æ¶ˆæ¯ IDï¼Œè·³è¿‡ä»»åŠ¡æ‰§è¡Œã€‚'),null;T.mk=l,s=c;const d=ge(t);rn.log('dispatchAndExecuteTask',`æ‰§è¡Œä»»åŠ¡: ${a} (åˆ†ç»„: ${r})`);const p={mk:l,message_id:s,is_user:d,actions:i,consecutiveProcessingCount:1};switch(r){case'INIT':rn.log('dispatchAndExecuteTask','è°ƒç”¨ initializeExternalSettings'),Be(),p.consecutiveProcessingCount=on(),rn.log('dispatchAndExecuteTask','è°ƒç”¨ handleSyncEvent for INIT'),await an(n,i,p);break;case'SYNC':a===e.API_WRITE&&(i.apiWrite=!0),p.consecutiveProcessingCount=on(),rn.log('dispatchAndExecuteTask','è°ƒç”¨ handleSyncEvent for SYNC'),await an(n,i,p);break;case'API':rn.log('dispatchAndExecuteTask','è°ƒç”¨ handleApiEvent'),Oe(n,i);break;case'UPDATE_MK_ONLY':rn.log('dispatchAndExecuteTask','è°ƒç”¨ handleUpdateMkOnlyEvent'),await async function(e){await ve(e)}(l);break;case'DIRECTED_SYNC':if(p.consecutiveProcessingCount=on(),'combo_swipe_and_regenerate'===a){i.swipedRollback=!0;const e=s-1,t=!0;rn.log('dispatchAndExecuteTask',`å¤„ç† combo_swipe_and_regenerate äº‹ä»¶ï¼Œç›®æ ‡æ¶ˆæ¯ ID: ${e}, stopAtTarget: ${t}`),e<0?(rn.warn('dispatchAndExecuteTask','æ— æ³•å¯¹ç¬¬ä¸€æ¡æ¶ˆæ¯æ‰§è¡Œæ»‘åŠ¨å›é€€ï¼ŒæŒ‰æ™®é€šåŒæ­¥å¤„ç†ã€‚'),await an(n,i,p)):await an(n,i,p,e,t)}else if(a===tavern_events.MESSAGE_EDITED){i.editedResync=!0;const e=function(e){if(null==e)return Ae.debug('extractMessageIdFromDetail','detail ä¸ºç©ºï¼Œæ— æ³•è§£æ message_idã€‚'),null;if('number'==typeof e)return Number.isFinite(e)?(Ae.debug('extractMessageIdFromDetail','ä» number detail è·å– message_idã€‚',{message_id:e}),e):(Ae.debug('extractMessageIdFromDetail','number detail éæœ‰é™å€¼ï¼Œå¿½ç•¥ã€‚',{detail:e}),null);if('string'==typeof e){const n=Number(e);return Number.isFinite(n)?(Ae.debug('extractMessageIdFromDetail','ä» string detail è§£æ message_idã€‚',{raw:e,message_id:n}),n):(Ae.debug('extractMessageIdFromDetail','string detail æ— æ³•è§£æä¸ºæœ‰æ•ˆæ•°å­—ï¼Œå¿½ç•¥ã€‚',{raw:e}),null)}if(Array.isArray(e)&&e.length>0){const n=Number(e[0]);return Number.isFinite(n)?(Ae.debug('extractMessageIdFromDetail','ä»æ•°ç»„ detail[0] è§£æ message_idã€‚',{raw:e[0],message_id:n}),n):(Ae.debug('extractMessageIdFromDetail','æ•°ç»„ detail[0] æ— æ³•è§£æä¸ºæœ‰æ•ˆæ•°å­—ï¼Œå¿½ç•¥ã€‚',{raw:e[0]}),null)}if('object'==typeof e){if('number'==typeof e.message_id)return Number.isFinite(e.message_id)?(Ae.debug('extractMessageIdFromDetail','ä»å¯¹è±¡ detail.message_id(number) è·å– message_idã€‚',{message_id:e.message_id}),e.message_id):(Ae.debug('extractMessageIdFromDetail','å¯¹è±¡ detail.message_id(number) ä¸æ˜¯æœ‰é™å€¼ï¼Œå¿½ç•¥ã€‚',{message_id:e.message_id}),null);if('string'==typeof e.message_id){const n=Number(e.message_id);return Number.isFinite(n)?(Ae.debug('extractMessageIdFromDetail','ä»å¯¹è±¡ detail.message_id(string) è§£æ message_idã€‚',{raw:e.message_id,message_id:n}),n):(Ae.debug('extractMessageIdFromDetail','å¯¹è±¡ detail.message_id(string) æ— æ³•è§£æä¸ºæœ‰æ•ˆæ•°å­—ï¼Œå¿½ç•¥ã€‚',{raw:e.message_id}),null)}if(Array.isArray(e.eventArgs)&&e.eventArgs.length>0){const n=Number(e.eventArgs[0]);return Number.isFinite(n)?(Ae.debug('extractMessageIdFromDetail','ä»å¯¹è±¡ detail.eventArgs[0] è§£æ message_idã€‚',{raw:e.eventArgs[0],message_id:n}),n):(Ae.debug('extractMessageIdFromDetail','å¯¹è±¡ detail.eventArgs[0] æ— æ³•è§£æä¸ºæœ‰æ•ˆæ•°å­—ï¼Œå¿½ç•¥ã€‚',{raw:e.eventArgs[0]}),null)}}return Ae.debug('extractMessageIdFromDetail','æœªèƒ½ä»äº‹ä»¶ detail ä¸­è§£æå‡ºæœ‰æ•ˆçš„ message_idã€‚',{detail:e}),null}(o),t=!1;rn.log('dispatchAndExecuteTask',`å¤„ç† MESSAGE_EDITED äº‹ä»¶ï¼Œç›®æ ‡æ¶ˆæ¯ ID: ${e}, stopAtTarget: ${t}`),null===e||e<0?(rn.warn('dispatchAndExecuteTask','MESSAGE_EDITED äº‹ä»¶ç¼ºå°‘æˆ–æ— æ•ˆçš„ message_idï¼ŒæŒ‰æ™®é€šåŒæ­¥å¤„ç†ã€‚',{eventDetail:o}),await an(n,i,p)):await an(n,i,p,e,t)}else rn.warn('dispatchAndExecuteTask',`æ¥æ”¶åˆ°æœªæ˜ç¡®å¤„ç†çš„ DIRECTED_SYNC äº‹ä»¶: ${a}ï¼ŒæŒ‰æ™®é€šåŒæ­¥å¤„ç†ã€‚`),await an(n,i,p)}}catch(e){rn.error('dispatchAndExecuteTask',`äº‹ä»¶ ${a} å¤„ç†å¼‚å¸¸: ${e}`,e)}finally{T.mk=''}return null}const cn=new j('ERAå˜é‡æ¡†æ¶/events/queue'),dn=[];let pn=!1,An=!1,un=null;function gn(e,n){cn.debug('pushToQueue',`æ¥æ”¶åˆ°äº‹ä»¶: ${e}ï¼Œå·²æ¨å…¥é˜Ÿåˆ—ã€‚`,{detail:n}),dn.push({type:e,detail:n,timestamp:Date.now()}),async function(){if(An)return void cn.debug('processQueue','å·²æœ‰å¤„ç†å‡½æ•°åœ¨æ’é˜Ÿç­‰å¾…ï¼Œæœ¬æ¬¡è°ƒç”¨å¿½ç•¥ã€‚');pn&&(cn.debug('processQueue','å¤„ç†å™¨å¿™ç¢Œï¼Œè¿›å…¥æ’é˜Ÿç­‰å¾…çŠ¶æ€...'),An=!0,await new Promise(e=>{un=e}),An=!1,cn.debug('processQueue','ç­‰å¾…ç»“æŸï¼Œè·å–åˆ°å¤„ç†æƒã€‚'));if(0===dn.length)return void cn.debug('processQueue','é˜Ÿåˆ—ä¸ºç©ºï¼Œæ— éœ€å¤„ç†ã€‚');pn=!0,cn.debug('processQueue','å¤„ç†å™¨å¯åŠ¨');const e=dn[0];if('API'!==Y(e.type)){const n=q.get(e.type)??300;cn.debug('processQueue',`å¯åŠ¨äº‹ä»¶æ”¶é›†çª—å£ï¼Œç­‰å¾… ${n}ms...`),await new Promise(e=>setTimeout(e,n))}cn.debug('processQueue','äº‹ä»¶æ”¶é›†çª—å£å…³é—­ï¼Œå‡†å¤‡å¤„ç†çš„é˜Ÿåˆ—å†…å®¹:',JSON.stringify(dn.map(e=>e.type)));for(;dn.length>0;){const e=dn.splice(0,dn.length),n=U(e);cn.debug('processQueue',`å¼€å§‹å¤„ç†ä¸€ä¸ªæ–°æ‰¹æ¬¡ï¼ŒåŒ…å« ${e.length} ä¸ªåŸå§‹äº‹ä»¶ï¼Œåˆå¹¶åä¸º ${n.length} ä¸ªä»»åŠ¡ã€‚`);for(const e of n)await ln(e);cn.debug('processQueue','æœ¬è½®æ‰¹æ¬¡å¤„ç†å®Œæ¯•ã€‚')}if(pn=!1,cn.debug('processQueue','å¤„ç†å™¨ç©ºé—²ï¼Œå·²é‡Šæ”¾é”ã€‚'),un){cn.debug('processQueue','é€šçŸ¥æ’é˜Ÿçš„å¤„ç†å™¨å¼€å§‹å·¥ä½œã€‚');const e=un;un=null,e()}}()}const Cn=new j('MacroParser');function bn(e,n,t){if(!e.includes('{{ERA'))return e;const a=n??S().stat,r=t??k(S().stat);return e.replace(/{{\s*ERA(-withmeta)?\s*:\s*([^}]+?)\s*}}/gi,(e,n,t)=>{const s='parseEraMacros',o=t.trim(),i=!!n,l=i?a:r;if(!l)return Cn.warn(s,`æ— æ³•è·å–åˆ°å®æ›¿æ¢æ‰€éœ€çš„æ•°æ® (includeMeta: ${i})`),e;let c;if(c='$ALLDATA'===o?l:_.get(l,o),void 0===c)return Cn.warn(s,`åœ¨æ•°æ®æºä¸­æœªæ‰¾åˆ°è·¯å¾„ "${o}", å®å°†æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸².`),'';const d=c;return Cn.debug(s,`å®æ›¿æ¢æ•°æ®: ${o}`,{data:d}),'object'==typeof d&&null!==d?JSON.stringify(d):String(d)})}const mn=e=>{if(e.actions.swipedRollback)return void Cn.debug('handleWriteDone','æ£€æµ‹åˆ° swipedRollbackï¼Œè·³è¿‡å®åˆ·æ–°ã€‚');const{message_id:n}=e;if('number'==typeof n)try{const t=retrieveDisplayedMessage(n);if(!t.length)return;const a=t.html();if(!a.includes('{{ERA'))return;const r=SillyTavern?.chat?.[n],s='string'==typeof r?.mes?r.mes:null,o=null!==s&&s.includes('{{ERA'),i=a.includes('{{ERA');if(!o&&!i)return;const l=o?bn(s,e.stat,e.statWithoutMeta):null,c=i?bn(a,e.stat,e.statWithoutMeta):a,d=null!==l&&l!==s,p=c!==a;if(!d&&!p)return;let A=!1;if(d){const e='function'==typeof formatAsDisplayedMessage?formatAsDisplayedMessage:null;let a=null;if(e)try{a=e(l,{message_id:n})??null}catch(e){Cn.warn('handleWriteDone','formatAsDisplayedMessage failed; falling back to DOM patch.',e)}const r=SillyTavern?.updateMessageBlock;if('function'==typeof r){const e={mes:l};null!==a&&(e.message=a),r.call(SillyTavern,n,e,{rerenderMessage:!0}),A=!0}else null!==a&&(t.html(a),A=!0)}if(!A&&p){(function(e,n,t){let a=!1;const r=/{{\s*ERA/i,s=e=>{if(e.nodeType===Node.TEXT_NODE){const s=e.nodeValue??'';if(!r.test(s))return;const o=bn(s,n,t);return void(o!==s&&(e.nodeValue=o,a=!0))}if(e.nodeType!==Node.ELEMENT_NODE)return;const o=e.tagName;if('SCRIPT'===o||'STYLE'===o||'TEXTAREA'===o)return;const i=Array.from(e.childNodes);for(const e of i)s(e)};return e.each((_,e)=>{s(e)}),a})(t,e.stat,e.statWithoutMeta)&&(Cn.debug('handleWriteDone',`Patched macros in-place for message_id: ${n}`),A=!0)}A&&Cn.debug('handleWriteDone',`Successfully re-rendered macros for message_id: ${n}`)}catch(e){Cn.error('handleWriteDone',`Failed to re-render macros for message_id: ${n}`,e)}else Cn.warn('handleWriteDone','Event payload did not provide a valid message_id.')};const fn=(e,n)=>{if(n)return;if(!e.prompt.some(e=>'string'==typeof e.content&&e.content.includes('{{ERA')))return;const t=n=>{if('getCurrentVars'!==n.queryType)return;if(eventRemoveListener('era:queryResult',t),n.result&&n.result.error)return void Cn.error('handleGenerateAfterData','ERA æŸ¥è¯¢ [getCurrentVars] å¤±è´¥:',n.result.error);const a=n.result?.stat,r=n.result?.statWithoutMeta;if(a&&r){Cn.debug('handleGenerateAfterData','æˆåŠŸé€šè¿‡äº‹ä»¶è·å–åˆ°å½“å‰å˜é‡å¿«ç…§ï¼Œå‡†å¤‡æ›¿æ¢å®ã€‚');for(const n of e.prompt)if('string'==typeof n.content&&n.content.includes('{{ERA')){const e=n.content;n.content=bn(e,a,r),e!==n.content&&Cn.log('handleGenerateAfterData',`æˆåŠŸæ›¿æ¢äº† role: ${n.role} æ¶ˆæ¯ä¸­çš„ ERA å®ã€‚`)}}else Cn.warn('handleGenerateAfterData','æ— æ³•ä» era:queryResult äº‹ä»¶ä¸­è·å–å®Œæ•´çš„å˜é‡å¿«ç…§ï¼Œè·³è¿‡å®æ›¿æ¢ã€‚')};eventOn('era:queryResult',t),Cn.debug('handleGenerateAfterData','å‘é€ era:getCurrentVars äº‹ä»¶ä»¥è·å–å®æ›¿æ¢æ‰€éœ€çš„çŠ¶æ€ã€‚'),eventEmit('era:getCurrentVars')};$(()=>{eventOn(tavern_events.GENERATE_AFTER_DATA,fn),eventOn(f,mn),Cn.log('setupMacroAutoRefresh','ç›‘å¬åˆ°writeDone,å¼€å§‹å¯¹æ¶ˆæ¯ä¸­çš„å®è¿›è¡Œæ›¿æ¢.'),$(window).on('pagehide',()=>{eventRemoveListener(f,mn),Cn.log('removeMacroAutoRefresh','Macro auto-refresh listener has been removed.'),eventRemoveListener(tavern_events.GENERATE_AFTER_DATA,fn)})});const hn={class:'acc'},vn=['aria-expanded'],xn={class:'title'},Bn={class:'hint'},yn={class:'inner'},wn=(0,y.defineComponent)({__name:'EraAccordion',props:{title:{},defaultOpen:{type:Boolean,default:!1}},setup(e){const n=e,t=(0,y.ref)(n.defaultOpen);return(n,a)=>((0,y.openBlock)(),(0,y.createElementBlock)('section',hn,[(0,y.createCommentVNode)(' æŠ˜å å¤´ï¼šç‚¹å‡»åˆ‡æ¢ '),(0,y.createElementVNode)('button',{class:'acc-head','aria-expanded':t.value?'true':'false',onClick:a[0]||(a[0]=e=>t.value=!t.value)},[(0,y.createElementVNode)('span',{class:(0,y.normalizeClass)(['caret',{open:t.value}])},'â–¸',2),(0,y.createCommentVNode)(' æŒ‡ç¤ºç®­å¤´ '),(0,y.createElementVNode)('span',xn,(0,y.toDisplayString)(e.title),1),(0,y.createCommentVNode)(' æ ‡é¢˜æ–‡æœ¬ '),a[1]||(a[1]=(0,y.createElementVNode)('span',{class:'spacer'},null,-1)),(0,y.createCommentVNode)(' å¼¹æ€§ç©ºéš™ '),(0,y.createElementVNode)('span',Bn,(0,y.toDisplayString)(t.value?'æ”¶èµ·':'å±•å¼€'),1),(0,y.createCommentVNode)(' å³ä¾§æç¤º ')],8,vn),(0,y.createCommentVNode)(' å†…å®¹ï¼šé«˜åº¦è¿‡æ¸¡ï¼ˆä½¿ç”¨ CSS Gridï¼‰ '),(0,y.createElementVNode)('div',{class:(0,y.normalizeClass)(['acc-body',{open:t.value}])},[(0,y.createElementVNode)('div',yn,[(0,y.renderSlot)(n.$slots,'default')])],2)]))}});i(854);var En=i(800);const kn=(0,En.A)(wn,[['__scopeId','data-v-f723f6d6']]),_n={class:'meta'},Sn={class:'kv'},Dn={class:'item'},Mn=['title'],Nn={class:'item'},Vn={class:'v'},Rn={class:'item'},In={class:'v'},Fn=(0,y.defineComponent)({__name:'MetaHeader',props:{mk:{},messageId:{},isUser:{type:Boolean}},setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/components/EraPanelContent/MetaHeader'),t=e;return(0,y.onMounted)(()=>{}),(0,y.watch)(()=>t,e=>{n.debug('watch:props','Props å‘ç”Ÿå˜åŒ–',{newProps:e})},{deep:!0}),(n,t)=>((0,y.openBlock)(),(0,y.createElementBlock)('section',_n,[(0,y.createElementVNode)('div',Sn,[(0,y.createElementVNode)('div',Dn,[t[0]||(t[0]=(0,y.createElementVNode)('span',{class:'k'},'mk',-1)),(0,y.createCommentVNode)(' é”®ï¼šmk '),(0,y.createElementVNode)('span',{class:'v',title:e.mk},(0,y.toDisplayString)(e.mk||'â€”'),9,Mn),(0,y.createCommentVNode)(' å€¼ï¼šmk ')]),(0,y.createElementVNode)('div',Nn,[t[1]||(t[1]=(0,y.createElementVNode)('span',{class:'k'},'message_id',-1)),(0,y.createCommentVNode)(' é”®ï¼šmessage_id '),(0,y.createElementVNode)('span',Vn,(0,y.toDisplayString)(e.messageId??'â€”'),1),(0,y.createCommentVNode)(' å€¼ï¼šmessage_id ')]),(0,y.createElementVNode)('div',Rn,[t[2]||(t[2]=(0,y.createElementVNode)('span',{class:'k'},'æ¥æº',-1)),(0,y.createCommentVNode)(' é”®ï¼šæ¥æº '),(0,y.createElementVNode)('span',In,(0,y.toDisplayString)(e.isUser?'ç”¨æˆ·':'AI'),1),(0,y.createCommentVNode)(' å€¼ï¼šæ¥æº ')])])]))}});i(99);const Tn=(0,En.A)(Fn,[['__scopeId','data-v-9a5820b4']]),$n={class:'node'},jn={class:'key'},On={class:'brace'},Pn={key:0,class:'summary'},Ln={key:0,class:'json-children'},Gn={class:'brace'};const zn=(0,y.defineComponent)({name:'JsonNode',props:{k:{type:[String,Number],required:!0},v:{required:!0},path:{type:String,required:!0},level:{type:Number,required:!0},defaultCollapsed:{type:Boolean,default:!0},maxDepth:{type:Number,default:3}},setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/template/JsonNode');(0,y.onMounted)(()=>{});const t=(0,y.computed)(()=>{const n=e.v;if(null===n)return'null';if(Array.isArray(n))return'array';const t=typeof n;return'object'===t?'object':'undefined'===t?'undefined':t}),a=(0,y.computed)(()=>'array'===t.value),r=(0,y.computed)(()=>'object'===t.value),s=(0,y.computed)(()=>a.value||r.value),o=(0,y.ref)(e.level<=(e.maxDepth??3)||!e.defaultCollapsed);(0,y.watch)(o,e=>{n.debug('watch:open','æŠ˜å çŠ¶æ€æ”¹å˜ä¸º: '+(e?'å±•å¼€':'æ”¶èµ·'))});const i=(0,y.computed)(()=>{const n=e.v;switch(t.value){case'string':return JSON.stringify(n);case'number':case'symbol':return String(n);case'boolean':return n?'true':'false';case'null':return'null';case'undefined':return'undefined';case'bigint':return String(n)+'n';case'function':return'Æ’()';default:return''}}),l=(0,y.computed)(()=>a.value?`Array[${e.v.length}]`:r.value?`Object{${Object.keys(e.v||{}).length}}`:''),c=(0,y.computed)(()=>{if(r.value)return e.v;if(a.value){const n={};return e.v.forEach((e,t)=>{n[String(t)]=e}),n}return{}});return{type:t,isArray:a,foldable:s,open:o,primitiveText:i,summary:l,childEntries:c}}});i(330);const qn=(0,En.A)(zn,[['render',function(e,n,t,a,r,s){const o=(0,y.resolveComponent)('JsonNode',!0);return(0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,null,[(0,y.createCommentVNode)(' å•æ¡èŠ‚ç‚¹ï¼ˆæ”¯æŒé€’å½’ï¼‰ '),(0,y.createElementVNode)('div',$n,[(0,y.createCommentVNode)(' æ¯ä¸ªé”®å€¼å¯¹ / æ•°ç»„é¡¹çš„å®¹å™¨ '),(0,y.createElementVNode)('div',{class:'json-line',style:(0,y.normalizeStyle)({paddingLeft:14*e.level+'px'})},[(0,y.createCommentVNode)(' è¡Œ+ç¼©è¿› '),e.foldable?((0,y.openBlock)(),(0,y.createElementBlock)('button',{key:0,class:(0,y.normalizeClass)(['caret',{open:e.open}]),'aria-label':'toggle',onClick:n[0]||(n[0]=n=>e.open=!e.open)},'â–¸',2)):(0,y.createCommentVNode)('v-if',!0),(0,y.createCommentVNode)(' æŠ˜å ç®­å¤´æŒ‰é’® '),(0,y.createElementVNode)('span',jn,(0,y.toDisplayString)(e.k),1),n[1]||(n[1]=(0,y.createElementVNode)('span',{class:'colon'},':',-1)),(0,y.createCommentVNode)(' é”®ä¸å†’å· '),(0,y.createCommentVNode)(' å¯æŠ˜å å®¹å™¨ï¼šåªæ˜¾ç¤ºæ‹¬å·ä¸æ‘˜è¦ï¼›å±•å¼€åç”±ä¸‹æ–¹ children åŒºåŸŸé€’å½’æ¸²æŸ“ '),e.foldable?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:1},[(0,y.createElementVNode)('span',On,(0,y.toDisplayString)(e.isArray?'[':'{'),1),(0,y.createCommentVNode)(' å®¹å™¨èµ·å§‹æ‹¬å· '),e.open?(0,y.createCommentVNode)('v-if',!0):((0,y.openBlock)(),(0,y.createElementBlock)('span',Pn,(0,y.toDisplayString)(e.summary),1)),(0,y.createCommentVNode)(' æ”¶èµ·æ—¶çš„æ‘˜è¦ ')],64)):((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:2},[(0,y.createCommentVNode)(' åŸå§‹å€¼ï¼šç›´æ¥ç€è‰²æ¸²æŸ“ '),(0,y.createElementVNode)('span',{class:(0,y.normalizeClass)(['val',e.type])},(0,y.toDisplayString)(e.primitiveText),3),(0,y.createCommentVNode)(' åŸå§‹å€¼æ–‡æœ¬ ')],64))],4),(0,y.createCommentVNode)(' å­å…ƒç´ åŒºåŸŸï¼šä»…å½“å¯æŠ˜å ä¸”å¤„äºå±•å¼€æ€æ—¶æ˜¾ç¤º '),e.foldable&&e.open?((0,y.openBlock)(),(0,y.createElementBlock)('div',Ln,[(0,y.createCommentVNode)(' é€’å½’ï¼šè‡ªå¼•ç”¨åŒåç»„ä»¶ JsonNodeï¼ˆä¾èµ– name: \'JsonNode\' å®ç°è‡ªé€’å½’ï¼‰ '),((0,y.openBlock)(!0),(0,y.createElementBlock)(y.Fragment,null,(0,y.renderList)(e.childEntries,(n,t)=>((0,y.openBlock)(),(0,y.createBlock)(o,{key:e.path+'/'+String(t),k:String(t),v:n,path:e.path+'/'+String(t),level:e.level+1,'default-collapsed':e.defaultCollapsed,'max-depth':e.maxDepth},null,8,['k','v','path','level','default-collapsed','max-depth']))),128)),(0,y.createElementVNode)('div',{class:'json-line',style:(0,y.normalizeStyle)({paddingLeft:14*e.level+'px'})},[(0,y.createElementVNode)('span',Gn,(0,y.toDisplayString)(e.isArray?']':'}'),1),(0,y.createCommentVNode)(' å®¹å™¨é—­åˆæ‹¬å· ')],4)])):(0,y.createCommentVNode)('v-if',!0)])],2112)}],['__scopeId','data-v-6c2ac46e']]),Yn={class:'json-root'},Un={class:'json-line'},Wn={class:'brace'},Jn={class:'json-children'},Kn={key:1,class:'json-line',style:{paddingLeft:'14px'}},Hn={class:'json-line'},Qn={class:'brace'},Zn=(0,y.defineComponent)({__name:'PrettyJsonViewer',props:{value:{},defaultCollapsed:{type:Boolean,default:!0},maxDepth:{default:3}},setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/template/PrettyJsonViewer'),t=e,a=(0,y.computed)(()=>{const e=t.value,a=null!==e&&'object'==typeof e;return n.debug('isPlainObjectOrArray',`è®¡ç®—ç»“æœ: ${a}ã€‚è¯¥å€¼${a?'æ˜¯':'ä¸æ˜¯'}æ™®é€šå¯¹è±¡æˆ–æ•°ç»„ã€‚`,{ä¼ å…¥å€¼:e}),a}),r=(0,y.computed)(()=>{const e=t.value;let a;if(null===e)a='null';else if(Array.isArray(e))a='array';else{const n=typeof e;a='undefined'===n?'undefined':n}return n.debug('primitiveType',`è®¡ç®—åŸå§‹å€¼ç±»å‹: ${a}`,{ä¼ å…¥å€¼:e}),a}),s=(0,y.computed)(()=>{const e=t.value;let a;switch(r.value){case'string':a=JSON.stringify(e);break;case'number':case'symbol':a=String(e);break;case'boolean':a=e?'true':'false';break;case'null':a='null';break;case'undefined':a='undefined';break;case'bigint':a=String(e)+'n';break;case'function':a='Æ’()';break;default:a=''}return n.debug('primitiveText',`æ ¼å¼åŒ–åŸå§‹å€¼æ–‡æœ¬: "${a}"`,{ä¼ å…¥å€¼:e,ç±»å‹:r.value}),a}),o=(0,y.computed)(()=>{const e=Array.isArray(t.value);return n.debug('isArrayRoot',`è®¡ç®—æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºæ•°ç»„: ${e}`,{ä¼ å…¥å€¼:t.value}),e}),i=(0,y.computed)(()=>o.value?'[':'{'),l=(0,y.computed)(()=>o.value?']':'}');return(n,t)=>((0,y.openBlock)(),(0,y.createElementBlock)('div',Yn,[(0,y.createElementVNode)('div',Un,[(0,y.createElementVNode)('span',Wn,(0,y.toDisplayString)(i.value),1),(0,y.createCommentVNode)(' æ ¹å¼€æ‹¬å·ï¼šå¯¹è±¡{ / æ•°ç»„[ ')]),(0,y.createElementVNode)('div',Jn,[a.value?((0,y.openBlock)(!0),(0,y.createElementBlock)(y.Fragment,{key:0},(0,y.renderList)(e.value,(n,t)=>((0,y.openBlock)(),(0,y.createBlock)(qn,{key:String(t),k:String(t),v:n,path:String(t),level:1,'default-collapsed':e.defaultCollapsed,'max-depth':e.maxDepth},null,8,['k','v','path','default-collapsed','max-depth']))),128)):((0,y.openBlock)(),(0,y.createElementBlock)('div',Kn,[t[0]||(t[0]=(0,y.createElementVNode)('span',{class:'key'},'value',-1)),t[1]||(t[1]=(0,y.createElementVNode)('span',{class:'colon'},':',-1)),(0,y.createElementVNode)('span',{class:(0,y.normalizeClass)(['val',r.value])},(0,y.toDisplayString)(s.value),3)]))]),(0,y.createElementVNode)('div',Hn,[(0,y.createElementVNode)('span',Qn,(0,y.toDisplayString)(l.value),1),(0,y.createCommentVNode)(' æ ¹é—­æ‹¬å·ï¼šå¯¹è±¡} / æ•°ç»„] ')])]))}});i(987);const Xn=(0,En.A)(Zn,[['__scopeId','data-v-6fc9ef75']]),et={class:'details-wrapper'},nt={class:'detail-block'},tt={class:'detail-block'},at=(0,y.defineComponent)({__name:'OperationDetails',props:{data:{}},setup:e=>(n,t)=>((0,y.openBlock)(),(0,y.createBlock)(kn,{title:'ERA æœ€æ–°æ“ä½œè¯¦æƒ…','default-open':!1},{default:(0,y.withCtx)(()=>[(0,y.createElementVNode)('div',et,[(0,y.createElementVNode)('div',nt,[t[0]||(t[0]=(0,y.createElementVNode)('h4',{class:'detail-title'},'SelectedMksï¼ˆæ•°ç»„ï¼‰',-1)),(0,y.createVNode)(Xn,{value:e.data.selectedMks,'default-collapsed':!0,'max-depth':3},null,8,['value'])]),(0,y.createElementVNode)('div',tt,[t[1]||(t[1]=(0,y.createElementVNode)('h4',{class:'detail-title'},'EditLogsï¼ˆå¯¹è±¡ï¼‰',-1)),(0,y.createVNode)(Xn,{value:e.data.editLogs,'default-collapsed':!0,'max-depth':2},null,8,['value'])])])]),_:1}))});i(924);const rt=(0,En.A)(at,[['__scopeId','data-v-6079192c']]),st={class:'tabs'},ot={class:'tab-bar',role:'tablist'},it=['onClick'],lt={class:'tab-content'},ct={key:0},dt={key:1},pt=(0,y.defineComponent)({__name:'TabSwitch',props:{tabs:{},active:{}},emits:['update:active'],setup(e,{emit:n}){const t=new j('ERAå˜é‡æ¡†æ¶/ui/template/TabSwitch'),a=e,r=n,s=(0,y.ref)(a.active??'pure');return(0,y.watch)(()=>a.active,e=>{e&&(t.debug('watch:active',`å¤–éƒ¨åŒæ­¥ active tab ä¸º: ${e}`),s.value=e)}),(0,y.onMounted)(()=>{}),(n,a)=>((0,y.openBlock)(),(0,y.createElementBlock)('section',st,[(0,y.createCommentVNode)(' é¡µç­¾è¡Œ '),(0,y.createElementVNode)('div',ot,[((0,y.openBlock)(!0),(0,y.createElementBlock)(y.Fragment,null,(0,y.renderList)(e.tabs,e=>((0,y.openBlock)(),(0,y.createElementBlock)('button',{key:e.key,class:(0,y.normalizeClass)(['tab-btn',{active:e.key===s.value}]),role:'tab',onClick:n=>{return a=e.key,t.debug('setActive',`ç”¨æˆ·ç‚¹å‡»ï¼Œåˆ‡æ¢ tab åˆ°: ${a}`),s.value=a,void r('update:active',a);var a}},(0,y.toDisplayString)(e.label),11,it))),128))]),(0,y.createCommentVNode)(' å†…å®¹åŒºï¼šæ ¹æ®æ´»åŠ¨é”®æ¸²æŸ“å¯¹åº”æ’æ§½ '),(0,y.createElementVNode)('div',lt,['pure'===s.value?((0,y.openBlock)(),(0,y.createElementBlock)('div',ct,[(0,y.renderSlot)(n.$slots,'pure'),(0,y.createCommentVNode)(' çº¯å‡€çŠ¶æ€æ•°æ®å†…å®¹ ')])):((0,y.openBlock)(),(0,y.createElementBlock)('div',dt,[(0,y.renderSlot)(n.$slots,'full'),(0,y.createCommentVNode)(' å®Œæ•´çŠ¶æ€æ•°æ®å†…å®¹ ')]))])]))}});i(317);const At=(0,En.A)(pt,[['__scopeId','data-v-2874077c']]),ut={id:'era-snapshot-ui',class:'snapshot-manager'},gt={class:'selector-wrapper'},Ct={class:'select-field',role:'group','aria-labelledby':'mk-label'},bt={class:'select-container'},mt=['value'],ft={class:'selector-wrapper'},ht={class:'select-field',role:'group','aria-labelledby':'mid-label'},vt={class:'id-query-container'},xt={key:0,class:'loading-indicator'},Bt={key:1,class:'error-message'},yt=(0,y.defineComponent)({__name:'SnapshotManager',props:{latestData:{}},setup(e){const n=e,t=new j('ERAå˜é‡æ¡†æ¶/ui/components/SnapshotManager'),a=(0,y.computed)(()=>n.latestData?.mk??null),r=(0,y.ref)(a.value),s=(0,y.ref)(null),o=(0,y.ref)(null),i=(0,y.ref)(!1),l=(0,y.ref)(null),c=[{key:'pure',label:'çº¯å‡€çŠ¶æ€æ•°æ®'},{key:'full',label:'å®Œæ•´çŠ¶æ€æ•°æ®'}],d=(0,y.ref)('pure'),p=(0,y.computed)(()=>n.latestData?.selectedMks?.slice().reverse()??[]),A=(0,y.computed)(()=>o.value?o.value:r.value===a.value?n.latestData:null),u=(0,y.computed)(()=>{if(!A.value)return!1;if('is_user'in A.value)return A.value.is_user;const e=getChatMessages(A.value.message_id,{include_swipes:!1})[0];return!!e&&ge(e)});(0,y.watch)(()=>a.value,e=>{r.value=e,o.value=null,s.value=null,l.value=null,i.value=!1},{immediate:!0});const g=()=>{const e=r.value;s.value=null,o.value=null,l.value=null,e&&e!==a.value?(i.value=!0,t.debug('SnapshotManager',`(MK Select) è¯·æ±‚å¿«ç…§, mk: ${e}`),eventEmit('era:getSnapshotAtMk',{mk:e})):i.value=!1},C=()=>{null===s.value||s.value<0?l.value='è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„ã€éè´Ÿçš„æ¶ˆæ¯ IDã€‚':(r.value=null,o.value=null,l.value=null,i.value=!0,t.debug('SnapshotManager',`(ID Query) è¯·æ±‚å¿«ç…§, message_id: ${s.value}`),eventEmit('era:getSnapshotAtMId',{message_id:s.value}))},b=e=>{i.value=!1;const n=(e,n)=>{e?(o.value=e,r.value=e.mk,l.value=null):(o.value=null,l.value=n)};'getSnapshotAtMk'===e.queryType&&e.request.mk===r.value?n(e.result,`æœªæ‰¾åˆ°ä¸ MK "${r.value}" ç›¸å…³çš„å¿«ç…§ã€‚`):'getSnapshotAtMId'===e.queryType&&e.request.message_id===s.value&&n(e.result,`æœªæ‰¾åˆ°ä¸æ¶ˆæ¯ ID "${s.value}" ç›¸å…³çš„å¿«ç…§ã€‚`)},m=(e,n)=>{const t=p.value.length-1-n,r=e===a.value;if(!e)return`æ¶ˆæ¯ ${t} (æ— MK)`;const s=`æ¶ˆæ¯ ${t} (...${e.substring(e.length-6)})`;return r?`${s} (æœ€æ–°)`:s};return(0,y.onMounted)(()=>{eventOn('era:queryResult',b)}),(0,y.onUnmounted)(()=>{eventRemoveListener('era:queryResult',b)}),(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,null,[(0,y.createCommentVNode)(' â˜… æ–°å¢å”¯ä¸€ idï¼šä¸æ”¹å˜ä»»ä½•é€»è¾‘ï¼Œä»…ç”¨äºé™åˆ¶æ ·å¼ä½œç”¨åŸŸ '),(0,y.createElementVNode)('div',ut,[(0,y.createElementVNode)('div',gt,[(0,y.createCommentVNode)(' å¤–å±‚å®¹å™¨ï¼šä¿ç•™ï¼Œæ”¹ä¸ºçºµå‘å¸ƒå±€æ›´åè°ƒ '),(0,y.createElementVNode)('div',Ct,[(0,y.createCommentVNode)(' å­—æ®µå®¹å™¨ï¼šç”¨äºæµ®åŠ¨æ ‡é¢˜ '),n[4]||(n[4]=(0,y.createElementVNode)('label',{id:'mk-label',for:'mk-selector',class:'field-label'},'æŒ‰æ¶ˆæ¯å¯†é’¥(MK)æŸ¥çœ‹',-1)),(0,y.createCommentVNode)(' æµ®åŠ¨å°æ ‡é¢˜ï¼šä¸å†å ç”¨æ°´å¹³ç©ºé—´ '),(0,y.createElementVNode)('div',bt,[(0,y.createCommentVNode)(' ä¸‹æ‹‰å®¹å™¨ï¼šä¿ç•™å³ä¾§ç®­å¤´ä¸é˜´å½±æ•ˆæœ '),(0,y.withDirectives)((0,y.createElementVNode)('select',{id:'mk-selector','onUpdate:modelValue':n[0]||(n[0]=e=>r.value=e),class:'mk-selector',onChange:g},[n[3]||(n[3]=(0,y.createElementVNode)('option',{value:null,disabled:''},'-- ä»åˆ—è¡¨ä¸­é€‰æ‹© --',-1)),((0,y.openBlock)(!0),(0,y.createElementBlock)(y.Fragment,null,(0,y.renderList)(p.value,(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)('option',{key:e||`null-${n}`,value:e},[(0,y.createTextVNode)((0,y.toDisplayString)(m(e,n))+' ',1),(0,y.createCommentVNode)(' é€‰é¡¹æ˜¾ç¤ºæ–‡æœ¬ ')],8,mt))),128))],544),[[y.vModelSelect,r.value]])])])]),(0,y.createElementVNode)('div',ft,[(0,y.createElementVNode)('div',ht,[n[5]||(n[5]=(0,y.createElementVNode)('label',{id:'mid-label',for:'mid-input',class:'field-label'},'æŒ‰æ¶ˆæ¯IDæŸ¥çœ‹',-1)),(0,y.createElementVNode)('div',vt,[(0,y.withDirectives)((0,y.createElementVNode)('input',{id:'mid-input','onUpdate:modelValue':n[1]||(n[1]=e=>s.value=e),type:'number',class:'mk-selector id-input',placeholder:'è¾“å…¥æ¶ˆæ¯ ID...',onKeyup:(0,y.withKeys)(C,['enter'])},null,544),[[y.vModelText,s.value,void 0,{number:!0}]]),(0,y.createElementVNode)('button',{class:'query-button',onClick:C},'æŸ¥æ‰¾')])])]),i.value?((0,y.openBlock)(),(0,y.createElementBlock)('div',xt,'æ­£åœ¨åŠ è½½å¿«ç…§...')):(0,y.createCommentVNode)('v-if',!0),l.value?((0,y.openBlock)(),(0,y.createElementBlock)('div',Bt,(0,y.toDisplayString)(l.value),1)):(0,y.createCommentVNode)('v-if',!0),A.value?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:2},[(0,y.createVNode)(kn,{title:'æ¶ˆæ¯å…ƒæ•°æ®','default-open':!0},{default:(0,y.withCtx)(()=>[(0,y.createVNode)(Tn,{mk:A.value.mk,'message-id':A.value.message_id,'is-user':u.value},null,8,['mk','message-id','is-user'])]),_:1}),(0,y.createVNode)(At,{active:d.value,'onUpdate:active':n[2]||(n[2]=e=>d.value=e),tabs:c},{pure:(0,y.withCtx)(()=>[(0,y.createVNode)(Xn,{value:A.value.statWithoutMeta,'default-collapsed':!0,'max-depth':1/0},null,8,['value'])]),full:(0,y.withCtx)(()=>[(0,y.createVNode)(Xn,{value:A.value.stat,'default-collapsed':!0,'max-depth':1/0},null,8,['value'])]),_:1},8,['active'])],64)):(0,y.createCommentVNode)('v-if',!0)])],2112))}});i(498);const wt=yt,Et={class:'era-panel'},kt={class:'panel-top'},_t={class:'panel-body'},St={class:'panel-content-wrapper'},Dt={key:1,class:'empty'},Mt=(0,y.defineComponent)({__name:'EraPanel',props:{data:{}},setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/components/EraPanel');return(t,a)=>((0,y.openBlock)(),(0,y.createElementBlock)('div',Et,[(0,y.createElementVNode)('header',kt,[a[1]||(a[1]=(0,y.createElementVNode)('h3',{class:'panel-title'},'ERA æ•°æ®é¢æ¿',-1)),(0,y.createElementVNode)('button',{class:'btn-close','aria-label':'å…³é—­',onClick:a[0]||(a[0]=e=>{return t='FloatingBall',n.debug('requestSwitchView',`è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${t}`),void(window.eraUiSwitchView?window.eraUiSwitchView(t):n.warn('requestSwitchView','å…¨å±€åˆ‡æ¢å‡½æ•° eraUiSwitchView æœªæ‰¾åˆ°'));var t})},'Ã—')]),(0,y.createElementVNode)('div',_t,[(0,y.createElementVNode)('div',St,[e.data?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:0},[(0,y.createVNode)(kn,{title:'æœ€æ–°æ¶ˆæ¯å…ƒæ•°æ®','default-open':!1},{default:(0,y.withCtx)(()=>[(0,y.createVNode)(Tn,{mk:e.data.mk,'message-id':e.data.message_id,'is-user':e.data.is_user},null,8,['mk','message-id','is-user'])]),_:1}),(0,y.createVNode)(rt,{data:e.data},null,8,['data']),(0,y.createVNode)(wt,{'latest-data':e.data},null,8,['latest-data'])],64)):((0,y.openBlock)(),(0,y.createElementBlock)('div',Dt,'ç­‰å¾… era:writeDone äº‹ä»¶æ•°æ®â€¦'))])])]))}});i(766);const Nt=(0,En.A)(Mt,[['__scopeId','data-v-1e3782f8']]),Vt=(0,y.defineComponent)({__name:'FloatingBall',emits:['click'],setup(e){new j('ERAå˜é‡æ¡†æ¶/ui/components/FloatingBall');return(0,y.onMounted)(()=>{}),(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)('div',{class:'floating-ball',onClick:n[0]||(n[0]=n=>e.$emit('click'))},[n[1]||(n[1]=(0,y.createElementVNode)('span',{class:'era-logo','aria-hidden':'true'},'ERA',-1)),(0,y.createCommentVNode)(' ä»…æ˜¾ç¤ºç”¨ï¼›ä¸æ‹¦æˆªäº‹ä»¶ ')]))}});i(90);const Rt=(0,En.A)(Vt,[['__scopeId','data-v-3bb5cc6c']]),It={class:'about-era-card',role:'complementary','aria-label':'å…³äº ERA'},Ft=(0,y.defineComponent)({__name:'AboutEra',setup:e=>(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)('section',It,[...n[0]||(n[0]=[(0,y.createStaticVNode)('<h4 class="card-title" data-v-9b1026a6>å…³äº ERA</h4><div class="info-list" data-v-9b1026a6><ul data-v-9b1026a6><li data-v-9b1026a6><strong data-v-9b1026a6>ERA é¡¹ç›®åœ°å€:</strong><a href="https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master" target="_blank" rel="noopener noreferrer" data-v-9b1026a6> GitHub </a></li><li data-v-9b1026a6><strong data-v-9b1026a6>ERA ä»‹ç»å¸–:</strong><a href="https://discord.com/channels/1134557553011998840/1423319849400270928" target="_blank" rel="noopener noreferrer" data-v-9b1026a6> Discord </a></li><li data-v-9b1026a6><strong data-v-9b1026a6>ä½œè€…:</strong> ä¸–ç•Œçš„å±±ç”°</li><li data-v-9b1026a6><strong data-v-9b1026a6>ERA æ¡†æ¶äº¤æµç¾¤:</strong> 1006127516</li></ul></div>',2)])]))});i(426);const Tt=(0,En.A)(Ft,[['__scopeId','data-v-9b1026a6']]),$t=toastr;var jt=i.n($t);const Ot=new j('ERAå˜é‡æ¡†æ¶/utils/regex');async function Pt(e){if(!isCharacterTavernRegexesEnabled()){const e='å±€éƒ¨æ­£åˆ™æœªå¯ç”¨ï¼Œè·³è¿‡æ³¨å…¥ã€‚';return Ot.debug('ensureCharacterRegex',e),{success:!1,status:'skipped',reason:e}}if(getTavernRegexes({scope:'character'}).some(n=>n.script_name===e.script_name))return Ot.debug('ensureCharacterRegex',`åä¸º "${e.script_name}" çš„æ­£åˆ™å·²å­˜åœ¨ï¼Œæ— éœ€æ³¨å…¥ã€‚`),{success:!0,status:'exists'};try{return Ot.debug('ensureCharacterRegex',`æœªæ‰¾åˆ°åä¸º "${e.script_name}" çš„æ­£åˆ™ï¼Œæ­£åœ¨æ³¨å…¥...`),await updateTavernRegexesWith(n=>(n.push({...e,id:'',scope:'character'}),n),{scope:'character'}),Ot.debug('ensureCharacterRegex','æ­£åˆ™æ³¨å…¥æˆåŠŸã€‚'),{success:!0,status:'injected'}}catch(n){const t=`æ³¨å…¥åä¸º "${e.script_name}" çš„æ­£åˆ™æ—¶å‘ç”Ÿé”™è¯¯ã€‚`;return Ot.error('ensureCharacterRegex',t,n),{success:!1,status:'failed',reason:t}}}const Lt={script_name:'ERA æ•°æ®éšè—æ­£åˆ™',enabled:!0,run_on_edit:!0,find_regex:String.raw`/<(variable(?:insert|edit|delete))>\s*(?=[\s\S]*?\S[\s\S]*?<\/\1>)((?:(?!<(?:era_data|variable(?:think|insert|edit|delete))>|<\/\1>)[\s\S])*?)\s*<\/\1>/gi`,replace_string:'',source:{user_input:!0,ai_output:!0,slash_command:!1,world_info:!1},destination:{display:!0,prompt:!0},min_depth:null,max_depth:null},Gt={script_name:'ERA å…ƒæ•°æ®éšè—æ­£åˆ™',enabled:!0,run_on_edit:!0,find_regex:String.raw`/<era_data>\s*(?=[\s\S]*?\S[\s\S]*?<\/era_data>)((?:(?!<(?:era_data|variable(?:think|insert|edit|delete))>|<\/era_data>)[\s\S])*?)\s*<\/era_data>/gi`,replace_string:'',source:{user_input:!0,ai_output:!0,slash_command:!1,world_info:!1},destination:{display:!0,prompt:!0},min_depth:null,max_depth:null},zt={script_name:'ERA æ€è€ƒå—éšè—æ­£åˆ™',enabled:!0,run_on_edit:!0,find_regex:String.raw`/<variablethink>\s*(?=[\s\S]*?\S[\s\S]*?<\/variablethink>)((?:(?!<variablethink>)[\s\S])*?)\s*<\/variablethink>/gi`,replace_string:'',source:{user_input:!0,ai_output:!0,slash_command:!1,world_info:!1},destination:{display:!0,prompt:!0},min_depth:null,max_depth:null};const qt={script_name:'ERA çŠ¶æ€æ æ¨¡æ¿',enabled:!0,run_on_edit:!0,find_regex:'/<StatusPlaceHolderImpl\\/>/gsi',replace_string:'```html\n<!doctype html>\n<html lang="zh-CN">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>ERA çŠ¶æ€æ æ¨¡æ¿</title>\n    <style>\n      body {\n        font-family:\n          -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, \'Helvetica Neue\', Arial, \'Noto Sans\', sans-serif,\n          \'Apple Color Emoji\', \'Segoe UI Emoji\', \'Segoe UI Symbol\', \'Noto Color Emoji\';\n        margin: 0;\n        padding: 0;\n        background-color: transparent;\n      }\n      .era-statusbar {\n        color: #e0e0e0;\n        background: linear-gradient(145deg, #2c3e50, #34495e);\n        border-radius: 12px;\n        padding: 16px;\n        margin-top: 20px;\n        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n        border: 1px solid #4a6278;\n        overflow: hidden;\n      }\n      .era-statusbar-header {\n        display: flex;\n        align-items: center;\n        border-bottom: 1px solid #4a6278;\n        padding-bottom: 10px;\n        margin-bottom: 12px;\n      }\n      .era-statusbar-header h4 {\n        margin: 0;\n        font-size: 1.1em;\n        font-weight: 700;\n        color: #1abc9c;\n        text-shadow: 0 0 5px rgba(26, 188, 156, 0.5);\n      }\n      .era-statusbar-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n        gap: 10px;\n      }\n      .era-statusbar-item {\n        background-color: rgba(255, 255, 255, 0.05);\n        padding: 8px 12px;\n        border-radius: 8px;\n      }\n      .era-statusbar-item-label {\n        font-size: 0.85em;\n        color: #bdc3c7;\n        margin-bottom: 4px;\n      }\n      .era-statusbar-item-value {\n        font-size: 1em;\n        font-weight: 700;\n        color: #ecf0f1;\n      }\n      .era-instructions {\n        margin-top: 16px;\n        padding-top: 12px;\n        border-top: 1px solid #4a6278;\n        font-size: 0.9em;\n        line-height: 1.6;\n      }\n      .era-instructions a {\n        color: #3498db;\n        text-decoration: none;\n      }\n      .era-instructions a:hover {\n        text-decoration: underline;\n      }\n      .era-instructions .ai-note {\n        font-size: 0.8em;\n        color: #7f8c8d;\n      }\n    </style>\n  </head>\n  <body>\n    <div class="era-statusbar">\n      <div class="era-statusbar-header">\n        <h4>è§’è‰²çŠ¶æ€</h4>\n      </div>\n      <div class="era-statusbar-grid">\n        <div class="era-statusbar-item">\n          <div class="era-statusbar-item-label">å§“å</div>\n          <div class="era-statusbar-item-value" id="player-name">--</div>\n        </div>\n        <div class="era-statusbar-item">\n          <div class="era-statusbar-item-label">ç­‰çº§</div>\n          <div class="era-statusbar-item-value" id="player-level">--</div>\n        </div>\n        <div class="era-statusbar-item">\n          <div class="era-statusbar-item-label">ç”Ÿå‘½å€¼</div>\n          <div class="era-statusbar-item-value" id="player-hp">-- / --</div>\n        </div>\n        <div class="era-statusbar-item">\n          <div class="era-statusbar-item-label">é­”åŠ›å€¼</div>\n          <div class="era-statusbar-item-value" id="player-mp">-- / --</div>\n        </div>\n      </div>\n\n      <div class="era-statusbar-header" style="margin-top: 16px">\n        <h4>é™„è¿‘NPC</h4>\n      </div>\n      <div id="npc-list" class="era-statusbar-grid">\n        <div class="era-statusbar-item-label" style="padding: 8px 12px">æš‚æ— NPCä¿¡æ¯</div>\n      </div>\n\n      \x3c!-- \n      AI ä½ å¥½ï¼å½“è§’è‰²å¡ä½œè€…è®©ä½ ä¿®æ”¹æ­¤æ–‡ä»¶æ—¶ï¼Œè¯·åœ¨ä¿®æ”¹ååˆ é™¤ä¸‹é¢çš„ "instructions-wrapper"æ•´ä¸ª div å…ƒç´ ã€‚\n    --\x3e\n      <div id="instructions-wrapper">\n        <div class="era-statusbar-header" style="margin-top: 16px">\n          <h4>ç»™è§’è‰²å¡ä½œè€…çš„è¯´æ˜</h4>\n        </div>\n        <div class="era-instructions">\n          <strong>ä½ æ¥ä¸‹æ¥éœ€è¦åšçš„ï¼š</strong><br />\n          1. è‡ªå·±è®¾è®¡è§’è‰²å¡ç”¨åˆ°çš„å˜é‡ç»“æ„ï¼Œå¹¶ä½¿ç”¨ &amp;lt;VariableInsert&amp;gt æ ‡ç­¾å†™å…¥è§’è‰²çš„å¼€åœºç™½ã€‚<br />\n          2. åœ¨è§’è‰²ä¸»ä¸–ç•Œä¹¦çš„â€˜ERAå˜é‡æ„å›¾è¯´æ˜â€™æ¡ç›®ä¸­ï¼Œæ·»åŠ å‘ AI è¯´æ˜å„ä¸ªå˜é‡æ„å›¾çš„æç¤ºè¯ã€‚<br />\n          3. ä¿®æ”¹æœ¬çŠ¶æ€æ çš„ HTML ä»£ç ï¼Œä½¿å…¶ä¸**ä½ è®¾è®¡çš„å˜é‡ç³»ç»ŸåŒ¹é…**ã€‚<br />\n          <br />\n          å®Œæˆç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥è¯·å‚è€ƒï¼š<br />\n          <a\n            href="https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/blob/master/doc/%E4%BD%A0%E6%9C%80%E5%A5%BD%E8%87%AA%E5%B7%B1%E7%9C%8B%E4%B8%80%E9%81%8D%E7%9A%84era%E5%8D%A1%E5%AE%8C%E6%95%B4%E5%88%B6%E4%BD%9C%E6%96%87%E6%A1%A3%EF%BC%88%E5%8C%85%E5%90%AB%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E4%B8%96%E7%95%8C%E4%B9%A6%E6%8F%90%E7%A4%BA%E8%AF%8D%EF%BC%89/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E5%92%8C%E8%AF%B4%E6%98%8E%E4%BD%A0%E7%9A%84%E5%8F%98%E9%87%8F%E7%B3%BB%E7%BB%9F.md"\n            target="_blank"\n            rel="noopener noreferrer"\n            >å¦‚ä½•è®¾è®¡å’Œè¯´æ˜ä½ çš„å˜é‡ç³»ç»Ÿ</a\n          >\n          <br /><br />\n          æ¨èä½ è¿›å…¥â€˜ERA çŠ¶æ€æ æ¨¡æ¿â€™æ­£åˆ™ä¸­ï¼Œå°†â€˜æ›¿æ¢ä¸ºâ€™çš„å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰æ¨¡æ¿çŠ¶æ€æ çš„htmlä»£ç ï¼‰å…¨éƒ¨å¤åˆ¶å‘é€ç»™ AI (å¦‚\n          Cline, ChatGPT, Claudeç­‰)ï¼Œè®©å®ƒå¸®ä½ å®Œæˆç¬¬ 3 æ­¥ã€‚ä¸ºäº†è®© AI\n          æ›´å¥½åœ°ç†è§£å¦‚ä½•ä¿®æ”¹ï¼Œè¯·åŒæ—¶å°†ä»¥ä¸‹é“¾æ¥ä¸­çš„æ–‡æ¡£å†…å®¹ä¸€å¹¶æä¾›ç»™å®ƒï¼š<br />\n          <a\n            href="https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master/doc/%E9%80%82%E5%90%88%E6%8F%90%E4%BE%9B%E7%BB%99ai%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%8Fhtml%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3%EF%BC%88%E5%8F%AA%E5%8C%85%E5%90%ABhtml%E7%8A%B6%E6%80%81%E6%A0%8F%E4%BB%A3%E7%A0%81%E4%B9%A6%E5%86%99%E9%83%A8%E5%88%86%EF%BC%89"\n            target="_blank"\n            rel="noopener noreferrer"\n            >ERA çŠ¶æ€æ å¼€å‘æ–‡æ¡£</a\n          >\n          <br /><br />\n          <strong>å…³äº ERA æ¡†æ¶:</strong><br />\n          ä½œè€…: ä¸–ç•Œçš„å±±ç”°<br />\n          ERA æ¡†æ¶äº¤æµç¾¤: 1006127516<br />\n          <a\n            href="https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master"\n            target="_blank"\n            rel="noopener noreferrer"\n            >ERA é¡¹ç›®åœ°å€</a\n          >\n          |\n          <a\n            href="https://discord.com/channels/1134557553011998840/1423319849400270928"\n            target="_blank"\n            rel="noopener noreferrer"\n            >Discord å‘å¸ƒå¸–</a\n          >\n        </div>\n      </div>\n    </div>\n\n    <script>\n      document.addEventListener(\'DOMContentLoaded\', () => {\n        const playerName = document.getElementById(\'player-name\');\n        const playerLevel = document.getElementById(\'player-level\');\n        const playerHp = document.getElementById(\'player-hp\');\n        const playerMp = document.getElementById(\'player-mp\');\n        const npcListContainer = document.getElementById(\'npc-list\');\n        let isInitialLoad = true;\n\n        function updateUI(stat) {\n          // æ›´æ–°ç©å®¶ä¿¡æ¯\n          const pName = _.get(stat, \'player.name\');\n          if (pName !== undefined) playerName.textContent = pName;\n          else if (isInitialLoad) playerName.textContent = \'ç¤ºä¾‹æ•°æ®, å®Œæˆæ­¥éª¤1åæ˜¾ç¤º\';\n\n          const pLevel = _.get(stat, \'player.level\');\n          if (pLevel !== undefined) playerLevel.textContent = pLevel;\n          else if (isInitialLoad) playerLevel.textContent = \'ç¤ºä¾‹æ•°æ®, å®Œæˆæ­¥éª¤1åæ˜¾ç¤º\';\n\n          const pHp = _.get(stat, \'player.hp\');\n          const pMaxHp = _.get(stat, \'player.max_hp\');\n          if (pHp !== undefined && pMaxHp !== undefined) playerHp.textContent = `${pHp} / ${pMaxHp}`;\n          else if (isInitialLoad) playerHp.textContent = \'ç¤ºä¾‹æ•°æ®, å®Œæˆæ­¥éª¤1åæ˜¾ç¤º\';\n\n          const pMp = _.get(stat, \'player.mp\');\n          const pMaxMp = _.get(stat, \'player.max_mp\');\n          if (pMp !== undefined && pMaxMp !== undefined) playerMp.textContent = `${pMp} / ${pMaxMp}`;\n          else if (isInitialLoad) playerMp.textContent = \'ç¤ºä¾‹æ•°æ®, å®Œæˆæ­¥éª¤1åæ˜¾ç¤º\';\n\n          // æ›´æ–°NPCåˆ—è¡¨\n          const npcs = _.get(stat, \'world_state.npcs\', {});\n          npcListContainer.innerHTML = \'\'; // æ¸…ç©ºæ—§åˆ—è¡¨\n          if (_.isEmpty(npcs)) {\n            if (isInitialLoad)\n              npcListContainer.innerHTML =\n                \'<div class="era-statusbar-item-label" style="padding: 8px 12px;">ç¤ºä¾‹æ•°æ®, å®Œæˆæ­¥éª¤1åæ˜¾ç¤º</div>\';\n            else\n              npcListContainer.innerHTML =\n                \'<div class="era-statusbar-item-label" style="padding: 8px 12px;">æš‚æ— NPCä¿¡æ¯</div>\';\n          } else {\n            for (const npcId in npcs) {\n              const npc = npcs[npcId];\n              const npcElement = document.createElement(\'div\');\n              npcElement.className = \'era-statusbar-item\';\n              npcElement.innerHTML = `\n                    <div class="era-statusbar-item-label">${npc.name || \'æœªçŸ¥NPC\'}</div>\n                    <div class="era-statusbar-item-value">å¿ƒæƒ…: ${npc.mood || \'å¹³å¸¸\'}</div>\n                `;\n              npcListContainer.appendChild(npcElement);\n            }\n          }\n\n          isInitialLoad = false;\n        }\n\n        eventOn(\'era:writeDone\', detail => {\n          if (detail && detail.statWithoutMeta) {\n            updateUI(detail.statWithoutMeta);\n          }\n        });\n\n        eventEmit(\'era:getCurrentVars\');\n      });\n    <\/script>\n\n    \x3c!-- \n    ================================================================\n    ç»™ AI çš„å‚è€ƒä»£ç  (é»˜è®¤æ³¨é‡Š)\n    \n    AI ä½ å¥½ï¼å½“è§’è‰²å¡ä½œè€…è®©ä½ ä¿®æ”¹æ­¤æ–‡ä»¶æ—¶ï¼Œè¯·å‚è€ƒä¸‹é¢çš„æ³¨é‡Šä»£ç ã€‚\n    \n    ### å®æ¨¡å¼ (ç®€å•)\n    - **ç”¨æ³•**: ç›´æ¥åœ¨ HTML ä¸­å†™å…¥ `{{ERA:è·¯å¾„.åˆ°.å˜é‡}}` å®ã€‚\n    - **ä¼˜ç‚¹**: éå¸¸ç®€å•ï¼Œæ— éœ€ç¼–å†™ä»»ä½• JavaScriptã€‚\n    - **ç¼ºç‚¹**: éœ€è¦åœ¨ ERA è®¾ç½®ä¸­å¼€å¯â€œå¼ºåˆ¶é‡è½½çŠ¶æ€æ â€ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°éƒ½ä¼šå¯¼è‡´æ•´ä¸ªçŠ¶æ€æ é—ªçƒåˆ·æ–°ã€‚\n    - **ç¤ºä¾‹**: `<div class="era-statusbar-item-value">{{ERA:player.hp}} / {{ERA:player.max_hp}}</div>`\n\n    ---\n\n    ### API æ¨¡å¼ (è¿›é˜¶ï¼Œæ¨è)\n    - **ç”¨æ³•**: ä½¿ç”¨ JavaScript ç›‘å¬å’Œå‘é€ ERA æ¡†æ¶çš„äº‹ä»¶ï¼Œæ¥åŠ¨æ€åœ°è¯»å†™å˜é‡ã€‚\n    - **ä¼˜ç‚¹**: æ›´æ–°å¹³æ»‘æ— é—ªçƒï¼Œæ€§èƒ½æ›´å¥½ï¼Œå¯ä»¥å®ç°å¤æ‚çš„å‰ç«¯äº¤äº’ã€‚\n\n    #### æ ¸å¿ƒäº‹ä»¶ä¸æ•°æ®ç»“æ„\n    \n    **1. `era:writeDone` äº‹ä»¶**: è¿™æ˜¯å“åº”æ•°æ®å˜åŒ–çš„**å”¯ä¸€æ¨èæ–¹å¼**ã€‚å½“ä»»ä½•å˜é‡å‘ç”Ÿæ”¹å˜åï¼ŒERA éƒ½ä¼šå¹¿æ’­æ­¤äº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªåŒ…å«è¯¦ç»†ä¿¡æ¯çš„ `detail` å¯¹è±¡ã€‚\n    \n    **`writeDone` äº‹ä»¶çš„ `detail` å¯¹è±¡ (`WriteDonePayload`) ç»“æ„å¦‚ä¸‹:**\n    ```typescript\n    {\n      mk: string; // æœ¬æ¬¡æ›´æ–°çš„æ¶ˆæ¯å¯†é’¥\n      message_id: number; // æœ¬æ¬¡æ›´æ–°çš„æ¶ˆæ¯ ID\n      actions: {\n        rollback: boolean; // æ˜¯å¦æ‰§è¡Œäº†å›æ»š\n        apply: boolean;    // æ˜¯å¦åº”ç”¨äº†æ¥è‡ªAIè¾“å‡ºçš„å˜é‡å˜æ›´\n        resync: boolean;   // æ˜¯å¦å› å†å²è®°å½•å˜åŒ–è€Œæ‰§è¡Œäº†å†åŒæ­¥\n        api: boolean;      // æ˜¯å¦ç”±APIç›´æ¥è°ƒç”¨è§¦å‘\n        apiWrite: boolean; // æ˜¯å¦ç”±APIå†™å…¥æ“ä½œ(å¦‚update/insert)è§¦å‘\n      };\n      selectedMks: (string | null)[]; // å½“å‰èŠå¤©çš„ä¸»å¹²æ¶ˆæ¯å¯†é’¥é“¾\n      editLogs: { [key: string]: any[] }; // å®Œæ•´çš„ç¼–è¾‘æ—¥å¿—\n      stat: any; // åŒ…å« $meta å­—æ®µçš„å®Œæ•´å˜é‡çŠ¶æ€\n      statWithoutMeta: any; // ä¸å« $meta çš„çº¯å‡€å˜é‡çŠ¶æ€ (æ¨èä½¿ç”¨)\n      consecutiveProcessingCount: number; // å¯¹å½“å‰æ¶ˆæ¯çš„è¿ç»­å¤„ç†æ¬¡æ•°\n    }\n    ```\n\n    **2. æ ¸å¿ƒè¯»å–äº‹ä»¶**:\n    - **`eventOn(\'era:writeDone\', callback)`**: ç›‘å¬å˜é‡å†™å…¥å®Œæˆã€‚\n      `eventOn(\'era:writeDone\', (detail) => { console.log(detail.statWithoutMeta); });`\n    - **`eventEmit(\'era:getCurrentVars\')`**: ä¸»åŠ¨è¯·æ±‚ä¸€æ¬¡æœ€æ–°å˜é‡ï¼ŒERA ä¼šä»¥ä¸€ä¸ª `era:writeDone` äº‹ä»¶æ¥å“åº”ã€‚\n\n    **3. æ ¸å¿ƒå†™å…¥äº‹ä»¶ (é€šè¿‡ `eventEmit` å‘é€)**:\n    - **æ³¨æ„**: æ‰€æœ‰å†™å…¥äº‹ä»¶æœ€ç»ˆéƒ½ä¼šè§¦å‘ä¸€æ¬¡ `era:writeDone`ã€‚ä¸ºé¿å…æ— é™å¾ªç¯ï¼ˆä¾‹å¦‚ï¼šAPIå†™å…¥ -> `writeDone` -> APIå†™å…¥ï¼‰ï¼Œä½ å¯ä»¥åœ¨ `writeDone` çš„ç›‘å¬å™¨ä¸­æ£€æŸ¥ `detail.actions.apiWrite` å­—æ®µã€‚\n      `eventOn(\'era:writeDone\', (detail) => { if (detail.actions.apiWrite) return; /* é¿å…å“åº”ç”±APIè‡ªèº«è§¦å‘çš„æ›´æ–° */ });`\n    \n    - **`era:insertByObject`**: éç ´åæ€§åœ°æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡ã€‚\n      `eventEmit(\'era:insertByObject\', { player: { score: 0 } });`\n    - **`era:updateByObject`**: ä¿®æ”¹ä¸€ä¸ªæˆ–å¤šä¸ªå·²å­˜åœ¨çš„å˜é‡ã€‚\n      `eventEmit(\'era:updateByObject\', { player: { level: 2 } });`\n    - **`era:insertByPath`**: åœ¨æŒ‡å®šè·¯å¾„æ’å…¥ä¸€ä¸ªæ–°å˜é‡ã€‚\n      `eventEmit(\'era:insertByPath\', { path: \'inventory.item_002\', value: { name: \'æ–°ç‰©å“\' } });`\n    - **`era:updateByPath`**: ä¿®æ”¹æŒ‡å®šè·¯å¾„çš„å˜é‡ï¼Œæ”¯æŒæ•°å­¦è¿ç®—ã€‚\n      `eventEmit(\'era:updateByPath\', { path: \'player.hp\', value: \'-=10\' });`\n    - **`era:deleteByPath`**: åˆ é™¤æŒ‡å®šè·¯å¾„çš„å˜é‡ã€‚\n      `eventEmit(\'era:deleteByPath\', { path: \'inventory.item_001\' });`\n    ================================================================\n  --\x3e</body>\n</html>\n\n```',source:{user_input:!1,ai_output:!0,slash_command:!1,world_info:!1},destination:{display:!0,prompt:!1},min_depth:null,max_depth:null},Yt=new j('ERAå˜é‡æ¡†æ¶/initer/manual/regex');const Ut=new j('ERAå˜é‡æ¡†æ¶/utils/worldbook');async function Wt(e,n){const t='injectEntryToWorldbook';if(!n.name){const e='æ³¨å…¥å¤±è´¥ï¼šæ–°æ¡ç›®å¿…é¡»åŒ…å« name å­—æ®µã€‚';return Ut.error(t,e),{success:!1,status:'failed',reason:e}}const a=await async function(e,n){const t='isEntryInWorldbook';try{Ut.debug(t,`æ­£åœ¨æ£€æŸ¥ä¸–ç•Œä¹¦ã€Œ${e}ã€ä¸­æ˜¯å¦å­˜åœ¨æ¡ç›®ã€Œ${n}ã€...`);const a=(await getWorldbook(e)).some(e=>e.name===n);return Ut.debug(t,`æ£€æŸ¥å®Œæˆï¼Œä¸–ç•Œä¹¦ã€Œ${e}ã€ä¸­${a?'å­˜åœ¨':'ä¸å­˜åœ¨'}æ¡ç›®ã€Œ${n}ã€ã€‚`),a}catch(n){return Ut.error(t,`è·å–ä¸–ç•Œä¹¦ã€Œ${e}ã€æ—¶å‘ç”Ÿé”™è¯¯ã€‚`,n),!1}}(e,n.name);if(a)return Ut.debug(t,`æ¡ç›®ã€Œ${n.name}ã€å·²å­˜åœ¨äºä¸–ç•Œä¹¦ã€Œ${e}ã€ä¸­ï¼Œæ— éœ€æ³¨å…¥ã€‚`),{success:!0,status:'exists'};try{return Ut.debug(t,`æ­£åœ¨å‘ä¸–ç•Œä¹¦ã€Œ${e}ã€æ³¨å…¥æ–°æ¡ç›®ã€Œ${n.name}ã€...`),await createWorldbookEntries(e,[n]),Ut.debug(t,`æˆåŠŸå‘ä¸–ç•Œä¹¦ã€Œ${e}ã€æ³¨å…¥æ–°æ¡ç›®ã€Œ${n.name}ã€ã€‚`),{success:!0,status:'injected'}}catch(a){const r=`å‘ä¸–ç•Œä¹¦ã€Œ${e}ã€æ³¨å…¥æ¡ç›®ã€Œ${n.name}ã€æ—¶å‘ç”Ÿé”™è¯¯ã€‚`;return Ut.error(t,r,a),{success:!1,status:'failed',reason:r}}}const Jt={name:'ERA å˜é‡æ“ä½œè§„åˆ™',content:'<variable_rule>\n# ERA å˜é‡æ“ä½œè§„åˆ™\n\n- **æ— å˜åŒ–åˆ™ä¸æ“ä½œ**: å½“å˜é‡ä¿¡æ¯ä¸æ•…äº‹å‘å±•ç›¸æ¯”æ²¡æœ‰å˜åŒ–æ—¶ï¼Œç¦æ­¢ç”Ÿæˆä»»ä½•æŒ‡ä»¤å—ã€‚\n- **æ–°å¢åˆ™ `Insert`**: å½“å‡ºç°å…¨æ–°çš„è§’è‰²ã€ç‰©å“ã€çŠ¶æ€æˆ–ä¿¡æ¯æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `<VariableInsert>`ã€‚\n- **ä¿®æ”¹åˆ™ `Update`**: å½“å·²æœ‰çš„æ•°æ®éœ€è¦æ›´æ–°å…¶å€¼æ—¶ï¼ˆå¦‚ç­‰çº§æå‡ã€çŠ¶æ€æ”¹å˜ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ `<VariableEdit>`ã€‚\n- **ç§»é™¤åˆ™ `Delete`**: å½“æ•°æ®è¢«æ˜ç¡®åœ°æ¶ˆè€—ã€ç§»é™¤æˆ–é”€æ¯æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `<VariableDelete>`ã€‚\n\n## æŒ‡ä»¤æ ¸å¿ƒè§„åˆ™\n- **`<VariableInsert>`**:\n    - **åªå¢ä¸æ”¹**: ç”¨äºæ·»åŠ æ–°æ•°æ®ï¼Œå®ƒç»ä¸ä¼šè¦†ç›–ä»»ä½•å·²ç»å­˜åœ¨çš„æ•°æ®ã€‚\n- **`<VariableEdit>`**:\n    - **åªæ”¹ä¸å¢**: ç”¨äºä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®ï¼Œå®ƒç»ä¸ä¼šåœ¨ä¸å­˜åœ¨çš„è·¯å¾„ä¸Šåˆ›å»ºæ–°æ•°æ®ã€‚\n- **`<VariableDelete>`**:\n    - **åˆ é™¤èŠ‚ç‚¹**: åœ¨æŒ‡ä»¤ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ª **ç©ºå¯¹è±¡ `{}`** ä½œä¸ºå€¼ï¼Œè¡¨ç¤ºè¦åˆ é™¤è¯¥é”®å¯¹åº”çš„æ•´ä¸ªèŠ‚ç‚¹ã€‚\n\n</variable_rule>\n\n<format_request>\nä½ å¿…é¡»æ ¹æ®æœ‰å…³è¦æ±‚åŠå˜é‡ç°æœ‰çŠ¶æ€ï¼Œè¡¥å®Œ `<VariableThink>` åŠ `<VariableInsert>`ã€`<VariableEdit>`ã€`<VariableDelete>` ç­‰æŒ‡ä»¤å—ã€‚\n\n**ä¸¥æ ¼éµå®ˆä»¥ä¸‹æµç¨‹**:\n\n1.  **è¾“å‡ºæ­£æ–‡**:\n    -   é¦–å…ˆï¼Œç”Ÿæˆæœ¬æ¬¡å›å¤çš„æ­£æ–‡å†…å®¹ã€‚\n\n2.  **è¾“å‡ºæ€è€ƒä¸æŒ‡ä»¤**:\n    -   åœ¨æ­£æ–‡å†…å®¹ä¹‹åï¼Œå¿…é¡»ç«‹å³è¾“å‡º `<VariableThink>` å—ï¼Œå¹¶åœ¨å…¶ä¸­è¿›è¡Œæ€è€ƒã€‚\n    -   åœ¨ `<VariableThink>` å—ä¹‹åï¼Œå¿…é¡»ç«‹å³è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤å— (`<VariableInsert>`ã€`<VariableEdit>`ã€`<VariableDelete>`)ã€‚\n\n3.  **æ ¼å¼è¦æ±‚**:\n    -   æ‰€æœ‰æŒ‡ä»¤å—çš„å†…å®¹éƒ½å¿…é¡»æ˜¯ **ä¸¥æ ¼åˆæ³•** çš„ JSON æ ¼å¼ã€‚\n    -   æ‰€æœ‰ JSON çš„é”®ï¼ˆkeyï¼‰éƒ½å¿…é¡»ä½¿ç”¨åŒå¼•å· `"`ã€‚\n    -   ä¸¥æ ¼éµå¾ª `<variable_rule>` ä¸­å®šä¹‰çš„æ‰€æœ‰è§„åˆ™ã€‚\n\n# ** å›å¤å†…å®¹å¿…é¡»ä»¿ç…§æ ¼å¼ç¤ºä¾‹ï¼Œä»¥è¯¥æ ¼å¼å›å¤ï¼›å¿…é¡»åŒ…å«æ„å›¾åˆ†æã€å˜é‡å˜æ›´åˆ†æå’Œæ“ä½œè®¡åˆ’ï¼Œä»¥åŠæ“ä½œè®¡åˆ’è®¡åˆ’ç”Ÿæˆçš„å®Œæ•´`<VariableInsert>`æˆ–`<VariableEdit>`çš„æ ‡ç­¾ä»£ç å—æ¥å®ç°å¯¹ERAå˜é‡çš„ç»´æŠ¤ **\n\nå³ï¼Œå¿…é¡»ä¿è¯æœ€ç»ˆè¾“å‡ºæ ¼å¼ä¸ºï¼š\n  {å…¶ä»–å†…å®¹ï¼ˆå¦‚æ­£æ–‡ï¼‰å’Œæ ¼å¼}\n\n  <VariableThink>\n    1.  **æ„å›¾åˆ†æ**: {å˜é‡æ›´æ–°æ„å›¾}\n    2.  **æ“ä½œè®¡åˆ’**:\n      - {æ“ä½œæ„å›¾}\n  </VariableThink>\n  <VariableInsert>\n  {Insertçš„JSONæ ¼å¼å˜é‡,ä¸¥æ ¼éµå®ˆå˜é‡è·¯å¾„}\n  </VariableInsert>\n  <VariableEdit>\n  {Editçš„JSONæ ¼å¼å˜é‡,ä¸¥æ ¼éµå®ˆå˜é‡è·¯å¾„}\n  </VariableEdit>\n\n### æ ¼å¼ç¤ºä¾‹\n  {å…¶ä»–å†…å®¹ï¼ˆå¦‚æ­£æ–‡ï¼‰å’Œæ ¼å¼...}\n\n  <VariableThink>\n  1.  **æ„å›¾åˆ†æ**: æ•…äº‹ä¸­å‡ºç°äº†ä¸€ä¸ªæ–°è§’è‰² "Elara"ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ° `characters` å¯¹è±¡ä¸­ã€‚åŒæ—¶ï¼Œä¸»è§’ "player" çš„ `hp` ä» 15 å‡å°‘åˆ°äº† 10ã€‚\n  2.  **æ“ä½œè®¡åˆ’**:\n      -   ç”Ÿæˆä¸€ä¸ª `<VariableInsert>` å—æ¥æ·»åŠ æ–°è§’è‰² "Elara"ã€‚\n      -   ç”Ÿæˆä¸€ä¸ª `<VariableEdit>` å—æ¥æ›´æ–° "player" çš„ `hp`ã€‚\n  </VariableThink>\n  <VariableInsert>\n  {\n    "characters": {\n      "Elara": {\n        "class": "Archer"\n      }\n    }\n  }\n  </VariableInsert>\n  <VariableEdit>\n  {\n    "characters": {\n      "player": {\n        "hp": 10\n      }\n    }\n  }\n  </VariableEdit>\n</format_request>\n',enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:9999},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}},Kt={name:'ERA å˜é‡æ„å›¾è¯´æ˜',content:'{{//è¯·åœ¨è¿™é‡Œè¡¥å……å¯¹ä½ è®¾è®¡çš„å˜é‡ç³»ç»Ÿçš„è¯´æ˜ï¼Œä»¥ä¾¿aiç†è§£ä½ çš„æ„å›¾å¹¶æ­£ç¡®çš„æ›´æ–°å˜é‡}}\n',enabled:!0,strategy:{type:'constant',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'at_depth',role:'system',depth:0,order:9998},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}},Ht=new j('ERAå˜é‡æ¡†æ¶/initer/manual/worldbook');async function Qt(){const e='initEraWorldbookEntries';Ht.log(e,'å¼€å§‹ä¸–ç•Œä¹¦åˆå§‹åŒ–...');let n=(await getCharWorldbookNames('current')).primary;if(n)Ht.debug(e,`æ‰¾åˆ°ä¸»ä¸–ç•Œä¹¦: ã€Œ${n}ã€`);else{Ht.warn(e,'å½“å‰è§’è‰²å¡æœªç»‘å®šä¸»ä¸–ç•Œä¹¦ï¼Œå°†åˆ›å»ºå¹¶ç»‘å®šä¸€ä¸ªæ–°çš„ä¸–ç•Œä¹¦ã€‚');try{n=await async function(){const e='createAndBindPrimaryWorldbook',n='ERAå¡ç¤ºä¾‹ä¸–ç•Œä¹¦';Ut.debug(e,`æ­£åœ¨åˆ›å»ºæ–°çš„ä¸–ç•Œä¹¦ã€Œ${n}ã€...`),await createWorldbook(n);const t=await getCharWorldbookNames('current');return t.primary=n,Ut.debug(e,`æ­£åœ¨å°†æ–°ä¸–ç•Œä¹¦ã€Œ${n}ã€ç»‘å®šä¸ºå½“å‰è§’è‰²å¡çš„ä¸»ä¸–ç•Œä¹¦...`),await rebindCharWorldbooks('current',t),Ut.debug(e,'åˆ›å»ºå¹¶ç»‘å®šæˆåŠŸã€‚'),n}()}catch(n){const t='åˆ›å»ºå¹¶ç»‘å®šä¸»ä¸–ç•Œä¹¦å¤±è´¥ã€‚';return Ht.error(e,t,n),{success:!1,reason:t,details:[]}}}const t=[Jt,Kt],a=[];let r=!0;for(const s of t){if(!s.name){Ht.warn(e,'å‘ç°ä¸€ä¸ªæ²¡æœ‰åç§°çš„ä¸–ç•Œä¹¦æ¡ç›®ï¼Œå·²è·³è¿‡ã€‚',s);continue}const t=await Wt(n,s);a.push({entryName:s.name,status:t.status,reason:t.reason}),t.success||(r=!1)}return Ht.log(e,'ä¸–ç•Œä¹¦åˆå§‹åŒ–å®Œæˆã€‚'),{success:r,details:a}}const Zt={class:'action-buttons-card',role:'complementary','aria-label':'ERA å¿«æ·æ“ä½œ'},Xt={class:'btns'},ea={class:'btn-group'},na={class:'btn-group'},ta={class:'btn-group'},aa=(0,y.defineComponent)({__name:'ActionButtons',setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/components/RightRailContent/ActionButtons');async function t(){n.log('onInjectRegex','ç‚¹å‡»â€œERA å¿«é€Ÿåˆå§‹åŒ–â€ï¼Œå¼€å§‹æ³¨å…¥...');try{try{const e=getChatMessages(0);if(!e||0===e.length)throw new Error('No messages found')}catch(e){return jt().error('ç„¶åå†æ¬¡ç‚¹å‡»å¿«é€Ÿåˆå§‹åŒ–','è¯·åœ¨è§’è‰²å¡çš„å¼€åœºç™½ä¸­æ·»åŠ ä»»æ„å†…å®¹ã€‚'),void n.warn('onInjectRegex','è·å–ç¬¬ 0 æ¡æ¶ˆæ¯å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºèŠå¤©è®°å½•ä¸ºç©ºã€‚',e)}const e=await async function(){if(!isCharacterTavernRegexesEnabled()){const e='å½“å‰è§’è‰²å¡æœªå¼€å¯å±€éƒ¨æ­£åˆ™ï¼Œè¯·å…ˆåœ¨è§’è‰²å¡è®¾ç½®ä¸­å¯ç”¨ã€‚';return Yt.warn('initEraCharacterRegexes',e),{success:!1,reason:e,details:[]}}const e=[Lt,qt,Gt,zt],n=[];let t=!0;for(const a of e){const e=await Pt(a);n.push({regexName:a.script_name,status:e.status,reason:e.reason}),e.success||(t=!1)}return{success:t,details:n}}();if(!e.success)return jt().error(e.reason??'æœªçŸ¥é”™è¯¯','æ­£åˆ™åˆå§‹åŒ–å¤±è´¥'),void n.error('onInjectRegex','æ­£åˆ™æ³¨å…¥å¤±è´¥:',e.reason);{const n=e.details.filter(e=>'injected'===e.status).length,t=e.details.filter(e=>'exists'===e.status).length;let a='';n>0&&(a+=`æˆåŠŸæ³¨å…¥ ${n} ä¸ªæ–°æ­£åˆ™ã€‚`),t>0&&(a+=` ${t} ä¸ªæ­£åˆ™å·²å­˜åœ¨ã€‚`),a&&jt().success(a.trim(),'æ­£åˆ™åˆå§‹åŒ–å®Œæˆ')}const t=await Qt();if(t.success){const e=t.details.filter(e=>'injected'===e.status).length,n=t.details.filter(e=>'exists'===e.status).length;let a='';e>0&&(a+=`æˆåŠŸæ³¨å…¥ ${e} ä¸ªæ–°æ¡ç›®ã€‚`),n>0&&(a+=` ${n} ä¸ªæ¡ç›®å·²å­˜åœ¨ã€‚`),jt().success(a.trim(),'ä¸–ç•Œä¹¦åˆå§‹åŒ–å®Œæˆ')}else jt().error(t.reason??'ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ç•Œä¹¦æ¡ç›®æ³¨å…¥å¤±è´¥ã€‚','ä¸–ç•Œä¹¦åˆå§‹åŒ–å¤±è´¥'),n.error('onInjectRegex','ä¸–ç•Œä¹¦æ³¨å…¥å¤±è´¥:',t);n.log('onInjectRegex','åˆå§‹åŒ–æµç¨‹å®Œæˆã€‚')}catch(e){n.error('onInjectRegex','æ‰§è¡Œåˆå§‹åŒ–æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯:',e),jt().error('å‘ç”Ÿæ„å¤–é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚','åˆå§‹åŒ–å¤±è´¥')}}function a(){n.log('onFullSync','ç‚¹å‡»â€œå®Œå…¨é‡ç®—å˜é‡â€ï¼Œå‘é€ manual_full_sync äº‹ä»¶ã€‚');try{eventEmit('manual_full_sync'),jt().success('å·²å‘é€â€œå®Œå…¨é‡ç®—å˜é‡â€è¯·æ±‚ã€‚','æ“ä½œæˆåŠŸ')}catch(e){n.error('onFullSync','å‘é€ manual_full_sync äº‹ä»¶æ—¶å‡ºé”™:',e),jt().error('å‘é€è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚','æ“ä½œå¤±è´¥')}}function r(){n.log('onLastSync','ç‚¹å‡»â€œé‡ç®—æœ€åä¸€æ¥¼å˜é‡â€ï¼Œå‘é€ manual_sync äº‹ä»¶ã€‚');try{eventEmit('manual_sync'),jt().success('å·²å‘é€â€œé‡ç®—æœ€åä¸€æ¥¼å˜é‡â€è¯·æ±‚ã€‚','æ“ä½œæˆåŠŸ')}catch(e){n.error('onLastSync','å‘é€ manual_sync äº‹ä»¶æ—¶å‡ºé”™:',e),jt().error('å‘é€è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚','æ“ä½œå¤±è´¥')}}return(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,null,[(0,y.createCommentVNode)(' å³ä¾§æ“ä½œå¡ï¼šå¤–å±‚è‡ªåŒ…å«ï¼Œä¸ä¾èµ–çˆ¶ç»„ä»¶æ ·å¼ '),(0,y.createElementVNode)('section',Zt,[(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šæ“ä½œå¡å®¹å™¨ '),n[8]||(n[8]=(0,y.createElementVNode)('h4',{class:'card-title'},'å¿«æ·æ“ä½œ',-1)),(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šå¡ç‰‡æ ‡é¢˜ '),(0,y.createElementVNode)('div',Xt,[(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šæŒ‰é’®å‚ç›´æ ˆ '),(0,y.createElementVNode)('div',ea,[(0,y.createElementVNode)('button',{class:'btn primary',title:'é‡æ–°è®¡ç®—æ‰€æœ‰å˜é‡',onClick:(0,y.withModifiers)(a,['stop'])},[(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šä¸»æŒ‰é’® '),n[0]||(n[0]=(0,y.createElementVNode)('span',{class:'ico','aria-hidden':'true'},'ğŸ”„',-1)),(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡ '),n[1]||(n[1]=(0,y.createElementVNode)('span',{class:'label'},'å®Œå…¨é‡ç®—å˜é‡',-1)),(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šæ–‡å­— ')]),n[2]||(n[2]=(0,y.createElementVNode)('p',{class:'btn-desc'},' å½“å˜é‡ä¸é¢„æœŸä¸ç¬¦æ—¶ï¼Œç‚¹å‡»æ­¤æŒ‰é’®å¯ä»**ç¬¬ä¸€æ¡æ¶ˆæ¯**å¼€å§‹é‡æ–°è®¡ç®—æ‰€æœ‰æ¶ˆæ¯ï¼Œä»¥ç¡®ä¿æ•°æ®å®Œå…¨åŒæ­¥ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„æ“ä½œã€‚ ',-1))]),(0,y.createElementVNode)('div',na,[(0,y.createElementVNode)('button',{class:'btn subtle',title:'åªé‡ç®—æœ€æ–°ä¸€æ¥¼çš„å˜é‡',onClick:(0,y.withModifiers)(r,['stop'])},[(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šæ¬¡æŒ‰é’® '),n[3]||(n[3]=(0,y.createElementVNode)('span',{class:'ico','aria-hidden':'true'},'â™»ï¸',-1)),(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šå›¾æ ‡ '),n[4]||(n[4]=(0,y.createElementVNode)('span',{class:'label'},'é‡ç®—æœ€åä¸€æ¥¼å˜é‡',-1)),(0,y.createCommentVNode)(' ä¸­æ–‡æ³¨é‡Šï¼šæ–‡å­— ')]),n[5]||(n[5]=(0,y.createElementVNode)('p',{class:'btn-desc'},' ä»…æ ¹æ®æœ€æ–°ä¸€æ¡æ¶ˆæ¯é‡æ–°è®¡ç®—å˜é‡ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚é€‚ç”¨äºä¿®å¤æœ€è¿‘ä¸€æ¬¡æ“ä½œå¯¼è‡´çš„å°é—®é¢˜æˆ–åœ¨æ‰‹åŠ¨ç¼–è¾‘äº†æœ€åä¸€æ¡æ¶ˆæ¯åé‡æ–°å†™å…¥å˜é‡ï¼ˆæ³¨æ„ï¼Œeraä¼šæ— è§†æ‰€æœ‰**ç”¨æˆ·å‘é€çš„æ¶ˆæ¯**ä¸­çš„å˜é‡æ›´æ–°è¯­å¥ï¼‰ã€‚ ',-1))]),(0,y.createElementVNode)('div',ta,[(0,y.createElementVNode)('button',{class:'btn danger',title:'ä¸ºè§’è‰²å¡æ³¨å…¥ ERA è§„åˆ™',onClick:(0,y.withModifiers)(t,['stop'])},[...n[6]||(n[6]=[(0,y.createElementVNode)('span',{class:'ico','aria-hidden':'true'},'ğŸ¥½',-1),(0,y.createElementVNode)('span',{class:'label'},'ERA å¿«é€Ÿåˆå§‹åŒ–',-1)])]),n[7]||(n[7]=(0,y.createElementVNode)('p',{class:'btn-desc'},[(0,y.createTextVNode)(' ã€è§’è‰²å¡ä½œè€…ä¸“ç”¨ã€‘ç‚¹å‡»åï¼Œä¼šå‘å½“å‰è§’è‰²å¡æ³¨å…¥å››æ¡è§„åˆ™ï¼š'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 1. æ·»åŠ â€œERA æ•°æ®éšè—æ­£åˆ™â€ä»¥éšè—èŠå¤©ä¸­çš„æ•°æ®æ ‡ç­¾ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 2. æ·»åŠ â€œERAçŠ¶æ€æ æ¨¡æ¿â€ä»¥å°†æ¨¡æ¿çŠ¶æ€æ æ›¿æ¢è‡³æ¶ˆæ¯ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 3. å‘è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­æ·»åŠ â€œERAå˜é‡æ“ä½œè§„åˆ™â€æ¡ç›®ä»¥ä»¤aiæ˜ç™½eraå˜é‡çš„æ“ä½œè§„åˆ™ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 4. å‘è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­æ·»åŠ â€œERAå˜é‡æ„å›¾è¯´æ˜â€æ¡ç›®ä»¥å­˜æ”¾å˜é‡æ„å›¾è¯´æ˜ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' æ³¨æ„ï¼šä½œè€…å¯ä»¥ç”¨è¯¥åŠŸèƒ½å¿«é€Ÿæ³¨å…¥ä½¿ç”¨eraçš„å‡ ä¸ªåŸºç¡€é…ç½®ã€‚ä½†ä½ ä»æ—§éœ€è¦ï¼š'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 1. è‡ªå·±è®¾è®¡è§’è‰²å¡ç”¨åˆ°çš„å˜é‡ç»“æ„å¹¶å†™å…¥è§’è‰²çš„å¼€åœºç™½ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 2. åœ¨è§’è‰²ä¸»ä¸–ç•Œä¹¦ä¸­â€˜ERAå˜é‡æ„å›¾è¯´æ˜â€™æ¡ç›®ä¸­æ·»åŠ å‘aiè¯´æ˜å„ä¸ªå˜é‡çš„æ„å›¾çš„æç¤ºè¯ã€‚'),(0,y.createElementVNode)('br'),(0,y.createTextVNode)(' 3. ä¿®æ”¹â€˜ERAçŠ¶æ€æ æ¨¡æ¿â€™æ­£åˆ™ä¸­çš„çŠ¶æ€æ ä»£ç ï¼Œä»¤å…¶ä¸**ä½ è®¾è®¡çš„å˜é‡ç³»ç»ŸåŒ¹é…**ã€‚ ')],-1))])])])],2112))}});i(751);const ra=(0,En.A)(aa,[['__scopeId','data-v-3cd160a6']]),sa={class:'settings-card',role:'region','aria-label':'ERA è®¾ç½®'},oa=['aria-expanded'],ia={class:'chev','aria-hidden':'true'},la={class:'content'},ca={class:'toolbar'},da={class:'vars'},pa=['title'],Aa={class:'var-editor'},ua={key:0,class:'switch'},ga=['onUpdate:modelValue'],Ca=['onUpdate:modelValue','placeholder'],ba=['onUpdate:modelValue','placeholder'],ma=['onUpdate:modelValue','placeholder','onInput'],fa={class:'type-chip'},ha=(0,y.defineComponent)({__name:'EraSettingsPanel',setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/components/RightRailContent/EraSettingsPanel'),t=(0,y.ref)(!1),a=(0,y.ref)([]),r=(0,y.reactive)({}),s=(0,y.reactive)({}),o=(0,y.reactive)({});function i(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function l(){try{n.debug('loadVars','å°è¯•è¯»å–è„šæœ¬è®¾ç½®...');const e=E.value;if(n.debug('loadVars','æˆåŠŸè¯»å–è„šæœ¬è®¾ç½®:',e),!e||0===Object.keys(e).length)return n.warn('loadVars','è®¾ç½®å¯¹è±¡ä¸ºç©ºï¼ŒUI å°†ä¸ä¼šè¢«å¡«å……ã€‚'),a.value=[],void jt().info('æœªæ‰¾åˆ°ä»»ä½•è„šæœ¬å˜é‡ã€‚');a.value=[];for(const e of Object.keys(r))delete r[e];for(const e of Object.keys(s))delete s[e];for(const e of Object.keys(o))delete o[e];Object.entries(e).filter(([e])=>'å¼€å¯æ‚¬æµ®çƒ'!==e).forEach(([e,n])=>{const t='boolean'==typeof(o=n)?'boolean':'number'==typeof o&&Number.isFinite(o)?'number':'string'==typeof o?'string':'json';var o;a.value.push({key:e,value:n,type:t}),'json'===t?s[e]=i(n):r[e]=n}),jt().success('å·²ä»è„šæœ¬å˜é‡ä¸­åŠ è½½æœ€æ–°è®¾ç½®ã€‚','è¯»å–æˆåŠŸ')}catch(e){n.error('loadVars','è¯»å–è„šæœ¬å˜é‡å¤±è´¥:',e),jt().error('è¯»å– ERA è®¾ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ã€‚','è¯»å–å¤±è´¥')}}function c(){t.value=!t.value,t.value&&0===a.value.length&&l()}function d(){n.log('discardEdits','ç‚¹å‡»â€œä¸¢å¼ƒä¿®æ”¹â€'),l(),jt().info('æ‰€æœ‰æœªä¿å­˜çš„ä¿®æ”¹å·²è¢«ä¸¢å¼ƒã€‚','æ“ä½œå®Œæˆ')}async function p(){const e=JSON.parse(JSON.stringify(a.value));try{const e={};a.value.forEach(n=>{if('json'===n.type){if(o[n.key]?.bad)throw new Error(`é”® ${n.key} çš„ JSON æ ¼å¼ä¸æ­£ç¡®`);if(null!=s[n.key]){const t=JSON.parse(s[n.key]);n.value=t,e[n.key]=t}}else void 0!==r[n.key]&&(n.value=r[n.key],e[n.key]=r[n.key])}),jt().success('ç•Œé¢å·²æ›´æ–°ã€‚æ­£åœ¨åå°ä¿å­˜...','æ“ä½œæˆåŠŸ'),await M(e=>{const n={...e};return Object.entries(r).forEach(([e,t])=>{n[e]=t}),Object.entries(s).forEach(([e,t])=>{if(null!=t){if(o[e]?.bad)throw new Error(`é”® ${e} çš„ JSON æ ¼å¼ä¸æ­£ç¡®`);n[e]=JSON.parse(t)}}),n}),n.log('saveEdits','è„šæœ¬å˜é‡å·²ä¿å­˜'),jt().success('è®¾ç½®å·²æˆåŠŸä¿å­˜åˆ°è„šæœ¬å˜é‡ã€‚','ä¿å­˜æˆåŠŸ'),window.dispatchEvent(new CustomEvent('era-settings-updated'))}catch(t){n.error('saveEdits','ä¿å­˜å¤±è´¥ï¼š',t),jt().error(`ä¿å­˜å¤±è´¥ï¼š${t?.message??t}ã€‚æ­£åœ¨å›æ»šç•Œé¢ã€‚`,'ä¿å­˜å¤±è´¥'),a.value=e,e.forEach(e=>{'json'===e.type?s[e.key]=i(e.value):r[e.key]=e.value})}}return(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,null,[(0,y.createCommentVNode)(' å¤–å±‚å¡ç‰‡ï¼šä¸ ActionButtons ä¿æŒä¸€è‡´çš„ç»ç’ƒå¡é£æ ¼ï¼Œä½†é»˜è®¤æ”¶èµ· '),(0,y.createElementVNode)('section',sa,[(0,y.createCommentVNode)(' è®¾ç½®å¡ç‰‡å®¹å™¨ '),(0,y.createCommentVNode)(' æ ‡é¢˜è¡Œï¼šå¯ç‚¹å‡»æŠ˜å /å±•å¼€ '),(0,y.createElementVNode)('button',{class:'card-header','aria-expanded':t.value,onClick:c},[(0,y.createCommentVNode)(' ç‚¹å‡»åˆ‡æ¢å±•å¼€çŠ¶æ€ '),n[0]||(n[0]=(0,y.createElementVNode)('span',{class:'title'},'ERA è®¾ç½®',-1)),(0,y.createCommentVNode)(' æ ‡é¢˜æ–‡å­— '),(0,y.createElementVNode)('span',ia,(0,y.toDisplayString)(t.value?'â–¾':'â–¸'),1),(0,y.createCommentVNode)(' å±•å¼€ç®­å¤´ ')],8,oa),(0,y.createCommentVNode)(' å†…å®¹ä½“ï¼šé»˜è®¤æ”¶èµ·ï¼›å±•å¼€åæ˜¾ç¤ºå˜é‡åˆ—è¡¨ä¸æ“ä½œ '),(0,y.withDirectives)((0,y.createElementVNode)('div',la,[(0,y.createCommentVNode)(' å±•å¼€å†…å®¹å®¹å™¨ '),(0,y.createCommentVNode)(' é¡¶éƒ¨æ“ä½œåŒºï¼šåˆ·æ–°/ä¿å­˜/é‡ç½®ç¼–è¾‘ '),(0,y.createElementVNode)('div',ca,[(0,y.createCommentVNode)(' å·¥å…·æ¡ '),(0,y.createElementVNode)('button',{class:'mini-btn',title:'é‡æ–°è¯»å–è„šæœ¬å˜é‡',onClick:(0,y.withModifiers)(l,['stop'])},'ğŸ”„ é‡æ–°è¯»å–'),(0,y.createCommentVNode)(' è¯»å–æŒ‰é’® '),n[1]||(n[1]=(0,y.createElementVNode)('div',{class:'spacer'},null,-1)),(0,y.createCommentVNode)(' å ä½æ’‘å¼€ '),(0,y.createElementVNode)('button',{class:'mini-btn subtle',title:'ä¸¢å¼ƒæœªä¿å­˜çš„ä¿®æ”¹',onClick:(0,y.withModifiers)(d,['stop'])},'â†©ï¸ ä¸¢å¼ƒä¿®æ”¹'),(0,y.createCommentVNode)(' ä¸¢å¼ƒç¼–è¾‘ '),(0,y.createElementVNode)('button',{class:'mini-btn primary',title:'ä¿å­˜ä¿®æ”¹åˆ°è„šæœ¬å˜é‡',onClick:(0,y.withModifiers)(p,['stop'])},'ğŸ’¾ ä¿å­˜ä¿®æ”¹'),(0,y.createCommentVNode)(' ä¿å­˜ä¿®æ”¹ ')]),(0,y.createCommentVNode)(' å˜é‡åˆ—è¡¨ï¼šé€é¡¹æ¸²æŸ“ '),(0,y.createElementVNode)('div',da,[a.value.length>0?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:0},[(0,y.createCommentVNode)(' æœ‰å˜é‡æ—¶æ¸²æŸ“åˆ—è¡¨ '),((0,y.openBlock)(!0),(0,y.createElementBlock)(y.Fragment,null,(0,y.renderList)(a.value,e=>{return(0,y.openBlock)(),(0,y.createElementBlock)('div',{key:e.key,class:'var-row'},[(0,y.createCommentVNode)(' æ¯ä¸ªå˜é‡ä¸€è¡Œ '),(0,y.createElementVNode)('label',{class:'var-key',title:e.key},(0,y.toDisplayString)(e.key),9,pa),(0,y.createCommentVNode)(' å˜é‡å '),(0,y.createCommentVNode)(' æ ¹æ®å˜é‡ç±»å‹é€‰æ‹©ä¸åŒçš„ç¼–è¾‘æ§ä»¶ '),(0,y.createElementVNode)('div',Aa,[(0,y.createCommentVNode)(' ç¼–è¾‘å™¨å®¹å™¨ '),(0,y.createCommentVNode)(' å¸ƒå°”ï¼šå‹¾é€‰æ¡† '),'boolean'===e.type?((0,y.openBlock)(),(0,y.createElementBlock)('label',ua,[(0,y.createCommentVNode)(' è‡ªå®šä¹‰å¼€å…³å¤–è§‚ '),(0,y.withDirectives)((0,y.createElementVNode)('input',{'onUpdate:modelValue':n=>r[e.key]=n,type:'checkbox'},null,8,ga),[[y.vModelCheckbox,r[e.key]]]),(0,y.createCommentVNode)(' å‹¾é€‰å€¼ '),n[2]||(n[2]=(0,y.createElementVNode)('span',{class:'track'},null,-1)),(0,y.createCommentVNode)(' è½¨é“ ')])):'number'===e.type?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:1},[(0,y.createCommentVNode)(' æ•°å­—ï¼šnumber è¾“å…¥ '),(0,y.withDirectives)((0,y.createElementVNode)('input',{'onUpdate:modelValue':n=>r[e.key]=n,type:'number',class:'ipt',placeholder:String(e.value)},null,8,Ca),[[y.vModelText,r[e.key],void 0,{number:!0}]]),(0,y.createCommentVNode)(' æ•°å­—è¾“å…¥ ')],64)):'string'===e.type?((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:2},[(0,y.createCommentVNode)(' å­—ç¬¦ä¸²ï¼štext è¾“å…¥ '),(0,y.withDirectives)((0,y.createElementVNode)('input',{'onUpdate:modelValue':n=>r[e.key]=n,type:'text',class:'ipt',placeholder:String(e.value)},null,8,ba),[[y.vModelText,r[e.key]]]),(0,y.createCommentVNode)(' æ–‡æœ¬è¾“å…¥ ')],64)):((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:3},[(0,y.createCommentVNode)(' å…¶ä»–ï¼ˆå¯¹è±¡/æ•°ç»„/null/æœªçŸ¥ï¼‰ï¼šJSON æ–‡æœ¬åŸŸ '),(0,y.withDirectives)((0,y.createElementVNode)('textarea',{'onUpdate:modelValue':n=>s[e.key]=n,class:'ipt ta',placeholder:i(e.value),onInput:n=>function(e){const n=s[e]??'';if(''!==n.trim())try{JSON.parse(n),o[e]={ok:!0,bad:!1,msg:'JSON æ ¼å¼æœ‰æ•ˆ'}}catch(n){o[e]={bad:!0,ok:!1,msg:`JSON æ ¼å¼é”™è¯¯ï¼š${n?.message??''}`}}else o[e]={bad:!0,ok:!1,msg:'ä¸èƒ½ä¸ºç©ºï¼ˆè‹¥è¦è®¾ä¸º null è¯·å†™ nullï¼‰'}}(e.key)},null,40,ma),[[y.vModelText,s[e.key]]]),(0,y.createCommentVNode)(' JSON æ–‡æœ¬åŸŸ '),(0,y.createElementVNode)('span',{class:(0,y.normalizeClass)(['hint',{ok:o[e.key]?.ok,bad:o[e.key]?.bad}])},(0,y.toDisplayString)(o[e.key]?.msg??'ä»¥ JSON æ ¼å¼ç¼–è¾‘æ­¤å€¼'),3),(0,y.createCommentVNode)(' JSON æ ¡éªŒæç¤º ')],64))]),(0,y.createCommentVNode)(' ç±»å‹å¾½æ ‡ '),(0,y.createElementVNode)('span',fa,(0,y.toDisplayString)((t=e.type,'boolean'===t?'å¸ƒå°”':'number'===t?'æ•°å­—':'string'===t?'å­—ç¬¦ä¸²':'JSON')),1),(0,y.createCommentVNode)(' ç±»å‹å±•ç¤º ')]);var t}),128))],64)):((0,y.openBlock)(),(0,y.createElementBlock)(y.Fragment,{key:1},[(0,y.createCommentVNode)(' æ²¡æœ‰å˜é‡æ—¶çš„å ä½ '),n[3]||(n[3]=(0,y.createElementVNode)('div',{class:'placeholder'},[(0,y.createElementVNode)('p',null,'æœªè¯»å–åˆ°ä»»ä½•è„šæœ¬å˜é‡ã€‚'),(0,y.createCommentVNode)(' æ–‡æœ¬æç¤º '),(0,y.createElementVNode)('p',{class:'dim'},[(0,y.createTextVNode)(' è¯·å…ˆç¡®ä¿åœ¨ '),(0,y.createElementVNode)('code',null,'app_ready'),(0,y.createTextVNode)(' æˆ–åˆå§‹åŒ–é˜¶æ®µé€šè¿‡ '),(0,y.createElementVNode)('code',null,'initializeExternalSettings()'),(0,y.createTextVNode)(' å†™å…¥é»˜è®¤å˜é‡ã€‚ ')]),(0,y.createCommentVNode)(' è¾…åŠ©è¯´æ˜ ')],-1))],64))])],512),[[y.vShow,t.value]])])],2112))}});i(741);const va=(0,En.A)(ha,[['__scopeId','data-v-e1f9e9e0']]),xa={class:'right-rail'},Ba={class:'right-rail-content-wrapper'},ya=(0,y.defineComponent)({__name:'RightRail',setup:e=>(e,n)=>((0,y.openBlock)(),(0,y.createElementBlock)('aside',xa,[(0,y.createElementVNode)('div',Ba,[(0,y.createVNode)(ra),(0,y.createVNode)(va),(0,y.createVNode)(Tt)])]))});i(644);const wa=(0,En.A)(ya,[['__scopeId','data-v-61d00544']]),Ea=(0,y.defineComponent)({__name:'ThemeManager',setup:(e,{expose:n})=>(n({isDarkMode:(0,y.ref)(!1)}),()=>{})});i(776);const ka=Ea,_a=a('ui',()=>{const e=(0,y.ref)('FloatingBall'),n=(0,y.ref)(null);return{currentView:e,eventData:n,switchView:function(n){e.value!==n&&(e.value=n)},setEventData:function(e){n.value=e}}}),Sa={class:'era-expanded-layer'},Da={class:'era-shell'},Ma=(0,y.defineComponent)({__name:'App',setup(e){const n=new j('ERAå˜é‡æ¡†æ¶/ui/App'),t=_a(),{currentView:a,eventData:s}=r(t),o=(0,y.ref)(null),i=(0,y.ref)(!1),l=()=>{try{const e=E.value?.['å¼€å¯é»‘å¤œæ¨¡å¼']??!1;i.value=e,o.value&&(o.value.isDarkMode=e),n.debug('loadThemeSetting','ä¸»é¢˜å·²æ›´æ–°ä¸º: '+(e?'Dark':'Light'))}catch(e){n.error('loadThemeSetting','åŠ è½½ä¸»é¢˜è®¾ç½®å¤±è´¥',e),i.value=!1}};(0,y.onMounted)(()=>{l(),window.addEventListener('era-settings-updated',l)}),(0,y.onBeforeUnmount)(()=>{window.removeEventListener('era-settings-updated',l)});return(e,r)=>((0,y.openBlock)(),(0,y.createElementBlock)('div',{class:(0,y.normalizeClass)(['era-app-container',{'dark-theme':i.value}])},[(0,y.createVNode)(ka,{ref_key:'themeManager',ref:o},null,512),(0,y.withDirectives)((0,y.createVNode)(Rt,{onClick:r[0]||(r[0]=e=>{return a='ExpandedView',n.debug('requestSwitchView',`è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${a}`),void t.switchView(a);var a})},null,512),[[y.vShow,'FloatingBall'===(0,y.unref)(a)]]),(0,y.withDirectives)((0,y.createElementVNode)('div',Sa,[(0,y.createCommentVNode)(' è§†å£çº§å±•å¼€å±‚ï¼šæ‚¬æµ®æ¨¡æ€å®¹å™¨ '),(0,y.createElementVNode)('div',Da,[(0,y.createCommentVNode)(' æ–°å¢æ¨ªå‘å£³å®¹å™¨ï¼šå·¦é¢æ¿ + å³ä¾§æ  '),(0,y.createVNode)(Nt,{data:(0,y.unref)(s)},null,8,['data']),(0,y.createVNode)(wa)])],512),[[y.vShow,'ExpandedView'===(0,y.unref)(a)]])],2))}});i(997),i(639);const Na=(0,En.A)(Ma,[['__scopeId','data-v-7634a531']]);const Va=new j('ERAå˜é‡æ¡†æ¶/ui');let Ra=null,Ia=null;function Fa(){Va.log('unloadUI','UI è„šæœ¬å¼€å§‹å¸è½½'),Ra&&(Va.debug('unmountVueApp','å¸è½½ Vue å®ä¾‹'),Ra.unmount(),Ra=null),$(`head > div[script_id="${getScriptId()}"]`).remove(),Ia&&(Va.debug('unloadUI','é”€æ¯æŒ‚è½½ç‚¹'),$(`div#era-ui-mount-point-${getScriptId()}`).remove(),Ia=null),window.removeEventListener('pagehide',Fa),Va.log('unloadUI','UI è„šæœ¬å¸è½½å®Œæˆ')}window.eraUiSwitchView=function(e){Va.debug('switchView',`è¯·æ±‚åˆ‡æ¢è§†å›¾åˆ°: ${e}`),window.eraUiStore?window.eraUiStore.switchView(e):Va.warn('switchView','UI storeå°šæœªåˆå§‹åŒ–')},$(()=>{if(!1===E.value['å¼€å¯æ‚¬æµ®çƒ'])return Va.log('initialize','æ‚¬æµ®çƒè®¾ç½®ä¸ºå…³é—­ï¼Œå¼€å§‹å¸è½½UI...'),void Fa();Va.log('initialize','UI è„šæœ¬å¼€å§‹åˆå§‹åŒ–'),Ia=$('<div>').attr('id',`era-ui-mount-point-${getScriptId()}`).css({position:'fixed',bottom:'20px',left:'20px','z-index':1e4}),Va.debug('$(document).ready','åˆ›å»ºæŒ‚è½½ç‚¹',Ia),$('body').append(Ia),Va.debug('$(document).ready','æŒ‚è½½ç‚¹å·²æ·»åŠ åˆ° body'),Ra=(0,y.createApp)(Na);const e=t();Ra.use(e),Ra.mount(Ia[0]);const n=_a(e);window.eraUiStore=n,function(){const e=getScriptId();$(`head > div[script_id="${e}"]`).remove();const n=$('<div>').attr('script_id',e).append($(document).find('head > style').clone());$('head').append(n)}(),Va.debug('initialize','Vue App å·²æŒ‚è½½ï¼Œæ ·å¼å·²ä¼ é€'),eventOn('era:writeDone',e=>{Va.log('era:writeDone','æ¥æ”¶åˆ° era:writeDone äº‹ä»¶ï¼Œæ›´æ–° store',e),n.setEventData(e)}),Va.debug('$(document).ready','å·²è®¾ç½® era:writeDone äº‹ä»¶ç›‘å¬å™¨'),window.removeEventListener('pagehide',Fa),window.addEventListener('pagehide',Fa)});[...P.INIT,...P.SYNC,...P.API,...P.UPDATE_MK_ONLY,...P.COLLISION_DETECTORS,...P.COMBO_STARTERS,...P.DIRECTED_SYNC].forEach(e=>{eventOn(e,n=>gn(e,n))}),eventOn(getButtonEvent('å†™å…¥å˜é‡ä¿®æ”¹'),()=>gn('manual_write')),eventOn(getButtonEvent('æ‰‹åŠ¨åŒæ­¥çŠ¶æ€'),()=>gn('manual_sync')),eventOn(getButtonEvent('å¼ºåˆ¶å®Œå…¨é‡ç®—'),()=>gn('manual_full_sync'));
//# sourceMappingURL=index.js.map