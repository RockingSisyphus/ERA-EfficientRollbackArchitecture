var __webpack_modules__ = {
  "./src/ERA变量框架/api/command.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/api/command.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteByObject: () => (/* binding */ deleteByObject),\n/* harmony export */   deleteByPath: () => (/* binding */ deleteByPath),\n/* harmony export */   emitWriteDoneEvent: () => (/* binding */ emitWriteDoneEvent),\n/* harmony export */   insertByObject: () => (/* binding */ insertByObject),\n/* harmony export */   insertByPath: () => (/* binding */ insertByPath),\n/* harmony export */   updateByObject: () => (/* binding */ updateByObject),\n/* harmony export */   updateByPath: () => (/* binding */ updateByPath)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message_utils */ \"./src/ERA变量框架/utils/message_utils.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('api');\n// 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件\nconst debouncedEmitApiWrite = lodash__WEBPACK_IMPORTED_MODULE_0___default().debounce(() => {\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n}, 700, { leading: false, trailing: true });\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job) {\n    // 1. 生成指令块\n    const contentString = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(job.blockContent);\n    const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n    // 2. 查找目标消息并追加内容\n    const lastAiMessage = await (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!lastAiMessage) {\n        logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n        return;\n    }\n    const originalContent = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(lastAiMessage) ?? '';\n    const newContent = originalContent + block;\n    logger.log('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n    // 3. 实时更新消息内容\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_3__.updateMessageContent)(lastAiMessage, newContent);\n    // 4. 调用防抖函数来调度写入事件的发送\n    debouncedEmitApiWrite();\n}\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction insertByObject(data) {\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction updateByObject(data) {\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction insertByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction updateByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nfunction deleteByObject(data) {\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nfunction deleteByPath(path) {\n    // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, {});\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n// ==================================================================\n// 事件广播器实现 (由 variable_change_processor.ts 等内部模块调用)\n// ==================================================================\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）在 `variable_change_processor.ts` 中成功完成后，\n * 应调用此函数。它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {WriteDonePayload} payload - 包含写入操作关键信息的事件负载。\n * @example\n * // 这是一个在外部脚本中监听此事件的示例：\n * eventOn('era:writeDone', (detail) => {\n *   const { mk, message_id, actions, selectedMks, editLogs, stat, statWithoutMeta } = detail;\n *   console.log(`ERA 变量已更新！消息 ID: ${message_id}, MK: ${mk}`);\n *   console.log('执行的操作:', actions);\n *\n *   // 你可以根据需要使用 stat (带 meta) 或 statWithoutMeta (不带 meta)\n *   console.log('最新的纯净状态数据:', statWithoutMeta);\n *\n *   // 此时可以根据最新的状态数据更新你自己的 UI 或执行其他逻辑\n * });\n */\nfunction emitWriteDoneEvent(payload) {\n    // 在广播前，对需要暴露给外部的数据进行反转义\n    const unescapedPayload = {\n        ...payload,\n        stat: (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.unescapeEraData)(payload.stat),\n        statWithoutMeta: (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.unescapeEraData)(payload.statWithoutMeta),\n    };\n    logger.debug('emitWriteDoneEvent', 'writeDone事件广播数据反转义', {\n        before: { stat: payload.stat, statWithoutMeta: payload.statWithoutMeta },\n        after: { stat: unescapedPayload.stat, statWithoutMeta: unescapedPayload.statWithoutMeta },\n    });\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE, unescapedPayload);\n    logger.log('emitWriteDoneEvent', `已触发 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE} 事件。操作: ${JSON.stringify(payload.actions)}, MK: ${payload.mk}, MsgID: ${payload.message_id}, 连续处理次数: ${payload.consecutiveProcessingCount}`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9jb21tYW5kLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFFb0I7QUFDa0Q7QUFDSztBQUN0QjtBQUNMO0FBQ2I7QUFFdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBUWpDLDBDQUEwQztBQUMxQyxNQUFNLHFCQUFxQixHQUFHLHNEQUFVLENBQ3RDLEdBQUcsRUFBRTtJQUNILFNBQVMsQ0FBQywrREFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN2QyxNQUFNLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFLFdBQVcsK0RBQWlCLENBQUMsU0FBUyxNQUFNLENBQUMsQ0FBQztBQUNwRixDQUFDLEVBQ0QsR0FBRyxFQUNILEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQ25DLENBQUM7QUFFRixxRUFBcUU7QUFDckUsV0FBVztBQUNYLHNEQUFzRDtBQUN0RCxxRUFBcUU7QUFFckU7Ozs7Ozs7O0dBUUc7QUFFSDs7Ozs7Ozs7R0FRRztBQUVIOzs7Ozs7Ozs7OztHQVdHO0FBRUg7Ozs7Ozs7Ozs7O0dBV0c7QUFFSDs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSDs7Ozs7OztHQU9HO0FBRUgscUVBQXFFO0FBQ3JFLFNBQVM7QUFDVCxxRUFBcUU7QUFFckU7Ozs7R0FJRztBQUVIOzs7O0dBSUc7QUFDSCxLQUFLLFVBQVUsZUFBZSxDQUFDLEdBQWdCO0lBQzdDLFdBQVc7SUFDWCxNQUFNLGFBQWEsR0FBRyw4Q0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUMxQyxNQUFNLEtBQUssR0FBRyxNQUFNLEdBQUcsQ0FBQyxRQUFRLE1BQU0sYUFBYSxPQUFPLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQztJQUUxRSxpQkFBaUI7SUFDakIsTUFBTSxhQUFhLEdBQUcsTUFBTSx1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QUN4RSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsQ0FBQyxlQUFlLEVBQUU7S0FDMUYsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLCtEQUFpQixDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzFELE1BQU0sQ0FBQyxHQUFHLENBQ1Isb0JBQW9CLEVBQ3BCLE9BQU8sK0RBQWlCLENBQUMsVUFBVSxXQUFXLElBQUksQ0FBQyxTQUFTLENBQzFELE9BQU8sQ0FBQyxPQUFPLENBQ2hCLFNBQVMsT0FBTyxDQUFDLEVBQUUsWUFBWSxPQUFPLENBQUMsVUFBVSxhQUFhLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSxDQUNwRyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9jb21tYW5kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWklumDqOS6i+S7tiBBUEkg5a6e546w5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+aYryBFUkEg5qGG5p625LiO5aSW6YOo6ISa5pys5Lqk5LqS55qE5o6l5Y+j5bGC44CC5a6D5a6e546w5LqG5LiA57O75YiX6Ieq5a6a5LmJ5LqL5Lu255qE5aSE55CG5Zmo44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDmoYbmnrbkuI3nm7TmjqXlkJHlpJbmmrTpnLLlh73mlbDosIPnlKjmjqXlj6PjgILlpJbpg6johJrmnKzkuI4gRVJBIOS6pOS6kueahCoq5ZSv5LiAKirmlrnlvI/mmK/pgJrov4fphZLppobnmoRcbiAqIGBldmVudEVtaXQoZXZlbnROYW1lLCBldmVudERhdGEpYCDlh73mlbDvvIzlj5HpgIHnibnlrprmoLzlvI/nmoTkuovku7bjgIJcbiAqXG4gKiBgaW5kZXgudHNgIOaooeWdl+S8muebkeWQrOi/meS6myBgZXJhOipgIOWJjee8gOeahOS6i+S7tu+8jOW5tuWwhuWFtuaOqOWFpSBgZXZlbnRfcXVldWUudHNgIOS4rei/m+ihjOWkhOeQhuOAglxuICog5LqL5Lu26Zif5YiX5pyA57uI5Lya6LCD55So5pys5paH5Lu25Lit5a+55bqU55qE5aSE55CG5Zmo5Ye95pWw77yI5aaCIGBpbnNlcnRCeU9iamVjdGDvvInjgIJcbiAqXG4gKiDmnKzmqKHlnZfkuK3nmoTlh73mlbDpgJrov4fkuIDnp43lt6flppnjgIHop6PogKbnmoTmlrnlvI/lt6XkvZzvvJrlroPku6zlnKjmnIDmlrDnmoQgQUkg5raI5oGv5pyr5bC+5Yqo5oCB5rOo5YWlXG4gKiBgPFZhcmlhYmxlSW5zZXJ0PmAg5oiWIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk5Z2X77yM54S25ZCO6LCD55So6YWS6aaG55qEIGBzZXRDaGF0TWVzc2FnZXNgIOabtOaWsOa2iOaBr+OAglxuICog6L+Z5qyh5L+u5pS55Lya6Kem5Y+RIGBjaGFyYWN0ZXJfbWVzc2FnZV9yZW5kZXJlZGAg562J5LqL5Lu277yM6KKrIEVSQSDnmoTkuLvnm5HlkKzlmajmjZXojrfvvIxcbiAqIOS7juiAjOWwhiBBUEkg6LCD55So5peg57yd5Zyw5pW05ZCI5YiwIEVSQSDnmoTljp/nlJ/op6PmnpDlkozlkIzmraXmtYHnqIvkuK3jgIJcbiAqL1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRVJBX0VWRU5UX0VNSVRURVIsIFdyaXRlRG9uZVBheWxvYWQgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZmluZExhc3RBaU1lc3NhZ2UsIGdldE1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vdXRpbHMvbWVzc2FnZV91dGlscyc7XG5pbXBvcnQgeyB1cGRhdGVNZXNzYWdlQ29udGVudCB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgSiwgdW5lc2NhcGVFcmFEYXRhIH0gZnJvbSAnLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdhcGknKTtcblxuLy8gQVBJIOWGmeWFpeS7u+WKoeeahOaOpeWPo+WumuS5iVxuaW50ZXJmYWNlIEFwaVdyaXRlSm9iIHtcbiAgYmxvY2tUYWc6ICdWYXJpYWJsZUluc2VydCcgfCAnVmFyaWFibGVFZGl0JyB8ICdWYXJpYWJsZURlbGV0ZSc7XG4gIGJsb2NrQ29udGVudDogb2JqZWN0O1xufVxuXG4vLyDkvb/nlKggbG9kYXNoLmRlYm91bmNlIOWIm+W7uuS4gOS4qumYsuaKluWHveaVsOadpeWPkemAgSBBUEkg5YaZ5YWl5LqL5Lu2XG5jb25zdCBkZWJvdW5jZWRFbWl0QXBpV3JpdGUgPSBfLmRlYm91bmNlKFxuICAoKSA9PiB7XG4gICAgZXZlbnRFbWl0KEVSQV9FVkVOVF9FTUlUVEVSLkFQSV9XUklURSk7XG4gICAgbG9nZ2VyLmxvZygnZGVib3VuY2VkRW1pdEFwaVdyaXRlJywgYOW3suinpuWPkeWQiOW5tuWQjueahCAke0VSQV9FVkVOVF9FTUlUVEVSLkFQSV9XUklURX0g5LqL5Lu244CCYCk7XG4gIH0sXG4gIDcwMCxcbiAgeyBsZWFkaW5nOiBmYWxzZSwgdHJhaWxpbmc6IHRydWUgfSxcbik7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQVBJIOS6i+S7tuWPguiAg1xuLy8gKOS6i+S7tuWQjeensOeahOW4uOmHj+WumuS5ieingeS6jiBgY29uc3RhbnRzLnRzYCDkuK3nmoQgYEVSQV9BUElfRVZFTlRTYCDlr7nosaEpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6aW5zZXJ0QnlPYmplY3QnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5LiA5Liq5a+56LGh77yM6Z2e56C05Z2P5oCn5Zyw5o+S5YWl5paw5Y+Y6YeP44CC5Y+q5Lya5YaZ5YWl5LiN5a2Y5Zyo55qE6Lev5b6E44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g6KaB5o+S5YWl55qE5Y+Y6YeP5a+56LGh44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6aW5zZXJ0QnlPYmplY3QnLCB7XG4gKiAgIHBsYXllcjogeyBuYW1lOiBcIuWLh+iAhVwiLCBocDogMTAwLCBpbnZlbnRvcnk6IFtdIH1cbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOnVwZGF0ZUJ5T2JqZWN0J1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+S4gOS4quWvueixoe+8jOS/ruaUueW3suWtmOWcqOeahOWPmOmHj+OAguWmguaenOi3r+W+hOS4jeWtmOWcqO+8jOWImeW/veeVpeOAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOimgeabtOaWsOeahOWPmOmHj+WvueixoeOAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOnVwZGF0ZUJ5T2JqZWN0Jywge1xuICogICBwbGF5ZXI6IHsgaHA6IDEyMCwgc3RhdHVzOiAnYmxlc3NlZCcgfVxuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6aW5zZXJ0QnlQYXRoJ1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+aMh+Wumui3r+W+hOWSjOWAvO+8jOmdnuegtOWdj+aAp+WcsOaPkuWFpeS4gOS4quaWsOWPmOmHj+OAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOWMheWQq+i3r+W+hOWSjOWAvOeahOWvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IGRldGFpbC5wYXRoIC0g5Y+Y6YeP55qE6Lev5b6E77yM5L2/55So54K55oiW5pa55ous5Y+36KGo56S65rOV44CCXG4gKiBAcGFyYW0geyp9IGRldGFpbC52YWx1ZSAtIOimgeaPkuWFpeeahOWAvOOAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOmluc2VydEJ5UGF0aCcsIHtcbiAqICAgcGF0aDogJ3BsYXllci5pbnZlbnRvcnlbMF0nLFxuICogICB2YWx1ZTogeyBuYW1lOiAn55Sf5ZG96I2v5rC0JywgY291bnQ6IDMgfVxuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6dXBkYXRlQnlQYXRoJ1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+aMh+Wumui3r+W+hOWSjOWAvO+8jOS/ruaUueS4gOS4quW3suWtmOWcqOeahOWPmOmHj+OAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOWMheWQq+i3r+W+hOWSjOWAvOeahOWvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IGRldGFpbC5wYXRoIC0g5Y+Y6YeP55qE6Lev5b6E44CCXG4gKiBAcGFyYW0geyp9IGRldGFpbC52YWx1ZSAtIOimgeiuvue9rueahOaWsOWAvOOAguWPr+S7peaYr+ebtOaOpeeahOWAvO+8jOS5n+WPr+S7peaYr+i/kOeul+ihqOi+vuW8j+OAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOnVwZGF0ZUJ5UGF0aCcsIHtcbiAqICAgcGF0aDogJ3BsYXllci5ocCcsXG4gKiAgIHZhbHVlOiAnKz0xMCdcbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmRlbGV0ZUJ5T2JqZWN0J1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+S4gOS4quWvueixoe+8jOWIoOmZpOW3suWtmOWcqOeahOWPmOmHj+OAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOaPj+i/sOimgeWIoOmZpOi3r+W+hOeahOe7k+aehOOAguWAvOeahOe7k+aehOWGs+WumuS6huWIoOmZpOihjOS4uuOAglxuICogQGV4YW1wbGVcbiAqIC8vIOWHhuWkh+WIoOmZpCBwbGF5ZXIuZ29sZOOAguaMh+S7pOS4rSBnb2xkIOeahOWAvOW/hemhu+aYr+epuuWvueixoSB7fVxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjogeyBnb2xkOiB7fSB9IH0pO1xuICpcbiAqIC8vIOWHhuWkh+WIoOmZpOaVtOS4qiBwbGF5ZXIg5a+56LGh44CCXG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeU9iamVjdCcsIHsgcGxheWVyOiB7fSB9KTtcbiAqXG4gKiAvLyAqKumHjeimgSoqOiDlpoLmnpwgcGxheWVyIOWvueixoeWMheWQqyBnb2xkIOWSjCBtYW5hIOS4pOS4quWxnuaAp++8jFxuICogLy8g5Lul5LiL5oyH5Luk5Y+q5Lya5Yig6ZmkIGdvbGQg5ZKMIG1hbmHvvIzogIwgcGxheWVyIOWvueixoeacrOi6q+S8muiiq+S/neeVme+8iOWPmOS4uuepuuWvueixoe+8ieOAglxuICogLy8g6L+Z5LiOIGBldmVudEVtaXQoJ2VyYTpkZWxldGVCeU9iamVjdCcsIHsgcGxheWVyOiB7fSB9KWAg55qE5pWI5p6c5piv5LiN5ZCM55qE44CCXG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeU9iamVjdCcsIHsgcGxheWVyOiB7IGdvbGQ6IHt9LCBtYW5hOiB7fSB9IH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmRlbGV0ZUJ5UGF0aCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmjIflrprot6/lvoTvvIzliKDpmaTkuIDkuKrlt7LlrZjlnKjnmoTlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDljIXlkKvot6/lvoTnmoTlr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXRhaWwucGF0aCAtIOimgeWIoOmZpOeahOWPmOmHj+eahOi3r+W+hOOAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5UGF0aCcsIHsgcGF0aDogJ3BsYXllci5pbnZlbnRvcnlbMF0nIH0pO1xuICovXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5YaF6YOo5qC45b+D5Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDlnKjogYrlpKnorrDlvZXkuK3mn6Xmib7lubbov5Tlm57mnIDlkI7kuIDmnaHnlLEgQUkg5Y+R6YCB55qE5raI5oGv44CCXG4gKiDov5nmmK/ms6jlhaXlj5jph4/kv67mlLnmjIfku6TnmoTnm67moIfmtojmga/jgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueSB8IG51bGw+fSDov5Tlm57mib7liLDnmoTmtojmga/lr7nosaHvvIzlpoLmnpzkuI3lrZjlnKggQUkg5raI5oGv5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuXG4vKipcbiAqIOaJp+ihjOS4gOasoSBBUEkg5YaZ5YWl5pON5L2c44CCXG4gKiDlroPlsIbmjIflrprnmoTlj5jph4/kv67mlLnlnZfov73liqDliLDmnIDlkI7kuIDmnaEgQUkg5raI5oGv55qE5pyr5bC+77yM54S25ZCO6LCD5bqm5LiA5LiqICdlcmE6YXBpV3JpdGUnIOS6i+S7tuOAglxuICogQHBhcmFtIHtBcGlXcml0ZUpvYn0gam9iIC0g6KaB5omn6KGM55qE5YaZ5YWl5Lu75Yqh44CCXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1BcGlXcml0ZShqb2I6IEFwaVdyaXRlSm9iKSB7XG4gIC8vIDEuIOeUn+aIkOaMh+S7pOWdl1xuICBjb25zdCBjb250ZW50U3RyaW5nID0gSihqb2IuYmxvY2tDb250ZW50KTtcbiAgY29uc3QgYmxvY2sgPSBgXFxuPCR7am9iLmJsb2NrVGFnfT5cXG4ke2NvbnRlbnRTdHJpbmd9XFxuPC8ke2pvYi5ibG9ja1RhZ30+YDtcblxuICAvLyAyLiDmn6Xmib7nm67moIfmtojmga/lubbov73liqDlhoXlrrlcbiAgY29uc3QgbGFzdEFpTWVzc2FnZSA9IGF3YWl0IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbGFzdEFpTWVzc2FnZSkge1xuICAgIGxvZ2dlci53YXJuKCdwZXJmb3JtQXBpV3JpdGUnLCAn5om+5LiN5Yiw5Lu75L2VIEFJIOa2iOaBr++8jOaXoOazleaJp+ihjCBBUEkg5YaZ5YWl44CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgb3JpZ2luYWxDb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobGFzdEFpTWVzc2FnZSkgPz8gJyc7XG4gIGNvbnN0IG5ld0NvbnRlbnQgPSBvcmlnaW5hbENvbnRlbnQgKyBibG9jaztcblxuICBsb2dnZXIubG9nKCdwZXJmb3JtQXBpV3JpdGUnLCBg5a6e5pe25YaZ5YWlIEFQSSDku7vliqEgKCR7am9iLmJsb2NrVGFnfSkg5Yiw5raI5oGvIElEICR7bGFzdEFpTWVzc2FnZS5tZXNzYWdlX2lkfS4uLmApO1xuXG4gIC8vIDMuIOWunuaXtuabtOaWsOa2iOaBr+WGheWuuVxuICBhd2FpdCB1cGRhdGVNZXNzYWdlQ29udGVudChsYXN0QWlNZXNzYWdlLCBuZXdDb250ZW50KTtcblxuICAvLyA0LiDosIPnlKjpmLLmipblh73mlbDmnaXosIPluqblhpnlhaXkuovku7bnmoTlj5HpgIFcbiAgZGVib3VuY2VkRW1pdEFwaVdyaXRlKCk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5LqL5Lu25aSE55CG5Zmo5a6e546wICjnlLEgZXZlbnRfcXVldWUudHMg6LCD55SoKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTppbnNlcnRCeU9iamVjdGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIOS7juS6i+S7tueahCBgZGV0YWlsYCDkuK3ojrflj5bnmoTlj5jph4/lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEJ5T2JqZWN0KGRhdGE6IG9iamVjdCkge1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlSW5zZXJ0JywgYmxvY2tDb250ZW50OiBkYXRhIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6dXBkYXRlQnlPYmplY3RgIOS6i+S7tuOAglxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSDku47kuovku7bnmoQgYGRldGFpbGAg5Lit6I635Y+W55qE5Y+Y6YeP5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVCeU9iamVjdChkYXRhOiBvYmplY3QpIHtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZUVkaXQnLCBibG9ja0NvbnRlbnQ6IGRhdGEgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTppbnNlcnRCeVBhdGhgIOS6i+S7tuOAglxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSDku47kuovku7YgYGRldGFpbGAg55qEIGBwYXRoYCDlsZ7mgKfojrflj5bjgIJcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgLSDku47kuovku7YgYGRldGFpbGAg55qEIGB2YWx1ZWAg5bGe5oCn6I635Y+W44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRCeVBhdGgocGF0aDogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gIGNvbnN0IGJsb2NrID0gXy5zZXQoe30sIHBhdGgsIHZhbHVlKTtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZUluc2VydCcsIGJsb2NrQ29udGVudDogYmxvY2sgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTp1cGRhdGVCeVBhdGhgIOS6i+S7tuOAglxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSDku47kuovku7YgYGRldGFpbGAg55qEIGBwYXRoYCDlsZ7mgKfojrflj5bjgIJcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgLSDku47kuovku7YgYGRldGFpbGAg55qEIGB2YWx1ZWAg5bGe5oCn6I635Y+W44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVCeVBhdGgocGF0aDogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gIGNvbnN0IGJsb2NrID0gXy5zZXQoe30sIHBhdGgsIHZhbHVlKTtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZUVkaXQnLCBibG9ja0NvbnRlbnQ6IGJsb2NrIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6ZGVsZXRlQnlPYmplY3RgIOS6i+S7tuOAglxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSDku47kuovku7bnmoQgYGRldGFpbGAg5Lit6I635Y+W55qE5Y+Y6YeP57uT5p6E44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVCeU9iamVjdChkYXRhOiBvYmplY3QpIHtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZURlbGV0ZScsIGJsb2NrQ29udGVudDogZGF0YSB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmRlbGV0ZUJ5UGF0aGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHBhdGhgIOWxnuaAp+iOt+WPluOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQnlQYXRoKHBhdGg6IHN0cmluZykge1xuICAvLyDlr7nkuo7liKDpmaTmk43kvZzvvIzmiJHku6znlKjkuIDkuKrnqbrlr7nosaHkvZzkuLrlgLzmnaXooajnpLrliKDpmaTor6Xot6/lvoTnmoTmhI/lm75cbiAgY29uc3QgYmxvY2sgPSBfLnNldCh7fSwgcGF0aCwge30pO1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRGVsZXRlJywgYmxvY2tDb250ZW50OiBibG9jayB9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7blub/mkq3lmajlrp7njrAgKOeUsSB2YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzIOetieWGhemDqOaooeWdl+iwg+eUqClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqICoq44CQ5bm/5pKt5Zmo44CRKiog6Kem5Y+RIGBlcmE6d3JpdGVEb25lYCDkuovku7bjgIJcbiAqIOW9k+S4gOasoeWujOaVtOeahOWPmOmHj+WGmeWFpeaTjeS9nO+8iOWMheaLrOWinuOAgeWIoOOAgeaUue+8ieWcqCBgdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvci50c2Ag5Lit5oiQ5Yqf5a6M5oiQ5ZCO77yMXG4gKiDlupTosIPnlKjmraTlh73mlbDjgILlroPlkJHlpJbpg6johJrmnKzlub/mkq3kuIDkuKrkuovku7bvvIzpgJrnn6XlroPku6zlj5jph4/nirbmgIHlt7Llj5HnlJ/mlLnlj5jvvIzlubbmj5Dkvpvor6bnu4bnmoTkuIrkuIvmlofjgIJcbiAqXG4gKiBAcGFyYW0ge1dyaXRlRG9uZVBheWxvYWR9IHBheWxvYWQgLSDljIXlkKvlhpnlhaXmk43kvZzlhbPplK7kv6Hmga/nmoTkuovku7botJ/ovb3jgIJcbiAqIEBleGFtcGxlXG4gKiAvLyDov5nmmK/kuIDkuKrlnKjlpJbpg6johJrmnKzkuK3nm5HlkKzmraTkuovku7bnmoTnpLrkvovvvJpcbiAqIGV2ZW50T24oJ2VyYTp3cml0ZURvbmUnLCAoZGV0YWlsKSA9PiB7XG4gKiAgIGNvbnN0IHsgbWssIG1lc3NhZ2VfaWQsIGFjdGlvbnMsIHNlbGVjdGVkTWtzLCBlZGl0TG9ncywgc3RhdCwgc3RhdFdpdGhvdXRNZXRhIH0gPSBkZXRhaWw7XG4gKiAgIGNvbnNvbGUubG9nKGBFUkEg5Y+Y6YeP5bey5pu05paw77yB5raI5oGvIElEOiAke21lc3NhZ2VfaWR9LCBNSzogJHtta31gKTtcbiAqICAgY29uc29sZS5sb2coJ+aJp+ihjOeahOaTjeS9nDonLCBhY3Rpb25zKTtcbiAqXG4gKiAgIC8vIOS9oOWPr+S7peagueaNrumcgOimgeS9v+eUqCBzdGF0ICjluKYgbWV0YSkg5oiWIHN0YXRXaXRob3V0TWV0YSAo5LiN5bimIG1ldGEpXG4gKiAgIGNvbnNvbGUubG9nKCfmnIDmlrDnmoTnuq/lh4DnirbmgIHmlbDmja46Jywgc3RhdFdpdGhvdXRNZXRhKTtcbiAqXG4gKiAgIC8vIOatpOaXtuWPr+S7peagueaNruacgOaWsOeahOeKtuaAgeaVsOaNruabtOaWsOS9oOiHquW3seeahCBVSSDmiJbmiafooYzlhbbku5bpgLvovpFcbiAqIH0pO1xuICovXG5leHBvcnQgZnVuY3Rpb24gZW1pdFdyaXRlRG9uZUV2ZW50KHBheWxvYWQ6IFdyaXRlRG9uZVBheWxvYWQpIHtcbiAgLy8g5Zyo5bm/5pKt5YmN77yM5a+56ZyA6KaB5pq06Zyy57uZ5aSW6YOo55qE5pWw5o2u6L+b6KGM5Y+N6L2s5LmJXG4gIGNvbnN0IHVuZXNjYXBlZFBheWxvYWQgPSB7XG4gICAgLi4ucGF5bG9hZCxcbiAgICBzdGF0OiB1bmVzY2FwZUVyYURhdGEocGF5bG9hZC5zdGF0KSxcbiAgICBzdGF0V2l0aG91dE1ldGE6IHVuZXNjYXBlRXJhRGF0YShwYXlsb2FkLnN0YXRXaXRob3V0TWV0YSksXG4gIH07XG5cbiAgbG9nZ2VyLmRlYnVnKCdlbWl0V3JpdGVEb25lRXZlbnQnLCAnd3JpdGVEb25l5LqL5Lu25bm/5pKt5pWw5o2u5Y+N6L2s5LmJJywge1xuICAgIGJlZm9yZTogeyBzdGF0OiBwYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogcGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgICBhZnRlcjogeyBzdGF0OiB1bmVzY2FwZWRQYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogdW5lc2NhcGVkUGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgfSk7XG5cbiAgZXZlbnRFbWl0KEVSQV9FVkVOVF9FTUlUVEVSLldSSVRFX0RPTkUsIHVuZXNjYXBlZFBheWxvYWQpO1xuICBsb2dnZXIubG9nKFxuICAgICdlbWl0V3JpdGVEb25lRXZlbnQnLFxuICAgIGDlt7Lop6blj5EgJHtFUkFfRVZFTlRfRU1JVFRFUi5XUklURV9ET05FfSDkuovku7bjgILmk43kvZw6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICBwYXlsb2FkLmFjdGlvbnMsXG4gICAgKX0sIE1LOiAke3BheWxvYWQubWt9LCBNc2dJRDogJHtwYXlsb2FkLm1lc3NhZ2VfaWR9LCDov57nu63lpITnkIbmrKHmlbA6ICR7cGF5bG9hZC5jb25zZWN1dGl2ZVByb2Nlc3NpbmdDb3VudH1gLFxuICApO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/command.ts\n\n}");
  },
  "./src/ERA变量框架/api/macro/parser.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/api/macro/parser.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseEraMacros: () => (/* binding */ parseEraMacros)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('query');\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseEraMacros(text) {\n    const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{ERA')) {\n        return text;\n    }\n    // 获取 stat_data\n    const { stat } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.getEraData)();\n    if (!stat) {\n        logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n        // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n        return text;\n    }\n    return text.replace(macroRegex, (substring, withMeta, path) => {\n        const funcName = 'parseEraMacros';\n        const trimmedPath = path.trim();\n        const includeMeta = !!withMeta;\n        let data;\n        if (trimmedPath === '$ALLDATA') {\n            data = stat;\n        }\n        else {\n            data = _.get(stat, trimmedPath);\n        }\n        if (data === undefined) {\n            logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n            return ''; // 路径未找到, 返回空字符串\n        }\n        // 根据 withMeta 标志决定是否移除 $meta 字段\n        const dataBeforeUnescape = includeMeta ? data : (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.removeMetaFields)(data);\n        // 在返回数据前进行反转义\n        const finalData = (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.unescapeEraData)(dataBeforeUnescape);\n        logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n            before: dataBeforeUnescape,\n            after: finalData,\n        });\n        // 如果是对象或数组, 转换为 JSON 字符串\n        if (typeof finalData === 'object' && finalData !== null) {\n            return JSON.stringify(finalData);\n        }\n        // 如果是原始类型, 直接转换为字符串\n        return String(finalData);\n    });\n}\n$(() => {\n    /**\n     * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n     *\n     * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n     *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n     * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n     *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n     */\n    registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n        // 直接复用 parseEraMacros 函数的逻辑。\n        // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n        return parseEraMacros(substring);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXJzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFvRTtBQUNqQjtBQUNWO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUVuQzs7Ozs7R0FLRztBQUNJLFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDekMsTUFBTSxVQUFVLEdBQUcsNENBQTRDLENBQUM7SUFFaEUsNEJBQTRCO0lBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDNUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsZUFBZTtJQUNmLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRywyREFBVSxFQUFFLENBQUM7SUFDOUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1YsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3pELG9DQUFvQztRQUNwQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUM1RCxNQUFNLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQztRQUNsQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUUvQixJQUFJLElBQUksQ0FBQztRQUNULElBQUksV0FBVyxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQy9CLElBQUksR0FBRyxJQUFJLENBQUM7UUFDZCxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsdUJBQXVCLFdBQVcsZUFBZSxDQUFDLENBQUM7WUFDekUsT0FBTyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0I7UUFDN0IsQ0FBQztRQUVELGdDQUFnQztRQUNoQyxNQUFNLGtCQUFrQixHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxpRUFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV2RSxjQUFjO1FBQ2QsTUFBTSxTQUFTLEdBQUcsNERBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRXRELE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxXQUFXLEVBQUUsRUFBRTtZQUN6RCxNQUFNLEVBQUUsa0JBQWtCO1lBQzFCLEtBQUssRUFBRSxTQUFTO1NBQ2pCLENBQUMsQ0FBQztRQUVILHlCQUF5QjtRQUN6QixJQUFJLE9BQU8sU0FBUyxLQUFLLFFBQVEsSUFBSSxTQUFTLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDeEQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsQ0FBQyxDQUFDLEdBQUcsRUFBRTtJQUNMOzs7Ozs7O09BT0c7SUFDSCxpQkFBaUIsQ0FBQyw0Q0FBNEMsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ3JHLDZCQUE2QjtRQUM3QixvREFBb0Q7UUFDcEQsT0FBTyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXJzZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0RXJhRGF0YSwgcmVtb3ZlTWV0YUZpZWxkcyB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHVuZXNjYXBlRXJhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigncXVlcnknKTtcblxuLyoqXG4gKiDop6PmnpDlrZfnrKbkuLLkuK3nmoQgRVJBIOWujywg5bm25bCG5YW25pu/5o2i5Li65a+55bqU55qE5Y+Y6YeP5YC844CCXG4gKiDov5nmmK/mj5Dkvpvnu5nlhbbku5bmqKHlnZfosIPnlKjnmoTlhazlhbHmjqXlj6PjgIJcbiAqIEBwYXJhbSB0ZXh0IC0g5YyF5ZCr5a6P55qE6L6T5YWl5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyAtIOabv+aNouWuj+WQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFcmFNYWNyb3ModGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbWFjcm9SZWdleCA9IC97e1xccypFUkEoLXdpdGhtZXRhKT9cXHMqOlxccyooW159XSs/KVxccyp9fS9naTtcblxuICAvLyDlpoLmnpzmlofmnKzkuK3kuI3ljIXlkKvlro/nibnlvoHlrZfnrKbkuLIsIOebtOaOpei/lOWbnuS7peS8mOWMluaAp+iDvVxuICBpZiAoIXRleHQuaW5jbHVkZXMoJ3t7RVJBJykpIHtcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIC8vIOiOt+WPliBzdGF0X2RhdGFcbiAgY29uc3QgeyBzdGF0IH0gPSBnZXRFcmFEYXRhKCk7XG4gIGlmICghc3RhdCkge1xuICAgIGxvZ2dlci53YXJuKCdwYXJzZUVyYU1hY3JvcycsICfml6Dms5Xojrflj5bliLAgc3RhdF9kYXRhLCDlro/mm7/mjaLlpLHotKUuJyk7XG4gICAgLy8g5aaC5p6c5rKh5pyJIHN0YXRfZGF0YSwg5Lu75L2V5a6P6YO95peg5rOV6Kej5p6QLCDnm7TmjqXov5Tlm57ljp/mlofmnKxcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIHJldHVybiB0ZXh0LnJlcGxhY2UobWFjcm9SZWdleCwgKHN1YnN0cmluZywgd2l0aE1ldGEsIHBhdGgpID0+IHtcbiAgICBjb25zdCBmdW5jTmFtZSA9ICdwYXJzZUVyYU1hY3Jvcyc7XG4gICAgY29uc3QgdHJpbW1lZFBhdGggPSBwYXRoLnRyaW0oKTtcbiAgICBjb25zdCBpbmNsdWRlTWV0YSA9ICEhd2l0aE1ldGE7XG5cbiAgICBsZXQgZGF0YTtcbiAgICBpZiAodHJpbW1lZFBhdGggPT09ICckQUxMREFUQScpIHtcbiAgICAgIGRhdGEgPSBzdGF0O1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhID0gXy5nZXQoc3RhdCwgdHJpbW1lZFBhdGgpO1xuICAgIH1cblxuICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGxvZ2dlci53YXJuKGZ1bmNOYW1lLCBg5ZyoIHN0YXRfZGF0YSDkuK3mnKrmib7liLDot6/lvoQgXCIke3RyaW1tZWRQYXRofVwiLCDlro/lsIbmm7/mjaLkuLrnqbrlrZfnrKbkuLIuYCk7XG4gICAgICByZXR1cm4gJyc7IC8vIOi3r+W+hOacquaJvuWIsCwg6L+U5Zue56m65a2X56ym5LiyXG4gICAgfVxuXG4gICAgLy8g5qC55o2uIHdpdGhNZXRhIOagh+W/l+WGs+WumuaYr+WQpuenu+mZpCAkbWV0YSDlrZfmrrVcbiAgICBjb25zdCBkYXRhQmVmb3JlVW5lc2NhcGUgPSBpbmNsdWRlTWV0YSA/IGRhdGEgOiByZW1vdmVNZXRhRmllbGRzKGRhdGEpO1xuXG4gICAgLy8g5Zyo6L+U5Zue5pWw5o2u5YmN6L+b6KGM5Y+N6L2s5LmJXG4gICAgY29uc3QgZmluYWxEYXRhID0gdW5lc2NhcGVFcmFEYXRhKGRhdGFCZWZvcmVVbmVzY2FwZSk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ3BhcnNlRXJhTWFjcm9zJywgYOWuj+abv+aNouaVsOaNruWPjei9rOS5iTogJHt0cmltbWVkUGF0aH1gLCB7XG4gICAgICBiZWZvcmU6IGRhdGFCZWZvcmVVbmVzY2FwZSxcbiAgICAgIGFmdGVyOiBmaW5hbERhdGEsXG4gICAgfSk7XG5cbiAgICAvLyDlpoLmnpzmmK/lr7nosaHmiJbmlbDnu4QsIOi9rOaNouS4uiBKU09OIOWtl+espuS4slxuICAgIGlmICh0eXBlb2YgZmluYWxEYXRhID09PSAnb2JqZWN0JyAmJiBmaW5hbERhdGEgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShmaW5hbERhdGEpO1xuICAgIH1cblxuICAgIC8vIOWmguaenOaYr+WOn+Wni+exu+Weiywg55u05o6l6L2s5o2i5Li65a2X56ym5LiyXG4gICAgcmV0dXJuIFN0cmluZyhmaW5hbERhdGEpO1xuICB9KTtcbn1cblxuJCgoKSA9PiB7XG4gIC8qKlxuICAgKiDms6jlhowgRVJBIOWujywg55So5LqO5Zyo5Y+R6YCB57uZIEFJIOeahOa2iOaBr+S4reafpeivouW9k+WJjeiBiuWkqeeahOWPmOmHj+aVsOaNrlxuICAgKlxuICAgKiAtIGB7e0VSQTpwYXRoLnRvLmRhdGF9fWA6IOafpeivouW5tuabv+aNouS4uioq5LiN5ZCrKiogYCRtZXRhYCDnmoTnuq/lh4DmlbDmja7jgIJcbiAgICogICAtIGB7e0VSQTokQUxMREFUQX19YCDlsIbov5Tlm57mlbTkuKrnp7vpmaQgYCRtZXRhYCDlkI7nmoQgYHN0YXRfZGF0YWAg5a+56LGh44CCXG4gICAqIC0gYHt7RVJBLXdpdGhtZXRhOnBhdGgudG8uZGF0YX19YDog5p+l6K+i5bm25pu/5o2i5Li6KirljIXlkKsqKiBgJG1ldGFgIOeahOWOn+Wni+aVsOaNruOAglxuICAgKiAgIC0gYHt7RVJBLXdpdGhtZXRhOiRBTExEQVRBfX1gIOWwhui/lOWbnuWujOaVtOeahCBgc3RhdF9kYXRhYCDlr7nosaHjgIJcbiAgICovXG4gIHJlZ2lzdGVyTWFjcm9MaWtlKC97e1xccypFUkEoLXdpdGhtZXRhKT9cXHMqOlxccyooW159XSs/KVxccyp9fS9naSwgKGNvbnRleHQsIHN1YnN0cmluZywgd2l0aE1ldGEsIHBhdGgpID0+IHtcbiAgICAvLyDnm7TmjqXlpI3nlKggcGFyc2VFcmFNYWNyb3Mg5Ye95pWw55qE6YC76L6R44CCXG4gICAgLy8gc3Vic3RyaW5nIOWPguaVsOaYr+WMuemFjeWIsOeahOWujOaVtOWuj+Wtl+espuS4siwg5aaCIFwie3tFUkE6cGF0aC50by5kYXRhfX1cIlxuICAgIHJldHVybiBwYXJzZUVyYU1hY3JvcyhzdWJzdHJpbmcpO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/macro/parser.ts\n\n}");
  },
  "./src/ERA变量框架/api/macro/patch.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/api/macro/patch.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceRenderRecentMessages: () => (/* binding */ forceRenderRecentMessages)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换管线。\n */\n\n\nconst log = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('force_macro_render');\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\nfunction forceRenderMessage(messageId) {\n    return new Promise(resolve => {\n        const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n        const $message = $(messageSelector);\n        // 模拟点击“编辑”\n        $message.find('.mes_button.mes_edit').trigger('click');\n        // 给予UI响应时间, 然后模拟点击“确认”\n        setTimeout(() => {\n            $message.find('.mes_edit_done.menu_button').trigger('click');\n            resolve();\n        }, 50);\n    });\n}\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nasync function forceRenderRecentMessages() {\n    const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n    // 检查是否启用了强制重载功能\n    const forceReload = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载功能', false);\n    if (!forceReload) {\n        log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n        return; // 如果未启用，则不执行任何操作\n    }\n    // 获取要重载的消息数量，默认为1\n    const messageCount = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载消息数', 1);\n    log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n    // 等待一小段时间, 确保变量更新已经完成\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const allMessages = getChatMessages('0-{{lastMessageId}}');\n    if (!allMessages || allMessages.length === 0) {\n        log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n        return;\n    }\n    // 根据脚本变量设置的数量来截取最近的消息\n    const recentMessages = allMessages.slice(-messageCount);\n    for (const message of recentMessages) {\n        log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n        await forceRenderMessage(message.message_id);\n        // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXRjaC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7OztHQUdHO0FBRW9CO0FBQ2tCO0FBRXpDLE1BQU0sR0FBRyxHQUFHLElBQUksOENBQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBRTdDOzs7O0dBSUc7QUFDSCxTQUFTLGtCQUFrQixDQUFDLFNBQWlCO0lBQzNDLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDM0IsTUFBTSxlQUFlLEdBQUcsa0JBQWtCLFNBQVMsSUFBSSxDQUFDO1FBQ3hELE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUVwQyxXQUFXO1FBQ1gsUUFBUSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV2RCx1QkFBdUI7UUFDdkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLFFBQVEsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0QsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxLQUFLLFVBQVUseUJBQXlCO0lBQzdDLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUU5RSxnQkFBZ0I7SUFDaEIsTUFBTSxXQUFXLEdBQUcsaURBQUssQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3ZELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNqQixHQUFHLENBQUMsS0FBSyxDQUFDLDJCQUEyQixFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDekQsT0FBTyxDQUFDLGlCQUFpQjtJQUMzQixDQUFDO0lBRUQsa0JBQWtCO0lBQ2xCLE1BQU0sWUFBWSxHQUFHLGlEQUFLLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNyRCxHQUFHLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLGVBQWUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUVwRSxzQkFBc0I7SUFDdEIsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUV4RCxNQUFNLFdBQVcsR0FBRyxlQUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMzRCxJQUFJLENBQUMsV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDN0MsR0FBRyxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQzFELE9BQU87SUFDVCxDQUFDO0lBRUQsc0JBQXNCO0lBQ3RCLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUV4RCxLQUFLLE1BQU0sT0FBTyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsYUFBYSxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3Qyw2QkFBNkI7UUFDN0IsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsR0FBRyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsRCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvYXBpL21hY3JvL3BhdGNoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUg5by65Yi25a6P5riy5p+T5qih5Z2XXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5qih5ouf55So5oi3VUnmk43kvZwsIOW8uuWItumFkummhumHjeaWsOa4suafk+a2iOaBrywg5Lul6Kem5Y+R5a6M5pW055qE5a6P5pu/5o2i566h57q/44CCXG4gKi9cblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ2ZvcmNlX21hY3JvX3JlbmRlcicpO1xuXG4vKipcbiAqIOW8uuWItumHjeaWsOa4suafk+WNleadoea2iOaBr+OAglxuICogQHBhcmFtIG1lc3NhZ2VJZCDopoHlvLrliLbmuLLmn5PnmoTmtojmga9JROOAglxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaooeaLn+eCueWHu+WujOaIkOWQjiByZXNvbHZl44CCXG4gKi9cbmZ1bmN0aW9uIGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlSWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZVNlbGVjdG9yID0gYGRpdi5tZXNbbWVzaWQ9XCIke21lc3NhZ2VJZH1cIl1gO1xuICAgIGNvbnN0ICRtZXNzYWdlID0gJChtZXNzYWdlU2VsZWN0b3IpO1xuXG4gICAgLy8g5qih5ouf54K55Ye74oCc57yW6L6R4oCdXG4gICAgJG1lc3NhZ2UuZmluZCgnLm1lc19idXR0b24ubWVzX2VkaXQnKS50cmlnZ2VyKCdjbGljaycpO1xuXG4gICAgLy8g57uZ5LqIVUnlk43lupTml7bpl7QsIOeEtuWQjuaooeaLn+eCueWHu+KAnOehruiupOKAnVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgJG1lc3NhZ2UuZmluZCgnLm1lc19lZGl0X2RvbmUubWVudV9idXR0b24nKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0sIDUwKTtcbiAgfSk7XG59XG5cbi8qKlxuICog5by65Yi26YeN5paw5riy5p+T5pyA6L+R55qETuadoea2iOaBrywg5Lul56Gu5L+d5a6P6KKr5q2j56Gu5pu/5o2i44CCXG4gKiDmmK/lkKbmiafooYzku6Xlj4rmuLLmn5PnmoTmlbDph4/nlLHohJrmnKzlj5jph4/mjqfliLbjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKSB7XG4gIGNvbnN0IHNjcmlwdFZhcnMgPSBnZXRWYXJpYWJsZXMoeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0pO1xuXG4gIC8vIOajgOafpeaYr+WQpuWQr+eUqOS6huW8uuWItumHjei9veWKn+iDvVxuICBjb25zdCBmb3JjZVJlbG9hZCA9IF8uZ2V0KHNjcmlwdFZhcnMsICflvLrliLbph43ovb3lip/og70nLCBmYWxzZSk7XG4gIGlmICghZm9yY2VSZWxvYWQpIHtcbiAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295Yqf6IO95pyq5ZCv55SoLCDot7Pov4fjgIInKTtcbiAgICByZXR1cm47IC8vIOWmguaenOacquWQr+eUqO+8jOWImeS4jeaJp+ihjOS7u+S9leaTjeS9nFxuICB9XG5cbiAgLy8g6I635Y+W6KaB6YeN6L2955qE5raI5oGv5pWw6YeP77yM6buY6K6k5Li6MVxuICBjb25zdCBtZXNzYWdlQ291bnQgPSBfLmdldChzY3JpcHRWYXJzLCAn5by65Yi26YeN6L295raI5oGv5pWwJywgMSk7XG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCBg5byA5aeL5by65Yi26YeN6L29LCDmlbDph486ICR7bWVzc2FnZUNvdW50fWApO1xuXG4gIC8vIOetieW+heS4gOWwj+auteaXtumXtCwg56Gu5L+d5Y+Y6YeP5pu05paw5bey57uP5a6M5oiQXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG5cbiAgY29uc3QgYWxsTWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nKTtcbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2cud2FybignZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICfml6Dms5Xojrflj5bliLDku7vkvZXmtojmga8sIOe7iOatoumHjei9veOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOagueaNruiEmuacrOWPmOmHj+iuvue9rueahOaVsOmHj+adpeaIquWPluacgOi/keeahOa2iOaBr1xuICBjb25zdCByZWNlbnRNZXNzYWdlcyA9IGFsbE1lc3NhZ2VzLnNsaWNlKC1tZXNzYWdlQ291bnQpO1xuXG4gIGZvciAoY29uc3QgbWVzc2FnZSBvZiByZWNlbnRNZXNzYWdlcykge1xuICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsIGDmraPlnKjlvLrliLbmuLLmn5Pmtojmga86ICR7bWVzc2FnZS5tZXNzYWdlX2lkfWApO1xuICAgIGF3YWl0IGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlLm1lc3NhZ2VfaWQpO1xuICAgIC8vIOWcqOavj+asoeaTjeS9nOS5i+mXtOefreaaguaaguWBnCwg6YG/5YWN5pON5L2c6L+H5b+r5a+86Ie0VUnpl67popjjgIJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gIH1cbiAgbG9nLmxvZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICflvLrliLbph43ovb3lrozmiJDjgIInKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/macro/patch.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/delete.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/delete.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processDeleteBlocks: () => (/* binding */ processDeleteBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('delete');\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData, basePath, patchObj, editLog) {\n    // --- 1. 入口守卫和状态获取 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n    // 精确判断豁免条件\n    const metaPatch = _.get(patchObj, '$meta');\n    const isBypassingProtection = \n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n        // 场景2: 指令明确要删除 $meta.necessary 键\n        _.has(patchObj, ['$meta', 'necessary']);\n    // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n    if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n        // **意图：递归删除子节点**\n        // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n        if (necessary === 'all' && !isBypassingProtection) {\n            logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`);\n            return;\n        }\n        // 权限通过，或存在豁免，继续向内递归。\n        for (const key of Object.keys(patchObj)) {\n            const fullPath = basePath ? `${basePath}.${key}` : key;\n            const subPatchObj = patchObj[key];\n            applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n        }\n        return; // 子节点处理完毕，返回。\n    }\n    // --- 3. 执行删除当前节点 ---\n    // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n    // **意图：删除当前节点 `basePath`**\n    // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n    // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n    if (necessary === 'self' || necessary === 'all') {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`);\n        return;\n    }\n    // 根节点（basePath 为 ''）不应被删除。\n    if (basePath === '') {\n        logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。');\n        return;\n    }\n    // 执行原子性删除\n    const valOld = _.cloneDeep(currentNodeInVars);\n    _.unset(statData, basePath);\n    editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n    logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n/**\n * 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processDeleteBlocks(allDeletes, editLog) {\n    if (allDeletes.length > 0) {\n        for (const deleteRoot of allDeletes) {\n            if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.updateEraStatData)(stat => {\n                    logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n                    // 从根路径开始递归\n                    applyDeleteAtLevel(stat, '', deleteRoot, editLog);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processDeleteBlocks', '所有 VariableDelete 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7R0FVRztBQUNVO0FBRTRDO0FBQ2hCO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUVwQzs7Ozs7Ozs7R0FRRztBQUNILFNBQVMsa0JBQWtCLENBQUMsUUFBYSxFQUFFLFFBQWdCLEVBQUUsUUFBYSxFQUFFLE9BQWM7SUFDeEYsdUJBQXVCO0lBQ3ZCLE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBRTFFLElBQUksaUJBQWlCLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSw4QkFBOEIsUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDeEYsT0FBTztJQUNULENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFFbkUsV0FBVztJQUNYLE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzNDLE1BQU0scUJBQXFCO0lBQ3pCLHdCQUF3QjtJQUN4QixDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxpQ0FBaUM7UUFDakMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUUxQyxvQ0FBb0M7SUFDcEMsSUFBSSxDQUFDLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1FBQ3RELGlCQUFpQjtRQUVqQix3Q0FBd0M7UUFDeEMsSUFBSSxTQUFTLEtBQUssS0FBSyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUNsRCxNQUFNLENBQUMsSUFBSSxDQUNULG9CQUFvQixFQUNwQix5QkFBeUIsUUFBUSxvQ0FBb0MsQ0FDdEUsQ0FBQztZQUNGLE9BQU87UUFDVCxDQUFDO1FBRUQscUJBQXFCO1FBQ3JCLEtBQUssTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ3hDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUN2RCxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUNELE9BQU8sQ0FBQyxjQUFjO0lBQ3hCLENBQUM7SUFFRCxzQkFBc0I7SUFDdEIscUNBQXFDO0lBQ3JDLDJCQUEyQjtJQUUzQixxQ0FBcUM7SUFDckMsNENBQTRDO0lBQzVDLElBQUksU0FBUyxLQUFLLE1BQU0sSUFBSSxTQUFTLEtBQUssS0FBSyxFQUFFLENBQUM7UUFDaEQsTUFBTSxDQUFDLElBQUksQ0FDVCxvQkFBb0IsRUFDcEIseUJBQXlCLFFBQVEsbUJBQW1CLFNBQVMsZUFBZSxDQUM3RSxDQUFDO1FBQ0YsT0FBTztJQUNULENBQUM7SUFFRCwyQkFBMkI7SUFDM0IsSUFBSSxRQUFRLEtBQUssRUFBRSxFQUFFLENBQUM7UUFDcEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO1FBQ2xFLE9BQU87SUFDVCxDQUFDO0lBRUQsVUFBVTtJQUNWLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUM5QyxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUM1QixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsV0FBVyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0FBQzVELENBQUM7QUFFRDs7Ozs7R0FLRztBQUNJLEtBQUssVUFBVSxtQkFBbUIsQ0FBQyxVQUFpQixFQUFFLE9BQWM7SUFDekUsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQzFCLEtBQUssTUFBTSxVQUFVLElBQUksVUFBVSxFQUFFLENBQUM7WUFDcEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7Z0JBQUUsU0FBUztZQUNwRSxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQ3BGLFdBQVc7b0JBQ1gsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQ2xELE9BQU8sSUFBSSxDQUFDO2dCQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUscUJBQXFCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakYsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLHdCQUF3QixDQUFDLENBQUM7SUFDOUQsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvZGVsZXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+WIoOmZpOaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfotJ/otKPlpITnkIYgYDxWYXJpYWJsZURlbGV0ZT5gIOaMh+S7pO+8jOWunueOsOWvueW3suWtmOWcqOWPmOmHj+eahOWIoOmZpO+8jOW5tueUn+aIkOebuOW6lOeahCBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuaMh+S7pOmpseWKqCoqOiDpgJLlvZLooYzkuLrnlLHmjIfku6Tlr7nosaHnmoTnu5PmnoTpqbHliqjjgILnqbrlr7nosaEgYHt9YCDooajnpLrliKDpmaTlvZPliY3oioLngrnvvIzpnZ7nqbrlr7nosaHooajnpLrpgJLlvZLliKDpmaTlrZDoioLngrnjgIJcbiAqIC0gKirlronlhajnrKzkuIAqKjog5Yig6Zmk5piv56C05Z2P5oCn5pON5L2c77yM5Zug5q2k5byV5YWl5LqGIGAkbWV0YS5uZWNlc3NhcnlgIOadg+mZkOacuuWItuadpemYsuatouivr+WIoOOAglxuICogLSAqKueyvuehruixgeWFjSoqOiBgbmVjZXNzYXJ5YCDnmoTkv53miqTlj6rmnInlnKjliKDpmaTmjIfku6TmmI7noa7mjIflkJEgYG5lY2Vzc2FyeWAg5bGe5oCn6Ieq6Lqr5pe25omN5Lya6KKr57uV6L+H44CCXG4gKiAtICoq5Y6f5a2Q5oCn5pel5b+XKio6IOS4uuavj+S4gOasoeWIoOmZpOeUn+aIkOWNleS4gOOAgeeyvuehrueahCBgRWRpdExvZ2DvvIznoa7kv53mk43kvZzlj6/lrozlhajlm57mu5rjgIJcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2RlbGV0ZScpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5Yig6Zmk44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlRGVsZXRlPmAg55qE5qC45b+D6YC76L6R77yM5YW26KGM5Li655Sx5oyH5LukIGBwYXRjaE9iamAg55qE57uT5p6E6amx5Yqo44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeS4jiBgYmFzZVBhdGhgIOWvueW6lOeahOmDqOWIhuOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5mdW5jdGlvbiBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdERhdGE6IGFueSwgYmFzZVBhdGg6IHN0cmluZywgcGF0Y2hPYmo6IGFueSwgZWRpdExvZzogYW55W10pIHtcbiAgLy8gLS0tIDEuIOWFpeWPo+WuiOWNq+WSjOeKtuaAgeiOt+WPliAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcblxuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseURlbGV0ZUF0TGV2ZWwnLCBgVmFyaWFibGVEZWxldGUg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbmVjZXNzYXJ5ID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAnbmVjZXNzYXJ5J10pO1xuXG4gIC8vIOeyvuehruWIpOaWreixgeWFjeadoeS7tlxuICBjb25zdCBtZXRhUGF0Y2ggPSBfLmdldChwYXRjaE9iaiwgJyRtZXRhJyk7XG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgLy8g5Zy65pmvMTog5oyH5Luk6KaB5Yig6Zmk5pW05LiqICRtZXRhIOWvueixoVxuICAgIChfLmlzUGxhaW5PYmplY3QobWV0YVBhdGNoKSAmJiBfLmlzRW1wdHkobWV0YVBhdGNoKSkgfHxcbiAgICAvLyDlnLrmma8yOiDmjIfku6TmmI7noa7opoHliKDpmaQgJG1ldGEubmVjZXNzYXJ5IOmUrlxuICAgIF8uaGFzKHBhdGNoT2JqLCBbJyRtZXRhJywgJ25lY2Vzc2FyeSddKTtcblxuICAvLyAtLS0gMi4g5Yik5pat5oSP5Zu+77ya6YCS5b2S5Yig6Zmk5a2Q6IqC54K5IHZzIOWIoOmZpOW9k+WJjeiKgueCuSAtLS1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikgJiYgIV8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICAvLyAqKuaEj+Wbvu+8mumAkuW9kuWIoOmZpOWtkOiKgueCuSoqXG5cbiAgICAvLyDmnYPpmZDmo4Dmn6XvvJrlpoLmnpzoioLngrnlj5cgJ2FsbCcg5L+d5oqk77yM5LiU5oyH5Luk5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ56aB5q2i5rex5YWl44CCXG4gICAgaWYgKG5lY2Vzc2FyeSA9PT0gJ2FsbCcgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICdhcHBseURlbGV0ZUF0TGV2ZWwnLFxuICAgICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiBhbGxcIiDkv53miqTvvIzlhbblrZDoioLngrnml6Dms5XooqvliKDpmaTjgIJgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDmnYPpmZDpgJrov4fvvIzmiJblrZjlnKjosYHlhY3vvIznu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoT2JqID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIGFwcGx5RGVsZXRlQXRMZXZlbChzdGF0RGF0YSwgZnVsbFBhdGgsIHN1YlBhdGNoT2JqLCBlZGl0TG9nKTtcbiAgICB9XG4gICAgcmV0dXJuOyAvLyDlrZDoioLngrnlpITnkIblrozmr5XvvIzov5Tlm57jgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDmiafooYzliKDpmaTlvZPliY3oioLngrkgLS0tXG4gIC8vICjog73otbDliLDov5nph4zvvIzor7TmmI4gcGF0Y2hPYmog5piv56m65a+56LGh44CB6Z2e5a+56LGh5oiWIG51bGwpXG4gIC8vICoq5oSP5Zu+77ya5Yig6Zmk5b2T5YmN6IqC54K5IGBiYXNlUGF0aGAqKlxuXG4gIC8vIOadg+mZkOajgOafpe+8midzZWxmJyDmiJYgJ2FsbCcg6YO95Lya6Zi75q2i5b2T5YmN6IqC54K555qE55u05o6l5Yig6Zmk44CCXG4gIC8vIOebtOaOpeWIoOmZpOiKgueCueeahOaEj+WbvuaXoOazleixgeWFjeS/neaKpO+8jOW/hemhu+mAmui/h+mAkuW9kuaEj+WbvuWIoOmZpCAnJG1ldGEnIOadpeino+mZpOS/neaKpOOAglxuICBpZiAobmVjZXNzYXJ5ID09PSAnc2VsZicgfHwgbmVjZXNzYXJ5ID09PSAnYWxsJykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RGVsZXRlQXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiAke25lY2Vzc2FyeX1cIiDkv53miqTvvIzml6Dms5Xooqvnm7TmjqXliKDpmaTjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g5qC56IqC54K577yIYmFzZVBhdGgg5Li6ICcn77yJ5LiN5bqU6KKr5Yig6Zmk44CCXG4gIGlmIChiYXNlUGF0aCA9PT0gJycpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsICdWYXJpYWJsZURlbGV0ZSDlpLHotKXvvJrkuI3lhYHorrjliKDpmaTmoLnlr7nosaHjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmiafooYzljp/lrZDmgKfliKDpmaRcbiAgY29uc3QgdmFsT2xkID0gXy5jbG9uZURlZXAoY3VycmVudE5vZGVJblZhcnMpO1xuICBfLnVuc2V0KHN0YXREYXRhLCBiYXNlUGF0aCk7XG4gIGVkaXRMb2cucHVzaCh7IG9wOiAnZGVsZXRlJywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX29sZDogdmFsT2xkIH0pO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsIGDmiJDlip/liKDpmaToioLngrk6ICR7YmFzZVBhdGh9YCk7XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVEZWxldGU+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxEZWxldGVzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGRlbGV0ZSDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlczogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxEZWxldGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IGRlbGV0ZVJvb3Qgb2YgYWxsRGVsZXRlcykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZGVsZXRlUm9vdCkgfHwgXy5pc0VtcHR5KGRlbGV0ZVJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsIGDlpITnkIYgZGVsZXRlUm9vdDogJHtKU09OLnN0cmluZ2lmeShkZWxldGVSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoTlvIDlp4vpgJLlvZJcbiAgICAgICAgICBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdCwgJycsIGRlbGV0ZVJvb3QsIGVkaXRMb2cpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NEZWxldGVCbG9ja3MnLCBg5aSE55CGIGRlbGV0ZVJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVEZWxldGUg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/delete.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/insert.ts": 
  /*!************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/insert.ts ***!
  \************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyInsertAtLevel: () => (/* binding */ applyInsertAtLevel),\n/* harmony export */   processInsertBlocks: () => (/* binding */ processInsertBlocks)\n/* harmony export */ });\n/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./template */ \"./src/ERA变量框架/core/crud/insert/template.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('insert');\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nfunction applyInsertAtLevel(statData, basePath, patchObj, editLog, inheritedContent, parentData) {\n    // --- 1. 确定当前层级的模板内容 ---\n    // 调用 resolveTemplate，它现在直接使用传入的 parentData\n    const localTplContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.resolveTemplate)(inheritedContent, parentData);\n    logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n        statData: _.cloneDeep(statData),\n    });\n    // --- 2. 检查路径存在性，决定执行策略 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    logger.debug('applyInsertAtLevel', `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`, currentNodeInVars);\n    // **策略一：原子性插入 (Atomic Insert)**\n    // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n    if (basePath && currentNodeInVars === undefined) {\n        // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n        const composed = (0,_template__WEBPACK_IMPORTED_MODULE_0__.applyTemplateToPatch)(localTplContent, patchObj);\n        const finalValue = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(composed); // 清理数组中的 null 等无效值。\n        logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n        _.set(statData, basePath, finalValue); // 执行插入。\n        editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n        logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n        return; // 插入完成，终止递归。\n    }\n    // **策略二：递归补充 (Recursive Supplement)**\n    // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n    if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n        logger.debug('applyInsertAtLevel', `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`);\n        for (const key of Object.keys(patchObj)) {\n            const subPath = basePath ? `${basePath}.${key}` : key;\n            const subPatch = patchObj[key];\n            // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n            const subInheritedContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.getInheritedTemplateContent)(localTplContent, key);\n            logger.debug('applyInsertAtLevel', `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`);\n            // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n            applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n        }\n    }\n    else if (basePath) {\n        // **插入失败**\n        // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n        // 则记录警告。insert 不会覆盖已存在的值。\n        logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`);\n    }\n    // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n/**\n * 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processInsertBlocks(allInserts, editLog) {\n    if (allInserts.length > 0) {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n            logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(stat));\n            return stat;\n        });\n        /*\n         * N.B. 必须对每个 insertRoot 单独调用 updateVariablesWith，而不是将所有操作合并到一次调用中。\n         * 这是为了确保在同一条消息内，前一个 <VariableInsert> 块中插入的模板或数据，\n         * 可以被后一个 <VariableInsert> 或 <VariableEdit> 块访问和使用。\n         * 每次 await updateVariablesWith 完成后，变量状态都会被刷新，从而使后续操作能看到最新的结果。\n         */\n        for (const insertRoot of allInserts) {\n            if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(stat => {\n                    logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n                    applyInsertAtLevel(stat, '', insertRoot, editLog, null, null);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processInsertBlocks', '所有 VariableInsert 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ1U7QUFFbUY7QUFDcEM7QUFDUDtBQUNUO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUVwQzs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSSxTQUFTLGtCQUFrQixDQUNoQyxRQUFhLEVBQ2IsUUFBZ0IsRUFDaEIsUUFBYSxFQUNiLE9BQWMsRUFDZCxnQkFBcUIsRUFDckIsVUFBZTtJQUVmLHlCQUF5QjtJQUN6QiwyQ0FBMkM7SUFDM0MsTUFBTSxlQUFlLEdBQUcsMERBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUN0RSxNQUFNLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLG1CQUFtQixRQUFRLElBQUksTUFBTSxHQUFHLEVBQUU7UUFDM0UsUUFBUSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0tBQ2hDLENBQUMsQ0FBQztJQUVILDRCQUE0QjtJQUM1QixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztJQUMxRSxNQUFNLENBQUMsS0FBSyxDQUNWLG9CQUFvQixFQUNwQixvQkFBb0IsUUFBUSxJQUFJLE1BQU0sMEJBQTBCLEVBQ2hFLGlCQUFpQixDQUNsQixDQUFDO0lBRUYsZ0NBQWdDO0lBQ2hDLG1DQUFtQztJQUNuQyxJQUFJLFFBQVEsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNoRCw2Q0FBNkM7UUFDN0MsTUFBTSxRQUFRLEdBQUcsK0RBQW9CLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRWpFLE1BQU0sVUFBVSxHQUFHLDJEQUFjLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxvQkFBb0I7UUFDakUsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLFFBQVEsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JHLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLFFBQVE7UUFDL0MsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbkYsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxjQUFjLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDN0QsT0FBTyxDQUFDLGFBQWE7SUFDdkIsQ0FBQztJQUVELHNDQUFzQztJQUN0QyxnQ0FBZ0M7SUFDaEMsSUFBSSxDQUFDLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1FBQ3BFLE1BQU0sQ0FBQyxLQUFLLENBQ1Ysb0JBQW9CLEVBQ3BCLG9CQUFvQixRQUFRLElBQUksTUFBTTtvQ0FDUixJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQ2hFLENBQUM7UUFDRixLQUFLLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUN4QyxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsUUFBUSxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDdEQsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQy9CLHVEQUF1RDtZQUN2RCxNQUFNLG1CQUFtQixHQUFHLHNFQUEyQixDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUM5RSxNQUFNLENBQUMsS0FBSyxDQUNWLG9CQUFvQixFQUNwQixpQkFBaUIsR0FBRzs0Q0FDZ0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLENBQzFFLENBQUM7WUFDRixtREFBbUQ7WUFDbkQsa0JBQWtCLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixDQUFDLENBQUM7UUFDbkcsQ0FBQztJQUNILENBQUM7U0FBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQ3BCLFdBQVc7UUFDWCwyQ0FBMkM7UUFDM0MsMEJBQTBCO1FBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUscUNBQXFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUNELHlEQUF5RDtBQUMzRCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSSxLQUFLLFVBQVUsbUJBQW1CLENBQUMsVUFBaUIsRUFBRSxPQUFjO0lBQ3pFLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUMxQixNQUFNLGtFQUFpQixDQUFDLEtBQUssRUFBQyxJQUFJLEVBQUMsRUFBRTtZQUNuQyxNQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFxQixFQUFFLDRDQUE0QyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNyRyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO1FBQ0g7Ozs7O1dBS0c7UUFDSCxLQUFLLE1BQU0sVUFBVSxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO2dCQUFFLFNBQVM7WUFDcEUsSUFBSSxDQUFDO2dCQUNILE1BQU0sa0VBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQzdCLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsa0JBQWtCLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNwRixtQ0FBbUM7b0JBQ25DLGtCQUFrQixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7b0JBQzlELE9BQU8sSUFBSSxDQUFDO2dCQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUscUJBQXFCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakYsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLHdCQUF3QixDQUFDLENBQUM7SUFDOUQsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvaW5zZXJ0L2luc2VydC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/mj5LlhaXmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVJbnNlcnQ+YCDmjIfku6TvvIzlrp7njrDlj5jph4/nmoTpnZ7noLTlnY/mgKfmj5LlhaXvvIzlubbnlJ/miJDnm7jlupTnmoQgYEVkaXRMb2dg44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIC0gKirogYzotKPljZXkuIAqKjog5qih5Z2X5Y+q5YWz5b+D5aaC5L2V5qC55o2u5oyH5Luk5L+u5pS55Y+Y6YeP54q25oCB5bm255Sf5oiQ5pel5b+X77yM5LiN5YWz5b+D5oyH5Luk5LuO5L2V6ICM5p2l44CCXG4gKiAtICoq5Y6f5a2Q5oCn5pON5L2cKio6IGBhcHBseUluc2VydEF0TGV2ZWxgIOWunueOsOS6huWOn+WtkOaAp+eahOaPkuWFpe+8jOehruS/neS6huaVsOaNrue7k+aehOeahOWujOaVtOaAp+OAglxuICogICDlpoLmnpzkuIDkuKrln7rnoYDot6/lvoTkuI3lrZjlnKjvvIzlroPkvJrlsIbmlbTkuKrlr7nosaHkvZzkuLrkuIDmlbTkuKrljZXlhYPkuIDmrKHmgKfmj5LlhaXjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V5ZCR5bey5a2Y5Zyo55qE6Lev5b6E5o+S5YWl77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IGFwcGx5VGVtcGxhdGVUb1BhdGNoLCBnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQsIHJlc29sdmVUZW1wbGF0ZSB9IGZyb20gJy4vdGVtcGxhdGUnO1xuaW1wb3J0IHsgdXBkYXRlRXJhU3RhdERhdGEgfSBmcm9tICcuLi8uLi8uLi91dGlscy9lcmFfZGF0YSc7XG5pbXBvcnQgeyBzYW5pdGl6ZUFycmF5cyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignaW5zZXJ0Jyk7XG5cbi8qKlxuICogKirjgJDpgJLlvZLmj5LlhaXjgJEqKlxuICog5a6e546w5LqGIGA8VmFyaWFibGVJbnNlcnQ+YCDnmoTmoLjlv4PpgLvovpHvvJoqKumdnuegtOWdj+aAp+WcsCoq6YCS5b2S5o+S5YWl5YC844CCXG4gKlxuICogKirmoLjlv4Pop4TliJkqKjpcbiAqIDEuICoq5Y+q5Zyo6Lev5b6E5LiN5a2Y5Zyo5pe25YaZ5YWlKirjgILlpoLmnpzot6/lvoTlt7LlrZjlnKjvvIzliJnot7Pov4for6Xot6/lvoTnmoTlhpnlhaXjgIJcbiAqIDIuICoq5Y6f5a2Q5oCn5o+S5YWlKirjgILlpoLmnpzkuIDkuKrln7rnoYDot6/lvoTvvIjlpoIgYHBsYXllci5pbnZlbnRvcnlg77yJ5LiN5a2Y5Zyo77yM5a6D5Lya5bCG5pW05LiqIGBpbnZlbnRvcnlgXG4gKiAgICDlr7nosaHkvZzkuLrkuIDmlbTkuKrljZXlhYPkuIDmrKHmgKfmj5LlhaXvvIzlubblj6rorrDlvZXkuIDmnaEgYGluc2VydGAg5pel5b+X44CCXG4gKiAzLiAqKumAkuW9kuihpeWFhSoq44CC5aaC5p6c5Z+656GA6Lev5b6E5bey5a2Y5Zyo77yM5a6D5Lya6YCS5b2S5Zyw5rex5YWl77yM5bCd6K+V5Zyo5YW25LiL6KGl5YWF5o+S5YWl5paw55qE5a2Q6Lev5b6E44CCXG4gKiA0LiAqKuaooeadv+aUr+aMgSoq44CC5pSv5oyB5LuOIGAkdGVtcGxhdGVgIOS4ree7p+aJv+aooeadv++8jOWunueOsOaVsOaNrue7k+aehOeahOWkjeeUqOOAglxuICpcbiAqIEBwYXJhbSB7YW55fSBzdGF0RGF0YSAtIOeKtuaAgeaVsOaNruWvueixoSAo5Y2zIGBzdGF0X2RhdGFgKeOAglxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2VQYXRoIC0g5b2T5YmN6YCS5b2S5bGC57qn55qE5Z+656GA6Lev5b6E44CCXG4gKiBAcGFyYW0ge2FueX0gcGF0Y2hPYmogLSDku47mjIfku6TkuK3op6PmnpDlh7rnmoTjgIHopoHlupTnlKjkuo7lvZPliY3lsYLnuqfnmoTooaXkuIHlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TvvIjlvJXnlKjkvKDpgJLvvInjgIJcbiAqIEBwYXJhbSB7YW55fSBpbmhlcml0ZWRDb250ZW50IC0g5LuO5LiK5bGC57un5om/55qE44CB57qv57K555qE5qih5p2/4oCc5YaF5a654oCd5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueX0gcGFyZW50RGF0YSAtIOW9k+WJjeiKgueCueeahOeItuiKgueCueWcqCBgc3RhdERhdGFgIOS4reeahOaVsOaNruOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlJbnNlcnRBdExldmVsKFxuICBzdGF0RGF0YTogYW55LFxuICBiYXNlUGF0aDogc3RyaW5nLFxuICBwYXRjaE9iajogYW55LFxuICBlZGl0TG9nOiBhbnlbXSxcbiAgaW5oZXJpdGVkQ29udGVudDogYW55LFxuICBwYXJlbnREYXRhOiBhbnksIC8vIOaWsOWinuWPguaVsO+8jOebtOaOpeS8oOmAkueItuiKgueCueaVsOaNrlxuKSB7XG4gIC8vIC0tLSAxLiDnoa7lrprlvZPliY3lsYLnuqfnmoTmqKHmnb/lhoXlrrkgLS0tXG4gIC8vIOiwg+eUqCByZXNvbHZlVGVtcGxhdGXvvIzlroPnjrDlnKjnm7TmjqXkvb/nlKjkvKDlhaXnmoQgcGFyZW50RGF0YVxuICBjb25zdCBsb2NhbFRwbENvbnRlbnQgPSByZXNvbHZlVGVtcGxhdGUoaW5oZXJpdGVkQ29udGVudCwgcGFyZW50RGF0YSk7XG4gIGxvZ2dlci5kZWJ1ZygnYXBwbHlJbnNlcnRBdExldmVsJywgYFvlhaXlj6NdIGJhc2VQYXRoOiBcIiR7YmFzZVBhdGggfHwgJ3Jvb3QnfVwiYCwge1xuICAgIHN0YXREYXRhOiBfLmNsb25lRGVlcChzdGF0RGF0YSksXG4gIH0pO1xuXG4gIC8vIC0tLSAyLiDmo4Dmn6Xot6/lvoTlrZjlnKjmgKfvvIzlhrPlrprmiafooYznrZbnlaUgLS0tXG4gIGNvbnN0IGN1cnJlbnROb2RlSW5WYXJzID0gYmFzZVBhdGggPyBfLmdldChzdGF0RGF0YSwgYmFzZVBhdGgpIDogc3RhdERhdGE7XG4gIGxvZ2dlci5kZWJ1ZyhcbiAgICAnYXBwbHlJbnNlcnRBdExldmVsJyxcbiAgICBgW+i3r+W+hOajgOafpV0gYXQgcGF0aDogXCIke2Jhc2VQYXRoIHx8ICdyb290J31cIi4gY3VycmVudE5vZGVJblZhcnMg55qE5YC8OmAsXG4gICAgY3VycmVudE5vZGVJblZhcnMsXG4gICk7XG5cbiAgLy8gKirnrZbnlaXkuIDvvJrljp/lrZDmgKfmj5LlhaUgKEF0b21pYyBJbnNlcnQpKipcbiAgLy8g5aaC5p6c5b2T5YmN6Lev5b6E5Zyo5Y+Y6YeP5Lit5LiN5a2Y5Zyo77yM5YiZ5bCG5pW05Liq6KGl5LiB5a+56LGh5L2c5Li65paw5YC85LiA5qyh5oCn5o+S5YWl44CCXG4gIGlmIChiYXNlUGF0aCAmJiBjdXJyZW50Tm9kZUluVmFycyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8g6LCD55SoIGFwcGx5VGVtcGxhdGVUb1BhdGNoIOWHveaVsO+8jOWwhuWQiOW5tuWQjueahOaooeadv+WGheWuueW6lOeUqOWIsOihpeS4geS4ilxuICAgIGNvbnN0IGNvbXBvc2VkID0gYXBwbHlUZW1wbGF0ZVRvUGF0Y2gobG9jYWxUcGxDb250ZW50LCBwYXRjaE9iaik7XG5cbiAgICBjb25zdCBmaW5hbFZhbHVlID0gc2FuaXRpemVBcnJheXMoY29tcG9zZWQpOyAvLyDmuIXnkIbmlbDnu4TkuK3nmoQgbnVsbCDnrYnml6DmlYjlgLzjgIJcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGDmnIDnu4jmj5LlhaXmlbDmja4gYXQgJHtiYXNlUGF0aH06XFxuJHtKU09OLnN0cmluZ2lmeShmaW5hbFZhbHVlLCBudWxsLCAyKX1gKTtcbiAgICBfLnNldChzdGF0RGF0YSwgYmFzZVBhdGgsIGZpbmFsVmFsdWUpOyAvLyDmiafooYzmj5LlhaXjgIJcbiAgICBlZGl0TG9nLnB1c2goeyBvcDogJ2luc2VydCcsIHBhdGg6IGJhc2VQYXRoLCB2YWx1ZV9uZXc6IF8uY2xvbmVEZWVwKGZpbmFsVmFsdWUpIH0pO1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlJbnNlcnRBdExldmVsJywgYOWOn+WtkOaAp+aPkuWFpeWIsOaWsOi3r+W+hDogJHtiYXNlUGF0aH1gKTtcbiAgICByZXR1cm47IC8vIOaPkuWFpeWujOaIkO+8jOe7iOatoumAkuW9kuOAglxuICB9XG5cbiAgLy8gKirnrZbnlaXkuozvvJrpgJLlvZLooaXlhYUgKFJlY3Vyc2l2ZSBTdXBwbGVtZW50KSoqXG4gIC8vIOWmguaenOW9k+WJjei3r+W+hOW3suWtmOWcqO+8jOW5tuS4lOihpeS4geWSjOW9k+WJjeWAvOmDveaYr+Wvueixoe+8jOWImea3seWFpemAkuW9kuOAglxuICBpZiAoXy5pc1BsYWluT2JqZWN0KGN1cnJlbnROb2RlSW5WYXJzKSAmJiBfLmlzUGxhaW5PYmplY3QocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgICBgW+mAkuW9kuihpeWFhV0gYXQgcGF0aDogXCIke2Jhc2VQYXRoIHx8ICdyb290J31cIlxuICAgICAgLSDlvZPliY3lsYLnuqfmqKHmnb8gKGxvY2FsVHBsQ29udGVudCk6ICR7SlNPTi5zdHJpbmdpZnkobG9jYWxUcGxDb250ZW50KX1gLFxuICAgICk7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMocGF0Y2hPYmopKSB7XG4gICAgICBjb25zdCBzdWJQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIC8vIOiwg+eUqCBnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnTvvIzku47lvZPliY3mqKHmnb/lhoXlrrnkuK3kuLrlrZDoioLngrnmn6Xmib7lhbblupTnu6fmib/nmoTlhoXlrrlcbiAgICAgIGNvbnN0IHN1YkluaGVyaXRlZENvbnRlbnQgPSBnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQobG9jYWxUcGxDb250ZW50LCBrZXkpO1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAnYXBwbHlJbnNlcnRBdExldmVsJyxcbiAgICAgICAgYCAgLSDlh4blpIfpgJLlvZLlrZDoioLngrk6IFwiJHtrZXl9XCJcbiAgICAgIC0g5bCG5Lyg6YCS57uZ5a2Q6IqC54K555qE5qih5p2/IChzdWJJbmhlcml0ZWRDb250ZW50KTogJHtKU09OLnN0cmluZ2lmeShzdWJJbmhlcml0ZWRDb250ZW50KX1gLFxuICAgICAgKTtcbiAgICAgIC8vIOWwhuW9k+WJjeiKgueCueaVsOaNriBjdXJyZW50Tm9kZUluVmFycyDkvZzkuLrkuIvkuIDlsYLnmoQgcGFyZW50RGF0YSDkvKDpgJLkuIvljrtcbiAgICAgIGFwcGx5SW5zZXJ0QXRMZXZlbChzdGF0RGF0YSwgc3ViUGF0aCwgc3ViUGF0Y2gsIGVkaXRMb2csIHN1YkluaGVyaXRlZENvbnRlbnQsIGN1cnJlbnROb2RlSW5WYXJzKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoYmFzZVBhdGgpIHtcbiAgICAvLyAqKuaPkuWFpeWksei0pSoqXG4gICAgLy8g5aaC5p6c6Lev5b6E5bey5a2Y5Zyo77yM5L2G5LiN5piv5Y+v6YCS5b2S6KGl5YWF55qE5a+56LGh57uT5p6E77yI5L6L5aaC77yM5LiA5Liq5piv5a+56LGh77yM5Y+m5LiA5Liq5piv5a2X56ym5Liy77yJ77yMXG4gICAgLy8g5YiZ6K6w5b2V6K2m5ZGK44CCaW5zZXJ0IOS4jeS8muimhuebluW3suWtmOWcqOeahOWAvOOAglxuICAgIGxvZ2dlci53YXJuKCdhcHBseUluc2VydEF0TGV2ZWwnLCBgVmFyaWFibGVJbnNlcnQg5aSx6LSl77ya6Lev5b6E5bey5a2Y5Zyo5LiU5peg5rOV6YCS5b2S6KGl5YWFIC0+ICR7YmFzZVBhdGh9YCk7XG4gIH1cbiAgLy8g5aaC5p6cIGJhc2VQYXRoIOS4uuepuu+8iOWcqOaguee6p+WIq++8ieS4lCBwYXRjaCDkuI3mmK/lr7nosaHvvIzliJnkuI3miafooYzku7vkvZXmk43kvZzvvIzlm6DkuLrmoLnkuI3og73ooqvpnZ7lr7nosaHmm7/mjaLjgIJcbn1cblxuLyoqXG4gKiDlpITnkIbmiYDmnIkgYDxWYXJpYWJsZUluc2VydD5gIOaMh+S7pOWdl+OAglxuICpcbiAqIEBwYXJhbSB7YW55W119IGFsbEluc2VydHMgLSDku47mtojmga/kuK3op6PmnpDlh7rnmoTmiYDmnIkgaW5zZXJ0IOaMh+S7pOWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0luc2VydEJsb2NrcyhhbGxJbnNlcnRzOiBhbnlbXSwgZWRpdExvZzogYW55W10pIHtcbiAgaWYgKGFsbEluc2VydHMubGVuZ3RoID4gMCkge1xuICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKGFzeW5jIHN0YXQgPT4ge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgJ1vliJ3lp4vnirbmgIFdIOi/m+WFpSBwcm9jZXNzSW5zZXJ0QmxvY2tzIOaXtueahCBzdGF0RGF0YTonLCBfLmNsb25lRGVlcChzdGF0KSk7XG4gICAgICByZXR1cm4gc3RhdDtcbiAgICB9KTtcbiAgICAvKlxuICAgICAqIE4uQi4g5b+F6aG75a+55q+P5LiqIGluc2VydFJvb3Qg5Y2V54us6LCD55SoIHVwZGF0ZVZhcmlhYmxlc1dpdGjvvIzogIzkuI3mmK/lsIbmiYDmnInmk43kvZzlkIjlubbliLDkuIDmrKHosIPnlKjkuK3jgIJcbiAgICAgKiDov5nmmK/kuLrkuobnoa7kv53lnKjlkIzkuIDmnaHmtojmga/lhoXvvIzliY3kuIDkuKogPFZhcmlhYmxlSW5zZXJ0PiDlnZfkuK3mj5LlhaXnmoTmqKHmnb/miJbmlbDmja7vvIxcbiAgICAgKiDlj6/ku6XooqvlkI7kuIDkuKogPFZhcmlhYmxlSW5zZXJ0PiDmiJYgPFZhcmlhYmxlRWRpdD4g5Z2X6K6/6Zeu5ZKM5L2/55So44CCXG4gICAgICog5q+P5qyhIGF3YWl0IHVwZGF0ZVZhcmlhYmxlc1dpdGgg5a6M5oiQ5ZCO77yM5Y+Y6YeP54q25oCB6YO95Lya6KKr5Yi35paw77yM5LuO6ICM5L2/5ZCO57ut5pON5L2c6IO955yL5Yiw5pyA5paw55qE57uT5p6c44CCXG4gICAgICovXG4gICAgZm9yIChjb25zdCBpbnNlcnRSb290IG9mIGFsbEluc2VydHMpIHtcbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KGluc2VydFJvb3QpIHx8IF8uaXNFbXB0eShpbnNlcnRSb290KSkgY29udGludWU7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShzdGF0ID0+IHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NJbnNlcnRCbG9ja3MnLCBg5aSE55CGIGluc2VydFJvb3Q6ICR7SlNPTi5zdHJpbmdpZnkoaW5zZXJ0Um9vdCl9YCk7XG4gICAgICAgICAgLy8g5LuO5qC56Lev5b6EICcnIOW8gOWni+e7n+S4gOmAkuW9kuWFpeWPo++8jOmhtuWxguiwg+eUqOaXtu+8jOeItuiKgueCueS4uiBudWxsXG4gICAgICAgICAgYXBwbHlJbnNlcnRBdExldmVsKHN0YXQsICcnLCBpbnNlcnRSb290LCBlZGl0TG9nLCBudWxsLCBudWxsKTtcbiAgICAgICAgICByZXR1cm4gc3RhdDtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgYOWkhOeQhiBpbnNlcnRSb290IOWksei0pTogJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGxvZ2dlci5sb2coJ3Byb2Nlc3NJbnNlcnRCbG9ja3MnLCAn5omA5pyJIFZhcmlhYmxlSW5zZXJ0IOaTjeS9nOWujOaIkCcpO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/insert.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/template.ts": 
  /*!**************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/template.ts ***!
  \**************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyTemplateToPatch: () => (/* binding */ applyTemplateToPatch),\n/* harmony export */   getInheritedTemplateContent: () => (/* binding */ getInheritedTemplateContent),\n/* harmony export */   resolveTemplate: () => (/* binding */ resolveTemplate)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ "./src/ERA变量框架/utils/data.ts");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/log */ "./src/ERA变量框架/utils/log.ts");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger(\'template\');\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nfunction resolveTemplate(inheritedContent, parentNodeData) {\n    // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n    const varsContent = _.get(parentNodeData, \'$template\');\n    logger.debug(\'resolveTemplate\', `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(varsContent)}`);\n    // 2. 按优先级合并 (父节点变量 > 继承)\n    let mergedContent = {};\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, inheritedContent);\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, varsContent);\n    logger.debug(\'resolveTemplate\', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n    if (_.isEmpty(mergedContent)) {\n        return null;\n    }\n    return mergedContent;\n}\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   "$template": { "hp": 10, "mana": 100, "a": { "d": 1 } },\n *   "lili": { "hp": 15, "class": "warrior", "a": { "c": 1 } }\n * };\n * const key = "lili";\n * // 输出 (合并后的内容):\n * // { "hp": 15, "mana": 100, "class": "warrior", "a": { "c": 1, "d": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nfunction getInheritedTemplateContent(parentTplContent, key) {\n    if (!parentTplContent)\n        return undefined;\n    // 步骤 1: 在父级模板内容中查找通用的原型规则\n    const prototypeContent = _.get(parentTplContent, \'$template\');\n    // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n    const specificContent = _.get(parentTplContent, key);\n    // 步骤 3: 根据查找结果决定最终模板内容\n    if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(prototypeContent)}\\n      - 特异性: ${JSON.stringify(specificContent)}`);\n        // 直接使用 mergeReplaceArray 进行合并\n        const merged = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(prototypeContent), specificContent);\n        logger.debug(\'getInheritedTemplateContent\', `  - 合并后: ${JSON.stringify(merged)}`);\n        return merged;\n    }\n    else if (_.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到特异性内容: ${JSON.stringify(specificContent)}`);\n        return specificContent;\n    }\n    else if (_.isPlainObject(prototypeContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到原型内容: ${JSON.stringify(prototypeContent)}`);\n        return prototypeContent;\n    }\n    logger.debug(\'getInheritedTemplateContent\', `在父级模板内容中未为子节点 "${key}" 找到任何可继承的规则。`);\n    return undefined;\n}\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nfunction applyTemplateToPatch(tplContent, patchObj) {\n    logger.debug(\'applyTemplateToPatch\', `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`);\n    if (!_.isPlainObject(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 补丁不是一个普通对象，直接返回。`);\n        return patchObj;\n    }\n    if (!tplContent) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 模板内容无效，直接返回补丁。`);\n        return patchObj;\n    }\n    // 如果补丁是空对象，直接使用模板内容\n    if (_.isEmpty(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `补丁为空对象，完全使用模板内容。`);\n        return _.cloneDeep(tplContent);\n    }\n    // 如果补丁非空，将模板内容作为默认值与补丁合并\n    const composed = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(tplContent), patchObj);\n    logger.debug(\'applyTemplateToPatch\', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n    return composed;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvdGVtcGxhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBYTtBQUUyQztBQUNaO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUV0Qzs7Ozs7Ozs7R0FRRztBQUNJLFNBQVMsZUFBZSxDQUFDLGdCQUFxQixFQUFFLGNBQW1CO0lBQ3hFLG1DQUFtQztJQUNuQyxNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUV2RCxNQUFNLENBQUMsS0FBSyxDQUNWLGlCQUFpQixFQUNqQix3QkFBd0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FDdEYsV0FBVyxDQUNaLEVBQUUsQ0FDSixDQUFDO0lBRUYseUJBQXlCO0lBQ3pCLElBQUksYUFBYSxHQUFRLEVBQUUsQ0FBQztJQUM1QixhQUFhLEdBQUcsOERBQWlCLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDbkUsYUFBYSxHQUFHLDhEQUFpQixDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUU5RCxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLGVBQWUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFaEYsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDN0IsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsT0FBTyxhQUFhLENBQUM7QUFDdkIsQ0FBQztBQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBQ0ksU0FBUywyQkFBMkIsQ0FBQyxnQkFBcUIsRUFBRSxHQUFXO0lBQzVFLElBQUksQ0FBQyxnQkFBZ0I7UUFBRSxPQUFPLFNBQVMsQ0FBQztJQUV4QywwQkFB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QUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLGdCQUFnQixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNqRixPQUFPLFFBQVEsQ0FBQztBQUNsQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9jcnVkL2luc2VydC90ZW1wbGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IG1lcmdlUmVwbGFjZUFycmF5IH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCd0ZW1wbGF0ZScpO1xuXG4vKipcbiAqICoq44CQ6Kej5p6Q5bm25ZCI5bm25qih5p2/5YaF5a6544CRKipcbiAqXG4gKiDku47nu6fmib/nmoTmqKHmnb/lhoXlrrnlkozniLboioLngrnlj5jph4/kuK3lrprkuYnnmoTmqKHmnb/lhoXlrrnkuK3vvIzlkIjlubblh7rlvZPliY3lsYLnuqflj6/nlKjnmoTmqKHmnb/jgIJcbiAqXG4gKiBAcGFyYW0gaW5oZXJpdGVkQ29udGVudCAtIOS7juS4iuS4iuWxgue7p+aJv+eahOaooeadv+WGheWuueOAglxuICogQHBhcmFtIHBhcmVudE5vZGVEYXRhIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE6IqC54K555qEICoq54i26IqC54K5Kiog5Zyo5Y+Y6YeP5Lit55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyB7YW55fSAtIOWQiOW5tuWQjueahOWNleS4gOWGheWuueWvueixoe+8jOWmguaenOaJgOacieadpea6kOmDveaXoOaViO+8jOWImei/lOWbniBgbnVsbGDjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVUZW1wbGF0ZShpbmhlcml0ZWRDb250ZW50OiBhbnksIHBhcmVudE5vZGVEYXRhOiBhbnkpOiBhbnkge1xuICAvLyAxLiDku47niLboioLngrnlj5jph4/kuK3vvIzmib7liLDkvZzkuLrlvZPliY3oioLngrnlhYTlvJ/nmoQgJHRlbXBsYXRlXG4gIGNvbnN0IHZhcnNDb250ZW50ID0gXy5nZXQocGFyZW50Tm9kZURhdGEsICckdGVtcGxhdGUnKTtcblxuICBsb2dnZXIuZGVidWcoXG4gICAgJ3Jlc29sdmVUZW1wbGF0ZScsXG4gICAgYOino+aekOWHuueahOaooeadv+WGheWuuTpcXG4gICAgLSDnu6fmib86ICR7SlNPTi5zdHJpbmdpZnkoaW5oZXJpdGVkQ29udGVudCl9XFxuICAgIC0g54i26IqC54K55Y+Y6YePOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgdmFyc0NvbnRlbnQsXG4gICAgKX1gLFxuICApO1xuXG4gIC8vIDIuIOaMieS8mOWFiOe6p+WQiOW5tiAo54i26IqC54K55Y+Y6YePID4g57un5om/KVxuICBsZXQgbWVyZ2VkQ29udGVudDogYW55ID0ge307XG4gIG1lcmdlZENvbnRlbnQgPSBtZXJnZVJlcGxhY2VBcnJheShtZXJnZWRDb250ZW50LCBpbmhlcml0ZWRDb250ZW50KTtcbiAgbWVyZ2VkQ29udGVudCA9IG1lcmdlUmVwbGFjZUFycmF5KG1lcmdlZENvbnRlbnQsIHZhcnNDb250ZW50KTtcblxuICBsb2dnZXIuZGVidWcoJ3Jlc29sdmVUZW1wbGF0ZScsIGDlkIjlubblkI7nmoTmnIDnu4jmqKHmnb/lhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkobWVyZ2VkQ29udGVudCl9YCk7XG5cbiAgaWYgKF8uaXNFbXB0eShtZXJnZWRDb250ZW50KSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIG1lcmdlZENvbnRlbnQ7XG59XG5cbi8qKlxuICogKirjgJDojrflj5blrZDoioLngrnopoHnu6fmib/nmoTmqKHmnb/lhoXlrrnjgJEqKlxuICpcbiAqIOWcqOS4gOS4que7meWumueahOKAnOeItue6p+aooeadv+WGheWuueKAneS4re+8jOafpeaJvuW5tuWQiOW5tuWFtuWGhemDqOWumuS5ieeahOKAnOWOn+Wei+inhOWImeKAnSAoYCR0ZW1wbGF0ZWApIOWSjOKAnOeJueW8guaAp+inhOWImeKAnSAoYGtleWAp77yMXG4gKiDku6XnlJ/miJDkvpvnibnlrprlrZDoioLngrkgYGtleWAg5L2/55So55qE5pyA57uI5qih5p2/5YaF5a6544CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIOi+k+WFpTpcbiAqIGNvbnN0IHBhcmVudFRwbENvbnRlbnQgPSB7XG4gKiAgIFwiJHRlbXBsYXRlXCI6IHsgXCJocFwiOiAxMCwgXCJtYW5hXCI6IDEwMCwgXCJhXCI6IHsgXCJkXCI6IDEgfSB9LFxuICogICBcImxpbGlcIjogeyBcImhwXCI6IDE1LCBcImNsYXNzXCI6IFwid2FycmlvclwiLCBcImFcIjogeyBcImNcIjogMSB9IH1cbiAqIH07XG4gKiBjb25zdCBrZXkgPSBcImxpbGlcIjtcbiAqIC8vIOi+k+WHuiAo5ZCI5bm25ZCO55qE5YaF5a65KTpcbiAqIC8vIHsgXCJocFwiOiAxNSwgXCJtYW5hXCI6IDEwMCwgXCJjbGFzc1wiOiBcIndhcnJpb3JcIiwgXCJhXCI6IHsgXCJjXCI6IDEsIFwiZFwiOiAxIH0gfVxuICpcbiAqIEBwYXJhbSBwYXJlbnRUcGxDb250ZW50IC0g54i257qn55qE5qih5p2/5YaF5a6577yM5a6D5pys6Lqr5Y+v6IO95YyF5ZCrIGAkdGVtcGxhdGVgIOWSjCBga2V5YCDkvZzkuLrlrZDplK7jgIJcbiAqIEBwYXJhbSBrZXkgLSDmraPlnKjlpITnkIbnmoTlrZDoioLngrnnmoTplK7lkI3jgIJcbiAqIEByZXR1cm5zIHthbnl9IC0g5a2Q6IqC54K55bqU6K+l57un5om/55qE44CB5bey5ZCI5bm255qE5qih5p2/5YaF5a6577yM5oiWIGB1bmRlZmluZWRg44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQocGFyZW50VHBsQ29udGVudDogYW55LCBrZXk6IHN0cmluZyk6IGFueSB7XG4gIGlmICghcGFyZW50VHBsQ29udGVudCkgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAvLyDmraXpqqQgMTog5Zyo54i257qn5qih5p2/5YaF5a655Lit5p+l5om+6YCa55So55qE5Y6f5Z6L6KeE5YiZXG4gIGNvbnN0IHByb3RvdHlwZUNvbnRlbnQgPSBfLmdldChwYXJlbnRUcGxDb250ZW50LCAnJHRlbXBsYXRlJyk7XG5cbiAgLy8g5q2l6aqkIDI6IOWcqOeItue6p+aooeadv+WGheWuueS4reafpeaJvue7mSBrZXkg55qE54m55byC5oCn6KeE5YiZXG4gIGNvbnN0IHNwZWNpZmljQ29udGVudCA9IF8uZ2V0KHBhcmVudFRwbENvbnRlbnQsIGtleSk7XG5cbiAgLy8g5q2l6aqkIDM6IOagueaNruafpeaJvue7k+aenOWGs+WumuacgOe7iOaooeadv+WGheWuuVxuICBpZiAoXy5pc1BsYWluT2JqZWN0KHByb3RvdHlwZUNvbnRlbnQpICYmIF8uaXNQbGFpbk9iamVjdChzcGVjaWZpY0NvbnRlbnQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsXG4gICAgICBg5Li65a2Q6IqC54K5IFwiJHtrZXl9XCIg5ZCM5pe25om+5Yiw5Y6f5Z6L5ZKM54m55byC5oCn5YaF5a6544CCXFxuICAgICAgLSDljp/lnos6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHByb3RvdHlwZUNvbnRlbnQsXG4gICAgICApfVxcbiAgICAgIC0g54m55byC5oCnOiAke0pTT04uc3RyaW5naWZ5KHNwZWNpZmljQ29udGVudCl9YCxcbiAgICApO1xuICAgIC8vIOebtOaOpeS9v+eUqCBtZXJnZVJlcGxhY2VBcnJheSDov5vooYzlkIjlubZcbiAgICBjb25zdCBtZXJnZWQgPSBtZXJnZVJlcGxhY2VBcnJheShfLmNsb25lRGVlcChwcm90b3R5cGVDb250ZW50KSwgc3BlY2lmaWNDb250ZW50KTtcbiAgICBsb2dnZXIuZGVidWcoJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsIGAgIC0g5ZCI5bm25ZCOOiAke0pTT04uc3RyaW5naWZ5KG1lcmdlZCl9YCk7XG4gICAgcmV0dXJuIG1lcmdlZDtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3Qoc3BlY2lmaWNDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWPquaJvuWIsOeJueW8guaAp+WGheWuuTogJHtKU09OLnN0cmluZ2lmeShzcGVjaWZpY0NvbnRlbnQpfWAsXG4gICAgKTtcbiAgICByZXR1cm4gc3BlY2lmaWNDb250ZW50O1xuICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChwcm90b3R5cGVDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWPquaJvuWIsOWOn+Wei+WGheWuuTogJHtKU09OLnN0cmluZ2lmeShwcm90b3R5cGVDb250ZW50KX1gLFxuICAgICk7XG4gICAgcmV0dXJuIHByb3RvdHlwZUNvbnRlbnQ7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsIGDlnKjniLbnuqfmqKHmnb/lhoXlrrnkuK3mnKrkuLrlrZDoioLngrkgXCIke2tleX1cIiDmib7liLDku7vkvZXlj6/nu6fmib/nmoTop4TliJnjgIJgKTtcbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiAqKuOAkOW6lOeUqOaooeadv+WGheWuueWIsOihpeS4geOAkSoqXG4gKlxuICog5bCG5LiA5Liq4oCc5qih5p2/5YaF5a654oCd5a+56LGh5bqU55So5Yiw5LiA5Liq4oCc6KGl5LiB4oCd5a+56LGh5LiK77yM5L2c5Li65YW26buY6K6k5YC844CCXG4gKlxuICogQHBhcmFtIHRwbENvbnRlbnQgLSDlvZPliY3lsYLnuqflkIjlubblkI7nmoTmqKHmnb/lhoXlrrnjgIJcbiAqIEBwYXJhbSBwYXRjaE9iaiAtIOimgeW6lOeUqOaooeadv+eahOihpeS4geaVsOaNruOAglxuICogQHJldHVybnMge2FueX0gLSDlupTnlKjkuobmqKHmnb/pu5jorqTlgLzkuYvlkI7vvIzmnIDnu4jlkIjmiJDnmoTmlbDmja7lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5VGVtcGxhdGVUb1BhdGNoKHRwbENvbnRlbnQ6IGFueSwgcGF0Y2hPYmo6IGFueSk6IGFueSB7XG4gIGxvZ2dlci5kZWJ1ZyhcbiAgICAnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLFxuICAgIGBb6L+b5YWlXSDmqKHmnb/lhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkodHBsQ29udGVudCl9LCDooaXkuIE6ICR7SlNPTi5zdHJpbmdpZnkocGF0Y2hPYmopfWAsXG4gICk7XG5cbiAgaWYgKCFfLmlzUGxhaW5PYmplY3QocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGBb6YCA5Ye6XSDooaXkuIHkuI3mmK/kuIDkuKrmma7pgJrlr7nosaHvvIznm7TmjqXov5Tlm57jgIJgKTtcbiAgICByZXR1cm4gcGF0Y2hPYmo7XG4gIH1cbiAgaWYgKCF0cGxDb250ZW50KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGBb6YCA5Ye6XSDmqKHmnb/lhoXlrrnml6DmlYjvvIznm7TmjqXov5Tlm57ooaXkuIHjgIJgKTtcbiAgICByZXR1cm4gcGF0Y2hPYmo7XG4gIH1cblxuICAvLyDlpoLmnpzooaXkuIHmmK/nqbrlr7nosaHvvIznm7TmjqXkvb/nlKjmqKHmnb/lhoXlrrlcbiAgaWYgKF8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJywgYOihpeS4geS4uuepuuWvueixoe+8jOWujOWFqOS9v+eUqOaooeadv+WGheWuueOAgmApO1xuICAgIHJldHVybiBfLmNsb25lRGVlcCh0cGxDb250ZW50KTtcbiAgfVxuXG4gIC8vIOWmguaenOihpeS4gemdnuepuu+8jOWwhuaooeadv+WGheWuueS9nOS4uum7mOiupOWAvOS4juihpeS4geWQiOW5tlxuICBjb25zdCBjb21wb3NlZCA9IG1lcmdlUmVwbGFjZUFycmF5KF8uY2xvbmVEZWVwKHRwbENvbnRlbnQpLCBwYXRjaE9iaik7XG4gIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBg5ZCI5bm25qih5p2/5LiO6KGl5LiB5ZCO55qE57uT5p6cOiAke0pTT04uc3RyaW5naWZ5KGNvbXBvc2VkKX1gKTtcbiAgcmV0dXJuIGNvbXBvc2VkO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/template.ts\n\n}');
  },
  "./src/ERA变量框架/core/crud/update.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/update.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyEditAtLevel: () => (/* binding */ applyEditAtLevel),\n/* harmony export */   processEditBlocks: () => (/* binding */ processEditBlocks)\n/* harmony export */ });\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('update');\n/**\n * **【递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {Map<string, any>} intraMessageState - 用于跟踪在**同一条消息内部**对同一变量的连续修改。\n */\nasync function applyEditAtLevel(statData, basePath, patchObj, editLog, messageId, intraMessageState) {\n    // --- 1. 路径和存在性检查 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    // --- 2. 权限检查 (`updatable`) ---\n    // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n    const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n    // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n    const isBypassingProtection = isUpdatable === false && // 当前是受保护的\n        _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n    // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n    if (isUpdatable === false && !isBypassingProtection) {\n        logger.warn('applyEditAtLevel', `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`);\n        return; // 终止此分支的递归。\n    }\n    // --- 3. 递归或执行 ---\n    // 遍历指令的键，以驱动递归。\n    for (const key of Object.keys(patchObj)) {\n        const subPath = basePath ? `${basePath}.${key}` : key;\n        const valNew = patchObj[key];\n        // **策略一：递归深入**\n        // 如果指令的值是对象，则继续向内递归。\n        if (_.isPlainObject(valNew)) {\n            await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, intraMessageState);\n            continue; // 继续处理下一个键。\n        }\n        // **策略二：执行更新 (叶子节点)**\n        // 只有当指令的值不是对象时，才执行更新操作。\n        // 路径合法性检查：确保要写入的完整路径是存在的。\n        if (!_.has(statData, subPath)) {\n            logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`);\n            continue;\n        }\n        // a. 查找旧值 (`valOld`)\n        // 这是确保回滚准确性的核心。\n        logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n        let valOld = await (0,_rollback__WEBPACK_IMPORTED_MODULE_0__.findLatestNewValue)(subPath, messageId, logger);\n        if (valOld === null) {\n            valOld = _.get(statData, subPath);\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`);\n        }\n        else {\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n        }\n        const cleaned = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(valNew); // 清理新值\n        // b. 记录编辑意图\n        // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n        // 这对于调试和历史追溯非常有用。\n        _.set(statData, subPath, cleaned);\n        editLog.push({\n            op: 'update',\n            path: subPath,\n            value_old: _.cloneDeep(valOld),\n            value_new: _.cloneDeep(cleaned),\n        });\n        // c. 更新楼内状态 Map，以便同一消息内的后续操作能正确追溯到这个新值。\n        intraMessageState.set(subPath, _.cloneDeep(cleaned));\n    }\n}\n/**\n * 处理所有 `<VariableEdit>` 指令块。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n */\nasync function processEditBlocks(allEdits, editLog, messageId) {\n    if (allEdits.length > 0) {\n        const intraMessageState = new Map(); // 用于跟踪在**本消息内部**对变量的连续修改。\n        // N.B. 同样，编辑操作也需要独立调用以确保能读取到同一消息中、此前已完成的插入或编辑操作的结果。\n        for (const editRoot of allEdits) {\n            if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n                    logger.debug('processEditBlocks', `处理 editRoot: ${JSON.stringify(editRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n                    await applyEditAtLevel(stat, '', editRoot, editLog, messageId, intraMessageState);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processEditBlocks', '所有 VariableEdit 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC91cGRhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFDVTtBQUVvQztBQUNRO0FBQ1A7QUFDVDtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFcEM7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBQ0ksS0FBSyxVQUFVLGdCQUFnQixDQUNwQyxRQUFhLEVBQ2IsUUFBZ0IsRUFDaEIsUUFBYSxFQUNiLE9BQWMsRUFDZCxTQUFpQixFQUNqQixpQkFBbUM7SUFFbkMsc0JBQXNCO0lBQ3RCLE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQzFFLElBQUksaUJBQWlCLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSw0QkFBNEIsUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDcEYsT0FBTztJQUNULENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsMENBQTBDO0lBQzFDLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFM0Usc0RBQXNEO0lBQ3RELE1BQU0scUJBQXFCLEdBQ3pCLFdBQVcsS0FBSyxLQUFLLElBQUksVUFBVTtRQUNuQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLHFCQUFxQjtJQUV6RSw0QkFBNEI7SUFDNUIsSUFBSSxXQUFXLEtBQUssS0FBSyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNwRCxNQUFNLENBQUMsSUFBSSxDQUNULGtCQUFrQixFQUNsQix1QkFBdUIsUUFBUSx3Q0FBd0MsQ0FDeEUsQ0FBQztRQUNGLE9BQU8sQ0FBQyxZQUFZO0lBQ3RCLENBQUM7SUFFRCxtQkFBbUI7SUFDbkIsZ0JBQWdCO0lBQ2hCLEtBQUssTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1FBQ3hDLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUN0RCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFN0IsZUFBZTtRQUNmLHFCQUFxQjtRQUNyQixJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUM1QixNQUFNLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUN6RixTQUFTLENBQUMsWUFBWTtRQUN4QixDQUFDO1FBRUQsc0JBQXNCO1FBQ3RCLHdCQUF3QjtRQUV4QiwwQkFBMEI7UUFDMUIsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxnQ0FBZ0MsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUMzRSxTQUFTO1FBQ1gsQ0FBQztRQUVELHFCQUFxQjtRQUNyQixnQkFBZ0I7UUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxpQkFBaUIsT0FBTyxhQUFhLFNBQVMsV0FBVyxDQUFDLENBQUM7UUFDNUYsSUFBSSxNQUFNLEdBQUcsTUFBTSw2REFBa0IsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xFLElBQUksTUFBTSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ3BCLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsS0FBSyxDQUNWLGtCQUFrQixFQUNsQix5Q0FBeUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUNsRSxDQUFDO1FBQ0osQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUFFLHVCQUF1QixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwRixDQUFDO1FBRUQsTUFBTSxPQUFPLEdBQUcsMkRBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU87UUFFL0MsWUFBWTtRQUNaLG9DQUFvQztRQUNwQyxrQkFBa0I7UUFDbEIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2xDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDWCxFQUFFLEVBQUUsUUFBUTtZQUNaLElBQUksRUFBRSxPQUFPO1lBQ2IsU0FBUyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO1lBQzlCLFNBQVMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztTQUNoQyxDQUFDLENBQUM7UUFDSCx3Q0FBd0M7UUFDeEMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQztBQUNILENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSSxLQUFLLFVBQVUsaUJBQWlCLENBQUMsUUFBZSxFQUFFLE9BQWMsRUFBRSxTQUFpQjtJQUN4RixJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDeEIsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsRUFBZSxDQUFDLENBQUMsMEJBQTBCO1FBQzVFLG9EQUFvRDtRQUNwRCxLQUFLLE1BQU0sUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ2hDLElBQUksQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO2dCQUFFLFNBQVM7WUFDaEUsSUFBSSxDQUFDO2dCQUNILE1BQU0sa0VBQWlCLENBQUMsS0FBSyxFQUFDLElBQUksRUFBQyxFQUFFO29CQUNuQyxNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLGdCQUFnQixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDOUUsNEJBQTRCO29CQUM1QixNQUFNLGdCQUFnQixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztvQkFDbEYsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3RSxDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUMxRCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC91cGRhdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Y+Y6YeP57yW6L6R5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+i0n+i0o+WkhOeQhiBgPFZhcmlhYmxlRWRpdD5gIOaMh+S7pO+8jOWunueOsOWvueW3suWtmOWcqOWPmOmHj+eahOS/ruaUue+8jOW5tueUn+aIkOeUqOS6juWbnua7mueahOeyvuehriBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuiBjOi0o+WNleS4gCoqOiDmqKHlnZflj6rlhbPlv4PlpoLkvZXmoLnmja7mjIfku6Tkv67mlLnlj5jph4/nirbmgIHlubbnlJ/miJDml6Xlv5fvvIzkuI3lhbPlv4PmjIfku6Tku47kvZXogIzmnaXjgIJcbiAqIC0gKirnsr7noa7ml6Xlv5cqKjogYEVkaXRMb2dgIOeahOWHhuehruaAp+aYr+Wbnua7muWKn+iDveeahOWfuuehgOOAgmBhcHBseUVkaXRBdExldmVsYCDpgJrov4fnsr7lt6fnmoTpgLvovpHvvIxcbiAqICAg54m55Yir5piv5a+54oCc5pen5YC84oCd55qE5Y6G5Y+y6L+95rqv77yM56Gu5L+d5LqG5pel5b+X55qE57ud5a+55Y+v6Z2g44CCXG4gKiAtICoq5a656ZSZ5oCnKio6IOW9k+mBh+WIsOaXoOaViOi3r+W+hO+8iOWmguWwneivlee8lui+keS4jeWtmOWcqOeahOi3r+W+hO+8ieaXtu+8jOS8mui3s+i/h+ivpeadoeaMh+S7pOW5tue7p+e7reWkhOeQhuWFtuS7luacieaViOaMh+S7pO+8jFxuICogICDogIzkuI3mmK/kuK3mlq3mlbTkuKrlhpnlhaXov4fnqIvjgIJcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBmaW5kTGF0ZXN0TmV3VmFsdWUgfSBmcm9tICcuLi9yb2xsYmFjayc7XG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHNhbml0aXplQXJyYXlzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCd1cGRhdGUnKTtcblxuLyoqXG4gKiAqKuOAkOmAkuW9kue8lui+keOAkSoqXG4gKiDlrp7njrDkuoYgYDxWYXJpYWJsZUVkaXQ+YCDnmoTmoLjlv4PpgLvovpHvvJoqKuWPquS/ruaUueW3suWtmOWcqOeahOi3r+W+hCoq44CCXG4gKlxuICogKirmoLjlv4Pop4TliJkqKjpcbiAqIDEuICoq6Lev5b6E5b+F6aG75a2Y5ZyoKirjgILlpoLmnpzmjIfku6TkuK3mjIflrprnmoTot6/lvoTlnKjlvZPliY3lj5jph4/nirbmgIHkuK3kuI3lrZjlnKjvvIzliJnot7Pov4for6Xmk43kvZzjgIJcbiAqIDIuICoq5Y+25a2Q6IqC54K55pON5L2cKirjgILlj6rlnKjpgYfliLDmjIfku6Tlr7nosaHkuK3nmoTlj7blrZDoioLngrnvvIjpnZ7lr7nosaHlgLzvvInml7bmiY3miafooYzlrp7pmYXnmoTkv67mlLnlkozml6Xlv5forrDlvZXjgIJcbiAqIDMuICoq57K+56Gu55qE5pen5YC85p+l5om+KirjgILkuLrkuobnlJ/miJDlj6/kvpvlm57mu5rnmoQgYEVkaXRMb2dg77yM5a6D6ZyA6KaB5om+5Yiw5Y+Y6YeP5Zyo5pys5qyh5L+u5pS55Y+R55SfKirkuYvliY0qKueahOKAnOaXp+WAvOKAneOAglxuICogICAg5p+l5om+6aG65bqP5Li677ya6aaW5YWI6YCa6L+HIGBmaW5kTGF0ZXN0TmV3VmFsdWVgIOWcqOWOhuWPsiBgRWRpdExvZ2Ag5Lit5Zue5rqv77yb5aaC5p6c5om+5LiN5Yiw77yMXG4gKiAgICDliJnku47lvZPliY3mtojmga/lpITnkIblvIDlp4vml7bnmoTlj5jph4/lv6vnhafkuK3ojrflj5bjgILov5nmmK/noa7kv53ml6Xlv5flh4bnoa7mgKfnmoTlhbPplK7jgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g6KaB5bqU55So55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE44CCXG4gKiBAcGFyYW0ge251bWJlcn0gbWVzc2FnZUlkIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE5raI5oGv55qEIElE77yM55So5LqO5Y6G5Y+y6L+95rqv44CCXG4gKiBAcGFyYW0ge01hcDxzdHJpbmcsIGFueT59IGludHJhTWVzc2FnZVN0YXRlIC0g55So5LqO6Lef6Liq5ZyoKirlkIzkuIDmnaHmtojmga/lhoXpg6gqKuWvueWQjOS4gOWPmOmHj+eahOi/nue7reS/ruaUueOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlFZGl0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIG1lc3NhZ2VJZDogbnVtYmVyLFxuICBpbnRyYU1lc3NhZ2VTdGF0ZTogTWFwPHN0cmluZywgYW55Pixcbikge1xuICAvLyAtLS0gMS4g6Lev5b6E5ZKM5a2Y5Zyo5oCn5qOA5p+lIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseUVkaXRBdExldmVsJywgYFZhcmlhYmxlRWRpdCDot7Pov4fvvJrot6/lvoTkuI3lrZjlnKggLT4gJHtiYXNlUGF0aCB8fCAnKHJvb3QpJ31gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAtLS0gMi4g5p2D6ZmQ5qOA5p+lIChgdXBkYXRhYmxlYCkgLS0tXG4gIC8vIOivu+WPliB1cGRhdGFibGUg5qCH5b+X77yM5aaC5p6c5pyq5a6a5LmJ77yM5YiZ6buY6K6k5Li6IHRydWUgKOWFgeiuuOabtOaWsCnjgIJcbiAgY29uc3QgaXNVcGRhdGFibGUgPSBfLmdldChjdXJyZW50Tm9kZUluVmFycywgWyckbWV0YScsICd1cGRhdGFibGUnXSwgdHJ1ZSk7XG5cbiAgLy8g5a6a5LmJ6LGB5YWN5p2h5Lu277ya5Y+q5pyJ5b2T5oyH5Luk5piO56Gu6KaB5bCGIHVwZGF0YWJsZSDku44gZmFsc2Ug5pS55Li6IHRydWUg5pe277yM5omN5YWB6K645pON5L2c44CCXG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgaXNVcGRhdGFibGUgPT09IGZhbHNlICYmIC8vIOW9k+WJjeaYr+WPl+S/neaKpOeahFxuICAgIF8uZ2V0KHBhdGNoT2JqLCBbJyRtZXRhJywgJ3VwZGF0YWJsZSddKSA9PT0gdHJ1ZTsgLy8g5LiU5oyH5Luk5oSP5Zu+5piv5piO56Gu5Zyw5bCG5YW25pS55Li6IHRydWVcblxuICAvLyDlpoLmnpzlj5fkv53miqTkuJTkuI3mu6HotrPosYHlhY3mnaHku7bvvIzliJnpmLvmraLmlbTkuKrlrZDmoJHnmoTmm7TmlrDjgIJcbiAgaWYgKGlzVXBkYXRhYmxlID09PSBmYWxzZSAmJiAhaXNCeXBhc3NpbmdQcm90ZWN0aW9uKSB7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hCA8JHtiYXNlUGF0aH0+IOWPlyBcIiRtZXRhLnVwZGF0YWJsZTogZmFsc2VcIiDkv53miqTvvIzml6Dms5Xooqvkv67mlLnjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuOyAvLyDnu4jmraLmraTliIbmlK/nmoTpgJLlvZLjgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDpgJLlvZLmiJbmiafooYwgLS0tXG4gIC8vIOmBjeWOhuaMh+S7pOeahOmUru+8jOS7pempseWKqOmAkuW9kuOAglxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICBjb25zdCBzdWJQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICBjb25zdCB2YWxOZXcgPSBwYXRjaE9ialtrZXldO1xuXG4gICAgLy8gKirnrZbnlaXkuIDvvJrpgJLlvZLmt7HlhaUqKlxuICAgIC8vIOWmguaenOaMh+S7pOeahOWAvOaYr+Wvueixoe+8jOWImee7p+e7reWQkeWGhemAkuW9kuOAglxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QodmFsTmV3KSkge1xuICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0RGF0YSwgc3ViUGF0aCwgdmFsTmV3LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDnu6fnu63lpITnkIbkuIvkuIDkuKrplK7jgIJcbiAgICB9XG5cbiAgICAvLyAqKuetlueVpeS6jO+8muaJp+ihjOabtOaWsCAo5Y+25a2Q6IqC54K5KSoqXG4gICAgLy8g5Y+q5pyJ5b2T5oyH5Luk55qE5YC85LiN5piv5a+56LGh5pe277yM5omN5omn6KGM5pu05paw5pON5L2c44CCXG5cbiAgICAvLyDot6/lvoTlkIjms5XmgKfmo4Dmn6XvvJrnoa7kv53opoHlhpnlhaXnmoTlrozmlbTot6/lvoTmmK/lrZjlnKjnmoTjgIJcbiAgICBpZiAoIV8uaGFzKHN0YXREYXRhLCBzdWJQYXRoKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hOmdnuazle+8jOaXoOazleWGmeWFpSAtPiAke3N1YlBhdGh9YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBhLiDmn6Xmib7ml6flgLwgKGB2YWxPbGRgKVxuICAgIC8vIOi/meaYr+ehruS/neWbnua7muWHhuehruaAp+eahOaguOW/g+OAglxuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDlh4blpIfkuLrot6/lvoQgPCR7c3ViUGF0aH0+IOS7jua2iOaBryBJRCA8JHttZXNzYWdlSWR9PiDlkJHkuIrov73muq8uLi5gKTtcbiAgICBsZXQgdmFsT2xkID0gYXdhaXQgZmluZExhdGVzdE5ld1ZhbHVlKHN1YlBhdGgsIG1lc3NhZ2VJZCwgbG9nZ2VyKTtcbiAgICBpZiAodmFsT2xkID09PSBudWxsKSB7XG4gICAgICB2YWxPbGQgPSBfLmdldChzdGF0RGF0YSwgc3ViUGF0aCk7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdhcHBseUVkaXRBdExldmVsJyxcbiAgICAgICAgYFvml6flgLzmn6Xmib5dIOi/vea6r+acquaJvuWIsOWOhuWPsuWAvO+8jOS7juW9k+WJjSBzdGF0X2RhdGEg5Lit6I635Y+W5Yiw5pen5YC8OiAke0pTT04uc3RyaW5naWZ5KHZhbE9sZCl9YCxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDov73muq/miJDlip/vvIzmib7liLDljoblj7Lml6flgLw6ICR7SlNPTi5zdHJpbmdpZnkodmFsT2xkKX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGVhbmVkID0gc2FuaXRpemVBcnJheXModmFsTmV3KTsgLy8g5riF55CG5paw5YC8XG5cbiAgICAvLyBiLiDorrDlvZXnvJbovpHmhI/lm75cbiAgICAvLyDljbPkvb/mlrDml6flgLznm7jlkIzvvIzkuZ/orrDlvZUgRWRpdExvZ++8jOS7peWujOaVtOWPjeaYoOS9nOiAheeahOe8lui+keaEj+WbvuOAglxuICAgIC8vIOi/meWvueS6juiwg+ivleWSjOWOhuWPsui/vea6r+mdnuW4uOacieeUqOOAglxuICAgIF8uc2V0KHN0YXREYXRhLCBzdWJQYXRoLCBjbGVhbmVkKTtcbiAgICBlZGl0TG9nLnB1c2goe1xuICAgICAgb3A6ICd1cGRhdGUnLFxuICAgICAgcGF0aDogc3ViUGF0aCxcbiAgICAgIHZhbHVlX29sZDogXy5jbG9uZURlZXAodmFsT2xkKSxcbiAgICAgIHZhbHVlX25ldzogXy5jbG9uZURlZXAoY2xlYW5lZCksXG4gICAgfSk7XG4gICAgLy8gYy4g5pu05paw5qW85YaF54q25oCBIE1hcO+8jOS7peS+v+WQjOS4gOa2iOaBr+WGheeahOWQjue7reaTjeS9nOiDveato+ehrui/vea6r+WIsOi/meS4quaWsOWAvOOAglxuICAgIGludHJhTWVzc2FnZVN0YXRlLnNldChzdWJQYXRoLCBfLmNsb25lRGVlcChjbGVhbmVkKSk7XG4gIH1cbn1cblxuLyoqXG4gKiDlpITnkIbmiYDmnIkgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxFZGl0cyAtIOS7jua2iOaBr+S4reino+aekOWHuueahOaJgOaciSBlZGl0IOaMh+S7pOWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IG1lc3NhZ2VJZCAtIOW9k+WJjeato+WcqOWkhOeQhueahOa2iOaBr+eahCBJROOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHM6IGFueVtdLCBlZGl0TG9nOiBhbnlbXSwgbWVzc2FnZUlkOiBudW1iZXIpIHtcbiAgaWYgKGFsbEVkaXRzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBpbnRyYU1lc3NhZ2VTdGF0ZSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7IC8vIOeUqOS6jui3n+i4quWcqCoq5pys5raI5oGv5YaF6YOoKirlr7nlj5jph4/nmoTov57nu63kv67mlLnjgIJcbiAgICAvLyBOLkIuIOWQjOagt++8jOe8lui+keaTjeS9nOS5n+mcgOimgeeLrOeri+iwg+eUqOS7peehruS/neiDveivu+WPluWIsOWQjOS4gOa2iOaBr+S4reOAgeatpOWJjeW3suWujOaIkOeahOaPkuWFpeaIlue8lui+keaTjeS9nOeahOe7k+aenOOAglxuICAgIGZvciAoY29uc3QgZWRpdFJvb3Qgb2YgYWxsRWRpdHMpIHtcbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KGVkaXRSb290KSB8fCBfLmlzRW1wdHkoZWRpdFJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKGFzeW5jIHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0VkaXRCbG9ja3MnLCBg5aSE55CGIGVkaXRSb290OiAke0pTT04uc3RyaW5naWZ5KGVkaXRSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoQgJycg5byA5aeL57uf5LiA6YCS5b2S5YWl5Y+j77yM5L+d5oyB6YC76L6R5LiA6Ie05oCn44CCXG4gICAgICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0LCAnJywgZWRpdFJvb3QsIGVkaXRMb2csIG1lc3NhZ2VJZCwgaW50cmFNZXNzYWdlU3RhdGUpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NFZGl0QmxvY2tzJywgYOWkhOeQhiBlZGl0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzRWRpdEJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVFZGl0IOaTjeS9nOWujOaIkCcpO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/update.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/variable_change_processor.ts": 
  /*!************************************************************!*\
  !*** ./src/ERA变量框架/core/crud/variable_change_processor.ts ***!
  \************************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApplyVarChange: () => (/* binding */ ApplyVarChange),\n/* harmony export */   ApplyVarChangeForMessage: () => (/* binding */ ApplyVarChangeForMessage)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./delete */ \"./src/ERA变量框架/core/crud/delete.ts\");\n/* harmony import */ var _insert_insert__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./insert/insert */ \"./src/ERA变量框架/core/crud/insert/insert.ts\");\n/* harmony import */ var _core_key_message_key__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/key/message_key */ \"./src/ERA变量框架/core/key/message_key.ts\");\n/* harmony import */ var _utils_message_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/message_utils */ \"./src/ERA变量框架/utils/message_utils.ts\");\n/* harmony import */ var _update__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./update */ \"./src/ERA变量框架/core/crud/update.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_9__.Logger('variable_change_processor');\n/**\n * **【核心实现】** 对指定的消息应用变量修改。\n * 这是变量写入流程的核心，处理单个消息。\n *\n * @param {TavernMessage} msg - 要处理的酒馆消息对象。\n * @returns {Promise<string | null>} 如果成功处理，返回该消息的 MK；如果消息无需处理或处理失败，返回 null。\n */\nconst ApplyVarChangeForMessage = async (msg) => {\n    logger.debug('ApplyVarChangeForMessage', `开始处理消息...`, { msg });\n    try {\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ApplyVarChangeForMessage', '无效消息对象或缺少 message_id，退出');\n            return null;\n        }\n        const messageId = msg.message_id;\n        // 写入函数只负责读取 MK，不负责创建。创建的职责由上游的 `ensureMessageKey` 承担。\n        const MK = (0,_core_key_message_key__WEBPACK_IMPORTED_MODULE_3__.readMessageKey)(msg);\n        // 如果消息没有 MK（可能是一个异常状态，如新消息还未被注入 MK），则跳过。\n        if (!MK) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 不含 MK，跳过变量写入。`);\n            return null;\n        }\n        // 根据设计，用户消息自身不应包含变量修改指令，因此跳过变量处理，但返回其已有的 MK。\n        if ((0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_4__.isUserMessage)(msg)) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 为用户消息，跳过变量写入，但保留其 MK。`);\n            return MK;\n        }\n        const rawContent = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(msg) || '';\n        // 1. 从消息内容中解析出所有指令块。\n        const insertBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableInsert');\n        const editBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableEdit');\n        const deleteBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableDelete');\n        if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 未检测到变量修改标签。`);\n        }\n        const rawInserts = insertBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        const rawEdits = editBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        const rawDeletes = deleteBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n        const allInserts = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawInserts);\n        const allEdits = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawEdits);\n        const allDeletes = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawDeletes);\n        logger.debug('ApplyVarChangeForMessage', '数据转义完成', {\n            before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n            after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n        });\n        const editLog = []; // 用于收集本轮操作产生的所有变更记录。\n        // 2. --- 处理所有插入操作 (`<VariableInsert>`) ---\n        await (0,_insert_insert__WEBPACK_IMPORTED_MODULE_2__.processInsertBlocks)(allInserts, editLog);\n        // 3. --- 处理所有编辑操作 (`<VariableEdit>`) ---\n        await (0,_update__WEBPACK_IMPORTED_MODULE_5__.processEditBlocks)(allEdits, editLog, messageId);\n        // 4. --- 处理所有删除操作 (`<VariableDelete>`) ---\n        await (0,_delete__WEBPACK_IMPORTED_MODULE_1__.processDeleteBlocks)(allDeletes, editLog);\n        // 5. --- 覆盖式写入 EditLog ---\n        /*\n         * 核心逻辑：无论本轮是否产生了有效的变量修改，都必须用当前的 editLog (哪怕是空数组) 覆盖旧的 EditLog。\n         *\n         * 为什么必须覆盖而不是在没有修改时跳过？\n         *\n         * 根本原因在于，必须确保每个 MK 对应的 EditLog，严格且唯一地反映其所属消息**当前内容**所产生的变量修改。\n         *\n         * 考虑一个场景：\n         * 1. 消息A (MK_A) 的内容包含指令，生成了 EditLog_A。\n         * 2. 用户对消息A进行 swipe，生成了消息B (MK_B)，其内容完全没有变量修改标签。\n         *\n         * 如果在处理消息B时，因为没有检测到指令就“跳过写入”，那么与 MK_B 关联的 EditLog 就会是空的或不存在的。\n         * 这在当前是正确的。\n         *\n         * 但如果用户再次 swipe，从消息B切换回消息A。此时框架会重新处理消息A。\n         * 如果我们不执行覆盖式写入，那么与 MK_A 关联的 EditLog 仍然是之前生成的 EditLog_A，这没有问题。\n         *\n         * 真正的问题在于状态的明确性。覆盖式写入确保了任何一个 MK 的日志，在任何时间点，\n         * 都是其**当前可见内容**的直接产物，没有任何历史遗留。这使得整个系统的状态变迁变得清晰、可预测，\n         * 极大地降低了在复杂操作（如多次 `swipe`、删除、编辑）中出现状态不一致的风险。\n         *\n         * 因此，正确的做法是：用本次解析消息内容生成的 editLog (在无指令的场景下是 `[]`) 去覆盖，\n         * 从而斩断任何可能存在的历史关联，确保数据的一致性和纯粹性。\n         */\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n                const newArr = Array.isArray(editLog) ? editLog : (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseEditLog)(editLog);\n                logger.debug('ApplyVarChangeForMessage', `准备为 MK=${MK} (MsgID=${messageId}) 写入 EditLog:\\n${JSON.stringify(newArr, null, 2)}`);\n                // 将本轮生成的日志数组，以当前消息的 MK 为键，存入 `EditLogs` 对象。\n                _.set(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK], JSON.stringify(newArr));\n                /*\n                 * N.B. 此函数不再负责更新 SelectedMks 数组。\n                 * 更新 SelectedMks 的职责已移交至上层调用者 (resyncStateOnHistoryChange 或 ApplyVarChange)，\n                 * 以避免在 resync 循环中意外修改正在被读取的 oldSelectedMks 状态。\n                 */\n                return meta;\n            });\n            logger.debug('ApplyVarChangeForMessage', `成功为 MK=${MK} 写入 EditLog。`);\n        }\n        catch (e) {\n            logger.error('ApplyVarChangeForMessage', `为 MK=${MK} 写入 EditLogs 失败: ${e?.message || e}`, e);\n        }\n        return MK;\n    }\n    catch (err) {\n        logger.error('ApplyVarChangeForMessage', `变量写入器异常: ${err?.message || err}`, err);\n        return null;\n    }\n};\n/**\n * **【标准事件处理入口】**\n * 这是一个上层封装，用于处理最新 AI 消息的变量写入，并负责更新 `SelectedMks` 数组。\n * 它会自动寻找最后一条 AI 消息进行操作，通常被绑定到“新消息生成”等事件上。\n */\nconst ApplyVarChange = async () => {\n    logger.debug('ApplyVarChange', `函数被调用...`);\n    // 1. 智能查找最后一条 AI 消息\n    const msg = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_4__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.log('ApplyVarChange', '未找到可处理的 AI 消息，退出。');\n        return;\n    }\n    const messageId = msg.message_id;\n    logger.log('ApplyVarChange', `找到目标 AI 消息 (ID: ${messageId})，开始处理变量写入...`);\n    // 2. 调用核心实现来处理变量和 EditLog 的写入。\n    // EditLog 会被自动关联到从该消息中读取到的 MK 上。\n    const MK = await ApplyVarChangeForMessage(msg);\n    // 3. 在核心流程执行完毕后，在此处统一更新 SelectedMks，确保状态一致。\n    try {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n            const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n            // 关键：必须使用我们正在处理的 AI 消息的 messageId 作为索引，\n            // 来更新 SelectedMks 数组中对应的 MK 记录。\n            selectedMks[messageId] = MK;\n            _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n            return meta;\n        });\n    }\n    catch (e) {\n        logger.error('ApplyVarChange', `更新 SelectedMks 失败: ${e?.message || e}`, e);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC92YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBRVU7QUFFK0M7QUFDYjtBQUNPO0FBQ007QUFDb0M7QUFDbkQ7QUFDWTtBQUNOO0FBQ3dCO0FBQ2xDO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBRXZEOzs7Ozs7R0FNRztBQUNJLE1BQU0sd0JBQXdCLEdBQUcsS0FBSyxFQUFFLEdBQVEsRUFBMEIsRUFBRTtJQUNqRixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1lBQ25FLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7UUFDakMsc0RBQXNEO1FBQ3RELE1BQU0sRUFBRSxHQUFHLHFFQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFL0IseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNSLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLGlCQUFpQixDQUFDLENBQUM7WUFDaEYsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksbUVBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLHlC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QztJQUNqQyxNQUFNLEVBQUUsR0FBRyxNQUFNLHdCQUF3QixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRS9DLDRDQUE0QztJQUM1QyxJQUFJLENBQUM7UUFDSCxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzdCLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDOUMsd0NBQXdDO1lBQ3hDLGdDQUFnQztZQUNoQyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzVCLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDbkMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO1FBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsc0JBQXNCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQztBQUNILENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC92YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+WGmeWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmmK8gRVJBIOahhuaetueahOKAnOaJp+ihjOW8leaTjuKAne+8jOi0n+i0o+Wwhua2iOaBr+WGheWuueS4reeahOWPmOmHj+S/ruaUueaMh+S7pOW6lOeUqOWIsOWunumZheeahCBgY2hhdGAg5Y+Y6YeP5Lit44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIOWPmOmHj+eahOWGmeWFpeaYr+S4gOS4quS4peiwqOeahOi/h+eoi++8jOW/hemhu+ehruS/neaJgOacieWPmOabtOmDveiiq+ato+ehruiusOW9le+8jOS7peS+v+WQjue7reeahOWbnua7muWSjOWQjOatpeOAglxuICog5q2k5qih5Z2X55qE5qC45b+D6IGM6LSj5piv77yaXG4gKiAxLiAqKuino+aekOaMh+S7pCoqOiDku44gQUkg5raI5oGv5Lit5o+Q5Y+WIGA8VmFyaWFibGVJbnNlcnQ+YCDlkowgYDxWYXJpYWJsZUVkaXQ+YCDlnZfjgIJcbiAqIDIuICoq6aG65bqP5omn6KGMKio6IOehruS/neWQjOS4gOa2iOaBr+WGheeahOWkmuS4quaMh+S7pOWdl+aMiemhuuW6j+aJp+ihjO+8jOS4lOWQjue7reaMh+S7pOiDveaEn+efpeWIsOWJjemdouaMh+S7pOeahOe7k+aenOOAglxuICogMy4gKirnlJ/miJDml6Xlv5cqKjog5Zyo5bqU55So5Y+Y5pu055qE5ZCM5pe277yM6LCD55SoIGByZWN1cnNpdmUudHNgIOS4reeahOmAkuW9kuWHveaVsOadpeeUn+aIkOeyvuehrueahCBgRWRpdExvZ2DjgIJcbiAqIDQuICoq6KaG55uW5byP5pel5b+X5YaZ5YWlKio6IOehruS/neavj+S4qua2iOaBr+WvhumSpe+8iE1L77yJ5a+55bqU55qEIGBFZGl0TG9nYCDkuKXmoLzlj43mmKDlhbblvZPliY3lhoXlrrnvvIxcbiAqICAgIOWNs+S9v+WGheWuueS4reayoeacieS7u+S9leaMh+S7pO+8iOatpOaXtuS8muWGmeWFpeepuuaXpeW/l++8ie+8jOS5n+imgeimhuebluaXp+aXpeW/l++8jOi/meaYr+mYsuatoiBgc3dpcGVgIOmAoOaIkOaVsOaNruaxoeafk+eahOWFs+mUruOAglxuICpcbiAqICoq6IGM6LSj6L6555WMKio6XG4gKiAtIOacrOaooeWdlyoq5Y+q6LSf6LSj6K+75Y+WIE1LKirvvIzkuI3otJ/otKPliJvlu7rjgILliJvlu7ogTUsg55qE6IGM6LSj55Sx5LiK5ri455qEIGBtZXNzYWdlX2tleS50c2Ag5om/5ouF44CCXG4gKiAtIGBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2VgIOWHveaVsCoq5Y+q6LSf6LSj5YaZ5YWl5Y+Y6YeP5ZKMIGBFZGl0TG9nYCoq77yM5LiN6LSf6LSj5pu05pawIGBTZWxlY3RlZE1rc2DjgIJcbiAqICAg5pu05pawIGBTZWxlY3RlZE1rc2Ag55qE6IGM6LSj6KKr56e75Lqk57uZ5LqG5pu05LiK5bGC55qE6LCD55So6ICF77yI5aaCIGBBcHBseVZhckNoYW5nZWAg5oiW5ZCM5q2l5Ye95pWw77yJ77yMXG4gKiAgIOS7pemBv+WFjeWcqOWQjOatpeW+queOr+S4reS/ruaUueato+WcqOiiq+ivu+WPlueahOeKtuaAge+8jOi/meaYr+S4gOenjemHjeimgeeahOW5tuWPkeaOp+WItuetlueVpeOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTE9HU19QQVRILCBTRUxfUEFUSCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBwcm9jZXNzRGVsZXRlQmxvY2tzIH0gZnJvbSAnLi9kZWxldGUnO1xuaW1wb3J0IHsgcHJvY2Vzc0luc2VydEJsb2NrcyB9IGZyb20gJy4vaW5zZXJ0L2luc2VydCc7XG5pbXBvcnQgeyByZWFkTWVzc2FnZUtleSB9IGZyb20gJy4uLy4uL2NvcmUva2V5L21lc3NhZ2Vfa2V5JztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uLy4uL3V0aWxzL21lc3NhZ2VfdXRpbHMnO1xuaW1wb3J0IHsgcHJvY2Vzc0VkaXRCbG9ja3MgfSBmcm9tICcuL3VwZGF0ZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IGV4dHJhY3RCbG9ja3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHJpbmcnO1xuaW1wb3J0IHsgZXNjYXBlRXJhRGF0YSwgcGFyc2VFZGl0TG9nLCBwYXJzZUpzb25sIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCd2YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yJyk7XG5cbi8qKlxuICogKirjgJDmoLjlv4Plrp7njrDjgJEqKiDlr7nmjIflrprnmoTmtojmga/lupTnlKjlj5jph4/kv67mlLnjgIJcbiAqIOi/meaYr+WPmOmHj+WGmeWFpea1geeoi+eahOaguOW/g++8jOWkhOeQhuWNleS4qua2iOaBr+OAglxuICpcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6KaB5aSE55CG55qE6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmcgfCBudWxsPn0g5aaC5p6c5oiQ5Yqf5aSE55CG77yM6L+U5Zue6K+l5raI5oGv55qEIE1L77yb5aaC5p6c5raI5oGv5peg6ZyA5aSE55CG5oiW5aSE55CG5aSx6LSl77yM6L+U5ZueIG51bGzjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZSA9IGFzeW5jIChtc2c6IGFueSk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4gPT4ge1xuICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDlvIDlp4vlpITnkIbmtojmga8uLi5gLCB7IG1zZyB9KTtcbiAgdHJ5IHtcbiAgICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgICBsb2dnZXIud2FybignQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgJ+aXoOaViOa2iOaBr+WvueixoeaIlue8uuWwkSBtZXNzYWdlX2lk77yM6YCA5Ye6Jyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlSWQgPSBtc2cubWVzc2FnZV9pZDtcbiAgICAvLyDlhpnlhaXlh73mlbDlj6rotJ/otKPor7vlj5YgTUvvvIzkuI3otJ/otKPliJvlu7rjgILliJvlu7rnmoTogYzotKPnlLHkuIrmuLjnmoQgYGVuc3VyZU1lc3NhZ2VLZXlgIOaJv+aLheOAglxuICAgIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcblxuICAgIC8vIOWmguaenOa2iOaBr+ayoeaciSBNS++8iOWPr+iDveaYr+S4gOS4quW8guW4uOeKtuaAge+8jOWmguaWsOa2iOaBr+i/mOacquiiq+azqOWFpSBNS++8ie+8jOWImei3s+i/h+OAglxuICAgIGlmICghTUspIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5LiN5ZCrIE1L77yM6Lez6L+H5Y+Y6YeP5YaZ5YWl44CCYCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDmoLnmja7orr7orqHvvIznlKjmiLfmtojmga/oh6rouqvkuI3lupTljIXlkKvlj5jph4/kv67mlLnmjIfku6TvvIzlm6DmraTot7Pov4flj5jph4/lpITnkIbvvIzkvYbov5Tlm57lhbblt7LmnInnmoQgTUvjgIJcbiAgICBpZiAoaXNVc2VyTWVzc2FnZShtc2cpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOS4uueUqOaIt+a2iOaBr++8jOi3s+i/h+WPmOmHj+WGmeWFpe+8jOS9huS/neeVmeWFtiBNS+OAgmApO1xuICAgICAgcmV0dXJuIE1LO1xuICAgIH1cblxuICAgIGNvbnN0IHJhd0NvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpIHx8ICcnO1xuXG4gICAgLy8gMS4g5LuO5raI5oGv5YaF5a655Lit6Kej5p6Q5Ye65omA5pyJ5oyH5Luk5Z2X44CCXG4gICAgY29uc3QgaW5zZXJ0QmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVJbnNlcnQnKTtcbiAgICBjb25zdCBlZGl0QmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVFZGl0Jyk7XG4gICAgY29uc3QgZGVsZXRlQmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVEZWxldGUnKTtcblxuICAgIGlmICghaW5zZXJ0QmxvY2tzLmxlbmd0aCAmJiAhZWRpdEJsb2Nrcy5sZW5ndGggJiYgIWRlbGV0ZUJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5pyq5qOA5rWL5Yiw5Y+Y6YeP5L+u5pS55qCH562+44CCYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmF3SW5zZXJ0cyA9IGluc2VydEJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG4gICAgY29uc3QgcmF3RWRpdHMgPSBlZGl0QmxvY2tzLmZsYXRNYXAocyA9PiBwYXJzZUpzb25sKHMpKTtcbiAgICBjb25zdCByYXdEZWxldGVzID0gZGVsZXRlQmxvY2tzLmZsYXRNYXAocyA9PiBwYXJzZUpzb25sKHMpKTtcblxuICAgIC8vIOWcqOi/memHjOWvueS7jua2iOaBr+S4reino+aekOWHuueahOWOn+Wni+aVsOaNrui/m+ihjOi9rOS5ie+8jOehruS/neaJgOacieWQjue7reWkhOeQhumDveS9v+eUqOi9rOS5ieWQjueahOaVsOaNruOAglxuICAgIGNvbnN0IGFsbEluc2VydHMgPSBlc2NhcGVFcmFEYXRhKHJhd0luc2VydHMpO1xuICAgIGNvbnN0IGFsbEVkaXRzID0gZXNjYXBlRXJhRGF0YShyYXdFZGl0cyk7XG4gICAgY29uc3QgYWxsRGVsZXRlcyA9IGVzY2FwZUVyYURhdGEocmF3RGVsZXRlcyk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsICfmlbDmja7ovazkuYnlrozmiJAnLCB7XG4gICAgICBiZWZvcmU6IHsgaW5zZXJ0czogcmF3SW5zZXJ0cywgZWRpdHM6IHJhd0VkaXRzLCBkZWxldGVzOiByYXdEZWxldGVzIH0sXG4gICAgICBhZnRlcjogeyBpbnNlcnRzOiBhbGxJbnNlcnRzLCBlZGl0czogYWxsRWRpdHMsIGRlbGV0ZXM6IGFsbERlbGV0ZXMgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGVkaXRMb2c6IGFueVtdID0gW107IC8vIOeUqOS6juaUtumbhuacrOi9ruaTjeS9nOS6p+eUn+eahOaJgOacieWPmOabtOiusOW9leOAglxuXG4gICAgLy8gMi4gLS0tIOWkhOeQhuaJgOacieaPkuWFpeaTjeS9nCAoYDxWYXJpYWJsZUluc2VydD5gKSAtLS1cbiAgICBhd2FpdCBwcm9jZXNzSW5zZXJ0QmxvY2tzKGFsbEluc2VydHMsIGVkaXRMb2cpO1xuXG4gICAgLy8gMy4gLS0tIOWkhOeQhuaJgOaciee8lui+keaTjeS9nCAoYDxWYXJpYWJsZUVkaXQ+YCkgLS0tXG4gICAgYXdhaXQgcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHMsIGVkaXRMb2csIG1lc3NhZ2VJZCk7XG5cbiAgICAvLyA0LiAtLS0g5aSE55CG5omA5pyJ5Yig6Zmk5pON5L2cIChgPFZhcmlhYmxlRGVsZXRlPmApIC0tLVxuICAgIGF3YWl0IHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlcywgZWRpdExvZyk7XG5cbiAgICAvLyA1LiAtLS0g6KaG55uW5byP5YaZ5YWlIEVkaXRMb2cgLS0tXG4gICAgLypcbiAgICAgKiDmoLjlv4PpgLvovpHvvJrml6DorrrmnKzova7mmK/lkKbkuqfnlJ/kuobmnInmlYjnmoTlj5jph4/kv67mlLnvvIzpg73lv4XpobvnlKjlvZPliY3nmoQgZWRpdExvZyAo5ZOq5oCV5piv56m65pWw57uEKSDopobnm5bml6fnmoQgRWRpdExvZ+OAglxuICAgICAqXG4gICAgICog5Li65LuA5LmI5b+F6aG76KaG55uW6ICM5LiN5piv5Zyo5rKh5pyJ5L+u5pS55pe26Lez6L+H77yfXG4gICAgICpcbiAgICAgKiDmoLnmnKzljp/lm6DlnKjkuo7vvIzlv4Xpobvnoa7kv53mr4/kuKogTUsg5a+55bqU55qEIEVkaXRMb2fvvIzkuKXmoLzkuJTllK/kuIDlnLDlj43mmKDlhbbmiYDlsZ7mtojmga8qKuW9k+WJjeWGheWuuSoq5omA5Lqn55Sf55qE5Y+Y6YeP5L+u5pS544CCXG4gICAgICpcbiAgICAgKiDogIPomZHkuIDkuKrlnLrmma/vvJpcbiAgICAgKiAxLiDmtojmga9BIChNS19BKSDnmoTlhoXlrrnljIXlkKvmjIfku6TvvIznlJ/miJDkuoYgRWRpdExvZ19B44CCXG4gICAgICogMi4g55So5oi35a+55raI5oGvQei/m+ihjCBzd2lwZe+8jOeUn+aIkOS6hua2iOaBr0IgKE1LX0Ip77yM5YW25YaF5a655a6M5YWo5rKh5pyJ5Y+Y6YeP5L+u5pS55qCH562+44CCXG4gICAgICpcbiAgICAgKiDlpoLmnpzlnKjlpITnkIbmtojmga9C5pe277yM5Zug5Li65rKh5pyJ5qOA5rWL5Yiw5oyH5Luk5bCx4oCc6Lez6L+H5YaZ5YWl4oCd77yM6YKj5LmI5LiOIE1LX0Ig5YWz6IGU55qEIEVkaXRMb2cg5bCx5Lya5piv56m655qE5oiW5LiN5a2Y5Zyo55qE44CCXG4gICAgICog6L+Z5Zyo5b2T5YmN5piv5q2j56Gu55qE44CCXG4gICAgICpcbiAgICAgKiDkvYblpoLmnpznlKjmiLflho3mrKEgc3dpcGXvvIzku47mtojmga9C5YiH5o2i5Zue5raI5oGvQeOAguatpOaXtuahhuaetuS8mumHjeaWsOWkhOeQhua2iOaBr0HjgIJcbiAgICAgKiDlpoLmnpzmiJHku6zkuI3miafooYzopobnm5blvI/lhpnlhaXvvIzpgqPkuYjkuI4gTUtfQSDlhbPogZTnmoQgRWRpdExvZyDku43nhLbmmK/kuYvliY3nlJ/miJDnmoQgRWRpdExvZ19B77yM6L+Z5rKh5pyJ6Zeu6aKY44CCXG4gICAgICpcbiAgICAgKiDnnJ/mraPnmoTpl67popjlnKjkuo7nirbmgIHnmoTmmI7noa7mgKfjgILopobnm5blvI/lhpnlhaXnoa7kv53kuobku7vkvZXkuIDkuKogTUsg55qE5pel5b+X77yM5Zyo5Lu75L2V5pe26Ze054K577yMXG4gICAgICog6YO95piv5YW2KirlvZPliY3lj6/op4HlhoXlrrkqKueahOebtOaOpeS6p+eJqe+8jOayoeacieS7u+S9leWOhuWPsumBl+eVmeOAgui/meS9v+W+l+aVtOS4quezu+e7n+eahOeKtuaAgeWPmOi/geWPmOW+l+a4heaZsOOAgeWPr+mihOa1i++8jFxuICAgICAqIOaegeWkp+WcsOmZjeS9juS6huWcqOWkjeadguaTjeS9nO+8iOWmguWkmuasoSBgc3dpcGVg44CB5Yig6Zmk44CB57yW6L6R77yJ5Lit5Ye6546w54q25oCB5LiN5LiA6Ie055qE6aOO6Zmp44CCXG4gICAgICpcbiAgICAgKiDlm6DmraTvvIzmraPnoa7nmoTlgZrms5XmmK/vvJrnlKjmnKzmrKHop6PmnpDmtojmga/lhoXlrrnnlJ/miJDnmoQgZWRpdExvZyAo5Zyo5peg5oyH5Luk55qE5Zy65pmv5LiL5pivIGBbXWApIOWOu+imhueblu+8jFxuICAgICAqIOS7juiAjOaWqeaWreS7u+S9leWPr+iDveWtmOWcqOeahOWOhuWPsuWFs+iBlO+8jOehruS/neaVsOaNrueahOS4gOiHtOaAp+WSjOe6r+eyueaAp+OAglxuICAgICAqL1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB1cGRhdGVFcmFNZXRhRGF0YShtZXRhID0+IHtcbiAgICAgICAgY29uc3QgbmV3QXJyID0gQXJyYXkuaXNBcnJheShlZGl0TG9nKSA/IGVkaXRMb2cgOiBwYXJzZUVkaXRMb2coZWRpdExvZyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJyxcbiAgICAgICAgICBg5YeG5aSH5Li6IE1LPSR7TUt9IChNc2dJRD0ke21lc3NhZ2VJZH0pIOWGmeWFpSBFZGl0TG9nOlxcbiR7SlNPTi5zdHJpbmdpZnkobmV3QXJyLCBudWxsLCAyKX1gLFxuICAgICAgICApO1xuICAgICAgICAvLyDlsIbmnKzova7nlJ/miJDnmoTml6Xlv5fmlbDnu4TvvIzku6XlvZPliY3mtojmga/nmoQgTUsg5Li66ZSu77yM5a2Y5YWlIGBFZGl0TG9nc2Ag5a+56LGh44CCXG4gICAgICAgIF8uc2V0KG1ldGEsIFtMT0dTX1BBVEgsIE1LXSwgSlNPTi5zdHJpbmdpZnkobmV3QXJyKSk7XG4gICAgICAgIC8qXG4gICAgICAgICAqIE4uQi4g5q2k5Ye95pWw5LiN5YaN6LSf6LSj5pu05pawIFNlbGVjdGVkTWtzIOaVsOe7hOOAglxuICAgICAgICAgKiDmm7TmlrAgU2VsZWN0ZWRNa3Mg55qE6IGM6LSj5bey56e75Lqk6Iez5LiK5bGC6LCD55So6ICFIChyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSDmiJYgQXBwbHlWYXJDaGFuZ2Up77yMXG4gICAgICAgICAqIOS7pemBv+WFjeWcqCByZXN5bmMg5b6q546v5Lit5oSP5aSW5L+u5pS55q2j5Zyo6KKr6K+75Y+W55qEIG9sZFNlbGVjdGVkTWtzIOeKtuaAgeOAglxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIG1ldGE7XG4gICAgICB9KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOaIkOWKn+S4uiBNSz0ke01LfSDlhpnlhaUgRWRpdExvZ+OAgmApO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5Li6IE1LPSR7TUt9IOWGmeWFpSBFZGl0TG9ncyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgIH1cblxuICAgIHJldHVybiBNSztcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDlj5jph4/lhpnlhaXlmajlvILluLg6ICR7ZXJyPy5tZXNzYWdlIHx8IGVycn1gLCBlcnIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5qCH5YeG5LqL5Lu25aSE55CG5YWl5Y+j44CRKipcbiAqIOi/meaYr+S4gOS4quS4iuWxguWwgeijhe+8jOeUqOS6juWkhOeQhuacgOaWsCBBSSDmtojmga/nmoTlj5jph4/lhpnlhaXvvIzlubbotJ/otKPmm7TmlrAgYFNlbGVjdGVkTWtzYCDmlbDnu4TjgIJcbiAqIOWug+S8muiHquWKqOWvu+aJvuacgOWQjuS4gOadoSBBSSDmtojmga/ov5vooYzmk43kvZzvvIzpgJrluLjooqvnu5HlrprliLDigJzmlrDmtojmga/nlJ/miJDigJ3nrYnkuovku7bkuIrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEFwcGx5VmFyQ2hhbmdlID0gYXN5bmMgKCkgPT4ge1xuICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlJywgYOWHveaVsOiiq+iwg+eUqC4uLmApO1xuICAvLyAxLiDmmbrog73mn6Xmib7mnIDlkI7kuIDmnaEgQUkg5raI5oGvXG4gIGNvbnN0IG1zZyA9IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICBsb2dnZXIubG9nKCdBcHBseVZhckNoYW5nZScsICfmnKrmib7liLDlj6/lpITnkIbnmoQgQUkg5raI5oGv77yM6YCA5Ye644CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gIGxvZ2dlci5sb2coJ0FwcGx5VmFyQ2hhbmdlJywgYOaJvuWIsOebruaghyBBSSDmtojmga8gKElEOiAke21lc3NhZ2VJZH0p77yM5byA5aeL5aSE55CG5Y+Y6YeP5YaZ5YWlLi4uYCk7XG5cbiAgLy8gMi4g6LCD55So5qC45b+D5a6e546w5p2l5aSE55CG5Y+Y6YeP5ZKMIEVkaXRMb2cg55qE5YaZ5YWl44CCXG4gIC8vIEVkaXRMb2cg5Lya6KKr6Ieq5Yqo5YWz6IGU5Yiw5LuO6K+l5raI5oGv5Lit6K+75Y+W5Yiw55qEIE1LIOS4iuOAglxuICBjb25zdCBNSyA9IGF3YWl0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZShtc2cpO1xuXG4gIC8vIDMuIOWcqOaguOW/g+a1geeoi+aJp+ihjOWujOavleWQju+8jOWcqOatpOWkhOe7n+S4gOabtOaWsCBTZWxlY3RlZE1rc++8jOehruS/neeKtuaAgeS4gOiHtOOAglxuICB0cnkge1xuICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgICAgLy8g5YWz6ZSu77ya5b+F6aG75L2/55So5oiR5Lus5q2j5Zyo5aSE55CG55qEIEFJIOa2iOaBr+eahCBtZXNzYWdlSWQg5L2c5Li657Si5byV77yMXG4gICAgICAvLyDmnaXmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uE5Lit5a+55bqU55qEIE1LIOiusOW9leOAglxuICAgICAgc2VsZWN0ZWRNa3NbbWVzc2FnZUlkXSA9IE1LO1xuICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbiAgICAgIHJldHVybiBtZXRhO1xuICAgIH0pO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlJywgYOabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/variable_change_processor.ts\n\n}");
  },
  "./src/ERA变量框架/core/key/message_key.ts": 
  /*!*********************************************!*\
  !*** ./src/ERA变量框架/core/key/message_key.ts ***!
  \*********************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureMessageKey: () => (/* binding */ ensureMessageKey),\n/* harmony export */   ensureMkForLatestMessage: () => (/* binding */ ensureMkForLatestMessage),\n/* harmony export */   readMessageKey: () => (/* binding */ readMessageKey),\n/* harmony export */   updateLatestSelectedMk: () => (/* binding */ updateLatestSelectedMk)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/message_utils */ \"./src/ERA变量框架/utils/message_utils.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `\x3c!-- --\x3e`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_6__.Logger('message_key');\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            return {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n        }\n        return null;\n    }\n    catch {\n        return null;\n    }\n}\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nfunction readMessageKey(msg) {\n    if (!msg)\n        return '';\n    // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n    const content = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg);\n    const mk = parseEraData(content)?.['era-message-key'] || '';\n    // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n    // 以强制 ensureMessageKey 生成新的 MK。\n    return mk;\n    /*\n     * ==================================================================\n     * 【已废弃的兼容逻辑】 - 2025/10/02\n     *\n     * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n     * 因此 MK 可能存在于任何一个 swipe 中。\n     *\n     * **废弃原因**:\n     * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n     * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n     * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n     * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n     *\n     * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n     * ==================================================================\n     */\n    // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n    // if (mkFromCurrent) {\n    //   return mkFromCurrent;\n    // }\n    // if (Array.isArray(msg.swipes)) {\n    //   for (const swipeContent of msg.swipes) {\n    //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n    //     if (mkFromSwipe) {\n    //       return mkFromSwipe;\n    //     }\n    //   }\n    // }\n    // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n    // if (mkFromMessage) {\n    //   return mkFromMessage;\n    // }\n    // return '';\n}\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nasync function ensureMessageKey(msg) {\n    if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n        logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。msg=${JSON.stringify(msg)}`);\n        return { mk: '', isNew: false };\n    }\n    // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n    const existingMk = readMessageKey(msg);\n    if (existingMk) {\n        return { mk: existingMk, isNew: false }; // 已存在，直接返回\n    }\n    // 2. 生成新的 MK 和元数据块\n    const newMk = `era_mk_${Date.now()}_${(0,_utils_string__WEBPACK_IMPORTED_MODULE_5__.rnd)()}`;\n    const messageType = msg.role === 'user' ? 'user' : 'assistant';\n    const dataString = `<${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>`;\n    logger.log('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n    // 3. 构造新的消息内容并统一调用更新函数\n    const currentContent = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg) ?? '';\n    const newContent = dataString + '\\n' + currentContent;\n    // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_3__.updateMessageContent)(msg, newContent);\n    return { mk: newMk, isNew: true };\n}\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nconst ensureMkForLatestMessage = async () => {\n    try {\n        const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n        // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n        logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg): ${JSON.stringify(msg)}`);\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出');\n            return { mk: '', message_id: null, isNewKey: false };\n        }\n        // ensureMessageKey 会返回最终的 MK 和一个布尔值\n        const { mk, isNew } = await ensureMessageKey(msg);\n        logger.log('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n        return { mk, message_id: msg.message_id, isNewKey: isNew };\n    }\n    catch (err) {\n        logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, err);\n        return { mk: '', message_id: null, isNewKey: false };\n    }\n};\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nconst updateLatestSelectedMk = async () => {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    if (!msg || typeof msg.message_id !== 'number')\n        return;\n    // 确保 MK 存在并获取它\n    const { mk: MK } = await ensureMessageKey(msg);\n    if (!MK)\n        return;\n    // 更新 ERAMetaData 中的 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n        const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, []);\n        // 只有在记录不一致时才执行写操作，以优化性能\n        if (selectedMks[msg.message_id] !== MK) {\n            selectedMks[msg.message_id] = MK;\n            lodash__WEBPACK_IMPORTED_MODULE_0___default().set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, selectedMks);\n        }\n        return meta;\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUva2V5L21lc3NhZ2Vfa2V5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBeUJHO0FBRVU7QUFFVTtBQUN3RDtBQUNqQjtBQUNIO0FBQ0Y7QUFDaEI7QUFDQTtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7QUFVekMscUVBQXFFO0FBQ3JFLFNBQVM7QUFDVCxxRUFBcUU7QUFFckU7Ozs7R0FJRztBQUNILFNBQVMsWUFBWSxDQUFDLGNBQXlDO0lBQzdELElBQUksT0FBTyxjQUFjLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDdkMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsTUFBTSxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyw0REFBYyxDQUFDLENBQUM7SUFDbkQsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELElBQUksQ0FBQztRQUNILHVEQUF1RDtRQUN2RCx3QkFBd0I7UUFDeEIsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsTUFBTSxRQUFRLEdBQUcsaUJBQWlCLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxTQUFTLEdBQUcsaUJBQWlCLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFFOUUsSUFBSSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3BDLE9BQU87Z0JBQ0wsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDOUIsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBeUI7YUFDekQs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RyxLQUFLLElBQUksRUFBRTtJQUMvQyxNQUFNLEdBQUcsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsVUFBVSxLQUFLLFFBQVE7UUFBRSxPQUFPO0lBRXZELGVBQWU7SUFDZixNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0MsSUFBSSxDQUFDLEVBQUU7UUFBRSxPQUFPO0lBRWhCLG1DQUFtQztJQUNuQyxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzdCLE1BQU0sV0FBVyxHQUFHLGlEQUFLLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUMsd0JBQXdCO1FBQ3hCLElBQUksV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUN2QyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNqQyxpREFBSyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9rZXkvbWVzc2FnZV9rZXkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5raI5oGv5a+G6ZKlIChNSykg566h55CG5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOi/meS4quaooeWdl+aYryBFUkEg5qGG5p6255qE5Z+655+z77yM6LSf6LSj566h55CG4oCc5raI5oGv5a+G6ZKl4oCd77yITWVzc2FnZSBLZXksIE1L77yJ44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDnmoTmoLjlv4PkvJjlir/lnKjkuo7lhbbpsoHmo5LmgKfvvIzlroPpgJrov4flsIblj5jph4/nirbmgIHkuI4gU2lsbHlUYXZlcm4g5LiN56iz5a6a55qE5raI5oGv5Y+Y6YeP77yIbWVzc2FnZSB2YXJpYWJsZXPvvIlcbiAqIOino+iApuadpeWunueOsOi/meS4gOeCueOAgk1LIOato+aYr+WunueOsOino+iApueahOWFs+mUruOAglxuICpcbiAqIE1LIOaYr+S4gOS4queUsSAqKkVSQSDmoYbmnrboh6rouqsqKiDliqjmgIHnlJ/miJDlubYqKuazqOWFpeWIsOa2iOaBr+WGheWuueWtl+espuS4sumhtumDqCoq55qE5ZSv5LiA5qCH6K+G56ym44CCXG4gKiDlroPlsLHlg4/kuIDkuKrkuI3lj6/lj5jnmoTigJzplJrngrnigJ3vvIzpmo/mtojmga/lhoXlrrnmnKzouqvkuIDotbflrZjlnKjjgIJFUkEg55qE5omA5pyJ5qC45b+D6YC76L6R77yM5YyF5ous5Y+Y6YeP6L+96Liq44CBXG4gKiDlm57mu5rlkozlkIzmraXvvIzpg73lm7Tnu5XnnYDor4bliKvlkozmk43kvZzov5nkupvplJrngrnmnaXov5vooYzvvIzogIzkuI3mmK/kvp3otZbkuo7lj6/og73lj5HnlJ/plJnkvY3miJbooqvplJnor6/nu6fmib/nmoTmtojmga/lj5jph4/jgIJcbiAqXG4gKiAqKk1LIOagvOW8jyoqOlxuICogTUsg6KKr5YyF6KO55Zyo5LiA5Liq54us54m555qE44CB57G75Ly8IFhNTCDnmoQgYDxlcmFfZGF0YT5gIOagh+etvuS4re+8jOWFtuWGhemDqOaYr+S4gOenjSoq6Z2e5qCH5YeGKirnmoTnsbsgSlNPTiDmoLzlvI/vvIxcbiAqIOS9v+eUqCBgPWAg5L2c5Li65YiG6ZqU56ym77yM5Lul6YG/5YWN5LiOIEFJIOWPr+iDveeUn+aIkOeahOagh+WHhiBKU09OIOa3t+a3huOAglxuICogZS5nLiwgYDxlcmFfZGF0YT57XCJlcmEtbWVzc2FnZS1rZXlcIj1cImVyYV9ta18uLi5cIixcImVyYS1tZXNzYWdlLXR5cGVcIj1cInVzZXJcIn08L2VyYV9kYXRhPmBcbiAqIOi/meenjeiuvuiuoe+8iOiAjOS4jeaYr+eUqCBIVE1MIOazqOmHiiBgPCEtLSAtLT5g77yJ5piv5Li65LqG6Ziy5q2iIE1LIOiiq+WFtuS7luWPr+iDveenu+mZpOazqOmHiueahOiEmuacrOaXoOaEj+S4reegtOWdj+OAglxuICpcbiAqICoq5qC45b+D5Yqf6IO9Kio6XG4gKiAxLiAqKueUn+aIkOS4juazqOWFpSoqOiBgZW5zdXJlTWVzc2FnZUtleWAg5Ye95pWw56Gu5L+d5Lu75L2V6ZyA6KaB6L+96Liq55qE5raI5oGv6YO95oul5pyJ5LiA5LiqIE1L44CC5aaC5p6c5LiN5a2Y5Zyo77yMXG4gKiAgICDlroPkvJrnlJ/miJDkuIDkuKrmlrDnmoQgTUsg5bm25rOo5YWl5Yiw5raI5oGv5YaF5a6555qE5byA5aS044CCXG4gKiAyLiAqKuino+aekOS4juivu+WPlioqOiBgcmVhZE1lc3NhZ2VLZXlgIOWHveaVsOaPkOS+m+S6huS4gOS4quWPquivu+eahOaOpeWPo++8jOeUqOS6juS7jua2iOaBr+WGheWuueS4reino+aekOWHuiBNS+OAglxuICogMy4gKirlkIzmraXkv53pmpwqKjogYHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWtgIOetieWHveaVsOehruS/neaguOW/g+aVsOaNrue7k+aehCBgU2VsZWN0ZWRNa3NgIOS4juacgOaWsOeahFxuICogICAg5raI5oGv54q25oCB5L+d5oyB5LiA6Ie077yM5piv5qGG5p626Ieq5oSI6IO95Yqb55qE6YeN6KaB57uE5oiQ6YOo5YiG44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRVJBX0RBVEFfUkVHRVgsIEVSQV9EQVRBX1RBRywgU0VMX1BBVEggfSBmcm9tICcuLi8uLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TWVzc2FnZUNvbnRlbnQgfSBmcm9tICcuLi8uLi91dGlscy9tZXNzYWdlX3V0aWxzJztcbmltcG9ydCB7IHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vLi4vdXRpbHMvbWVzc2FnZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHJuZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdtZXNzYWdlX2tleScpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5YaF6YOo6L6F5Yqp5Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3op6PmnpDlh7ogYEVyYURhdGFgIOWvueixoeOAgui/meaYr+S4gOS4quWPquivu+aTjeS9nOOAglxuICogQHBhcmFtIHtzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkfSBtZXNzYWdlQ29udGVudCAtIOa2iOaBr+eahOWGheWuueWtl+espuS4suOAglxuICogQHJldHVybnMge0VyYURhdGEgfCBudWxsfSDop6PmnpDmiJDlip/liJnov5Tlm54gYEVyYURhdGFgIOWvueixoe+8jOWQpuWImei/lOWbniBudWxs44CCXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRXJhRGF0YShtZXNzYWdlQ29udGVudDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IEVyYURhdGEgfCBudWxsIHtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlQ29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKEVSQV9EQVRBX1JFR0VYKTtcbiAgaWYgKCFtYXRjaCB8fCAhbWF0Y2hbMV0pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICB0cnkge1xuICAgIC8vIOeUseS6jiBNSyDlnZflhoXpg6jmmK/oh6rlrprkuYnnmoQgYHtcImtleVwiPVwidmFsdWVcIn1gIOagvOW8j++8jOS4jeiDveS9v+eUqCBKU09OLnBhcnNl44CCXG4gICAgLy8g5b+F6aG75L2/55So5q2j5YiZ6KGo6L6+5byP6L+b6KGM5a695p2+5Yy56YWN5p2l5o+Q5Y+W6ZSu5YC844CCXG4gICAgY29uc3QgY3VzdG9tRm9ybWF0QmxvY2sgPSBtYXRjaFsxXTtcbiAgICBjb25zdCBrZXlNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLWtleVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG4gICAgY29uc3QgdHlwZU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2UtdHlwZVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG5cbiAgICBpZiAoa2V5TWF0Y2g/LlsxXSAmJiB0eXBlTWF0Y2g/LlsxXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ2VyYS1tZXNzYWdlLWtleSc6IGtleU1hdGNoWzFdLFxuICAgICAgICAnZXJhLW1lc3NhZ2UtdHlwZSc6IHR5cGVNYXRjaFsxXSBhcyAndXNlcicgfCAnYXNzaXN0YW50JyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWvvOWHuueahOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDor7vlj5YgTUvjgJEqKiDku47kuIDkuKrmtojmga/lr7nosaHkuK3lj6ror7vlnLDmj5Dlj5blhbbmtojmga/lr4bpkqXvvIhNS++8ieOAglxuICog6L+Z5Liq5Ye95pWw57uP6L+H54m55Yir5LyY5YyW77yM5Lul5bqU5a+55ruR5Yqo77yIc3dpcGXvvInnrYnlnLrmma/kuIvmtojmga/lr7nosaHnu5PmnoTkuI3kuIDoh7TnmoTpl67popjjgIJcbiAqIOWug+S8muWFqOmdouajgOafpea2iOaBr+eahCBgbWVzYOOAgWBtZXNzYWdlYCDku6Xlj4ogYHN3aXBlc2Ag5pWw57uE5Lit55qE5q+P5LiA5Liq5YWD57Sg77yM55u05Yiw5om+5Yiw56ys5LiA5Liq5pyJ5pWI55qEIE1LIOS4uuatouOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOaJvuWIsOeahCBNS++8m+WmguaenOS4jeWtmOWcqO+8jOWImei/lOWbnuepuuWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZE1lc3NhZ2VLZXkobXNnOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoIW1zZykgcmV0dXJuICcnO1xuXG4gIC8vIOaguOW/g+mAu+i+ke+8muWni+e7iOS4lOS7heagueaNriBnZXRNZXNzYWdlQ29udGVudCDnmoTnu5PmnpzmnaXop6PmnpAgTUvjgIJcbiAgY29uc3QgY29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KG1zZyk7XG5cbiAgY29uc3QgbWsgPSBwYXJzZUVyYURhdGEoY29udGVudCk/LlsnZXJhLW1lc3NhZ2Uta2V5J10gfHwgJyc7XG5cbiAgLy8g56e76Zmk6YGN5Y6G5YW25LuWIHN3aXBlcyDnmoTplJnor6/pgLvovpHjgILlpoLmnpzlvZPliY3mv4DmtLvnmoTlhoXlrrnmsqHmnIkgTUvvvIzlsLHlv4Xpobvov5Tlm57nqbrlrZfnrKbkuLLvvIxcbiAgLy8g5Lul5by65Yi2IGVuc3VyZU1lc3NhZ2VLZXkg55Sf5oiQ5paw55qEIE1L44CCXG4gIHJldHVybiBtaztcblxuICAvKlxuICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICog44CQ5bey5bqf5byD55qE5YW85a656YC76L6R44CRIC0gMjAyNS8xMC8wMlxuICAgKlxuICAgKiDku6XkuIvku6PnoIHlnZfmmK/kuLrkuoblhbzlrrnml6fniYjphZLppobnmoTkuIDkuKrnibnmgKfvvJrkuIDkuKrmtojmga/nmoTlpJrkuKogc3dpcGUg5Y+v6IO95YWx5Lqr5ZCM5LiA5Liq5bqV5bGC5raI5oGv5Y+Y6YeP77yMXG4gICAqIOWboOatpCBNSyDlj6/og73lrZjlnKjkuo7ku7vkvZXkuIDkuKogc3dpcGUg5Lit44CCXG4gICAqXG4gICAqICoq5bqf5byD5Y6f5ZugKio6XG4gICAqIOWcqOW9k+WJjeeahCBFUkEg5p625p6E5Lit77yM5q+P5LiqIHN3aXBlIOmDveiiq+inhuS4uueLrOeri+eahOWGheWuueOAguWmguaenOW9k+WJjea/gOa0u+eahCBzd2lwZSDlhoXlrrnkuK3msqHmnIkgTUvvvIxcbiAgICog5bCx5oSP5ZGz552A5a6D5piv5LiA5Liq5YWo5paw55qE44CB6ZyA6KaB6KKr6LWL5LqI5pawIE1LIOeahOa2iOaBr+OAguatpOaXtuiLpee7p+e7reafpeaJvuW5tui/lOWbnuWFtuS7liBzd2lwZSDnmoTml6cgTUvvvIxcbiAgICog5bCG5Lya5a+86Ie0IGBlbnN1cmVNZXNzYWdlS2V5YCDplJnor6/lnLDorqTkuLrmlrDmtojmga/lt7LmnIkgTUvvvIzku47ogIzot7Pov4flv4XopoHnmoTigJznlJ/miJDmlrAgTUvigJ3mtYHnqIvjgIJcbiAgICog6L+Z5q2j5piv5a+86Ie0IHN3aXBlIOaWsOa2iOaBr+aXtuaXoOazleato+ehruWGmeWFpeWPmOmHj+eahOagueacrOWOn+WboOOAglxuICAgKlxuICAgKiDlm6DmraTvvIzor6XlhbzlrrnpgLvovpHlt7Looqvms6jph4rmjonvvIzku6Xnoa7kv50gYHJlYWRNZXNzYWdlS2V5YCDnmoTooYzkuLrkuI7lvZPliY3mnrbmnoTnmoTorr7orqHmhI/lm77kv53mjIHkuIDoh7TjgIJcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAqL1xuICAvLyBjb25zdCBta0Zyb21DdXJyZW50ID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tQ3VycmVudCkge1xuICAvLyAgIHJldHVybiBta0Zyb21DdXJyZW50O1xuICAvLyB9XG4gIC8vIGlmIChBcnJheS5pc0FycmF5KG1zZy5zd2lwZXMpKSB7XG4gIC8vICAgZm9yIChjb25zdCBzd2lwZUNvbnRlbnQgb2YgbXNnLnN3aXBlcykge1xuICAvLyAgICAgY29uc3QgbWtGcm9tU3dpcGUgPSBwYXJzZUVyYURhdGEoc3dpcGVDb250ZW50KT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gICAgIGlmIChta0Zyb21Td2lwZSkge1xuICAvLyAgICAgICByZXR1cm4gbWtGcm9tU3dpcGU7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG1rRnJvbU1lc3NhZ2UgPSBwYXJzZUVyYURhdGEobXNnLm1lc3NhZ2UpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tTWVzc2FnZSkge1xuICAvLyAgIHJldHVybiBta0Zyb21NZXNzYWdlO1xuICAvLyB9XG4gIC8vIHJldHVybiAnJztcbn1cblxuLyoqXG4gKiAqKuOAkOehruS/nSBNSyDlrZjlnKjjgJEqKlxuICog6L+Z5piv5pys5qih5Z2X5pyA5qC45b+D55qE5Ye95pWw44CC5a6D5qOA5p+l5LiA5Liq5raI5oGv5piv5ZCm5bey5oul5pyJIE1L77yM5aaC5p6c5bCa5pyq5oul5pyJ77yM5YiZ5Li65YW255Sf5oiQ5LiA5Liq5paw55qEIE1LIOW5tuazqOWFpeWIsOa2iOaBr+WGheWuueS4reOAglxuICog6L+Z5piv6Kej5Yaz4oCc6bih55Sf6JuLL+ibi+eUn+m4oeKAnemXrumimOeahOWFs+mUru+8muWcqOWvueWPmOmHj+i/m+ihjOS7u+S9leaTjeS9nOS5i+WJje+8jOW/hemhu+WFiOehruS/neacieS4gOS4quWPr+S+m+S+nemZhOeahOmUmueCue+8iE1L77yJ44CCXG4gKlxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDnm67moIfmtojmga/lr7nosaEgKOW/hemhu+WMheWQqyBgbWVzc2FnZV9pZGAsIGByb2xlYCwg5Lul5Y+KIGBtZXNzYWdlYCDmiJYgYHN3aXBlc2Ap44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bWs6IHN0cmluZywgaXNOZXc6IGJvb2xlYW59Pn0g6L+U5Zue5YyF5ZCrIE1LIOWSjOS4gOS4quW4g+WwlOWAvOeahOWvueixoe+8jOivpeW4g+WwlOWAvOaMh+ekuuaYr+WQpuWIm+W7uuS6huaWsOeahCBNS+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlTWVzc2FnZUtleShtc2c6IGFueSk6IFByb21pc2U8eyBtazogc3RyaW5nOyBpc05ldzogYm9vbGVhbiB9PiB7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicgfHwgIW1zZy5yb2xlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5peg5pWI55qE5raI5oGv5a+56LGh57uT5p6E77yM5peg5rOV56Gu5L+dS2V544CCbXNnPSR7SlNPTi5zdHJpbmdpZnkobXNnKX1gKTtcbiAgICByZXR1cm4geyBtazogJycsIGlzTmV3OiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gMS4g5L2/55So5aKe5by655qEIHJlYWRNZXNzYWdlS2V5IOajgOafpeaYr+WQpuW3suWtmOWcqCBNS1xuICBjb25zdCBleGlzdGluZ01rID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKGV4aXN0aW5nTWspIHtcbiAgICByZXR1cm4geyBtazogZXhpc3RpbmdNaywgaXNOZXc6IGZhbHNlIH07IC8vIOW3suWtmOWcqO+8jOebtOaOpei/lOWbnlxuICB9XG5cbiAgLy8gMi4g55Sf5oiQ5paw55qEIE1LIOWSjOWFg+aVsOaNruWdl1xuICBjb25zdCBuZXdNayA9IGBlcmFfbWtfJHtEYXRlLm5vdygpfV8ke3JuZCgpfWA7XG4gIGNvbnN0IG1lc3NhZ2VUeXBlID0gbXNnLnJvbGUgPT09ICd1c2VyJyA/ICd1c2VyJyA6ICdhc3Npc3RhbnQnO1xuICBjb25zdCBkYXRhU3RyaW5nID0gYDwke0VSQV9EQVRBX1RBR30+e1wiZXJhLW1lc3NhZ2Uta2V5XCI9XCIke25ld01rfVwiLFwiZXJhLW1lc3NhZ2UtdHlwZVwiPVwiJHttZXNzYWdlVHlwZX1cIn08LyR7RVJBX0RBVEFfVEFHfT5gO1xuXG4gIGxvZ2dlci5sb2coJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5Li65raI5oGvIChJRDogJHttc2cubWVzc2FnZV9pZH0pIOazqOWFpeaWsOeahEtleTogJHtuZXdNa31gKTtcblxuICAvLyAzLiDmnoTpgKDmlrDnmoTmtojmga/lhoXlrrnlubbnu5/kuIDosIPnlKjmm7TmlrDlh73mlbBcbiAgY29uc3QgY3VycmVudENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gZGF0YVN0cmluZyArICdcXG4nICsgY3VycmVudENvbnRlbnQ7XG5cbiAgLy8g5L2/55So5LuOIHV0aWxzLnRzIOWvvOWFpeeahOmAmueUqOWHveaVsOadpeabtOaWsOa2iOaBr++8jOivpeWHveaVsOW3suWwgeijheS6huWkhOeQhiBzd2lwZXMg55qE6YC76L6R44CCXG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1zZywgbmV3Q29udGVudCk7XG5cbiAgcmV0dXJuIHsgbWs6IG5ld01rLCBpc05ldzogdHJ1ZSB9O1xufVxuXG4vKipcbiAqICoq44CQ56Gu5L+d5pyA5paw5raI5oGv55qEIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quS+v+aNt+WHveaVsO+8jOS4k+mXqOeUqOS6juehruS/neW9k+WJjeiBiuWkqeiusOW9leS4reeahOacgOWQjuS4gOadoea2iOaBr+aLpeaciSBNS+OAglxuICog5a6D6YCa5bi45Zyo55uR5ZCs5Yiw5paw5raI5oGv55Sf5oiQ562J5LqL5Lu25pe26KKr6LCD55So77yM5Lul56Gu5L+d5paw5raI5oGv6IO96KKrIEVSQSDns7vnu5/mraPnoa7ov73ouKrjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHttazogc3RyaW5nLCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsLCBpc05ld0tleTogYm9vbGVhbn0+fSDov5Tlm57ljIXlkKsgTUvjgIHmtojmga8gSUQg5ZKM5LiA5Liq5biD5bCU5YC855qE5a+56LGh77yM6K+l5biD5bCU5YC85oyH56S65piv5ZCm5Yib5bu65LqG5paw55qEIE1L44CCXG4gKi9cbmV4cG9ydCBjb25zdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UgPSBhc3luYyAoKTogUHJvbWlzZTx7XG4gIG1rOiBzdHJpbmc7XG4gIG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGw7XG4gIGlzTmV3S2V5OiBib29sZWFuO1xufT4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICAgIC8vIOS/neeVmeatpOaXpeW/l++8jOWboOS4uuWug+WvueS6juiwg+ivleS6i+S7tuinpuWPkeaXtueahOa2iOaBr+eKtuaAgeiHs+WFs+mHjeimgeOAglxuICAgIGxvZ2dlci5kZWJ1ZygnZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOiOt+WPluWIsOeahOacgOaWsOa2iOaBr+WvueixoSAobXNnKTogJHtKU09OLnN0cmluZ2lmeShtc2cpfWApO1xuXG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsICfml6Dms5Xor7vlj5bmnIDmlrDmtojmga/miJblhbZJRO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIHsgbWs6ICcnLCBtZXNzYWdlX2lkOiBudWxsLCBpc05ld0tleTogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvLyBlbnN1cmVNZXNzYWdlS2V5IOS8mui/lOWbnuacgOe7iOeahCBNSyDlkozkuIDkuKrluIPlsJTlgLxcbiAgICBjb25zdCB7IG1rLCBpc05ldyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICAgIGxvZ2dlci5sb2coJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDlt7LkuLrmnIDmlrDmtojmga8gJHttc2cubWVzc2FnZV9pZH0g56Gu5L+dIE1LIOWtmOWcqOOAgiAo5piv5ZCm5paw5bu6OiAke2lzTmV3fSlgKTtcbiAgICByZXR1cm4geyBtaywgbWVzc2FnZV9pZDogbXNnLm1lc3NhZ2VfaWQsIGlzTmV3S2V5OiBpc05ldyB9O1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGxvZ2dlci5lcnJvcignZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOehruS/nU1L5pe25byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4geyBtazogJycsIG1lc3NhZ2VfaWQ6IG51bGwsIGlzTmV3S2V5OiBmYWxzZSB9O1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5pu05paw5pyA5paw5bey6YCJIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quKAnOS/nemZqeKAneWHveaVsO+8jOeUqOS6juWcqOavj+asoeS6i+S7tuWkhOeQhueahOacgOWQju+8jOW8uuWItuagoeWHhiBgU2VsZWN0ZWRNa3NgIOaVsOe7hOS4reWFs+S6jioq5pyA5paw5raI5oGvKirnmoTorrDlvZXjgIJcbiAqIOWug+ehruS/neWNs+S9v+WcqOWkjeadgueahOW8guatpea1geeoi+S4re+8jGBTZWxlY3RlZE1rc2Ag55qE5bC+6YOo5Lmf5aeL57uI5LiO5a6e6ZmF55qE5pyA5paw5raI5oGv5L+d5oyB5Lil5qC85ZCM5q2l44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGNvbnN0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSByZXR1cm47XG5cbiAgLy8g56Gu5L+dIE1LIOWtmOWcqOW5tuiOt+WPluWug1xuICBjb25zdCB7IG1rOiBNSyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICBpZiAoIU1LKSByZXR1cm47XG5cbiAgLy8g5pu05pawIEVSQU1ldGFEYXRhIOS4reeahCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgIC8vIOWPquacieWcqOiusOW9leS4jeS4gOiHtOaXtuaJjeaJp+ihjOWGmeaTjeS9nO+8jOS7peS8mOWMluaAp+iDvVxuICAgIGlmIChzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gIT09IE1LKSB7XG4gICAgICBzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgfVxuICAgIHJldHVybiBtZXRhO1xuICB9KTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/key/message_key.ts\n\n}");
  },
  "./src/ERA变量框架/core/rollback.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/core/rollback.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLatestNewValue: () => (/* binding */ findLatestNewValue),\n/* harmony export */   rollbackByMk: () => (/* binding */ rollbackByMk)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_message_key__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/message_key */ \"./src/ERA变量框架/core/key/message_key.ts\");\n/* harmony import */ var _utils_message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message_utils */ \"./src/ERA变量框架/utils/message_utils.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 回滚与历史追溯模块\n * @description\n * 该模块提供了 ERA 框架“时间旅行”能力的核心实现。它负责根据 `EditLog` 精确地撤销变量修改，\n * 以及在需要时向上追溯历史以查找变量的旧值。\n *\n * **设计理念**:\n * - **可逆操作**: 所有的变量写入操作都必须是可逆的。`rollbackByMk` 函数通过读取 `EditLog`\n *   并执行反向操作（`insert` -> `unset`, `update` -> `set to value_old`）来保证这一点。\n * - **历史的权威性**: `EditLog` 是变量状态变迁的唯一真实记录。`findLatestNewValue` 函数\n *   体现了这一原则，它不信任任何临时的变量快照，而是通过回溯 `EditLog` 链来查找一个变量\n *   在特定时间点之前的真实值。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('rollback');\n/**\n * **【回滚】**\n * 根据一个给定的消息密钥（MK），精确地撤销该消息所引入的所有变量变更。\n *\n * @param {string} MK - 要回滚的目标消息的密钥。\n * @param {boolean} [silent=false] - 是否为静默模式。在静默模式下，函数不会自己触发日志刷新，\n *   这在 `resyncStateOnHistoryChange` 等批量操作中非常有用，可以避免产生大量冗余日志。\n */\nasync function rollbackByMk(MK, silent = false) {\n    try {\n        logger.log('rollbackByMk', `开始回滚, MK=${MK}`);\n        await updateVariablesWith(v => {\n            const meta = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.META_DATA_PATH, {});\n            const stat = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, {});\n            const raw = _.get(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK]);\n            const arr = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(raw);\n            if (!arr || !arr.length) {\n                logger.debug('rollbackByMk', `EditLog 为空或无效，跳过回滚。`);\n                return v;\n            }\n            // 关键：必须逆序遍历 EditLog 来执行回滚。\n            // 这确保了对同一变量的多次修改能够被正确地、按相反的顺序撤销。\n            for (let i = arr.length - 1; i >= 0; i--) {\n                const e = arr[i];\n                const op = String(e?.op || '').toLowerCase();\n                const path = String(e?.path || '');\n                if (!path)\n                    continue;\n                if (op === 'insert') {\n                    // 对于“插入”操作，回滚即为“删除”。\n                    _.unset(stat, path);\n                    continue;\n                }\n                if (op === 'update' || op === 'delete') {\n                    // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n                    if (typeof e?.value_old === 'undefined') {\n                        // 如果日志中没有记录旧值，最安全的回滚方式是直接删除该路径。\n                        _.unset(stat, path);\n                    }\n                    else {\n                        _.set(stat, path, _.cloneDeep(e.value_old));\n                    }\n                }\n            }\n            _.set(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, stat);\n            return v;\n        }, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.CHAT_SCOPE);\n        logger.log('rollbackByMk', `回滚完成：MK=${MK}`);\n    }\n    catch (e) {\n        logger.error('rollbackByMk', `回滚异常：MK=${MK} → ${e?.message || e}`, e);\n    }\n}\n/**\n * **【历史追溯】**\n * 向上追溯聊天历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是为 `applyEditAtLevel` 函数提供支持的关键辅助函数，用于在生成 `update` 日志时，\n * 准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID 的**前一条**消息开始向上查找。\n * @param {Logger} [logger] - 可选的 Logger 实例，用于记录详细的追溯过程。\n * @returns {Promise<any>} 返回找到的 `value_new`。如果追溯到聊天记录的开头都未找到，则返回 `null`。\n */\nasync function findLatestNewValue(path, startMessageId, logger) {\n    logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息ID <${startMessageId}> 向上追溯历史值...`);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    if (!messages || messages.length < 1) {\n        logger?.debug('findLatestNewValue', `消息历史为空，无法追溯。`);\n        return null;\n    }\n    const startIndex = messages.findIndex(m => m.message_id === startMessageId);\n    if (startIndex === -1) {\n        logger?.warn('findLatestNewValue', `错误：在消息列表中未找到起始消息ID: ${startMessageId}`);\n        return null;\n    }\n    // 从起始消息的前一条开始，向上（向旧）遍历历史消息。\n    for (let i = startIndex - 1; i >= 0; i--) {\n        const message = messages[i];\n        const msgId = message?.message_id;\n        logger?.debug('findLatestNewValue', `[进度] 正在检查消息 (ID: ${msgId})，内容: \"${((0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message) || '').substring(0, 100)}...\"`);\n        // 使用 isUserMessage 辅助函数，并检查 message_id\n        if ((0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.isUserMessage)(message) || typeof msgId !== 'number') {\n            continue;\n        }\n        const mk = (0,_key_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(message);\n        if (!mk) {\n            logger?.debug('findLatestNewValue', `[进度] 消息 (ID: ${msgId}) 无 MK，跳过。`);\n            continue; // 跳过没有 MK 的 AI 消息。\n        }\n        const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.getEraData)();\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(editLogRaw);\n        if (!editLog || editLog.length === 0) {\n            logger?.debug('findLatestNewValue', `[进度] MK ${mk} 的 EditLog 为空，跳过。`);\n            continue; // 跳过 EditLog 为空的。\n        }\n        logger?.debug('findLatestNewValue', `[进度] 正在检查 MK ${mk} 的 EditLog...\\n${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(editLog)}`);\n        // 关键：从后向前遍历该消息的 EditLog，这样找到的第一个匹配项就是最新的。\n        for (let j = editLog.length - 1; j >= 0; j--) {\n            const logEntry = editLog[j];\n            if (!logEntry || !logEntry.path)\n                continue;\n            // Case 1: 精确路径匹配。\n            if (logEntry.path === path) {\n                // 如果在历史追溯中找到了 delete 记录，这意味着状态可能不一致。\n                // 因为 applyEditAtLevel 的前置检查应阻止对已删除变量的更新。\n                // 记录一个错误以供调试，并返回 null，因为该变量在逻辑上是不存在的。\n                if (logEntry.op === 'delete') {\n                    logger?.error('findLatestNewValue', `>> 状态异常! 在消息(ID:${message.message_id}, MK:${mk})中为路径 <${path}> 找到了 'delete' 记录。这表明 update 操作可能正在尝试修改一个已被删除的变量。`);\n                    return null;\n                }\n                logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到精确路径 <${path}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(logEntry.value_new)}`);\n                return _.cloneDeep(logEntry.value_new);\n            }\n            // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n            // 例如, 查找 \"a.b.c\", 而日志中有对 \"a.b\" 的修改。\n            if (path.startsWith(logEntry.path + '.')) {\n                const subPath = path.substring(logEntry.path.length + 1);\n                const parentNewVal = logEntry.value_new;\n                if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n                    const foundVal = _.get(parentNewVal, subPath);\n                    logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(foundVal)}`);\n                    return _.cloneDeep(foundVal);\n                }\n            }\n        }\n    }\n    // 如果追溯到聊天记录的开头都未找到，说明这是该变量的首次出现。\n    logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvcm9sbGJhY2sudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUU4RTtBQUN4QztBQUN1QjtBQUMzQjtBQUNDO0FBQ1Y7QUFFdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRXRDOzs7Ozs7O0dBT0c7QUFDSSxLQUFLLFVBQVUsWUFBWSxDQUFDLEVBQVUsRUFBRSxNQUFNLEdBQUcsS0FBSztJQUMzRCxJQUFJLENBQUM7UUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0MsTUFBTSxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM1QixNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSw0REFBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDREQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFMUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyx1REFBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDekMsTUFBTSxHQUFHLEdBQUcseURBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN4QixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNwRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUM7WUFFRCwyQkFBMkI7WUFDM0IsaUNBQWlDO1lBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENB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RyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN4QyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDbEUsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzlDLE1BQU0sRUFBRSxLQUFLLENBQ1gsb0JBQW9CLEVBQ3BCLGlCQUFpQixPQUFPLENBQUMsVUFBVSxRQUFRLEVBQUUsYUFBYSxRQUFRLENBQUMsSUFBSSxnQkFBZ0IsT0FBTyxVQUFVLDhDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDdEgsQ0FBQztvQkFDRixPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLElBQUksdUJBQXVCLENBQUMsQ0FBQztJQUM5RSxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3JvbGxiYWNrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWbnua7muS4juWOhuWPsui/vea6r+aooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmj5DkvpvkuoYgRVJBIOahhuaetuKAnOaXtumXtOaXheihjOKAneiDveWKm+eahOaguOW/g+WunueOsOOAguWug+i0n+i0o+agueaNriBgRWRpdExvZ2Ag57K+56Gu5Zyw5pKk6ZSA5Y+Y6YeP5L+u5pS577yMXG4gKiDku6Xlj4rlnKjpnIDopoHml7blkJHkuIrov73muq/ljoblj7Lku6Xmn6Xmib7lj5jph4/nmoTml6flgLzjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuWPr+mAhuaTjeS9nCoqOiDmiYDmnInnmoTlj5jph4/lhpnlhaXmk43kvZzpg73lv4XpobvmmK/lj6/pgIbnmoTjgIJgcm9sbGJhY2tCeU1rYCDlh73mlbDpgJrov4for7vlj5YgYEVkaXRMb2dgXG4gKiAgIOW5tuaJp+ihjOWPjeWQkeaTjeS9nO+8iGBpbnNlcnRgIC0+IGB1bnNldGAsIGB1cGRhdGVgIC0+IGBzZXQgdG8gdmFsdWVfb2xkYO+8ieadpeS/neivgei/meS4gOeCueOAglxuICogLSAqKuWOhuWPsueahOadg+WogeaApyoqOiBgRWRpdExvZ2Ag5piv5Y+Y6YeP54q25oCB5Y+Y6L+B55qE5ZSv5LiA55yf5a6e6K6w5b2V44CCYGZpbmRMYXRlc3ROZXdWYWx1ZWAg5Ye95pWwXG4gKiAgIOS9k+eOsOS6hui/meS4gOWOn+WIme+8jOWug+S4jeS/oeS7u+S7u+S9leS4tOaXtueahOWPmOmHj+W/q+eFp++8jOiAjOaYr+mAmui/h+Wbnua6ryBgRWRpdExvZ2Ag6ZO+5p2l5p+l5om+5LiA5Liq5Y+Y6YePXG4gKiAgIOWcqOeJueWumuaXtumXtOeCueS5i+WJjeeahOecn+WunuWAvOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgQ0hBVF9TQ09QRSwgTE9HU19QQVRILCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tZXNzYWdlX2tleSc7XG5pbXBvcnQgeyBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2VfdXRpbHMnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IEosIHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigncm9sbGJhY2snKTtcblxuLyoqXG4gKiAqKuOAkOWbnua7muOAkSoqXG4gKiDmoLnmja7kuIDkuKrnu5nlrprnmoTmtojmga/lr4bpkqXvvIhNS++8ie+8jOeyvuehruWcsOaSpOmUgOivpea2iOaBr+aJgOW8leWFpeeahOaJgOacieWPmOmHj+WPmOabtOOAglxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBNSyAtIOimgeWbnua7mueahOebruagh+a2iOaBr+eahOWvhumSpeOAglxuICogQHBhcmFtIHtib29sZWFufSBbc2lsZW50PWZhbHNlXSAtIOaYr+WQpuS4uumdmem7mOaooeW8j+OAguWcqOmdmem7mOaooeW8j+S4i++8jOWHveaVsOS4jeS8muiHquW3seinpuWPkeaXpeW/l+WIt+aWsO+8jFxuICogICDov5nlnKggYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDnrYnmibnph4/mk43kvZzkuK3pnZ7luLjmnInnlKjvvIzlj6/ku6Xpgb/lhY3kuqfnlJ/lpKfph4/lhpfkvZnml6Xlv5fjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJvbGxiYWNrQnlNayhNSzogc3RyaW5nLCBzaWxlbnQgPSBmYWxzZSkge1xuICB0cnkge1xuICAgIGxvZ2dlci5sb2coJ3JvbGxiYWNrQnlNaycsIGDlvIDlp4vlm57mu5osIE1LPSR7TUt9YCk7XG4gICAgYXdhaXQgdXBkYXRlVmFyaWFibGVzV2l0aCh2ID0+IHtcbiAgICAgIGNvbnN0IG1ldGEgPSBfLmdldCh2LCBNRVRBX0RBVEFfUEFUSCwge30pO1xuICAgICAgY29uc3Qgc3RhdCA9IF8uZ2V0KHYsIFNUQVRfREFUQV9QQVRILCB7fSk7XG5cbiAgICAgIGNvbnN0IHJhdyA9IF8uZ2V0KG1ldGEsIFtMT0dTX1BBVEgsIE1LXSk7XG4gICAgICBjb25zdCBhcnIgPSBwYXJzZUVkaXRMb2cocmF3KTtcbiAgICAgIGlmICghYXJyIHx8ICFhcnIubGVuZ3RoKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1Zygncm9sbGJhY2tCeU1rJywgYEVkaXRMb2cg5Li656m65oiW5peg5pWI77yM6Lez6L+H5Zue5rua44CCYCk7XG4gICAgICAgIHJldHVybiB2O1xuICAgICAgfVxuXG4gICAgICAvLyDlhbPplK7vvJrlv4XpobvpgIbluo/pgY3ljoYgRWRpdExvZyDmnaXmiafooYzlm57mu5rjgIJcbiAgICAgIC8vIOi/meehruS/neS6huWvueWQjOS4gOWPmOmHj+eahOWkmuasoeS/ruaUueiDveWkn+iiq+ato+ehruWcsOOAgeaMieebuOWPjeeahOmhuuW6j+aSpOmUgOOAglxuICAgICAgZm9yIChsZXQgaSA9IGFyci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBjb25zdCBlID0gYXJyW2ldO1xuICAgICAgICBjb25zdCBvcCA9IFN0cmluZyhlPy5vcCB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgcGF0aCA9IFN0cmluZyhlPy5wYXRoIHx8ICcnKTtcbiAgICAgICAgaWYgKCFwYXRoKSBjb250aW51ZTtcblxuICAgICAgICBpZiAob3AgPT09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgLy8g5a+55LqO4oCc5o+S5YWl4oCd5pON5L2c77yM5Zue5rua5Y2z5Li64oCc5Yig6Zmk4oCd44CCXG4gICAgICAgICAgXy51bnNldChzdGF0LCBwYXRoKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3AgPT09ICd1cGRhdGUnIHx8IG9wID09PSAnZGVsZXRlJykge1xuICAgICAgICAgIC8vIOWvueS6juKAnOabtOaWsOKAneaIluKAnOWIoOmZpOKAneaTjeS9nO+8jOWbnua7muWNs+S4uuaBouWkjeWIsOKAnOaXp+WAvOKAneOAglxuICAgICAgICAgIGlmICh0eXBlb2YgZT8udmFsdWVfb2xkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgLy8g5aaC5p6c5pel5b+X5Lit5rKh5pyJ6K6w5b2V5pen5YC877yM5pyA5a6J5YWo55qE5Zue5rua5pa55byP5piv55u05o6l5Yig6Zmk6K+l6Lev5b6E44CCXG4gICAgICAgICAgICBfLnVuc2V0KHN0YXQsIHBhdGgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLnNldChzdGF0LCBwYXRoLCBfLmNsb25lRGVlcChlLnZhbHVlX29sZCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBfLnNldCh2LCBTVEFUX0RBVEFfUEFUSCwgc3RhdCk7XG4gICAgICByZXR1cm4gdjtcbiAgICB9LCBDSEFUX1NDT1BFKTtcbiAgICBsb2dnZXIubG9nKCdyb2xsYmFja0J5TWsnLCBg5Zue5rua5a6M5oiQ77yaTUs9JHtNS31gKTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgbG9nZ2VyLmVycm9yKCdyb2xsYmFja0J5TWsnLCBg5Zue5rua5byC5bi477yaTUs9JHtNS30g4oaSICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICB9XG59XG5cbi8qKlxuICogKirjgJDljoblj7Lov73muq/jgJEqKlxuICog5ZCR5LiK6L+95rqv6IGK5aSp5Y6G5Y+y77yM5p+l5om+5p+Q5Liq5Y+Y6YeP6Lev5b6E5Zyo5oyH5a6a5raI5oGv5LmL5YmN55qE5pyA5ZCO5LiA5Liq5YC8IChgdmFsdWVfbmV3YCnjgIJcbiAqIOi/meaYr+S4uiBgYXBwbHlFZGl0QXRMZXZlbGAg5Ye95pWw5o+Q5L6b5pSv5oyB55qE5YWz6ZSu6L6F5Yqp5Ye95pWw77yM55So5LqO5Zyo55Sf5oiQIGB1cGRhdGVgIOaXpeW/l+aXtu+8jFxuICog5YeG56Gu5Zyw6K6w5b2V5LiLIGB2YWx1ZV9vbGRg44CCXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSDopoHmn6Xmib7nmoTlj5jph4/nmoTlrozmlbTot6/lvoTjgIJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydE1lc3NhZ2VJZCAtIOS7juatpOa2iOaBryBJRCDnmoQqKuWJjeS4gOadoSoq5raI5oGv5byA5aeL5ZCR5LiK5p+l5om+44CCXG4gKiBAcGFyYW0ge0xvZ2dlcn0gW2xvZ2dlcl0gLSDlj6/pgInnmoQgTG9nZ2VyIOWunuS+i++8jOeUqOS6juiusOW9leivpue7hueahOi/vea6r+i/h+eoi+OAglxuICogQHJldHVybnMge1Byb21pc2U8YW55Pn0g6L+U5Zue5om+5Yiw55qEIGB2YWx1ZV9uZXdg44CC5aaC5p6c6L+95rqv5Yiw6IGK5aSp6K6w5b2V55qE5byA5aS06YO95pyq5om+5Yiw77yM5YiZ6L+U5ZueIGBudWxsYOOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZExhdGVzdE5ld1ZhbHVlKHBhdGg6IHN0cmluZywgc3RhcnRNZXNzYWdlSWQ6IG51bWJlciwgbG9nZ2VyPzogTG9nZ2VyKTogUHJvbWlzZTxhbnk+IHtcbiAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYOW8gOWni+S4uui3r+W+hCA8JHtwYXRofT4g5LuO5raI5oGvSUQgPCR7c3RhcnRNZXNzYWdlSWR9PiDlkJHkuIrov73muq/ljoblj7LlgLwuLi5gKTtcbiAgY29uc3QgbWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nLCB7IGluY2x1ZGVfc3dpcGVzOiBmYWxzZSB9KTtcbiAgaWYgKCFtZXNzYWdlcyB8fCBtZXNzYWdlcy5sZW5ndGggPCAxKSB7XG4gICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYOa2iOaBr+WOhuWPsuS4uuepuu+8jOaXoOazlei/vea6r+OAgmApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3Qgc3RhcnRJbmRleCA9IG1lc3NhZ2VzLmZpbmRJbmRleChtID0+IG0ubWVzc2FnZV9pZCA9PT0gc3RhcnRNZXNzYWdlSWQpO1xuICBpZiAoc3RhcnRJbmRleCA9PT0gLTEpIHtcbiAgICBsb2dnZXI/Lndhcm4oJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGDplJnor6/vvJrlnKjmtojmga/liJfooajkuK3mnKrmib7liLDotbflp4vmtojmga9JRDogJHtzdGFydE1lc3NhZ2VJZH1gKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIOS7jui1t+Wni+a2iOaBr+eahOWJjeS4gOadoeW8gOWni++8jOWQkeS4iu+8iOWQkeaXp++8iemBjeWOhuWOhuWPsua2iOaBr+OAglxuICBmb3IgKGxldCBpID0gc3RhcnRJbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IG1lc3NhZ2VzW2ldO1xuICAgIGNvbnN0IG1zZ0lkID0gbWVzc2FnZT8ubWVzc2FnZV9pZDtcbiAgICBsb2dnZXI/LmRlYnVnKFxuICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICBgW+i/m+W6pl0g5q2j5Zyo5qOA5p+l5raI5oGvIChJRDogJHttc2dJZH0p77yM5YaF5a65OiBcIiR7KGdldE1lc3NhZ2VDb250ZW50KG1lc3NhZ2UpIHx8ICcnKS5zdWJzdHJpbmcoMCwgMTAwKX0uLi5cImAsXG4gICAgKTtcblxuICAgIC8vIOS9v+eUqCBpc1VzZXJNZXNzYWdlIOi+heWKqeWHveaVsO+8jOW5tuajgOafpSBtZXNzYWdlX2lkXG4gICAgaWYgKGlzVXNlck1lc3NhZ2UobWVzc2FnZSkgfHwgdHlwZW9mIG1zZ0lkICE9PSAnbnVtYmVyJykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgY29uc3QgbWsgPSByZWFkTWVzc2FnZUtleShtZXNzYWdlKTtcbiAgICBpZiAoIW1rKSB7XG4gICAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBgW+i/m+W6pl0g5raI5oGvIChJRDogJHttc2dJZH0pIOaXoCBNS++8jOi3s+i/h+OAgmApO1xuICAgICAgY29udGludWU7IC8vIOi3s+i/h+ayoeaciSBNSyDnmoQgQUkg5raI5oGv44CCXG4gICAgfVxuXG4gICAgY29uc3QgeyBtZXRhOiBtZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICAgIGNvbnN0IGVkaXRMb2dSYXcgPSBfLmdldChtZXRhRGF0YSwgW0xPR1NfUEFUSCwgbWtdKTtcbiAgICBjb25zdCBlZGl0TG9nID0gcGFyc2VFZGl0TG9nKGVkaXRMb2dSYXcpO1xuXG4gICAgaWYgKCFlZGl0TG9nIHx8IGVkaXRMb2cubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBgW+i/m+W6pl0gTUsgJHtta30g55qEIEVkaXRMb2cg5Li656m677yM6Lez6L+H44CCYCk7XG4gICAgICBjb250aW51ZTsgLy8g6Lez6L+HIEVkaXRMb2cg5Li656m655qE44CCXG4gICAgfVxuICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSDmraPlnKjmo4Dmn6UgTUsgJHtta30g55qEIEVkaXRMb2cuLi5cXG4ke0ooZWRpdExvZyl9YCk7XG5cbiAgICAvLyDlhbPplK7vvJrku47lkI7lkJHliY3pgY3ljobor6Xmtojmga/nmoQgRWRpdExvZ++8jOi/meagt+aJvuWIsOeahOesrOS4gOS4quWMuemFjemhueWwseaYr+acgOaWsOeahOOAglxuICAgIGZvciAobGV0IGogPSBlZGl0TG9nLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XG4gICAgICBjb25zdCBsb2dFbnRyeSA9IGVkaXRMb2dbal07XG4gICAgICBpZiAoIWxvZ0VudHJ5IHx8ICFsb2dFbnRyeS5wYXRoKSBjb250aW51ZTtcblxuICAgICAgLy8gQ2FzZSAxOiDnsr7noa7ot6/lvoTljLnphY3jgIJcbiAgICAgIGlmIChsb2dFbnRyeS5wYXRoID09PSBwYXRoKSB7XG4gICAgICAgIC8vIOWmguaenOWcqOWOhuWPsui/vea6r+S4reaJvuWIsOS6hiBkZWxldGUg6K6w5b2V77yM6L+Z5oSP5ZGz552A54q25oCB5Y+v6IO95LiN5LiA6Ie044CCXG4gICAgICAgIC8vIOWboOS4uiBhcHBseUVkaXRBdExldmVsIOeahOWJjee9ruajgOafpeW6lOmYu+atouWvueW3suWIoOmZpOWPmOmHj+eahOabtOaWsOOAglxuICAgICAgICAvLyDorrDlvZXkuIDkuKrplJnor6/ku6XkvpvosIPor5XvvIzlubbov5Tlm54gbnVsbO+8jOWboOS4uuivpeWPmOmHj+WcqOmAu+i+keS4iuaYr+S4jeWtmOWcqOeahOOAglxuICAgICAgICBpZiAobG9nRW50cnkub3AgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgbG9nZ2VyPy5lcnJvcihcbiAgICAgICAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgICAgICAgYD4+IOeKtuaAgeW8guW4uCEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5Li66Lev5b6EIDwke3BhdGh9PiDmib7liLDkuoYgJ2RlbGV0ZScg6K6w5b2V44CC6L+Z6KGo5piOIHVwZGF0ZSDmk43kvZzlj6/og73mraPlnKjlsJ3or5Xkv67mlLnkuIDkuKrlt7LooqvliKDpmaTnmoTlj5jph4/jgIJgLFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZXI/LmRlYnVnKFxuICAgICAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgICAgIGA+PiDmiJDlip8hIOWcqOa2iOaBryhJRDoke21lc3NhZ2UubWVzc2FnZV9pZH0sIE1LOiR7bWt9KeS4reaJvuWIsOeyvuehrui3r+W+hCA8JHtwYXRofT4g55qE5YC85Li6OiAke0oobG9nRW50cnkudmFsdWVfbmV3KX1gLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gXy5jbG9uZURlZXAobG9nRW50cnkudmFsdWVfbmV3KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FzZSAyOiDmn6Xmib7nmoTot6/lvoTmmK/ml6Xlv5fmnaHnm67ot6/lvoTnmoTlrZDot6/lvoQgKOWNsyBsb2dFbnRyeS5wYXRoIOaYr+eItue6pynjgIJcbiAgICAgIC8vIOS+i+Wmgiwg5p+l5om+IFwiYS5iLmNcIiwg6ICM5pel5b+X5Lit5pyJ5a+5IFwiYS5iXCIg55qE5L+u5pS544CCXG4gICAgICBpZiAocGF0aC5zdGFydHNXaXRoKGxvZ0VudHJ5LnBhdGggKyAnLicpKSB7XG4gICAgICAgIGNvbnN0IHN1YlBhdGggPSBwYXRoLnN1YnN0cmluZyhsb2dFbnRyeS5wYXRoLmxlbmd0aCArIDEpO1xuICAgICAgICBjb25zdCBwYXJlbnROZXdWYWwgPSBsb2dFbnRyeS52YWx1ZV9uZXc7XG4gICAgICAgIGlmIChfLmlzUGxhaW5PYmplY3QocGFyZW50TmV3VmFsKSAmJiBfLmhhcyhwYXJlbnROZXdWYWwsIHN1YlBhdGgpKSB7XG4gICAgICAgICAgY29uc3QgZm91bmRWYWwgPSBfLmdldChwYXJlbnROZXdWYWwsIHN1YlBhdGgpO1xuICAgICAgICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAgICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgICAgICAgIGA+PiDmiJDlip8hIOWcqOa2iOaBryhJRDoke21lc3NhZ2UubWVzc2FnZV9pZH0sIE1LOiR7bWt9KeS4reaJvuWIsOeItue6p+i3r+W+hCA8JHtsb2dFbnRyeS5wYXRofT4sIOW5tuS7juS4reaPkOWPluWtkOi3r+W+hCA8JHtzdWJQYXRofT4g55qE5YC85Li6OiAke0ooZm91bmRWYWwpfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gXy5jbG9uZURlZXAoZm91bmRWYWwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8g5aaC5p6c6L+95rqv5Yiw6IGK5aSp6K6w5b2V55qE5byA5aS06YO95pyq5om+5Yiw77yM6K+05piO6L+Z5piv6K+l5Y+Y6YeP55qE6aaW5qyh5Ye6546w44CCXG4gIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGDlkJHkuIrov73muq/mnKrmib7liLDot6/lvoQgJHtwYXRofSDnmoTku7vkvZXljoblj7LlgLzvvIzlsIbkvb/nlKggbnVsbCDkvZzkuLrml6flgLxgKTtcbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qXG4gKiDml6fnmoQgY2FsaWJyYXRlIOWHveaVsO+8jOWFtuaguOW/g+aAneaDs+W3suiiq+WQuOaUtui/myBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOeahOS/nemZqeacuuWItuS4reOAglxuICog5q2k5aSE55qE5rOo6YeK6KKr5L+d55WZ77yM5Zug5Li65a6D5p6B5aW95Zyw6Kej6YeK5LqGIEVSQSDmoYbmnrblpoLkvZXlt6flppnlnLDlupTlr7kgU2lsbHlUYXZlcm4g55qE5LiA5Liq5qC45b+D4oCc5oCq55mW4oCd44CCXG4gKlxuICogIyMjIOagoeWHhuS4u+a1geeoi++8muavlOi+g+KAnOW9k+WJjea2iOaBr+KAneS4juKAnOS4iuasoemAieS4reeahOa2iOaBr+KAneW5tuWIqeeUqOmFkummhueahOeJueaAp+W3p+WmmeWcsOS/ruWkjeWPmOmHj+eKtuaAgeOAglxuICpcbiAqIEBkZXNjcmlwdGlvblxuICog6L+Z5pivIEVSQSDlj5jph4/moYbmnrbmnIDmoLjlv4PnmoTlh73mlbDkuYvkuIDvvIzlroPop6PlhrPkuobkuIDkuKrpnZ7luLjmo5jmiYvnmoTpl67popjvvJoqKuWIoOmZpCBzd2lwZSDml7bnmoTlj5jph4/nirbmgIHoh6rliqjkv67lpI0qKuOAglxuICpcbiAqICoq6YWS6aaG55qE5aWH54m56KGM5Li6IChGZWF0dXJlLCBub3QgYSBidWcpOioqXG4gKiDlvZPliKDpmaTkuIDmnaEgc3dpcGUgKOS+i+Wmgu+8jOW4puacieWPmOmHjyBpZD0yIOeahOa2iOaBrykg5pe277yaXG4gKiAxLiAqKuWGheWuueS4juWPmOmHj+mUmeS9jSoqOiDlkI7kuIDmnaEgc3dpcGUgKGlkPTMpIOeahCoq5YaF5a65KirkvJrigJzpobbigJ3liLDooqvliKDpmaTnmoQgc3dpcGUgKGlkPTIpIOeahOS9jee9ruS4iu+8jOS9hioq5Y+Y6YePKirljbTkv53nlZnkuoYgaWQ9MiDnmoTlj5jph4/jgIJcbiAqIDIuICoq5a2k5YS/5Y+Y6YeP5q6L55WZKio6IOWOn+acrOeahCBzd2lwZSAzIOa2iOaBr+iZveeEtuWcqOeVjOmdouS4iua2iOWkseS6hu+8jOS9huWug+WvueW6lOeahCoq5raI5oGv5Y+Y6YePKiogKGlkPTMpIOS7jeeEtuaui+eVmeWcqOiBiuWkqeaVsOaNruS4re+8jOaIkOS4uuKAnOWtpOWEv+WPmOmHj+KAneOAglxuICogMy4gKirlraTlhL/lj5jph4/nu6fmib8qKjog5aaC5p6c55So5oi35q2k5pe25YaNIHN3aXBlIOS4gOasoe+8jOaWsOeUn+aIkOeahCBzd2lwZSAzIOWwhuS8mioq57un5om/Kirov5nkuKrmrovnlZnnmoTlraTlhL/lj5jph48gKGlkPTMp77yM5a+86Ie05paw5YaF5a656YWN5pen5Y+Y6YeP77yM6L+b5LiA5q2l5Yqg5Ymn54q25oCB5re35Lmx44CCXG4gKiA0LiAqKue7k+aenCoqOiDmiJHku6zlvpfliLDkuobkuIDkuKrlhoXlrrnmmK8gaWQ9M+OAgeWPmOmHj+aYryBpZD0yIOeahOKAnOa3t+WQiOKAnea2iOaBr++8jOW5tuS4lOi/mOacieS4gOS4qiBpZD0zIOeahOWtpOWEv+WPmOmHj+maj+aXtuWPr+iDveiiq+aWsOa2iOaBr+e7p+aJv++8jOmAoOaIkOS4pemHjeeahOeKtuaAgeS4jeS4gOiHtOOAglxuICogNS4gKirml6Dnibnlrprkuovku7YqKjog5q2k5aSW77yM6L+Z5Liq5pON5L2c5LiN5Lya6Kem5Y+R5Lu75L2V54us54m555qE5LqL5Lu277yM5Y+q5Lya6Kem5Y+RIGBjaGF0X2lkX2NoYW5nZWRgIOetiemAmueUqOS6i+S7tuOAglxuICpcbiAqICoq5pys5Ye95pWw55qE5qCh5YeG5ben6K6hOioqXG4gKiDmnKzlh73mlbDnsr7noa7lnLDliKnnlKjkuobkuIrov7DigJznirbmgIHplJnkvY3igJ3mnaXlrozmiJDoh6rliqjkv67lpI3vvJpcbiAqIDEuIGBjYWxpYnJhdGVgIOiiqyBgY2hhdF9pZF9jaGFuZ2VkYCDkuovku7bop6blj5HjgIJcbiAqIDIuIOWug+ajgOa1i+WIsCBgb2xkTUtgIOWtmOWcqCAo5a6D6K6w5b2V5LqG6KKr5Yig6Zmk5raI5oGv55qEIE1L77yM5Y2zIGlkPTIg55qEIE1LKeOAglxuICogMy4gKirmiafooYzlm57mu5oqKjogYGFwcGx5Um9sbGJhY2tCeU1LKG9sZE1LKWAg6KKr6LCD55So77yM5bCGIGlkPTIg5byV5YWl55qE5Y+Y6YeP5L+u5pS55YWo6YOo5pKk6ZSA44CCXG4gKiA0LiAqKuinpuWPkemHjeWGmSoqOiBgZXZlbnRFbWl0KCdyb2xsYmFja19kb25lX3JlYXBwbHlfdmFyX3N0YXJ0JylgIOiiq+inpuWPkeOAglxuICogNS4gYEFwcGx5VmFyQ2hhbmdlYCDlh73mlbDlk43lupTph43lhpnkuovku7bvvIzor7vlj5YqKuW9k+WJjSoq5raI5oGv55qEKirlhoXlrrkqKiAo546w5Zyo5pivIGlkPTMg55qE5YaF5a65Ke+8jOW5tuagueaNruWug+mHjeaWsOWGmeWFpeWPmOmHj+OAglxuICpcbiAqICoq5pyA57uI5pWI5p6cKio6IOKAnOWbnua7muS6huaXp+eahChpZD0yKe+8jOmHjeWGmeS6huaWsOeahChpZD0zKeKAne+8jOWPmOmHj+eKtuaAgeiiq+WujOe+juWcsOiHquWKqOS/ruWkjeOAglxuICovXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/rollback.ts\n\n}");
  },
  "./src/ERA变量框架/core/sync.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/core/sync.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceSyncLastAiMessage: () => (/* binding */ forceSyncLastAiMessage),\n/* harmony export */   resyncStateOnHistoryChange: () => (/* binding */ resyncStateOnHistoryChange)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_message_key__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/message_key */ \"./src/ERA变量框架/core/key/message_key.ts\");\n/* harmony import */ var _utils_message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message_utils */ \"./src/ERA变量框架/utils/message_utils.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./crud/variable_change_processor */ \"./src/ERA变量框架/core/crud/variable_change_processor.ts\");\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_6__.Logger('sync');\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg) => {\n    const key = (0,_key_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!key)\n        return null;\n    return key;\n};\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks) => {\n    const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    for (const mk of mks) {\n        if (!mk)\n            continue; // 跳过 null (用户消息)\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_5__.parseEditLog)(editLogRaw);\n        if (editLog.length > 0) {\n            return false; // 发现一个非空 log，直接返回 false\n        }\n    }\n    return true; // 所有 log 都为空\n};\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nconst resyncStateOnHistoryChange = async (forceFullResync = false) => {\n    if (forceFullResync) {\n        logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    }\n    else {\n        logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n    const { meta: oldMetaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    const oldSelectedMks = _.cloneDeep(_.get(oldMetaData, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []));\n    logger.debug('resyncStateOnHistoryChange', `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`);\n    if (!allMessages || allMessages.length === 0) {\n        logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n        return;\n    }\n    let firstRecalcId = -1;\n    if (forceFullResync) {\n        firstRecalcId = 0;\n        logger.log('resyncStateOnHistoryChange', '强制模式：设置重算起点为 0。');\n    }\n    // Case 1: 消息被删除 (新列表比旧列表短)\n    else if (allMessages.length < oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息删除。');\n        // 从后往前，寻找第一个 \"currentMk === oldMk_at_same_index\" 的对齐点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[删除-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk === recordedMk) {\n                firstRecalcId = i + 1;\n                logger.log('resyncStateOnHistoryChange', `找到对齐点于 message_id=${i} (MK=${currentMk})。将从 ID ${firstRecalcId} 开始检查。`);\n                break;\n            }\n        }\n        if (firstRecalcId === -1) {\n            firstRecalcId = 0;\n            logger.log('resyncStateOnHistoryChange', '未找到任何对齐点，将从头开始检查。');\n        }\n        // 【优化】检查被删除的 MK 是否影响变量\n        // 稳健地找出被删除的 MK：对比新旧 MK 序列的差异\n        const currentMkSequence = allMessages.map(getMkFromMsg).filter(mk => mk);\n        const oldMkSequence = oldSelectedMks.filter(mk => mk);\n        const deletedMks = _.difference(oldMkSequence, currentMkSequence);\n        logger.debug('resyncStateOnHistoryChange', `旧MK序列: [${oldMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `新MK序列: [${currentMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `计算出的被删除MK: [${deletedMks.join(', ')}]`);\n        if (deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks)) {\n            logger.log('resyncStateOnHistoryChange', `检测到被删除的 ${deletedMks.length} 条消息均不含变量修改，执行快速同步。`);\n            const newSelectedMks = [];\n            for (let i = 0; i < allMessages.length; i++) {\n                newSelectedMks[i] = getMkFromMsg(allMessages[i]);\n            }\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n                return meta;\n            });\n            logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n            return;\n        }\n    }\n    // Case 2: 消息被修改/切换 (长度不变)\n    else if (allMessages.length === oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息长度不变，可能为修改或切换。');\n        // 从后往前，寻找第一个不匹配的点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[切换-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk !== recordedMk) {\n                firstRecalcId = i;\n            }\n        }\n        if (firstRecalcId === -1) {\n            logger.log('resyncStateOnHistoryChange', '所有MK均匹配，无需重算。');\n            // N.B. 在当前架构下，MK 已被直接写入消息内容，与内容强绑定。\n            // 因此，任何导致内容变化的操作（如 swipe）也必然会导致 MK 的变化。\n            // 这意味着，如果 MK 序列完全匹配，那么内容也必然完全匹配，无需进行任何重算或保险性检查。\n            return; // 直接返回，终止同步。\n        }\n        else {\n            logger.log('resyncStateOnHistoryChange', `找到最早的不匹配点于 message_id=${firstRecalcId}。将从该点开始重算。`);\n        }\n    }\n    // Case 3: 消息被添加 (新列表比旧列表长)\n    else {\n        logger.log('resyncStateOnHistoryChange', '检测到消息添加。');\n        // 将重算起点设置为新消息的起始索引，让同步流程统一处理\n        firstRecalcId = oldSelectedMks.length;\n        logger.log('resyncStateOnHistoryChange', `新增消息的写入逻辑已由同步流程接管。将从新增消息 (ID: ${firstRecalcId}) 开始处理。`);\n    }\n    // 3. 收集需要回滚的 MK 列表，并执行逆序回滚\n    if (firstRecalcId > -1) {\n        const mksToRollback = oldSelectedMks.slice(firstRecalcId).filter(mk => mk);\n        if (mksToRollback.length > 0) {\n            logger.log('resyncStateOnHistoryChange', `准备回滚 ${mksToRollback.length} 个MK: [${mksToRollback.join(', ')}]`);\n            for (const mk of mksToRollback.reverse()) {\n                logger.debug('resyncStateOnHistoryChange', `[回滚] 正在回滚 MK: ${mk}`);\n                await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(mk, true); // true 表示只回滚，不重写\n            }\n            logger.log('resyncStateOnHistoryChange', '逆序回滚完成。');\n        }\n    }\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n        const msg = allMessages[i];\n        logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}`);\n        const newMk = await (0,_crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        newSelectedMks[i] = newMk; // 使用重算后的新 message_id (即 i) 作为索引\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n    // 5. 更新 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n        _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n        return meta;\n    });\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n    // ==================================================================\n    // 【保险机制】 - 已于 2025/10/02 移除\n    //\n    // **历史原因**:\n    // 该机制最初是为了解决一个旧架构下的“内容-变量错位”问题。在旧架构中，当删除一条 swipe 时，\n    // 后一条 swipe 的内容会“顶替”上来，但其底层的消息变量（及其 MK）却保持不变。\n    // 这导致主同步逻辑的 MK 比对失效，无法发现状态变化。\n    // 为此，保险机制被设计为：通过 `oldSelectedMks`（状态变更前的快照）找到被删除的旧 MK，\n    // 强制回滚它，然后根据当前可见的新内容重新写入变量，从而修复错位。\n    //\n    // **当前架构下的情况与移除原因**:\n    // 在当前架构中，MK 已被直接写入消息内容，与内容强绑定。当 swipe 导致内容变化时，MK 也会随之变化。\n    // 这使得主同步逻辑（逆序回滚、顺序重算）已经能够完全、正确地处理 swipe 等场景，不再需要此保险机制。\n    //\n    // 继续保留该机制不仅是冗余的，而且会主动引发 Bug：\n    // 它依然按照旧逻辑，使用 `oldSelectedMks` 回滚一个过时的、不相关的 MK，这会破坏主逻辑刚刚同步好的正确状态。\n    // 随后，在被破坏的状态上进行的重写操作会失败或产生错误结果（例如，生成一个空的 EditLog），\n    // 并覆盖掉之前由主逻辑正确生成的 EditLog，导致数据丢失。\n    //\n    // 综上，该机制已从“保险”变为“风险”，因此被完全注释掉。\n    // ==================================================================\n    // logger.log('resyncStateOnHistoryChange', '执行【保险机制】：无条件回滚并重写最后一楼...');\n    // const lastWrittenMk = [...oldSelectedMks].reverse().find(mk => mk);\n    // if (lastWrittenMk) {\n    //   logger.log('resyncStateOnHistoryChange', `找到最后一个写入的MK: ${lastWrittenMk}，执行回滚...`);\n    //   await rollbackByMk(lastWrittenMk, true);\n    //   logger.log('resyncStateOnHistoryChange', '回滚完成，准备根据当前最后一楼内容重写...');\n    //   await ApplyVarChange(); // ApplyVarChange 默认处理最后一楼\n    //   logger.log('resyncStateOnHistoryChange', '保险性重写完成。');\n    // } else {\n    //   logger.log('resyncStateOnHistoryChange', '未找到任何可供回滚的旧MK，跳过保险机制。');\n    // }\n};\n/**\n * **【强制同步最后一条AI消息】**\n * 这是一个用于特定场景的函数，例如由外部 API 触发，需要强制重算最后一条 AI 消息的变量。\n * 它解决了在消息内容被外部修改（但 MK 未变）时，状态无法自动更新的问题。\n *\n * **执行逻辑**:\n * 1. **定位**: 找到最后一条 AI 消息。\n * 2. **回滚**: 如果该消息存在且有 MK，则无条件回滚此 MK 引入的所有变量修改。\n * 3. **重算**: 立即根据该消息的**当前内容**重新计算变量，并生成新的 `EditLog`。\n * 4. **更新**: 将新的 MK 更新到 `SelectedMks` 数组的正确位置。\n *\n * **安全性**:\n * 此函数操作目标明确（最后一条 AI 消息），且回滚和重算在同一调用链中完成，\n * 避免了旧“保险机制”中因目标不明确而破坏 `resync` 状态的风险。\n */\nconst forceSyncLastAiMessage = async () => {\n    logger.log('forceSyncLastAiMessage', '启动强制同步最后一条 AI 消息...');\n    // 1. 定位\n    const msg = (0,_utils_message_utils__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.warn('forceSyncLastAiMessage', '未找到可供强制同步的 AI 消息。');\n        return;\n    }\n    const messageId = msg.message_id;\n    const MK = (0,_key_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!MK) {\n        logger.warn('forceSyncLastAiMessage', `消息 (ID: ${messageId}) 不含 MK，无法执行强制同步。将转为执行常规写入...`);\n        // 如果没有 MK，说明是新消息，直接走标准写入流程即可\n        await (0,_crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        return;\n    }\n    logger.log('forceSyncLastAiMessage', `目标消息 (ID: ${messageId}, MK: ${MK})。`);\n    // 2. 回滚\n    logger.debug('forceSyncLastAiMessage', `正在回滚 MK: ${MK}...`);\n    await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(MK, true); // silent=true，避免不必要的日志刷新\n    // 3. 重算\n    logger.debug('forceSyncLastAiMessage', `回滚完成，正在根据当前内容重算 MK: ${MK}...`);\n    const newMK = await (0,_crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n    // 4. 更新 SelectedMks\n    if (newMK) {\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n                selectedMks[messageId] = newMK;\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n                return meta;\n            });\n            logger.log('forceSyncLastAiMessage', `强制同步完成，已更新 SelectedMks[${messageId}] = ${newMK}`);\n        }\n        catch (e) {\n            logger.error('forceSyncLastAiMessage', `强制同步后更新 SelectedMks 失败: ${e?.message || e}`, e);\n        }\n    }\n    else {\n        logger.error('forceSyncLastAiMessage', `重算后未能获取新的 MK，SelectedMks 可能未更新。`);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvc3luYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWE7QUFFYjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFFc0Q7QUFDTjtBQUNRO0FBQ2pCO0FBQ3dCO0FBQ3JCO0FBQ1A7QUFDc0M7QUFFNUUsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBRWxDOzs7O0dBSUc7QUFDSCxNQUFNLFlBQVksR0FBRyxDQUFDLEdBQVEsRUFBaUIsRUFBRTtJQUMvQyxNQUFNLEdBQUcsR0FBRyxnRUFBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLElBQUksQ0FBQyxHQUFHO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFFdEIsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDLENBQUM7QUFFRjs7OztHQUlHO0FBQ0gsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLEdBQXNCLEVBQVcsRUFBRTtJQUNoRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLDJEQUFVLEVBQUUsQ0FBQztJQUN4QyxLQUFLLE1BQU0sRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxFQUFFO1lBQUUsU0FBUyxDQUFDLGlCQUFpQjtRQUNwQyxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLHVEQUFTLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwRCxNQUFNLE9BQU8sR0FBRyx5REFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3pDLElBQUksT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN2QixPQUFPLEtBQUssQ0FBQyxDQUFDLHdCQUF3QjtRQUN4QyxDQUFDO0lBQ0gsQ0FBQztJQUNELE9BQU8sSUFBSSxDQUFDLENBQUMsYUFBYTtBQUM1QixDQUFDLENBQUM7QUFFRjs7OztHQUlHO0FBQ0ksTUFBTSwwQkFB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QUN2RSxNQUFNLEtBQUssR0FBRyxNQUFNLHlGQUF3QixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWxELG9CQUFvQjtJQUNwQixJQUFJLEtBQUssRUFBRSxDQUFDO1FBQ1YsSUFBSSxDQUFDO1lBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDN0IsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsc0RBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDOUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssQ0FBQztnQkFDL0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsc0RBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQztnQkFDbkMsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLEVBQUUsMEJBQTBCLFNBQVMsT0FBTyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzFGLENBQUM7UUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMsd0JBQXdCLEVBQUUsMkJBQTJCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUYsQ0FBQztJQUNILENBQUM7U0FBTSxDQUFDO1FBQ04sTUFBTSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxpQ0FBaUMsQ0FBQyxDQUFDO0lBQzVFLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3N5bmMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEBmaWxlIOeKtuaAgeWQjOatpeaguOW/g1xuICogQGRlc2NyaXB0aW9uIOacrOaWh+S7tuS4reeahCBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOaYryBFUkEg5Y+Y6YeP5qGG5p625pyA5qC45b+D55qE5Ye95pWw5LmL5LiA44CCXG4gKiDlroPpgJrov4flrp7njrDigJzpgIbluo/lm57mu5rvvIzpobrluo/ph43nrpfigJ3nmoTpgLvovpHvvIzop6PlhrPkuoblm6Dmtojmga/liKDpmaTjgIHliIfmjaLliIbmlK8gKHN3aXBlKSDnrYnmk43kvZzlr7zoh7TnmoTlj5jph4/nirbmgIHkuI7mtojmga/ljoblj7LkuI3kuIDoh7TnmoTmo5jmiYvpl67popjjgIJcbiAqXG4gKiAjIyMg6YWS6aaG55qE5aWH54m56KGM5Li6IChGZWF0dXJlLCBub3QgYSBidWcpXG4gKlxuICog5b2T5Yig6Zmk5LiA5p2hIHN3aXBlICjkvovlpoLvvIzluKbmnInlj5jph48gaWQ9MiDnmoTmtojmga8pIOaXtu+8mlxuICogMS4gKirlhoXlrrnkuI7lj5jph4/plJnkvY0qKjog5ZCO5LiA5p2hIHN3aXBlIChpZD0zKSDnmoQqKuWGheWuuSoq5Lya4oCc6aG24oCd5Yiw6KKr5Yig6Zmk55qEIHN3aXBlIChpZD0yKSDnmoTkvY3nva7kuIrvvIzkvYYqKuWPmOmHjyoq5Y205L+d55WZ5LqGIGlkPTIg55qE5Y+Y6YeP44CCXG4gKiAyLiAqKuWtpOWEv+WPmOmHj+aui+eVmSoqOiDljp/mnKznmoQgc3dpcGUgMyDmtojmga/omb3nhLblnKjnlYzpnaLkuIrmtojlpLHkuobvvIzkvYblroPlr7nlupTnmoQqKua2iOaBr+WPmOmHjyoqIChpZD0zKSDku43nhLbmrovnlZnlnKjogYrlpKnmlbDmja7kuK3vvIzmiJDkuLrigJzlraTlhL/lj5jph4/igJ3jgIJcbiAqIDMuICoq5a2k5YS/5Y+Y6YeP57un5om/Kio6IOWmguaenOeUqOaIt+atpOaXtuWGjSBzd2lwZSDkuIDmrKHvvIzmlrDnlJ/miJDnmoQgc3dpcGUgMyDlsIbkvJoqKue7p+aJvyoq6L+Z5Liq5q6L55WZ55qE5a2k5YS/5Y+Y6YePIChpZD0zKe+8jOWvvOiHtOaWsOWGheWuuemFjeaXp+WPmOmHj++8jOi/m+S4gOatpeWKoOWJp+eKtuaAgea3t+S5seOAglxuICogNC4gKirnu5PmnpwqKjog5oiR5Lus5b6X5Yiw5LqG5LiA5Liq5YaF5a655pivIGlkPTPjgIHlj5jph4/mmK8gaWQ9MiDnmoTigJzmt7flkIjigJ3mtojmga/vvIzlubbkuJTov5jmnInkuIDkuKogaWQ9MyDnmoTlraTlhL/lj5jph4/pmo/ml7blj6/og73ooqvmlrDmtojmga/nu6fmib/vvIzpgKDmiJDkuKXph43nmoTnirbmgIHkuI3kuIDoh7TjgIJcbiAqXG4gKiAjIyMg5pys5Ye95pWw55qE6Kej5Yaz562W55WlXG4gKlxuICogYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDpgJrov4flhajpnaLnmoTnirbmgIHmr5Tlr7nmnaXop6PlhrPmraTpl67popjvvJpcbiAqIDEuIOWcqCBgbWVzc2FnZV9kZWxldGVkYCwgYG1lc3NhZ2Vfc3dpcGVkYCDnrYnkuovku7bop6blj5Hml7booqvosIPnlKjjgIJcbiAqIDIuIOWFqOmdouiOt+WPluW9k+WJjeWunumZheeahOa2iOaBr+WIl+ihqO+8jOW5tuS4juS5i+WJjeiusOW9leeahCBgU2VsZWN0ZWRNa3NgIOW6j+WIl+i/m+ihjOavlOWvueOAglxuICogMy4g57K+56Gu5om+5Yiw56ys5LiA5Liq5LiN5LiA6Ie055qE54K577yI5peg6K665piv5Yig6Zmk44CB6L+Y5piv5L+u5pS577yJ44CCXG4gKiA0LiAqKumAhuW6j+Wbnua7mioqOiDku47lkI7lvoDliY3vvIzlsIbmiYDmnInkuI3kuIDoh7TnmoQgYE1LYCDmiYDlvJXlhaXnmoTlj5jph4/kv67mlLnlhajpg6jmkqTplIDjgIJcbiAqIDUuICoq6aG65bqP6YeN566XKio6IOS7juS4jeS4gOiHtOeCueW8gOWni++8jOagueaNruW9k+WJjea2iOaBr+eahCoq5a6e6ZmF5YaF5a65KirvvIzph43mlrDorqHnrpflubblhpnlhaXlj5jph4/jgIJcbiAqXG4gKiAqKuacgOe7iOaViOaenCoqOiDml6Dorrrljoblj7LorrDlvZXlj5HnlJ/kvZXnp43lj5jljJbvvIzlj5jph4/nirbmgIHpg73og73ooqvlroznvo7lnLDoh6rliqjkv67lpI3vvIznoa7kv53mlbDmja7kuIDoh7TmgKfjgIJcbiAqL1xuXG5pbXBvcnQgeyBMT0dTX1BBVEgsIFNFTF9QQVRIIH0gZnJvbSAnLi4vdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IHJlYWRNZXNzYWdlS2V5IH0gZnJvbSAnLi9rZXkvbWVzc2FnZV9rZXknO1xuaW1wb3J0IHsgZmluZExhc3RBaU1lc3NhZ2UgfSBmcm9tICcuLi91dGlscy9tZXNzYWdlX3V0aWxzJztcbmltcG9ydCB7IHJvbGxiYWNrQnlNayB9IGZyb20gJy4vcm9sbGJhY2snO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgdXBkYXRlRXJhTWV0YURhdGEgfSBmcm9tICcuLi91dGlscy9lcmFfZGF0YSc7XG5pbXBvcnQgeyBwYXJzZUVkaXRMb2cgfSBmcm9tICcuLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UgfSBmcm9tICcuL2NydWQvdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvcic7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3N5bmMnKTtcblxuLyoqXG4gKiDojrflj5bnlKjkuo7lj5jph4/mk43kvZznmoRNS+OAguWmguaenOa2iOaBr+aYr+eUqOaIt+a2iOaBr++8jOWImei/lOWbnm51bGzku6Xot7Pov4fmk43kvZzjgIJcbiAqIEBwYXJhbSBtc2cg5raI5oGv5a+56LGhXG4gKiBAcmV0dXJucyBNSyDlrZfnrKbkuLLmiJYgbnVsbFxuICovXG5jb25zdCBnZXRNa0Zyb21Nc2cgPSAobXNnOiBhbnkpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgY29uc3Qga2V5ID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKCFrZXkpIHJldHVybiBudWxsO1xuXG4gIHJldHVybiBrZXk7XG59O1xuXG4vKipcbiAqIOajgOafpeS4gOe7hCBNSyDlr7nlupTnmoQgRWRpdExvZyDmmK/lkKbpg73kuLrnqbpcbiAqIEBwYXJhbSBta3MgTUsg5YiX6KGoXG4gKiBAcmV0dXJucyDlpoLmnpzmiYDmnIkgRWRpdExvZyDpg73kuLrnqbrliJnov5Tlm54gdHJ1ZVxuICovXG5jb25zdCBjaGVja0VkaXRMb2dzQXJlRW1wdHkgPSAobWtzOiAoc3RyaW5nIHwgbnVsbClbXSk6IGJvb2xlYW4gPT4ge1xuICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gIGZvciAoY29uc3QgbWsgb2YgbWtzKSB7XG4gICAgaWYgKCFtaykgY29udGludWU7IC8vIOi3s+i/hyBudWxsICjnlKjmiLfmtojmga8pXG4gICAgY29uc3QgZWRpdExvZ1JhdyA9IF8uZ2V0KG1ldGFEYXRhLCBbTE9HU19QQVRILCBta10pO1xuICAgIGNvbnN0IGVkaXRMb2cgPSBwYXJzZUVkaXRMb2coZWRpdExvZ1Jhdyk7XG4gICAgaWYgKGVkaXRMb2cubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlOyAvLyDlj5HnjrDkuIDkuKrpnZ7nqbogbG9n77yM55u05o6l6L+U5ZueIGZhbHNlXG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlOyAvLyDmiYDmnIkgbG9nIOmDveS4uuepulxufTtcblxuLyoqXG4gKiDlvZPogYrlpKnorrDlvZXlj5HnlJ/lj5jljJbvvIjliKDpmaTjgIHliIfmjaLliIbmlK/vvInml7bvvIzph43mlrDlkIzmraXnirbmgIHnmoTmoLjlv4Plh73mlbBcbiAqIOWunueOsOS6huKAnOmAhuW6j+Wbnua7mu+8jOmhuuW6j+mHjeeul+KAneeahOmAu+i+kVxuICogQHBhcmFtIHtib29sZWFufSBbZm9yY2VGdWxsUmVzeW5jPWZhbHNlXSAtIOWmguaenOS4uiB0cnVl77yM5YiZ5by65Yi25LuO5aS05byA5aeL5a6M5YWo6YeN566X77yM5b+955Wl5beu5byC5qOA5rWL44CCXG4gKi9cbmV4cG9ydCBjb25zdCByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSA9IGFzeW5jIChmb3JjZUZ1bGxSZXN5bmMgPSBmYWxzZSkgPT4ge1xuICBpZiAoZm9yY2VGdWxsUmVzeW5jKSB7XG4gICAgbG9nZ2VyLndhcm4oJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W8uuWItuWujOWFqOmHjeeul+aooeW8j+W3suWQr+WKqO+8gScpO1xuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+iBiuWkqeiusOW9leWPmOabtO+8jOWQr+WKqOeKtuaAgeWQjOatpS4uLicpO1xuICB9XG5cbiAgLy8g5qC45b+D5YGH6K6+77yaZ2V0Q2hhdE1lc3NhZ2VzIOS8mumHjeaWsOeUn+aIkCBtZXNzYWdlX2lk77yM5L2/5YW25L+d5oyB5LuOIDAg5byA5aeL55qE6L+e57ut5bqP5YiX44CCXG4gIGNvbnN0IGFsbE1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19JywgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KTtcbiAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfojrflj5bliLDnmoQgYWxsTWVzc2FnZXM6JywgYWxsTWVzc2FnZXMpO1xuICBjb25zdCB7IG1ldGE6IG9sZE1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gIGNvbnN0IG9sZFNlbGVjdGVkTWtzOiAoc3RyaW5nIHwgbnVsbClbXSA9IF8uY2xvbmVEZWVwKF8uZ2V0KG9sZE1ldGFEYXRhLCBTRUxfUEFUSCwgW10pKTtcblxuICBsb2dnZXIuZGVidWcoXG4gICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICBg54q25oCB5b+r54WnOiBvbGRTZWxlY3RlZE1rcy5sZW5ndGg9JHtvbGRTZWxlY3RlZE1rcy5sZW5ndGh9LCBhbGxNZXNzYWdlcy5sZW5ndGg9JHthbGxNZXNzYWdlcz8ubGVuZ3RoID8/IDB9YCxcbiAgKTtcblxuICBpZiAoIWFsbE1lc3NhZ2VzIHx8IGFsbE1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W9k+WJjeiBiuWkqeiusOW9leS4uuepuu+8jOS4jeaJp+ihjOS7u+S9leaTjeS9nO+8jOWQjOatpee7iOatouOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBmaXJzdFJlY2FsY0lkID0gLTE7XG5cbiAgaWYgKGZvcmNlRnVsbFJlc3luYykge1xuICAgIGZpcnN0UmVjYWxjSWQgPSAwO1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W8uuWItuaooeW8j++8muiuvue9rumHjeeul+i1t+eCueS4uiAw44CCJyk7XG4gIH1cbiAgLy8gQ2FzZSAxOiDmtojmga/ooqvliKDpmaQgKOaWsOWIl+ihqOavlOaXp+WIl+ihqOefrSlcbiAgZWxzZSBpZiAoYWxsTWVzc2FnZXMubGVuZ3RoIDwgb2xkU2VsZWN0ZWRNa3MubGVuZ3RoKSB7XG4gICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5qOA5rWL5Yiw5raI5oGv5Yig6Zmk44CCJyk7XG4gICAgLy8g5LuO5ZCO5b6A5YmN77yM5a+75om+56ys5LiA5LiqIFwiY3VycmVudE1rID09PSBvbGRNa19hdF9zYW1lX2luZGV4XCIg55qE5a+56b2Q54K5XG4gICAgZm9yIChsZXQgaSA9IGFsbE1lc3NhZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBjdXJyZW50TWsgPSBnZXRNa0Zyb21Nc2coYWxsTWVzc2FnZXNbaV0pO1xuICAgICAgY29uc3QgcmVjb3JkZWRNayA9IG9sZFNlbGVjdGVkTWtzW2ldO1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBgW+WIoOmZpC3lr7npvZDmo4Dmn6VdIGk9JHtpfSwgY3VycmVudE1rPSR7Y3VycmVudE1rfSwgcmVjb3JkZWRNaz0ke3JlY29yZGVkTWt9YCxcbiAgICAgICk7XG5cbiAgICAgIGlmIChjdXJyZW50TWsgPT09IHJlY29yZGVkTWspIHtcbiAgICAgICAgZmlyc3RSZWNhbGNJZCA9IGkgKyAxO1xuICAgICAgICBsb2dnZXIubG9nKFxuICAgICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgICAgYOaJvuWIsOWvuem9kOeCueS6jiBtZXNzYWdlX2lkPSR7aX0gKE1LPSR7Y3VycmVudE1rfSnjgILlsIbku44gSUQgJHtmaXJzdFJlY2FsY0lkfSDlvIDlp4vmo4Dmn6XjgIJgLFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpcnN0UmVjYWxjSWQgPT09IC0xKSB7XG4gICAgICBmaXJzdFJlY2FsY0lkID0gMDtcbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+acquaJvuWIsOS7u+S9leWvuem9kOeCue+8jOWwhuS7juWktOW8gOWni+ajgOafpeOAgicpO1xuICAgIH1cblxuICAgIC8vIOOAkOS8mOWMluOAkeajgOafpeiiq+WIoOmZpOeahCBNSyDmmK/lkKblvbHlk43lj5jph49cbiAgICAvLyDnqLPlgaXlnLDmib7lh7rooqvliKDpmaTnmoQgTUvvvJrlr7nmr5TmlrDml6cgTUsg5bqP5YiX55qE5beu5byCXG4gICAgY29uc3QgY3VycmVudE1rU2VxdWVuY2UgPSBhbGxNZXNzYWdlcy5tYXAoZ2V0TWtGcm9tTXNnKS5maWx0ZXIobWsgPT4gbWspO1xuICAgIGNvbnN0IG9sZE1rU2VxdWVuY2UgPSBvbGRTZWxlY3RlZE1rcy5maWx0ZXIobWsgPT4gbWspO1xuICAgIGNvbnN0IGRlbGV0ZWRNa3MgPSBfLmRpZmZlcmVuY2Uob2xkTWtTZXF1ZW5jZSwgY3VycmVudE1rU2VxdWVuY2UpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDml6dNS+W6j+WIlzogWyR7b2xkTWtTZXF1ZW5jZS5qb2luKCcsICcpfV1gKTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaWsE1L5bqP5YiXOiBbJHtjdXJyZW50TWtTZXF1ZW5jZS5qb2luKCcsICcpfV1gKTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOiuoeeul+WHuueahOiiq+WIoOmZpE1LOiBbJHtkZWxldGVkTWtzLmpvaW4oJywgJyl9XWApO1xuXG4gICAgaWYgKGRlbGV0ZWRNa3MubGVuZ3RoID4gMCAmJiBjaGVja0VkaXRMb2dzQXJlRW1wdHkoZGVsZXRlZE1rcykpIHtcbiAgICAgIGxvZ2dlci5sb2coXG4gICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgIGDmo4DmtYvliLDooqvliKDpmaTnmoQgJHtkZWxldGVkTWtzLmxlbmd0aH0g5p2h5raI5oGv5Z2H5LiN5ZCr5Y+Y6YeP5L+u5pS577yM5omn6KGM5b+r6YCf5ZCM5q2l44CCYCxcbiAgICAgICk7XG4gICAgICBjb25zdCBuZXdTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsTWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbmV3U2VsZWN0ZWRNa3NbaV0gPSBnZXRNa0Zyb21Nc2coYWxsTWVzc2FnZXNbaV0pO1xuICAgICAgfVxuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBuZXdTZWxlY3RlZE1rcyk7XG4gICAgICAgIHJldHVybiBtZXRhO1xuICAgICAgfSk7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflv6vpgJ/lkIzmraXlrozmiJDvvIzku4Xkv67mraMgU2VsZWN0ZWRNa3Mg5pWw57uE44CCJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIC8vIENhc2UgMjog5raI5oGv6KKr5L+u5pS5L+WIh+aNoiAo6ZW/5bqm5LiN5Y+YKVxuICBlbHNlIGlmIChhbGxNZXNzYWdlcy5sZW5ndGggPT09IG9sZFNlbGVjdGVkTWtzLmxlbmd0aCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+mVv+W6puS4jeWPmO+8jOWPr+iDveS4uuS/ruaUueaIluWIh+aNouOAgicpO1xuICAgIC8vIOS7juWQjuW+gOWJje+8jOWvu+aJvuesrOS4gOS4quS4jeWMuemFjeeahOeCuVxuICAgIGZvciAobGV0IGkgPSBhbGxNZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgY3VycmVudE1rID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIGNvbnN0IHJlY29yZGVkTWsgPSBvbGRTZWxlY3RlZE1rc1tpXTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgICAgYFvliIfmjaIt5a+56b2Q5qOA5p+lXSBpPSR7aX0sIGN1cnJlbnRNaz0ke2N1cnJlbnRNa30sIHJlY29yZGVkTWs9JHtyZWNvcmRlZE1rfWAsXG4gICAgICApO1xuICAgICAgaWYgKGN1cnJlbnRNayAhPT0gcmVjb3JkZWRNaykge1xuICAgICAgICBmaXJzdFJlY2FsY0lkID0gaTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpcnN0UmVjYWxjSWQgPT09IC0xKSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmiYDmnIlNS+Wdh+WMuemFje+8jOaXoOmcgOmHjeeul+OAgicpO1xuICAgICAgLy8gTi5CLiDlnKjlvZPliY3mnrbmnoTkuIvvvIxNSyDlt7Looqvnm7TmjqXlhpnlhaXmtojmga/lhoXlrrnvvIzkuI7lhoXlrrnlvLrnu5HlrprjgIJcbiAgICAgIC8vIOWboOatpO+8jOS7u+S9leWvvOiHtOWGheWuueWPmOWMlueahOaTjeS9nO+8iOWmgiBzd2lwZe+8ieS5n+W/heeEtuS8muWvvOiHtCBNSyDnmoTlj5jljJbjgIJcbiAgICAgIC8vIOi/meaEj+WRs+edgO+8jOWmguaenCBNSyDluo/liJflrozlhajljLnphY3vvIzpgqPkuYjlhoXlrrnkuZ/lv4XnhLblrozlhajljLnphY3vvIzml6DpnIDov5vooYzku7vkvZXph43nrpfmiJbkv53pmanmgKfmo4Dmn6XjgIJcbiAgICAgIHJldHVybjsgLy8g55u05o6l6L+U5Zue77yM57uI5q2i5ZCM5q2l44CCXG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaJvuWIsOacgOaXqeeahOS4jeWMuemFjeeCueS6jiBtZXNzYWdlX2lkPSR7Zmlyc3RSZWNhbGNJZH3jgILlsIbku47or6XngrnlvIDlp4vph43nrpfjgIJgKTtcbiAgICB9XG4gIH1cbiAgLy8gQ2FzZSAzOiDmtojmga/ooqvmt7vliqAgKOaWsOWIl+ihqOavlOaXp+WIl+ihqOmVvylcbiAgZWxzZSB7XG4gICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5qOA5rWL5Yiw5raI5oGv5re75Yqg44CCJyk7XG4gICAgLy8g5bCG6YeN566X6LW354K56K6+572u5Li65paw5raI5oGv55qE6LW35aeL57Si5byV77yM6K6p5ZCM5q2l5rWB56iL57uf5LiA5aSE55CGXG4gICAgZmlyc3RSZWNhbGNJZCA9IG9sZFNlbGVjdGVkTWtzLmxlbmd0aDtcbiAgICBsb2dnZXIubG9nKFxuICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgIGDmlrDlop7mtojmga/nmoTlhpnlhaXpgLvovpHlt7LnlLHlkIzmraXmtYHnqIvmjqXnrqHjgILlsIbku47mlrDlop7mtojmga8gKElEOiAke2ZpcnN0UmVjYWxjSWR9KSDlvIDlp4vlpITnkIbjgIJgLFxuICAgICk7XG4gIH1cblxuICAvLyAzLiDmlLbpm4bpnIDopoHlm57mu5rnmoQgTUsg5YiX6KGo77yM5bm25omn6KGM6YCG5bqP5Zue5ruaXG4gIGlmIChmaXJzdFJlY2FsY0lkID4gLTEpIHtcbiAgICBjb25zdCBta3NUb1JvbGxiYWNrID0gb2xkU2VsZWN0ZWRNa3Muc2xpY2UoZmlyc3RSZWNhbGNJZCkuZmlsdGVyKG1rID0+IG1rKSBhcyBzdHJpbmdbXTtcbiAgICBpZiAobWtzVG9Sb2xsYmFjay5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDlh4blpIflm57mu5ogJHtta3NUb1JvbGxiYWNrLmxlbmd0aH0g5LiqTUs6IFske21rc1RvUm9sbGJhY2suam9pbignLCAnKX1dYCk7XG4gICAgICBmb3IgKGNvbnN0IG1rIG9mIG1rc1RvUm9sbGJhY2sucmV2ZXJzZSgpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBgW+Wbnua7ml0g5q2j5Zyo5Zue5ruaIE1LOiAke21rfWApO1xuICAgICAgICBhd2FpdCByb2xsYmFja0J5TWsobWssIHRydWUpOyAvLyB0cnVlIOihqOekuuWPquWbnua7mu+8jOS4jemHjeWGmVxuICAgICAgfVxuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn6YCG5bqP5Zue5rua5a6M5oiQ44CCJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gNC4g5LuO5LiN5Yy56YWN54K55byA5aeL77yM6aG65bqP6YeN5paw5bqU55So5Y+Y6YeP5L+u5pS577yM5bm25p6E5bu65paw55qEIHNlbGVjdGVkTWtzXG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOS7jiBJRCAke2ZpcnN0UmVjYWxjSWR9IOW8gOWni+mhuuW6j+mHjeeuly4uLmApO1xuICBjb25zdCBuZXdTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBvbGRTZWxlY3RlZE1rcy5zbGljZSgwLCBmaXJzdFJlY2FsY0lkKTsgLy8g57un5om/5Yy56YWN6YOo5YiGXG5cbiAgZm9yIChsZXQgaSA9IGZpcnN0UmVjYWxjSWQ7IGkgPCBhbGxNZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IG1zZyA9IGFsbE1lc3NhZ2VzW2ldO1xuICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBgW+mHjeeul10g5q2j5Zyo5aSE55CG5raI5oGv57Si5byVOiAke2l9YCk7XG4gICAgY29uc3QgbmV3TWsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcbiAgICBuZXdTZWxlY3RlZE1rc1tpXSA9IG5ld01rOyAvLyDkvb/nlKjph43nrpflkI7nmoTmlrAgbWVzc2FnZV9pZCAo5Y2zIGkpIOS9nOS4uue0ouW8lVxuICB9XG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+mhuuW6j+mHjeeul+WujOaIkOOAgicpO1xuXG4gIC8vIDUuIOabtOaWsCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIG5ld1NlbGVjdGVkTWtzKTtcbiAgICByZXR1cm4gbWV0YTtcbiAgfSk7XG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+eKtuaAgeWQjOatpeWujOaIkOOAgicpO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDjgJDkv53pmanmnLrliLbjgJEgLSDlt7Lkuo4gMjAyNS8xMC8wMiDnp7vpmaRcbiAgLy9cbiAgLy8gKirljoblj7Lljp/lm6AqKjpcbiAgLy8g6K+l5py65Yi25pyA5Yid5piv5Li65LqG6Kej5Yaz5LiA5Liq5pen5p625p6E5LiL55qE4oCc5YaF5a65LeWPmOmHj+mUmeS9jeKAnemXrumimOOAguWcqOaXp+aetuaehOS4re+8jOW9k+WIoOmZpOS4gOadoSBzd2lwZSDml7bvvIxcbiAgLy8g5ZCO5LiA5p2hIHN3aXBlIOeahOWGheWuueS8muKAnOmhtuabv+KAneS4iuadpe+8jOS9huWFtuW6leWxgueahOa2iOaBr+WPmOmHj++8iOWPiuWFtiBNS++8ieWNtOS/neaMgeS4jeWPmOOAglxuICAvLyDov5nlr7zoh7TkuLvlkIzmraXpgLvovpHnmoQgTUsg5q+U5a+55aSx5pWI77yM5peg5rOV5Y+R546w54q25oCB5Y+Y5YyW44CCXG4gIC8vIOS4uuatpO+8jOS/nemZqeacuuWItuiiq+iuvuiuoeS4uu+8mumAmui/hyBgb2xkU2VsZWN0ZWRNa3Ng77yI54q25oCB5Y+Y5pu05YmN55qE5b+r54Wn77yJ5om+5Yiw6KKr5Yig6Zmk55qE5penIE1L77yMXG4gIC8vIOW8uuWItuWbnua7muWug++8jOeEtuWQjuagueaNruW9k+WJjeWPr+ingeeahOaWsOWGheWuuemHjeaWsOWGmeWFpeWPmOmHj++8jOS7juiAjOS/ruWkjemUmeS9jeOAglxuICAvL1xuICAvLyAqKuW9k+WJjeaetuaehOS4i+eahOaDheWGteS4juenu+mZpOWOn+WboCoqOlxuICAvLyDlnKjlvZPliY3mnrbmnoTkuK3vvIxNSyDlt7Looqvnm7TmjqXlhpnlhaXmtojmga/lhoXlrrnvvIzkuI7lhoXlrrnlvLrnu5HlrprjgILlvZMgc3dpcGUg5a+86Ie05YaF5a655Y+Y5YyW5pe277yMTUsg5Lmf5Lya6ZqP5LmL5Y+Y5YyW44CCXG4gIC8vIOi/meS9v+W+l+S4u+WQjOatpemAu+i+ke+8iOmAhuW6j+Wbnua7muOAgemhuuW6j+mHjeeul++8ieW3sue7j+iDveWkn+WujOWFqOOAgeato+ehruWcsOWkhOeQhiBzd2lwZSDnrYnlnLrmma/vvIzkuI3lho3pnIDopoHmraTkv53pmanmnLrliLbjgIJcbiAgLy9cbiAgLy8g57un57ut5L+d55WZ6K+l5py65Yi25LiN5LuF5piv5YaX5L2Z55qE77yM6ICM5LiU5Lya5Li75Yqo5byV5Y+RIEJ1Z++8mlxuICAvLyDlroPkvp3nhLbmjInnhafml6fpgLvovpHvvIzkvb/nlKggYG9sZFNlbGVjdGVkTWtzYCDlm57mu5rkuIDkuKrov4fml7bnmoTjgIHkuI3nm7jlhbPnmoQgTUvvvIzov5nkvJrnoLTlnY/kuLvpgLvovpHliJrliJrlkIzmraXlpb3nmoTmraPnoa7nirbmgIHjgIJcbiAgLy8g6ZqP5ZCO77yM5Zyo6KKr56C05Z2P55qE54q25oCB5LiK6L+b6KGM55qE6YeN5YaZ5pON5L2c5Lya5aSx6LSl5oiW5Lqn55Sf6ZSZ6K+v57uT5p6c77yI5L6L5aaC77yM55Sf5oiQ5LiA5Liq56m655qEIEVkaXRMb2fvvInvvIxcbiAgLy8g5bm26KaG55uW5o6J5LmL5YmN55Sx5Li76YC76L6R5q2j56Gu55Sf5oiQ55qEIEVkaXRMb2fvvIzlr7zoh7TmlbDmja7kuKLlpLHjgIJcbiAgLy9cbiAgLy8g57u85LiK77yM6K+l5py65Yi25bey5LuO4oCc5L+d6Zmp4oCd5Y+Y5Li64oCc6aOO6Zmp4oCd77yM5Zug5q2k6KKr5a6M5YWo5rOo6YeK5o6J44CCXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmiafooYzjgJDkv53pmanmnLrliLbjgJHvvJrml6DmnaHku7blm57mu5rlubbph43lhpnmnIDlkI7kuIDmpbwuLi4nKTtcbiAgLy8gY29uc3QgbGFzdFdyaXR0ZW5NayA9IFsuLi5vbGRTZWxlY3RlZE1rc10ucmV2ZXJzZSgpLmZpbmQobWsgPT4gbWspO1xuICAvLyBpZiAobGFzdFdyaXR0ZW5Naykge1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaJvuWIsOacgOWQjuS4gOS4quWGmeWFpeeahE1LOiAke2xhc3RXcml0dGVuTWt977yM5omn6KGM5Zue5ruaLi4uYCk7XG4gIC8vICAgYXdhaXQgcm9sbGJhY2tCeU1rKGxhc3RXcml0dGVuTWssIHRydWUpO1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+Wbnua7muWujOaIkO+8jOWHhuWkh+agueaNruW9k+WJjeacgOWQjuS4gOalvOWGheWuuemHjeWGmS4uLicpO1xuICAvLyAgIGF3YWl0IEFwcGx5VmFyQ2hhbmdlKCk7IC8vIEFwcGx5VmFyQ2hhbmdlIOm7mOiupOWkhOeQhuacgOWQjuS4gOalvFxuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+S/nemZqeaAp+mHjeWGmeWujOaIkOOAgicpO1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+acquaJvuWIsOS7u+S9leWPr+S+m+Wbnua7mueahOaXp01L77yM6Lez6L+H5L+d6Zmp5py65Yi244CCJyk7XG4gIC8vIH1cbn07XG5cbi8qKlxuICogKirjgJDlvLrliLblkIzmraXmnIDlkI7kuIDmnaFBSea2iOaBr+OAkSoqXG4gKiDov5nmmK/kuIDkuKrnlKjkuo7nibnlrprlnLrmma/nmoTlh73mlbDvvIzkvovlpoLnlLHlpJbpg6ggQVBJIOinpuWPke+8jOmcgOimgeW8uuWItumHjeeul+acgOWQjuS4gOadoSBBSSDmtojmga/nmoTlj5jph4/jgIJcbiAqIOWug+ino+WGs+S6huWcqOa2iOaBr+WGheWuueiiq+WklumDqOS/ruaUue+8iOS9hiBNSyDmnKrlj5jvvInml7bvvIznirbmgIHml6Dms5Xoh6rliqjmm7TmlrDnmoTpl67popjjgIJcbiAqXG4gKiAqKuaJp+ihjOmAu+i+kSoqOlxuICogMS4gKirlrprkvY0qKjog5om+5Yiw5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr+OAglxuICogMi4gKirlm57mu5oqKjog5aaC5p6c6K+l5raI5oGv5a2Y5Zyo5LiU5pyJIE1L77yM5YiZ5peg5p2h5Lu25Zue5rua5q2kIE1LIOW8leWFpeeahOaJgOacieWPmOmHj+S/ruaUueOAglxuICogMy4gKirph43nrpcqKjog56uL5Y2z5qC55o2u6K+l5raI5oGv55qEKirlvZPliY3lhoXlrrkqKumHjeaWsOiuoeeul+WPmOmHj++8jOW5tueUn+aIkOaWsOeahCBgRWRpdExvZ2DjgIJcbiAqIDQuICoq5pu05pawKio6IOWwhuaWsOeahCBNSyDmm7TmlrDliLAgYFNlbGVjdGVkTWtzYCDmlbDnu4TnmoTmraPnoa7kvY3nva7jgIJcbiAqXG4gKiAqKuWuieWFqOaApyoqOlxuICog5q2k5Ye95pWw5pON5L2c55uu5qCH5piO56Gu77yI5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr++8ie+8jOS4lOWbnua7muWSjOmHjeeul+WcqOWQjOS4gOiwg+eUqOmTvuS4reWujOaIkO+8jFxuICog6YG/5YWN5LqG5pen4oCc5L+d6Zmp5py65Yi24oCd5Lit5Zug55uu5qCH5LiN5piO56Gu6ICM56C05Z2PIGByZXN5bmNgIOeKtuaAgeeahOmjjumZqeOAglxuICovXG5leHBvcnQgY29uc3QgZm9yY2VTeW5jTGFzdEFpTWVzc2FnZSA9IGFzeW5jICgpID0+IHtcbiAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsICflkK/liqjlvLrliLblkIzmraXmnIDlkI7kuIDmnaEgQUkg5raI5oGvLi4uJyk7XG5cbiAgLy8gMS4g5a6a5L2NXG4gIGNvbnN0IG1zZyA9IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICBsb2dnZXIud2FybignZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsICfmnKrmib7liLDlj6/kvpvlvLrliLblkIzmraXnmoQgQUkg5raI5oGv44CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcblxuICBpZiAoIU1LKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5raI5oGvIChJRDogJHttZXNzYWdlSWR9KSDkuI3lkKsgTUvvvIzml6Dms5XmiafooYzlvLrliLblkIzmraXjgILlsIbovazkuLrmiafooYzluLjop4TlhpnlhaUuLi5gKTtcbiAgICAvLyDlpoLmnpzmsqHmnIkgTUvvvIzor7TmmI7mmK/mlrDmtojmga/vvIznm7TmjqXotbDmoIflh4blhpnlhaXmtYHnqIvljbPlj69cbiAgICBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2dnZXIubG9nKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOebruagh+a2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSwgTUs6ICR7TUt9KeOAgmApO1xuXG4gIC8vIDIuIOWbnua7mlxuICBsb2dnZXIuZGVidWcoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5q2j5Zyo5Zue5ruaIE1LOiAke01LfS4uLmApO1xuICBhd2FpdCByb2xsYmFja0J5TWsoTUssIHRydWUpOyAvLyBzaWxlbnQ9dHJ1Ze+8jOmBv+WFjeS4jeW/heimgeeahOaXpeW/l+WIt+aWsFxuXG4gIC8vIDMuIOmHjeeul1xuICBsb2dnZXIuZGVidWcoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5Zue5rua5a6M5oiQ77yM5q2j5Zyo5qC55o2u5b2T5YmN5YaF5a656YeN566XIE1LOiAke01LfS4uLmApO1xuICBjb25zdCBuZXdNSyA9IGF3YWl0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZShtc2cpO1xuXG4gIC8vIDQuIOabtOaWsCBTZWxlY3RlZE1rc1xuICBpZiAobmV3TUspIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAgICAgc2VsZWN0ZWRNa3NbbWVzc2FnZUlkXSA9IG5ld01LO1xuICAgICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgc2VsZWN0ZWRNa3MpO1xuICAgICAgICByZXR1cm4gbWV0YTtcbiAgICAgIH0pO1xuICAgICAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDlvLrliLblkIzmraXlrozmiJDvvIzlt7Lmm7TmlrAgU2VsZWN0ZWRNa3NbJHttZXNzYWdlSWR9XSA9ICR7bmV3TUt9YCk7XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5by65Yi25ZCM5q2l5ZCO5pu05pawIFNlbGVjdGVkTWtzIOWksei0pTogJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5lcnJvcignZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDph43nrpflkI7mnKrog73ojrflj5bmlrDnmoQgTUvvvIxTZWxlY3RlZE1rcyDlj6/og73mnKrmm7TmlrDjgIJgKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/sync.ts\n\n}");
  },
  "./src/ERA变量框架/events/dispatcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/events/dispatcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dispatchAndExecuteTask: () => (/* binding */ dispatchAndExecuteTask)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _api_command__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/command */ \"./src/ERA变量框架/api/command.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _api_macro_patch__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../api/macro/patch */ \"./src/ERA变量框架/api/macro/patch.ts\");\n/* harmony import */ var _core_key_message_key__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../core/key/message_key */ \"./src/ERA变量框架/core/key/message_key.ts\");\n/* harmony import */ var _core_rollback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../core/rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _core_sync__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../core/sync */ \"./src/ERA变量框架/core/sync.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _core_crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../core/crud/variable_change_processor */ \"./src/ERA变量框架/core/crud/variable_change_processor.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_9__.Logger('task_dispatcher');\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n/**\n * **【辅助函数】处理由 MK 注入触发的冗余渲染事件**\n * @param eventType - 当前事件的类型。\n * @param currentMk - 当前消息的 MK。\n * @param mkToIgnore - 当前的忽略规则。\n * @returns {{ shouldSkip: boolean; newIgnoreRule: IgnoreRule | null }} - 返回是否应跳过此事件，以及更新后的忽略规则。\n */\nfunction handleRedundantRenderEvent(eventType, currentMk, mkToIgnore) {\n    if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && currentMk === mkToIgnore.mk) {\n        logger.log('handleRedundantRenderEvent', `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`);\n        mkToIgnore.ignoreCount--;\n        if (mkToIgnore.ignoreCount <= 0) {\n            mkToIgnore = null; // 忽略次数用完，重置\n            logger.log('handleRedundantRenderEvent', `忽略次数用完`);\n        }\n        return { shouldSkip: true, newIgnoreRule: mkToIgnore };\n    }\n    return { shouldSkip: false, newIgnoreRule: mkToIgnore };\n}\n/**\n * **【任务执行器】**\n * 负责执行单个事件任务，包含所有前置、后置处理和错误捕获。\n * @param {EventJob} job - 要执行的事件任务。\n * @param {IgnoreRule | null} mkToIgnore - 当前的忽略规则。\n * @param {ConsecutiveMkState | null} consecutiveMkState - 当前的连续处理计数状态。\n * @returns {Promise<{\n *   newIgnoreRule: IgnoreRule | null;\n *   newConsecutiveMkState: ConsecutiveMkState | null;\n * }>} - 返回更新后的状态。\n */\nasync function dispatchAndExecuteTask(job, mkToIgnore, consecutiveMkState) {\n    const { type: eventType, detail } = job;\n    const eventGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_3__.getEventGroup)(eventType);\n    let message_id = null;\n    let currentConsecutiveCount = 1;\n    // 在每轮任务开始时，初始化操作记录器\n    const actionsTaken = { rollback: false, apply: false, resync: false, api: false };\n    try {\n        // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n        const { mk, message_id: msgId, isNewKey } = await (0,_core_key_message_key__WEBPACK_IMPORTED_MODULE_5__.ensureMkForLatestMessage)();\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = mk;\n        message_id = msgId;\n        // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就创建或更新忽略规则。\n        if (isNewKey && mk) {\n            mkToIgnore = {\n                mk: mk,\n                ignoreCount: RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n            };\n        }\n        // **核心优化**: 检查并处理由 MK 注入触发的冗余渲染事件。\n        const { shouldSkip, newIgnoreRule } = handleRedundantRenderEvent(eventType, mk, mkToIgnore);\n        mkToIgnore = newIgnoreRule; // 更新忽略规则的状态\n        if (shouldSkip) {\n            // 如果事件被忽略，则直接返回，不更新连续处理计数\n            return { newIgnoreRule: mkToIgnore, newConsecutiveMkState: consecutiveMkState };\n        }\n        // **只有在事件不被忽略时，才更新连续处理计数**\n        if (mk && consecutiveMkState && consecutiveMkState.mk === mk) {\n            consecutiveMkState.count++;\n        }\n        else {\n            consecutiveMkState = { mk: mk, count: 1 };\n        }\n        currentConsecutiveCount = consecutiveMkState.count;\n        logger.log('dispatchAndExecuteTask', `执行任务: ${eventType} (分组: ${eventGroup})`);\n        // **任务分发**\n        logger.debug('dispatchAndExecuteTask - task dispatch', `分发事件: ${eventType}`, { detail, eventGroup });\n        if (eventGroup === 'WRITE') {\n            // 关键：写入前先回滚，确保操作的幂等性。\n            // 即使事件被意外触发多次，也只会产生一次有效写入。\n            const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n            if (msg) {\n                const MK = (0,_core_key_message_key__WEBPACK_IMPORTED_MODULE_5__.readMessageKey)(msg);\n                if (MK) {\n                    await (0,_core_rollback__WEBPACK_IMPORTED_MODULE_6__.rollbackByMk)(MK, true);\n                    actionsTaken.rollback = true;\n                }\n            }\n            await (0,_core_crud_variable_change_processor__WEBPACK_IMPORTED_MODULE_10__.ApplyVarChange)();\n            actionsTaken.apply = true;\n            // 在变量写入完成后，强制重新渲染消息以触发宏\n            (0,_api_macro_patch__WEBPACK_IMPORTED_MODULE_4__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'SYNC') {\n            logger.debug('dispatchAndExecuteTask - task dispatch', `事件 ${eventType} 触发状态同步流程...`);\n            const isFullSync = eventType === 'manual_full_sync';\n            await (0,_core_sync__WEBPACK_IMPORTED_MODULE_7__.resyncStateOnHistoryChange)(isFullSync);\n            actionsTaken.resync = true;\n            // 在同步完成后，强制重新渲染消息以触发宏\n            (0,_api_macro_patch__WEBPACK_IMPORTED_MODULE_4__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'API') {\n            actionsTaken.api = true;\n            // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n            if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.INSERT_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.UPDATE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.INSERT_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.UPDATE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.DELETE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.DELETE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByPath)(detail.path);\n        }\n        else if (eventGroup === 'UPDATE_MK_ONLY') {\n            // 监听此事件仅用于为用户消息创建 MK。\n            await (0,_core_key_message_key__WEBPACK_IMPORTED_MODULE_5__.updateLatestSelectedMk)();\n        }\n    }\n    catch (error) {\n        logger.error('dispatchAndExecuteTask', `事件 ${eventType} 处理异常: ${error}`, error);\n    }\n    finally {\n        // 仅当本轮处理中实际执行了 ERA 核心操作时，才校准并广播事件\n        // --- 3. 触发写入完成事件 ---\n        if (actionsTaken.rollback || actionsTaken.apply || actionsTaken.resync || actionsTaken.api) {\n            // **后置保障**: 强制校准 `SelectedMks` 的最新记录。\n            await (0,_core_key_message_key__WEBPACK_IMPORTED_MODULE_5__.updateLatestSelectedMk)();\n            // 在所有操作（包括校准）完成后，获取最新状态并广播事件\n            if (_utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk && message_id !== null) {\n                const { meta: metaData, stat: statData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.getEraData)();\n                const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_2__.SEL_PATH, []);\n                const editLogs = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_2__.LOGS_PATH, {});\n                const statWithoutMeta = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.removeMetaFields)(statData);\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.emitWriteDoneEvent)({\n                    mk: _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk,\n                    message_id: message_id,\n                    actions: actionsTaken,\n                    selectedMks: selectedMks,\n                    editLogs: editLogs,\n                    stat: statData,\n                    statWithoutMeta: statWithoutMeta,\n                    consecutiveProcessingCount: currentConsecutiveCount,\n                });\n            }\n        }\n        // 清理日志上下文，为下一个事件做准备\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = '';\n        // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n        await new Promise(resolve => setTimeout(resolve, 50));\n    }\n    return { newIgnoreRule: mkToIgnore, newConsecutiveMkState: consecutiveMkState };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9kaXNwYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBYTtBQUVVO0FBU0M7QUFDaUQ7QUFDdEI7QUFDWTtBQUM0QztBQUMzRDtBQUNVO0FBQ087QUFDZjtBQUNzQjtBQUV4RSxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUU3Qzs7OztHQUlHO0FBQ0gsTUFBTSwwQ0FBMEMsR0FBRyxDQUFDLENBQUM7QUFvQnJEOzs7Ozs7R0FNRztBQUNILFNBQVMsMEJBQTBCLENBQ2pDLFNBQWlCLEVBQ2pCLFNBQXdCLEVBQ3hCLFVBQTZCO0lBRTdCLElBQUksVUFBVSxJQUFJLFNBQVMsS0FBSyxhQUFhLENBQUMsMEJBQTBCLElBQUksU0FBUyxLQUFLLFVBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUN4RyxNQUFNLENBQUMsR0FBRyxDQUNSLDRCQUE0QixFQUM1QixXQUFXLFVBQVUsQ0FBQyxFQUFFLHlCQUF5QixVQUFVLENBQUMsV0FBVyxHQUFHLENBQUMsRUFBRSxDQUM5RSxDQUFDO1FBQ0YsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3pCLElBQUksVUFBVSxDQUFDLFdBQVcsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNoQyxVQUFVLEdBQUcsSUFBSSxDQUFDLENBQUMsWUFBWTtZQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFDRCxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLENBQUM7SUFDekQsQ0FBQztJQUNELE9BQU8sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsQ0FBQztBQUMxRCxDQUFDO0FBRUQ7Ozs7Ozs7Ozs7R0FVRztBQUNJLEtBQUssVUFBVSxzQkFBc0IsQ0FDMUMsR0FBYSxFQUNiLFVB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RCxvQkFBb0I7UUFDcEIsa0RBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBRW5CLDRDQUE0QztRQUM1QyxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxPQUFPLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxxQkFBcUIsRUFBRSxrQkFBa0IsRUFBRSxDQUFDO0FBQ2xGLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9ldmVudHMvZGlzcGF0Y2hlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQge1xyXG4gIGRlbGV0ZUJ5T2JqZWN0LFxyXG4gIGRlbGV0ZUJ5UGF0aCxcclxuICBlbWl0V3JpdGVEb25lRXZlbnQsXHJcbiAgaW5zZXJ0QnlPYmplY3QsXHJcbiAgaW5zZXJ0QnlQYXRoLFxyXG4gIHVwZGF0ZUJ5T2JqZWN0LFxyXG4gIHVwZGF0ZUJ5UGF0aCxcclxufSBmcm9tICcuLi9hcGkvY29tbWFuZCc7XHJcbmltcG9ydCB7IEVSQV9BUElfRVZFTlRTLCBMT0dTX1BBVEgsIFNFTF9QQVRIIH0gZnJvbSAnLi4vdXRpbHMvY29uc3RhbnRzJztcclxuaW1wb3J0IHsgRXZlbnRKb2IsIGdldEV2ZW50R3JvdXAgfSBmcm9tICcuL21lcmdlcic7XHJcbmltcG9ydCB7IGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMgfSBmcm9tICcuLi9hcGkvbWFjcm8vcGF0Y2gnO1xyXG5pbXBvcnQgeyBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UsIHJlYWRNZXNzYWdlS2V5LCB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rIH0gZnJvbSAnLi4vY29yZS9rZXkvbWVzc2FnZV9rZXknO1xyXG5pbXBvcnQgeyByb2xsYmFja0J5TWsgfSBmcm9tICcuLi9jb3JlL3JvbGxiYWNrJztcclxuaW1wb3J0IHsgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgfSBmcm9tICcuLi9jb3JlL3N5bmMnO1xyXG5pbXBvcnQgeyBnZXRFcmFEYXRhLCByZW1vdmVNZXRhRmllbGRzIH0gZnJvbSAnLi4vdXRpbHMvZXJhX2RhdGEnO1xyXG5pbXBvcnQgeyBsb2dDb250ZXh0LCBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xyXG5pbXBvcnQgeyBBcHBseVZhckNoYW5nZSB9IGZyb20gJy4uL2NvcmUvY3J1ZC92YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yJztcclxuXHJcbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3Rhc2tfZGlzcGF0Y2hlcicpO1xyXG5cclxuLyoqXHJcbiAqIEBjb25zdGFudCB7bnVtYmVyfSBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT05cclxuICogQGRlc2NyaXB0aW9uIOW9kyBgZW5zdXJlTWVzc2FnZUtleWAg5rOo5YWl5LiA5Liq5paw55qEIE1LIOWQju+8jOmcgOimgeW/veeVpeeahOeUseivpeaTjeS9nOinpuWPkeeahCBgY2hhcmFjdGVyX21lc3NhZ2VfcmVuZGVyZWRgIOS6i+S7tueahOaVsOmHj+OAglxyXG4gKiDpgJrluLjorr7nva7kuLogMe+8jOWboOS4uuS4gOasoea2iOaBr+WGheWuueabtOaWsOmAmuW4uOWPquS8muinpuWPkeS4gOasoea4suafk+S6i+S7tuOAglxyXG4gKi9cclxuY29uc3QgUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OID0gMTtcclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJmYWNlIElnbm9yZVJ1bGVcclxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huWboCBNSyDms6jlhaXogIzpnIDopoHlv73nlaXlkI7nu63muLLmn5Pkuovku7bnmoTop4TliJnjgIJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgSWdub3JlUnVsZSB7XHJcbiAgbWs6IHN0cmluZztcclxuICBpZ25vcmVDb3VudDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogQGludGVyZmFjZSBDb25zZWN1dGl2ZU1rU3RhdGVcclxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6hueUqOS6jui/vei4quWQjOS4gOS4qiBNSyDooqvov57nu63lpITnkIbmrKHmlbDnmoTnirbmgIHjgIJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29uc2VjdXRpdmVNa1N0YXRlIHtcclxuICBtazogc3RyaW5nIHwgbnVsbDtcclxuICBjb3VudDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogKirjgJDovoXliqnlh73mlbDjgJHlpITnkIbnlLEgTUsg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu2KipcclxuICogQHBhcmFtIGV2ZW50VHlwZSAtIOW9k+WJjeS6i+S7tueahOexu+Wei+OAglxyXG4gKiBAcGFyYW0gY3VycmVudE1rIC0g5b2T5YmN5raI5oGv55qEIE1L44CCXHJcbiAqIEBwYXJhbSBta1RvSWdub3JlIC0g5b2T5YmN55qE5b+955Wl6KeE5YiZ44CCXHJcbiAqIEByZXR1cm5zIHt7IHNob3VsZFNraXA6IGJvb2xlYW47IG5ld0lnbm9yZVJ1bGU6IElnbm9yZVJ1bGUgfCBudWxsIH19IC0g6L+U5Zue5piv5ZCm5bqU6Lez6L+H5q2k5LqL5Lu277yM5Lul5Y+K5pu05paw5ZCO55qE5b+955Wl6KeE5YiZ44CCXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudChcclxuICBldmVudFR5cGU6IHN0cmluZyxcclxuICBjdXJyZW50TWs6IHN0cmluZyB8IG51bGwsXHJcbiAgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwsXHJcbik6IHsgc2hvdWxkU2tpcDogYm9vbGVhbjsgbmV3SWdub3JlUnVsZTogSWdub3JlUnVsZSB8IG51bGwgfSB7XHJcbiAgaWYgKG1rVG9JZ25vcmUgJiYgZXZlbnRUeXBlID09PSB0YXZlcm5fZXZlbnRzLkNIQVJBQ1RFUl9NRVNTQUdFX1JFTkRFUkVEICYmIGN1cnJlbnRNayA9PT0gbWtUb0lnbm9yZS5taykge1xyXG4gICAgbG9nZ2VyLmxvZyhcclxuICAgICAgJ2hhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50JyxcclxuICAgICAgYOW/veeVpeeUsSBNSyAoJHtta1RvSWdub3JlLm1rfSkg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu244CC5Ymp5L2Z5b+955Wl5qyh5pWwOiAke21rVG9JZ25vcmUuaWdub3JlQ291bnQgLSAxfWAsXHJcbiAgICApO1xyXG4gICAgbWtUb0lnbm9yZS5pZ25vcmVDb3VudC0tO1xyXG4gICAgaWYgKG1rVG9JZ25vcmUuaWdub3JlQ291bnQgPD0gMCkge1xyXG4gICAgICBta1RvSWdub3JlID0gbnVsbDsgLy8g5b+955Wl5qyh5pWw55So5a6M77yM6YeN572uXHJcbiAgICAgIGxvZ2dlci5sb2coJ2hhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50JywgYOW/veeVpeasoeaVsOeUqOWujGApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgc2hvdWxkU2tpcDogdHJ1ZSwgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSB9O1xyXG4gIH1cclxuICByZXR1cm4geyBzaG91bGRTa2lwOiBmYWxzZSwgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSB9O1xyXG59XHJcblxyXG4vKipcclxuICogKirjgJDku7vliqHmiafooYzlmajjgJEqKlxyXG4gKiDotJ/otKPmiafooYzljZXkuKrkuovku7bku7vliqHvvIzljIXlkKvmiYDmnInliY3nva7jgIHlkI7nva7lpITnkIblkozplJnor6/mjZXojrfjgIJcclxuICogQHBhcmFtIHtFdmVudEpvYn0gam9iIC0g6KaB5omn6KGM55qE5LqL5Lu25Lu75Yqh44CCXHJcbiAqIEBwYXJhbSB7SWdub3JlUnVsZSB8IG51bGx9IG1rVG9JZ25vcmUgLSDlvZPliY3nmoTlv73nlaXop4TliJnjgIJcclxuICogQHBhcmFtIHtDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsfSBjb25zZWN1dGl2ZU1rU3RhdGUgLSDlvZPliY3nmoTov57nu63lpITnkIborqHmlbDnirbmgIHjgIJcclxuICogQHJldHVybnMge1Byb21pc2U8e1xyXG4gKiAgIG5ld0lnbm9yZVJ1bGU6IElnbm9yZVJ1bGUgfCBudWxsO1xyXG4gKiAgIG5ld0NvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbDtcclxuICogfT59IC0g6L+U5Zue5pu05paw5ZCO55qE54q25oCB44CCXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhcclxuICBqb2I6IEV2ZW50Sm9iLFxyXG4gIG1rVG9JZ25vcmU6IElnbm9yZVJ1bGUgfCBudWxsLFxyXG4gIGNvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbCxcclxuKTogUHJvbWlzZTx7XHJcbiAgbmV3SWdub3JlUnVsZTogSWdub3JlUnVsZSB8IG51bGw7XHJcbiAgbmV3Q29uc2VjdXRpdmVNa1N0YXRlOiBDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsO1xyXG59PiB7XHJcbiAgY29uc3QgeyB0eXBlOiBldmVudFR5cGUsIGRldGFpbCB9ID0gam9iO1xyXG4gIGNvbnN0IGV2ZW50R3JvdXAgPSBnZXRFdmVudEdyb3VwKGV2ZW50VHlwZSk7XHJcbiAgbGV0IG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xyXG4gIGxldCBjdXJyZW50Q29uc2VjdXRpdmVDb3VudCA9IDE7XHJcblxyXG4gIC8vIOWcqOavj+i9ruS7u+WKoeW8gOWni+aXtu+8jOWIneWni+WMluaTjeS9nOiusOW9leWZqFxyXG4gIGNvbnN0IGFjdGlvbnNUYWtlbiA9IHsgcm9sbGJhY2s6IGZhbHNlLCBhcHBseTogZmFsc2UsIHJlc3luYzogZmFsc2UsIGFwaTogZmFsc2UgfTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vICoq5YmN572u5L+d6ZqcKio6IOehruS/neacgOaWsOa2iOaBr+aciSBNSyDlubborr7nva7ml6Xlv5fkuIrkuIvmlofjgIJcclxuICAgIGNvbnN0IHsgbWssIG1lc3NhZ2VfaWQ6IG1zZ0lkLCBpc05ld0tleSB9ID0gYXdhaXQgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlKCk7XHJcbiAgICBsb2dDb250ZXh0Lm1rID0gbWs7XHJcbiAgICBtZXNzYWdlX2lkID0gbXNnSWQ7XHJcblxyXG4gICAgLy8g5aaC5p6cIGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZSDliJrliJrms6jlhaXkuobkuIDkuKrmlrDnmoQgTUvvvIzlsLHliJvlu7rmiJbmm7TmlrDlv73nlaXop4TliJnjgIJcclxuICAgIGlmIChpc05ld0tleSAmJiBtaykge1xyXG4gICAgICBta1RvSWdub3JlID0ge1xyXG4gICAgICAgIG1rOiBtayxcclxuICAgICAgICBpZ25vcmVDb3VudDogUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vICoq5qC45b+D5LyY5YyWKio6IOajgOafpeW5tuWkhOeQhueUsSBNSyDms6jlhaXop6blj5HnmoTlhpfkvZnmuLLmn5Pkuovku7bjgIJcclxuICAgIGNvbnN0IHsgc2hvdWxkU2tpcCwgbmV3SWdub3JlUnVsZSB9ID0gaGFuZGxlUmVkdW5kYW50UmVuZGVyRXZlbnQoZXZlbnRUeXBlLCBtaywgbWtUb0lnbm9yZSk7XHJcbiAgICBta1RvSWdub3JlID0gbmV3SWdub3JlUnVsZTsgLy8g5pu05paw5b+955Wl6KeE5YiZ55qE54q25oCBXHJcbiAgICBpZiAoc2hvdWxkU2tpcCkge1xyXG4gICAgICAvLyDlpoLmnpzkuovku7booqvlv73nlaXvvIzliJnnm7TmjqXov5Tlm57vvIzkuI3mm7TmlrDov57nu63lpITnkIborqHmlbBcclxuICAgICAgcmV0dXJuIHsgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSwgbmV3Q29uc2VjdXRpdmVNa1N0YXRlOiBjb25zZWN1dGl2ZU1rU3RhdGUgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAqKuWPquacieWcqOS6i+S7tuS4jeiiq+W/veeVpeaXtu+8jOaJjeabtOaWsOi/nue7reWkhOeQhuiuoeaVsCoqXHJcbiAgICBpZiAobWsgJiYgY29uc2VjdXRpdmVNa1N0YXRlICYmIGNvbnNlY3V0aXZlTWtTdGF0ZS5tayA9PT0gbWspIHtcclxuICAgICAgY29uc2VjdXRpdmVNa1N0YXRlLmNvdW50Kys7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zZWN1dGl2ZU1rU3RhdGUgPSB7IG1rOiBtaywgY291bnQ6IDEgfTtcclxuICAgIH1cclxuICAgIGN1cnJlbnRDb25zZWN1dGl2ZUNvdW50ID0gY29uc2VjdXRpdmVNa1N0YXRlLmNvdW50O1xyXG5cclxuICAgIGxvZ2dlci5sb2coJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLCBg5omn6KGM5Lu75YqhOiAke2V2ZW50VHlwZX0gKOWIhue7hDogJHtldmVudEdyb3VwfSlgKTtcclxuXHJcbiAgICAvLyAqKuS7u+WKoeWIhuWPkSoqXHJcbiAgICBsb2dnZXIuZGVidWcoJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2sgLSB0YXNrIGRpc3BhdGNoJywgYOWIhuWPkeS6i+S7tjogJHtldmVudFR5cGV9YCwgeyBkZXRhaWwsIGV2ZW50R3JvdXAgfSk7XHJcbiAgICBpZiAoZXZlbnRHcm91cCA9PT0gJ1dSSVRFJykge1xyXG4gICAgICAvLyDlhbPplK7vvJrlhpnlhaXliY3lhYjlm57mu5rvvIznoa7kv53mk43kvZznmoTluYLnrYnmgKfjgIJcclxuICAgICAgLy8g5Y2z5L2/5LqL5Lu26KKr5oSP5aSW6Kem5Y+R5aSa5qyh77yM5Lmf5Y+q5Lya5Lqn55Sf5LiA5qyh5pyJ5pWI5YaZ5YWl44CCXHJcbiAgICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xyXG4gICAgICBpZiAobXNnKSB7XHJcbiAgICAgICAgY29uc3QgTUsgPSByZWFkTWVzc2FnZUtleShtc2cpO1xyXG4gICAgICAgIGlmIChNSykge1xyXG4gICAgICAgICAgYXdhaXQgcm9sbGJhY2tCeU1rKE1LLCB0cnVlKTtcclxuICAgICAgICAgIGFjdGlvbnNUYWtlbi5yb2xsYmFjayA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGF3YWl0IEFwcGx5VmFyQ2hhbmdlKCk7XHJcbiAgICAgIGFjdGlvbnNUYWtlbi5hcHBseSA9IHRydWU7XHJcblxyXG4gICAgICAvLyDlnKjlj5jph4/lhpnlhaXlrozmiJDlkI7vvIzlvLrliLbph43mlrDmuLLmn5Pmtojmga/ku6Xop6blj5Hlro9cclxuICAgICAgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcygpO1xyXG4gICAgfSBlbHNlIGlmIChldmVudEdyb3VwID09PSAnU1lOQycpIHtcclxuICAgICAgbG9nZ2VyLmRlYnVnKCdkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrIC0gdGFzayBkaXNwYXRjaCcsIGDkuovku7YgJHtldmVudFR5cGV9IOinpuWPkeeKtuaAgeWQjOatpea1geeoiy4uLmApO1xyXG4gICAgICBjb25zdCBpc0Z1bGxTeW5jID0gZXZlbnRUeXBlID09PSAnbWFudWFsX2Z1bGxfc3luYyc7XHJcbiAgICAgIGF3YWl0IHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlKGlzRnVsbFN5bmMpO1xyXG4gICAgICBhY3Rpb25zVGFrZW4ucmVzeW5jID0gdHJ1ZTtcclxuICAgICAgLy8g5Zyo5ZCM5q2l5a6M5oiQ5ZCO77yM5by65Yi26YeN5paw5riy5p+T5raI5oGv5Lul6Kem5Y+R5a6PXHJcbiAgICAgIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKTtcclxuICAgIH0gZWxzZSBpZiAoZXZlbnRHcm91cCA9PT0gJ0FQSScpIHtcclxuICAgICAgYWN0aW9uc1Rha2VuLmFwaSA9IHRydWU7XHJcbiAgICAgIC8vIEFQSSDkuovku7bmmK/igJzljbPlj5HljbPlv5jigJ3nmoTvvIzlkIzmraXosIPnlKjlpITnkIblmajlsIbku7vliqHmjqjlhaUgYXBpLnRzIOeahOmYn+WIl+WQjueri+WNs+i/lOWbnu+8jOS4jemYu+WhnuS6i+S7tumYn+WIl+OAglxyXG4gICAgICBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5JTlNFUlRfQllfT0JKRUNUKSBpbnNlcnRCeU9iamVjdChkZXRhaWwpO1xyXG4gICAgICBlbHNlIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLlVQREFURV9CWV9PQkpFQ1QpIHVwZGF0ZUJ5T2JqZWN0KGRldGFpbCk7XHJcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuSU5TRVJUX0JZX1BBVEgpIGluc2VydEJ5UGF0aChkZXRhaWwucGF0aCwgZGV0YWlsLnZhbHVlKTtcclxuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5VUERBVEVfQllfUEFUSCkgdXBkYXRlQnlQYXRoKGRldGFpbC5wYXRoLCBkZXRhaWwudmFsdWUpO1xyXG4gICAgICBlbHNlIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLkRFTEVURV9CWV9PQkpFQ1QpIGRlbGV0ZUJ5T2JqZWN0KGRldGFpbCk7XHJcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuREVMRVRFX0JZX1BBVEgpIGRlbGV0ZUJ5UGF0aChkZXRhaWwucGF0aCk7XHJcbiAgICB9IGVsc2UgaWYgKGV2ZW50R3JvdXAgPT09ICdVUERBVEVfTUtfT05MWScpIHtcclxuICAgICAgLy8g55uR5ZCs5q2k5LqL5Lu25LuF55So5LqO5Li655So5oi35raI5oGv5Yib5bu6IE1L44CCXHJcbiAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgbG9nZ2VyLmVycm9yKCdkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrJywgYOS6i+S7tiAke2V2ZW50VHlwZX0g5aSE55CG5byC5bi4OiAke2Vycm9yfWAsIGVycm9yKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgLy8g5LuF5b2T5pys6L2u5aSE55CG5Lit5a6e6ZmF5omn6KGM5LqGIEVSQSDmoLjlv4Pmk43kvZzml7bvvIzmiY3moKHlh4blubblub/mkq3kuovku7ZcclxuICAgIC8vIC0tLSAzLiDop6blj5HlhpnlhaXlrozmiJDkuovku7YgLS0tXHJcbiAgICBpZiAoYWN0aW9uc1Rha2VuLnJvbGxiYWNrIHx8IGFjdGlvbnNUYWtlbi5hcHBseSB8fCBhY3Rpb25zVGFrZW4ucmVzeW5jIHx8IGFjdGlvbnNUYWtlbi5hcGkpIHtcclxuICAgICAgLy8gKirlkI7nva7kv53pmpwqKjog5by65Yi25qCh5YeGIGBTZWxlY3RlZE1rc2Ag55qE5pyA5paw6K6w5b2V44CCXHJcbiAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcclxuICAgICAgLy8g5Zyo5omA5pyJ5pON5L2c77yI5YyF5ous5qCh5YeG77yJ5a6M5oiQ5ZCO77yM6I635Y+W5pyA5paw54q25oCB5bm25bm/5pKt5LqL5Lu2XHJcbiAgICAgIGlmIChsb2dDb250ZXh0Lm1rICYmIG1lc3NhZ2VfaWQgIT09IG51bGwpIHtcclxuICAgICAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhLCBzdGF0OiBzdGF0RGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YURhdGEsIFNFTF9QQVRILCBbXSk7XHJcbiAgICAgICAgY29uc3QgZWRpdExvZ3MgPSBfLmdldChtZXRhRGF0YSwgTE9HU19QQVRILCB7fSk7XHJcbiAgICAgICAgY29uc3Qgc3RhdFdpdGhvdXRNZXRhID0gcmVtb3ZlTWV0YUZpZWxkcyhzdGF0RGF0YSk7XHJcblxyXG4gICAgICAgIGVtaXRXcml0ZURvbmVFdmVudCh7XHJcbiAgICAgICAgICBtazogbG9nQ29udGV4dC5tayxcclxuICAgICAgICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2VfaWQsXHJcbiAgICAgICAgICBhY3Rpb25zOiBhY3Rpb25zVGFrZW4sXHJcbiAgICAgICAgICBzZWxlY3RlZE1rczogc2VsZWN0ZWRNa3MsXHJcbiAgICAgICAgICBlZGl0TG9nczogZWRpdExvZ3MsXHJcbiAgICAgICAgICBzdGF0OiBzdGF0RGF0YSxcclxuICAgICAgICAgIHN0YXRXaXRob3V0TWV0YTogc3RhdFdpdGhvdXRNZXRhLFxyXG4gICAgICAgICAgY29uc2VjdXRpdmVQcm9jZXNzaW5nQ291bnQ6IGN1cnJlbnRDb25zZWN1dGl2ZUNvdW50LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5riF55CG5pel5b+X5LiK5LiL5paH77yM5Li65LiL5LiA5Liq5LqL5Lu25YGa5YeG5aSHXHJcbiAgICBsb2dDb250ZXh0Lm1rID0gJyc7XHJcblxyXG4gICAgLy8gKiroioLmtYEqKjog5Zyo5q+P5Liq54us56uL5Lu75Yqh5ZCO6YO96L+b6KGM55+t5pqC562J5b6F77yM56Gu5L+d6YWS6aaG5bqV5bGC5pyJ5pe26Ze05a6M5oiQ5YW25byC5q2l5pON5L2c44CCXHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcclxuICB9XHJcblxyXG4gIHJldHVybiB7IG5ld0lnbm9yZVJ1bGU6IG1rVG9JZ25vcmUsIG5ld0NvbnNlY3V0aXZlTWtTdGF0ZTogY29uc2VjdXRpdmVNa1N0YXRlIH07XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/dispatcher.ts\n\n}");
  },
  "./src/ERA变量框架/events/merger.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/events/merger.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EVENT_COLLISION_MAP: () => (/* binding */ EVENT_COLLISION_MAP),\n/* harmony export */   EVENT_GROUPS: () => (/* binding */ EVENT_GROUPS),\n/* harmony export */   getEventGroup: () => (/* binding */ getEventGroup),\n/* harmony export */   mergeEventBatch: () => (/* binding */ mergeEventBatch)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('event_merger');\n/**\n * @description 定义需要监听的事件的分组\n */\nconst EVENT_GROUPS = {\n    WRITE: [\n        //tavern_events.CHARACTER_MESSAGE_RENDERED,\n        tavern_events.APP_READY,\n        'manual_write',\n        _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE,\n        //tavern_events.MESSAGE_RECEIVED,\n    ],\n    SYNC: [\n        tavern_events.MESSAGE_RECEIVED,\n        tavern_events.MESSAGE_DELETED,\n        tavern_events.MESSAGE_SWIPED,\n        tavern_events.CHAT_CHANGED,\n        'manual_sync',\n        'manual_full_sync',\n    ],\n    API: Object.values(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS),\n    /** 仅更新MK的事件 */\n    UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n    /** 仅用于对冲检测的事件，本身不触发逻辑 */\n    COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n};\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED]\n * ])\n */\nconst EVENT_COLLISION_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED],\n]);\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('WRITE', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nfunction getEventGroup(eventType) {\n    // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n    if (EVENT_GROUPS.WRITE.includes(eventType))\n        return 'WRITE';\n    if (EVENT_GROUPS.SYNC.includes(eventType))\n        return 'SYNC';\n    if (EVENT_GROUPS.API.includes(eventType))\n        return 'API';\n    if (EVENT_GROUPS.UPDATE_MK_ONLY.includes(eventType))\n        return 'UPDATE_MK_ONLY';\n    if (EVENT_GROUPS.COLLISION_DETECTORS.includes(eventType))\n        return 'COLLISION_DETECTORS';\n    return 'UNKNOWN';\n}\n/**\n * **【事件合并器】**\n * 对一批事件进行智能合并，包括处理事件对冲和合并同组可覆盖事件。\n * @param {EventJob[]} batchToProcess - 从队列中取出的一批原始事件。\n * @returns {EventJob[]} - 经过合并优化后的事件数组。\n */\nfunction mergeEventBatch(batchToProcess) {\n    const originalEvents = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(batchToProcess);\n    const finalJobs = [];\n    // 使用 for...of 循环，让逻辑更清晰\n    for (const currentJob of batchToProcess) {\n        // 如果是第一个事件，直接放入结果中\n        if (finalJobs.length === 0) {\n            finalJobs.push(currentJob);\n            continue; // 继续处理下一个事件\n        }\n        const prevJob = finalJobs[finalJobs.length - 1];\n        // 1. 检查事件对冲\n        const expectedNextEvent = EVENT_COLLISION_MAP.get(prevJob.type);\n        const timeDifference = currentJob.timestamp - prevJob.timestamp;\n        if (expectedNextEvent && currentJob.type === expectedNextEvent && timeDifference <= 300) {\n            logger.debug('mergeEventBatch', `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms)。将忽略这两个事件。`);\n            finalJobs.pop(); // 移除前一个事件\n            continue; // 跳过当前事件，从而忽略两者\n        }\n        // 2. 如果不对冲，则检查同组事件合并\n        const prevGroup = getEventGroup(prevJob.type);\n        const currentGroup = getEventGroup(currentJob.type);\n        // 定义合并条件，让 if 判断的意图更清晰\n        const areInSameGroup = prevGroup === currentGroup;\n        const isMergeableGroup = prevGroup === 'WRITE' || prevGroup === 'SYNC';\n        // 如果满足合并条件\n        if (areInSameGroup && isMergeableGroup) {\n            // 用当前事件覆盖掉结果数组中的最后一个事件\n            finalJobs[finalJobs.length - 1] = currentJob;\n        }\n        else {\n            // 否则，将当前事件追加到结果数组\n            finalJobs.push(currentJob);\n        }\n    }\n    // 最后，过滤掉所有单独存在的对冲检测器事件，因为它们已经完成了自己的使命\n    const filteredJobs = finalJobs.filter(job => {\n        const isDetector = getEventGroup(job.type) === 'COLLISION_DETECTORS';\n        if (isDetector) {\n            logger.debug('mergeEventBatch', `清理未配对的对冲检测器事件: ${job.type}`);\n        }\n        return !isDetector;\n    });\n    // 打印合并日志\n    logger.debug('mergeEventBatch', `事件合并: ${originalEvents.length} -> ${filteredJobs.length}`, {\n        before: originalEvents.map(e => e.type),\n        after: filteredJobs.map(e => e.type),\n    });\n    return filteredJobs;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLFNBQVMsY0FBYyxDQUFDLE1BQU0sT0FBTyxZQUFZLENBQUMsTUFBTSxFQUFFLEVBQUU7UUFDMUYsTUFBTSxFQUFFLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3ZDLEtBQUssRUFBRSxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztLQUNyQyxDQUFDLENBQUM7SUFFSCxPQUFPLFlBQVksQ0FBQztBQUN0QixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL21lcmdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgRVJBX0VWRU5UX0VNSVRURVIgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xyXG5cclxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRfbWVyZ2VyJyk7XHJcblxyXG4vKipcclxuICogQGRlc2NyaXB0aW9uIOWumuS5iemcgOimgeebkeWQrOeahOS6i+S7tueahOWIhue7hFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IEVWRU5UX0dST1VQUyA9IHtcclxuICBXUklURTogW1xyXG4gICAgLy90YXZlcm5fZXZlbnRzLkNIQVJBQ1RFUl9NRVNTQUdFX1JFTkRFUkVELFxyXG4gICAgdGF2ZXJuX2V2ZW50cy5BUFBfUkVBRFksXHJcbiAgICAnbWFudWFsX3dyaXRlJyxcclxuICAgIEVSQV9FVkVOVF9FTUlUVEVSLkFQSV9XUklURSxcclxuICAgIC8vdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxyXG4gIF0sXHJcbiAgU1lOQzogW1xyXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxyXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX0RFTEVURUQsXHJcbiAgICB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELFxyXG4gICAgdGF2ZXJuX2V2ZW50cy5DSEFUX0NIQU5HRUQsXHJcbiAgICAnbWFudWFsX3N5bmMnLFxyXG4gICAgJ21hbnVhbF9mdWxsX3N5bmMnLFxyXG4gIF0sXHJcbiAgQVBJOiBPYmplY3QudmFsdWVzKEVSQV9BUElfRVZFTlRTKSxcclxuICAvKiog5LuF5pu05pawTUvnmoTkuovku7YgKi9cclxuICBVUERBVEVfTUtfT05MWTogW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TRU5UXSxcclxuICAvKiog5LuF55So5LqO5a+55Yay5qOA5rWL55qE5LqL5Lu277yM5pys6Lqr5LiN6Kem5Y+R6YC76L6RICovXHJcbiAgQ09MTElTSU9OX0RFVEVDVE9SUzogW3RhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVEXSxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIHN0cmluZz59IEVWRU5UX0NPTExJU0lPTl9NQVBcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIOWumuS5ieS6huS6i+S7tuWvueWGsuinhOWImeOAglxyXG4gKiDlpoLmnpzlnKjkuovku7bpmJ/liJfnmoTlkIzkuIDmrKHmibnlpITnkIbkuK3vvIzlkIzml7blh7rnjrDkuoYga2V5IOS6i+S7tuWSjCB2YWx1ZSDkuovku7bvvIxcclxuICog5YiZ6L+Z5Lik5Liq5LqL5Lu26YO95bCG6KKr5b+955Wl44CCXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIC8vIOW9k+eUqOaIt+W/q+mAn+W3pua7keeEtuWQjueCueWHu+eUn+aIkOaXtu+8jOS8muS+neasoeinpuWPkSBgTUVTU0FHRV9TV0lQRURgIOWSjCBgR0VORVJBVElPTl9TVEFSVEVEYOOAglxyXG4gKiAvLyDov5nmnaHop4TliJnkvJrmjZXojrfov5nnp43mqKHlvI/lubblkIzml7blv73nlaXov5nkuKTkuKrkuovku7bvvIzpgb/lhY3kuI3lv4XopoHnmoTlkIzmraXjgIJcclxuICogbmV3IE1hcChbXHJcbiAqICAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVEXVxyXG4gKiBdKVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IEVWRU5UX0NPTExJU0lPTl9NQVAgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPihbXHJcbiAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVEXSxcclxuXSk7XHJcblxyXG4vKipcclxuICogQGludGVyZmFjZSBFdmVudEpvYlxyXG4gKiBAZGVzY3JpcHRpb24g5a6a5LmJ5LqG5LqL5Lu26Zif5YiX5Lit5q+P5Liq5Lu75Yqh5a+56LGh55qE57uT5p6E44CCXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50Sm9iIHtcclxuICB0eXBlOiBzdHJpbmc7XHJcbiAgZGV0YWlsPzogYW55O1xyXG4gIHRpbWVzdGFtcDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICog5qC55o2u5LqL5Lu257G75Z6L77yM5p+l5om+5a6D5bGe5LqO5ZOq5Liq6aKE5a6a5LmJ55qE57uE44CCXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSDopoHmo4Dmn6XnmoTkuovku7bnsbvlnovjgIJcclxuICogQHJldHVybnMge3N0cmluZ30g5LqL5Lu25omA5bGe55qE57uE5ZCNICgnV1JJVEUnLCAnU1lOQycsICdBUEknLCAnVVBEQVRFX01LX09OTFknLCAnVU5LTk9XTicp44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRHcm91cChldmVudFR5cGU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgLy8g5L2/55SoIGFzIHN0cmluZ1tdIOadpeino+WGsyBUeXBlU2NyaXB0IOWboCAnYXMgY29uc3QnIOaOqOaWreWHuueahOi/h+S6juS4peagvOeahOexu+Wei+mXrumimFxyXG4gIGlmICgoRVZFTlRfR1JPVVBTLldSSVRFIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1dSSVRFJztcclxuICBpZiAoKEVWRU5UX0dST1VQUy5TWU5DIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1NZTkMnO1xyXG4gIGlmICgoRVZFTlRfR1JPVVBTLkFQSSBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdBUEknO1xyXG4gIGlmICgoRVZFTlRfR1JPVVBTLlVQREFURV9NS19PTkxZIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1VQREFURV9NS19PTkxZJztcclxuICBpZiAoKEVWRU5UX0dST1VQUy5DT0xMSVNJT05fREVURUNUT1JTIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ0NPTExJU0lPTl9ERVRFQ1RPUlMnO1xyXG4gIHJldHVybiAnVU5LTk9XTic7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAqKuOAkOS6i+S7tuWQiOW5tuWZqOOAkSoqXHJcbiAqIOWvueS4gOaJueS6i+S7tui/m+ihjOaZuuiDveWQiOW5tu+8jOWMheaLrOWkhOeQhuS6i+S7tuWvueWGsuWSjOWQiOW5tuWQjOe7hOWPr+imhuebluS6i+S7tuOAglxyXG4gKiBAcGFyYW0ge0V2ZW50Sm9iW119IGJhdGNoVG9Qcm9jZXNzIC0g5LuO6Zif5YiX5Lit5Y+W5Ye655qE5LiA5om55Y6f5aeL5LqL5Lu244CCXHJcbiAqIEByZXR1cm5zIHtFdmVudEpvYltdfSAtIOe7j+i/h+WQiOW5tuS8mOWMluWQjueahOS6i+S7tuaVsOe7hOOAglxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRXZlbnRCYXRjaChiYXRjaFRvUHJvY2VzczogRXZlbnRKb2JbXSk6IEV2ZW50Sm9iW10ge1xyXG4gIGNvbnN0IG9yaWdpbmFsRXZlbnRzID0gXy5jbG9uZURlZXAoYmF0Y2hUb1Byb2Nlc3MpO1xyXG4gIGNvbnN0IGZpbmFsSm9iczogRXZlbnRKb2JbXSA9IFtdO1xyXG5cclxuICAvLyDkvb/nlKggZm9yLi4ub2Yg5b6q546v77yM6K6p6YC76L6R5pu05riF5pmwXHJcbiAgZm9yIChjb25zdCBjdXJyZW50Sm9iIG9mIGJhdGNoVG9Qcm9jZXNzKSB7XHJcbiAgICAvLyDlpoLmnpzmmK/nrKzkuIDkuKrkuovku7bvvIznm7TmjqXmlL7lhaXnu5PmnpzkuK1cclxuICAgIGlmIChmaW5hbEpvYnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGZpbmFsSm9icy5wdXNoKGN1cnJlbnRKb2IpO1xyXG4gICAgICBjb250aW51ZTsgLy8g57un57ut5aSE55CG5LiL5LiA5Liq5LqL5Lu2XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcHJldkpvYiA9IGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgLy8gMS4g5qOA5p+l5LqL5Lu25a+55YayXHJcbiAgICBjb25zdCBleHBlY3RlZE5leHRFdmVudCA9IEVWRU5UX0NPTExJU0lPTl9NQVAuZ2V0KHByZXZKb2IudHlwZSk7XHJcbiAgICBjb25zdCB0aW1lRGlmZmVyZW5jZSA9IGN1cnJlbnRKb2IudGltZXN0YW1wIC0gcHJldkpvYi50aW1lc3RhbXA7XHJcbiAgICBpZiAoZXhwZWN0ZWROZXh0RXZlbnQgJiYgY3VycmVudEpvYi50eXBlID09PSBleHBlY3RlZE5leHRFdmVudCAmJiB0aW1lRGlmZmVyZW5jZSA8PSAzMDApIHtcclxuICAgICAgbG9nZ2VyLmRlYnVnKFxyXG4gICAgICAgICdtZXJnZUV2ZW50QmF0Y2gnLFxyXG4gICAgICAgIGDmo4DmtYvliLDnm7jpgrvkuovku7blr7nlhrI6ICR7cHJldkpvYi50eXBlfSDlkowgJHtjdXJyZW50Sm9iLnR5cGV9ICjml7bpl7Tlt646ICR7dGltZURpZmZlcmVuY2V9bXMp44CC5bCG5b+955Wl6L+Z5Lik5Liq5LqL5Lu244CCYCxcclxuICAgICAgKTtcclxuICAgICAgZmluYWxKb2JzLnBvcCgpOyAvLyDnp7vpmaTliY3kuIDkuKrkuovku7ZcclxuICAgICAgY29udGludWU7IC8vIOi3s+i/h+W9k+WJjeS6i+S7tu+8jOS7juiAjOW/veeVpeS4pOiAhVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDIuIOWmguaenOS4jeWvueWGsu+8jOWImeajgOafpeWQjOe7hOS6i+S7tuWQiOW5tlxyXG4gICAgY29uc3QgcHJldkdyb3VwID0gZ2V0RXZlbnRHcm91cChwcmV2Sm9iLnR5cGUpO1xyXG4gICAgY29uc3QgY3VycmVudEdyb3VwID0gZ2V0RXZlbnRHcm91cChjdXJyZW50Sm9iLnR5cGUpO1xyXG5cclxuICAgIC8vIOWumuS5ieWQiOW5tuadoeS7tu+8jOiuqSBpZiDliKTmlq3nmoTmhI/lm77mm7TmuIXmmbBcclxuICAgIGNvbnN0IGFyZUluU2FtZUdyb3VwID0gcHJldkdyb3VwID09PSBjdXJyZW50R3JvdXA7XHJcbiAgICBjb25zdCBpc01lcmdlYWJsZUdyb3VwID0gcHJldkdyb3VwID09PSAnV1JJVEUnIHx8IHByZXZHcm91cCA9PT0gJ1NZTkMnO1xyXG5cclxuICAgIC8vIOWmguaenOa7oei2s+WQiOW5tuadoeS7tlxyXG4gICAgaWYgKGFyZUluU2FtZUdyb3VwICYmIGlzTWVyZ2VhYmxlR3JvdXApIHtcclxuICAgICAgLy8g55So5b2T5YmN5LqL5Lu26KaG55uW5o6J57uT5p6c5pWw57uE5Lit55qE5pyA5ZCO5LiA5Liq5LqL5Lu2XHJcbiAgICAgIGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV0gPSBjdXJyZW50Sm9iO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5ZCm5YiZ77yM5bCG5b2T5YmN5LqL5Lu26L+95Yqg5Yiw57uT5p6c5pWw57uEXHJcbiAgICAgIGZpbmFsSm9icy5wdXNoKGN1cnJlbnRKb2IpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyDmnIDlkI7vvIzov4fmu6TmjonmiYDmnInljZXni6zlrZjlnKjnmoTlr7nlhrLmo4DmtYvlmajkuovku7bvvIzlm6DkuLrlroPku6zlt7Lnu4/lrozmiJDkuoboh6rlt7HnmoTkvb/lkb1cclxuICBjb25zdCBmaWx0ZXJlZEpvYnMgPSBmaW5hbEpvYnMuZmlsdGVyKGpvYiA9PiB7XHJcbiAgICBjb25zdCBpc0RldGVjdG9yID0gZ2V0RXZlbnRHcm91cChqb2IudHlwZSkgPT09ICdDT0xMSVNJT05fREVURUNUT1JTJztcclxuICAgIGlmIChpc0RldGVjdG9yKSB7XHJcbiAgICAgIGxvZ2dlci5kZWJ1ZygnbWVyZ2VFdmVudEJhdGNoJywgYOa4heeQhuacqumFjeWvueeahOWvueWGsuajgOa1i+WZqOS6i+S7tjogJHtqb2IudHlwZX1gKTtcclxuICAgIH1cclxuICAgIHJldHVybiAhaXNEZXRlY3RvcjtcclxuICB9KTtcclxuXHJcbiAgLy8g5omT5Y2w5ZCI5bm25pel5b+XXHJcbiAgbG9nZ2VyLmRlYnVnKCdtZXJnZUV2ZW50QmF0Y2gnLCBg5LqL5Lu25ZCI5bm2OiAke29yaWdpbmFsRXZlbnRzLmxlbmd0aH0gLT4gJHtmaWx0ZXJlZEpvYnMubGVuZ3RofWAsIHtcclxuICAgIGJlZm9yZTogb3JpZ2luYWxFdmVudHMubWFwKGUgPT4gZS50eXBlKSxcclxuICAgIGFmdGVyOiBmaWx0ZXJlZEpvYnMubWFwKGUgPT4gZS50eXBlKSxcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGZpbHRlcmVkSm9icztcclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/merger.ts\n\n}");
  },
  "./src/ERA变量框架/events/queue.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/events/queue.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pushToQueue: () => (/* binding */ pushToQueue)\n/* harmony export */ });\n/* harmony import */ var _dispatcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dispatcher */ \"./src/ERA变量框架/events/dispatcher.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 事件队列与总调度模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”。它通过一个事件队列机制，将所有事件的接收、\n * 合并、分发和执行流程化，从根本上解决了并发和状态竞争问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有事件（来自酒馆或 API）都被封装成 `EventJob` 对象，推入 `eventQueue`。\n * 2. **单线程处理**: `processQueue` 函数使用 `isProcessing` 锁确保同一时间只有一个处理循环在运行。\n * 3. **防抖与批处理**: 在处理前会进行短暂防抖，以收集短时间内连续触发的多个事件，形成一个“批次”。\n * 4. **委托合并**: 将整个批次交由 `event_merger.ts` 模块进行智能合并（对冲、覆盖）。\n * 5. **委托执行**: 循环遍历合并后的任务，将每个任务委托给 `task_dispatcher.ts` 模块进行独立、原子的执行。\n * 6. **状态传递**: 在不同任务的执行之间，传递和更新必要的上下文状态（如 `mkToIgnore` 和 `consecutiveMkState`）。\n */\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('event_queue');\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue = [];\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动处理器。这是所有事件监听器的统一入口点。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nfunction pushToQueue(type, detail) {\n    logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n    eventQueue.push({ type, detail, timestamp: Date.now() });\n    processQueue(); // 尝试启动处理器\n}\n/**\n * **【核心事件处理器】**\n * 持续从队列中取出事件、合并、并按顺序执行。\n * 这是一个自驱动的异步函数，只要队列不为空就会一直运行，直到处理完所有任务。\n */\nasync function processQueue() {\n    if (isProcessing)\n        return; // 如果已在处理中，则直接返回，等待当前循环完成。\n    isProcessing = true;\n    logger.log('processQueue', '处理器启动...');\n    // --- 状态初始化 ---\n    // 这些状态变量定义在 while 循环外部，以在不同批次的事件处理之间保持连续性。\n    let mkToIgnore = null;\n    let consecutiveMkState = null;\n    while (eventQueue.length > 0) {\n        // 【事件收集窗口与防抖】\n        const nextJob = eventQueue[0];\n        const nextGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_1__.getEventGroup)(nextJob.type);\n        if (nextGroup !== 'API') {\n            logger.log('processQueue', `下一个事件 (${nextJob.type}) 需要防抖，等待300毫秒...`);\n            await new Promise(resolve => setTimeout(resolve, 300));\n        }\n        // --- 1. 事件批处理与合并 ---\n        const batchToProcess = eventQueue.splice(0, eventQueue.length);\n        const finalJobs = (0,_merger__WEBPACK_IMPORTED_MODULE_1__.mergeEventBatch)(batchToProcess); // **委托合并**\n        // --- 2. 严格按顺序执行合并后的任务 ---\n        for (const job of finalJobs) {\n            // **委托执行**\n            // 将当前任务和上下文状态传递给执行器\n            const { newIgnoreRule, newConsecutiveMkState } = await (0,_dispatcher__WEBPACK_IMPORTED_MODULE_0__.dispatchAndExecuteTask)(job, mkToIgnore, consecutiveMkState);\n            // 更新上下文状态，为下一个任务做准备\n            mkToIgnore = newIgnoreRule;\n            consecutiveMkState = newConsecutiveMkState;\n        }\n        logger.debug('processQueue', '本轮批次处理完毕。');\n    }\n    // 队列处理完毕，释放锁，等待下一次事件入队。\n    isProcessing = false;\n    logger.log('processQueue', '处理器空闲，已释放锁。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUVVO0FBR3lFO0FBQ2xCO0FBQzlCO0FBRXRDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUV6Qzs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsR0FBZSxFQUFFLENBQUM7QUFFbEM7OztHQUdHO0FBQ0gsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO0FBRXpCOzs7OztHQUtHO0FBQ0ksU0FBUyxXQUFXLENBQUMsSUFBWSxFQUFFLE1BQVk7SUFDcEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsVUFBVSxJQUFJLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDakUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDekQsWUFBWSxFQUFFLENBQUMsQ0FBQyxVQUFVO0FBQzVCLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsS0FBSyxVQUFVLFlBQVk7SUFDekIsSUFBSSxZQUFZO1FBQUUsT0FBTyxDQUFDLDBCQUEwQjtJQUNwRCxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBRXBCLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRXZDLGdCQUFnQjtJQUNoQiwyQ0FBMkM7SUFDM0MsSUFBSSxVQUFVLEdBQXNCLElBQUksQ0FBQztJQUN6QyxJQUFJLGtCQUFrQixHQUE4QixJQUFJLENBQUM7SUFFekQsT0FBTyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQzdCLGNBQWM7UUFDZCxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxTQUFTLEdBQUcsc0RBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsSUFBSSxTQUFTLEtBQUssS0FBSyxFQUFFLENBQUM7WUFDeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsVUFBVSxPQUFPLENBQUMsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekQsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixNQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0QsTUFBTSxTQUFTLEdBQUcsd0RBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFdBQVc7UUFFOUQsMkJBQTJCO1FBQzNCLEtBQUssTUFBTSxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7WUFDNUIsV0FBVztZQUNYLG9CQUFvQjtZQUNwQixNQUFNLEVBQUUsYUFBYSxFQUFFLHFCQUFxQixFQUFFLEdBQUcsTUFBTSxtRUFBc0IsQ0FDM0UsR0FBRyxFQUNILFVBQVUsRUFDVixrQkFBa0IsQ0FDbkIsQ0FBQztZQUVGLG9CQUFvQjtZQUNwQixVQUFVLEdBQUcsYUFBYSxDQUFDO1lBQzNCLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDO1FBQzdDLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsd0JBQXdCO0lBQ3hCLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDNUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuovku7bpmJ/liJfkuI7mgLvosIPluqbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTigJznpZ7nu4/kuK3mnqLigJ3jgILlroPpgJrov4fkuIDkuKrkuovku7bpmJ/liJfmnLrliLbvvIzlsIbmiYDmnInkuovku7bnmoTmjqXmlLbjgIFcbiAqIOWQiOW5tuOAgeWIhuWPkeWSjOaJp+ihjOa1geeoi+WMlu+8jOS7juagueacrOS4iuino+WGs+S6huW5tuWPkeWSjOeKtuaAgeernuS6iemXrumimOOAglxuICpcbiAqICoq5bel5L2c5Y6f55CGKio6XG4gKiAxLiAqKuS6i+S7tuWFpemYnyoqOiDmiYDmnInkuovku7bvvIjmnaXoh6rphZLppobmiJYgQVBJ77yJ6YO96KKr5bCB6KOF5oiQIGBFdmVudEpvYmAg5a+56LGh77yM5o6o5YWlIGBldmVudFF1ZXVlYOOAglxuICogMi4gKirljZXnur/nqIvlpITnkIYqKjogYHByb2Nlc3NRdWV1ZWAg5Ye95pWw5L2/55SoIGBpc1Byb2Nlc3NpbmdgIOmUgeehruS/neWQjOS4gOaXtumXtOWPquacieS4gOS4quWkhOeQhuW+queOr+WcqOi/kOihjOOAglxuICogMy4gKirpmLLmipbkuI7mibnlpITnkIYqKjog5Zyo5aSE55CG5YmN5Lya6L+b6KGM55+t5pqC6Ziy5oqW77yM5Lul5pS26ZuG55+t5pe26Ze05YaF6L+e57ut6Kem5Y+R55qE5aSa5Liq5LqL5Lu277yM5b2i5oiQ5LiA5Liq4oCc5om55qyh4oCd44CCXG4gKiA0LiAqKuWnlOaJmOWQiOW5tioqOiDlsIbmlbTkuKrmibnmrKHkuqTnlLEgYGV2ZW50X21lcmdlci50c2Ag5qih5Z2X6L+b6KGM5pm66IO95ZCI5bm277yI5a+55Yay44CB6KaG55uW77yJ44CCXG4gKiA1LiAqKuWnlOaJmOaJp+ihjCoqOiDlvqrnjq/pgY3ljoblkIjlubblkI7nmoTku7vliqHvvIzlsIbmr4/kuKrku7vliqHlp5TmiZjnu5kgYHRhc2tfZGlzcGF0Y2hlci50c2Ag5qih5Z2X6L+b6KGM54us56uL44CB5Y6f5a2Q55qE5omn6KGM44CCXG4gKiA2LiAqKueKtuaAgeS8oOmAkioqOiDlnKjkuI3lkIzku7vliqHnmoTmiafooYzkuYvpl7TvvIzkvKDpgJLlkozmm7TmlrDlv4XopoHnmoTkuIrkuIvmlofnirbmgIHvvIjlpoIgYG1rVG9JZ25vcmVgIOWSjCBgY29uc2VjdXRpdmVNa1N0YXRlYO+8ieOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IENvbnNlY3V0aXZlTWtTdGF0ZSwgZGlzcGF0Y2hBbmRFeGVjdXRlVGFzaywgSWdub3JlUnVsZSB9IGZyb20gJy4vZGlzcGF0Y2hlcic7XG5pbXBvcnQgeyBFdmVudEpvYiwgZ2V0RXZlbnRHcm91cCwgbWVyZ2VFdmVudEJhdGNoIH0gZnJvbSAnLi9tZXJnZXInO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRfcXVldWUnKTtcblxuLyoqXG4gKiBAY29uc3Qge0V2ZW50Sm9iW119IGV2ZW50UXVldWVcbiAqIEBkZXNjcmlwdGlvbiDkuovku7bpmJ/liJfvvIzlrZjlgqjmiYDmnInlvoXlpITnkIbnmoTkuovku7bku7vliqHjgIJcbiAqL1xuY29uc3QgZXZlbnRRdWV1ZTogRXZlbnRKb2JbXSA9IFtdO1xuXG4vKipcbiAqIEBsZXQge2Jvb2xlYW59IGlzUHJvY2Vzc2luZ1xuICogQGRlc2NyaXB0aW9uIOWkhOeQhuWZqOmUgeOAguS4uiB0cnVlIOaXtuihqOekuiBgcHJvY2Vzc1F1ZXVlYCDmraPlnKjov5DooYzvvIzpmLLmraLph43lhaXjgIJcbiAqL1xubGV0IGlzUHJvY2Vzc2luZyA9IGZhbHNlO1xuXG4vKipcbiAqICoq44CQ5LqL5Lu25YWl5Y+j44CRKipcbiAqIOWwhuS4gOS4quS6i+S7tuaOqOWFpemYn+WIl++8jOW5tuWwneivleWQr+WKqOWkhOeQhuWZqOOAgui/meaYr+aJgOacieS6i+S7tuebkeWQrOWZqOeahOe7n+S4gOWFpeWPo+eCueOAglxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSDkuovku7bnsbvlnosgKGUuZy4sIGB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfREVMRVRFRGAp44CCXG4gKiBAcGFyYW0ge2FueX0gW2RldGFpbF0gLSDkuovku7bpmYTluKbnmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHB1c2hUb1F1ZXVlKHR5cGU6IHN0cmluZywgZGV0YWlsPzogYW55KSB7XG4gIGxvZ2dlci5kZWJ1ZygncHVzaFRvUXVldWUnLCBg5o6l5pS25Yiw5LqL5Lu2OiAke3R5cGV977yM5bey5o6o5YWl6Zif5YiX44CCYCwgeyBkZXRhaWwgfSk7XG4gIGV2ZW50UXVldWUucHVzaCh7IHR5cGUsIGRldGFpbCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICBwcm9jZXNzUXVldWUoKTsgLy8g5bCd6K+V5ZCv5Yqo5aSE55CG5ZmoXG59XG5cbi8qKlxuICogKirjgJDmoLjlv4Pkuovku7blpITnkIblmajjgJEqKlxuICog5oyB57ut5LuO6Zif5YiX5Lit5Y+W5Ye65LqL5Lu244CB5ZCI5bm244CB5bm25oyJ6aG65bqP5omn6KGM44CCXG4gKiDov5nmmK/kuIDkuKroh6rpqbHliqjnmoTlvILmraXlh73mlbDvvIzlj6ropoHpmJ/liJfkuI3kuLrnqbrlsLHkvJrkuIDnm7Tov5DooYzvvIznm7TliLDlpITnkIblrozmiYDmnInku7vliqHjgIJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkge1xuICBpZiAoaXNQcm9jZXNzaW5nKSByZXR1cm47IC8vIOWmguaenOW3suWcqOWkhOeQhuS4re+8jOWImeebtOaOpei/lOWbnu+8jOetieW+heW9k+WJjeW+queOr+WujOaIkOOAglxuICBpc1Byb2Nlc3NpbmcgPSB0cnVlO1xuXG4gIGxvZ2dlci5sb2coJ3Byb2Nlc3NRdWV1ZScsICflpITnkIblmajlkK/liqguLi4nKTtcblxuICAvLyAtLS0g54q25oCB5Yid5aeL5YyWIC0tLVxuICAvLyDov5nkupvnirbmgIHlj5jph4/lrprkuYnlnKggd2hpbGUg5b6q546v5aSW6YOo77yM5Lul5Zyo5LiN5ZCM5om55qyh55qE5LqL5Lu25aSE55CG5LmL6Ze05L+d5oyB6L+e57ut5oCn44CCXG4gIGxldCBta1RvSWdub3JlOiBJZ25vcmVSdWxlIHwgbnVsbCA9IG51bGw7XG4gIGxldCBjb25zZWN1dGl2ZU1rU3RhdGU6IENvbnNlY3V0aXZlTWtTdGF0ZSB8IG51bGwgPSBudWxsO1xuXG4gIHdoaWxlIChldmVudFF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAvLyDjgJDkuovku7bmlLbpm4bnqpflj6PkuI7pmLLmipbjgJFcbiAgICBjb25zdCBuZXh0Sm9iID0gZXZlbnRRdWV1ZVswXTtcbiAgICBjb25zdCBuZXh0R3JvdXAgPSBnZXRFdmVudEdyb3VwKG5leHRKb2IudHlwZSk7XG4gICAgaWYgKG5leHRHcm91cCAhPT0gJ0FQSScpIHtcbiAgICAgIGxvZ2dlci5sb2coJ3Byb2Nlc3NRdWV1ZScsIGDkuIvkuIDkuKrkuovku7YgKCR7bmV4dEpvYi50eXBlfSkg6ZyA6KaB6Ziy5oqW77yM562J5b6FMzAw5q+r56eSLi4uYCk7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMzAwKSk7XG4gICAgfVxuXG4gICAgLy8gLS0tIDEuIOS6i+S7tuaJueWkhOeQhuS4juWQiOW5tiAtLS1cbiAgICBjb25zdCBiYXRjaFRvUHJvY2VzcyA9IGV2ZW50UXVldWUuc3BsaWNlKDAsIGV2ZW50UXVldWUubGVuZ3RoKTtcbiAgICBjb25zdCBmaW5hbEpvYnMgPSBtZXJnZUV2ZW50QmF0Y2goYmF0Y2hUb1Byb2Nlc3MpOyAvLyAqKuWnlOaJmOWQiOW5tioqXG5cbiAgICAvLyAtLS0gMi4g5Lil5qC85oyJ6aG65bqP5omn6KGM5ZCI5bm25ZCO55qE5Lu75YqhIC0tLVxuICAgIGZvciAoY29uc3Qgam9iIG9mIGZpbmFsSm9icykge1xuICAgICAgLy8gKirlp5TmiZjmiafooYwqKlxuICAgICAgLy8g5bCG5b2T5YmN5Lu75Yqh5ZKM5LiK5LiL5paH54q25oCB5Lyg6YCS57uZ5omn6KGM5ZmoXG4gICAgICBjb25zdCB7IG5ld0lnbm9yZVJ1bGUsIG5ld0NvbnNlY3V0aXZlTWtTdGF0ZSB9ID0gYXdhaXQgZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhcbiAgICAgICAgam9iLFxuICAgICAgICBta1RvSWdub3JlLFxuICAgICAgICBjb25zZWN1dGl2ZU1rU3RhdGUsXG4gICAgICApO1xuXG4gICAgICAvLyDmm7TmlrDkuIrkuIvmlofnirbmgIHvvIzkuLrkuIvkuIDkuKrku7vliqHlgZrlh4blpIdcbiAgICAgIG1rVG9JZ25vcmUgPSBuZXdJZ25vcmVSdWxlO1xuICAgICAgY29uc2VjdXRpdmVNa1N0YXRlID0gbmV3Q29uc2VjdXRpdmVNa1N0YXRlO1xuICAgIH1cbiAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NRdWV1ZScsICfmnKzova7mibnmrKHlpITnkIblrozmr5XjgIInKTtcbiAgfVxuXG4gIC8vIOmYn+WIl+WkhOeQhuWujOavle+8jOmHiuaUvumUge+8jOetieW+heS4i+S4gOasoeS6i+S7tuWFpemYn+OAglxuICBpc1Byb2Nlc3NpbmcgPSBmYWxzZTtcbiAgbG9nZ2VyLmxvZygncHJvY2Vzc1F1ZXVlJywgJ+WkhOeQhuWZqOepuumXsu+8jOW3sumHiuaUvumUgeOAgicpO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/queue.ts\n\n}");
  },
  "./src/ERA变量框架/index.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/index.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _events_merger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./events/merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _events_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./events/queue */ \"./src/ERA变量框架/events/queue.ts\");\n/* harmony import */ var _api_macro_parser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/macro/parser */ \"./src/ERA变量框架/api/macro/parser.ts\");\n/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\n\n// ===============================\n// 事件监听器注册\n// ===============================\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.WRITE,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.SYNC,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.API,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.UPDATE_MK_ONLY,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COLLISION_DETECTORS,\n];\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n    // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n    // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n    eventOn(ev, (detail) => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)(ev, detail));\n});\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_full_sync'));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUVrQztBQUNGO0FBRTdDLDRCQUE0QjtBQUNBO0FBRTVCLGtDQUFrQztBQUNsQyxVQUFVO0FBQ1Ysa0NBQWtDO0FBRWxDOzs7R0FHRztBQUNILE1BQU0sY0FBYyxHQUFHO0lBQ3JCLEdBQUcsd0RBQVksQ0FBQyxLQUFLO0lBQ3JCLEdBQUcsd0RBQVksQ0FBQyxJQUFJO0lBQ3BCLEdBQUcsd0RBQVksQ0FBQyxHQUFHO0lBQ25CLEdBQUcsd0RBQVksQ0FBQyxjQUFjO0lBQzlCLEdBQUcsd0RBQVksQ0FBQyxtQkFBbUI7Q0FDcEMsQ0FBQztBQUVGLHdCQUF3QjtBQUN4QixvQkFBb0I7QUFDcEIsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtJQUMxQixtQ0FBbUM7SUFDbkMsd0RBQXdEO0lBQ3hELE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFXLEVBQUUsRUFBRSxDQUFDLDBEQUFXLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFDLENBQUM7QUFFSCx3QkFBd0I7QUFDeEIsNEJBQTRCO0FBQzVCLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO0FBQ3JFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO0FBQ3BFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuLvlhaXlj6PkuI7kuovku7bnm5HlkKzmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25piv5pW05LiqIEVSQSDlj5jph4/moYbmnrbnmoTotbfngrnjgILlroPnmoTogYzotKPpnZ7luLjmuIXmmbDlkozkuJPkuIDvvJpcbiAqIDEuICoq5a6a5LmJ55uR5ZCs6IyD5Zu0Kio6IOWjsOaYjuahhuaetuaJgOWFs+W/g+eahOaJgOacieS6i+S7tuexu+Wei+OAglxuICogMi4gKirms6jlhoznm5HlkKzlmagqKjog5Li65LiK6L+w5omA5pyJ5LqL5Lu25rOo5YaM55uR5ZCs5Zmo44CCXG4gKiAzLiAqKue7n+S4gOa0vuWPkSoqOiDlvZPku7vkvZXkuIDkuKrooqvnm5HlkKznmoTkuovku7bop6blj5Hml7bvvIzlroPkuI3ov5vooYzku7vkvZXpgLvovpHlpITnkIbvvIxcbiAqICAgIOiAjOaYr+eri+WNs+WwhuivpeS6i+S7tu+8iOWMheaLrOS6i+S7tuexu+Wei+WSjOmZhOW4puaVsOaNru+8ieWOn+WwgeS4jeWKqOWcsOaOqOWFpeWIsCBgZXZlbnRfcXVldWUudHNgXG4gKiAgICDkuK3nmoTkuovku7blpITnkIbpmJ/liJfkuK3jgIJcbiAqXG4gKiDov5nnp43orr7orqHkvZPnjrDkuoboia/lpb3nmoQqKuWFs+azqOeCueWIhuemuyoq5Y6f5YiZ77yaYGluZGV4LnRzYCDlj6rotJ/otKPigJzlkKzigJ3vvIzogIwgYGV2ZW50X3F1ZXVlLnRzYFxuICog6LSf6LSj4oCc5oCd6ICD4oCd5ZKM4oCc6KGM5Yqo4oCd44CC6L+Z5L2/5b6X5LqL5Lu255qE5p2l5rqQ5ZKM5aSE55CG6YC76L6R5a6M5YWo6Kej6ICm77yM6Z2e5bi45riF5pmw5LiU5piT5LqO57u05oqk44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFVkVOVF9HUk9VUFMgfSBmcm9tICcuL2V2ZW50cy9tZXJnZXInO1xuaW1wb3J0IHsgcHVzaFRvUXVldWUgfSBmcm9tICcuL2V2ZW50cy9xdWV1ZSc7XG5cbi8vIOWvvOWFpeafpeivouaooeWdlywg5Lul5rOo5YaMIHt7RVJBOi4uLn19IOWuj1xuaW1wb3J0ICcuL2FwaS9tYWNyby9wYXJzZXInO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7bnm5HlkKzlmajms6jlhoxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBAY29uc3Qge3N0cmluZ1tdfSBldmVudHNUb0xpc3RlblxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOaciemcgOimgeiiqyBFUkEg5qGG5p6255uR5ZCs55qE5LqL5Lu244CCXG4gKi9cbmNvbnN0IGV2ZW50c1RvTGlzdGVuID0gW1xuICAuLi5FVkVOVF9HUk9VUFMuV1JJVEUsXG4gIC4uLkVWRU5UX0dST1VQUy5TWU5DLFxuICAuLi5FVkVOVF9HUk9VUFMuQVBJLFxuICAuLi5FVkVOVF9HUk9VUFMuVVBEQVRFX01LX09OTFksXG4gIC4uLkVWRU5UX0dST1VQUy5DT0xMSVNJT05fREVURUNUT1JTLFxuXTtcblxuLy8g6YGN5Y6G5LqL5Lu25YiX6KGo77yM5Li65q+P5Liq5LqL5Lu25rOo5YaM5LiA5Liq5Zue6LCD5Ye95pWw44CCXG4vLyDov5nkuKrlm57osIPlh73mlbDmmK/miYDmnInkuovku7bnmoTnu5/kuIDlhaXlj6PjgIJcbmV2ZW50c1RvTGlzdGVuLmZvckVhY2goZXYgPT4ge1xuICAvLyBgZXZlbnRPbmAg5piv6YWS6aaG5Yqp5omL5o+Q5L6b55qE5YWo5bGA5Ye95pWw77yM55So5LqO5rOo5YaM5LqL5Lu255uR5ZCs44CCXG4gIC8vIOW9k+S6i+S7tiBgZXZgIOinpuWPkeaXtu+8jOWbnuiwg+WHveaVsOiiq+iwg+eUqO+8jOW5tuWwhuS6i+S7tuexu+WeiyBgZXZgIOWSjOS6i+S7tuivpuaDhSBgZGV0YWlsYCDmjqjlhaXpmJ/liJfjgIJcbiAgZXZlbnRPbihldiwgKGRldGFpbDogYW55KSA9PiBwdXNoVG9RdWV1ZShldiwgZGV0YWlsKSk7XG59KTtcblxuLy8g5Li66YWS6aaG5Yqp5omL6ISa5pys55WM6Z2i5Lit55qE5omL5Yqo5oyJ6ZKu5rOo5YaM55uR5ZCs5Zmo44CCXG4vLyDngrnlh7vmjInpkq7ml7bvvIzlkIzmoLfmmK/lkJHpmJ/liJfkuK3mjqjlhaXkuIDkuKrnibnlrprnsbvlnovnmoTkuovku7bjgIJcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+WGmeWFpeWPmOmHj+S/ruaUuScpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX3dyaXRlJykpO1xuZXZlbnRPbihnZXRCdXR0b25FdmVudCgn5omL5Yqo5ZCM5q2l54q25oCBJyksICgpID0+IHB1c2hUb1F1ZXVlKCdtYW51YWxfc3luYycpKTtcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+W8uuWItuWujOWFqOmHjeeulycpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX2Z1bGxfc3luYycpKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/index.ts\n\n}");
  },
  "./src/ERA变量框架/utils/constants.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/utils/constants.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_SCOPE: () => (/* binding */ CHAT_SCOPE),\n/* harmony export */   ERA_API_EVENTS: () => (/* binding */ ERA_API_EVENTS),\n/* harmony export */   ERA_DATA_REGEX: () => (/* binding */ ERA_DATA_REGEX),\n/* harmony export */   ERA_DATA_TAG: () => (/* binding */ ERA_DATA_TAG),\n/* harmony export */   ERA_EVENT_EMITTER: () => (/* binding */ ERA_EVENT_EMITTER),\n/* harmony export */   LOGS_PATH: () => (/* binding */ LOGS_PATH),\n/* harmony export */   META_DATA_PATH: () => (/* binding */ META_DATA_PATH),\n/* harmony export */   SEL_PATH: () => (/* binding */ SEL_PATH),\n/* harmony export */   STAT_DATA_PATH: () => (/* binding */ STAT_DATA_PATH)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   "ERAMetaData": {\n *     "EditLogs": { ... },\n *     "SelectedMks": [ ... ]\n *   },\n *   "stat_data": {\n *     "player": { "hp": 100, "gold": 50 },\n *     "world_state": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nconst CHAT_SCOPE = { type: \'chat\' };\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nconst META_DATA_PATH = \'ERAMetaData\';\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nconst STAT_DATA_PATH = \'stat_data\';\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `"EditLogs"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * "era_mk_1759246942209_jipmrj": [\n *   { "op": "insert", "path": "testData.inventory", "value_new": { "gold": 100, "slots": ["sword", "shield"] } },\n *   { "op": "update", "path": "player.hp", "value_old": 90, "value_new": 100 }\n * ]\n */\nconst LOGS_PATH = \'EditLogs\';\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `"SelectedMks"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , "era_mk_greeting", "era_mk_abc123", , "era_mk_xyz789"]\n */\nconst SEL_PATH = \'SelectedMks\';\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nconst ERA_DATA_TAG = \'era_data\';\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nconst ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nconst ERA_API_EVENTS = {\n    INSERT_BY_OBJECT: \'era:insertByObject\',\n    UPDATE_BY_OBJECT: \'era:updateByObject\',\n    INSERT_BY_PATH: \'era:insertByPath\',\n    UPDATE_BY_PATH: \'era:updateByPath\',\n    DELETE_BY_OBJECT: \'era:deleteByObject\',\n    DELETE_BY_PATH: \'era:deleteByPath\',\n};\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nconst ERA_EVENT_EMITTER = {\n    /** 当变量写入完成时触发 */\n    WRITE_DONE: \'era:writeDone\',\n    /** 当API执行写入时触发 */\n    API_WRITE: \'era:apiWrite\',\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRCRztBQUVVO0FBRWI7Ozs7OztHQU1HO0FBQ0ksTUFBTSxVQUFVLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBZSxFQUFFLENBQUM7QUFFcEQ7OztHQUdHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDOzs7R0FHRztBQUNJLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQztBQUUxQzs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDO0FBRXBDOzs7Ozs7Ozs7OztHQVdHO0FBQ0ksTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDO0FBRXRDOzs7OztHQUtHO0FBQ0ksTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDO0FBRXZDOzs7OztHQUtHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxZQUFZLGVBQWUsWUFBWSxHQUFHLENBQUMsQ0FBQztBQUV6Rjs7Ozs7R0FLRztBQUNJLE1BQU0sY0FBYyxHQUFHO0lBQzVCLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyxjQUFjLEVBQUUsa0JBQWtCO0lBQ2xDLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxjQUFjLEVBQUUsa0JBQWtCO0NBQzFCLENBQUM7QUFFWDs7O0dBR0c7QUFDSSxNQUFNLGlCQUFpQixHQUFHO0lBQy9CLGlCQUFpQjtJQUNqQixVQUFVLEVBQUUsZUFBZTtJQUMzQixrQkFBa0I7SUFDbEIsU0FBUyxFQUFFLGNBQWM7Q0FDakIsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmoLjlv4PluLjph4/mqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu26ZuG5Lit5a6a5LmJ5LqG5pW05LiqIEVSQSDmoYbmnrbmiYDkvb/nlKjnmoTlhbPplK7luLjph4/jgIJcbiAqIOi/meS6m+W4uOmHj+S4u+imgeeUqOS9nOWcqOmFkummhiBgY2hhdGAg5Y+Y6YeP5Lit5a2Y5YKo5ZKM5qOA57SiIEVSQSDmoLjlv4PmlbDmja7nmoTot6/lvoTvvIjplK7lkI3vvInjgIJcbiAqXG4gKiAqKuaguOW/g+aVsOaNrue7k+aehCoqOlxuICogRVJBIOeahOaVsOaNruiiq+WIhuS4uuS4pOmDqOWIhu+8jOWtmOWCqOWcqCBgY2hhdGAg5Y+Y6YeP5LiL77yaXG4gKiAxLiAqKuWFg+aVsOaNriAoRVJBTWV0YURhdGEpKio6IOWMheWQq+ahhuaetuiHqui6q+i/kOihjOaJgOmcgOeahOaguOW/g+aVsOaNru+8jOWmgiBgRWRpdExvZ3NgIOWSjCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAyLiAqKueKtuaAgeaVsOaNriAoc3RhdF9kYXRhKSoqOiDljIXlkKvmiYDmnInnlLHnlKjmiLflkowgQUkg566h55CG55qE5ri45oiPL+aVheS6i+WPmOmHj++8jOWmgiBgcGxheWVyYOOAgWB3b3JsZF9zdGF0ZWAg562J44CCXG4gKlxuICog5YW257uT5p6E5aSn6Ie05aaC5LiL77yaXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgIFwiRVJBTWV0YURhdGFcIjoge1xuICogICAgIFwiRWRpdExvZ3NcIjogeyAuLi4gfSxcbiAqICAgICBcIlNlbGVjdGVkTWtzXCI6IFsgLi4uIF1cbiAqICAgfSxcbiAqICAgXCJzdGF0X2RhdGFcIjoge1xuICogICAgIFwicGxheWVyXCI6IHsgXCJocFwiOiAxMDAsIFwiZ29sZFwiOiA1MCB9LFxuICogICAgIFwid29ybGRfc3RhdGVcIjogeyAuLi4gfVxuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqIOWwhui/meS6m+i3r+W+hOWumuS5ieS4uuW4uOmHj++8jOacieWKqeS6ju+8mlxuICogMS4gKirpgb/lhY3noaznvJbnoIEqKu+8muWHj+WwkeWboOaLvOWGmemUmeivr+WvvOiHtOeahCBidWfjgIJcbiAqIDIuICoq5o+Q6auY5Y+v57u05oqk5oCnKirvvJrlpoLmnpzmnKrmnaXpnIDopoHosIPmlbTmlbDmja7nu5PmnoTvvIzlj6rpnIDkv67mlLnmraTmlofku7bljbPlj6/jgIJcbiAqIDMuICoq5aKe5by65Luj56CB5Y+v6K+75oCnKirvvJrluLjph4/nmoTlkI3np7DmuIXmmbDlnLDooajovr7kuoblhbbmiYDmjIflkJHnmoTmlbDmja7nmoTlkKvkuYnjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IENIQVRfU0NPUEVcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO6YWS6aaG5Yqp5omLIGBnZXRWYXJpYWJsZXNgIOWSjCBgcmVwbGFjZVZhcmlhYmxlc2Ag57O75YiX5Ye95pWw55qEIGBzY29wZWAg5Y+C5pWw44CCXG4gKiDlroPmjIflrprkuobmk43kvZznmoTnm67moIfmmK/lvZPliY0qKuiBiuWkqe+8iENoYXTvvIkqKue6p+WIq+eahOWPmOmHj+OAglxuICogRVJBIOahhuaetueahOaJgOacieaguOW/g+aVsOaNruWSjOeUqOaIt+WPmOmHj+mDveWtmOWCqOWcqOatpOS9nOeUqOWfn+S4i+OAglxuICovXG5leHBvcnQgY29uc3QgQ0hBVF9TQ09QRSA9IHsgdHlwZTogJ2NoYXQnIGFzIGNvbnN0IH07XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IE1FVEFfREFUQV9QQVRIXG4gKiBAZGVzY3JpcHRpb24g5ZyoIGBjaGF0YCDlj5jph4/kuK3vvIzlrZjlgqggRVJBIOahhuaetioq5YWD5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IE1FVEFfREFUQV9QQVRIID0gJ0VSQU1ldGFEYXRhJztcblxuLyoqXG4gKiBAY29uc3RhbnQge3N0cmluZ30gU1RBVF9EQVRBX1BBVEhcbiAqIEBkZXNjcmlwdGlvbiDlnKggYGNoYXRgIOWPmOmHj+S4re+8jOWtmOWCqOeUqOaItyoq54q25oCB5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IFNUQVRfREFUQV9QQVRIID0gJ3N0YXRfZGF0YSc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IExPR1NfUEFUSFxuICogQGRlc2NyaXB0aW9uXG4gKiDlnKggYEVSQU1ldGFEYXRhYCDlr7nosaHkuK3vvIzlrZjlgqgqKue8lui+keaXpeW/l++8iEVkaXQgTG9nc++8iSoq55qE5a+56LGh55qE6ZSu5ZCN77yM5Y2zIGBcIkVkaXRMb2dzXCJg44CCXG4gKiBgRWRpdExvZ3NgIOaYr+S4gOS4quS7pSoq5raI5oGv5a+G6ZKl77yITUvvvIkqKuS4uumUru+8jOS7peivpea2iOaBr+W8leWPkeeahOWPmOmHj+WPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICog6L+Z5piv5a6e546w4oCc6YCG5bqP5Zue5rua4oCd5Yqf6IO955qE5Z+656GA5pWw5o2u44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIGNoYXQuRVJBTWV0YURhdGEuRWRpdExvZ3Mg55qE5LiA5Liq5p2h55uuXG4gKiBcImVyYV9ta18xNzU5MjQ2OTQyMjA5X2ppcG1yalwiOiBbXG4gKiAgIHsgXCJvcFwiOiBcImluc2VydFwiLCBcInBhdGhcIjogXCJ0ZXN0RGF0YS5pbnZlbnRvcnlcIiwgXCJ2YWx1ZV9uZXdcIjogeyBcImdvbGRcIjogMTAwLCBcInNsb3RzXCI6IFtcInN3b3JkXCIsIFwic2hpZWxkXCJdIH0gfSxcbiAqICAgeyBcIm9wXCI6IFwidXBkYXRlXCIsIFwicGF0aFwiOiBcInBsYXllci5ocFwiLCBcInZhbHVlX29sZFwiOiA5MCwgXCJ2YWx1ZV9uZXdcIjogMTAwIH1cbiAqIF1cbiAqL1xuZXhwb3J0IGNvbnN0IExPR1NfUEFUSCA9ICdFZGl0TG9ncyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IFNFTF9QQVRIXG4gKiBAZGVzY3JpcHRpb25cbiAqIOWcqCBgRVJBTWV0YURhdGFgIOWvueixoeS4re+8jOWtmOWCqCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+77yIU2VsZWN0ZWQgTWVzc2FnZSBLZXlz77yJKirnmoTmlbDnu4TnmoTplK7lkI3vvIzljbMgYFwiU2VsZWN0ZWRNa3NcImDjgIJcbiAqIGBTZWxlY3RlZE1rc2Ag5piv5LiA5Liq56iA55aP5pWw57uE77yM5YW2KirntKLlvJXnuqbnrYnkuo7mtojmga8gSUQqKu+8jOWAvOaYr+ivpealvOWxgua2iOaBr+eahCBNS+OAglxuICog6L+Z5Liq5pWw57uE5pivIEVSQSDmoYbmnrbnmoTigJzohIrmooHigJ3vvIzmmK/ov57mjqXmir3osaHlj5jph4/nirbmgIHkuI7lhbfkvZPogYrlpKnljoblj7LnmoTmoaXmooHjgIJcbiAqIOahhuaetumAmui/h+avlOWvuSBgU2VsZWN0ZWRNa3NgIOS4juWunumZhea2iOaBr+a1geS4reeahCBNS++8jOadpeWIpOaWreaVsOaNruaYr+WQpumcgOimgeWQjOatpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBjaGF0LkVSQU1ldGFEYXRhLlNlbGVjdGVkTWtzXG4gKiBbICwgXCJlcmFfbWtfZ3JlZXRpbmdcIiwgXCJlcmFfbWtfYWJjMTIzXCIsICwgXCJlcmFfbWtfeHl6Nzg5XCJdXG4gKi9cbmV4cG9ydCBjb25zdCBTRUxfUEFUSCA9ICdTZWxlY3RlZE1rcyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IEVSQV9EQVRBX1RBR1xuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7lnKjmtojmga/lhoXlrrnkuK3ljIXoo7kgRVJBIOWFg+aVsOaNru+8iOWmgua2iOaBr+WvhumSpSBNS++8ieeahCBYTUwg6aOO5qC85qCH562+5ZCN44CCXG4gKiBlLmcuLCBgPGVyYV9kYXRhPnsuLi59PC9lcmFfZGF0YT5gXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfREFUQV9UQUcgPSAnZXJhX2RhdGEnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7UmVnRXhwfSBFUkFfREFUQV9SRUdFWFxuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7ku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3ljLnphY3lkozmj5Dlj5YgYDxlcmFfZGF0YT5gIOWdl+eahOato+WImeihqOi+vuW8j+OAglxuICog6L+Z5Liq5bi46YeP6KKr5a6a5LmJ5Zyo6L+Z6YeM77yM5Lul6YG/5YWNIGBtZXNzYWdlX2tleS50c2Ag5ZKMIGBtZXNzYWdlX3V0aWxzLnRzYCDkuYvpl7TnmoTlvqrnjq/kvp3otZbjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEVSQV9EQVRBX1JFR0VYID0gbmV3IFJlZ0V4cChgPCR7RVJBX0RBVEFfVEFHfT4oey4qP30pPFxcXFwvJHtFUkFfREFUQV9UQUd9PmApO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfQVBJX0VWRU5UU1xuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobmiYDmnInkvpvlpJbpg6johJrmnKzpgJrov4cgYGV2ZW50RW1pdGAg6LCD55So55qE6Ieq5a6a5LmJIEFQSSDkuovku7blkI3np7DjgIJcbiAqIOS9v+eUqOi/meS6m+W4uOmHj+WPr+S7pemBv+WFjeWcqOS7o+eggeS4reS9v+eUqOehrOe8lueggeeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0FQSV9FVkVOVFMgPSB7XG4gIElOU0VSVF9CWV9PQkpFQ1Q6ICdlcmE6aW5zZXJ0QnlPYmplY3QnLFxuICBVUERBVEVfQllfT0JKRUNUOiAnZXJhOnVwZGF0ZUJ5T2JqZWN0JyxcbiAgSU5TRVJUX0JZX1BBVEg6ICdlcmE6aW5zZXJ0QnlQYXRoJyxcbiAgVVBEQVRFX0JZX1BBVEg6ICdlcmE6dXBkYXRlQnlQYXRoJyxcbiAgREVMRVRFX0JZX09CSkVDVDogJ2VyYTpkZWxldGVCeU9iamVjdCcsXG4gIERFTEVURV9CWV9QQVRIOiAnZXJhOmRlbGV0ZUJ5UGF0aCcsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfRVZFTlRfRU1JVFRFUlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOacieeUsSBFUkEg5qGG5p62KirlkJHlpJblj5Hlh7oqKueahOS6i+S7tuOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0VWRU5UX0VNSVRURVIgPSB7XG4gIC8qKiDlvZPlj5jph4/lhpnlhaXlrozmiJDml7bop6blj5EgKi9cbiAgV1JJVEVfRE9ORTogJ2VyYTp3cml0ZURvbmUnLFxuICAvKiog5b2TQVBJ5omn6KGM5YaZ5YWl5pe26Kem5Y+RICovXG4gIEFQSV9XUklURTogJ2VyYTphcGlXcml0ZScsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIGBlcmE6d3JpdGVEb25lYCDkuovku7bnmoTotJ/ovb3lr7nosaHnu5PmnoTjgILlroPmj5DkvpvkuoblhbPkuo7kuIDmrKHmiJDlip/lhpnlhaXmk43kvZznmoTlrozmlbTkuIrkuIvmlofjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXcml0ZURvbmVQYXlsb2FkIHtcbiAgLyoqXG4gICAqIOacrOi9ruS6i+S7tuWkhOeQhuW+queOr+S4re+8jOacgOWQjuaTjeS9nOeahOa2iOaBr+eahCoq5raI5oGv5a+G6ZKlIChNZXNzYWdlIEtleSkqKuOAglxuICAgKiDpgJrluLjnlLEgYGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZWAg5Zyo5b6q546v5byA5aeL5pe256Gu5a6a44CCXG4gICAqL1xuICBtazogc3RyaW5nO1xuICAvKipcbiAgICog5pys6L2u5LqL5Lu25aSE55CG5b6q546v5Lit77yM5pyA5ZCO5pON5L2c55qE5raI5oGv55qEKirmtojmga8gSUQqKuOAglxuICAgKi9cbiAgbWVzc2FnZV9pZDogbnVtYmVyO1xuICAvKipcbiAgICog5o+P6L+w5Zyo5pys6L2u5LqL5Lu25aSE55CG5Lit77yM5omn6KGM5LqG5ZOq5Lqb5qC45b+D5pON5L2c44CCXG4gICAqIOi/meWvueS6juWklumDqOiEmuacrOeQhuino+eKtuaAgeWPmOabtOeahOWOn+WboOiHs+WFs+mHjeimgeOAglxuICAgKi9cbiAgYWN0aW9uczoge1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJvbGxiYWNrQnlNa2Ag5pON5L2cICovXG4gICAgcm9sbGJhY2s6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBgQXBwbHlWYXJDaGFuZ2VgIOaTjeS9nCAqL1xuICAgIGFwcGx5OiBib29sZWFuO1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDmk43kvZwgKi9cbiAgICByZXN5bmM6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBBUEkg6LCD55SoICovXG4gICAgYXBpOiBib29sZWFuO1xuICB9O1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jOaVtOS4quiBiuWkqeS8muivneeahCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+IChTZWxlY3RlZCBNZXNzYWdlIEtleXMpKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meaYr+S4gOS4queogOeWj+aVsOe7hO+8jOWFtue0ouW8lee6puetieS6jua2iOaBryBJRO+8jOWAvOaYr+WvueW6lOalvOWxgua2iOaBr+eahCBNS+OAglxuICAgKiDlroPku6PooajkuoblvZPliY3ogYrlpKnorrDlvZXnmoTigJzkuLvlubLigJ3vvIzmmK8gRVJBIOWIpOaWreWQjOatpeeKtuaAgeeahOaguOW/g+aVsOaNrue7k+aehOOAglxuICAgKi9cbiAgc2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdO1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jGBjaGF0YCDlj5jph4/kuK3lrZjlgqjnmoQqKuWujOaVtOeahOe8lui+keaXpeW/l+WvueixoSAoRWRpdExvZ3MpKirjgIJcbiAgICog6L+Z5piv5LiA5Liq5LulIE1LIOS4uumUru+8jOS7peWPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICAgKi9cbiAgZWRpdExvZ3M6IHsgW2tleTogc3RyaW5nXTogYW55W10gfTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzmlbTkuKrogYrlpKnkvJror53nmoQqKueKtuaAgeaVsOaNriAoYHN0YXRfZGF0YWApKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meS4queJiOacrCoq5YyF5ZCrKirmiYDmnInlhoXpg6jkvb/nlKjnmoQgYCRtZXRhYCDlrZfmrrXjgIJcbiAgICovXG4gIHN0YXQ6IGFueTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzkuIDkuKoqKuS4jeWMheWQqyoq5Lu75L2VIGAkbWV0YWAg5a2X5q6155qEIGBzdGF0X2RhdGFgIOeahOa3seaLt+i0neeJiOacrOOAglxuICAgKiDpgILnlKjkuo7pnIDopoHnuq/lh4DmlbDmja7ov5vooYzlsZXnpLrmiJbov5vkuIDmraXlpITnkIbnmoTlnLrmma/jgIJcbiAgICovXG4gIHN0YXRXaXRob3V0TWV0YTogYW55O1xuICAvKipcbiAgICog6KGo56S66L+Z5piv5a+55b2T5YmNIGBta2Ag55qE56ys5Yeg5qyh6L+e57ut5aSE55CG44CCXG4gICAqIOWmguaenOS4gOS4quaWsOeahCBgbWtgIOiiq+WkhOeQhu+8jOi/meS4quiuoeaVsOS8mumHjee9ruS4uiAx44CCXG4gICAqIOi/meWvueS6jumcgOimgeaEn+efpeeKtuaAgeaYr+WQpuWcqOWQjOS4gOa2iOaBr+S4iui/nue7reabtOaWsOeahOWklumDqOiEmuacrOW+iOacieeUqOOAglxuICAgKi9cbiAgY29uc2VjdXRpdmVQcm9jZXNzaW5nQ291bnQ6IG51bWJlcjtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/constants.ts\n\n}');
  },
  "./src/ERA变量框架/utils/data.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/data.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   J: () => (/* binding */ J),\n/* harmony export */   escapeEraData: () => (/* binding */ escapeEraData),\n/* harmony export */   isPO: () => (/* binding */ isPO),\n/* harmony export */   mergeReplaceArray: () => (/* binding */ mergeReplaceArray),\n/* harmony export */   parseEditLog: () => (/* binding */ parseEditLog),\n/* harmony export */   parseJsonl: () => (/* binding */ parseJsonl),\n/* harmony export */   sanitizeArrays: () => (/* binding */ sanitizeArrays),\n/* harmony export */   unescapeEraData: () => (/* binding */ unescapeEraData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * @file ERA 变量框架 - 通用数据处理模块\n */\n\n\nconst ESCAPE_MAP = {\n    '.': '__DOT__',\n    '\"': '__DQUOTE__',\n    \"'\": '__SQUOTE__',\n};\nconst UNESCAPE_MAP = lodash__WEBPACK_IMPORTED_MODULE_0___default().invert(ESCAPE_MAP);\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nfunction escapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => escapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n                newObj[escapedKey] = escapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(escapeRegex, match => ESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nfunction unescapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => unescapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n                newObj[unescapedKey] = unescapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nconst isPO = (v) => lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v);\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nfunction sanitizeArrays(v) {\n    if (Array.isArray(v)) {\n        // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n        return v.map(e => (Array.isArray(e) || lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(e) ? JSON.stringify(e) : e));\n    }\n    else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v)) {\n        // 如果是对象，则递归地对其每个属性值进行净化。\n        const o = {};\n        for (const k in v)\n            o[k] = sanitizeArrays(v[k]);\n        return o;\n    }\n    else {\n        // 其他类型的值直接返回。\n        return v;\n    }\n}\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nconst J = (o) => {\n    try {\n        return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n    }\n    catch (e) {\n        return `<<stringify失败: ${e?.message || e}>>`;\n    }\n};\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nfunction mergeReplaceArray(base, patch) {\n    // 使用 _.cloneDeep 确保不修改原始对象。\n    return lodash__WEBPACK_IMPORTED_MODULE_0___default().mergeWith(lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(base), lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(patch), (a, b) => {\n        // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n        if (Array.isArray(a) || Array.isArray(b))\n            return b;\n        // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n        return undefined;\n    });\n}\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nfunction parseEditLog(raw) {\n    if (Array.isArray(raw))\n        return raw;\n    if (raw && typeof raw === 'object')\n        return [raw]; // 单个对象也视为有效日志\n    if (typeof raw === 'string') {\n        const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n        try {\n            const arr = JSON.parse(s);\n            return Array.isArray(arr) ? arr : [];\n        }\n        catch {\n            return [];\n        }\n    }\n    return [];\n}\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @returns {any[]} 解析出的对象数组。\n */\nfunction parseJsonl(str) {\n    const objects = [];\n    if (!str || typeof str !== 'string') {\n        return objects;\n    }\n    // 在解析前，先移除所有类型的注释，以提高解析的鲁棒性。\n    const strWithoutComments = str\n        .replace(/\\/\\/.*/g, '') // 移除 // 风格的单行注释\n        .replace(/\\/\\*[\\s\\S]*?\\*\\//g, '') // 移除 /* ... */ 风格的多行注释\n        .replace(/\x3c!--[\\s\\S]*?--\x3e/g, ''); // 移除 \x3c!-- ... --\x3e 风格的 HTML/XML 注释\n    const trimmedStr = strWithoutComments.trim();\n    let braceCount = 0; // 花括号平衡计数器\n    let startIndex = -1; // 当前 JSON 对象的起始索引\n    let inString = false; // 标记是否处于双引号字符串内部\n    for (let i = 0; i < trimmedStr.length; i++) {\n        const char = trimmedStr[i];\n        // 切换 inString 状态，忽略转义的双引号\n        if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，则跳过所有花括号的逻辑判断\n        if (inString)\n            continue;\n        if (char === '{') {\n            if (braceCount === 0) {\n                // 发现一个新 JSON 对象的开始\n                startIndex = i;\n            }\n            braceCount++;\n        }\n        else if (char === '}') {\n            if (braceCount > 0) {\n                braceCount--;\n                if (braceCount === 0 && startIndex !== -1) {\n                    // 花括号平衡，一个完整的 JSON 对象被找到\n                    const jsonString = trimmedStr.substring(startIndex, i + 1);\n                    try {\n                        const obj = JSON.parse(jsonString);\n                        objects.push(obj);\n                    }\n                    catch (e) {\n                        // 如果解析失败，在控制台打印错误并继续，不中断整个过程\n                        console.error(`[ERA/utils/parseJsonl] JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n                    }\n                    // 重置状态，准备寻找下一个对象\n                    startIndex = -1;\n                }\n            }\n        }\n    }\n    return objects;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ2xHLENBQUM7b0JBQ0QsaUJBQWlCO29CQUNqQixVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxPQUFPLE9BQU8sQ0FBQztBQUNqQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvZGF0YS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOmAmueUqOaVsOaNruWkhOeQhuaooeWdl1xyXG4gKi9cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG5jb25zdCBFU0NBUEVfTUFQOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xyXG4gICcuJzogJ19fRE9UX18nLFxyXG4gICdcIic6ICdfX0RRVU9URV9fJyxcclxuICBcIidcIjogJ19fU1FVT1RFX18nLFxyXG59O1xyXG5cclxuY29uc3QgVU5FU0NBUEVfTUFQOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0gXy5pbnZlcnQoRVNDQVBFX01BUCk7XHJcblxyXG5jb25zdCBlc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoT2JqZWN0LmtleXMoRVNDQVBFX01BUCkubWFwKF8uZXNjYXBlUmVnRXhwKS5qb2luKCd8JyksICdnJyk7XHJcbmNvbnN0IHVuZXNjYXBlUmVnZXggPSBuZXcgUmVnRXhwKE9iamVjdC52YWx1ZXMoRVNDQVBFX01BUCkubWFwKF8uZXNjYXBlUmVnRXhwKS5qb2luKCd8JyksICdnJyk7XHJcblxyXG4vKipcclxuICog6YCS5b2S5Zyw6L2s5LmJ5a+56LGh5oiW5pWw57uE5Lit5omA5pyJ5a2X56ym5Liy5YC85ZKM6ZSu55qE54m55q6K5a2X56ym44CCXHJcbiAqIEBwYXJhbSBkYXRhIC0g6KaB5aSE55CG55qE5pWw5o2u44CCXHJcbiAqIEByZXR1cm5zIC0g6L2s5LmJ5ZCO55qE5pWw5o2u44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlRXJhRGF0YTxUPihkYXRhOiBUKTogVCB7XHJcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgIHJldHVybiBkYXRhLm1hcChpdGVtID0+IGVzY2FwZUVyYURhdGEoaXRlbSkpIGFzIGFueTtcclxuICB9XHJcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChkYXRhKSkge1xyXG4gICAgY29uc3QgbmV3T2JqOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XHJcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSkge1xyXG4gICAgICAgIGNvbnN0IGVzY2FwZWRLZXkgPSBrZXkucmVwbGFjZShlc2NhcGVSZWdleCwgbWF0Y2ggPT4gRVNDQVBFX01BUFttYXRjaF0pO1xyXG4gICAgICAgIG5ld09ialtlc2NhcGVkS2V5XSA9IGVzY2FwZUVyYURhdGEoKGRhdGEgYXMgYW55KVtrZXldKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld09iaiBhcyBhbnk7XHJcbiAgfVxyXG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcclxuICAgIHJldHVybiBkYXRhLnJlcGxhY2UoZXNjYXBlUmVnZXgsIG1hdGNoID0+IEVTQ0FQRV9NQVBbbWF0Y2hdKSBhcyBhbnk7XHJcbiAgfVxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICog6YCS5b2S5Zyw5Y+N6L2s5LmJ5a+56LGh5oiW5pWw57uE5Lit5omA5pyJ5a2X56ym5Liy5YC85ZKM6ZSu55qE54m55q6K5a2X56ym44CCXHJcbiAqIEBwYXJhbSBkYXRhIC0g6KaB5aSE55CG55qE5pWw5o2u44CCXHJcbiAqIEByZXR1cm5zIC0g5Y+N6L2s5LmJ5ZCO55qE5pWw5o2u44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdW5lc2NhcGVFcmFEYXRhPFQ+KGRhdGE6IFQpOiBUIHtcclxuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gdW5lc2NhcGVFcmFEYXRhKGl0ZW0pKSBhcyBhbnk7XHJcbiAgfVxyXG4gIGlmIChfLmlzUGxhaW5PYmplY3QoZGF0YSkpIHtcclxuICAgIGNvbnN0IG5ld09iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xyXG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcclxuICAgICAgICBjb25zdCB1bmVzY2FwZWRLZXkgPSBrZXkucmVwbGFjZSh1bmVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBVTkVTQ0FQRV9NQVBbbWF0Y2hdKTtcclxuICAgICAgICBuZXdPYmpbdW5lc2NhcGVkS2V5XSA9IHVuZXNjYXBlRXJhRGF0YSgoZGF0YSBhcyBhbnkpW2tleV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3T2JqIGFzIGFueTtcclxuICB9XHJcbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xyXG4gICAgcmV0dXJuIGRhdGEucmVwbGFjZSh1bmVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBVTkVTQ0FQRV9NQVBbbWF0Y2hdKSBhcyBhbnk7XHJcbiAgfVxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICog5Yik5pat5LiA5Liq5YC85piv5ZCm5Li64oCc57qv57K555qE5a+56LGh4oCd77yIUGxhaW4gT2JqZWN077yJ44CCXHJcbiAqIOaVsOe7hOOAgW51bGzjgIHlh73mlbDjgIFEYXRlIOWvueixoeetiemDveS8mui/lOWbniBmYWxzZeOAglxyXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXmo4Dmn6XnmoTlgLzjgIJcclxuICogQHJldHVybnMge2Jvb2xlYW59IOWmguaenOaYr+e6r+eyueeahOWvueixoeWImei/lOWbniB0cnVl77yM5ZCm5YiZ6L+U5ZueIGZhbHNl44CCXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNQTyA9ICh2OiBhbnkpOiB2IGlzIFJlY29yZDxzdHJpbmcsIGFueT4gPT4gXy5pc1BsYWluT2JqZWN0KHYpO1xyXG5cclxuLyoqXHJcbiAqIOmAkuW9kuWcsOKAnOWHgOWMluKAneS4gOS4quWvueixoe+8jOWwhuWFtuS4reeahOaVsOe7hOaIluWvueixoeWAvOi9rOaNouS4uuWtl+espuS4suOAglxyXG4gKiDkuLvopoHnlKjkuo7lh4blpIfmlbDmja7ku6Xkvr/lnKjmn5DkupvnibnlrprlnLrmma/kuIvlsZXnpLrmiJblrZjlgqjjgIJcclxuICogQHBhcmFtIHsqfSB2IC0g5b6F5YeA5YyW55qE5YC844CCXHJcbiAqIEByZXR1cm5zIHsqfSDlh4DljJblkI7nmoTlgLzjgIJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzYW5pdGl6ZUFycmF5cyh2OiBhbnkpOiBhbnkge1xyXG4gIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XHJcbiAgICAvLyDlpoLmnpzmmK/mlbDnu4TvvIzliJnpgY3ljoblhbblhYPntKDjgILlpoLmnpzlhYPntKDmmK/mlbDnu4TmiJblr7nosaHvvIzliJnlrZfnrKbkuLLljJblroPjgIJcclxuICAgIHJldHVybiB2Lm1hcChlID0+IChBcnJheS5pc0FycmF5KGUpIHx8IF8uaXNQbGFpbk9iamVjdChlKSA/IEpTT04uc3RyaW5naWZ5KGUpIDogZSkpO1xyXG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHYpKSB7XHJcbiAgICAvLyDlpoLmnpzmmK/lr7nosaHvvIzliJnpgJLlvZLlnLDlr7nlhbbmr4/kuKrlsZ7mgKflgLzov5vooYzlh4DljJbjgIJcclxuICAgIGNvbnN0IG86IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICAgIGZvciAoY29uc3QgayBpbiB2KSBvW2tdID0gc2FuaXRpemVBcnJheXModltrXSk7XHJcbiAgICByZXR1cm4gbztcclxuICB9IGVsc2Uge1xyXG4gICAgLy8g5YW25LuW57G75Z6L55qE5YC855u05o6l6L+U5Zue44CCXHJcbiAgICByZXR1cm4gdjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlronlhajlnLDlsIbkuIDkuKrlr7nosaHluo/liJfljJbkuLrmoLzlvI/ljJbnmoQgSlNPTiDlrZfnrKbkuLLjgIJcclxuICog5aaC5p6c5bqP5YiX5YyW5aSx6LSl77yM5LiN5Lya5oqb5Ye65byC5bi477yM6ICM5piv6L+U5Zue5LiA5Liq5YyF5ZCr6ZSZ6K+v5L+h5oGv55qE5a2X56ym5Liy44CCXHJcbiAqIEBwYXJhbSB7Kn0gbyAtIOW+heW6j+WIl+WMlueahOWvueixoeOAglxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDmiJDlip/liJnov5Tlm54gSlNPTiDlrZfnrKbkuLLvvIzlpLHotKXliJnov5Tlm57plJnor6/mj5DnpLrjgIJcclxuICovXHJcbmV4cG9ydCBjb25zdCBKID0gKG86IGFueSk6IHN0cmluZyA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvLCBudWxsLCAyKTsgLy8g5L2/55SoIDIg5Liq56m65qC86L+b6KGM57yp6L+b77yM5o+Q6auY5Y+v6K+75oCn44CCXHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXR1cm4gYDw8c3RyaW5naWZ55aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0+PmA7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIOS9v+eUqOKAnOaWsOaVsOe7hOimhuebluaXp+aVsOe7hOKAneeahOetlueVpeadpea3seW6puWQiOW5tuS4pOS4quWvueixoeOAglxyXG4gKiDov5nmmK8gYF8ubWVyZ2VgIOeahOS4gOS4quWPmOS9k++8jOS4k+mXqOeUqOS6juWkhOeQhuaooeadv+WQiOW5tuetieWcuuaZr++8jFxyXG4gKiDlnKjov5nkupvlnLrmma/kuK3vvIzmiJHku6zluIzmnJvooaXkuIHlr7nosaHkuK3nmoTmlbDnu4Tog73lpJ/lrozlhajmm7/mjaLln7rnoYDlr7nosaHkuK3nmoTmlbDnu4TvvIzogIzkuI3mmK/lkIjlubblroPku6zjgIJcclxuICogQHBhcmFtIHsqfSBiYXNlIC0g5Z+656GA5a+56LGh44CCXHJcbiAqIEBwYXJhbSB7Kn0gcGF0Y2ggLSDooaXkuIHlr7nosaHjgIJcclxuICogQHJldHVybnMgeyp9IOWQiOW5tuWQjueahOaWsOWvueixoeOAglxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlUmVwbGFjZUFycmF5KGJhc2U6IGFueSwgcGF0Y2g6IGFueSk6IGFueSB7XHJcbiAgLy8g5L2/55SoIF8uY2xvbmVEZWVwIOehruS/neS4jeS/ruaUueWOn+Wni+WvueixoeOAglxyXG4gIHJldHVybiBfLm1lcmdlV2l0aChfLmNsb25lRGVlcChiYXNlKSwgXy5jbG9uZURlZXAocGF0Y2gpLCAoYTogYW55LCBiOiBhbnkpID0+IHtcclxuICAgIC8vIOiHquWumuS5ieWQiOW5tumAu+i+ke+8muWmguaenOS7u+S4gOWAvOS4uuaVsOe7hO+8jOWImeebtOaOpei/lOWbnuihpeS4geWAvO+8iGLvvInvvIzku47ogIzlrp7njrDopobnm5bjgIJcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGEpIHx8IEFycmF5LmlzQXJyYXkoYikpIHJldHVybiBiO1xyXG4gICAgLy8g5a+55LqO6Z2e5pWw57uE57G75Z6L77yM6L+U5ZueIHVuZGVmaW5lZCDku6Xkvb/nlKggXy5tZXJnZSDnmoTpu5jorqTlkIjlubbooYzkuLrjgIJcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlgaXlo67lnLDop6PmnpAgYEVkaXRMb2dgIOeahOWOn+Wni+aVsOaNruOAglxyXG4gKiBgRWRpdExvZ2Ag5Y+v6IO95Lul5aSa56eN5qC85byP5a2Y5Zyo77yI5a+56LGh44CB5pWw57uE44CBSlNPTuWtl+espuS4su+8ie+8jOatpOWHveaVsOaXqOWcqOe7n+S4gOWkhOeQhuWug+S7rOOAglxyXG4gKiBAcGFyYW0geyp9IHJhdyAtIOS7juWPmOmHj+S4reivu+WPlueahOWOn+WniyBgRWRpdExvZ2Ag5pWw5o2u44CCXHJcbiAqIEByZXR1cm5zIHthbnlbXX0g6Kej5p6Q5ZCO55qEIGBFZGl0TG9nYCDmlbDnu4TjgILlpoLmnpzop6PmnpDlpLHotKXmiJbovpPlhaXml6DmlYjvvIzliJnov5Tlm57kuIDkuKrnqbrmlbDnu4TjgIJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUVkaXRMb2cocmF3OiBhbnkpOiBhbnlbXSB7XHJcbiAgaWYgKEFycmF5LmlzQXJyYXkocmF3KSkgcmV0dXJuIHJhdztcclxuICBpZiAocmF3ICYmIHR5cGVvZiByYXcgPT09ICdvYmplY3QnKSByZXR1cm4gW3Jhd107IC8vIOWNleS4quWvueixoeS5n+inhuS4uuacieaViOaXpeW/l1xyXG4gIGlmICh0eXBlb2YgcmF3ID09PSAnc3RyaW5nJykge1xyXG4gICAgY29uc3QgcyA9IHJhdy5yZXBsYWNlKC9eXFxzKmBgYCg/Ompzb24pP1xccyp8XFxzKmBgYFxccyokL2csICcnKTsgLy8g56e76Zmk5Luj56CB5Zu05qCPXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBhcnIgPSBKU09OLnBhcnNlKHMpO1xyXG4gICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhcnIpID8gYXJyIDogW107XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDop6PmnpDkuIDkuKrljIXlkKvlpJrkuKrkuLLogZQgSlNPTiDlr7nosaHnmoTlrZfnrKbkuLLvvIjnsbvkvLzkuo4gSlNPTkwg5qC85byP77yJ44CCXHJcbiAqIOi/meenjeagvOW8j+acieaXtuS8mueUsSBBSSDnlJ/miJDjgILmraTlh73mlbDog73lpJ/pgJDkuKrmj5Dlj5blubbop6PmnpDlroPku6zjgIJcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciAtIOW+heino+aekOeahOWtl+espuS4suOAglxyXG4gKiBAcmV0dXJucyB7YW55W119IOino+aekOWHuueahOWvueixoeaVsOe7hOOAglxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlSnNvbmwoc3RyOiBzdHJpbmcpOiBhbnlbXSB7XHJcbiAgY29uc3Qgb2JqZWN0czogYW55W10gPSBbXTtcclxuICBpZiAoIXN0ciB8fCB0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykge1xyXG4gICAgcmV0dXJuIG9iamVjdHM7XHJcbiAgfVxyXG5cclxuICAvLyDlnKjop6PmnpDliY3vvIzlhYjnp7vpmaTmiYDmnInnsbvlnovnmoTms6jph4rvvIzku6Xmj5Dpq5jop6PmnpDnmoTpsoHmo5LmgKfjgIJcclxuICBjb25zdCBzdHJXaXRob3V0Q29tbWVudHMgPSBzdHJcclxuICAgIC5yZXBsYWNlKC9cXC9cXC8uKi9nLCAnJykgLy8g56e76ZmkIC8vIOmjjuagvOeahOWNleihjOazqOmHilxyXG4gICAgLnJlcGxhY2UoL1xcL1xcKltcXHNcXFNdKj9cXCpcXC8vZywgJycpIC8vIOenu+mZpCAvKiAuLi4gKi8g6aOO5qC855qE5aSa6KGM5rOo6YeKXHJcbiAgICAucmVwbGFjZSgvPCEtLVtcXHNcXFNdKj8tLT4vZywgJycpOyAvLyDnp7vpmaQgPCEtLSAuLi4gLS0+IOmjjuagvOeahCBIVE1ML1hNTCDms6jph4pcclxuICBjb25zdCB0cmltbWVkU3RyID0gc3RyV2l0aG91dENvbW1lbnRzLnRyaW0oKTtcclxuXHJcbiAgbGV0IGJyYWNlQ291bnQgPSAwOyAvLyDoirHmi6zlj7flubPooaHorqHmlbDlmahcclxuICBsZXQgc3RhcnRJbmRleCA9IC0xOyAvLyDlvZPliY0gSlNPTiDlr7nosaHnmoTotbflp4vntKLlvJVcclxuICBsZXQgaW5TdHJpbmcgPSBmYWxzZTsgLy8g5qCH6K6w5piv5ZCm5aSE5LqO5Y+M5byV5Y+35a2X56ym5Liy5YaF6YOoXHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpbW1lZFN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3QgY2hhciA9IHRyaW1tZWRTdHJbaV07XHJcblxyXG4gICAgLy8g5YiH5o2iIGluU3RyaW5nIOeKtuaAge+8jOW/veeVpei9rOS5ieeahOWPjOW8leWPt1xyXG4gICAgaWYgKGNoYXIgPT09ICdcIicgJiYgKGkgPT09IDAgfHwgdHJpbW1lZFN0cltpIC0gMV0gIT09ICdcXFxcJykpIHtcclxuICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5aaC5p6c5Zyo5a2X56ym5Liy5YaF6YOo77yM5YiZ6Lez6L+H5omA5pyJ6Iqx5ous5Y+355qE6YC76L6R5Yik5patXHJcbiAgICBpZiAoaW5TdHJpbmcpIGNvbnRpbnVlO1xyXG5cclxuICAgIGlmIChjaGFyID09PSAneycpIHtcclxuICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDApIHtcclxuICAgICAgICAvLyDlj5HnjrDkuIDkuKrmlrAgSlNPTiDlr7nosaHnmoTlvIDlp4tcclxuICAgICAgICBzdGFydEluZGV4ID0gaTtcclxuICAgICAgfVxyXG4gICAgICBicmFjZUNvdW50Kys7XHJcbiAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICd9Jykge1xyXG4gICAgICBpZiAoYnJhY2VDb3VudCA+IDApIHtcclxuICAgICAgICBicmFjZUNvdW50LS07XHJcbiAgICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDAgJiYgc3RhcnRJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgIC8vIOiKseaLrOWPt+W5s+ihoe+8jOS4gOS4quWujOaVtOeahCBKU09OIOWvueixoeiiq+aJvuWIsFxyXG4gICAgICAgICAgY29uc3QganNvblN0cmluZyA9IHRyaW1tZWRTdHIuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGkgKyAxKTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7XHJcbiAgICAgICAgICAgIG9iamVjdHMucHVzaChvYmopO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgICAgICAgIC8vIOWmguaenOino+aekOWksei0pe+8jOWcqOaOp+WItuWPsOaJk+WNsOmUmeivr+W5tue7p+e7re+8jOS4jeS4reaWreaVtOS4qui/h+eoi1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBbRVJBL3V0aWxzL3BhcnNlSnNvbmxdIEpTT05MIOino+aekOWksei0pTogJHtlPy5tZXNzYWdlIHx8IGV9LiDlpLHotKXnmoTniYfmrrU6ICR7anNvblN0cmluZ31gLCBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOmHjee9rueKtuaAge+8jOWHhuWkh+Wvu+aJvuS4i+S4gOS4quWvueixoVxyXG4gICAgICAgICAgc3RhcnRJbmRleCA9IC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gb2JqZWN0cztcclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/era_data.ts": 
  /*!***************************************!*\
  !*** ./src/ERA变量框架/utils/era_data.ts ***!
  \***************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getEraData: () => (/* binding */ getEraData),\n/* harmony export */   removeMetaFields: () => (/* binding */ removeMetaFields),\n/* harmony export */   updateEraMetaData: () => (/* binding */ updateEraMetaData),\n/* harmony export */   updateEraStatData: () => (/* binding */ updateEraStatData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/**\n * @file ERA 变量框架 - ERA 核心变量读写模块\n */\n\n\n\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nfunction removeMetaFields(obj) {\n    // 对于非对象类型，直接返回原始值\n    if (!lodash__WEBPACK_IMPORTED_MODULE_0___default().isObject(obj)) {\n        return obj;\n    }\n    // 创建深拷贝以避免修改原始对象\n    const newObj = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(obj);\n    function recurse(current) {\n        if (Array.isArray(current)) {\n            // 如果是数组，则递归处理数组中的每个元素\n            current.forEach(item => recurse(item));\n        }\n        else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(current)) {\n            // 如果是纯粹的对象，遍历其所有键\n            for (const key in current) {\n                // 如果键以 '$' 开头，则删除该属性\n                if (key.startsWith('$')) {\n                    delete current[key];\n                }\n                else {\n                    // 否则，递归处理该属性的值\n                    recurse(current[key]);\n                }\n            }\n        }\n    }\n    recurse(newObj);\n    return newObj;\n}\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nfunction getEraData() {\n    const chatVars = getVariables(_constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE) || {};\n    const meta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n    const stat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n    return { meta, stat };\n}\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nasync function updateEraStatData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentStat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n        const newStat = await updater(currentStat);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, newStat);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nasync function updateEraMetaData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentMeta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n        const newMeta = await updater(currentMeta);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, newMeta);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Olsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2VyYV9kYXRhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0gRVJBIOaguOW/g+WPmOmHj+ivu+WGmeaooeWdl1xyXG4gKi9cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCB7IENIQVRfU0NPUEUsIE1FVEFfREFUQV9QQVRILCBTVEFUX0RBVEFfUEFUSCB9IGZyb20gJy4vY29uc3RhbnRzJztcclxuXHJcbi8qKlxyXG4gKiDpgJLlvZLlnLDku47lr7nosaHkuK3np7vpmaTmiYDmnInku6UgYCRgIOW8gOWktOeahOWtl+aute+8iOWmgiBgJG1ldGFgLCBgJHRlbXBsYXRlYO+8ieOAglxyXG4gKiDmraTlh73mlbDkvJrliJvlu7rkuIDkuKrlr7nosaHnmoTmt7Hmi7fotJ3vvIzlm6DmraTkuI3kvJrkv67mlLnljp/lp4vlr7nosaHjgIJcclxuICogQHBhcmFtIHthbnl9IG9iaiAtIOW+heWkhOeQhueahOWvueixoeaIluWAvOOAglxyXG4gKiBAcmV0dXJucyB7YW55fSDkuIDkuKrkuI3ljIXlkKsgYCRgIOWJjee8gOWtl+auteeahOaWsOWvueixoeaIluWOn+Wni+WAvOOAglxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU1ldGFGaWVsZHMob2JqOiBhbnkpOiBhbnkge1xyXG4gIC8vIOWvueS6jumdnuWvueixoeexu+Wei++8jOebtOaOpei/lOWbnuWOn+Wni+WAvFxyXG4gIGlmICghXy5pc09iamVjdChvYmopKSB7XHJcbiAgICByZXR1cm4gb2JqO1xyXG4gIH1cclxuXHJcbiAgLy8g5Yib5bu65rex5ou36LSd5Lul6YG/5YWN5L+u5pS55Y6f5aeL5a+56LGhXHJcbiAgY29uc3QgbmV3T2JqID0gXy5jbG9uZURlZXAob2JqKTtcclxuXHJcbiAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50OiBhbnkpIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGN1cnJlbnQpKSB7XHJcbiAgICAgIC8vIOWmguaenOaYr+aVsOe7hO+8jOWImemAkuW9kuWkhOeQhuaVsOe7hOS4reeahOavj+S4quWFg+e0oFxyXG4gICAgICBjdXJyZW50LmZvckVhY2goaXRlbSA9PiByZWN1cnNlKGl0ZW0pKTtcclxuICAgIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KGN1cnJlbnQpKSB7XHJcbiAgICAgIC8vIOWmguaenOaYr+e6r+eyueeahOWvueixoe+8jOmBjeWOhuWFtuaJgOaciemUrlxyXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBjdXJyZW50KSB7XHJcbiAgICAgICAgLy8g5aaC5p6c6ZSu5LulICckJyDlvIDlpLTvvIzliJnliKDpmaTor6XlsZ7mgKdcclxuICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoJyQnKSkge1xyXG4gICAgICAgICAgZGVsZXRlIGN1cnJlbnRba2V5XTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5ZCm5YiZ77yM6YCS5b2S5aSE55CG6K+l5bGe5oCn55qE5YC8XHJcbiAgICAgICAgICByZWN1cnNlKGN1cnJlbnRba2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWN1cnNlKG5ld09iaik7XHJcbiAgcmV0dXJuIG5ld09iajtcclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPluW5tuehruS/nSBFUkEg55qE5YWD5pWw5o2u5ZKM54q25oCB5pWw5o2u5a+56LGh55qE5a2Y5Zyo44CCXHJcbiAqIEByZXR1cm5zIHt7bWV0YTogb2JqZWN0LCBzdGF0OiBvYmplY3R9fSDljIXlkKvlhYPmlbDmja7lkoznirbmgIHmlbDmja7nmoTlr7nosaHjgIJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFcmFEYXRhKCk6IHsgbWV0YTogYW55OyBzdGF0OiBhbnkgfSB7XHJcbiAgY29uc3QgY2hhdFZhcnMgPSBnZXRWYXJpYWJsZXMoQ0hBVF9TQ09QRSkgfHwge307XHJcbiAgY29uc3QgbWV0YSA9IF8uZ2V0KGNoYXRWYXJzLCBNRVRBX0RBVEFfUEFUSCwge30pO1xyXG4gIGNvbnN0IHN0YXQgPSBfLmdldChjaGF0VmFycywgU1RBVF9EQVRBX1BBVEgsIHt9KTtcclxuICByZXR1cm4geyBtZXRhLCBzdGF0IH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDljp/lrZDmgKflnLDmm7TmlrAgRVJBIOeahOeKtuaAgeaVsOaNriAoc3RhdF9kYXRhKeOAglxyXG4gKiBAcGFyYW0geyhjdXJyZW50U3RhdERhdGE6IGFueSkgPT4gKGFueSB8IFByb21pc2U8YW55Pil9IHVwZGF0ZXIgLSDkuIDkuKrmjqXmlLblvZPliY0gc3RhdF9kYXRhIOW5tui/lOWbnuS/ruaUueWQjiBzdGF0X2RhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRXJhU3RhdERhdGEodXBkYXRlcjogKGN1cnJlbnRTdGF0RGF0YTogYW55KSA9PiBhbnkgfCBQcm9taXNlPGFueT4pIHtcclxuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudFN0YXQgPSBfLmdldCh2LCBTVEFUX0RBVEFfUEFUSCwge30pO1xyXG4gICAgY29uc3QgbmV3U3RhdCA9IGF3YWl0IHVwZGF0ZXIoY3VycmVudFN0YXQpO1xyXG4gICAgXy5zZXQodiwgU1RBVF9EQVRBX1BBVEgsIG5ld1N0YXQpO1xyXG4gICAgcmV0dXJuIHY7XHJcbiAgfSwgQ0hBVF9TQ09QRSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDljp/lrZDmgKflnLDmm7TmlrAgRVJBIOeahOWFg+aVsOaNriAoRVJBTWV0YURhdGEp44CCXHJcbiAqIEBwYXJhbSB7KGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBFUkFNZXRhRGF0YSDlubbov5Tlm57kv67mlLnlkI4gRVJBTWV0YURhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRXJhTWV0YURhdGEodXBkYXRlcjogKGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiBhbnkgfCBQcm9taXNlPGFueT4pIHtcclxuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudE1ldGEgPSBfLmdldCh2LCBNRVRBX0RBVEFfUEFUSCwge30pO1xyXG4gICAgY29uc3QgbmV3TWV0YSA9IGF3YWl0IHVwZGF0ZXIoY3VycmVudE1ldGEpO1xyXG4gICAgXy5zZXQodiwgTUVUQV9EQVRBX1BBVEgsIG5ld01ldGEpO1xyXG4gICAgcmV0dXJuIHY7XHJcbiAgfSwgQ0hBVF9TQ09QRSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/era_data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/log.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/utils/log.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LOG_CONFIG: () => (/* binding */ LOG_CONFIG),\n/* harmony export */   Logger: () => (/* binding */ Logger),\n/* harmony export */   logContext: () => (/* binding */ logContext)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 日志记录模块\n */\n\n/**\n * @constant {object} LOG_CONFIG\n * @description\n * 用于控制日志输出的配置对象。\n */\nconst LOG_CONFIG = {\n    // 定义所有可用的日志级别及其权重。数字越小，级别越低。\n    levels: {\n        debug: 0,\n        log: 1,\n        warn: 2,\n        error: 3,\n    },\n    // 设置当前全局日志级别。只有权重等于或高于此级别的日志才会被输出。\n    currentLevel: 0, // 默认为 'debug'\n    // 'debug' 级别的白名单。只有当 currentLevel 为 debug 时，此列表才生效。\n    // 只有在此列表中的模块才会输出 debug 日志。\n    debugWhitelist: [\n        'api',\n        'delete',\n        'event_queue',\n        'force_macro_render',\n        'insert',\n        'message_key',\n        'message_utils',\n        'query',\n        'rollback',\n        'sync',\n        'template',\n        'update',\n        'variable_change_processor',\n    ],\n};\n// 初始化时将 currentLevel 设置为 debug 级别\nLOG_CONFIG.currentLevel = LOG_CONFIG.levels.debug;\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持日志分级的记录器。\n *\n * **核心功能**:\n * 1. **日志分级**: 提供 `debug`, `log`, `warn`, `error` 四个级别，方便过滤和定位问题。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式，清晰明了。\n * 3. **控制台输出**: 日志会根据级别使用不同颜色和样式的 `console` 方法输出，便于在浏览器中实时调试。\n * 4. **纯粹的控制台日志**: 日志系统不再向酒馆聊天变量中写入任何数据，避免了性能问题和数据污染。\n */\n/**\n * @type {{mk: string}}\n * @description 一个用于在事件处理期间临时存储日志上下文（如 Message Key）的对象。\n */\nconst logContext = {\n    mk: '',\n};\nclass Logger {\n    moduleName;\n    /**\n     * 创建一个新的 Logger 实例。\n     * @param {string} moduleName - 该 Logger 实例绑定的模块名称。\n     */\n    constructor(moduleName) {\n        this.moduleName = moduleName;\n    }\n    /**\n     * 格式化日志消息。\n     * @param {string} funcName - 调用日志的函数名。\n     * @param {any} message - 日志内容。\n     * @returns {string} 格式化后的日志字符串。\n     */\n    formatMessage(funcName, message) {\n        const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n        return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n    }\n    /**\n     * 记录一条 debug 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    debug(funcName, message, obj) {\n        // 1. 全局级别检查\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.debug)\n            return;\n        // 2. 白名单检查 (仅对 debug 生效)\n        if (LOG_CONFIG.currentLevel === LOG_CONFIG.levels.debug && !LOG_CONFIG.debugWhitelist.includes(this.moduleName)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.debug(formattedMessage, obj);\n        }\n        else {\n            console.debug(formattedMessage);\n        }\n    }\n    /**\n     * 记录一条 log 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    log(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.log)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n        }\n        else {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;');\n        }\n    }\n    /**\n     * 记录一条 warn 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    warn(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.warn)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n        }\n        else {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n        }\n    }\n    /**\n     * 记录一条 error 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [errorObj] - 可选的、附加到日志中的错误对象。\n     */\n    error(funcName, message, errorObj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.error)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (errorObj) {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n        }\n        else {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvbG9nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5pel5b+X6K6w5b2V5qih5Z2XXHJcbiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuLyoqXHJcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBMT0dfQ09ORklHXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiDnlKjkuo7mjqfliLbml6Xlv5fovpPlh7rnmoTphY3nva7lr7nosaHjgIJcclxuICovXHJcbmV4cG9ydCBjb25zdCBMT0dfQ09ORklHID0ge1xyXG4gIC8vIOWumuS5ieaJgOacieWPr+eUqOeahOaXpeW/l+e6p+WIq+WPiuWFtuadg+mHjeOAguaVsOWtl+i2iuWwj++8jOe6p+WIq+i2iuS9juOAglxyXG4gIGxldmVsczoge1xyXG4gICAgZGVidWc6IDAsXHJcbiAgICBsb2c6IDEsXHJcbiAgICB3YXJuOiAyLFxyXG4gICAgZXJyb3I6IDMsXHJcbiAgfSxcclxuXHJcbiAgLy8g6K6+572u5b2T5YmN5YWo5bGA5pel5b+X57qn5Yir44CC5Y+q5pyJ5p2D6YeN562J5LqO5oiW6auY5LqO5q2k57qn5Yir55qE5pel5b+X5omN5Lya6KKr6L6T5Ye644CCXHJcbiAgY3VycmVudExldmVsOiAwLCAvLyDpu5jorqTkuLogJ2RlYnVnJ1xyXG5cclxuICAvLyAnZGVidWcnIOe6p+WIq+eahOeZveWQjeWNleOAguWPquacieW9kyBjdXJyZW50TGV2ZWwg5Li6IGRlYnVnIOaXtu+8jOatpOWIl+ihqOaJjeeUn+aViOOAglxyXG4gIC8vIOWPquacieWcqOatpOWIl+ihqOS4reeahOaooeWdl+aJjeS8mui+k+WHuiBkZWJ1ZyDml6Xlv5fjgIJcclxuICBkZWJ1Z1doaXRlbGlzdDogW1xyXG4gICAgJ2FwaScsXHJcbiAgICAnZGVsZXRlJyxcclxuICAgICdldmVudF9xdWV1ZScsXHJcbiAgICAnZm9yY2VfbWFjcm9fcmVuZGVyJyxcclxuICAgICdpbnNlcnQnLFxyXG4gICAgJ21lc3NhZ2Vfa2V5JyxcclxuICAgICdtZXNzYWdlX3V0aWxzJyxcclxuICAgICdxdWVyeScsXHJcbiAgICAncm9sbGJhY2snLFxyXG4gICAgJ3N5bmMnLFxyXG4gICAgJ3RlbXBsYXRlJyxcclxuICAgICd1cGRhdGUnLFxyXG4gICAgJ3ZhcmlhYmxlX2NoYW5nZV9wcm9jZXNzb3InLFxyXG4gIF0gYXMgc3RyaW5nW10sXHJcbn07XHJcbi8vIOWIneWni+WMluaXtuWwhiBjdXJyZW50TGV2ZWwg6K6+572u5Li6IGRlYnVnIOe6p+WIq1xyXG5MT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA9IExPR19DT05GSUcubGV2ZWxzLmRlYnVnO1xyXG5cclxuLyoqXHJcbiAqIEBjbGFzcyBMb2dnZXJcclxuICogQGRlc2NyaXB0aW9uIOS4gOS4quS4uiBFUkEg5qGG5p626K6+6K6h55qE44CB5pSv5oyB5pel5b+X5YiG57qn55qE6K6w5b2V5Zmo44CCXHJcbiAqXHJcbiAqICoq5qC45b+D5Yqf6IO9Kio6XHJcbiAqIDEuICoq5pel5b+X5YiG57qnKio6IOaPkOS+myBgZGVidWdgLCBgbG9nYCwgYHdhcm5gLCBgZXJyb3JgIOWbm+S4que6p+WIq++8jOaWueS+v+i/h+a7pOWSjOWumuS9jemXrumimOOAglxyXG4gKiAyLiAqKue7n+S4gOagvOW8jyoqOiDmiYDmnInml6Xlv5fpg73pgbXlvqogYOOAikVSQeOAi+OAjOaooeWdl+WQjeOAjeOAkOWHveaVsOWQjeOAkeaXpeW/l+WGheWuuWAg55qE5qC85byP77yM5riF5pmw5piO5LqG44CCXHJcbiAqIDMuICoq5o6n5Yi25Y+w6L6T5Ye6Kio6IOaXpeW/l+S8muagueaNrue6p+WIq+S9v+eUqOS4jeWQjOminOiJsuWSjOagt+W8j+eahCBgY29uc29sZWAg5pa55rOV6L6T5Ye677yM5L6/5LqO5Zyo5rWP6KeI5Zmo5Lit5a6e5pe26LCD6K+V44CCXHJcbiAqIDQuICoq57qv57K555qE5o6n5Yi25Y+w5pel5b+XKio6IOaXpeW/l+ezu+e7n+S4jeWGjeWQkemFkummhuiBiuWkqeWPmOmHj+S4reWGmeWFpeS7u+S9leaVsOaNru+8jOmBv+WFjeS6huaAp+iDvemXrumimOWSjOaVsOaNruaxoeafk+OAglxyXG4gKi9cclxuLyoqXHJcbiAqIEB0eXBlIHt7bWs6IHN0cmluZ319XHJcbiAqIEBkZXNjcmlwdGlvbiDkuIDkuKrnlKjkuo7lnKjkuovku7blpITnkIbmnJ/pl7TkuLTml7blrZjlgqjml6Xlv5fkuIrkuIvmlofvvIjlpoIgTWVzc2FnZSBLZXnvvInnmoTlr7nosaHjgIJcclxuICovXHJcbmV4cG9ydCBjb25zdCBsb2dDb250ZXh0ID0ge1xyXG4gIG1rOiAnJyxcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xyXG4gIHByaXZhdGUgbW9kdWxlTmFtZTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rkuIDkuKrmlrDnmoQgTG9nZ2VyIOWunuS+i+OAglxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtb2R1bGVOYW1lIC0g6K+lIExvZ2dlciDlrp7kvovnu5HlrprnmoTmqKHlnZflkI3np7DjgIJcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvcihtb2R1bGVOYW1lOiBzdHJpbmcpIHtcclxuICAgIHRoaXMubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLzlvI/ljJbml6Xlv5fmtojmga/jgIJcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDosIPnlKjml6Xlv5fnmoTlh73mlbDlkI3jgIJcclxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IOagvOW8j+WMluWQjueahOaXpeW/l+Wtl+espuS4suOAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgZm9ybWF0TWVzc2FnZShmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgbWtTdHJpbmcgPSBsb2dDb250ZXh0Lm1rID8gYO+8iCR7bG9nQ29udGV4dC5ta33vvIlgIDogJyc7XHJcbiAgICByZXR1cm4gYOOAikVSQeOAiyR7bWtTdHJpbmd944CMJHt0aGlzLm1vZHVsZU5hbWV944CN44CQJHtmdW5jTmFtZX3jgJEke1N0cmluZyhtZXNzYWdlKX1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6w5b2V5LiA5p2hIGRlYnVnIOe6p+WIq+eahOaXpeW/l+OAglxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxyXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXHJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXHJcbiAgICovXHJcbiAgZGVidWcoZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBvYmo/OiBhbnkpIHtcclxuICAgIC8vIDEuIOWFqOWxgOe6p+WIq+ajgOafpVxyXG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMuZGVidWcpIHJldHVybjtcclxuICAgIC8vIDIuIOeZveWQjeWNleajgOafpSAo5LuF5a+5IGRlYnVnIOeUn+aViClcclxuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA9PT0gTE9HX0NPTkZJRy5sZXZlbHMuZGVidWcgJiYgIUxPR19DT05GSUcuZGVidWdXaGl0ZWxpc3QuaW5jbHVkZXModGhpcy5tb2R1bGVOYW1lKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XHJcbiAgICBpZiAob2JqKSB7XHJcbiAgICAgIGNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzc2FnZSwgb2JqKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXkuIDmnaEgbG9nIOe6p+WIq+eahOaXpeW/l+OAglxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxyXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXHJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXHJcbiAgICovXHJcbiAgbG9nKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgb2JqPzogYW55KSB7XHJcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPiBMT0dfQ09ORklHLmxldmVscy5sb2cpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcclxuICAgIGlmIChvYmopIHtcclxuICAgICAgY29uc29sZS5sb2coYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogIzM0OThkYjsnLCBvYmopO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogIzM0OThkYjsnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiusOW9leS4gOadoSB3YXJuIOe6p+WIq+eahOaXpeW/l+OAglxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxyXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXHJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXHJcbiAgICovXHJcbiAgd2FybihmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xyXG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMud2FybikgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xyXG4gICAgaWYgKG9iaikge1xyXG4gICAgICBjb25zb2xlLndhcm4oYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2YzOWMxMjsnLCBvYmopO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNmMzljMTI7Jyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXkuIDmnaEgZXJyb3Ig57qn5Yir55qE5pel5b+X44CCXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g5Ye95pWw5ZCN44CCXHJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcclxuICAgKiBAcGFyYW0ge2FueX0gW2Vycm9yT2JqXSAtIOWPr+mAieeahOOAgemZhOWKoOWIsOaXpeW/l+S4reeahOmUmeivr+WvueixoeOAglxyXG4gICAqL1xyXG4gIGVycm9yKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgZXJyb3JPYmo/OiBhbnkpIHtcclxuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA+IExPR19DT05GSUcubGV2ZWxzLmVycm9yKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XHJcbiAgICBpZiAoZXJyb3JPYmopIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZTc0YzNjOyBmb250LXdlaWdodDogYm9sZDsnLCBlcnJvck9iaik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNlNzRjM2M7IGZvbnQtd2VpZ2h0OiBib2xkOycpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/log.ts\n\n}");
  },
  "./src/ERA变量框架/utils/message.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/utils/message.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   updateMessageContent: () => (/* binding */ updateMessageContent)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 消息内容更新模块\n */\n\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n */\nasync function updateMessageContent(message, newContent) {\n    const updatePayload = {\n        message_id: message.message_id,\n    };\n    if (Array.isArray(message.swipes)) {\n        const sid = Number(message.swipe_id ?? 0);\n        const newSwipes = [...message.swipes];\n        newSwipes[sid] = newContent;\n        updatePayload.swipes = newSwipes;\n    }\n    else {\n        updatePayload.message = newContent;\n    }\n    await setChatMessages([updatePayload]);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL21lc3NhZ2UudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBOztHQUVHO0FBRVU7QUFFYjs7Ozs7R0FLRztBQUNJLEtBQUssVUFBVSxvQkFBb0IsQ0FBQyxPQUFZLEVBQUUsVUFBa0I7SUFDekUsTUFBTSxhQUFhLEdBQWdFO1FBQ2pGLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtLQUMvQixDQUFDO0lBRUYsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sU0FBUyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQztRQUM1QixhQUFhLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztJQUNuQyxDQUFDO1NBQU0sQ0FBQztRQUNOLGFBQWEsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO0lBQ3JDLENBQUM7SUFFRCxNQUFNLGVBQWUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFDekMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL21lc3NhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lhoXlrrnmm7TmlrDmqKHlnZdcclxuICovXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4vKipcclxuICogKirjgJDpgJrnlKjjgJEqKiDmm7TmlrDmjIflrprmtojmga/nmoTlhoXlrrnjgIJcclxuICog6L+Z5Liq6L6F5Yqp5Ye95pWw5bCB6KOF5LqG5aSE55CGIGBzd2lwZXNgIOWSjOaZrumAmiBgbWVzc2FnZWAg55qE6YC76L6R77yM5o+Q5L6b5LiA5Liq57uf5LiA55qE5YaZ5YWl5o6l5Y+j44CCXHJcbiAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g6KaB5pu05paw55qE5raI5oGv5a+56LGh44CCXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdDb250ZW50IC0g5YWo5paw55qE5raI5oGv5YaF5a6544CCXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTWVzc2FnZUNvbnRlbnQobWVzc2FnZTogYW55LCBuZXdDb250ZW50OiBzdHJpbmcpIHtcclxuICBjb25zdCB1cGRhdGVQYXlsb2FkOiB7IG1lc3NhZ2VfaWQ6IG51bWJlcjsgbWVzc2FnZT86IHN0cmluZzsgc3dpcGVzPzogc3RyaW5nW10gfSA9IHtcclxuICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2UubWVzc2FnZV9pZCxcclxuICB9O1xyXG5cclxuICBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlLnN3aXBlcykpIHtcclxuICAgIGNvbnN0IHNpZCA9IE51bWJlcihtZXNzYWdlLnN3aXBlX2lkID8/IDApO1xyXG4gICAgY29uc3QgbmV3U3dpcGVzID0gWy4uLm1lc3NhZ2Uuc3dpcGVzXTtcclxuICAgIG5ld1N3aXBlc1tzaWRdID0gbmV3Q29udGVudDtcclxuICAgIHVwZGF0ZVBheWxvYWQuc3dpcGVzID0gbmV3U3dpcGVzO1xyXG4gIH0gZWxzZSB7XHJcbiAgICB1cGRhdGVQYXlsb2FkLm1lc3NhZ2UgPSBuZXdDb250ZW50O1xyXG4gIH1cclxuXHJcbiAgYXdhaXQgc2V0Q2hhdE1lc3NhZ2VzKFt1cGRhdGVQYXlsb2FkXSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/message.ts\n\n}");
  },
  "./src/ERA变量框架/utils/message_utils.ts": 
  /*!********************************************!*\
  !*** ./src/ERA变量框架/utils/message_utils.ts ***!
  \********************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastAiMessage: () => (/* binding */ findLastAiMessage),\n/* harmony export */   getMessageContent: () => (/* binding */ getMessageContent),\n/* harmony export */   isUserMessage: () => (/* binding */ isUserMessage)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 消息处理工具模块\n * @description\n * 该文件提供了一系列用于处理和查询酒馆消息对象的通用辅助函数。\n */\n\n\n\nconst log = new _log__WEBPACK_IMPORTED_MODULE_1__.Logger('message_utils');\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nfunction getMessageContent(msg) {\n    if (!msg)\n        return null;\n    // 优先检查 .mes 属性，这是新版酒馆的规范\n    if (typeof msg.mes === 'string') {\n        return msg.mes;\n    }\n    // 如果没有 .mes，则处理 swipes\n    if (Array.isArray(msg.swipes)) {\n        const sid = Number(msg.swipe_id ?? 0);\n        return msg.swipes[sid] || null;\n    }\n    // 最后，作为兼容，检查旧版的 .message 属性\n    if (typeof msg.message === 'string') {\n        return msg.message;\n    }\n    return null;\n}\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            const eraData = {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n            log.debug('parseEraData', '成功解析 EraData', eraData);\n            return eraData;\n        }\n        log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n        return null;\n    }\n    catch (e) {\n        log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n        return null;\n    }\n}\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nfunction isUserMessage(msg) {\n    const content = getMessageContent(msg);\n    const data = parseEraData(content);\n    if (data) {\n        return data['era-message-type'] === 'user';\n    }\n    // 回退到检查 role 属性\n    return msg?.role === 'user';\n}\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nfunction findLastAiMessage() {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    if (!messages || messages.length === 0) {\n        log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n        return null;\n    }\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const msg = messages[i];\n        if (!isUserMessage(msg)) {\n            log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n            return msg;\n        }\n    }\n    log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL21lc3NhZ2VfdXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7OztHQUlHO0FBRVU7QUFFZ0M7QUFDZDtBQUUvQixNQUFNLEdBQUcsR0FBRyxJQUFJLHdDQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7QUFVeEM7Ozs7O0dBS0c7QUFDSSxTQUFTLGlCQUFpQixDQUFDLEdBQVE7SUFDeEMsSUFBSSxDQUFDLEdBQUc7UUFBRSxPQUFPLElBQUksQ0FBQztJQUV0Qix5QkFBeUI7SUFDekIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxHQUFHLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDaEMsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDO0lBQ2pCLENBQUM7SUFDRCx1QkFBdUI7SUFDdkIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQzlCLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDakMsQ0FBQztJQUNELDRCQUE0QjtJQUM1QixJQUFJLE9BQU8sR0FBRyxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUNwQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUM7SUFDckIsQ0FBQztJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxTQUFTLFlBQVksQ0FBQyxjQUF5QztJQUM3RCxJQUFJLE9BQU8sY0FBYyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELE1BQU0sS0FBSyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsc0RBQWMsQ0FBQyxDQUFDO0lBQ25ELElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUN4QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxJQUFJLENBQUM7UUFDSCx1REFBdUQ7UUFDdkQsd0JBQXdCO1FBQ3hCLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0sU0FBUyxHQUFHLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBRTlFLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNwQyxNQUFNLE9BQU8sR0FBRztnQkFDZCxpQkFBaUIsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixrQkFBa0IsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUF5QjthQUN6RCxDQUFDO1lBQ0YsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ25ELE9BQU8sT0FBTyxDQUFDO1FBQ2pCLENBQUM7UUFDRCxHQUFHLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSx3QkFBd0IsRUFBRSxFQUFFLGlCQUFpQixFQUFFLENBQUMsQ0FBQztRQUMzRSxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ1gsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDakQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0ksU0FBUyxhQUFhLENBQUMsR0FBUTtJQUNwQyxNQUFNLE9BQU8sR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN2QyxNQUFNLElBQUksR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbkMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNULE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssTUFBTSxDQUFDO0lBQzdDLENBQUM7SUFDRCxnQkFBZ0I7SUFDaEIsT0FBTyxHQUFHLEVBQUUsSUFBSSxLQUFLLE1BQU0sQ0FBQztBQUM5QixDQUFDO0FBRUQ7OztHQUdHO0FBQ0ksU0FBUyxpQkFBaUI7SUFDL0IsTUFBTSxRQUFRLEdBQUcsZUFBZSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDbEYsSUFBSSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUNuRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUM5QyxNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3hCLEdBQUcsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUscUJBQXFCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztJQUNILENBQUM7SUFFRCxHQUFHLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLG9CQUFvQixDQUFDLENBQUM7SUFDckQsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvbWVzc2FnZV91dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lpITnkIblt6XlhbfmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25o+Q5L6b5LqG5LiA57O75YiX55So5LqO5aSE55CG5ZKM5p+l6K+i6YWS6aaG5raI5oGv5a+56LGh55qE6YCa55So6L6F5Yqp5Ye95pWw44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfREFUQV9SRUdFWCB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vbG9nJztcblxuY29uc3QgbG9nID0gbmV3IExvZ2dlcignbWVzc2FnZV91dGlscycpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8qKlxuICogKirjgJDojrflj5bmtojmga/lhoXlrrnjgJEqKiDku47phZLppobnmoTmtojmga/lr7nosaHkuK3lronlhajlnLDmj5Dlj5blvZPliY3mv4DmtLvvvIjooqvpgInkuK3vvInnmoTmtojmga/lhoXlrrnlrZfnrKbkuLLjgIJcbiAqIOi/meS4quWHveaVsOaYryBFUkEg5Lit5omA5pyJ5raI5oGv5YaF5a656K+75Y+W55qE5ZSv5LiA5YWl5Y+j77yM5Lul56Gu5L+d6YC76L6R57uf5LiA5ZKM5YGl5aOu5oCn44CCXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge3N0cmluZyB8IG51bGx9IOW9k+WJjea/gOa0u+eahOa2iOaBr+WGheWuue+8m+WmguaenOaXoOazleiOt+WPlu+8jOWImei/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNZXNzYWdlQ29udGVudChtc2c6IGFueSk6IHN0cmluZyB8IG51bGwge1xuICBpZiAoIW1zZykgcmV0dXJuIG51bGw7XG5cbiAgLy8g5LyY5YWI5qOA5p+lIC5tZXMg5bGe5oCn77yM6L+Z5piv5paw54mI6YWS6aaG55qE6KeE6IyDXG4gIGlmICh0eXBlb2YgbXNnLm1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbXNnLm1lcztcbiAgfVxuICAvLyDlpoLmnpzmsqHmnIkgLm1lc++8jOWImeWkhOeQhiBzd2lwZXNcbiAgaWYgKEFycmF5LmlzQXJyYXkobXNnLnN3aXBlcykpIHtcbiAgICBjb25zdCBzaWQgPSBOdW1iZXIobXNnLnN3aXBlX2lkID8/IDApO1xuICAgIHJldHVybiBtc2cuc3dpcGVzW3NpZF0gfHwgbnVsbDtcbiAgfVxuICAvLyDmnIDlkI7vvIzkvZzkuLrlhbzlrrnvvIzmo4Dmn6Xml6fniYjnmoQgLm1lc3NhZ2Ug5bGe5oCnXG4gIGlmICh0eXBlb2YgbXNnLm1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG1zZy5tZXNzYWdlO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIOS7jua2iOaBr+WGheWuueWtl+espuS4suS4reino+aekOWHuiBgRXJhRGF0YWAg5a+56LGh44CC6L+Z5piv5LiA5Liq5Y+q6K+75pON5L2c44CCXG4gKiBAcGFyYW0ge3N0cmluZyB8IG51bGwgfCB1bmRlZmluZWR9IG1lc3NhZ2VDb250ZW50IC0g5raI5oGv55qE5YaF5a655a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyB7RXJhRGF0YSB8IG51bGx9IOino+aekOaIkOWKn+WImei/lOWbniBgRXJhRGF0YWAg5a+56LGh77yM5ZCm5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuZnVuY3Rpb24gcGFyc2VFcmFEYXRhKG1lc3NhZ2VDb250ZW50OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogRXJhRGF0YSB8IG51bGwge1xuICBpZiAodHlwZW9mIG1lc3NhZ2VDb250ZW50ICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gbWVzc2FnZUNvbnRlbnQubWF0Y2goRVJBX0RBVEFfUkVHRVgpO1xuICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHRyeSB7XG4gICAgLy8g55Sx5LqOIE1LIOWdl+WGhemDqOaYr+iHquWumuS5ieeahCBge1wia2V5XCI9XCJ2YWx1ZVwifWAg5qC85byP77yM5LiN6IO95L2/55SoIEpTT04ucGFyc2XjgIJcbiAgICAvLyDlv4Xpobvkvb/nlKjmraPliJnooajovr7lvI/ov5vooYzlrr3mnb7ljLnphY3mnaXmj5Dlj5bplK7lgLzjgIJcbiAgICBjb25zdCBjdXN0b21Gb3JtYXRCbG9jayA9IG1hdGNoWzFdO1xuICAgIGNvbnN0IGtleU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2Uta2V5XCJcXHMqPVxccypcIiguKj8pXCIvKTtcbiAgICBjb25zdCB0eXBlTWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS10eXBlXCJcXHMqPVxccypcIiguKj8pXCIvKTtcblxuICAgIGlmIChrZXlNYXRjaD8uWzFdICYmIHR5cGVNYXRjaD8uWzFdKSB7XG4gICAgICBjb25zdCBlcmFEYXRhID0ge1xuICAgICAgICAnZXJhLW1lc3NhZ2Uta2V5Jzoga2V5TWF0Y2hbMV0sXG4gICAgICAgICdlcmEtbWVzc2FnZS10eXBlJzogdHlwZU1hdGNoWzFdIGFzICd1c2VyJyB8ICdhc3Npc3RhbnQnLFxuICAgICAgfTtcbiAgICAgIGxvZy5kZWJ1ZygncGFyc2VFcmFEYXRhJywgJ+aIkOWKn+ino+aekCBFcmFEYXRhJywgZXJhRGF0YSk7XG4gICAgICByZXR1cm4gZXJhRGF0YTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKCdwYXJzZUVyYURhdGEnLCAn5pyq6IO95ZyoIEVyYURhdGEg5Z2X5Lit5om+5Yiw5a6M5pW055qE6ZSu5YC85a+5JywgeyBjdXN0b21Gb3JtYXRCbG9jayB9KTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy53YXJuKCdwYXJzZUVyYURhdGEnLCAn6Kej5p6QIEVyYURhdGEg5Z2X5pe25Y+R55Sf5byC5bi4JywgZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiAqKuOAkOWIpOaWrea2iOaBr+exu+Wei+OAkSoqIOagueaNrua2iOaBr+WGheWuueS4reeahCBgZXJhLW1lc3NhZ2UtdHlwZWAg5YWD5pWw5o2u5oiWIGByb2xlYCDlsZ7mgKfliKTmlq3mmK/lkKbkuLrnlKjmiLfmtojmga/jgIJcbiAqIOS8mOWFiOS/oeS7u+azqOWFpeeahOWFg+aVsOaNruOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtib29sZWFufSDlpoLmnpzmmK/nlKjmiLfmtojmga/vvIzliJnov5Tlm54gdHJ1ZeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNVc2VyTWVzc2FnZShtc2c6IGFueSk6IGJvb2xlYW4ge1xuICBjb25zdCBjb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobXNnKTtcbiAgY29uc3QgZGF0YSA9IHBhcnNlRXJhRGF0YShjb250ZW50KTtcbiAgaWYgKGRhdGEpIHtcbiAgICByZXR1cm4gZGF0YVsnZXJhLW1lc3NhZ2UtdHlwZSddID09PSAndXNlcic7XG4gIH1cbiAgLy8g5Zue6YCA5Yiw5qOA5p+lIHJvbGUg5bGe5oCnXG4gIHJldHVybiBtc2c/LnJvbGUgPT09ICd1c2VyJztcbn1cblxuLyoqXG4gKiDku47lkI7lkJHliY3mn6Xmib7lubbov5Tlm57mnIDlkI7kuIDmnaEgQUkg5raI5oGv44CCXG4gKiBAcmV0dXJucyB7VGF2ZXJuTWVzc2FnZSB8IG51bGx9IOaJvuWIsOeahCBBSSDmtojmga/lr7nosaHvvIzlpoLmnpzmib7kuI3liLDliJnov5Tlm54gbnVsbOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZmluZExhc3RBaU1lc3NhZ2UoKTogYW55IHwgbnVsbCB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19JywgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KTtcbiAgaWYgKCFtZXNzYWdlcyB8fCBtZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgJ+iBiuWkqeiusOW9leS4uuepuiwg5pyq5om+5Yiw5Lu75L2V5raI5oGv44CCJyk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmb3IgKGxldCBpID0gbWVzc2FnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBtc2cgPSBtZXNzYWdlc1tpXTtcbiAgICBpZiAoIWlzVXNlck1lc3NhZ2UobXNnKSkge1xuICAgICAgbG9nLmRlYnVnKCdmaW5kTGFzdEFpTWVzc2FnZScsIGDmib7liLDmnIDlkI7kuIDmnaEgQUkg5raI5oGvLCBJRDogJHttc2cubWVzc2FnZV9pZH1gKTtcbiAgICAgIHJldHVybiBtc2c7XG4gICAgfVxuICB9XG5cbiAgbG9nLmRlYnVnKCdmaW5kTGFzdEFpTWVzc2FnZScsICfmnKrlnKjogYrlpKnorrDlvZXkuK3mib7liLDku7vkvZUgQUkg5raI5oGv44CCJyk7XG4gIHJldHVybiBudWxsO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/message_utils.ts\n\n}");
  },
  "./src/ERA变量框架/utils/string.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/utils/string.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractBlocks: () => (/* binding */ extractBlocks),\n/* harmony export */   rnd: () => (/* binding */ rnd),\n/* harmony export */   stripCodeFence: () => (/* binding */ stripCodeFence)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 字符串处理模块\n */\n\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * 基于 `Math.random()`，在同一毫秒内也能保证极高的唯一性。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nfunction rnd() {\n    return Math.random().toString(36).slice(2, 8);\n}\n/**\n * 从文本中提取所有被特定 XML 风格标签包裹的内容块。\n * 使用非贪婪模式的正则表达式，但不处理嵌套标签。\n * @param {string} text - 包含标签的原始文本。\n * @param {string} tag - 要提取的标签名称（例如 'VariableEdit'）。\n * @returns {string[]} 包含所有提取并清理后（去除代码围栏和首尾空格）的内容块的数组。\n */\nfunction extractBlocks(text, tag) {\n    const blocks = [];\n    // 正则表达式: /<tag>([\\s\\S]*?)<\\/tag>/g\n    // - <${tag}>: 匹配开标签。\n    // - ([\\s\\S]*?): 非贪婪地捕获开闭标签之间的所有字符（包括换行符）。\n    // - <\\/${tag}>: 匹配闭标签。\n    // - g: 全局匹配，以找到所有匹配项。\n    const re = new RegExp(`<${tag}>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'g');\n    let m;\n    while ((m = re.exec(text))) {\n        const rawBody = (m[1] || '').trim();\n        // 在存入前，先剥离AI可能生成的多余代码围栏。\n        const body = stripCodeFence(rawBody);\n        if (body)\n            blocks.push(body);\n    }\n    return blocks;\n}\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nfunction stripCodeFence(s) {\n    if (!s)\n        return s;\n    let t = String(s).trim();\n    // 移除起始围栏，例如 ```json, ```, ~~~\n    t = t.replace(/^\\s*(?:```|~~~)\\[a-zA-Z0-9_-\\]*\\s*\\r?\\n/, '');\n    // 移除结束围栏\n    t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n    return t.trim();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3N0cmluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7R0FFRztBQUVVO0FBRWI7Ozs7R0FJRztBQUNJLFNBQVMsR0FBRztJQUNqQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0ksU0FBUyxhQUFhLENBQUMsSUFBWSxFQUFFLEdBQVc7SUFDckQsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBQzVCLG1DQUFtQztJQUNuQyxxQkFBcUI7SUFDckIsMENBQTBDO0lBQzFDLHVCQUF1QjtJQUN2QixzQkFBc0I7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxHQUFHLG9CQUFvQixHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5RCxJQUFJLENBQUMsQ0FBQztJQUNOLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDM0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDcEMseUJBQXlCO1FBQ3pCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLElBQUk7WUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNJLFNBQVMsY0FBYyxDQUFDLENBQVM7SUFDdEMsSUFBSSxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsOEJBQThCO0lBQzlCLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLHlDQUF5QyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELFNBQVM7SUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvc3RyaW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5a2X56ym5Liy5aSE55CG5qih5Z2XXHJcbiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuLyoqXHJcbiAqIOeUn+aIkOS4gOS4quaMh+WumumVv+W6pueahOmaj+acuuWtl+espuS4su+8jOeUqOS9nOWUr+S4gOagh+ivhuespuOAglxyXG4gKiDln7rkuo4gYE1hdGgucmFuZG9tKClg77yM5Zyo5ZCM5LiA5q+r56eS5YaF5Lmf6IO95L+d6K+B5p6B6auY55qE5ZSv5LiA5oCn44CCXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS4gOS4qumaj+acuueahOOAgeeUseaVsOWtl+WSjOWwj+WGmeWtl+avjee7hOaIkOeahOWtl+espuS4suOAglxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJuZCgpOiBzdHJpbmcge1xyXG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOS7juaWh+acrOS4reaPkOWPluaJgOacieiiq+eJueWumiBYTUwg6aOO5qC85qCH562+5YyF6KO555qE5YaF5a655Z2X44CCXHJcbiAqIOS9v+eUqOmdnui0quWpquaooeW8j+eahOato+WImeihqOi+vuW8j++8jOS9huS4jeWkhOeQhuW1jOWll+agh+etvuOAglxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIOWMheWQq+agh+etvueahOWOn+Wni+aWh+acrOOAglxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFnIC0g6KaB5o+Q5Y+W55qE5qCH562+5ZCN56ew77yI5L6L5aaCICdWYXJpYWJsZUVkaXQn77yJ44CCXHJcbiAqIEByZXR1cm5zIHtzdHJpbmdbXX0g5YyF5ZCr5omA5pyJ5o+Q5Y+W5bm25riF55CG5ZCO77yI5Y676Zmk5Luj56CB5Zu05qCP5ZKM6aaW5bC+56m65qC877yJ55qE5YaF5a655Z2X55qE5pWw57uE44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdEJsb2Nrcyh0ZXh0OiBzdHJpbmcsIHRhZzogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gIGNvbnN0IGJsb2Nrczogc3RyaW5nW10gPSBbXTtcclxuICAvLyDmraPliJnooajovr7lvI86IC88dGFnPihbXFxzXFxTXSo/KTxcXC90YWc+L2dcclxuICAvLyAtIDwke3RhZ30+OiDljLnphY3lvIDmoIfnrb7jgIJcclxuICAvLyAtIChbXFxzXFxTXSo/KTog6Z2e6LSq5amq5Zyw5o2V6I635byA6Zet5qCH562+5LmL6Ze055qE5omA5pyJ5a2X56ym77yI5YyF5ous5o2i6KGM56ym77yJ44CCXHJcbiAgLy8gLSA8XFwvJHt0YWd9Pjog5Yy56YWN6Zet5qCH562+44CCXHJcbiAgLy8gLSBnOiDlhajlsYDljLnphY3vvIzku6Xmib7liLDmiYDmnInljLnphY3pobnjgIJcclxuICBjb25zdCByZSA9IG5ldyBSZWdFeHAoYDwke3RhZ30+KFtcXFxcc1xcXFxTXSo/KTxcXFxcLyR7dGFnfT5gLCAnZycpO1xyXG4gIGxldCBtO1xyXG4gIHdoaWxlICgobSA9IHJlLmV4ZWModGV4dCkpKSB7XHJcbiAgICBjb25zdCByYXdCb2R5ID0gKG1bMV0gfHwgJycpLnRyaW0oKTtcclxuICAgIC8vIOWcqOWtmOWFpeWJje+8jOWFiOWJpeemu0FJ5Y+v6IO955Sf5oiQ55qE5aSa5L2Z5Luj56CB5Zu05qCP44CCXHJcbiAgICBjb25zdCBib2R5ID0gc3RyaXBDb2RlRmVuY2UocmF3Qm9keSk7XHJcbiAgICBpZiAoYm9keSkgYmxvY2tzLnB1c2goYm9keSk7XHJcbiAgfVxyXG4gIHJldHVybiBibG9ja3M7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDku47lrZfnrKbkuLLkuK3np7vpmaQgQUkg55Sf5oiQ55qEIE1hcmtkb3duIOS7o+eggeWdl+WbtOagj++8iOWmgiBgYGBqc29uIC4uLiBgYGDvvInjgIJcclxuICogQHBhcmFtIHtzdHJpbmd9IHMgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcclxuICogQHJldHVybnMge3N0cmluZ30g56e76Zmk5Zu05qCP5bm25L+u5Ymq6aaW5bC+56m65qC85ZCO55qE5a2X56ym5Liy44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBDb2RlRmVuY2Uoczogc3RyaW5nKTogc3RyaW5nIHtcclxuICBpZiAoIXMpIHJldHVybiBzO1xyXG4gIGxldCB0ID0gU3RyaW5nKHMpLnRyaW0oKTtcclxuICAvLyDnp7vpmaTotbflp4vlm7TmoI/vvIzkvovlpoIgYGBganNvbiwgYGBgLCB+fn5cclxuICB0ID0gdC5yZXBsYWNlKC9eXFxzKig/OmBgYHx+fn4pXFxbYS16QS1aMC05Xy1cXF0qXFxzKlxccj9cXG4vLCAnJyk7XHJcbiAgLy8g56e76Zmk57uT5p2f5Zu05qCPXHJcbiAgdCA9IHQucmVwbGFjZSgvXFxyP1xcbig/OmBgYHx+fn4pXFxzKiQvLCAnJyk7XHJcbiAgcmV0dXJuIHQudHJpbSgpO1xyXG59XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/string.ts\n\n}");
  },
  lodash: 
  /*!********************!*\
  !*** external "_" ***!
  \********************/ module => {
    module.exports = _;
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/ERA变量框架/index.ts");