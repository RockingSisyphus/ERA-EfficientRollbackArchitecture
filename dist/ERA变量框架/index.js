var __webpack_modules__ = {
  "./src/ERA变量框架/core/crud/delete.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/delete.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processDeleteBlocks: () => (/* binding */ processDeleteBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger();\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData, basePath, patchObj, editLog) {\n    // --- 1. 入口守卫和状态获取 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n    // 精确判断豁免条件\n    const metaPatch = _.get(patchObj, '$meta');\n    const isBypassingProtection = \n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n        // 场景2: 指令明确要删除 $meta.necessary 键\n        _.has(patchObj, ['$meta', 'necessary']);\n    // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n    if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n        // **意图：递归删除子节点**\n        // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n        if (necessary === 'all' && !isBypassingProtection) {\n            logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`);\n            return;\n        }\n        // 权限通过，或存在豁免，继续向内递归。\n        for (const key of Object.keys(patchObj)) {\n            const fullPath = basePath ? `${basePath}.${key}` : key;\n            const subPatchObj = patchObj[key];\n            applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n        }\n        return; // 子节点处理完毕，返回。\n    }\n    // --- 3. 执行删除当前节点 ---\n    // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n    // **意图：删除当前节点 `basePath`**\n    // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n    // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n    if (necessary === 'self' || necessary === 'all') {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`);\n        return;\n    }\n    // 根节点（basePath 为 ''）不应被删除。\n    if (basePath === '') {\n        logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。');\n        return;\n    }\n    // 执行原子性删除\n    const valOld = _.cloneDeep(currentNodeInVars);\n    _.unset(statData, basePath);\n    editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n    logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n/**\n * 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processDeleteBlocks(allDeletes, editLog) {\n    if (allDeletes.length > 0) {\n        for (const deleteRoot of allDeletes) {\n            if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.updateEraStatData)(stat => {\n                    logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n                    // 从根路径开始递归\n                    applyDeleteAtLevel(stat, '', deleteRoot, editLog);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processDeleteBlocks', '所有 VariableDelete 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7R0FVRztBQUNVO0FBRTRDO0FBQ2hCO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCOzs7Ozs7OztHQVFHO0FBQ0gsU0FBUyxrQkFBa0IsQ0FBQyxRQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFhLEVBQUUsT0FBYztJQUN4Rix1QkFBdUI7SUFDdkIsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFFMUUsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLDhCQUE4QixRQUFRLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQztRQUN4RixPQUFPO0lBQ1QsQ0FBQztJQUVELE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUVuRSxXQUFXO0lBQ1gsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0MsTUFBTSxxQkFBcUI7SUFDekIsd0JBQXdCO0lBQ3hCLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELGlDQUFpQztRQUNqQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBRTFDLG9DQUFvQztJQUNwQyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7UUFDdEQsaUJBQWlCO1FBRWpCLHdDQUF3QztRQUN4QyxJQUFJLFNBQVMsS0FBSyxLQUFLLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ2xELE1BQU0sQ0FBQyxJQUFJLENBQ1Qsb0JBQW9CLEVBQ3BCLHlCQUF5QixRQUFRLG9DQUFvQyxDQUN0RSxDQUFDO1lBQ0YsT0FBTztRQUNULENBQUM7UUFFRCxxQkFBcUI7UUFDckIsS0FBSyxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDeEMsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLFFBQVEsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ3ZELE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBQ0QsT0FBTyxDQUFDLGNBQWM7SUFDeEIsQ0FBQztJQUVELHNCQUFzQjtJQUN0QixxQ0FBcUM7SUFDckMsMkJBQTJCO0lBRTNCLHFDQUFxQztJQUNyQyw0Q0FBNEM7SUFDNUMsSUFBSSxTQUFTLEtBQUssTUFBTSxJQUFJLFNBQVMsS0FBSyxLQUFLLEVBQUUsQ0FBQztRQUNoRCxNQUFNLENBQUMsSUFBSSxDQUNULG9CQUFvQixFQUNwQix5QkFBeUIsUUFBUSxtQkFBbUIsU0FBUyxlQUFlLENBQzdFLENBQUM7UUFDRixPQUFPO0lBQ1QsQ0FBQztJQUVELDJCQUEyQjtJQUMzQixJQUFJLFFBQVEsS0FBSyxFQUFFLEVBQUUsQ0FBQztRQUNwQixNQUFNLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLDZCQUE2QixDQUFDLENBQUM7UUFDbEUsT0FBTztJQUNULENBQUM7SUFFRCxVQUFVO0lBQ1YsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQzlDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzVCLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxXQUFXLFFBQVEsRUFBRSxDQUFDLENBQUM7QUFDNUQsQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0ksS0FBSyxVQUFVLG1CQUFtQixDQUFDLFVBQWlCLEVBQUUsT0FBYztJQUN6RSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDMUIsS0FBSyxNQUFNLFVBQVUsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNwQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztnQkFBRSxTQUFTO1lBQ3BFLElBQUksQ0FBQztnQkFDSCxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO29CQUM3QixNQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFxQixFQUFFLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDcEYsV0FBVztvQkFDWCxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDbEQsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Y+Y6YeP5Yig6Zmk5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+i0n+i0o+WkhOeQhiBgPFZhcmlhYmxlRGVsZXRlPmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5Yig6Zmk77yM5bm255Sf5oiQ55u45bqU55qEIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq5oyH5Luk6amx5YqoKio6IOmAkuW9kuihjOS4uueUseaMh+S7pOWvueixoeeahOe7k+aehOmpseWKqOOAguepuuWvueixoSBge31gIOihqOekuuWIoOmZpOW9k+WJjeiKgueCue+8jOmdnuepuuWvueixoeihqOekuumAkuW9kuWIoOmZpOWtkOiKgueCueOAglxuICogLSAqKuWuieWFqOesrOS4gCoqOiDliKDpmaTmmK/noLTlnY/mgKfmk43kvZzvvIzlm6DmraTlvJXlhaXkuoYgYCRtZXRhLm5lY2Vzc2FyeWAg5p2D6ZmQ5py65Yi25p2l6Ziy5q2i6K+v5Yig44CCXG4gKiAtICoq57K+56Gu6LGB5YWNKio6IGBuZWNlc3NhcnlgIOeahOS/neaKpOWPquacieWcqOWIoOmZpOaMh+S7pOaYjuehruaMh+WQkSBgbmVjZXNzYXJ5YCDlsZ7mgKfoh6rouqvml7bmiY3kvJrooqvnu5Xov4fjgIJcbiAqIC0gKirljp/lrZDmgKfml6Xlv5cqKjog5Li65q+P5LiA5qyh5Yig6Zmk55Sf5oiQ5Y2V5LiA44CB57K+56Gu55qEIGBFZGl0TG9nYO+8jOehruS/neaTjeS9nOWPr+WujOWFqOWbnua7muOAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5Yig6Zmk44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlRGVsZXRlPmAg55qE5qC45b+D6YC76L6R77yM5YW26KGM5Li655Sx5oyH5LukIGBwYXRjaE9iamAg55qE57uT5p6E6amx5Yqo44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeS4jiBgYmFzZVBhdGhgIOWvueW6lOeahOmDqOWIhuOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5mdW5jdGlvbiBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdERhdGE6IGFueSwgYmFzZVBhdGg6IHN0cmluZywgcGF0Y2hPYmo6IGFueSwgZWRpdExvZzogYW55W10pIHtcbiAgLy8gLS0tIDEuIOWFpeWPo+WuiOWNq+WSjOeKtuaAgeiOt+WPliAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcblxuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseURlbGV0ZUF0TGV2ZWwnLCBgVmFyaWFibGVEZWxldGUg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbmVjZXNzYXJ5ID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAnbmVjZXNzYXJ5J10pO1xuXG4gIC8vIOeyvuehruWIpOaWreixgeWFjeadoeS7tlxuICBjb25zdCBtZXRhUGF0Y2ggPSBfLmdldChwYXRjaE9iaiwgJyRtZXRhJyk7XG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgLy8g5Zy65pmvMTog5oyH5Luk6KaB5Yig6Zmk5pW05LiqICRtZXRhIOWvueixoVxuICAgIChfLmlzUGxhaW5PYmplY3QobWV0YVBhdGNoKSAmJiBfLmlzRW1wdHkobWV0YVBhdGNoKSkgfHxcbiAgICAvLyDlnLrmma8yOiDmjIfku6TmmI7noa7opoHliKDpmaQgJG1ldGEubmVjZXNzYXJ5IOmUrlxuICAgIF8uaGFzKHBhdGNoT2JqLCBbJyRtZXRhJywgJ25lY2Vzc2FyeSddKTtcblxuICAvLyAtLS0gMi4g5Yik5pat5oSP5Zu+77ya6YCS5b2S5Yig6Zmk5a2Q6IqC54K5IHZzIOWIoOmZpOW9k+WJjeiKgueCuSAtLS1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikgJiYgIV8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICAvLyAqKuaEj+Wbvu+8mumAkuW9kuWIoOmZpOWtkOiKgueCuSoqXG5cbiAgICAvLyDmnYPpmZDmo4Dmn6XvvJrlpoLmnpzoioLngrnlj5cgJ2FsbCcg5L+d5oqk77yM5LiU5oyH5Luk5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ56aB5q2i5rex5YWl44CCXG4gICAgaWYgKG5lY2Vzc2FyeSA9PT0gJ2FsbCcgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICdhcHBseURlbGV0ZUF0TGV2ZWwnLFxuICAgICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiBhbGxcIiDkv53miqTvvIzlhbblrZDoioLngrnml6Dms5XooqvliKDpmaTjgIJgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDmnYPpmZDpgJrov4fvvIzmiJblrZjlnKjosYHlhY3vvIznu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoT2JqID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIGFwcGx5RGVsZXRlQXRMZXZlbChzdGF0RGF0YSwgZnVsbFBhdGgsIHN1YlBhdGNoT2JqLCBlZGl0TG9nKTtcbiAgICB9XG4gICAgcmV0dXJuOyAvLyDlrZDoioLngrnlpITnkIblrozmr5XvvIzov5Tlm57jgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDmiafooYzliKDpmaTlvZPliY3oioLngrkgLS0tXG4gIC8vICjog73otbDliLDov5nph4zvvIzor7TmmI4gcGF0Y2hPYmog5piv56m65a+56LGh44CB6Z2e5a+56LGh5oiWIG51bGwpXG4gIC8vICoq5oSP5Zu+77ya5Yig6Zmk5b2T5YmN6IqC54K5IGBiYXNlUGF0aGAqKlxuXG4gIC8vIOadg+mZkOajgOafpe+8midzZWxmJyDmiJYgJ2FsbCcg6YO95Lya6Zi75q2i5b2T5YmN6IqC54K555qE55u05o6l5Yig6Zmk44CCXG4gIC8vIOebtOaOpeWIoOmZpOiKgueCueeahOaEj+WbvuaXoOazleixgeWFjeS/neaKpO+8jOW/hemhu+mAmui/h+mAkuW9kuaEj+WbvuWIoOmZpCAnJG1ldGEnIOadpeino+mZpOS/neaKpOOAglxuICBpZiAobmVjZXNzYXJ5ID09PSAnc2VsZicgfHwgbmVjZXNzYXJ5ID09PSAnYWxsJykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RGVsZXRlQXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiAke25lY2Vzc2FyeX1cIiDkv53miqTvvIzml6Dms5Xooqvnm7TmjqXliKDpmaTjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g5qC56IqC54K577yIYmFzZVBhdGgg5Li6ICcn77yJ5LiN5bqU6KKr5Yig6Zmk44CCXG4gIGlmIChiYXNlUGF0aCA9PT0gJycpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsICdWYXJpYWJsZURlbGV0ZSDlpLHotKXvvJrkuI3lhYHorrjliKDpmaTmoLnlr7nosaHjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmiafooYzljp/lrZDmgKfliKDpmaRcbiAgY29uc3QgdmFsT2xkID0gXy5jbG9uZURlZXAoY3VycmVudE5vZGVJblZhcnMpO1xuICBfLnVuc2V0KHN0YXREYXRhLCBiYXNlUGF0aCk7XG4gIGVkaXRMb2cucHVzaCh7IG9wOiAnZGVsZXRlJywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX29sZDogdmFsT2xkIH0pO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsIGDmiJDlip/liKDpmaToioLngrk6ICR7YmFzZVBhdGh9YCk7XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVEZWxldGU+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxEZWxldGVzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGRlbGV0ZSDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlczogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxEZWxldGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IGRlbGV0ZVJvb3Qgb2YgYWxsRGVsZXRlcykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZGVsZXRlUm9vdCkgfHwgXy5pc0VtcHR5KGRlbGV0ZVJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsIGDlpITnkIYgZGVsZXRlUm9vdDogJHtKU09OLnN0cmluZ2lmeShkZWxldGVSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoTlvIDlp4vpgJLlvZJcbiAgICAgICAgICBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdCwgJycsIGRlbGV0ZVJvb3QsIGVkaXRMb2cpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NEZWxldGVCbG9ja3MnLCBg5aSE55CGIGRlbGV0ZVJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVEZWxldGUg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/delete.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/insert.ts": 
  /*!************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/insert.ts ***!
  \************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyInsertAtLevel: () => (/* binding */ applyInsertAtLevel),\n/* harmony export */   processInsertBlocks: () => (/* binding */ processInsertBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./template */ \"./src/ERA变量框架/core/crud/insert/template.ts\");\n/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger();\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nfunction applyInsertAtLevel(statData, basePath, patchObj, editLog, inheritedContent, parentData) {\n    // --- 1. 确定当前层级的模板内容 ---\n    // 调用 resolveTemplate，它现在直接使用传入的 parentData\n    const localTplContent = (0,_template__WEBPACK_IMPORTED_MODULE_3__.resolveTemplate)(inheritedContent, parentData);\n    logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n        statData: _.cloneDeep(statData),\n    });\n    // --- 2. 检查路径存在性，决定执行策略 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    logger.debug('applyInsertAtLevel', `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`, currentNodeInVars);\n    // **策略一：原子性插入 (Atomic Insert)**\n    // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n    if (basePath && currentNodeInVars === undefined) {\n        // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n        const composed = (0,_template__WEBPACK_IMPORTED_MODULE_3__.applyTemplateToPatch)(localTplContent, patchObj);\n        const finalValue = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.sanitizeArrays)(composed); // 清理数组中的 null 等无效值。\n        logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n        _.set(statData, basePath, finalValue); // 执行插入。\n        editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n        logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n        return; // 插入完成，终止递归。\n    }\n    // **策略二：递归补充 (Recursive Supplement)**\n    // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n    if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n        logger.debug('applyInsertAtLevel', `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`);\n        for (const key of Object.keys(patchObj)) {\n            const subPath = basePath ? `${basePath}.${key}` : key;\n            const subPatch = patchObj[key];\n            // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n            const subInheritedContent = (0,_template__WEBPACK_IMPORTED_MODULE_3__.getInheritedTemplateContent)(localTplContent, key);\n            logger.debug('applyInsertAtLevel', `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`);\n            // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n            applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n        }\n    }\n    else if (basePath) {\n        // **插入失败**\n        // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n        // 则记录警告。insert 不会覆盖已存在的值。\n        logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`);\n    }\n    // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n/**\n * 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processInsertBlocks(allInserts, editLog) {\n    if (allInserts.length > 0) {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n            logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(stat));\n            return stat;\n        });\n        /*\n         * N.B. 必须对每个 insertRoot 单独调用 updateVariablesWith，而不是将所有操作合并到一次调用中。\n         * 这是为了确保在同一条消息内，前一个 <VariableInsert> 块中插入的模板或数据，\n         * 可以被后一个 <VariableInsert> 或 <VariableEdit> 块访问和使用。\n         * 每次 await updateVariablesWith 完成后，变量状态都会被刷新，从而使后续操作能看到最新的结果。\n         */\n        for (const insertRoot of allInserts) {\n            if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(stat => {\n                    logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n                    applyInsertAtLevel(stat, '', insertRoot, editLog, null, null);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processInsertBlocks', '所有 VariableInsert 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ1U7QUFFd0M7QUFDTztBQUNoQjtBQUNvRDtBQUVoRyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLEVBQUUsQ0FBQztBQUU1Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSSxTQUFTLGtCQUFrQixDQUNoQyxRQUFhLEVBQ2IsUUFBZ0IsRUFDaEIsUUFBYSxFQUNiLE9BQWMsRUFDZCxnQkFBcUIsRUFDckIsVUFBZTtJQUVmLHlCQUF5QjtJQUN6QiwyQ0FBMkM7SUFDM0MsTUFBTSxlQUFlLEdBQUcsMERBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUN0RSxNQUFNLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLG1CQUFtQixRQUFRLElBQUksTUFBTSxHQUFHLEVBQUU7UUFDM0UsUUFBUSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0tBQ2hDLENBQUMsQ0FBQztJQUVILDRCQUE0QjtJQUM1QixNQUFNLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztJQUMxRSxNQUFNLENBQUMsS0FBSyxDQUNWLG9CQUFvQixFQUNwQixvQkFBb0IsUUFBUSxJQUFJLE1BQU0sMEJBQTBCLEVBQ2hFLGlCQUFpQixDQUNsQixDQUFDO0lBRUYsZ0NBQWdDO0lBQ2hDLG1DQUFtQztJQUNuQyxJQUFJLFFBQVEsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNoRCw2Q0FBNkM7UUFDN0MsTUFBTSxRQUFRLEdBQUcsK0RBQW9CLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRWpFLE1BQU0sVUFBVSxHQUFHLDJEQUFjLENBQUMsUUFB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QUU7b0JBQzdCLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsa0JBQWtCLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNwRixtQ0FBbUM7b0JBQ25DLGtCQUFrQixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7b0JBQzlELE9BQU8sSUFBSSxDQUFDO2dCQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUscUJBQXFCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakYsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLHdCQUF3QixDQUFDLENBQUM7SUFDOUQsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvaW5zZXJ0L2luc2VydC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/mj5LlhaXmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVJbnNlcnQ+YCDmjIfku6TvvIzlrp7njrDlj5jph4/nmoTpnZ7noLTlnY/mgKfmj5LlhaXvvIzlubbnlJ/miJDnm7jlupTnmoQgYEVkaXRMb2dg44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIC0gKirogYzotKPljZXkuIAqKjog5qih5Z2X5Y+q5YWz5b+D5aaC5L2V5qC55o2u5oyH5Luk5L+u5pS55Y+Y6YeP54q25oCB5bm255Sf5oiQ5pel5b+X77yM5LiN5YWz5b+D5oyH5Luk5LuO5L2V6ICM5p2l44CCXG4gKiAtICoq5Y6f5a2Q5oCn5pON5L2cKio6IGBhcHBseUluc2VydEF0TGV2ZWxgIOWunueOsOS6huWOn+WtkOaAp+eahOaPkuWFpe+8jOehruS/neS6huaVsOaNrue7k+aehOeahOWujOaVtOaAp+OAglxuICogICDlpoLmnpzkuIDkuKrln7rnoYDot6/lvoTkuI3lrZjlnKjvvIzlroPkvJrlsIbmlbTkuKrlr7nosaHkvZzkuLrkuIDmlbTkuKrljZXlhYPkuIDmrKHmgKfmj5LlhaXjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V5ZCR5bey5a2Y5Zyo55qE6Lev5b6E5o+S5YWl77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHNhbml0aXplQXJyYXlzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBhcHBseVRlbXBsYXRlVG9QYXRjaCwgZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50LCByZXNvbHZlVGVtcGxhdGUgfSBmcm9tICcuL3RlbXBsYXRlJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5o+S5YWl44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlSW5zZXJ0PmAg55qE5qC45b+D6YC76L6R77yaKirpnZ7noLTlnY/mgKflnLAqKumAkuW9kuaPkuWFpeWAvOOAglxuICpcbiAqICoq5qC45b+D6KeE5YiZKio6XG4gKiAxLiAqKuWPquWcqOi3r+W+hOS4jeWtmOWcqOaXtuWGmeWFpSoq44CC5aaC5p6c6Lev5b6E5bey5a2Y5Zyo77yM5YiZ6Lez6L+H6K+l6Lev5b6E55qE5YaZ5YWl44CCXG4gKiAyLiAqKuWOn+WtkOaAp+aPkuWFpSoq44CC5aaC5p6c5LiA5Liq5Z+656GA6Lev5b6E77yI5aaCIGBwbGF5ZXIuaW52ZW50b3J5YO+8ieS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4qiBgaW52ZW50b3J5YFxuICogICAg5a+56LGh5L2c5Li65LiA5pW05Liq5Y2V5YWD5LiA5qyh5oCn5o+S5YWl77yM5bm25Y+q6K6w5b2V5LiA5p2hIGBpbnNlcnRgIOaXpeW/l+OAglxuICogMy4gKirpgJLlvZLooaXlhYUqKuOAguWmguaenOWfuuehgOi3r+W+hOW3suWtmOWcqO+8jOWug+S8mumAkuW9kuWcsOa3seWFpe+8jOWwneivleWcqOWFtuS4i+ihpeWFheaPkuWFpeaWsOeahOWtkOi3r+W+hOOAglxuICogNC4gKirmqKHmnb/mlK/mjIEqKuOAguaUr+aMgeS7jiBgJHRlbXBsYXRlYCDkuK3nu6fmib/mqKHmnb/vvIzlrp7njrDmlbDmja7nu5PmnoTnmoTlpI3nlKjjgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g5LuO5oyH5Luk5Lit6Kej5p6Q5Ye655qE44CB6KaB5bqU55So5LqO5b2T5YmN5bGC57qn55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE77yI5byV55So5Lyg6YCS77yJ44CCXG4gKiBAcGFyYW0ge2FueX0gaW5oZXJpdGVkQ29udGVudCAtIOS7juS4iuWxgue7p+aJv+eahOOAgee6r+eyueeahOaooeadv+KAnOWGheWuueKAneWvueixoeOAglxuICogQHBhcmFtIHthbnl9IHBhcmVudERhdGEgLSDlvZPliY3oioLngrnnmoTniLboioLngrnlnKggYHN0YXREYXRhYCDkuK3nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5SW5zZXJ0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIGluaGVyaXRlZENvbnRlbnQ6IGFueSxcbiAgcGFyZW50RGF0YTogYW55LCAvLyDmlrDlop7lj4LmlbDvvIznm7TmjqXkvKDpgJLniLboioLngrnmlbDmja5cbikge1xuICAvLyAtLS0gMS4g56Gu5a6a5b2T5YmN5bGC57qn55qE5qih5p2/5YaF5a65IC0tLVxuICAvLyDosIPnlKggcmVzb2x2ZVRlbXBsYXRl77yM5a6D546w5Zyo55u05o6l5L2/55So5Lyg5YWl55qEIHBhcmVudERhdGFcbiAgY29uc3QgbG9jYWxUcGxDb250ZW50ID0gcmVzb2x2ZVRlbXBsYXRlKGluaGVyaXRlZENvbnRlbnQsIHBhcmVudERhdGEpO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGBb5YWl5Y+jXSBiYXNlUGF0aDogXCIke2Jhc2VQYXRoIHx8ICdyb290J31cImAsIHtcbiAgICBzdGF0RGF0YTogXy5jbG9uZURlZXAoc3RhdERhdGEpLFxuICB9KTtcblxuICAvLyAtLS0gMi4g5qOA5p+l6Lev5b6E5a2Y5Zyo5oCn77yM5Yaz5a6a5omn6KGM562W55WlIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgYFvot6/lvoTmo4Dmn6VdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCIuIGN1cnJlbnROb2RlSW5WYXJzIOeahOWAvDpgLFxuICAgIGN1cnJlbnROb2RlSW5WYXJzLFxuICApO1xuXG4gIC8vICoq562W55Wl5LiA77ya5Y6f5a2Q5oCn5o+S5YWlIChBdG9taWMgSW5zZXJ0KSoqXG4gIC8vIOWmguaenOW9k+WJjei3r+W+hOWcqOWPmOmHj+S4reS4jeWtmOWcqO+8jOWImeWwhuaVtOS4quihpeS4geWvueixoeS9nOS4uuaWsOWAvOS4gOasoeaAp+aPkuWFpeOAglxuICBpZiAoYmFzZVBhdGggJiYgY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIOiwg+eUqCBhcHBseVRlbXBsYXRlVG9QYXRjaCDlh73mlbDvvIzlsIblkIjlubblkI7nmoTmqKHmnb/lhoXlrrnlupTnlKjliLDooaXkuIHkuIpcbiAgICBjb25zdCBjb21wb3NlZCA9IGFwcGx5VGVtcGxhdGVUb1BhdGNoKGxvY2FsVHBsQ29udGVudCwgcGF0Y2hPYmopO1xuXG4gICAgY29uc3QgZmluYWxWYWx1ZSA9IHNhbml0aXplQXJyYXlzKGNvbXBvc2VkKTsgLy8g5riF55CG5pWw57uE5Lit55qEIG51bGwg562J5peg5pWI5YC844CCXG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseUluc2VydEF0TGV2ZWwnLCBg5pyA57uI5o+S5YWl5pWw5o2uIGF0ICR7YmFzZVBhdGh9OlxcbiR7SlNPTi5zdHJpbmdpZnkoZmluYWxWYWx1ZSwgbnVsbCwgMil9YCk7XG4gICAgXy5zZXQoc3RhdERhdGEsIGJhc2VQYXRoLCBmaW5hbFZhbHVlKTsgLy8g5omn6KGM5o+S5YWl44CCXG4gICAgZWRpdExvZy5wdXNoKHsgb3A6ICdpbnNlcnQnLCBwYXRoOiBiYXNlUGF0aCwgdmFsdWVfbmV3OiBfLmNsb25lRGVlcChmaW5hbFZhbHVlKSB9KTtcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGDljp/lrZDmgKfmj5LlhaXliLDmlrDot6/lvoQ6ICR7YmFzZVBhdGh9YCk7XG4gICAgcmV0dXJuOyAvLyDmj5LlhaXlrozmiJDvvIznu4jmraLpgJLlvZLjgIJcbiAgfVxuXG4gIC8vICoq562W55Wl5LqM77ya6YCS5b2S6KGl5YWFIChSZWN1cnNpdmUgU3VwcGxlbWVudCkqKlxuICAvLyDlpoLmnpzlvZPliY3ot6/lvoTlt7LlrZjlnKjvvIzlubbkuJTooaXkuIHlkozlvZPliY3lgLzpg73mmK/lr7nosaHvvIzliJnmt7HlhaXpgJLlvZLjgIJcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50Tm9kZUluVmFycykgJiYgXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdhcHBseUluc2VydEF0TGV2ZWwnLFxuICAgICAgYFvpgJLlvZLooaXlhYVdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCJcbiAgICAgIC0g5b2T5YmN5bGC57qn5qih5p2/IChsb2NhbFRwbENvbnRlbnQpOiAke0pTT04uc3RyaW5naWZ5KGxvY2FsVHBsQ29udGVudCl9YCxcbiAgICApO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHBhdGNoT2JqKSkge1xuICAgICAgY29uc3Qgc3ViUGF0aCA9IGJhc2VQYXRoID8gYCR7YmFzZVBhdGh9LiR7a2V5fWAgOiBrZXk7XG4gICAgICBjb25zdCBzdWJQYXRjaCA9IHBhdGNoT2JqW2tleV07XG4gICAgICAvLyDosIPnlKggZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW5077yM5LuO5b2T5YmN5qih5p2/5YaF5a655Lit5Li65a2Q6IqC54K55p+l5om+5YW25bqU57un5om/55qE5YaF5a65XG4gICAgICBjb25zdCBzdWJJbmhlcml0ZWRDb250ZW50ID0gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KGxvY2FsVHBsQ29udGVudCwga2V5KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgICAgIGAgIC0g5YeG5aSH6YCS5b2S5a2Q6IqC54K5OiBcIiR7a2V5fVwiXG4gICAgICAtIOWwhuS8oOmAkue7meWtkOiKgueCueeahOaooeadvyAoc3ViSW5oZXJpdGVkQ29udGVudCk6ICR7SlNPTi5zdHJpbmdpZnkoc3ViSW5oZXJpdGVkQ29udGVudCl9YCxcbiAgICAgICk7XG4gICAgICAvLyDlsIblvZPliY3oioLngrnmlbDmja4gY3VycmVudE5vZGVJblZhcnMg5L2c5Li65LiL5LiA5bGC55qEIHBhcmVudERhdGEg5Lyg6YCS5LiL5Y67XG4gICAgICBhcHBseUluc2VydEF0TGV2ZWwoc3RhdERhdGEsIHN1YlBhdGgsIHN1YlBhdGNoLCBlZGl0TG9nLCBzdWJJbmhlcml0ZWRDb250ZW50LCBjdXJyZW50Tm9kZUluVmFycyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGJhc2VQYXRoKSB7XG4gICAgLy8gKirmj5LlhaXlpLHotKUqKlxuICAgIC8vIOWmguaenOi3r+W+hOW3suWtmOWcqO+8jOS9huS4jeaYr+WPr+mAkuW9kuihpeWFheeahOWvueixoee7k+aehO+8iOS+i+Wmgu+8jOS4gOS4quaYr+Wvueixoe+8jOWPpuS4gOS4quaYr+Wtl+espuS4su+8ie+8jFxuICAgIC8vIOWImeiusOW9leitpuWRiuOAgmluc2VydCDkuI3kvJropobnm5blt7LlrZjlnKjnmoTlgLzjgIJcbiAgICBsb2dnZXIud2FybignYXBwbHlJbnNlcnRBdExldmVsJywgYFZhcmlhYmxlSW5zZXJ0IOWksei0pe+8mui3r+W+hOW3suWtmOWcqOS4lOaXoOazlemAkuW9kuihpeWFhSAtPiAke2Jhc2VQYXRofWApO1xuICB9XG4gIC8vIOWmguaenCBiYXNlUGF0aCDkuLrnqbrvvIjlnKjmoLnnuqfliKvvvInkuJQgcGF0Y2gg5LiN5piv5a+56LGh77yM5YiZ5LiN5omn6KGM5Lu75L2V5pON5L2c77yM5Zug5Li65qC55LiN6IO96KKr6Z2e5a+56LGh5pu/5o2i44CCXG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVJbnNlcnQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxJbnNlcnRzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGluc2VydCDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NJbnNlcnRCbG9ja3MoYWxsSW5zZXJ0czogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxJbnNlcnRzLmxlbmd0aCA+IDApIHtcbiAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShhc3luYyBzdGF0ID0+IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0luc2VydEJsb2NrcycsICdb5Yid5aeL54q25oCBXSDov5vlhaUgcHJvY2Vzc0luc2VydEJsb2NrcyDml7bnmoQgc3RhdERhdGE6JywgXy5jbG9uZURlZXAoc3RhdCkpO1xuICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgfSk7XG4gICAgLypcbiAgICAgKiBOLkIuIOW/hemhu+Wvueavj+S4qiBpbnNlcnRSb290IOWNleeLrOiwg+eUqCB1cGRhdGVWYXJpYWJsZXNXaXRo77yM6ICM5LiN5piv5bCG5omA5pyJ5pON5L2c5ZCI5bm25Yiw5LiA5qyh6LCD55So5Lit44CCXG4gICAgICog6L+Z5piv5Li65LqG56Gu5L+d5Zyo5ZCM5LiA5p2h5raI5oGv5YaF77yM5YmN5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5Z2X5Lit5o+S5YWl55qE5qih5p2/5oiW5pWw5o2u77yMXG4gICAgICog5Y+v5Lul6KKr5ZCO5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5oiWIDxWYXJpYWJsZUVkaXQ+IOWdl+iuv+mXruWSjOS9v+eUqOOAglxuICAgICAqIOavj+asoSBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoIOWujOaIkOWQju+8jOWPmOmHj+eKtuaAgemDveS8muiiq+WIt+aWsO+8jOS7juiAjOS9v+WQjue7reaTjeS9nOiDveeci+WIsOacgOaWsOeahOe7k+aenOOAglxuICAgICAqL1xuICAgIGZvciAoY29uc3QgaW5zZXJ0Um9vdCBvZiBhbGxJbnNlcnRzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChpbnNlcnRSb290KSB8fCBfLmlzRW1wdHkoaW5zZXJ0Um9vdCkpIGNvbnRpbnVlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdXBkYXRlRXJhU3RhdERhdGEoc3RhdCA9PiB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgYOWkhOeQhiBpbnNlcnRSb290OiAke0pTT04uc3RyaW5naWZ5KGluc2VydFJvb3QpfWApO1xuICAgICAgICAgIC8vIOS7juaguei3r+W+hCAnJyDlvIDlp4vnu5/kuIDpgJLlvZLlhaXlj6PvvIzpobblsYLosIPnlKjml7bvvIzniLboioLngrnkuLogbnVsbFxuICAgICAgICAgIGFwcGx5SW5zZXJ0QXRMZXZlbChzdGF0LCAnJywgaW5zZXJ0Um9vdCwgZWRpdExvZywgbnVsbCwgbnVsbCk7XG4gICAgICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcigncHJvY2Vzc0luc2VydEJsb2NrcycsIGDlpITnkIYgaW5zZXJ0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgJ+aJgOaciSBWYXJpYWJsZUluc2VydCDmk43kvZzlrozmiJAnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/insert.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/template.ts": 
  /*!**************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/template.ts ***!
  \**************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyTemplateToPatch: () => (/* binding */ applyTemplateToPatch),\n/* harmony export */   getInheritedTemplateContent: () => (/* binding */ getInheritedTemplateContent),\n/* harmony export */   resolveTemplate: () => (/* binding */ resolveTemplate)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ "./src/ERA变量框架/utils/data.ts");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/log */ "./src/ERA变量框架/utils/log.ts");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger();\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nfunction resolveTemplate(inheritedContent, parentNodeData) {\n    // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n    const varsContent = _.get(parentNodeData, \'$template\');\n    logger.debug(\'resolveTemplate\', `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(varsContent)}`);\n    // 2. 按优先级合并 (父节点变量 > 继承)\n    let mergedContent = {};\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, inheritedContent);\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, varsContent);\n    logger.debug(\'resolveTemplate\', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n    if (_.isEmpty(mergedContent)) {\n        return null;\n    }\n    return mergedContent;\n}\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   "$template": { "hp": 10, "mana": 100, "a": { "d": 1 } },\n *   "lili": { "hp": 15, "class": "warrior", "a": { "c": 1 } }\n * };\n * const key = "lili";\n * // 输出 (合并后的内容):\n * // { "hp": 15, "mana": 100, "class": "warrior", "a": { "c": 1, "d": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nfunction getInheritedTemplateContent(parentTplContent, key) {\n    if (!parentTplContent)\n        return undefined;\n    // 步骤 1: 在父级模板内容中查找通用的原型规则\n    const prototypeContent = _.get(parentTplContent, \'$template\');\n    // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n    const specificContent = _.get(parentTplContent, key);\n    // 步骤 3: 根据查找结果决定最终模板内容\n    if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(prototypeContent)}\\n      - 特异性: ${JSON.stringify(specificContent)}`);\n        // 直接使用 mergeReplaceArray 进行合并\n        const merged = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(prototypeContent), specificContent);\n        logger.debug(\'getInheritedTemplateContent\', `  - 合并后: ${JSON.stringify(merged)}`);\n        return merged;\n    }\n    else if (_.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到特异性内容: ${JSON.stringify(specificContent)}`);\n        return specificContent;\n    }\n    else if (_.isPlainObject(prototypeContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到原型内容: ${JSON.stringify(prototypeContent)}`);\n        return prototypeContent;\n    }\n    logger.debug(\'getInheritedTemplateContent\', `在父级模板内容中未为子节点 "${key}" 找到任何可继承的规则。`);\n    return undefined;\n}\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nfunction applyTemplateToPatch(tplContent, patchObj) {\n    logger.debug(\'applyTemplateToPatch\', `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`);\n    if (!_.isPlainObject(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 补丁不是一个普通对象，直接返回。`);\n        return patchObj;\n    }\n    if (!tplContent) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 模板内容无效，直接返回补丁。`);\n        return patchObj;\n    }\n    // 如果补丁是空对象，直接使用模板内容\n    if (_.isEmpty(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `补丁为空对象，完全使用模板内容。`);\n        return _.cloneDeep(tplContent);\n    }\n    // 如果补丁非空，将模板内容作为默认值与补丁合并\n    const composed = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(tplContent), patchObj);\n    logger.debug(\'applyTemplateToPatch\', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n    return composed;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvdGVtcGxhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBYTtBQUUyQztBQUNaO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCOzs7Ozs7OztHQVFHO0FBQ0ksU0FBUyxlQUFlLENBQUMsZ0JBQXFCLEVBQUUsY0FBbUI7SUFDeEUsbUNBQW1DO0lBQ25DLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRXZELE1BQU0sQ0FBQyxLQUFLLENBQ1YsaUJBQWlCLEVBQ2pCLHdCQUF3QixJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUN0RixXQUFXLENBQ1osRUFBRSxDQUNKLENBQUM7SUFFRix5QkFBeUI7SUFDekIsSUFBSSxhQUFhLEdBQVEsRUFBRSxDQUFDO0lBQzVCLGFBQWEsR0FBRyw4REFBaUIsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUNuRSxhQUFhLEdBQUcsOERBQWlCLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRTlELE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsZUFBZSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVoRixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGFBQWEsQ0FBQztBQUN2QixDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFDSSxTQUFTLDJCQUEyQixDQUFDLGdCQUFxQixFQUFFLEdBQVc7SUFDNUUsSUFBSSxDQUFDLGdCQUFnQjtRQUFFLE9BQU8sU0FBUyxDQUFDO0lBRXhDLDBCQUEwQjtJQUMxQixN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QUMsc0JBQXNCLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvaW5zZXJ0L3RlbXBsYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgbWVyZ2VSZXBsYWNlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLyoqXG4gKiAqKuOAkOino+aekOW5tuWQiOW5tuaooeadv+WGheWuueOAkSoqXG4gKlxuICog5LuO57un5om/55qE5qih5p2/5YaF5a655ZKM54i26IqC54K55Y+Y6YeP5Lit5a6a5LmJ55qE5qih5p2/5YaF5a655Lit77yM5ZCI5bm25Ye65b2T5YmN5bGC57qn5Y+v55So55qE5qih5p2/44CCXG4gKlxuICogQHBhcmFtIGluaGVyaXRlZENvbnRlbnQgLSDku47kuIrkuIrlsYLnu6fmib/nmoTmqKHmnb/lhoXlrrnjgIJcbiAqIEBwYXJhbSBwYXJlbnROb2RlRGF0YSAtIOW9k+WJjeato+WcqOWkhOeQhueahOiKgueCueeahCAqKueItuiKgueCuSoqIOWcqOWPmOmHj+S4reeahOaVsOaNruOAglxuICogQHJldHVybnMge2FueX0gLSDlkIjlubblkI7nmoTljZXkuIDlhoXlrrnlr7nosaHvvIzlpoLmnpzmiYDmnInmnaXmupDpg73ml6DmlYjvvIzliJnov5Tlm54gYG51bGxg44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlVGVtcGxhdGUoaW5oZXJpdGVkQ29udGVudDogYW55LCBwYXJlbnROb2RlRGF0YTogYW55KTogYW55IHtcbiAgLy8gMS4g5LuO54i26IqC54K55Y+Y6YeP5Lit77yM5om+5Yiw5L2c5Li65b2T5YmN6IqC54K55YWE5byf55qEICR0ZW1wbGF0ZVxuICBjb25zdCB2YXJzQ29udGVudCA9IF8uZ2V0KHBhcmVudE5vZGVEYXRhLCAnJHRlbXBsYXRlJyk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXNvbHZlVGVtcGxhdGUnLFxuICAgIGDop6PmnpDlh7rnmoTmqKHmnb/lhoXlrrk6XFxuICAgIC0g57un5om/OiAke0pTT04uc3RyaW5naWZ5KGluaGVyaXRlZENvbnRlbnQpfVxcbiAgICAtIOeItuiKgueCueWPmOmHjzogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHZhcnNDb250ZW50LFxuICAgICl9YCxcbiAgKTtcblxuICAvLyAyLiDmjInkvJjlhYjnuqflkIjlubYgKOeItuiKgueCueWPmOmHjyA+IOe7p+aJvylcbiAgbGV0IG1lcmdlZENvbnRlbnQ6IGFueSA9IHt9O1xuICBtZXJnZWRDb250ZW50ID0gbWVyZ2VSZXBsYWNlQXJyYXkobWVyZ2VkQ29udGVudCwgaW5oZXJpdGVkQ29udGVudCk7XG4gIG1lcmdlZENvbnRlbnQgPSBtZXJnZVJlcGxhY2VBcnJheShtZXJnZWRDb250ZW50LCB2YXJzQ29udGVudCk7XG5cbiAgbG9nZ2VyLmRlYnVnKCdyZXNvbHZlVGVtcGxhdGUnLCBg5ZCI5bm25ZCO55qE5pyA57uI5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KG1lcmdlZENvbnRlbnQpfWApO1xuXG4gIGlmIChfLmlzRW1wdHkobWVyZ2VkQ29udGVudCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBtZXJnZWRDb250ZW50O1xufVxuXG4vKipcbiAqICoq44CQ6I635Y+W5a2Q6IqC54K56KaB57un5om/55qE5qih5p2/5YaF5a6544CRKipcbiAqXG4gKiDlnKjkuIDkuKrnu5nlrprnmoTigJzniLbnuqfmqKHmnb/lhoXlrrnigJ3kuK3vvIzmn6Xmib7lubblkIjlubblhbblhoXpg6jlrprkuYnnmoTigJzljp/lnovop4TliJnigJ0gKGAkdGVtcGxhdGVgKSDlkozigJznibnlvILmgKfop4TliJnigJ0gKGBrZXlgKe+8jFxuICog5Lul55Sf5oiQ5L6b54m55a6a5a2Q6IqC54K5IGBrZXlgIOS9v+eUqOeahOacgOe7iOaooeadv+WGheWuueOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDovpPlhaU6XG4gKiBjb25zdCBwYXJlbnRUcGxDb250ZW50ID0ge1xuICogICBcIiR0ZW1wbGF0ZVwiOiB7IFwiaHBcIjogMTAsIFwibWFuYVwiOiAxMDAsIFwiYVwiOiB7IFwiZFwiOiAxIH0gfSxcbiAqICAgXCJsaWxpXCI6IHsgXCJocFwiOiAxNSwgXCJjbGFzc1wiOiBcIndhcnJpb3JcIiwgXCJhXCI6IHsgXCJjXCI6IDEgfSB9XG4gKiB9O1xuICogY29uc3Qga2V5ID0gXCJsaWxpXCI7XG4gKiAvLyDovpPlh7ogKOWQiOW5tuWQjueahOWGheWuuSk6XG4gKiAvLyB7IFwiaHBcIjogMTUsIFwibWFuYVwiOiAxMDAsIFwiY2xhc3NcIjogXCJ3YXJyaW9yXCIsIFwiYVwiOiB7IFwiY1wiOiAxLCBcImRcIjogMSB9IH1cbiAqXG4gKiBAcGFyYW0gcGFyZW50VHBsQ29udGVudCAtIOeItue6p+eahOaooeadv+WGheWuue+8jOWug+acrOi6q+WPr+iDveWMheWQqyBgJHRlbXBsYXRlYCDlkowgYGtleWAg5L2c5Li65a2Q6ZSu44CCXG4gKiBAcGFyYW0ga2V5IC0g5q2j5Zyo5aSE55CG55qE5a2Q6IqC54K555qE6ZSu5ZCN44CCXG4gKiBAcmV0dXJucyB7YW55fSAtIOWtkOiKgueCueW6lOivpee7p+aJv+eahOOAgeW3suWQiOW5tueahOaooeadv+WGheWuue+8jOaIliBgdW5kZWZpbmVkYOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KHBhcmVudFRwbENvbnRlbnQ6IGFueSwga2V5OiBzdHJpbmcpOiBhbnkge1xuICBpZiAoIXBhcmVudFRwbENvbnRlbnQpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgLy8g5q2l6aqkIDE6IOWcqOeItue6p+aooeadv+WGheWuueS4reafpeaJvumAmueUqOeahOWOn+Wei+inhOWImVxuICBjb25zdCBwcm90b3R5cGVDb250ZW50ID0gXy5nZXQocGFyZW50VHBsQ29udGVudCwgJyR0ZW1wbGF0ZScpO1xuXG4gIC8vIOatpemqpCAyOiDlnKjniLbnuqfmqKHmnb/lhoXlrrnkuK3mn6Xmib7nu5kga2V5IOeahOeJueW8guaAp+inhOWImVxuICBjb25zdCBzcGVjaWZpY0NvbnRlbnQgPSBfLmdldChwYXJlbnRUcGxDb250ZW50LCBrZXkpO1xuXG4gIC8vIOatpemqpCAzOiDmoLnmja7mn6Xmib7nu5PmnpzlhrPlrprmnIDnu4jmqKHmnb/lhoXlrrlcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwcm90b3R5cGVDb250ZW50KSAmJiBfLmlzUGxhaW5PYmplY3Qoc3BlY2lmaWNDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWQjOaXtuaJvuWIsOWOn+Wei+WSjOeJueW8guaAp+WGheWuueOAglxcbiAgICAgIC0g5Y6f5Z6LOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICBwcm90b3R5cGVDb250ZW50LFxuICAgICAgKX1cXG4gICAgICAtIOeJueW8guaApzogJHtKU09OLnN0cmluZ2lmeShzcGVjaWZpY0NvbnRlbnQpfWAsXG4gICAgKTtcbiAgICAvLyDnm7TmjqXkvb/nlKggbWVyZ2VSZXBsYWNlQXJyYXkg6L+b6KGM5ZCI5bm2XG4gICAgY29uc3QgbWVyZ2VkID0gbWVyZ2VSZXBsYWNlQXJyYXkoXy5jbG9uZURlZXAocHJvdG90eXBlQ29udGVudCksIHNwZWNpZmljQ29udGVudCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBgICAtIOWQiOW5tuWQjjogJHtKU09OLnN0cmluZ2lmeShtZXJnZWQpfWApO1xuICAgIHJldHVybiBtZXJnZWQ7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHNwZWNpZmljQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDnibnlvILmgKflhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkoc3BlY2lmaWNDb250ZW50KX1gLFxuICAgICk7XG4gICAgcmV0dXJuIHNwZWNpZmljQ29udGVudDtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QocHJvdG90eXBlQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDljp/lnovlhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkocHJvdG90eXBlQ29udGVudCl9YCxcbiAgICApO1xuICAgIHJldHVybiBwcm90b3R5cGVDb250ZW50O1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBg5Zyo54i257qn5qih5p2/5YaF5a655Lit5pyq5Li65a2Q6IqC54K5IFwiJHtrZXl9XCIg5om+5Yiw5Lu75L2V5Y+v57un5om/55qE6KeE5YiZ44CCYCk7XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogKirjgJDlupTnlKjmqKHmnb/lhoXlrrnliLDooaXkuIHjgJEqKlxuICpcbiAqIOWwhuS4gOS4quKAnOaooeadv+WGheWuueKAneWvueixoeW6lOeUqOWIsOS4gOS4quKAnOihpeS4geKAneWvueixoeS4iu+8jOS9nOS4uuWFtum7mOiupOWAvOOAglxuICpcbiAqIEBwYXJhbSB0cGxDb250ZW50IC0g5b2T5YmN5bGC57qn5ZCI5bm25ZCO55qE5qih5p2/5YaF5a6544CCXG4gKiBAcGFyYW0gcGF0Y2hPYmogLSDopoHlupTnlKjmqKHmnb/nmoTooaXkuIHmlbDmja7jgIJcbiAqIEByZXR1cm5zIHthbnl9IC0g5bqU55So5LqG5qih5p2/6buY6K6k5YC85LmL5ZCO77yM5pyA57uI5ZCI5oiQ55qE5pWw5o2u5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRlbXBsYXRlVG9QYXRjaCh0cGxDb250ZW50OiBhbnksIHBhdGNoT2JqOiBhbnkpOiBhbnkge1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJyxcbiAgICBgW+i/m+WFpV0g5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KHRwbENvbnRlbnQpfSwg6KGl5LiBOiAke0pTT04uc3RyaW5naWZ5KHBhdGNoT2JqKX1gLFxuICApO1xuXG4gIGlmICghXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g6KGl5LiB5LiN5piv5LiA5Liq5pmu6YCa5a+56LGh77yM55u05o6l6L+U5Zue44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG4gIGlmICghdHBsQ29udGVudCkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g5qih5p2/5YaF5a655peg5pWI77yM55u05o6l6L+U5Zue6KGl5LiB44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG5cbiAgLy8g5aaC5p6c6KGl5LiB5piv56m65a+56LGh77yM55u05o6l5L2/55So5qih5p2/5YaF5a65XG4gIGlmIChfLmlzRW1wdHkocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGDooaXkuIHkuLrnqbrlr7nosaHvvIzlrozlhajkvb/nlKjmqKHmnb/lhoXlrrnjgIJgKTtcbiAgICByZXR1cm4gXy5jbG9uZURlZXAodHBsQ29udGVudCk7XG4gIH1cblxuICAvLyDlpoLmnpzooaXkuIHpnZ7nqbrvvIzlsIbmqKHmnb/lhoXlrrnkvZzkuLrpu5jorqTlgLzkuI7ooaXkuIHlkIjlubZcbiAgY29uc3QgY29tcG9zZWQgPSBtZXJnZVJlcGxhY2VBcnJheShfLmNsb25lRGVlcCh0cGxDb250ZW50KSwgcGF0Y2hPYmopO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJywgYOWQiOW5tuaooeadv+S4juihpeS4geWQjueahOe7k+aenDogJHtKU09OLnN0cmluZ2lmeShjb21wb3NlZCl9YCk7XG4gIHJldHVybiBjb21wb3NlZDtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/template.ts\n\n}');
  },
  "./src/ERA变量框架/core/crud/patcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/core/crud/patcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApplyVarChange: () => (/* binding */ ApplyVarChange),\n/* harmony export */   ApplyVarChangeForMessage: () => (/* binding */ ApplyVarChangeForMessage)\n/* harmony export */ });\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./delete */ \"./src/ERA变量框架/core/crud/delete.ts\");\n/* harmony import */ var _insert_insert__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./insert/insert */ \"./src/ERA变量框架/core/crud/insert/insert.ts\");\n/* harmony import */ var _update__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./update */ \"./src/ERA变量框架/core/crud/update.ts\");\n/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_4__.Logger();\n/**\n * **【核心实现】** 对指定的消息应用变量修改。\n * 这是变量写入流程的核心，处理单个消息。\n *\n * @param {TavernMessage} msg - 要处理的酒馆消息对象。\n * @returns {Promise<string | null>} 如果成功处理，返回该消息的 MK；如果消息无需处理或处理失败，返回 null。\n */\nconst ApplyVarChangeForMessage = async (msg) => {\n    logger.debug('ApplyVarChangeForMessage', `开始处理消息...`, { msg });\n    try {\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ApplyVarChangeForMessage', '无效消息对象或缺少 message_id，退出');\n            return null;\n        }\n        const messageId = msg.message_id;\n        // 写入函数只负责读取 MK，不负责创建。创建的职责由上游的 `ensureMessageKey` 承担。\n        const MK = (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_0__.readMessageKey)(msg);\n        // 如果消息没有 MK（可能是一个异常状态，如新消息还未被注入 MK），则跳过。\n        if (!MK) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 不含 MK，跳过变量写入。`);\n            return null;\n        }\n        // 根据设计，用户消息自身不应包含变量修改指令，因此跳过变量处理，但返回其已有的 MK。\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.isUserMessage)(msg)) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 为用户消息，跳过变量写入，但保留其 MK。`);\n            return MK;\n        }\n        const rawContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(msg) || '';\n        // 1. 从消息内容中解析出所有指令块。\n        const insertBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableInsert');\n        const editBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableEdit');\n        const deleteBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableDelete');\n        // 调试日志：输出提取的原始块\n        //logger.debug('【ERA调试】原始指令块', insertBlocks);\n        if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 未检测到变量修改标签。`);\n        }\n        const rawInserts = insertBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        const rawEdits = editBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        const rawDeletes = deleteBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        // 调试日志：输出 JSONL 解析结果\n        //logger.debug('【ERA调试】JSONL解析结果', rawInserts);\n        // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n        const allInserts = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawInserts);\n        const allEdits = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawEdits);\n        const allDeletes = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawDeletes);\n        logger.debug('ApplyVarChangeForMessage', '数据转义完成', {\n            before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n            after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n        });\n        const editLog = []; // 用于收集本轮操作产生的所有变更记录。\n        // 2. --- 处理所有插入操作 (`<VariableInsert>`) ---\n        await (0,_insert_insert__WEBPACK_IMPORTED_MODULE_8__.processInsertBlocks)(allInserts, editLog);\n        // 3. --- 处理所有编辑操作 (`<VariableEdit>`) ---\n        await (0,_update__WEBPACK_IMPORTED_MODULE_9__.processEditBlocks)(allEdits, editLog, messageId);\n        // 4. --- 处理所有删除操作 (`<VariableDelete>`) ---\n        await (0,_delete__WEBPACK_IMPORTED_MODULE_7__.processDeleteBlocks)(allDeletes, editLog);\n        // 5. --- 覆盖式写入 EditLog ---\n        /*\n         * 核心逻辑：无论本轮是否产生了有效的变量修改，都必须用当前的 editLog (哪怕是空数组) 覆盖旧的 EditLog。\n         *\n         * 为什么必须覆盖而不是在没有修改时跳过？\n         *\n         * 根本原因在于，必须确保每个 MK 对应的 EditLog，严格且唯一地反映其所属消息**当前内容**所产生的变量修改。\n         *\n         * 考虑一个场景：\n         * 1. 消息A (MK_A) 的内容包含指令，生成了 EditLog_A。\n         * 2. 用户对消息A进行 swipe，生成了消息B (MK_B)，其内容完全没有变量修改标签。\n         *\n         * 如果在处理消息B时，因为没有检测到指令就“跳过写入”，那么与 MK_B 关联的 EditLog 就会是空的或不存在的。\n         * 这在当前是正确的。\n         *\n         * 但如果用户再次 swipe，从消息B切换回消息A。此时框架会重新处理消息A。\n         * 如果我们不执行覆盖式写入，那么与 MK_A 关联的 EditLog 仍然是之前生成的 EditLog_A，这没有问题。\n         *\n         * 真正的问题在于状态的明确性。覆盖式写入确保了任何一个 MK 的日志，在任何时间点，\n         * 都是其**当前可见内容**的直接产物，没有任何历史遗留。这使得整个系统的状态变迁变得清晰、可预测，\n         * 极大地降低了在复杂操作（如多次 `swipe`、删除、编辑）中出现状态不一致的风险。\n         *\n         * 因此，正确的做法是：用本次解析消息内容生成的 editLog (在无指令的场景下是 `[]`) 去覆盖，\n         * 从而斩断任何可能存在的历史关联，确保数据的一致性和纯粹性。\n         */\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n                const newArr = Array.isArray(editLog) ? editLog : (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseEditLog)(editLog);\n                logger.debug('ApplyVarChangeForMessage', `准备为 MK=${MK} (MsgID=${messageId}) 写入 EditLog:\\n${JSON.stringify(newArr, null, 2)}`);\n                // 将本轮生成的日志数组，以当前消息的 MK 为键，存入 `EditLogs` 对象。\n                _.set(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_1__.LOGS_PATH, MK], JSON.stringify(newArr));\n                /*\n                 * N.B. 此函数不再负责更新 SelectedMks 数组。\n                 * 更新 SelectedMks 的职责已移交至上层调用者 (resyncStateOnHistoryChange 或 ApplyVarChange)，\n                 * 以避免在 resync 循环中意外修改正在被读取的 oldSelectedMks 状态。\n                 */\n                return meta;\n            });\n            logger.debug('ApplyVarChangeForMessage', `成功为 MK=${MK} 写入 EditLog。`);\n        }\n        catch (e) {\n            logger.error('ApplyVarChangeForMessage', `为 MK=${MK} 写入 EditLogs 失败: ${e?.message || e}`, e);\n        }\n        return MK;\n    }\n    catch (err) {\n        logger.error('ApplyVarChangeForMessage', `变量写入器异常: ${err?.message || err}`, err);\n        return null;\n    }\n};\n/**\n * **【标准事件处理入口】**\n * 这是一个上层封装，用于处理最新 AI 消息的变量写入，并负责更新 `SelectedMks` 数组。\n * 它会自动寻找最后一条 AI 消息进行操作，通常被绑定到“新消息生成”等事件上。\n */\nconst ApplyVarChange = async () => {\n    logger.debug('ApplyVarChange', `函数被调用...`);\n    // 1. 智能查找最后一条 AI 消息\n    const msg = (0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.log('ApplyVarChange', '未找到可处理的 AI 消息，退出。');\n        return;\n    }\n    const messageId = msg.message_id;\n    logger.log('ApplyVarChange', `找到目标 AI 消息 (ID: ${messageId})，开始处理变量写入...`);\n    // 2. 调用核心实现来处理变量和 EditLog 的写入。\n    // EditLog 会被自动关联到从该消息中读取到的 MK 上。\n    const MK = await ApplyVarChangeForMessage(msg);\n    // 3. 在核心流程执行完毕后，在此处统一更新 SelectedMks，确保状态一致。\n    try {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n            const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, []);\n            // 关键：必须使用我们正在处理的 AI 消息的 messageId 作为索引，\n            // 来更新 SelectedMks 数组中对应的 MK 记录。\n            selectedMks[messageId] = MK;\n            _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, selectedMks);\n            return meta;\n        });\n    }\n    catch (e) {\n        logger.error('ApplyVarChange', `更新 SelectedMks 失败: ${e?.message || e}`, e);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9wYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBRVU7QUFFc0M7QUFDUztBQUNlO0FBQ2xCO0FBQ2hCO0FBQ2lEO0FBQ3ZDO0FBQ0o7QUFDTztBQUNUO0FBRTdDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCOzs7Ozs7R0FNRztBQUNJLE1BQU0sd0JBQXdCLEdBQUcsS0FBSyxFQUFFLEdBQVEsRUFBMEIsRUFBRTtJQUNqRixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1lBQ25FLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7UUFDakMsc0RBQXNEO1FBQ3RELE1BQU0sRUFBRSxHQUFHLDREQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFL0IseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNSLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLGlCQUFpQixDQUFDLENBQUM7WUFDaEYsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksNkRBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLHlCQUF5QixDQUFDLENBQUM7WUFDeEYsT0FBTyxFQUFF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RTFFLCtCQUErQjtJQUMvQixpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEdBQUcsTUFBTSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUvQyw0Q0FBNEM7SUFDNUMsSUFBSSxDQUFDO1FBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlDLHdDQUF3QztZQUN4QyxnQ0FBZ0M7WUFDaEMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ25DLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztRQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLHNCQUFzQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvcGF0Y2hlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/lhpnlhaXmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTigJzmiafooYzlvJXmk47igJ3vvIzotJ/otKPlsIbmtojmga/lhoXlrrnkuK3nmoTlj5jph4/kv67mlLnmjIfku6TlupTnlKjliLDlrp7pmYXnmoQgYGNoYXRgIOWPmOmHj+S4reOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiDlj5jph4/nmoTlhpnlhaXmmK/kuIDkuKrkuKXosKjnmoTov4fnqIvvvIzlv4Xpobvnoa7kv53miYDmnInlj5jmm7Tpg73ooqvmraPnoa7orrDlvZXvvIzku6Xkvr/lkI7nu63nmoTlm57mu5rlkozlkIzmraXjgIJcbiAqIOatpOaooeWdl+eahOaguOW/g+iBjOi0o+aYr++8mlxuICogMS4gKirop6PmnpDmjIfku6QqKjog5LuOIEFJIOa2iOaBr+S4reaPkOWPliBgPFZhcmlhYmxlSW5zZXJ0PmAg5ZKMIGA8VmFyaWFibGVFZGl0PmAg5Z2X44CCXG4gKiAyLiAqKumhuuW6j+aJp+ihjCoqOiDnoa7kv53lkIzkuIDmtojmga/lhoXnmoTlpJrkuKrmjIfku6TlnZfmjInpobrluo/miafooYzvvIzkuJTlkI7nu63mjIfku6Tog73mhJ/nn6XliLDliY3pnaLmjIfku6TnmoTnu5PmnpzjgIJcbiAqIDMuICoq55Sf5oiQ5pel5b+XKio6IOWcqOW6lOeUqOWPmOabtOeahOWQjOaXtu+8jOiwg+eUqCBgcmVjdXJzaXZlLnRzYCDkuK3nmoTpgJLlvZLlh73mlbDmnaXnlJ/miJDnsr7noa7nmoQgYEVkaXRMb2dg44CCXG4gKiA0LiAqKuimhuebluW8j+aXpeW/l+WGmeWFpSoqOiDnoa7kv53mr4/kuKrmtojmga/lr4bpkqXvvIhNS++8ieWvueW6lOeahCBgRWRpdExvZ2Ag5Lil5qC85Y+N5pig5YW25b2T5YmN5YaF5a6577yMXG4gKiAgICDljbPkvb/lhoXlrrnkuK3msqHmnInku7vkvZXmjIfku6TvvIjmraTml7bkvJrlhpnlhaXnqbrml6Xlv5fvvInvvIzkuZ/opoHopobnm5bml6fml6Xlv5fvvIzov5nmmK/pmLLmraIgYHN3aXBlYCDpgKDmiJDmlbDmja7msaHmn5PnmoTlhbPplK7jgIJcbiAqXG4gKiAqKuiBjOi0o+i+ueeVjCoqOlxuICogLSDmnKzmqKHlnZcqKuWPqui0n+i0o+ivu+WPliBNSyoq77yM5LiN6LSf6LSj5Yib5bu644CC5Yib5bu6IE1LIOeahOiBjOi0o+eUseS4iua4uOeahCBgbWVzc2FnZV9rZXkudHNgIOaJv+aLheOAglxuICogLSBgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlYCDlh73mlbAqKuWPqui0n+i0o+WGmeWFpeWPmOmHj+WSjCBgRWRpdExvZ2AqKu+8jOS4jei0n+i0o+abtOaWsCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAgIOabtOaWsCBgU2VsZWN0ZWRNa3NgIOeahOiBjOi0o+iiq+enu+S6pOe7meS6huabtOS4iuWxgueahOiwg+eUqOiAhe+8iOWmgiBgQXBwbHlWYXJDaGFuZ2VgIOaIluWQjOatpeWHveaVsO+8ie+8jFxuICogICDku6Xpgb/lhY3lnKjlkIzmraXlvqrnjq/kuK3kv67mlLnmraPlnKjooqvor7vlj5bnmoTnirbmgIHvvIzov5nmmK/kuIDnp43ph43opoHnmoTlubblj5HmjqfliLbnrZbnlaXjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHJlYWRNZXNzYWdlS2V5IH0gZnJvbSAnLi4vLi4vY29yZS9rZXkvbWsnO1xuaW1wb3J0IHsgTE9HU19QQVRILCBTRUxfUEFUSCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBlc2NhcGVFcmFEYXRhLCBwYXJzZUVkaXRMb2csIHBhcnNlSnNvbmwgfSBmcm9tICcuLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IHVwZGF0ZUVyYU1ldGFEYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uLy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgZXh0cmFjdEJsb2NrcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBwcm9jZXNzRGVsZXRlQmxvY2tzIH0gZnJvbSAnLi9kZWxldGUnO1xuaW1wb3J0IHsgcHJvY2Vzc0luc2VydEJsb2NrcyB9IGZyb20gJy4vaW5zZXJ0L2luc2VydCc7XG5pbXBvcnQgeyBwcm9jZXNzRWRpdEJsb2NrcyB9IGZyb20gJy4vdXBkYXRlJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqICoq44CQ5qC45b+D5a6e546w44CRKiog5a+55oyH5a6a55qE5raI5oGv5bqU55So5Y+Y6YeP5L+u5pS544CCXG4gKiDov5nmmK/lj5jph4/lhpnlhaXmtYHnqIvnmoTmoLjlv4PvvIzlpITnkIbljZXkuKrmtojmga/jgIJcbiAqXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOimgeWkhOeQhueahOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nIHwgbnVsbD59IOWmguaenOaIkOWKn+WkhOeQhu+8jOi/lOWbnuivpea2iOaBr+eahCBNS++8m+WmguaenOa2iOaBr+aXoOmcgOWkhOeQhuaIluWkhOeQhuWksei0pe+8jOi/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBjb25zdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UgPSBhc3luYyAobXNnOiBhbnkpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5byA5aeL5aSE55CG5raI5oGvLi4uYCwgeyBtc2cgfSk7XG4gIHRyeSB7XG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsICfml6DmlYjmtojmga/lr7nosaHmiJbnvLrlsJEgbWVzc2FnZV9pZO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gICAgLy8g5YaZ5YWl5Ye95pWw5Y+q6LSf6LSj6K+75Y+WIE1L77yM5LiN6LSf6LSj5Yib5bu644CC5Yib5bu655qE6IGM6LSj55Sx5LiK5ri455qEIGBlbnN1cmVNZXNzYWdlS2V5YCDmib/mi4XjgIJcbiAgICBjb25zdCBNSyA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG5cbiAgICAvLyDlpoLmnpzmtojmga/msqHmnIkgTUvvvIjlj6/og73mmK/kuIDkuKrlvILluLjnirbmgIHvvIzlpoLmlrDmtojmga/ov5jmnKrooqvms6jlhaUgTUvvvInvvIzliJnot7Pov4fjgIJcbiAgICBpZiAoIU1LKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOS4jeWQqyBNS++8jOi3s+i/h+WPmOmHj+WGmeWFpeOAgmApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g5qC55o2u6K6+6K6h77yM55So5oi35raI5oGv6Ieq6Lqr5LiN5bqU5YyF5ZCr5Y+Y6YeP5L+u5pS55oyH5Luk77yM5Zug5q2k6Lez6L+H5Y+Y6YeP5aSE55CG77yM5L2G6L+U5Zue5YW25bey5pyJ55qEIE1L44CCXG4gICAgaWYgKGlzVXNlck1lc3NhZ2UobXNnKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5raI5oGvIChJRDogJHttZXNzYWdlSWR9KSDkuLrnlKjmiLfmtojmga/vvIzot7Pov4flj5jph4/lhpnlhaXvvIzkvYbkv53nlZnlhbYgTUvjgIJgKTtcbiAgICAgIHJldHVybiBNSztcbiAgICB9XG5cbiAgICBjb25zdCByYXdDb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobXNnKSB8fCAnJztcblxuICAgIC8vIDEuIOS7jua2iOaBr+WGheWuueS4reino+aekOWHuuaJgOacieaMh+S7pOWdl+OAglxuICAgIGNvbnN0IGluc2VydEJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlSW5zZXJ0Jyk7XG4gICAgY29uc3QgZWRpdEJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlRWRpdCcpO1xuICAgIGNvbnN0IGRlbGV0ZUJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlRGVsZXRlJyk7XG5cbiAgICAvLyDosIPor5Xml6Xlv5fvvJrovpPlh7rmj5Dlj5bnmoTljp/lp4vlnZdcbiAgICAvL2xvZ2dlci5kZWJ1Zygn44CQRVJB6LCD6K+V44CR5Y6f5aeL5oyH5Luk5Z2XJywgaW5zZXJ0QmxvY2tzKTtcblxuICAgIGlmICghaW5zZXJ0QmxvY2tzLmxlbmd0aCAmJiAhZWRpdEJsb2Nrcy5sZW5ndGggJiYgIWRlbGV0ZUJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5pyq5qOA5rWL5Yiw5Y+Y6YeP5L+u5pS55qCH562+44CCYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmF3SW5zZXJ0cyA9IGluc2VydEJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG4gICAgY29uc3QgcmF3RWRpdHMgPSBlZGl0QmxvY2tzLmZsYXRNYXAocyA9PiBwYXJzZUpzb25sKHMpKTtcbiAgICBjb25zdCByYXdEZWxldGVzID0gZGVsZXRlQmxvY2tzLmZsYXRNYXAocyA9PiBwYXJzZUpzb25sKHMpKTtcblxuICAgIC8vIOiwg+ivleaXpeW/l++8mui+k+WHuiBKU09OTCDop6PmnpDnu5PmnpxcbiAgICAvL2xvZ2dlci5kZWJ1Zygn44CQRVJB6LCD6K+V44CRSlNPTkzop6PmnpDnu5PmnpwnLCByYXdJbnNlcnRzKTtcblxuICAgIC8vIOWcqOi/memHjOWvueS7jua2iOaBr+S4reino+aekOWHuueahOWOn+Wni+aVsOaNrui/m+ihjOi9rOS5ie+8jOehruS/neaJgOacieWQjue7reWkhOeQhumDveS9v+eUqOi9rOS5ieWQjueahOaVsOaNruOAglxuICAgIGNvbnN0IGFsbEluc2VydHMgPSBlc2NhcGVFcmFEYXRhKHJhd0luc2VydHMpO1xuICAgIGNvbnN0IGFsbEVkaXRzID0gZXNjYXBlRXJhRGF0YShyYXdFZGl0cyk7XG4gICAgY29uc3QgYWxsRGVsZXRlcyA9IGVzY2FwZUVyYURhdGEocmF3RGVsZXRlcyk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsICfmlbDmja7ovazkuYnlrozmiJAnLCB7XG4gICAgICBiZWZvcmU6IHsgaW5zZXJ0czogcmF3SW5zZXJ0cywgZWRpdHM6IHJhd0VkaXRzLCBkZWxldGVzOiByYXdEZWxldGVzIH0sXG4gICAgICBhZnRlcjogeyBpbnNlcnRzOiBhbGxJbnNlcnRzLCBlZGl0czogYWxsRWRpdHMsIGRlbGV0ZXM6IGFsbERlbGV0ZXMgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGVkaXRMb2c6IGFueVtdID0gW107IC8vIOeUqOS6juaUtumbhuacrOi9ruaTjeS9nOS6p+eUn+eahOaJgOacieWPmOabtOiusOW9leOAglxuXG4gICAgLy8gMi4gLS0tIOWkhOeQhuaJgOacieaPkuWFpeaTjeS9nCAoYDxWYXJpYWJsZUluc2VydD5gKSAtLS1cbiAgICBhd2FpdCBwcm9jZXNzSW5zZXJ0QmxvY2tzKGFsbEluc2VydHMsIGVkaXRMb2cpO1xuXG4gICAgLy8gMy4gLS0tIOWkhOeQhuaJgOaciee8lui+keaTjeS9nCAoYDxWYXJpYWJsZUVkaXQ+YCkgLS0tXG4gICAgYXdhaXQgcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHMsIGVkaXRMb2csIG1lc3NhZ2VJZCk7XG5cbiAgICAvLyA0LiAtLS0g5aSE55CG5omA5pyJ5Yig6Zmk5pON5L2cIChgPFZhcmlhYmxlRGVsZXRlPmApIC0tLVxuICAgIGF3YWl0IHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlcywgZWRpdExvZyk7XG5cbiAgICAvLyA1LiAtLS0g6KaG55uW5byP5YaZ5YWlIEVkaXRMb2cgLS0tXG4gICAgLypcbiAgICAgKiDmoLjlv4PpgLvovpHvvJrml6DorrrmnKzova7mmK/lkKbkuqfnlJ/kuobmnInmlYjnmoTlj5jph4/kv67mlLnvvIzpg73lv4XpobvnlKjlvZPliY3nmoQgZWRpdExvZyAo5ZOq5oCV5piv56m65pWw57uEKSDopobnm5bml6fnmoQgRWRpdExvZ+OAglxuICAgICAqXG4gICAgICog5Li65LuA5LmI5b+F6aG76KaG55uW6ICM5LiN5piv5Zyo5rKh5pyJ5L+u5pS55pe26Lez6L+H77yfXG4gICAgICpcbiAgICAgKiDmoLnmnKzljp/lm6DlnKjkuo7vvIzlv4Xpobvnoa7kv53mr4/kuKogTUsg5a+55bqU55qEIEVkaXRMb2fvvIzkuKXmoLzkuJTllK/kuIDlnLDlj43mmKDlhbbmiYDlsZ7mtojmga8qKuW9k+WJjeWGheWuuSoq5omA5Lqn55Sf55qE5Y+Y6YeP5L+u5pS544CCXG4gICAgICpcbiAgICAgKiDogIPomZHkuIDkuKrlnLrmma/vvJpcbiAgICAgKiAxLiDmtojmga9BIChNS19BKSDnmoTlhoXlrrnljIXlkKvmjIfku6TvvIznlJ/miJDkuoYgRWRpdExvZ19B44CCXG4gICAgICogMi4g55So5oi35a+55raI5oGvQei/m+ihjCBzd2lwZe+8jOeUn+aIkOS6hua2iOaBr0IgKE1LX0Ip77yM5YW25YaF5a655a6M5YWo5rKh5pyJ5Y+Y6YeP5L+u5pS55qCH562+44CCXG4gICAgICpcbiAgICAgKiDlpoLmnpzlnKjlpITnkIbmtojmga9C5pe277yM5Zug5Li65rKh5pyJ5qOA5rWL5Yiw5oyH5Luk5bCx4oCc6Lez6L+H5YaZ5YWl4oCd77yM6YKj5LmI5LiOIE1LX0Ig5YWz6IGU55qEIEVkaXRMb2cg5bCx5Lya5piv56m655qE5oiW5LiN5a2Y5Zyo55qE44CCXG4gICAgICog6L+Z5Zyo5b2T5YmN5piv5q2j56Gu55qE44CCXG4gICAgICpcbiAgICAgKiDkvYblpoLmnpznlKjmiLflho3mrKEgc3dpcGXvvIzku47mtojmga9C5YiH5o2i5Zue5raI5oGvQeOAguatpOaXtuahhuaetuS8mumHjeaWsOWkhOeQhua2iOaBr0HjgIJcbiAgICAgKiDlpoLmnpzmiJHku6zkuI3miafooYzopobnm5blvI/lhpnlhaXvvIzpgqPkuYjkuI4gTUtfQSDlhbPogZTnmoQgRWRpdExvZyDku43nhLbmmK/kuYvliY3nlJ/miJDnmoQgRWRpdExvZ19B77yM6L+Z5rKh5pyJ6Zeu6aKY44CCXG4gICAgICpcbiAgICAgKiDnnJ/mraPnmoTpl67popjlnKjkuo7nirbmgIHnmoTmmI7noa7mgKfjgILopobnm5blvI/lhpnlhaXnoa7kv53kuobku7vkvZXkuIDkuKogTUsg55qE5pel5b+X77yM5Zyo5Lu75L2V5pe26Ze054K577yMXG4gICAgICog6YO95piv5YW2KirlvZPliY3lj6/op4HlhoXlrrkqKueahOebtOaOpeS6p+eJqe+8jOayoeacieS7u+S9leWOhuWPsumBl+eVmeOAgui/meS9v+W+l+aVtOS4quezu+e7n+eahOeKtuaAgeWPmOi/geWPmOW+l+a4heaZsOOAgeWPr+mihOa1i++8jFxuICAgICAqIOaegeWkp+WcsOmZjeS9juS6huWcqOWkjeadguaTjeS9nO+8iOWmguWkmuasoSBgc3dpcGVg44CB5Yig6Zmk44CB57yW6L6R77yJ5Lit5Ye6546w54q25oCB5LiN5LiA6Ie055qE6aOO6Zmp44CCXG4gICAgICpcbiAgICAgKiDlm6DmraTvvIzmraPnoa7nmoTlgZrms5XmmK/vvJrnlKjmnKzmrKHop6PmnpDmtojmga/lhoXlrrnnlJ/miJDnmoQgZWRpdExvZyAo5Zyo5peg5oyH5Luk55qE5Zy65pmv5LiL5pivIGBbXWApIOWOu+imhueblu+8jFxuICAgICAqIOS7juiAjOaWqeaWreS7u+S9leWPr+iDveWtmOWcqOeahOWOhuWPsuWFs+iBlO+8jOehruS/neaVsOaNrueahOS4gOiHtOaAp+WSjOe6r+eyueaAp+OAglxuICAgICAqL1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB1cGRhdGVFcmFNZXRhRGF0YShtZXRhID0+IHtcbiAgICAgICAgY29uc3QgbmV3QXJyID0gQXJyYXkuaXNBcnJheShlZGl0TG9nKSA/IGVkaXRMb2cgOiBwYXJzZUVkaXRMb2coZWRpdExvZyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJyxcbiAgICAgICAgICBg5YeG5aSH5Li6IE1LPSR7TUt9IChNc2dJRD0ke21lc3NhZ2VJZH0pIOWGmeWFpSBFZGl0TG9nOlxcbiR7SlNPTi5zdHJpbmdpZnkobmV3QXJyLCBudWxsLCAyKX1gLFxuICAgICAgICApO1xuICAgICAgICAvLyDlsIbmnKzova7nlJ/miJDnmoTml6Xlv5fmlbDnu4TvvIzku6XlvZPliY3mtojmga/nmoQgTUsg5Li66ZSu77yM5a2Y5YWlIGBFZGl0TG9nc2Ag5a+56LGh44CCXG4gICAgICAgIF8uc2V0KG1ldGEsIFtMT0dTX1BBVEgsIE1LXSwgSlNPTi5zdHJpbmdpZnkobmV3QXJyKSk7XG4gICAgICAgIC8qXG4gICAgICAgICAqIE4uQi4g5q2k5Ye95pWw5LiN5YaN6LSf6LSj5pu05pawIFNlbGVjdGVkTWtzIOaVsOe7hOOAglxuICAgICAgICAgKiDmm7TmlrAgU2VsZWN0ZWRNa3Mg55qE6IGM6LSj5bey56e75Lqk6Iez5LiK5bGC6LCD55So6ICFIChyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSDmiJYgQXBwbHlWYXJDaGFuZ2Up77yMXG4gICAgICAgICAqIOS7pemBv+WFjeWcqCByZXN5bmMg5b6q546v5Lit5oSP5aSW5L+u5pS55q2j5Zyo6KKr6K+75Y+W55qEIG9sZFNlbGVjdGVkTWtzIOeKtuaAgeOAglxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIG1ldGE7XG4gICAgICB9KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOaIkOWKn+S4uiBNSz0ke01LfSDlhpnlhaUgRWRpdExvZ+OAgmApO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5Li6IE1LPSR7TUt9IOWGmeWFpSBFZGl0TG9ncyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgIH1cblxuICAgIHJldHVybiBNSztcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDlj5jph4/lhpnlhaXlmajlvILluLg6ICR7ZXJyPy5tZXNzYWdlIHx8IGVycn1gLCBlcnIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5qCH5YeG5LqL5Lu25aSE55CG5YWl5Y+j44CRKipcbiAqIOi/meaYr+S4gOS4quS4iuWxguWwgeijhe+8jOeUqOS6juWkhOeQhuacgOaWsCBBSSDmtojmga/nmoTlj5jph4/lhpnlhaXvvIzlubbotJ/otKPmm7TmlrAgYFNlbGVjdGVkTWtzYCDmlbDnu4TjgIJcbiAqIOWug+S8muiHquWKqOWvu+aJvuacgOWQjuS4gOadoSBBSSDmtojmga/ov5vooYzmk43kvZzvvIzpgJrluLjooqvnu5HlrprliLDigJzmlrDmtojmga/nlJ/miJDigJ3nrYnkuovku7bkuIrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEFwcGx5VmFyQ2hhbmdlID0gYXN5bmMgKCkgPT4ge1xuICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlJywgYOWHveaVsOiiq+iwg+eUqC4uLmApO1xuICAvLyAxLiDmmbrog73mn6Xmib7mnIDlkI7kuIDmnaEgQUkg5raI5oGvXG4gIGNvbnN0IG1zZyA9IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICBsb2dnZXIubG9nKCdBcHBseVZhckNoYW5nZScsICfmnKrmib7liLDlj6/lpITnkIbnmoQgQUkg5raI5oGv77yM6YCA5Ye644CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gIGxvZ2dlci5sb2coJ0FwcGx5VmFyQ2hhbmdlJywgYOaJvuWIsOebruaghyBBSSDmtojmga8gKElEOiAke21lc3NhZ2VJZH0p77yM5byA5aeL5aSE55CG5Y+Y6YeP5YaZ5YWlLi4uYCk7XG5cbiAgLy8gMi4g6LCD55So5qC45b+D5a6e546w5p2l5aSE55CG5Y+Y6YeP5ZKMIEVkaXRMb2cg55qE5YaZ5YWl44CCXG4gIC8vIEVkaXRMb2cg5Lya6KKr6Ieq5Yqo5YWz6IGU5Yiw5LuO6K+l5raI5oGv5Lit6K+75Y+W5Yiw55qEIE1LIOS4iuOAglxuICBjb25zdCBNSyA9IGF3YWl0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZShtc2cpO1xuXG4gIC8vIDMuIOWcqOaguOW/g+a1geeoi+aJp+ihjOWujOavleWQju+8jOWcqOatpOWkhOe7n+S4gOabtOaWsCBTZWxlY3RlZE1rc++8jOehruS/neeKtuaAgeS4gOiHtOOAglxuICB0cnkge1xuICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgICAgLy8g5YWz6ZSu77ya5b+F6aG75L2/55So5oiR5Lus5q2j5Zyo5aSE55CG55qEIEFJIOa2iOaBr+eahCBtZXNzYWdlSWQg5L2c5Li657Si5byV77yMXG4gICAgICAvLyDmnaXmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uE5Lit5a+55bqU55qEIE1LIOiusOW9leOAglxuICAgICAgc2VsZWN0ZWRNa3NbbWVzc2FnZUlkXSA9IE1LO1xuICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbiAgICAgIHJldHVybiBtZXRhO1xuICAgIH0pO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlJywgYOabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/patcher.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/update.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/update.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyEditAtLevel: () => (/* binding */ applyEditAtLevel),\n/* harmony export */   processEditBlocks: () => (/* binding */ processEditBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger();\n/**\n * **【递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {Map<string, any>} intraMessageState - 用于跟踪在**同一条消息内部**对同一变量的连续修改。\n */\nasync function applyEditAtLevel(statData, basePath, patchObj, editLog, messageId, intraMessageState) {\n    // --- 1. 路径和存在性检查 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    // --- 2. 权限检查 (`updatable`) ---\n    // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n    const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n    // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n    const isBypassingProtection = isUpdatable === false && // 当前是受保护的\n        _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n    // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n    if (isUpdatable === false && !isBypassingProtection) {\n        logger.warn('applyEditAtLevel', `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`);\n        return; // 终止此分支的递归。\n    }\n    // --- 3. 递归或执行 ---\n    // 遍历指令的键，以驱动递归。\n    for (const key of Object.keys(patchObj)) {\n        const subPath = basePath ? `${basePath}.${key}` : key;\n        const valNew = patchObj[key];\n        // **策略一：递归深入**\n        // 如果指令的值是对象，则继续向内递归。\n        if (_.isPlainObject(valNew)) {\n            await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, intraMessageState);\n            continue; // 继续处理下一个键。\n        }\n        // **策略二：执行更新 (叶子节点)**\n        // 只有当指令的值不是对象时，才执行更新操作。\n        // 路径合法性检查：确保要写入的完整路径是存在的。\n        if (!_.has(statData, subPath)) {\n            logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`);\n            continue;\n        }\n        // a. 查找旧值 (`valOld`)\n        // 这是确保回滚准确性的核心。\n        logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n        let valOld = await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.findLatestNewValue)(subPath, messageId);\n        if (valOld === null) {\n            valOld = _.get(statData, subPath);\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`);\n        }\n        else {\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n        }\n        const cleaned = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.sanitizeArrays)(valNew); // 清理新值\n        // b. 记录编辑意图\n        // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n        // 这对于调试和历史追溯非常有用。\n        _.set(statData, subPath, cleaned);\n        editLog.push({\n            op: 'update',\n            path: subPath,\n            value_old: _.cloneDeep(valOld),\n            value_new: _.cloneDeep(cleaned),\n        });\n        // c. 更新楼内状态 Map，以便同一消息内的后续操作能正确追溯到这个新值。\n        intraMessageState.set(subPath, _.cloneDeep(cleaned));\n    }\n}\n/**\n * 处理所有 `<VariableEdit>` 指令块。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n */\nasync function processEditBlocks(allEdits, editLog, messageId) {\n    if (allEdits.length > 0) {\n        const intraMessageState = new Map(); // 用于跟踪在**本消息内部**对变量的连续修改。\n        // N.B. 同样，编辑操作也需要独立调用以确保能读取到同一消息中、此前已完成的插入或编辑操作的结果。\n        for (const editRoot of allEdits) {\n            if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n                    logger.debug('processEditBlocks', `处理 editRoot: ${JSON.stringify(editRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n                    await applyEditAtLevel(stat, '', editRoot, editLog, messageId, intraMessageState);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processEditBlocks', '所有 VariableEdit 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC91cGRhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFDVTtBQUVxQztBQUNPO0FBQ2hCO0FBQ1E7QUFFakQsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxFQUFFLENBQUM7QUFFNUI7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBQ0ksS0FBSyxVQUFVLGdCQUFnQixDQUNwQyxRQUFhLEVBQ2IsUUFBZ0IsRUFDaEIsUUFBYSxFQUNiLE9BQWMsRUFDZCxTQUFpQixFQUNqQixpQkFBbUM7SUFFbkMsc0JBQXNCO0lBQ3RCLE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQzFFLElBQUksaUJBQWlCLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSw0QkFBNEIsUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDcEYsT0FBTztJQUNULENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsMENBQTBDO0lBQzFDLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFM0Usc0RBQXNEO0lBQ3RELE1BQU0scUJBQXFCLEdBQ3pCLFdBQVcsS0FBSyxLQUFLLElBQUksVUFBVTtRQUNuQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLHFCQUFxQjtJQUV6RSw0QkFBNEI7SUFDNUIsSUFBSSxXQUFXLEtBQUssS0FBSyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNwRCxNQUFN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LEtBQUssTUFBTSxRQUFRLElBQUksUUFBUSxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQUUsU0FBUztZQUNoRSxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxLQUFLLEVBQUMsSUFBSSxFQUFDLEVBQUU7b0JBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUM5RSw0QkFBNEI7b0JBQzVCLE1BQU0sZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO29CQUNsRixPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO2dCQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdFLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFELENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9jcnVkL3VwZGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/nvJbovpHmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5L+u5pS577yM5bm255Sf5oiQ55So5LqO5Zue5rua55qE57K+56GuIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq6IGM6LSj5Y2V5LiAKio6IOaooeWdl+WPquWFs+W/g+WmguS9leagueaNruaMh+S7pOS/ruaUueWPmOmHj+eKtuaAgeW5tueUn+aIkOaXpeW/l++8jOS4jeWFs+W/g+aMh+S7pOS7juS9leiAjOadpeOAglxuICogLSAqKueyvuehruaXpeW/lyoqOiBgRWRpdExvZ2Ag55qE5YeG56Gu5oCn5piv5Zue5rua5Yqf6IO955qE5Z+656GA44CCYGFwcGx5RWRpdEF0TGV2ZWxgIOmAmui/h+eyvuW3p+eahOmAu+i+ke+8jFxuICogICDnibnliKvmmK/lr7nigJzml6flgLzigJ3nmoTljoblj7Lov73muq/vvIznoa7kv53kuobml6Xlv5fnmoTnu53lr7nlj6/pnaDjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V57yW6L6R5LiN5a2Y5Zyo55qE6Lev5b6E77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHNhbml0aXplQXJyYXlzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBmaW5kTGF0ZXN0TmV3VmFsdWUgfSBmcm9tICcuLi9yb2xsYmFjayc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLyoqXG4gKiAqKuOAkOmAkuW9kue8lui+keOAkSoqXG4gKiDlrp7njrDkuoYgYDxWYXJpYWJsZUVkaXQ+YCDnmoTmoLjlv4PpgLvovpHvvJoqKuWPquS/ruaUueW3suWtmOWcqOeahOi3r+W+hCoq44CCXG4gKlxuICogKirmoLjlv4Pop4TliJkqKjpcbiAqIDEuICoq6Lev5b6E5b+F6aG75a2Y5ZyoKirjgILlpoLmnpzmjIfku6TkuK3mjIflrprnmoTot6/lvoTlnKjlvZPliY3lj5jph4/nirbmgIHkuK3kuI3lrZjlnKjvvIzliJnot7Pov4for6Xmk43kvZzjgIJcbiAqIDIuICoq5Y+25a2Q6IqC54K55pON5L2cKirjgILlj6rlnKjpgYfliLDmjIfku6Tlr7nosaHkuK3nmoTlj7blrZDoioLngrnvvIjpnZ7lr7nosaHlgLzvvInml7bmiY3miafooYzlrp7pmYXnmoTkv67mlLnlkozml6Xlv5forrDlvZXjgIJcbiAqIDMuICoq57K+56Gu55qE5pen5YC85p+l5om+KirjgILkuLrkuobnlJ/miJDlj6/kvpvlm57mu5rnmoQgYEVkaXRMb2dg77yM5a6D6ZyA6KaB5om+5Yiw5Y+Y6YeP5Zyo5pys5qyh5L+u5pS55Y+R55SfKirkuYvliY0qKueahOKAnOaXp+WAvOKAneOAglxuICogICAg5p+l5om+6aG65bqP5Li677ya6aaW5YWI6YCa6L+HIGBmaW5kTGF0ZXN0TmV3VmFsdWVgIOWcqOWOhuWPsiBgRWRpdExvZ2Ag5Lit5Zue5rqv77yb5aaC5p6c5om+5LiN5Yiw77yMXG4gKiAgICDliJnku47lvZPliY3mtojmga/lpITnkIblvIDlp4vml7bnmoTlj5jph4/lv6vnhafkuK3ojrflj5bjgILov5nmmK/noa7kv53ml6Xlv5flh4bnoa7mgKfnmoTlhbPplK7jgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g6KaB5bqU55So55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE44CCXG4gKiBAcGFyYW0ge251bWJlcn0gbWVzc2FnZUlkIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE5raI5oGv55qEIElE77yM55So5LqO5Y6G5Y+y6L+95rqv44CCXG4gKiBAcGFyYW0ge01hcDxzdHJpbmcsIGFueT59IGludHJhTWVzc2FnZVN0YXRlIC0g55So5LqO6Lef6Liq5ZyoKirlkIzkuIDmnaHmtojmga/lhoXpg6gqKuWvueWQjOS4gOWPmOmHj+eahOi/nue7reS/ruaUueOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlFZGl0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIG1lc3NhZ2VJZDogbnVtYmVyLFxuICBpbnRyYU1lc3NhZ2VTdGF0ZTogTWFwPHN0cmluZywgYW55Pixcbikge1xuICAvLyAtLS0gMS4g6Lev5b6E5ZKM5a2Y5Zyo5oCn5qOA5p+lIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseUVkaXRBdExldmVsJywgYFZhcmlhYmxlRWRpdCDot7Pov4fvvJrot6/lvoTkuI3lrZjlnKggLT4gJHtiYXNlUGF0aCB8fCAnKHJvb3QpJ31gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAtLS0gMi4g5p2D6ZmQ5qOA5p+lIChgdXBkYXRhYmxlYCkgLS0tXG4gIC8vIOivu+WPliB1cGRhdGFibGUg5qCH5b+X77yM5aaC5p6c5pyq5a6a5LmJ77yM5YiZ6buY6K6k5Li6IHRydWUgKOWFgeiuuOabtOaWsCnjgIJcbiAgY29uc3QgaXNVcGRhdGFibGUgPSBfLmdldChjdXJyZW50Tm9kZUluVmFycywgWyckbWV0YScsICd1cGRhdGFibGUnXSwgdHJ1ZSk7XG5cbiAgLy8g5a6a5LmJ6LGB5YWN5p2h5Lu277ya5Y+q5pyJ5b2T5oyH5Luk5piO56Gu6KaB5bCGIHVwZGF0YWJsZSDku44gZmFsc2Ug5pS55Li6IHRydWUg5pe277yM5omN5YWB6K645pON5L2c44CCXG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgaXNVcGRhdGFibGUgPT09IGZhbHNlICYmIC8vIOW9k+WJjeaYr+WPl+S/neaKpOeahFxuICAgIF8uZ2V0KHBhdGNoT2JqLCBbJyRtZXRhJywgJ3VwZGF0YWJsZSddKSA9PT0gdHJ1ZTsgLy8g5LiU5oyH5Luk5oSP5Zu+5piv5piO56Gu5Zyw5bCG5YW25pS55Li6IHRydWVcblxuICAvLyDlpoLmnpzlj5fkv53miqTkuJTkuI3mu6HotrPosYHlhY3mnaHku7bvvIzliJnpmLvmraLmlbTkuKrlrZDmoJHnmoTmm7TmlrDjgIJcbiAgaWYgKGlzVXBkYXRhYmxlID09PSBmYWxzZSAmJiAhaXNCeXBhc3NpbmdQcm90ZWN0aW9uKSB7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hCA8JHtiYXNlUGF0aH0+IOWPlyBcIiRtZXRhLnVwZGF0YWJsZTogZmFsc2VcIiDkv53miqTvvIzml6Dms5Xooqvkv67mlLnjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuOyAvLyDnu4jmraLmraTliIbmlK/nmoTpgJLlvZLjgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDpgJLlvZLmiJbmiafooYwgLS0tXG4gIC8vIOmBjeWOhuaMh+S7pOeahOmUru+8jOS7pempseWKqOmAkuW9kuOAglxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICBjb25zdCBzdWJQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICBjb25zdCB2YWxOZXcgPSBwYXRjaE9ialtrZXldO1xuXG4gICAgLy8gKirnrZbnlaXkuIDvvJrpgJLlvZLmt7HlhaUqKlxuICAgIC8vIOWmguaenOaMh+S7pOeahOWAvOaYr+Wvueixoe+8jOWImee7p+e7reWQkeWGhemAkuW9kuOAglxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QodmFsTmV3KSkge1xuICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0RGF0YSwgc3ViUGF0aCwgdmFsTmV3LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDnu6fnu63lpITnkIbkuIvkuIDkuKrplK7jgIJcbiAgICB9XG5cbiAgICAvLyAqKuetlueVpeS6jO+8muaJp+ihjOabtOaWsCAo5Y+25a2Q6IqC54K5KSoqXG4gICAgLy8g5Y+q5pyJ5b2T5oyH5Luk55qE5YC85LiN5piv5a+56LGh5pe277yM5omN5omn6KGM5pu05paw5pON5L2c44CCXG5cbiAgICAvLyDot6/lvoTlkIjms5XmgKfmo4Dmn6XvvJrnoa7kv53opoHlhpnlhaXnmoTlrozmlbTot6/lvoTmmK/lrZjlnKjnmoTjgIJcbiAgICBpZiAoIV8uaGFzKHN0YXREYXRhLCBzdWJQYXRoKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hOmdnuazle+8jOaXoOazleWGmeWFpSAtPiAke3N1YlBhdGh9YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBhLiDmn6Xmib7ml6flgLwgKGB2YWxPbGRgKVxuICAgIC8vIOi/meaYr+ehruS/neWbnua7muWHhuehruaAp+eahOaguOW/g+OAglxuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDlh4blpIfkuLrot6/lvoQgPCR7c3ViUGF0aH0+IOS7jua2iOaBryBJRCA8JHttZXNzYWdlSWR9PiDlkJHkuIrov73muq8uLi5gKTtcbiAgICBsZXQgdmFsT2xkID0gYXdhaXQgZmluZExhdGVzdE5ld1ZhbHVlKHN1YlBhdGgsIG1lc3NhZ2VJZCk7XG4gICAgaWYgKHZhbE9sZCA9PT0gbnVsbCkge1xuICAgICAgdmFsT2xkID0gXy5nZXQoc3RhdERhdGEsIHN1YlBhdGgpO1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICAgIGBb5pen5YC85p+l5om+XSDov73muq/mnKrmib7liLDljoblj7LlgLzvvIzku47lvZPliY0gc3RhdF9kYXRhIOS4reiOt+WPluWIsOaXp+WAvDogJHtKU09OLnN0cmluZ2lmeSh2YWxPbGQpfWAsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgW+aXp+WAvOafpeaJvl0g6L+95rqv5oiQ5Yqf77yM5om+5Yiw5Y6G5Y+y5pen5YC8OiAke0pTT04uc3RyaW5naWZ5KHZhbE9sZCl9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYW5lZCA9IHNhbml0aXplQXJyYXlzKHZhbE5ldyk7IC8vIOa4heeQhuaWsOWAvFxuXG4gICAgLy8gYi4g6K6w5b2V57yW6L6R5oSP5Zu+XG4gICAgLy8g5Y2z5L2/5paw5pen5YC855u45ZCM77yM5Lmf6K6w5b2VIEVkaXRMb2fvvIzku6XlrozmlbTlj43mmKDkvZzogIXnmoTnvJbovpHmhI/lm77jgIJcbiAgICAvLyDov5nlr7nkuo7osIPor5Xlkozljoblj7Lov73muq/pnZ7luLjmnInnlKjjgIJcbiAgICBfLnNldChzdGF0RGF0YSwgc3ViUGF0aCwgY2xlYW5lZCk7XG4gICAgZWRpdExvZy5wdXNoKHtcbiAgICAgIG9wOiAndXBkYXRlJyxcbiAgICAgIHBhdGg6IHN1YlBhdGgsXG4gICAgICB2YWx1ZV9vbGQ6IF8uY2xvbmVEZWVwKHZhbE9sZCksXG4gICAgICB2YWx1ZV9uZXc6IF8uY2xvbmVEZWVwKGNsZWFuZWQpLFxuICAgIH0pO1xuICAgIC8vIGMuIOabtOaWsOalvOWGheeKtuaAgSBNYXDvvIzku6Xkvr/lkIzkuIDmtojmga/lhoXnmoTlkI7nu63mk43kvZzog73mraPnoa7ov73muq/liLDov5nkuKrmlrDlgLzjgIJcbiAgICBpbnRyYU1lc3NhZ2VTdGF0ZS5zZXQoc3ViUGF0aCwgXy5jbG9uZURlZXAoY2xlYW5lZCkpO1xuICB9XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk5Z2X44CCXG4gKlxuICogQHBhcmFtIHthbnlbXX0gYWxsRWRpdHMgLSDku47mtojmga/kuK3op6PmnpDlh7rnmoTmiYDmnIkgZWRpdCDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtZXNzYWdlSWQgLSDlvZPliY3mraPlnKjlpITnkIbnmoTmtojmga/nmoQgSUTjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NFZGl0QmxvY2tzKGFsbEVkaXRzOiBhbnlbXSwgZWRpdExvZzogYW55W10sIG1lc3NhZ2VJZDogbnVtYmVyKSB7XG4gIGlmIChhbGxFZGl0cy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgaW50cmFNZXNzYWdlU3RhdGUgPSBuZXcgTWFwPHN0cmluZywgYW55PigpOyAvLyDnlKjkuo7ot5/ouKrlnKgqKuacrOa2iOaBr+WGhemDqCoq5a+55Y+Y6YeP55qE6L+e57ut5L+u5pS544CCXG4gICAgLy8gTi5CLiDlkIzmoLfvvIznvJbovpHmk43kvZzkuZ/pnIDopoHni6znq4vosIPnlKjku6Xnoa7kv53og73or7vlj5bliLDlkIzkuIDmtojmga/kuK3jgIHmraTliY3lt7LlrozmiJDnmoTmj5LlhaXmiJbnvJbovpHmk43kvZznmoTnu5PmnpzjgIJcbiAgICBmb3IgKGNvbnN0IGVkaXRSb290IG9mIGFsbEVkaXRzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChlZGl0Um9vdCkgfHwgXy5pc0VtcHR5KGVkaXRSb290KSkgY29udGludWU7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShhc3luYyBzdGF0ID0+IHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NFZGl0QmxvY2tzJywgYOWkhOeQhiBlZGl0Um9vdDogJHtKU09OLnN0cmluZ2lmeShlZGl0Um9vdCl9YCk7XG4gICAgICAgICAgLy8g5LuO5qC56Lev5b6EICcnIOW8gOWni+e7n+S4gOmAkuW9kuWFpeWPo++8jOS/neaMgemAu+i+keS4gOiHtOaAp+OAglxuICAgICAgICAgIGF3YWl0IGFwcGx5RWRpdEF0TGV2ZWwoc3RhdCwgJycsIGVkaXRSb290LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgICAgICByZXR1cm4gc3RhdDtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdwcm9jZXNzRWRpdEJsb2NrcycsIGDlpITnkIYgZWRpdFJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0VkaXRCbG9ja3MnLCAn5omA5pyJIFZhcmlhYmxlRWRpdCDmk43kvZzlrozmiJAnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/update.ts\n\n}");
  },
  "./src/ERA变量框架/core/key/mk.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/core/key/mk.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureMessageKey: () => (/* binding */ ensureMessageKey),\n/* harmony export */   ensureMkForLatestMessage: () => (/* binding */ ensureMkForLatestMessage),\n/* harmony export */   readMessageKey: () => (/* binding */ readMessageKey),\n/* harmony export */   updateLatestSelectedMk: () => (/* binding */ updateLatestSelectedMk)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `\x3c!-- --\x3e`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger();\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            return {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n        }\n        return null;\n    }\n    catch {\n        return null;\n    }\n}\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nfunction readMessageKey(msg) {\n    if (!msg)\n        return '';\n    // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n    const content = (0,_utils_message__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(msg);\n    const mk = parseEraData(content)?.['era-message-key'] || '';\n    // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n    // 以强制 ensureMessageKey 生成新的 MK。\n    return mk;\n    /*\n     * ==================================================================\n     * 【已废弃的兼容逻辑】 - 2025/10/02\n     *\n     * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n     * 因此 MK 可能存在于任何一个 swipe 中。\n     *\n     * **废弃原因**:\n     * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n     * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n     * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n     * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n     *\n     * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n     * ==================================================================\n     */\n    // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n    // if (mkFromCurrent) {\n    //   return mkFromCurrent;\n    // }\n    // if (Array.isArray(msg.swipes)) {\n    //   for (const swipeContent of msg.swipes) {\n    //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n    //     if (mkFromSwipe) {\n    //       return mkFromSwipe;\n    //     }\n    //   }\n    // }\n    // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n    // if (mkFromMessage) {\n    //   return mkFromMessage;\n    // }\n    // return '';\n}\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nasync function ensureMessageKey(msg) {\n    if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n        logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。msg=${JSON.stringify(msg)}`);\n        return { mk: '', isNew: false };\n    }\n    // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n    const existingMk = readMessageKey(msg);\n    if (existingMk) {\n        return { mk: existingMk, isNew: false }; // 已存在，直接返回\n    }\n    // 2. 生成新的 MK 和元数据块\n    const newMk = `era_mk_${Date.now()}_${(0,_utils_string__WEBPACK_IMPORTED_MODULE_4__.rnd)()}`;\n    const messageType = msg.role === 'user' ? 'user' : 'assistant';\n    const dataString = `<${_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_TAG}>`;\n    logger.log('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n    // 3. 构造新的消息内容并统一调用更新函数\n    const currentContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_3__.getMessageContent)(msg) ?? '';\n    const newContent = dataString + '\\n' + currentContent;\n    // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_3__.updateMessageContent)(msg, newContent);\n    return { mk: newMk, isNew: true };\n}\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nconst ensureMkForLatestMessage = async () => {\n    try {\n        const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n        // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n        logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg): ${JSON.stringify(msg)}`);\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出');\n            return { mk: '', message_id: null, isNewKey: false };\n        }\n        // ensureMessageKey 会返回最终的 MK 和一个布尔值\n        const { mk, isNew } = await ensureMessageKey(msg);\n        logger.log('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n        return { mk, message_id: msg.message_id, isNewKey: isNew };\n    }\n    catch (err) {\n        logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, err);\n        return { mk: '', message_id: null, isNewKey: false };\n    }\n};\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nconst updateLatestSelectedMk = async () => {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    if (!msg || typeof msg.message_id !== 'number')\n        return;\n    // 确保 MK 存在并获取它\n    const { mk: MK } = await ensureMessageKey(msg);\n    if (!MK)\n        return;\n    // 更新 ERAMetaData 中的 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraMetaData)(meta => {\n        const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n        // 只有在记录不一致时才执行写操作，以优化性能\n        if (selectedMks[msg.message_id] !== MK) {\n            selectedMks[msg.message_id] = MK;\n            _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n        }\n        return meta;\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUcsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsVUFBVSxLQUFLLFFBQVE7UUFBRSxPQUFPO0lBRXZELGVBQWU7SUFDZixNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0MsSUFBSSxDQUFDLEVBQUU7UUFBRSxPQUFPO0lBRWhCLG1DQUFtQztJQUNuQyxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzdCLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUMsd0JBQXdCO1FBQ3hCLElBQUksV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUN2QyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNqQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9rZXkvbWsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5raI5oGv5a+G6ZKlIChNSykg566h55CG5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOi/meS4quaooeWdl+aYryBFUkEg5qGG5p6255qE5Z+655+z77yM6LSf6LSj566h55CG4oCc5raI5oGv5a+G6ZKl4oCd77yITWVzc2FnZSBLZXksIE1L77yJ44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDnmoTmoLjlv4PkvJjlir/lnKjkuo7lhbbpsoHmo5LmgKfvvIzlroPpgJrov4flsIblj5jph4/nirbmgIHkuI4gU2lsbHlUYXZlcm4g5LiN56iz5a6a55qE5raI5oGv5Y+Y6YeP77yIbWVzc2FnZSB2YXJpYWJsZXPvvIlcbiAqIOino+iApuadpeWunueOsOi/meS4gOeCueOAgk1LIOato+aYr+WunueOsOino+iApueahOWFs+mUruOAglxuICpcbiAqIE1LIOaYr+S4gOS4queUsSAqKkVSQSDmoYbmnrboh6rouqsqKiDliqjmgIHnlJ/miJDlubYqKuazqOWFpeWIsOa2iOaBr+WGheWuueWtl+espuS4sumhtumDqCoq55qE5ZSv5LiA5qCH6K+G56ym44CCXG4gKiDlroPlsLHlg4/kuIDkuKrkuI3lj6/lj5jnmoTigJzplJrngrnigJ3vvIzpmo/mtojmga/lhoXlrrnmnKzouqvkuIDotbflrZjlnKjjgIJFUkEg55qE5omA5pyJ5qC45b+D6YC76L6R77yM5YyF5ous5Y+Y6YeP6L+96Liq44CBXG4gKiDlm57mu5rlkozlkIzmraXvvIzpg73lm7Tnu5XnnYDor4bliKvlkozmk43kvZzov5nkupvplJrngrnmnaXov5vooYzvvIzogIzkuI3mmK/kvp3otZbkuo7lj6/og73lj5HnlJ/plJnkvY3miJbooqvplJnor6/nu6fmib/nmoTmtojmga/lj5jph4/jgIJcbiAqXG4gKiAqKk1LIOagvOW8jyoqOlxuICogTUsg6KKr5YyF6KO55Zyo5LiA5Liq54us54m555qE44CB57G75Ly8IFhNTCDnmoQgYDxlcmFfZGF0YT5gIOagh+etvuS4re+8jOWFtuWGhemDqOaYr+S4gOenjSoq6Z2e5qCH5YeGKirnmoTnsbsgSlNPTiDmoLzlvI/vvIxcbiAqIOS9v+eUqCBgPWAg5L2c5Li65YiG6ZqU56ym77yM5Lul6YG/5YWN5LiOIEFJIOWPr+iDveeUn+aIkOeahOagh+WHhiBKU09OIOa3t+a3huOAglxuICogZS5nLiwgYDxlcmFfZGF0YT57XCJlcmEtbWVzc2FnZS1rZXlcIj1cImVyYV9ta18uLi5cIixcImVyYS1tZXNzYWdlLXR5cGVcIj1cInVzZXJcIn08L2VyYV9kYXRhPmBcbiAqIOi/meenjeiuvuiuoe+8iOiAjOS4jeaYr+eUqCBIVE1MIOazqOmHiiBgPCEtLSAtLT5g77yJ5piv5Li65LqG6Ziy5q2iIE1LIOiiq+WFtuS7luWPr+iDveenu+mZpOazqOmHiueahOiEmuacrOaXoOaEj+S4reegtOWdj+OAglxuICpcbiAqICoq5qC45b+D5Yqf6IO9Kio6XG4gKiAxLiAqKueUn+aIkOS4juazqOWFpSoqOiBgZW5zdXJlTWVzc2FnZUtleWAg5Ye95pWw56Gu5L+d5Lu75L2V6ZyA6KaB6L+96Liq55qE5raI5oGv6YO95oul5pyJ5LiA5LiqIE1L44CC5aaC5p6c5LiN5a2Y5Zyo77yMXG4gKiAgICDlroPkvJrnlJ/miJDkuIDkuKrmlrDnmoQgTUsg5bm25rOo5YWl5Yiw5raI5oGv5YaF5a6555qE5byA5aS044CCXG4gKiAyLiAqKuino+aekOS4juivu+WPlioqOiBgcmVhZE1lc3NhZ2VLZXlgIOWHveaVsOaPkOS+m+S6huS4gOS4quWPquivu+eahOaOpeWPo++8jOeUqOS6juS7jua2iOaBr+WGheWuueS4reino+aekOWHuiBNS+OAglxuICogMy4gKirlkIzmraXkv53pmpwqKjogYHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWtgIOetieWHveaVsOehruS/neaguOW/g+aVsOaNrue7k+aehCBgU2VsZWN0ZWRNa3NgIOS4juacgOaWsOeahFxuICogICAg5raI5oGv54q25oCB5L+d5oyB5LiA6Ie077yM5piv5qGG5p626Ieq5oSI6IO95Yqb55qE6YeN6KaB57uE5oiQ6YOo5YiG44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfREFUQV9SRUdFWCwgRVJBX0RBVEFfVEFHLCBTRUxfUEFUSCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBnZXRNZXNzYWdlQ29udGVudCwgdXBkYXRlTWVzc2FnZUNvbnRlbnQgfSBmcm9tICcuLi8uLi91dGlscy9tZXNzYWdlJztcbmltcG9ydCB7IHJuZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLyoqXG4gKiBAdHlwZSB7RXJhRGF0YX0gLSDlrprkuYnkuoblrZjlgqjlnKggYDxlcmFfZGF0YT5gIOWdl+S4reeahOWFg+aVsOaNrue7k+aehOOAglxuICovXG50eXBlIEVyYURhdGEgPSB7XG4gICdlcmEtbWVzc2FnZS1rZXknOiBzdHJpbmc7XG4gICdlcmEtbWVzc2FnZS10eXBlJzogJ3VzZXInIHwgJ2Fzc2lzdGFudCc7XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWGhemDqOi+heWKqeWHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICog5LuO5raI5oGv5YaF5a655a2X56ym5Liy5Lit6Kej5p6Q5Ye6IGBFcmFEYXRhYCDlr7nosaHjgILov5nmmK/kuIDkuKrlj6ror7vmk43kvZzjgIJcbiAqIEBwYXJhbSB7c3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZH0gbWVzc2FnZUNvbnRlbnQgLSDmtojmga/nmoTlhoXlrrnlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtFcmFEYXRhIHwgbnVsbH0g6Kej5p6Q5oiQ5Yqf5YiZ6L+U5ZueIGBFcmFEYXRhYCDlr7nosaHvvIzlkKbliJnov5Tlm54gbnVsbOOAglxuICovXG5mdW5jdGlvbiBwYXJzZUVyYURhdGEobWVzc2FnZUNvbnRlbnQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBFcmFEYXRhIHwgbnVsbCB7XG4gIGlmICh0eXBlb2YgbWVzc2FnZUNvbnRlbnQgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlQ29udGVudC5tYXRjaChFUkFfREFUQV9SRUdFWCk7XG4gIGlmICghbWF0Y2ggfHwgIW1hdGNoWzFdKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdHJ5IHtcbiAgICAvLyDnlLHkuo4gTUsg5Z2X5YaF6YOo5piv6Ieq5a6a5LmJ55qEIGB7XCJrZXlcIj1cInZhbHVlXCJ9YCDmoLzlvI/vvIzkuI3og73kvb/nlKggSlNPTi5wYXJzZeOAglxuICAgIC8vIOW/hemhu+S9v+eUqOato+WImeihqOi+vuW8j+i/m+ihjOWuveadvuWMuemFjeadpeaPkOWPlumUruWAvOOAglxuICAgIGNvbnN0IGN1c3RvbUZvcm1hdEJsb2NrID0gbWF0Y2hbMV07XG4gICAgY29uc3Qga2V5TWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS1rZXlcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuICAgIGNvbnN0IHR5cGVNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLXR5cGVcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuXG4gICAgaWYgKGtleU1hdGNoPy5bMV0gJiYgdHlwZU1hdGNoPy5bMV0pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdlcmEtbWVzc2FnZS1rZXknOiBrZXlNYXRjaFsxXSxcbiAgICAgICAgJ2VyYS1tZXNzYWdlLXR5cGUnOiB0eXBlTWF0Y2hbMV0gYXMgJ3VzZXInIHwgJ2Fzc2lzdGFudCcsXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDlr7zlh7rnmoTmoLjlv4Plh73mlbBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqICoq44CQ6K+75Y+WIE1L44CRKiog5LuO5LiA5Liq5raI5oGv5a+56LGh5Lit5Y+q6K+75Zyw5o+Q5Y+W5YW25raI5oGv5a+G6ZKl77yITUvvvInjgIJcbiAqIOi/meS4quWHveaVsOe7j+i/h+eJueWIq+S8mOWMlu+8jOS7peW6lOWvuea7keWKqO+8iHN3aXBl77yJ562J5Zy65pmv5LiL5raI5oGv5a+56LGh57uT5p6E5LiN5LiA6Ie055qE6Zeu6aKY44CCXG4gKiDlroPkvJrlhajpnaLmo4Dmn6Xmtojmga/nmoQgYG1lc2DjgIFgbWVzc2FnZWAg5Lul5Y+KIGBzd2lwZXNgIOaVsOe7hOS4reeahOavj+S4gOS4quWFg+e0oO+8jOebtOWIsOaJvuWIsOesrOS4gOS4quacieaViOeahCBNSyDkuLrmraLjgIJcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDmib7liLDnmoQgTUvvvJvlpoLmnpzkuI3lrZjlnKjvvIzliJnov5Tlm57nqbrlrZfnrKbkuLLjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYWRNZXNzYWdlS2V5KG1zZzogYW55KTogc3RyaW5nIHtcbiAgaWYgKCFtc2cpIHJldHVybiAnJztcblxuICAvLyDmoLjlv4PpgLvovpHvvJrlp4vnu4jkuJTku4XmoLnmja4gZ2V0TWVzc2FnZUNvbnRlbnQg55qE57uT5p6c5p2l6Kej5p6QIE1L44CCXG4gIGNvbnN0IGNvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpO1xuXG4gIGNvbnN0IG1rID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpPy5bJ2VyYS1tZXNzYWdlLWtleSddIHx8ICcnO1xuXG4gIC8vIOenu+mZpOmBjeWOhuWFtuS7liBzd2lwZXMg55qE6ZSZ6K+v6YC76L6R44CC5aaC5p6c5b2T5YmN5r+A5rS755qE5YaF5a655rKh5pyJIE1L77yM5bCx5b+F6aG76L+U5Zue56m65a2X56ym5Liy77yMXG4gIC8vIOS7peW8uuWItiBlbnN1cmVNZXNzYWdlS2V5IOeUn+aIkOaWsOeahCBNS+OAglxuICByZXR1cm4gbWs7XG5cbiAgLypcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAqIOOAkOW3suW6n+W8g+eahOWFvOWuuemAu+i+keOAkSAtIDIwMjUvMTAvMDJcbiAgICpcbiAgICog5Lul5LiL5Luj56CB5Z2X5piv5Li65LqG5YW85a655pen54mI6YWS6aaG55qE5LiA5Liq54m55oCn77ya5LiA5Liq5raI5oGv55qE5aSa5LiqIHN3aXBlIOWPr+iDveWFseS6q+WQjOS4gOS4quW6leWxgua2iOaBr+WPmOmHj++8jFxuICAgKiDlm6DmraQgTUsg5Y+v6IO95a2Y5Zyo5LqO5Lu75L2V5LiA5LiqIHN3aXBlIOS4reOAglxuICAgKlxuICAgKiAqKuW6n+W8g+WOn+WboCoqOlxuICAgKiDlnKjlvZPliY3nmoQgRVJBIOaetuaehOS4re+8jOavj+S4qiBzd2lwZSDpg73ooqvop4bkuLrni6znq4vnmoTlhoXlrrnjgILlpoLmnpzlvZPliY3mv4DmtLvnmoQgc3dpcGUg5YaF5a655Lit5rKh5pyJIE1L77yMXG4gICAqIOWwseaEj+WRs+edgOWug+aYr+S4gOS4quWFqOaWsOeahOOAgemcgOimgeiiq+i1i+S6iOaWsCBNSyDnmoTmtojmga/jgILmraTml7boi6Xnu6fnu63mn6Xmib7lubbov5Tlm57lhbbku5Ygc3dpcGUg55qE5penIE1L77yMXG4gICAqIOWwhuS8muWvvOiHtCBgZW5zdXJlTWVzc2FnZUtleWAg6ZSZ6K+v5Zyw6K6k5Li65paw5raI5oGv5bey5pyJIE1L77yM5LuO6ICM6Lez6L+H5b+F6KaB55qE4oCc55Sf5oiQ5pawIE1L4oCd5rWB56iL44CCXG4gICAqIOi/meato+aYr+WvvOiHtCBzd2lwZSDmlrDmtojmga/ml7bml6Dms5XmraPnoa7lhpnlhaXlj5jph4/nmoTmoLnmnKzljp/lm6DjgIJcbiAgICpcbiAgICog5Zug5q2k77yM6K+l5YW85a656YC76L6R5bey6KKr5rOo6YeK5o6J77yM5Lul56Gu5L+dIGByZWFkTWVzc2FnZUtleWAg55qE6KGM5Li65LiO5b2T5YmN5p625p6E55qE6K6+6K6h5oSP5Zu+5L+d5oyB5LiA6Ie044CCXG4gICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgKi9cbiAgLy8gY29uc3QgbWtGcm9tQ3VycmVudCA9IHBhcnNlRXJhRGF0YShjb250ZW50KT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gaWYgKG1rRnJvbUN1cnJlbnQpIHtcbiAgLy8gICByZXR1cm4gbWtGcm9tQ3VycmVudDtcbiAgLy8gfVxuICAvLyBpZiAoQXJyYXkuaXNBcnJheShtc2cuc3dpcGVzKSkge1xuICAvLyAgIGZvciAoY29uc3Qgc3dpcGVDb250ZW50IG9mIG1zZy5zd2lwZXMpIHtcbiAgLy8gICAgIGNvbnN0IG1rRnJvbVN3aXBlID0gcGFyc2VFcmFEYXRhKHN3aXBlQ29udGVudCk/LlsnZXJhLW1lc3NhZ2Uta2V5J107XG4gIC8vICAgICBpZiAobWtGcm9tU3dpcGUpIHtcbiAgLy8gICAgICAgcmV0dXJuIG1rRnJvbVN3aXBlO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjb25zdCBta0Zyb21NZXNzYWdlID0gcGFyc2VFcmFEYXRhKG1zZy5tZXNzYWdlKT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gaWYgKG1rRnJvbU1lc3NhZ2UpIHtcbiAgLy8gICByZXR1cm4gbWtGcm9tTWVzc2FnZTtcbiAgLy8gfVxuICAvLyByZXR1cm4gJyc7XG59XG5cbi8qKlxuICogKirjgJDnoa7kv50gTUsg5a2Y5Zyo44CRKipcbiAqIOi/meaYr+acrOaooeWdl+acgOaguOW/g+eahOWHveaVsOOAguWug+ajgOafpeS4gOS4qua2iOaBr+aYr+WQpuW3suaLpeaciSBNS++8jOWmguaenOWwmuacquaLpeacie+8jOWImeS4uuWFtueUn+aIkOS4gOS4quaWsOeahCBNSyDlubbms6jlhaXliLDmtojmga/lhoXlrrnkuK3jgIJcbiAqIOi/meaYr+ino+WGs+KAnOm4oeeUn+ibiy/om4vnlJ/puKHigJ3pl67popjnmoTlhbPplK7vvJrlnKjlr7nlj5jph4/ov5vooYzku7vkvZXmk43kvZzkuYvliY3vvIzlv4XpobvlhYjnoa7kv53mnInkuIDkuKrlj6/kvpvkvp3pmYTnmoTplJrngrnvvIhNS++8ieOAglxuICpcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g55uu5qCH5raI5oGv5a+56LGhICjlv4XpobvljIXlkKsgYG1lc3NhZ2VfaWRgLCBgcm9sZWAsIOS7peWPiiBgbWVzc2FnZWAg5oiWIGBzd2lwZXNgKeOAglxuICogQHJldHVybnMge1Byb21pc2U8e21rOiBzdHJpbmcsIGlzTmV3OiBib29sZWFufT59IOi/lOWbnuWMheWQqyBNSyDlkozkuIDkuKrluIPlsJTlgLznmoTlr7nosaHvvIzor6XluIPlsJTlgLzmjIfnpLrmmK/lkKbliJvlu7rkuobmlrDnmoQgTUvjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZU1lc3NhZ2VLZXkobXNnOiBhbnkpOiBQcm9taXNlPHsgbWs6IHN0cmluZzsgaXNOZXc6IGJvb2xlYW4gfT4ge1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInIHx8ICFtc2cucm9sZSkge1xuICAgIGxvZ2dlci53YXJuKCdlbnN1cmVNZXNzYWdlS2V5JywgYOaXoOaViOeahOa2iOaBr+Wvueixoee7k+aehO+8jOaXoOazleehruS/nUtleeOAgm1zZz0ke0pTT04uc3RyaW5naWZ5KG1zZyl9YCk7XG4gICAgcmV0dXJuIHsgbWs6ICcnLCBpc05ldzogZmFsc2UgfTtcbiAgfVxuXG4gIC8vIDEuIOS9v+eUqOWinuW8uueahCByZWFkTWVzc2FnZUtleSDmo4Dmn6XmmK/lkKblt7LlrZjlnKggTUtcbiAgY29uc3QgZXhpc3RpbmdNayA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG4gIGlmIChleGlzdGluZ01rKSB7XG4gICAgcmV0dXJuIHsgbWs6IGV4aXN0aW5nTWssIGlzTmV3OiBmYWxzZSB9OyAvLyDlt7LlrZjlnKjvvIznm7TmjqXov5Tlm55cbiAgfVxuXG4gIC8vIDIuIOeUn+aIkOaWsOeahCBNSyDlkozlhYPmlbDmja7lnZdcbiAgY29uc3QgbmV3TWsgPSBgZXJhX21rXyR7RGF0ZS5ub3coKX1fJHtybmQoKX1gO1xuICBjb25zdCBtZXNzYWdlVHlwZSA9IG1zZy5yb2xlID09PSAndXNlcicgPyAndXNlcicgOiAnYXNzaXN0YW50JztcbiAgY29uc3QgZGF0YVN0cmluZyA9IGA8JHtFUkFfREFUQV9UQUd9PntcImVyYS1tZXNzYWdlLWtleVwiPVwiJHtuZXdNa31cIixcImVyYS1tZXNzYWdlLXR5cGVcIj1cIiR7bWVzc2FnZVR5cGV9XCJ9PC8ke0VSQV9EQVRBX1RBR30+YDtcblxuICBsb2dnZXIubG9nKCdlbnN1cmVNZXNzYWdlS2V5JywgYOS4uua2iOaBryAoSUQ6ICR7bXNnLm1lc3NhZ2VfaWR9KSDms6jlhaXmlrDnmoRLZXk6ICR7bmV3TWt9YCk7XG5cbiAgLy8gMy4g5p6E6YCg5paw55qE5raI5oGv5YaF5a655bm257uf5LiA6LCD55So5pu05paw5Ye95pWwXG4gIGNvbnN0IGN1cnJlbnRDb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobXNnKSA/PyAnJztcbiAgY29uc3QgbmV3Q29udGVudCA9IGRhdGFTdHJpbmcgKyAnXFxuJyArIGN1cnJlbnRDb250ZW50O1xuXG4gIC8vIOS9v+eUqOS7jiB1dGlscy50cyDlr7zlhaXnmoTpgJrnlKjlh73mlbDmnaXmm7TmlrDmtojmga/vvIzor6Xlh73mlbDlt7LlsIHoo4XkuoblpITnkIYgc3dpcGVzIOeahOmAu+i+keOAglxuICBhd2FpdCB1cGRhdGVNZXNzYWdlQ29udGVudChtc2csIG5ld0NvbnRlbnQpO1xuXG4gIHJldHVybiB7IG1rOiBuZXdNaywgaXNOZXc6IHRydWUgfTtcbn1cblxuLyoqXG4gKiAqKuOAkOehruS/neacgOaWsOa2iOaBr+eahCBNS+OAkSoqXG4gKiDov5nmmK/kuIDkuKrkvr/mjbflh73mlbDvvIzkuJPpl6jnlKjkuo7noa7kv53lvZPliY3ogYrlpKnorrDlvZXkuK3nmoTmnIDlkI7kuIDmnaHmtojmga/mi6XmnIkgTUvjgIJcbiAqIOWug+mAmuW4uOWcqOebkeWQrOWIsOaWsOa2iOaBr+eUn+aIkOetieS6i+S7tuaXtuiiq+iwg+eUqO+8jOS7peehruS/neaWsOa2iOaBr+iDveiiqyBFUkEg57O757uf5q2j56Gu6L+96Liq44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bWs6IHN0cmluZywgbWVzc2FnZV9pZDogbnVtYmVyIHwgbnVsbCwgaXNOZXdLZXk6IGJvb2xlYW59Pn0g6L+U5Zue5YyF5ZCrIE1L44CB5raI5oGvIElEIOWSjOS4gOS4quW4g+WwlOWAvOeahOWvueixoe+8jOivpeW4g+WwlOWAvOaMh+ekuuaYr+WQpuWIm+W7uuS6huaWsOeahCBNS+OAglxuICovXG5leHBvcnQgY29uc3QgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlID0gYXN5bmMgKCk6IFByb21pc2U8e1xuICBtazogc3RyaW5nO1xuICBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsO1xuICBpc05ld0tleTogYm9vbGVhbjtcbn0+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBtc2cgPSBnZXRDaGF0TWVzc2FnZXMoLTEsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk/LlswXTtcbiAgICAvLyDkv53nlZnmraTml6Xlv5fvvIzlm6DkuLrlroPlr7nkuo7osIPor5Xkuovku7bop6blj5Hml7bnmoTmtojmga/nirbmgIHoh7PlhbPph43opoHjgIJcbiAgICBsb2dnZXIuZGVidWcoJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDojrflj5bliLDnmoTmnIDmlrDmtojmga/lr7nosaEgKG1zZyk6ICR7SlNPTi5zdHJpbmdpZnkobXNnKX1gKTtcblxuICAgIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UnLCAn5peg5rOV6K+75Y+W5pyA5paw5raI5oGv5oiW5YW2SUTvvIzpgIDlh7onKTtcbiAgICAgIHJldHVybiB7IG1rOiAnJywgbWVzc2FnZV9pZDogbnVsbCwgaXNOZXdLZXk6IGZhbHNlIH07XG4gICAgfVxuXG4gICAgLy8gZW5zdXJlTWVzc2FnZUtleSDkvJrov5Tlm57mnIDnu4jnmoQgTUsg5ZKM5LiA5Liq5biD5bCU5YC8XG4gICAgY29uc3QgeyBtaywgaXNOZXcgfSA9IGF3YWl0IGVuc3VyZU1lc3NhZ2VLZXkobXNnKTtcbiAgICBsb2dnZXIubG9nKCdlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UnLCBg5bey5Li65pyA5paw5raI5oGvICR7bXNnLm1lc3NhZ2VfaWR9IOehruS/nSBNSyDlrZjlnKjjgIIgKOaYr+WQpuaWsOW7ujogJHtpc05ld30pYCk7XG4gICAgcmV0dXJuIHsgbWssIG1lc3NhZ2VfaWQ6IG1zZy5tZXNzYWdlX2lkLCBpc05ld0tleTogaXNOZXcgfTtcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDnoa7kv51NS+aXtuW8guW4uDogJHtlcnI/Lm1lc3NhZ2UgfHwgZXJyfWAsIGVycik7XG4gICAgcmV0dXJuIHsgbWs6ICcnLCBtZXNzYWdlX2lkOiBudWxsLCBpc05ld0tleTogZmFsc2UgfTtcbiAgfVxufTtcblxuLyoqXG4gKiAqKuOAkOabtOaWsOacgOaWsOW3sumAiSBNS+OAkSoqXG4gKiDov5nmmK/kuIDkuKrigJzkv53pmanigJ3lh73mlbDvvIznlKjkuo7lnKjmr4/mrKHkuovku7blpITnkIbnmoTmnIDlkI7vvIzlvLrliLbmoKHlh4YgYFNlbGVjdGVkTWtzYCDmlbDnu4TkuK3lhbPkuo4qKuacgOaWsOa2iOaBryoq55qE6K6w5b2V44CCXG4gKiDlroPnoa7kv53ljbPkvb/lnKjlpI3mnYLnmoTlvILmraXmtYHnqIvkuK3vvIxgU2VsZWN0ZWRNa3NgIOeahOWwvumDqOS5n+Wni+e7iOS4juWunumZheeahOacgOaWsOa2iOaBr+S/neaMgeS4peagvOWQjOatpeOAglxuICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gKi9cbmV4cG9ydCBjb25zdCB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCBtc2cgPSBnZXRDaGF0TWVzc2FnZXMoLTEsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk/LlswXTtcbiAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykgcmV0dXJuO1xuXG4gIC8vIOehruS/nSBNSyDlrZjlnKjlubbojrflj5blroNcbiAgY29uc3QgeyBtazogTUsgfSA9IGF3YWl0IGVuc3VyZU1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKCFNSykgcmV0dXJuO1xuXG4gIC8vIOabtOaWsCBFUkFNZXRhRGF0YSDkuK3nmoQgU2VsZWN0ZWRNa3Mg5pWw57uEXG4gIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAvLyDlj6rmnInlnKjorrDlvZXkuI3kuIDoh7Tml7bmiY3miafooYzlhpnmk43kvZzvvIzku6XkvJjljJbmgKfog71cbiAgICBpZiAoc2VsZWN0ZWRNa3NbbXNnLm1lc3NhZ2VfaWRdICE9PSBNSykge1xuICAgICAgc2VsZWN0ZWRNa3NbbXNnLm1lc3NhZ2VfaWRdID0gTUs7XG4gICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgc2VsZWN0ZWRNa3MpO1xuICAgIH1cbiAgICByZXR1cm4gbWV0YTtcbiAgfSk7XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/key/mk.ts\n\n}");
  },
  "./src/ERA变量框架/core/rollback.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/core/rollback.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLatestNewValue: () => (/* binding */ findLatestNewValue),\n/* harmony export */   rollbackByMk: () => (/* binding */ rollbackByMk)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/**\n * @file ERA 变量框架 - 回滚与历史追溯模块\n * @description\n * 该模块提供了 ERA 框架“时间旅行”能力的核心实现。它负责根据 `EditLog` 精确地撤销变量修改，\n * 以及在需要时向上追溯历史以查找变量的旧值。\n *\n * **设计理念**:\n * - **可逆操作**: 所有的变量写入操作都必须是可逆的。`rollbackByMk` 函数通过读取 `EditLog`\n *   并执行反向操作（`insert` -> `unset`, `update` -> `set to value_old`）来保证这一点。\n * - **历史的权威性**: `EditLog` 是变量状态变迁的唯一真实记录。`findLatestNewValue` 函数\n *   体现了这一原则，它不信任任何临时的变量快照，而是通过回溯 `EditLog` 链来查找一个变量\n *   在特定时间点之前的真实值。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger();\n/**\n * **【回滚】**\n * 根据一个给定的消息密钥（MK），精确地撤销该消息所引入的所有变量变更。\n *\n * @param {string} MK - 要回滚的目标消息的密钥。\n * @param {boolean} [silent=false] - 是否为静默模式。在静默模式下，函数不会自己触发日志刷新，\n *   这在 `resyncStateOnHistoryChange` 等批量操作中非常有用，可以避免产生大量冗余日志。\n */\nasync function rollbackByMk(MK, silent = false) {\n    try {\n        logger.log('rollbackByMk', `开始回滚, MK=${MK}`);\n        await updateVariablesWith(v => {\n            const meta = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.META_DATA_PATH, {});\n            const stat = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, {});\n            const raw = _.get(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK]);\n            const arr = (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.parseEditLog)(raw);\n            if (!arr || !arr.length) {\n                logger.debug('rollbackByMk', `EditLog 为空或无效，跳过回滚。`);\n                return v;\n            }\n            // 关键：必须逆序遍历 EditLog 来执行回滚。\n            // 这确保了对同一变量的多次修改能够被正确地、按相反的顺序撤销。\n            for (let i = arr.length - 1; i >= 0; i--) {\n                const e = arr[i];\n                const op = String(e?.op || '').toLowerCase();\n                const path = String(e?.path || '');\n                if (!path)\n                    continue;\n                if (op === 'insert') {\n                    // 对于“插入”操作，回滚即为“删除”。\n                    _.unset(stat, path);\n                    continue;\n                }\n                if (op === 'update' || op === 'delete') {\n                    // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n                    if (typeof e?.value_old === 'undefined') {\n                        // 如果日志中没有记录旧值，最安全的回滚方式是直接删除该路径。\n                        _.unset(stat, path);\n                    }\n                    else {\n                        _.set(stat, path, _.cloneDeep(e.value_old));\n                    }\n                }\n            }\n            _.set(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, stat);\n            return v;\n        }, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.CHAT_SCOPE);\n        logger.log('rollbackByMk', `回滚完成：MK=${MK}`);\n    }\n    catch (e) {\n        logger.error('rollbackByMk', `回滚异常：MK=${MK} → ${e?.message || e}`, e);\n    }\n}\n/**\n * **【历史追溯】**\n * 向上追溯聊天历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是为 `applyEditAtLevel` 函数提供支持的关键辅助函数，用于在生成 `update` 日志时，\n * 准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID 的**前一条**消息开始向上查找。\n * @returns {Promise<any>} 返回找到的 `value_new`。如果追溯到聊天记录的开头都未找到，则返回 `null`。\n */\nasync function findLatestNewValue(path, startMessageId) {\n    logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息ID <${startMessageId}> 向上追溯历史值...`);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    if (!messages || messages.length < 1) {\n        logger?.debug('findLatestNewValue', `消息历史为空，无法追溯。`);\n        return null;\n    }\n    const startIndex = messages.findIndex(m => m.message_id === startMessageId);\n    if (startIndex === -1) {\n        logger?.warn('findLatestNewValue', `错误：在消息列表中未找到起始消息ID: ${startMessageId}`);\n        return null;\n    }\n    // 从起始消息的前一条开始，向上（向旧）遍历历史消息。\n    for (let i = startIndex - 1; i >= 0; i--) {\n        const message = messages[i];\n        const msgId = message?.message_id;\n        logger?.debug('findLatestNewValue', `[进度] 正在检查消息 (ID: ${msgId})，内容: \"${((0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(message) || '').substring(0, 100)}...\"`);\n        // 使用 isUserMessage 辅助函数，并检查 message_id\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.isUserMessage)(message) || typeof msgId !== 'number') {\n            continue;\n        }\n        const mk = (0,_key_mk__WEBPACK_IMPORTED_MODULE_5__.readMessageKey)(message);\n        if (!mk) {\n            logger?.debug('findLatestNewValue', `[进度] 消息 (ID: ${msgId}) 无 MK，跳过。`);\n            continue; // 跳过没有 MK 的 AI 消息。\n        }\n        const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_2__.getEraData)();\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.parseEditLog)(editLogRaw);\n        if (!editLog || editLog.length === 0) {\n            logger?.debug('findLatestNewValue', `[进度] MK ${mk} 的 EditLog 为空，跳过。`);\n            continue; // 跳过 EditLog 为空的。\n        }\n        logger?.debug('findLatestNewValue', `[进度] 正在检查 MK ${mk} 的 EditLog...\\n${(0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.J)(editLog)}`);\n        // 关键：从后向前遍历该消息的 EditLog，这样找到的第一个匹配项就是最新的。\n        for (let j = editLog.length - 1; j >= 0; j--) {\n            const logEntry = editLog[j];\n            if (!logEntry || !logEntry.path)\n                continue;\n            // Case 1: 精确路径匹配。\n            if (logEntry.path === path) {\n                // 如果在历史追溯中找到了 delete 记录，这意味着状态可能不一致。\n                // 因为 applyEditAtLevel 的前置检查应阻止对已删除变量的更新。\n                // 记录一个错误以供调试，并返回 null，因为该变量在逻辑上是不存在的。\n                if (logEntry.op === 'delete') {\n                    logger?.error('findLatestNewValue', `>> 状态异常! 在消息(ID:${message.message_id}, MK:${mk})中为路径 <${path}> 找到了 'delete' 记录。这表明 update 操作可能正在尝试修改一个已被删除的变量。`);\n                    return null;\n                }\n                logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到精确路径 <${path}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.J)(logEntry.value_new)}`);\n                return _.cloneDeep(logEntry.value_new);\n            }\n            // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n            // 例如, 查找 \"a.b.c\", 而日志中有对 \"a.b\" 的修改。\n            if (path.startsWith(logEntry.path + '.')) {\n                const subPath = path.substring(logEntry.path.length + 1);\n                const parentNewVal = logEntry.value_new;\n                if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n                    const foundVal = _.get(parentNewVal, subPath);\n                    logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.J)(foundVal)}`);\n                    return _.cloneDeep(foundVal);\n                }\n            }\n        }\n    }\n    // 如果追溯到聊天记录的开头都未找到，说明这是该变量的首次出现。\n    logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvcm9sbGJhY2sudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUU4RTtBQUMzQztBQUNEO0FBQ1Q7QUFDOEI7QUFDMUI7QUFFMUMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxFQUFFLENBQUM7QUFFNUI7Ozs7Ozs7R0FPRztBQUNJLEtBQUssVUFBVSxZQUFZLENBQUMsRUFBVSxFQUFFLE1BQU0sR0FBRyxLQUFLO0lBQzNELElBQUksQ0FBQztRQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM3QyxNQUFNLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzVCLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDREQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDMUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsNERBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUUxQyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLHVEQUFTLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QyxNQUFNLEdBQUcsR0FBRyx5REFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ3hCLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLHFCQUFxQixDQUFDLENBQUM7Z0JBQ3BELE9BQU8sQ0FBQyxDQUFDO1lBQ1gsQ0FBQztZQUVELDJCQUEyQjtZQUMzQixpQ0FBaUM7WUFDakMsS0FBSyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENB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O2dCQUN4QyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDbEUsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzlDLE1BQU0sRUFBRSxLQUFLLENBQ1gsb0JBQW9CLEVBQ3BCLGlCQUFpQixPQUFPLENBQUMsVUFBVSxRQUFRLEVBQUUsYUFBYSxRQUFRLENBQUMsSUFBSSxnQkFBZ0IsT0FBTyxVQUFVLDhDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDdEgsQ0FBQztvQkFDRixPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLElBQUksdUJBQXVCLENBQUMsQ0FBQztJQUM5RSxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3JvbGxiYWNrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWbnua7muS4juWOhuWPsui/vea6r+aooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmj5DkvpvkuoYgRVJBIOahhuaetuKAnOaXtumXtOaXheihjOKAneiDveWKm+eahOaguOW/g+WunueOsOOAguWug+i0n+i0o+agueaNriBgRWRpdExvZ2Ag57K+56Gu5Zyw5pKk6ZSA5Y+Y6YeP5L+u5pS577yMXG4gKiDku6Xlj4rlnKjpnIDopoHml7blkJHkuIrov73muq/ljoblj7Lku6Xmn6Xmib7lj5jph4/nmoTml6flgLzjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuWPr+mAhuaTjeS9nCoqOiDmiYDmnInnmoTlj5jph4/lhpnlhaXmk43kvZzpg73lv4XpobvmmK/lj6/pgIbnmoTjgIJgcm9sbGJhY2tCeU1rYCDlh73mlbDpgJrov4for7vlj5YgYEVkaXRMb2dgXG4gKiAgIOW5tuaJp+ihjOWPjeWQkeaTjeS9nO+8iGBpbnNlcnRgIC0+IGB1bnNldGAsIGB1cGRhdGVgIC0+IGBzZXQgdG8gdmFsdWVfb2xkYO+8ieadpeS/neivgei/meS4gOeCueOAglxuICogLSAqKuWOhuWPsueahOadg+WogeaApyoqOiBgRWRpdExvZ2Ag5piv5Y+Y6YeP54q25oCB5Y+Y6L+B55qE5ZSv5LiA55yf5a6e6K6w5b2V44CCYGZpbmRMYXRlc3ROZXdWYWx1ZWAg5Ye95pWwXG4gKiAgIOS9k+eOsOS6hui/meS4gOWOn+WIme+8jOWug+S4jeS/oeS7u+S7u+S9leS4tOaXtueahOWPmOmHj+W/q+eFp++8jOiAjOaYr+mAmui/h+Wbnua6ryBgRWRpdExvZ2Ag6ZO+5p2l5p+l5om+5LiA5Liq5Y+Y6YePXG4gKiAgIOWcqOeJueWumuaXtumXtOeCueS5i+WJjeeahOecn+WunuWAvOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgQ0hBVF9TQ09QRSwgTE9HU19QQVRILCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgSiwgcGFyc2VFZGl0TG9nIH0gZnJvbSAnLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBnZXRFcmFEYXRhIH0gZnJvbSAnLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IGdldE1lc3NhZ2VDb250ZW50LCBpc1VzZXJNZXNzYWdlIH0gZnJvbSAnLi4vdXRpbHMvbWVzc2FnZSc7XG5pbXBvcnQgeyByZWFkTWVzc2FnZUtleSB9IGZyb20gJy4va2V5L21rJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqICoq44CQ5Zue5rua44CRKipcbiAqIOagueaNruS4gOS4que7meWumueahOa2iOaBr+WvhumSpe+8iE1L77yJ77yM57K+56Gu5Zyw5pKk6ZSA6K+l5raI5oGv5omA5byV5YWl55qE5omA5pyJ5Y+Y6YeP5Y+Y5pu044CCXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IE1LIC0g6KaB5Zue5rua55qE55uu5qCH5raI5oGv55qE5a+G6ZKl44CCXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtzaWxlbnQ9ZmFsc2VdIC0g5piv5ZCm5Li66Z2Z6buY5qih5byP44CC5Zyo6Z2Z6buY5qih5byP5LiL77yM5Ye95pWw5LiN5Lya6Ieq5bex6Kem5Y+R5pel5b+X5Yi35paw77yMXG4gKiAgIOi/meWcqCBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOetieaJuemHj+aTjeS9nOS4remdnuW4uOacieeUqO+8jOWPr+S7pemBv+WFjeS6p+eUn+Wkp+mHj+WGl+S9meaXpeW/l+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcm9sbGJhY2tCeU1rKE1LOiBzdHJpbmcsIHNpbGVudCA9IGZhbHNlKSB7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmxvZygncm9sbGJhY2tCeU1rJywgYOW8gOWni+Wbnua7miwgTUs9JHtNS31gKTtcbiAgICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKHYgPT4ge1xuICAgICAgY29uc3QgbWV0YSA9IF8uZ2V0KHYsIE1FVEFfREFUQV9QQVRILCB7fSk7XG4gICAgICBjb25zdCBzdGF0ID0gXy5nZXQodiwgU1RBVF9EQVRBX1BBVEgsIHt9KTtcblxuICAgICAgY29uc3QgcmF3ID0gXy5nZXQobWV0YSwgW0xPR1NfUEFUSCwgTUtdKTtcbiAgICAgIGNvbnN0IGFyciA9IHBhcnNlRWRpdExvZyhyYXcpO1xuICAgICAgaWYgKCFhcnIgfHwgIWFyci5sZW5ndGgpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdyb2xsYmFja0J5TWsnLCBgRWRpdExvZyDkuLrnqbrmiJbml6DmlYjvvIzot7Pov4flm57mu5rjgIJgKTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgICB9XG5cbiAgICAgIC8vIOWFs+mUru+8muW/hemhu+mAhuW6j+mBjeWOhiBFZGl0TG9nIOadpeaJp+ihjOWbnua7muOAglxuICAgICAgLy8g6L+Z56Gu5L+d5LqG5a+55ZCM5LiA5Y+Y6YeP55qE5aSa5qyh5L+u5pS56IO95aSf6KKr5q2j56Gu5Zyw44CB5oyJ55u45Y+N55qE6aG65bqP5pKk6ZSA44CCXG4gICAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhcnJbaV07XG4gICAgICAgIGNvbnN0IG9wID0gU3RyaW5nKGU/Lm9wIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBwYXRoID0gU3RyaW5nKGU/LnBhdGggfHwgJycpO1xuICAgICAgICBpZiAoIXBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAgIGlmIChvcCA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAvLyDlr7nkuo7igJzmj5LlhaXigJ3mk43kvZzvvIzlm57mu5rljbPkuLrigJzliKDpmaTigJ3jgIJcbiAgICAgICAgICBfLnVuc2V0KHN0YXQsIHBhdGgpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcCA9PT0gJ3VwZGF0ZScgfHwgb3AgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgLy8g5a+55LqO4oCc5pu05paw4oCd5oiW4oCc5Yig6Zmk4oCd5pON5L2c77yM5Zue5rua5Y2z5Li65oGi5aSN5Yiw4oCc5pen5YC84oCd44CCXG4gICAgICAgICAgaWYgKHR5cGVvZiBlPy52YWx1ZV9vbGQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzml6Xlv5fkuK3msqHmnInorrDlvZXml6flgLzvvIzmnIDlronlhajnmoTlm57mu5rmlrnlvI/mmK/nm7TmjqXliKDpmaTor6Xot6/lvoTjgIJcbiAgICAgICAgICAgIF8udW5zZXQoc3RhdCwgcGF0aCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF8uc2V0KHN0YXQsIHBhdGgsIF8uY2xvbmVEZWVwKGUudmFsdWVfb2xkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIF8uc2V0KHYsIFNUQVRfREFUQV9QQVRILCBzdGF0KTtcbiAgICAgIHJldHVybiB2O1xuICAgIH0sIENIQVRfU0NPUEUpO1xuICAgIGxvZ2dlci5sb2coJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlrozmiJDvvJpNSz0ke01LfWApO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlvILluLjvvJpNSz0ke01LfSDihpIgJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gIH1cbn1cblxuLyoqXG4gKiAqKuOAkOWOhuWPsui/vea6r+OAkSoqXG4gKiDlkJHkuIrov73muq/ogYrlpKnljoblj7LvvIzmn6Xmib7mn5DkuKrlj5jph4/ot6/lvoTlnKjmjIflrprmtojmga/kuYvliY3nmoTmnIDlkI7kuIDkuKrlgLwgKGB2YWx1ZV9uZXdgKeOAglxuICog6L+Z5piv5Li6IGBhcHBseUVkaXRBdExldmVsYCDlh73mlbDmj5DkvpvmlK/mjIHnmoTlhbPplK7ovoXliqnlh73mlbDvvIznlKjkuo7lnKjnlJ/miJAgYHVwZGF0ZWAg5pel5b+X5pe277yMXG4gKiDlh4bnoa7lnLDorrDlvZXkuIsgYHZhbHVlX29sZGDjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOimgeafpeaJvueahOWPmOmHj+eahOWujOaVtOi3r+W+hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0TWVzc2FnZUlkIC0g5LuO5q2k5raI5oGvIElEIOeahCoq5YmN5LiA5p2hKirmtojmga/lvIDlp4vlkJHkuIrmn6Xmib7jgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59IOi/lOWbnuaJvuWIsOeahCBgdmFsdWVfbmV3YOOAguWmguaenOi/vea6r+WIsOiBiuWkqeiusOW9leeahOW8gOWktOmDveacquaJvuWIsO+8jOWImei/lOWbniBgbnVsbGDjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRMYXRlc3ROZXdWYWx1ZShwYXRoOiBzdHJpbmcsIHN0YXJ0TWVzc2FnZUlkOiBudW1iZXIpOiBQcm9taXNlPGFueT4ge1xuICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5byA5aeL5Li66Lev5b6EIDwke3BhdGh9PiDku47mtojmga9JRCA8JHtzdGFydE1lc3NhZ2VJZH0+IOWQkeS4iui/vea6r+WOhuWPsuWAvC4uLmApO1xuICBjb25zdCBtZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IGZhbHNlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA8IDEpIHtcbiAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5raI5oGv5Y6G5Y+y5Li656m677yM5peg5rOV6L+95rqv44CCYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBzdGFydEluZGV4ID0gbWVzc2FnZXMuZmluZEluZGV4KG0gPT4gbS5tZXNzYWdlX2lkID09PSBzdGFydE1lc3NhZ2VJZCk7XG4gIGlmIChzdGFydEluZGV4ID09PSAtMSkge1xuICAgIGxvZ2dlcj8ud2FybignZmluZExhdGVzdE5ld1ZhbHVlJywgYOmUmeivr++8muWcqOa2iOaBr+WIl+ihqOS4reacquaJvuWIsOi1t+Wni+a2iOaBr0lEOiAke3N0YXJ0TWVzc2FnZUlkfWApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8g5LuO6LW35aeL5raI5oGv55qE5YmN5LiA5p2h5byA5aeL77yM5ZCR5LiK77yI5ZCR5pen77yJ6YGN5Y6G5Y6G5Y+y5raI5oGv44CCXG4gIGZvciAobGV0IGkgPSBzdGFydEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZXNbaV07XG4gICAgY29uc3QgbXNnSWQgPSBtZXNzYWdlPy5tZXNzYWdlX2lkO1xuICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgIGBb6L+b5bqmXSDmraPlnKjmo4Dmn6Xmtojmga8gKElEOiAke21zZ0lkfSnvvIzlhoXlrrk6IFwiJHsoZ2V0TWVzc2FnZUNvbnRlbnQobWVzc2FnZSkgfHwgJycpLnN1YnN0cmluZygwLCAxMDApfS4uLlwiYCxcbiAgICApO1xuXG4gICAgLy8g5L2/55SoIGlzVXNlck1lc3NhZ2Ug6L6F5Yqp5Ye95pWw77yM5bm25qOA5p+lIG1lc3NhZ2VfaWRcbiAgICBpZiAoaXNVc2VyTWVzc2FnZShtZXNzYWdlKSB8fCB0eXBlb2YgbXNnSWQgIT09ICdudW1iZXInKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtayA9IHJlYWRNZXNzYWdlS2V5KG1lc3NhZ2UpO1xuICAgIGlmICghbWspIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSDmtojmga8gKElEOiAke21zZ0lkfSkg5pegIE1L77yM6Lez6L+H44CCYCk7XG4gICAgICBjb250aW51ZTsgLy8g6Lez6L+H5rKh5pyJIE1LIOeahCBBSSDmtojmga/jgIJcbiAgICB9XG5cbiAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gICAgY29uc3QgZWRpdExvZ1JhdyA9IF8uZ2V0KG1ldGFEYXRhLCBbTE9HU19QQVRILCBta10pO1xuICAgIGNvbnN0IGVkaXRMb2cgPSBwYXJzZUVkaXRMb2coZWRpdExvZ1Jhdyk7XG5cbiAgICBpZiAoIWVkaXRMb2cgfHwgZWRpdExvZy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSBNSyAke21rfSDnmoQgRWRpdExvZyDkuLrnqbrvvIzot7Pov4fjgIJgKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDot7Pov4cgRWRpdExvZyDkuLrnqbrnmoTjgIJcbiAgICB9XG4gICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYFvov5vluqZdIOato+WcqOajgOafpSBNSyAke21rfSDnmoQgRWRpdExvZy4uLlxcbiR7SihlZGl0TG9nKX1gKTtcblxuICAgIC8vIOWFs+mUru+8muS7juWQjuWQkeWJjemBjeWOhuivpea2iOaBr+eahCBFZGl0TG9n77yM6L+Z5qC35om+5Yiw55qE56ys5LiA5Liq5Yy56YWN6aG55bCx5piv5pyA5paw55qE44CCXG4gICAgZm9yIChsZXQgaiA9IGVkaXRMb2cubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgIGNvbnN0IGxvZ0VudHJ5ID0gZWRpdExvZ1tqXTtcbiAgICAgIGlmICghbG9nRW50cnkgfHwgIWxvZ0VudHJ5LnBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAvLyBDYXNlIDE6IOeyvuehrui3r+W+hOWMuemFjeOAglxuICAgICAgaWYgKGxvZ0VudHJ5LnBhdGggPT09IHBhdGgpIHtcbiAgICAgICAgLy8g5aaC5p6c5Zyo5Y6G5Y+y6L+95rqv5Lit5om+5Yiw5LqGIGRlbGV0ZSDorrDlvZXvvIzov5nmhI/lkbPnnYDnirbmgIHlj6/og73kuI3kuIDoh7TjgIJcbiAgICAgICAgLy8g5Zug5Li6IGFwcGx5RWRpdEF0TGV2ZWwg55qE5YmN572u5qOA5p+l5bqU6Zi75q2i5a+55bey5Yig6Zmk5Y+Y6YeP55qE5pu05paw44CCXG4gICAgICAgIC8vIOiusOW9leS4gOS4qumUmeivr+S7peS+m+iwg+ivle+8jOW5tui/lOWbniBudWxs77yM5Zug5Li66K+l5Y+Y6YeP5Zyo6YC76L6R5LiK5piv5LiN5a2Y5Zyo55qE44CCXG4gICAgICAgIGlmIChsb2dFbnRyeS5vcCA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICBsb2dnZXI/LmVycm9yKFxuICAgICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgICBgPj4g54q25oCB5byC5bi4ISDlnKjmtojmga8oSUQ6JHttZXNzYWdlLm1lc3NhZ2VfaWR9LCBNSzoke21rfSnkuK3kuLrot6/lvoQgPCR7cGF0aH0+IOaJvuWIsOS6hiAnZGVsZXRlJyDorrDlvZXjgILov5nooajmmI4gdXBkYXRlIOaTjeS9nOWPr+iDveato+WcqOWwneivleS/ruaUueS4gOS4quW3suiiq+WIoOmZpOeahOWPmOmHj+OAgmAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw57K+56Gu6Lev5b6EIDwke3BhdGh9PiDnmoTlgLzkuLo6ICR7Sihsb2dFbnRyeS52YWx1ZV9uZXcpfWAsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBfLmNsb25lRGVlcChsb2dFbnRyeS52YWx1ZV9uZXcpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYXNlIDI6IOafpeaJvueahOi3r+W+hOaYr+aXpeW/l+adoeebrui3r+W+hOeahOWtkOi3r+W+hCAo5Y2zIGxvZ0VudHJ5LnBhdGgg5piv54i257qnKeOAglxuICAgICAgLy8g5L6L5aaCLCDmn6Xmib4gXCJhLmIuY1wiLCDogIzml6Xlv5fkuK3mnInlr7kgXCJhLmJcIiDnmoTkv67mlLnjgIJcbiAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgobG9nRW50cnkucGF0aCArICcuJykpIHtcbiAgICAgICAgY29uc3Qgc3ViUGF0aCA9IHBhdGguc3Vic3RyaW5nKGxvZ0VudHJ5LnBhdGgubGVuZ3RoICsgMSk7XG4gICAgICAgIGNvbnN0IHBhcmVudE5ld1ZhbCA9IGxvZ0VudHJ5LnZhbHVlX25ldztcbiAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXJlbnROZXdWYWwpICYmIF8uaGFzKHBhcmVudE5ld1ZhbCwgc3ViUGF0aCkpIHtcbiAgICAgICAgICBjb25zdCBmb3VuZFZhbCA9IF8uZ2V0KHBhcmVudE5ld1ZhbCwgc3ViUGF0aCk7XG4gICAgICAgICAgbG9nZ2VyPy5kZWJ1ZyhcbiAgICAgICAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw54i257qn6Lev5b6EIDwke2xvZ0VudHJ5LnBhdGh9Piwg5bm25LuO5Lit5o+Q5Y+W5a2Q6Lev5b6EIDwke3N1YlBhdGh9PiDnmoTlgLzkuLo6ICR7Sihmb3VuZFZhbCl9YCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBfLmNsb25lRGVlcChmb3VuZFZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyDlpoLmnpzov73muq/liLDogYrlpKnorrDlvZXnmoTlvIDlpLTpg73mnKrmib7liLDvvIzor7TmmI7ov5nmmK/or6Xlj5jph4/nmoTpppbmrKHlh7rnjrDjgIJcbiAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYOWQkeS4iui/vea6r+acquaJvuWIsOi3r+W+hCAke3BhdGh9IOeahOS7u+S9leWOhuWPsuWAvO+8jOWwhuS9v+eUqCBudWxsIOS9nOS4uuaXp+WAvGApO1xuICByZXR1cm4gbnVsbDtcbn1cblxuLypcbiAqIOaXp+eahCBjYWxpYnJhdGUg5Ye95pWw77yM5YW25qC45b+D5oCd5oOz5bey6KKr5ZC45pS26L+bIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg55qE5L+d6Zmp5py65Yi25Lit44CCXG4gKiDmraTlpITnmoTms6jph4rooqvkv53nlZnvvIzlm6DkuLrlroPmnoHlpb3lnLDop6Pph4rkuoYgRVJBIOahhuaetuWmguS9leW3p+WmmeWcsOW6lOWvuSBTaWxseVRhdmVybiDnmoTkuIDkuKrmoLjlv4PigJzmgKrnmZbigJ3jgIJcbiAqXG4gKiAjIyMg5qCh5YeG5Li75rWB56iL77ya5q+U6L6D4oCc5b2T5YmN5raI5oGv4oCd5LiO4oCc5LiK5qyh6YCJ5Lit55qE5raI5oGv4oCd5bm25Yip55So6YWS6aaG55qE54m55oCn5ben5aaZ5Zyw5L+u5aSN5Y+Y6YeP54q25oCB44CCXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiDov5nmmK8gRVJBIOWPmOmHj+ahhuaetuacgOaguOW/g+eahOWHveaVsOS5i+S4gO+8jOWug+ino+WGs+S6huS4gOS4qumdnuW4uOajmOaJi+eahOmXrumimO+8mioq5Yig6ZmkIHN3aXBlIOaXtueahOWPmOmHj+eKtuaAgeiHquWKqOS/ruWkjSoq44CCXG4gKlxuICogKirphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1Zyk6KipcbiAqIOW9k+WIoOmZpOS4gOadoSBzd2lwZSAo5L6L5aaC77yM5bim5pyJ5Y+Y6YePIGlkPTIg55qE5raI5oGvKSDml7bvvJpcbiAqIDEuICoq5YaF5a655LiO5Y+Y6YeP6ZSZ5L2NKio6IOWQjuS4gOadoSBzd2lwZSAoaWQ9Mykg55qEKirlhoXlrrkqKuS8muKAnOmhtuKAneWIsOiiq+WIoOmZpOeahCBzd2lwZSAoaWQ9Mikg55qE5L2N572u5LiK77yM5L2GKirlj5jph48qKuWNtOS/neeVmeS6hiBpZD0yIOeahOWPmOmHj+OAglxuICogMi4gKirlraTlhL/lj5jph4/mrovnlZkqKjog5Y6f5pys55qEIHN3aXBlIDMg5raI5oGv6Jm954S25Zyo55WM6Z2i5LiK5raI5aSx5LqG77yM5L2G5a6D5a+55bqU55qEKirmtojmga/lj5jph48qKiAoaWQ9Mykg5LuN54S25q6L55WZ5Zyo6IGK5aSp5pWw5o2u5Lit77yM5oiQ5Li64oCc5a2k5YS/5Y+Y6YeP4oCd44CCXG4gKiAzLiAqKuWtpOWEv+WPmOmHj+e7p+aJvyoqOiDlpoLmnpznlKjmiLfmraTml7blho0gc3dpcGUg5LiA5qyh77yM5paw55Sf5oiQ55qEIHN3aXBlIDMg5bCG5LyaKirnu6fmib8qKui/meS4quaui+eVmeeahOWtpOWEv+WPmOmHjyAoaWQ9MynvvIzlr7zoh7TmlrDlhoXlrrnphY3ml6flj5jph4/vvIzov5vkuIDmraXliqDliafnirbmgIHmt7fkubHjgIJcbiAqIDQuICoq57uT5p6cKio6IOaIkeS7rOW+l+WIsOS6huS4gOS4quWGheWuueaYryBpZD0z44CB5Y+Y6YeP5pivIGlkPTIg55qE4oCc5re35ZCI4oCd5raI5oGv77yM5bm25LiU6L+Y5pyJ5LiA5LiqIGlkPTMg55qE5a2k5YS/5Y+Y6YeP6ZqP5pe25Y+v6IO96KKr5paw5raI5oGv57un5om/77yM6YCg5oiQ5Lil6YeN55qE54q25oCB5LiN5LiA6Ie044CCXG4gKiA1LiAqKuaXoOeJueWumuS6i+S7tioqOiDmraTlpJbvvIzov5nkuKrmk43kvZzkuI3kvJrop6blj5Hku7vkvZXni6znibnnmoTkuovku7bvvIzlj6rkvJrop6blj5EgYGNoYXRfaWRfY2hhbmdlZGAg562J6YCa55So5LqL5Lu244CCXG4gKlxuICogKirmnKzlh73mlbDnmoTmoKHlh4blt6forqE6KipcbiAqIOacrOWHveaVsOeyvuehruWcsOWIqeeUqOS6huS4iui/sOKAnOeKtuaAgemUmeS9jeKAneadpeWujOaIkOiHquWKqOS/ruWkje+8mlxuICogMS4gYGNhbGlicmF0ZWAg6KKrIGBjaGF0X2lkX2NoYW5nZWRgIOS6i+S7tuinpuWPkeOAglxuICogMi4g5a6D5qOA5rWL5YiwIGBvbGRNS2Ag5a2Y5ZyoICjlroPorrDlvZXkuobooqvliKDpmaTmtojmga/nmoQgTUvvvIzljbMgaWQ9MiDnmoQgTUsp44CCXG4gKiAzLiAqKuaJp+ihjOWbnua7mioqOiBgYXBwbHlSb2xsYmFja0J5TUsob2xkTUspYCDooqvosIPnlKjvvIzlsIYgaWQ9MiDlvJXlhaXnmoTlj5jph4/kv67mlLnlhajpg6jmkqTplIDjgIJcbiAqIDQuICoq6Kem5Y+R6YeN5YaZKio6IGBldmVudEVtaXQoJ3JvbGxiYWNrX2RvbmVfcmVhcHBseV92YXJfc3RhcnQnKWAg6KKr6Kem5Y+R44CCXG4gKiA1LiBgQXBwbHlWYXJDaGFuZ2VgIOWHveaVsOWTjeW6lOmHjeWGmeS6i+S7tu+8jOivu+WPlioq5b2T5YmNKirmtojmga/nmoQqKuWGheWuuSoqICjnjrDlnKjmmK8gaWQ9MyDnmoTlhoXlrrkp77yM5bm25qC55o2u5a6D6YeN5paw5YaZ5YWl5Y+Y6YeP44CCXG4gKlxuICogKirmnIDnu4jmlYjmnpwqKjog4oCc5Zue5rua5LqG5pen55qEKGlkPTIp77yM6YeN5YaZ5LqG5paw55qEKGlkPTMp4oCd77yM5Y+Y6YeP54q25oCB6KKr5a6M576O5Zyw6Ieq5Yqo5L+u5aSN44CCXG4gKi9cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/rollback.ts\n\n}");
  },
  "./src/ERA变量框架/core/sync.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/core/sync.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   resyncStateOnHistoryChange: () => (/* binding */ resyncStateOnHistoryChange)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _crud_patcher__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./crud/patcher */ \"./src/ERA变量框架/core/crud/patcher.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger();\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg) => {\n    const key = (0,_key_mk__WEBPACK_IMPORTED_MODULE_5__.readMessageKey)(msg);\n    if (!key)\n        return null;\n    return key;\n};\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks) => {\n    const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_2__.getEraData)();\n    for (const mk of mks) {\n        if (!mk)\n            continue; // 跳过 null (用户消息)\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.parseEditLog)(editLogRaw);\n        if (editLog.length > 0) {\n            return false; // 发现一个非空 log，直接返回 false\n        }\n    }\n    return true; // 所有 log 都为空\n};\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑。\n * 在没有检测到历史变化时，该函数还会自动回滚并重算最后一条消息，从而实现了“写入”操作的统一。\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nconst resyncStateOnHistoryChange = async (forceFullResync = false) => {\n    if (forceFullResync) {\n        logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    }\n    else {\n        logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n    const { meta: oldMetaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_2__.getEraData)();\n    const oldSelectedMks = _.cloneDeep(_.get(oldMetaData, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []));\n    logger.debug('resyncStateOnHistoryChange', `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`);\n    if (!allMessages || allMessages.length === 0) {\n        logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n        return;\n    }\n    let firstRecalcId = -1;\n    if (forceFullResync) {\n        firstRecalcId = 0;\n        logger.log('resyncStateOnHistoryChange', '强制模式：设置重算起点为 0。');\n    }\n    // Case 1: 消息被删除 (新列表比旧列表短)\n    else if (allMessages.length < oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息删除。');\n        // 从后往前，寻找第一个 \"currentMk === oldMk_at_same_index\" 的对齐点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[删除-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk === recordedMk) {\n                firstRecalcId = i + 1;\n                logger.log('resyncStateOnHistoryChange', `找到对齐点于 message_id=${i} (MK=${currentMk})。将从 ID ${firstRecalcId} 开始检查。`);\n                break;\n            }\n        }\n        if (firstRecalcId === -1) {\n            firstRecalcId = 0;\n            logger.log('resyncStateOnHistoryChange', '未找到任何对齐点，将从头开始检查。');\n        }\n        // 【优化】检查被删除的 MK 是否影响变量\n        // 稳健地找出被删除的 MK：对比新旧 MK 序列的差异\n        const currentMkSequence = allMessages.map(getMkFromMsg).filter(mk => mk);\n        const oldMkSequence = oldSelectedMks.filter(mk => mk);\n        const deletedMks = _.difference(oldMkSequence, currentMkSequence);\n        logger.debug('resyncStateOnHistoryChange', `旧MK序列: [${oldMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `新MK序列: [${currentMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `计算出的被删除MK: [${deletedMks.join(', ')}]`);\n        if (deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks)) {\n            logger.log('resyncStateOnHistoryChange', `检测到被删除的 ${deletedMks.length} 条消息均不含变量修改，执行快速同步。`);\n            const newSelectedMks = [];\n            for (let i = 0; i < allMessages.length; i++) {\n                newSelectedMks[i] = getMkFromMsg(allMessages[i]);\n            }\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_2__.updateEraMetaData)(meta => {\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n                return meta;\n            });\n            logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n            return;\n        }\n    }\n    // Case 2: 消息被修改/切换 (长度不变)\n    else if (allMessages.length === oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息长度不变，可能为修改或切换。');\n        // 从后往前，寻找第一个不匹配的点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[切换-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk !== recordedMk) {\n                firstRecalcId = i;\n            }\n        }\n        if (firstRecalcId === -1) {\n            // N.B. 在当前架构下，MK 已被直接写入消息内容，与内容强绑定。\n            // 因此，任何导致内容变化的操作（如 swipe）也必然会导致 MK 的变化。\n            // 这意味着，如果 MK 序列完全匹配，那么内容也必然完全匹配。\n            // logger.log('resyncStateOnHistoryChange', '所有MK均匹配，无需重算。');\n            // return; // 直接返回，终止同步。\n            // 【模拟写入】为了将“写入”操作统一到“同步”流程中，我们在此处模拟写入。\n            // 当所有 MK 匹配（即没有检测到历史变化）时，我们将重算点强制设置为最后一条消息。\n            // 这相当于“回滚并重写最后一条消息”，从而实现了写入操作。\n            //\n            // 【历史问题】过去，一个类似的“保险机制”曾导致 Bug：在同步逻辑更新完 selectedMK 和 editLog 后，\n            // 这个机制会错误地回滚最后一条消息，导致状态被破坏。\n            // 【安全性】但此处的修改是安全的，因为它发生在状态数组（selectedMks, editLogs）被修改之前，\n            // 属于同步流程的前置判断环节，因此不会造成过去的问题。\n            firstRecalcId = allMessages.length > 0 ? allMessages.length - 1 : 0;\n            logger.log('resyncStateOnHistoryChange', `所有MK均匹配。启动模拟写入，强制重算最后一条消息 (ID: ${firstRecalcId})。`);\n        }\n        else {\n            logger.log('resyncStateOnHistoryChange', `找到最早的不匹配点于 message_id=${firstRecalcId}。将从该点开始重算。`);\n        }\n    }\n    // Case 3: 消息被添加 (新列表比旧列表长)\n    else {\n        logger.log('resyncStateOnHistoryChange', '检测到消息添加。');\n        // 将重算起点设置为新消息的起始索引，让同步流程统一处理\n        firstRecalcId = oldSelectedMks.length;\n        logger.log('resyncStateOnHistoryChange', `新增消息的写入逻辑已由同步流程接管。将从新增消息 (ID: ${firstRecalcId}) 开始处理。`);\n    }\n    // 3. 收集需要回滚的 MK 列表，并执行逆序回滚\n    if (firstRecalcId > -1) {\n        const mksToRollback = oldSelectedMks.slice(firstRecalcId).filter(mk => mk);\n        if (mksToRollback.length > 0) {\n            logger.log('resyncStateOnHistoryChange', `准备回滚 ${mksToRollback.length} 个MK: [${mksToRollback.join(', ')}]`);\n            for (const mk of mksToRollback.reverse()) {\n                logger.debug('resyncStateOnHistoryChange', `[回滚] 正在回滚 MK: ${mk}`);\n                await (0,_rollback__WEBPACK_IMPORTED_MODULE_6__.rollbackByMk)(mk, true); // true 表示只回滚，不重写\n            }\n            logger.log('resyncStateOnHistoryChange', '逆序回滚完成。');\n        }\n    }\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n        const msg = allMessages[i];\n        logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}`);\n        const newMk = await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_4__.ApplyVarChangeForMessage)(msg);\n        newSelectedMks[i] = newMk; // 使用重算后的新 message_id (即 i) 作为索引\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n    // 5. 更新 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_2__.updateEraMetaData)(meta => {\n        _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n        return meta;\n    });\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n    // ==================================================================\n    // 【保险机制】 - 已于 2025/10/02 移除\n    //\n    // **历史原因**:\n    // 该机制最初是为了解决一个旧架构下的“内容-变量错位”问题。在旧架构中，当删除一条 swipe 时，\n    // 后一条 swipe 的内容会“顶替”上来，但其底层的消息变量（及其 MK）却保持不变。\n    // 这导致主同步逻辑的 MK 比对失效，无法发现状态变化。\n    // 为此，保险机制被设计为：通过 `oldSelectedMks`（状态变更前的快照）找到被删除的旧 MK，\n    // 强制回滚它，然后根据当前可见的新内容重新写入变量，从而修复错位。\n    //\n    // **当前架构下的情况与移除原因**:\n    // 在当前架构中，MK 已被直接写入消息内容，与内容强绑定。当 swipe 导致内容变化时，MK 也会随之变化。\n    // 这使得主同步逻辑（逆序回滚、顺序重算）已经能够完全、正确地处理 swipe 等场景，不再需要此保险机制。\n    //\n    // 继续保留该机制不仅是冗余的，而且会主动引发 Bug：\n    // 它依然按照旧逻辑，使用 `oldSelectedMks` 回滚一个过时的、不相关的 MK，这会破坏主逻辑刚刚同步好的正确状态。\n    // 随后，在被破坏的状态上进行的重写操作会失败或产生错误结果（例如，生成一个空的 EditLog），\n    // 并覆盖掉之前由主逻辑正确生成的 EditLog，导致数据丢失。\n    //\n    // 综上，该机制已从“保险”变为“风险”，因此被完全注释掉。\n    // ==================================================================\n    // logger.log('resyncStateOnHistoryChange', '执行【保险机制】：无条件回滚并重写最后一楼...');\n    // const lastWrittenMk = [...oldSelectedMks].reverse().find(mk => mk);\n    // if (lastWrittenMk) {\n    //   logger.log('resyncStateOnHistoryChange', `找到最后一个写入的MK: ${lastWrittenMk}，执行回滚...`);\n    //   await rollbackByMk(lastWrittenMk, true);\n    //   logger.log('resyncStateOnHistoryChange', '回滚完成，准备根据当前最后一楼内容重写...');\n    //   await ApplyVarChange(); // ApplyVarChange 默认处理最后一楼\n    //   logger.log('resyncStateOnHistoryChange', '保险性重写完成。');\n    // } else {\n    //   logger.log('resyncStateOnHistoryChange', '未找到任何可供回滚的旧MK，跳过保险机制。');\n    // }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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REFBeUQ7SUFDekQsdURBQXVEO0lBQ3ZELEVBQUU7SUFDRiw2QkFBNkI7SUFDN0Isa0VBQWtFO0lBQ2xFLG1EQUFtRDtJQUNuRCxrQ0FBa0M7SUFDbEMsRUFBRTtJQUNGLCtCQUErQjtJQUMvQixxRUFBcUU7SUFDckUsd0VBQXdFO0lBQ3hFLHNFQUFzRTtJQUN0RSx1QkFBdUI7SUFDdkIsdUZBQXVGO0lBQ3ZGLDZDQUE2QztJQUM3Qyx3RUFBd0U7SUFDeEUsdURBQXVEO0lBQ3ZELDBEQUEwRDtJQUMxRCxXQUFXO0lBQ1gsdUVBQXVFO0lBQ3ZFLElBQUk7QUFDTixDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3N5bmMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEBmaWxlIOeKtuaAgeWQjOatpeaguOW/g1xuICogQGRlc2NyaXB0aW9uIOacrOaWh+S7tuS4reeahCBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOaYryBFUkEg5Y+Y6YeP5qGG5p625pyA5qC45b+D55qE5Ye95pWw5LmL5LiA44CCXG4gKiDlroPpgJrov4flrp7njrDigJzpgIbluo/lm57mu5rvvIzpobrluo/ph43nrpfigJ3nmoTpgLvovpHvvIzop6PlhrPkuoblm6Dmtojmga/liKDpmaTjgIHliIfmjaLliIbmlK8gKHN3aXBlKSDnrYnmk43kvZzlr7zoh7TnmoTlj5jph4/nirbmgIHkuI7mtojmga/ljoblj7LkuI3kuIDoh7TnmoTmo5jmiYvpl67popjjgIJcbiAqXG4gKiAjIyMg6YWS6aaG55qE5aWH54m56KGM5Li6IChGZWF0dXJlLCBub3QgYSBidWcpXG4gKlxuICog5b2T5Yig6Zmk5LiA5p2hIHN3aXBlICjkvovlpoLvvIzluKbmnInlj5jph48gaWQ9MiDnmoTmtojmga8pIOaXtu+8mlxuICogMS4gKirlhoXlrrnkuI7lj5jph4/plJnkvY0qKjog5ZCO5LiA5p2hIHN3aXBlIChpZD0zKSDnmoQqKuWGheWuuSoq5Lya4oCc6aG24oCd5Yiw6KKr5Yig6Zmk55qEIHN3aXBlIChpZD0yKSDnmoTkvY3nva7kuIrvvIzkvYYqKuWPmOmHjyoq5Y205L+d55WZ5LqGIGlkPTIg55qE5Y+Y6YeP44CCXG4gKiAyLiAqKuWtpOWEv+WPmOmHj+aui+eVmSoqOiDljp/mnKznmoQgc3dpcGUgMyDmtojmga/omb3nhLblnKjnlYzpnaLkuIrmtojlpLHkuobvvIzkvYblroPlr7nlupTnmoQqKua2iOaBr+WPmOmHjyoqIChpZD0zKSDku43nhLbmrovnlZnlnKjogYrlpKnmlbDmja7kuK3vvIzmiJDkuLrigJzlraTlhL/lj5jph4/igJ3jgIJcbiAqIDMuICoq5a2k5YS/5Y+Y6YeP57un5om/Kio6IOWmguaenOeUqOaIt+atpOaXtuWGjSBzd2lwZSDkuIDmrKHvvIzmlrDnlJ/miJDnmoQgc3dpcGUgMyDlsIbkvJoqKue7p+aJvyoq6L+Z5Liq5q6L55WZ55qE5a2k5YS/5Y+Y6YePIChpZD0zKe+8jOWvvOiHtOaWsOWGheWuuemFjeaXp+WPmOmHj++8jOi/m+S4gOatpeWKoOWJp+eKtuaAgea3t+S5seOAglxuICogNC4gKirnu5PmnpwqKjog5oiR5Lus5b6X5Yiw5LqG5LiA5Liq5YaF5a655pivIGlkPTPjgIHlj5jph4/mmK8gaWQ9MiDnmoTigJzmt7flkIjigJ3mtojmga/vvIzlubbkuJTov5jmnInkuIDkuKogaWQ9MyDnmoTlraTlhL/lj5jph4/pmo/ml7blj6/og73ooqvmlrDmtojmga/nu6fmib/vvIzpgKDmiJDkuKXph43nmoTnirbmgIHkuI3kuIDoh7TjgIJcbiAqXG4gKiAjIyMg5pys5Ye95pWw55qE6Kej5Yaz562W55WlXG4gKlxuICogYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDpgJrov4flhajpnaLnmoTnirbmgIHmr5Tlr7nmnaXop6PlhrPmraTpl67popjvvJpcbiAqIDEuIOWcqCBgbWVzc2FnZV9kZWxldGVkYCwgYG1lc3NhZ2Vfc3dpcGVkYCDnrYnkuovku7bop6blj5Hml7booqvosIPnlKjjgIJcbiAqIDIuIOWFqOmdouiOt+WPluW9k+WJjeWunumZheeahOa2iOaBr+WIl+ihqO+8jOW5tuS4juS5i+WJjeiusOW9leeahCBgU2VsZWN0ZWRNa3NgIOW6j+WIl+i/m+ihjOavlOWvueOAglxuICogMy4g57K+56Gu5om+5Yiw56ys5LiA5Liq5LiN5LiA6Ie055qE54K577yI5peg6K665piv5Yig6Zmk44CB6L+Y5piv5L+u5pS577yJ44CCXG4gKiA0LiAqKumAhuW6j+Wbnua7mioqOiDku47lkI7lvoDliY3vvIzlsIbmiYDmnInkuI3kuIDoh7TnmoQgYE1LYCDmiYDlvJXlhaXnmoTlj5jph4/kv67mlLnlhajpg6jmkqTplIDjgIJcbiAqIDUuICoq6aG65bqP6YeN566XKio6IOS7juS4jeS4gOiHtOeCueW8gOWni++8jOagueaNruW9k+WJjea2iOaBr+eahCoq5a6e6ZmF5YaF5a65KirvvIzph43mlrDorqHnrpflubblhpnlhaXlj5jph4/jgIJcbiAqXG4gKiAqKuacgOe7iOaViOaenCoqOiDml6Dorrrljoblj7LorrDlvZXlj5HnlJ/kvZXnp43lj5jljJbvvIzlj5jph4/nirbmgIHpg73og73ooqvlroznvo7lnLDoh6rliqjkv67lpI3vvIznoa7kv53mlbDmja7kuIDoh7TmgKfjgIJcbiAqL1xuXG5pbXBvcnQgeyBMT0dTX1BBVEgsIFNFTF9QQVRIIH0gZnJvbSAnLi4vdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgdXBkYXRlRXJhTWV0YURhdGEgfSBmcm9tICcuLi91dGlscy9lcmFfZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xuaW1wb3J0IHsgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlIH0gZnJvbSAnLi9jcnVkL3BhdGNoZXInO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tayc7XG5pbXBvcnQgeyByb2xsYmFja0J5TWsgfSBmcm9tICcuL3JvbGxiYWNrJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqIOiOt+WPlueUqOS6juWPmOmHj+aTjeS9nOeahE1L44CC5aaC5p6c5raI5oGv5piv55So5oi35raI5oGv77yM5YiZ6L+U5ZuebnVsbOS7pei3s+i/h+aTjeS9nOOAglxuICogQHBhcmFtIG1zZyDmtojmga/lr7nosaFcbiAqIEByZXR1cm5zIE1LIOWtl+espuS4suaIliBudWxsXG4gKi9cbmNvbnN0IGdldE1rRnJvbU1zZyA9IChtc2c6IGFueSk6IHN0cmluZyB8IG51bGwgPT4ge1xuICBjb25zdCBrZXkgPSByZWFkTWVzc2FnZUtleShtc2cpO1xuICBpZiAoIWtleSkgcmV0dXJuIG51bGw7XG5cbiAgcmV0dXJuIGtleTtcbn07XG5cbi8qKlxuICog5qOA5p+l5LiA57uEIE1LIOWvueW6lOeahCBFZGl0TG9nIOaYr+WQpumDveS4uuepulxuICogQHBhcmFtIG1rcyBNSyDliJfooahcbiAqIEByZXR1cm5zIOWmguaenOaJgOaciSBFZGl0TG9nIOmDveS4uuepuuWImei/lOWbniB0cnVlXG4gKi9cbmNvbnN0IGNoZWNrRWRpdExvZ3NBcmVFbXB0eSA9IChta3M6IChzdHJpbmcgfCBudWxsKVtdKTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IHsgbWV0YTogbWV0YURhdGEgfSA9IGdldEVyYURhdGEoKTtcbiAgZm9yIChjb25zdCBtayBvZiBta3MpIHtcbiAgICBpZiAoIW1rKSBjb250aW51ZTsgLy8g6Lez6L+HIG51bGwgKOeUqOaIt+a2iOaBrylcbiAgICBjb25zdCBlZGl0TG9nUmF3ID0gXy5nZXQobWV0YURhdGEsIFtMT0dTX1BBVEgsIG1rXSk7XG4gICAgY29uc3QgZWRpdExvZyA9IHBhcnNlRWRpdExvZyhlZGl0TG9nUmF3KTtcbiAgICBpZiAoZWRpdExvZy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIOWPkeeOsOS4gOS4qumdnuepuiBsb2fvvIznm7TmjqXov5Tlm54gZmFsc2VcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7IC8vIOaJgOaciSBsb2cg6YO95Li656m6XG59O1xuXG4vKipcbiAqIOW9k+iBiuWkqeiusOW9leWPkeeUn+WPmOWMlu+8iOWIoOmZpOOAgeWIh+aNouWIhuaUr++8ieaXtu+8jOmHjeaWsOWQjOatpeeKtuaAgeeahOaguOW/g+WHveaVsFxuICog5a6e546w5LqG4oCc6YCG5bqP5Zue5rua77yM6aG65bqP6YeN566X4oCd55qE6YC76L6R44CCXG4gKiDlnKjmsqHmnInmo4DmtYvliLDljoblj7Llj5jljJbml7bvvIzor6Xlh73mlbDov5jkvJroh6rliqjlm57mu5rlubbph43nrpfmnIDlkI7kuIDmnaHmtojmga/vvIzku47ogIzlrp7njrDkuobigJzlhpnlhaXigJ3mk43kvZznmoTnu5/kuIDjgIJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlRnVsbFJlc3luYz1mYWxzZV0gLSDlpoLmnpzkuLogdHJ1Ze+8jOWImeW8uuWItuS7juWktOW8gOWni+WujOWFqOmHjeeul++8jOW/veeVpeW3ruW8guajgOa1i+OAglxuICovXG5leHBvcnQgY29uc3QgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgPSBhc3luYyAoZm9yY2VGdWxsUmVzeW5jID0gZmFsc2UpID0+IHtcbiAgaWYgKGZvcmNlRnVsbFJlc3luYykge1xuICAgIGxvZ2dlci53YXJuKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLblrozlhajph43nrpfmqKHlvI/lt7LlkK/liqjvvIEnKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfogYrlpKnorrDlvZXlj5jmm7TvvIzlkK/liqjnirbmgIHlkIzmraUuLi4nKTtcbiAgfVxuXG4gIC8vIOaguOW/g+WBh+iuvu+8mmdldENoYXRNZXNzYWdlcyDkvJrph43mlrDnlJ/miJAgbWVzc2FnZV9pZO+8jOS9v+WFtuS/neaMgeS7jiAwIOW8gOWni+eahOi/nue7reW6j+WIl+OAglxuICBjb25zdCBhbGxNZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk7XG4gIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn6I635Y+W5Yiw55qEIGFsbE1lc3NhZ2VzOicsIGFsbE1lc3NhZ2VzKTtcbiAgY29uc3QgeyBtZXRhOiBvbGRNZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICBjb25zdCBvbGRTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBfLmNsb25lRGVlcChfLmdldChvbGRNZXRhRGF0YSwgU0VMX1BBVEgsIFtdKSk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgYOeKtuaAgeW/q+eFpzogb2xkU2VsZWN0ZWRNa3MubGVuZ3RoPSR7b2xkU2VsZWN0ZWRNa3MubGVuZ3RofSwgYWxsTWVzc2FnZXMubGVuZ3RoPSR7YWxsTWVzc2FnZXM/Lmxlbmd0aCA/PyAwfWAsXG4gICk7XG5cbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvZPliY3ogYrlpKnorrDlvZXkuLrnqbrvvIzkuI3miafooYzku7vkvZXmk43kvZzvvIzlkIzmraXnu4jmraLjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgZmlyc3RSZWNhbGNJZCA9IC0xO1xuXG4gIGlmIChmb3JjZUZ1bGxSZXN5bmMpIHtcbiAgICBmaXJzdFJlY2FsY0lkID0gMDtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLbmqKHlvI/vvJrorr7nva7ph43nrpfotbfngrnkuLogMOOAgicpO1xuICB9XG4gIC8vIENhc2UgMTog5raI5oGv6KKr5Yig6ZmkICjmlrDliJfooajmr5Tml6fliJfooajnn60pXG4gIGVsc2UgaWYgKGFsbE1lc3NhZ2VzLmxlbmd0aCA8IG9sZFNlbGVjdGVkTWtzLmxlbmd0aCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+WIoOmZpOOAgicpO1xuICAgIC8vIOS7juWQjuW+gOWJje+8jOWvu+aJvuesrOS4gOS4qiBcImN1cnJlbnRNayA9PT0gb2xkTWtfYXRfc2FtZV9pbmRleFwiIOeahOWvuem9kOeCuVxuICAgIGZvciAobGV0IGkgPSBhbGxNZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgY3VycmVudE1rID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIGNvbnN0IHJlY29yZGVkTWsgPSBvbGRTZWxlY3RlZE1rc1tpXTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgICAgYFvliKDpmaQt5a+56b2Q5qOA5p+lXSBpPSR7aX0sIGN1cnJlbnRNaz0ke2N1cnJlbnRNa30sIHJlY29yZGVkTWs9JHtyZWNvcmRlZE1rfWAsXG4gICAgICApO1xuXG4gICAgICBpZiAoY3VycmVudE1rID09PSByZWNvcmRlZE1rKSB7XG4gICAgICAgIGZpcnN0UmVjYWxjSWQgPSBpICsgMTtcbiAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICAgIGDmib7liLDlr7npvZDngrnkuo4gbWVzc2FnZV9pZD0ke2l9IChNSz0ke2N1cnJlbnRNa30p44CC5bCG5LuOIElEICR7Zmlyc3RSZWNhbGNJZH0g5byA5aeL5qOA5p+l44CCYCxcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgZmlyc3RSZWNhbGNJZCA9IDA7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlr7npvZDngrnvvIzlsIbku47lpLTlvIDlp4vmo4Dmn6XjgIInKTtcbiAgICB9XG5cbiAgICAvLyDjgJDkvJjljJbjgJHmo4Dmn6XooqvliKDpmaTnmoQgTUsg5piv5ZCm5b2x5ZON5Y+Y6YePXG4gICAgLy8g56iz5YGl5Zyw5om+5Ye66KKr5Yig6Zmk55qEIE1L77ya5a+55q+U5paw5penIE1LIOW6j+WIl+eahOW3ruW8glxuICAgIGNvbnN0IGN1cnJlbnRNa1NlcXVlbmNlID0gYWxsTWVzc2FnZXMubWFwKGdldE1rRnJvbU1zZykuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBvbGRNa1NlcXVlbmNlID0gb2xkU2VsZWN0ZWRNa3MuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBkZWxldGVkTWtzID0gXy5kaWZmZXJlbmNlKG9sZE1rU2VxdWVuY2UsIGN1cnJlbnRNa1NlcXVlbmNlKTtcblxuICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5penTUvluo/liJc6IFske29sZE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmlrBNS+W6j+WIlzogWyR7Y3VycmVudE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDorqHnrpflh7rnmoTooqvliKDpmaRNSzogWyR7ZGVsZXRlZE1rcy5qb2luKCcsICcpfV1gKTtcblxuICAgIGlmIChkZWxldGVkTWtzLmxlbmd0aCA+IDAgJiYgY2hlY2tFZGl0TG9nc0FyZUVtcHR5KGRlbGV0ZWRNa3MpKSB7XG4gICAgICBsb2dnZXIubG9nKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBg5qOA5rWL5Yiw6KKr5Yig6Zmk55qEICR7ZGVsZXRlZE1rcy5sZW5ndGh9IOadoea2iOaBr+Wdh+S4jeWQq+WPmOmHj+S/ruaUue+8jOaJp+ihjOW/q+mAn+WQjOatpeOAgmAsXG4gICAgICApO1xuICAgICAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbE1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG5ld1NlbGVjdGVkTWtzW2ldID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgbmV3U2VsZWN0ZWRNa3MpO1xuICAgICAgICByZXR1cm4gbWV0YTtcbiAgICAgIH0pO1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5b+r6YCf5ZCM5q2l5a6M5oiQ77yM5LuF5L+u5q2jIFNlbGVjdGVkTWtzIOaVsOe7hOOAgicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICAvLyBDYXNlIDI6IOa2iOaBr+iiq+S/ruaUuS/liIfmjaIgKOmVv+W6puS4jeWPmClcbiAgZWxzZSBpZiAoYWxsTWVzc2FnZXMubGVuZ3RoID09PSBvbGRTZWxlY3RlZE1rcy5sZW5ndGgpIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmo4DmtYvliLDmtojmga/plb/luqbkuI3lj5jvvIzlj6/og73kuLrkv67mlLnmiJbliIfmjaLjgIInKTtcbiAgICAvLyDku47lkI7lvoDliY3vvIzlr7vmib7nrKzkuIDkuKrkuI3ljLnphY3nmoTngrlcbiAgICBmb3IgKGxldCBpID0gYWxsTWVzc2FnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRNayA9IGdldE1rRnJvbU1zZyhhbGxNZXNzYWdlc1tpXSk7XG4gICAgICBjb25zdCByZWNvcmRlZE1rID0gb2xkU2VsZWN0ZWRNa3NbaV07XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgIGBb5YiH5o2iLeWvuem9kOajgOafpV0gaT0ke2l9LCBjdXJyZW50TWs9JHtjdXJyZW50TWt9LCByZWNvcmRlZE1rPSR7cmVjb3JkZWRNa31gLFxuICAgICAgKTtcbiAgICAgIGlmIChjdXJyZW50TWsgIT09IHJlY29yZGVkTWspIHtcbiAgICAgICAgZmlyc3RSZWNhbGNJZCA9IGk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgLy8gTi5CLiDlnKjlvZPliY3mnrbmnoTkuIvvvIxNSyDlt7Looqvnm7TmjqXlhpnlhaXmtojmga/lhoXlrrnvvIzkuI7lhoXlrrnlvLrnu5HlrprjgIJcbiAgICAgIC8vIOWboOatpO+8jOS7u+S9leWvvOiHtOWGheWuueWPmOWMlueahOaTjeS9nO+8iOWmgiBzd2lwZe+8ieS5n+W/heeEtuS8muWvvOiHtCBNSyDnmoTlj5jljJbjgIJcbiAgICAgIC8vIOi/meaEj+WRs+edgO+8jOWmguaenCBNSyDluo/liJflrozlhajljLnphY3vvIzpgqPkuYjlhoXlrrnkuZ/lv4XnhLblrozlhajljLnphY3jgIJcbiAgICAgIC8vIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+aJgOaciU1L5Z2H5Yy56YWN77yM5peg6ZyA6YeN566X44CCJyk7XG4gICAgICAvLyByZXR1cm47IC8vIOebtOaOpei/lOWbnu+8jOe7iOatouWQjOatpeOAglxuXG4gICAgICAvLyDjgJDmqKHmi5/lhpnlhaXjgJHkuLrkuoblsIbigJzlhpnlhaXigJ3mk43kvZznu5/kuIDliLDigJzlkIzmraXigJ3mtYHnqIvkuK3vvIzmiJHku6zlnKjmraTlpITmqKHmi5/lhpnlhaXjgIJcbiAgICAgIC8vIOW9k+aJgOaciSBNSyDljLnphY3vvIjljbPmsqHmnInmo4DmtYvliLDljoblj7Llj5jljJbvvInml7bvvIzmiJHku6zlsIbph43nrpfngrnlvLrliLborr7nva7kuLrmnIDlkI7kuIDmnaHmtojmga/jgIJcbiAgICAgIC8vIOi/meebuOW9k+S6juKAnOWbnua7muW5tumHjeWGmeacgOWQjuS4gOadoea2iOaBr+KAne+8jOS7juiAjOWunueOsOS6huWGmeWFpeaTjeS9nOOAglxuICAgICAgLy9cbiAgICAgIC8vIOOAkOWOhuWPsumXrumimOOAkei/h+WOu++8jOS4gOS4quexu+S8vOeahOKAnOS/nemZqeacuuWItuKAneabvuWvvOiHtCBCdWfvvJrlnKjlkIzmraXpgLvovpHmm7TmlrDlrowgc2VsZWN0ZWRNSyDlkowgZWRpdExvZyDlkI7vvIxcbiAgICAgIC8vIOi/meS4quacuuWItuS8mumUmeivr+WcsOWbnua7muacgOWQjuS4gOadoea2iOaBr++8jOWvvOiHtOeKtuaAgeiiq+egtOWdj+OAglxuICAgICAgLy8g44CQ5a6J5YWo5oCn44CR5L2G5q2k5aSE55qE5L+u5pS55piv5a6J5YWo55qE77yM5Zug5Li65a6D5Y+R55Sf5Zyo54q25oCB5pWw57uE77yIc2VsZWN0ZWRNa3MsIGVkaXRMb2dz77yJ6KKr5L+u5pS55LmL5YmN77yMXG4gICAgICAvLyDlsZ7kuo7lkIzmraXmtYHnqIvnmoTliY3nva7liKTmlq3njq/oioLvvIzlm6DmraTkuI3kvJrpgKDmiJDov4fljrvnmoTpl67popjjgIJcbiAgICAgIGZpcnN0UmVjYWxjSWQgPSBhbGxNZXNzYWdlcy5sZW5ndGggPiAwID8gYWxsTWVzc2FnZXMubGVuZ3RoIC0gMSA6IDA7XG4gICAgICBsb2dnZXIubG9nKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBg5omA5pyJTUvlnYfljLnphY3jgILlkK/liqjmqKHmi5/lhpnlhaXvvIzlvLrliLbph43nrpfmnIDlkI7kuIDmnaHmtojmga8gKElEOiAke2ZpcnN0UmVjYWxjSWR9KeOAgmAsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDml6nnmoTkuI3ljLnphY3ngrnkuo4gbWVzc2FnZV9pZD0ke2ZpcnN0UmVjYWxjSWR944CC5bCG5LuO6K+l54K55byA5aeL6YeN566X44CCYCk7XG4gICAgfVxuICB9XG4gIC8vIENhc2UgMzog5raI5oGv6KKr5re75YqgICjmlrDliJfooajmr5Tml6fliJfooajplb8pXG4gIGVsc2Uge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+a3u+WKoOOAgicpO1xuICAgIC8vIOWwhumHjeeul+i1t+eCueiuvue9ruS4uuaWsOa2iOaBr+eahOi1t+Wni+e0ouW8le+8jOiuqeWQjOatpea1geeoi+e7n+S4gOWkhOeQhlxuICAgIGZpcnN0UmVjYWxjSWQgPSBvbGRTZWxlY3RlZE1rcy5sZW5ndGg7XG4gICAgbG9nZ2VyLmxvZyhcbiAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICBg5paw5aKe5raI5oGv55qE5YaZ5YWl6YC76L6R5bey55Sx5ZCM5q2l5rWB56iL5o6l566h44CC5bCG5LuO5paw5aKe5raI5oGvIChJRDogJHtmaXJzdFJlY2FsY0lkfSkg5byA5aeL5aSE55CG44CCYCxcbiAgICApO1xuICB9XG5cbiAgLy8gMy4g5pS26ZuG6ZyA6KaB5Zue5rua55qEIE1LIOWIl+ihqO+8jOW5tuaJp+ihjOmAhuW6j+Wbnua7mlxuICBpZiAoZmlyc3RSZWNhbGNJZCA+IC0xKSB7XG4gICAgY29uc3QgbWtzVG9Sb2xsYmFjayA9IG9sZFNlbGVjdGVkTWtzLnNsaWNlKGZpcnN0UmVjYWxjSWQpLmZpbHRlcihtayA9PiBtaykgYXMgc3RyaW5nW107XG4gICAgaWYgKG1rc1RvUm9sbGJhY2subGVuZ3RoID4gMCkge1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5YeG5aSH5Zue5ruaICR7bWtzVG9Sb2xsYmFjay5sZW5ndGh9IOS4qk1LOiBbJHtta3NUb1JvbGxiYWNrLmpvaW4oJywgJyl9XWApO1xuICAgICAgZm9yIChjb25zdCBtayBvZiBta3NUb1JvbGxiYWNrLnJldmVyc2UoKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvlm57mu5pdIOato+WcqOWbnua7miBNSzogJHtta31gKTtcbiAgICAgICAgYXdhaXQgcm9sbGJhY2tCeU1rKG1rLCB0cnVlKTsgLy8gdHJ1ZSDooajnpLrlj6rlm57mu5rvvIzkuI3ph43lhplcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+mAhuW6j+Wbnua7muWujOaIkOOAgicpO1xuICAgIH1cbiAgfVxuXG4gIC8vIDQuIOS7juS4jeWMuemFjeeCueW8gOWni++8jOmhuuW6j+mHjeaWsOW6lOeUqOWPmOmHj+S/ruaUue+8jOW5tuaehOW7uuaWsOeahCBzZWxlY3RlZE1rc1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDku44gSUQgJHtmaXJzdFJlY2FsY0lkfSDlvIDlp4vpobrluo/ph43nrpcuLi5gKTtcbiAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gb2xkU2VsZWN0ZWRNa3Muc2xpY2UoMCwgZmlyc3RSZWNhbGNJZCk7IC8vIOe7p+aJv+WMuemFjemDqOWIhlxuXG4gIGZvciAobGV0IGkgPSBmaXJzdFJlY2FsY0lkOyBpIDwgYWxsTWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBtc2cgPSBhbGxNZXNzYWdlc1tpXTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvph43nrpddIOato+WcqOWkhOeQhua2iOaBr+e0ouW8lTogJHtpfWApO1xuICAgIGNvbnN0IG5ld01rID0gYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4gICAgbmV3U2VsZWN0ZWRNa3NbaV0gPSBuZXdNazsgLy8g5L2/55So6YeN566X5ZCO55qE5pawIG1lc3NhZ2VfaWQgKOWNsyBpKSDkvZzkuLrntKLlvJVcbiAgfVxuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfpobrluo/ph43nrpflrozmiJDjgIInKTtcblxuICAvLyA1LiDmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uEXG4gIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBuZXdTZWxlY3RlZE1rcyk7XG4gICAgcmV0dXJuIG1ldGE7XG4gIH0pO1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfnirbmgIHlkIzmraXlrozmiJDjgIInKTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g44CQ5L+d6Zmp5py65Yi244CRIC0g5bey5LqOIDIwMjUvMTAvMDIg56e76ZmkXG4gIC8vXG4gIC8vICoq5Y6G5Y+y5Y6f5ZugKio6XG4gIC8vIOivpeacuuWItuacgOWIneaYr+S4uuS6huino+WGs+S4gOS4quaXp+aetuaehOS4i+eahOKAnOWGheWuuS3lj5jph4/plJnkvY3igJ3pl67popjjgILlnKjml6fmnrbmnoTkuK3vvIzlvZPliKDpmaTkuIDmnaEgc3dpcGUg5pe277yMXG4gIC8vIOWQjuS4gOadoSBzd2lwZSDnmoTlhoXlrrnkvJrigJzpobbmm7/igJ3kuIrmnaXvvIzkvYblhbblupXlsYLnmoTmtojmga/lj5jph4/vvIjlj4rlhbYgTUvvvInljbTkv53mjIHkuI3lj5jjgIJcbiAgLy8g6L+Z5a+86Ie05Li75ZCM5q2l6YC76L6R55qEIE1LIOavlOWvueWkseaViO+8jOaXoOazleWPkeeOsOeKtuaAgeWPmOWMluOAglxuICAvLyDkuLrmraTvvIzkv53pmanmnLrliLbooqvorr7orqHkuLrvvJrpgJrov4cgYG9sZFNlbGVjdGVkTWtzYO+8iOeKtuaAgeWPmOabtOWJjeeahOW/q+eFp++8ieaJvuWIsOiiq+WIoOmZpOeahOaXpyBNS++8jFxuICAvLyDlvLrliLblm57mu5rlroPvvIznhLblkI7moLnmja7lvZPliY3lj6/op4HnmoTmlrDlhoXlrrnph43mlrDlhpnlhaXlj5jph4/vvIzku47ogIzkv67lpI3plJnkvY3jgIJcbiAgLy9cbiAgLy8gKirlvZPliY3mnrbmnoTkuIvnmoTmg4XlhrXkuI7np7vpmaTljp/lm6AqKjpcbiAgLy8g5Zyo5b2T5YmN5p625p6E5Lit77yMTUsg5bey6KKr55u05o6l5YaZ5YWl5raI5oGv5YaF5a6577yM5LiO5YaF5a655by657uR5a6a44CC5b2TIHN3aXBlIOWvvOiHtOWGheWuueWPmOWMluaXtu+8jE1LIOS5n+S8mumaj+S5i+WPmOWMluOAglxuICAvLyDov5nkvb/lvpfkuLvlkIzmraXpgLvovpHvvIjpgIbluo/lm57mu5rjgIHpobrluo/ph43nrpfvvInlt7Lnu4/og73lpJ/lrozlhajjgIHmraPnoa7lnLDlpITnkIYgc3dpcGUg562J5Zy65pmv77yM5LiN5YaN6ZyA6KaB5q2k5L+d6Zmp5py65Yi244CCXG4gIC8vXG4gIC8vIOe7p+e7reS/neeVmeivpeacuuWItuS4jeS7heaYr+WGl+S9meeahO+8jOiAjOS4lOS8muS4u+WKqOW8leWPkSBCdWfvvJpcbiAgLy8g5a6D5L6d54S25oyJ54Wn5pen6YC76L6R77yM5L2/55SoIGBvbGRTZWxlY3RlZE1rc2Ag5Zue5rua5LiA5Liq6L+H5pe255qE44CB5LiN55u45YWz55qEIE1L77yM6L+Z5Lya56C05Z2P5Li76YC76L6R5Yia5Yia5ZCM5q2l5aW955qE5q2j56Gu54q25oCB44CCXG4gIC8vIOmaj+WQju+8jOWcqOiiq+egtOWdj+eahOeKtuaAgeS4iui/m+ihjOeahOmHjeWGmeaTjeS9nOS8muWksei0peaIluS6p+eUn+mUmeivr+e7k+aenO+8iOS+i+Wmgu+8jOeUn+aIkOS4gOS4quepuueahCBFZGl0TG9n77yJ77yMXG4gIC8vIOW5tuimhuebluaOieS5i+WJjeeUseS4u+mAu+i+keato+ehrueUn+aIkOeahCBFZGl0TG9n77yM5a+86Ie05pWw5o2u5Lii5aSx44CCXG4gIC8vXG4gIC8vIOe7vOS4iu+8jOivpeacuuWItuW3suS7juKAnOS/nemZqeKAneWPmOS4uuKAnOmjjumZqeKAne+8jOWboOatpOiiq+WujOWFqOazqOmHiuaOieOAglxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5omn6KGM44CQ5L+d6Zmp5py65Yi244CR77ya5peg5p2h5Lu25Zue5rua5bm26YeN5YaZ5pyA5ZCO5LiA5qW8Li4uJyk7XG4gIC8vIGNvbnN0IGxhc3RXcml0dGVuTWsgPSBbLi4ub2xkU2VsZWN0ZWRNa3NdLnJldmVyc2UoKS5maW5kKG1rID0+IG1rKTtcbiAgLy8gaWYgKGxhc3RXcml0dGVuTWspIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDlkI7kuIDkuKrlhpnlhaXnmoRNSzogJHtsYXN0V3JpdHRlbk1rfe+8jOaJp+ihjOWbnua7mi4uLmApO1xuICAvLyAgIGF3YWl0IHJvbGxiYWNrQnlNayhsYXN0V3JpdHRlbk1rLCB0cnVlKTtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflm57mu5rlrozmiJDvvIzlh4blpIfmoLnmja7lvZPliY3mnIDlkI7kuIDmpbzlhoXlrrnph43lhpkuLi4nKTtcbiAgLy8gICBhd2FpdCBBcHBseVZhckNoYW5nZSgpOyAvLyBBcHBseVZhckNoYW5nZSDpu5jorqTlpITnkIbmnIDlkI7kuIDmpbxcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfkv53pmanmgKfph43lhpnlrozmiJDjgIInKTtcbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlj6/kvpvlm57mu5rnmoTml6dNS++8jOi3s+i/h+S/nemZqeacuuWItuOAgicpO1xuICAvLyB9XG59O1xuXG4vKipcbiAqIEBkZXByZWNhdGVkIOivpeWHveaVsOW3suiiqyByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSDnmoTlhoXnva7igJzmqKHmi5/lhpnlhaXigJ3pgLvovpHmiYDlj5bku6PjgIJcbiAqICoq44CQ5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hQUnmtojmga/jgJEqKlxuICog6L+Z5piv5LiA5Liq55So5LqO54m55a6a5Zy65pmv55qE5Ye95pWw77yM5L6L5aaC55Sx5aSW6YOoIEFQSSDop6blj5HvvIzpnIDopoHlvLrliLbph43nrpfmnIDlkI7kuIDmnaEgQUkg5raI5oGv55qE5Y+Y6YeP44CCXG4gKiDlroPop6PlhrPkuoblnKjmtojmga/lhoXlrrnooqvlpJbpg6jkv67mlLnvvIjkvYYgTUsg5pyq5Y+Y77yJ5pe277yM54q25oCB5peg5rOV6Ieq5Yqo5pu05paw55qE6Zeu6aKY44CCXG4gKlxuICogKirmiafooYzpgLvovpEqKjpcbiAqIDEuICoq5a6a5L2NKio6IOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIDIuICoq5Zue5ruaKio6IOWmguaenOivpea2iOaBr+WtmOWcqOS4lOaciSBNS++8jOWImeaXoOadoeS7tuWbnua7muatpCBNSyDlvJXlhaXnmoTmiYDmnInlj5jph4/kv67mlLnjgIJcbiAqIDMuICoq6YeN566XKio6IOeri+WNs+agueaNruivpea2iOaBr+eahCoq5b2T5YmN5YaF5a65Kirph43mlrDorqHnrpflj5jph4/vvIzlubbnlJ/miJDmlrDnmoQgYEVkaXRMb2dg44CCXG4gKiA0LiAqKuabtOaWsCoqOiDlsIbmlrDnmoQgTUsg5pu05paw5YiwIGBTZWxlY3RlZE1rc2Ag5pWw57uE55qE5q2j56Gu5L2N572u44CCXG4gKlxuICogKirlronlhajmgKcqKjpcbiAqIOatpOWHveaVsOaTjeS9nOebruagh+aYjuehru+8iOacgOWQjuS4gOadoSBBSSDmtojmga/vvInvvIzkuJTlm57mu5rlkozph43nrpflnKjlkIzkuIDosIPnlKjpk77kuK3lrozmiJDvvIxcbiAqIOmBv+WFjeS6huaXp+KAnOS/nemZqeacuuWItuKAneS4reWboOebruagh+S4jeaYjuehruiAjOegtOWdjyBgcmVzeW5jYCDnirbmgIHnmoTpo47pmanjgIJcbiAqL1xuLy8gZXhwb3J0IGNvbnN0IGZvcmNlU3luY0xhc3RBaU1lc3NhZ2UgPSBhc3luYyAoKSA9PiB7XG4vLyAgIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5ZCv5Yqo5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hIEFJIOa2iOaBry4uLicpO1xuXG4vLyAgIC8vIDEuIOWumuS9jVxuLy8gICBjb25zdCBtc2cgPSBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuLy8gICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4vLyAgICAgbG9nZ2VyLndhcm4oJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5pyq5om+5Yiw5Y+v5L6b5by65Yi25ZCM5q2l55qEIEFJIOa2iOaBr+OAgicpO1xuLy8gICAgIHJldHVybjtcbi8vICAgfVxuXG4vLyAgIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuLy8gICBjb25zdCBNSyA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG5cbi8vICAgaWYgKCFNSykge1xuLy8gICAgIGxvZ2dlci53YXJuKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5LiN5ZCrIE1L77yM5peg5rOV5omn6KGM5by65Yi25ZCM5q2l44CC5bCG6L2s5Li65omn6KGM5bi46KeE5YaZ5YWlLi4uYCk7XG4vLyAgICAgLy8g5aaC5p6c5rKh5pyJIE1L77yM6K+05piO5piv5paw5raI5oGv77yM55u05o6l6LWw5qCH5YeG5YaZ5YWl5rWB56iL5Y2z5Y+vXG4vLyAgICAgYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4vLyAgICAgcmV0dXJuO1xuLy8gICB9XG5cbi8vICAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDnm67moIfmtojmga8gKElEOiAke21lc3NhZ2VJZH0sIE1LOiAke01LfSnjgIJgKTtcblxuLy8gICAvLyAyLiDlm57mu5pcbi8vICAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOato+WcqOWbnua7miBNSzogJHtNS30uLi5gKTtcbi8vICAgYXdhaXQgcm9sbGJhY2tCeU1rKE1LLCB0cnVlKTsgLy8gc2lsZW50PXRydWXvvIzpgb/lhY3kuI3lv4XopoHnmoTml6Xlv5fliLfmlrBcblxuLy8gICAvLyAzLiDph43nrpdcbi8vICAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOWbnua7muWujOaIkO+8jOato+WcqOagueaNruW9k+WJjeWGheWuuemHjeeulyBNSzogJHtNS30uLi5gKTtcbi8vICAgY29uc3QgbmV3TUsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcblxuLy8gICAvLyA0LiDmm7TmlrAgU2VsZWN0ZWRNa3Ncbi8vICAgaWYgKG5ld01LKSB7XG4vLyAgICAgdHJ5IHtcbi8vICAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuLy8gICAgICAgICBjb25zdCBzZWxlY3RlZE1rcyA9IF8uZ2V0KG1ldGEsIFNFTF9QQVRILCBbXSk7XG4vLyAgICAgICAgIHNlbGVjdGVkTWtzW21lc3NhZ2VJZF0gPSBuZXdNSztcbi8vICAgICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbi8vICAgICAgICAgcmV0dXJuIG1ldGE7XG4vLyAgICAgICB9KTtcbi8vICAgICAgIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5by65Yi25ZCM5q2l5a6M5oiQ77yM5bey5pu05pawIFNlbGVjdGVkTWtzWyR7bWVzc2FnZUlkfV0gPSAke25ld01LfWApO1xuLy8gICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuLy8gICAgICAgbG9nZ2VyLmVycm9yKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOW8uuWItuWQjOatpeWQjuabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuLy8gICAgIH1cbi8vICAgfSBlbHNlIHtcbi8vICAgICBsb2dnZXIuZXJyb3IoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg6YeN566X5ZCO5pyq6IO96I635Y+W5paw55qEIE1L77yMU2VsZWN0ZWRNa3Mg5Y+v6IO95pyq5pu05paw44CCYCk7XG4vLyAgIH1cbi8vIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/sync.ts\n\n}");
  },
  "./src/ERA变量框架/events/dispatcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/events/dispatcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dispatchAndExecuteTask: () => (/* binding */ dispatchAndExecuteTask)\n/* harmony export */ });\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _scriptIniter_settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../scriptIniter/settings */ \"./src/ERA变量框架/scriptIniter/settings.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _handlers_api_dispatcher__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./handlers/api/dispatcher */ \"./src/ERA变量框架/events/handlers/api/dispatcher.ts\");\n/* harmony import */ var _handlers_sync__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./handlers/sync */ \"./src/ERA变量框架/events/handlers/sync.ts\");\n/* harmony import */ var _handlers_updateMkOnly__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./handlers/updateMkOnly */ \"./src/ERA变量框架/events/handlers/updateMkOnly.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_4__.Logger();\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n/**\n * @var {ConsecutiveMkState | null} consecutiveMkState\n * @description 追踪同一个 MK 被连续处理次数的状态。\n * **作用域**: 跨批次持久化。在整个脚本生命周期内，记录字面意义上的“上一次”执行的 MK。\n */\nlet consecutiveMkState = null;\n/**\n * **【辅助函数】处理由 MK 注入触发的冗余渲染事件**\n * @param eventType - 当前事件的类型。\n * @param currentMk - 当前消息的 MK。\n * @param mkToIgnore - 当前的忽略规则。\n * @returns {{ shouldSkip: boolean; newIgnoreRule: IgnoreRule | null }} - 返回是否应跳过此事件，以及更新后的忽略规则。\n */\nfunction handleRedundantRenderEvent(eventType, currentMk, mkToIgnore) {\n    if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && currentMk === mkToIgnore.mk) {\n        logger.log('handleRedundantRenderEvent', `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`);\n        mkToIgnore.ignoreCount--;\n        if (mkToIgnore.ignoreCount <= 0) {\n            mkToIgnore = null; // 忽略次数用完，重置\n            logger.log('handleRedundantRenderEvent', `忽略次数用完`);\n        }\n        return { shouldSkip: true, newIgnoreRule: mkToIgnore };\n    }\n    return { shouldSkip: false, newIgnoreRule: mkToIgnore };\n}\n/**\n * **【辅助函数】更新连续处理计数**\n * @returns {number} - 返回更新后的连续处理次数。\n */\nfunction updateConsecutiveMkCount() {\n    const mk = _utils_log__WEBPACK_IMPORTED_MODULE_4__.logContext.mk;\n    if (mk && consecutiveMkState && consecutiveMkState.mk === mk) {\n        logger.debug('updateConsecutiveMkCount', `连续处理写入/同步操作的 MK: ${mk}。旧计数: ${consecutiveMkState.count}，新计数: ${consecutiveMkState.count + 1}`);\n        consecutiveMkState.count++;\n    }\n    else {\n        logger.debug('updateConsecutiveMkCount', `新的写入/同步操作的 MK: ${mk}。重置计数为 1。前一个 MK 是: ${consecutiveMkState?.mk}`);\n        consecutiveMkState = { mk: mk, count: 1 };\n    }\n    return consecutiveMkState.count;\n}\n/**\n * **【任务执行器】**\n * 负责执行单个事件任务，包含所有前置、后置处理和错误捕获。\n * @param {EventJob} job - 要执行的事件任务。\n * @param {IgnoreRule | null} mkToIgnore - 当前的忽略规则。**作用域**: 仅在单次批处理 (event queue processing loop) 中生效。\n * @returns {Promise<IgnoreRule | null>} - 返回更新后的忽略规则。\n */\nasync function dispatchAndExecuteTask(job, mkToIgnore) {\n    const { type: eventType } = job;\n    const eventGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_8__.getEventGroup)(eventType);\n    let message_id = null;\n    // 在每轮任务开始时，初始化操作记录器\n    const actionsTaken = { rollback: false, apply: false, resync: false, api: false, apiWrite: false };\n    try {\n        // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n        const { mk, message_id: msgId, isNewKey } = await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_0__.ensureMkForLatestMessage)();\n        if (!mk || msgId === null) {\n            logger.warn('dispatchAndExecuteTask', '无法获取有效的 MK 或消息 ID，跳过任务执行。');\n            return mkToIgnore;\n        }\n        _utils_log__WEBPACK_IMPORTED_MODULE_4__.logContext.mk = mk;\n        message_id = msgId;\n        // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就创建或更新忽略规则。\n        if (isNewKey && mk) {\n            mkToIgnore = {\n                mk: mk,\n                ignoreCount: RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n            };\n        }\n        // **核心优化**: 检查并处理由 MK 注入触发的冗余渲染事件。\n        const { shouldSkip, newIgnoreRule } = handleRedundantRenderEvent(eventType, mk, mkToIgnore);\n        mkToIgnore = newIgnoreRule; // 更新忽略规则的状态\n        if (shouldSkip) {\n            // 如果事件被忽略，则直接返回，不更新连续处理计数\n            return mkToIgnore;\n        }\n        logger.log('dispatchAndExecuteTask', `执行任务: ${eventType} (分组: ${eventGroup})`);\n        // **任务分发**\n        // 在分发前，准备好可能需要发送 writeDone 事件的 payload\n        const { meta: metaData, stat: statData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.getEraData)();\n        const payload = {\n            mk: mk,\n            message_id: message_id,\n            actions: actionsTaken,\n            selectedMks: _.get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_2__.SEL_PATH, []),\n            editLogs: _.get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_2__.LOGS_PATH, {}),\n            stat: statData,\n            statWithoutMeta: (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.removeMetaFields)(statData),\n            consecutiveProcessingCount: 1, // 初始值\n        };\n        switch (eventGroup) {\n            case 'INIT':\n                (0,_scriptIniter_settings__WEBPACK_IMPORTED_MODULE_1__.initializeExternalSettings)();\n                // 为了兼容旧版酒馆的swipe逻辑，这里也调用同步\n                payload.consecutiveProcessingCount = updateConsecutiveMkCount();\n                await (0,_handlers_sync__WEBPACK_IMPORTED_MODULE_6__.handleSyncEvent)(job, actionsTaken, payload);\n                break;\n            case 'SYNC':\n                payload.consecutiveProcessingCount = updateConsecutiveMkCount();\n                await (0,_handlers_sync__WEBPACK_IMPORTED_MODULE_6__.handleSyncEvent)(job, actionsTaken, payload);\n                break;\n            case 'API':\n                (0,_handlers_api_dispatcher__WEBPACK_IMPORTED_MODULE_5__.handleApiEvent)(job, actionsTaken, payload);\n                break;\n            case 'UPDATE_MK_ONLY':\n                await (0,_handlers_updateMkOnly__WEBPACK_IMPORTED_MODULE_7__.handleUpdateMkOnlyEvent)();\n                break;\n        }\n    }\n    catch (error) {\n        logger.error('dispatchAndExecuteTask', `事件 ${eventType} 处理异常: ${error}`, error);\n    }\n    finally {\n        // 清理日志上下文，为下一个事件做准备\n        _utils_log__WEBPACK_IMPORTED_MODULE_4__.logContext.mk = '';\n        // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n        //暂时取消等待逻辑，提高即时性。\n        //await new Promise(resolve => setTimeout(resolve, 50));\n    }\n    return mkToIgnore;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9kaXNwYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBYTtBQUU2QztBQUNZO0FBQ2I7QUFDUTtBQUNmO0FBQ1M7QUFDVDtBQUNnQjtBQUNmO0FBR25ELE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCOzs7O0dBSUc7QUFDSCxNQUFNLDBDQUEwQyxHQUFHLENBQUMsQ0FBQztBQW9CckQ7Ozs7R0FJRztBQUNILElBQUksa0JBQWtCLEdBQThCLElBQUksQ0FBQztBQUV6RDs7Ozs7O0dBTUc7QUFDSCxTQUFTLDBCQUEwQixDQUNqQyxTQUFpQixFQUNqQixTQUF3QixFQUN4QixVQUE2QjtJQUU3QixJQUFJLFVBQVUsSUFBSSxTQUFTLEtBQUssYUFBYSxDQUFDLDBCQUEwQixJQUFJLFNBQVMsS0FBSyxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDeEcsTUFBTSxDQUFDLEdBQUcsQ0FDUiw0QkFBNEIsRUFDNUIsV0FBVyxVQUFVLENBQUMsRUFBRSx5QkFBeUIsVUFBVSxDQUFDLFdBQVcsR0FBRyxDQUFDLEVBQUUsQ0FDOUUsQ0FBQztRQUNGLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN6QixJQUFJLFVBQVUsQ0FBQyxXQUFXLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDaEMsVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLFlBQVk7WUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBQ0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxDQUFDO0lBQ3pELENBQUM7SUFDRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLENBQUM7QUFDMUQsQ0FBQztBQUVEOzs7R0FHRztBQUNILFNBQVMsd0JBQXdCO0lBQy9CLE1BQU0s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cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2Rpc3BhdGNoZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UgfSBmcm9tICcuLi9jb3JlL2tleS9tayc7XG5pbXBvcnQgeyBpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncyB9IGZyb20gJy4uL3NjcmlwdEluaXRlci9zZXR0aW5ncyc7XG5pbXBvcnQgeyBMT0dTX1BBVEgsIFNFTF9QQVRIIH0gZnJvbSAnLi4vdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IGdldEVyYURhdGEsIHJlbW92ZU1ldGFGaWVsZHMgfSBmcm9tICcuLi91dGlscy9lcmFfZGF0YSc7XG5pbXBvcnQgeyBsb2dDb250ZXh0LCBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xuaW1wb3J0IHsgaGFuZGxlQXBpRXZlbnQgfSBmcm9tICcuL2hhbmRsZXJzL2FwaS9kaXNwYXRjaGVyJztcbmltcG9ydCB7IGhhbmRsZVN5bmNFdmVudCB9IGZyb20gJy4vaGFuZGxlcnMvc3luYyc7XG5pbXBvcnQgeyBoYW5kbGVVcGRhdGVNa09ubHlFdmVudCB9IGZyb20gJy4vaGFuZGxlcnMvdXBkYXRlTWtPbmx5JztcbmltcG9ydCB7IEV2ZW50Sm9iLCBnZXRFdmVudEdyb3VwIH0gZnJvbSAnLi9tZXJnZXInO1xuaW1wb3J0IHsgQWN0aW9uc1Rha2VuIH0gZnJvbSAnLi90eXBlcyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge251bWJlcn0gUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OXG4gKiBAZGVzY3JpcHRpb24g5b2TIGBlbnN1cmVNZXNzYWdlS2V5YCDms6jlhaXkuIDkuKrmlrDnmoQgTUsg5ZCO77yM6ZyA6KaB5b+955Wl55qE55Sx6K+l5pON5L2c6Kem5Y+R55qEIGBjaGFyYWN0ZXJfbWVzc2FnZV9yZW5kZXJlZGAg5LqL5Lu255qE5pWw6YeP44CCXG4gKiDpgJrluLjorr7nva7kuLogMe+8jOWboOS4uuS4gOasoea2iOaBr+WGheWuueabtOaWsOmAmuW4uOWPquS8muinpuWPkeS4gOasoea4suafk+S6i+S7tuOAglxuICovXG5jb25zdCBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT04gPSAxO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgSWdub3JlUnVsZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huWboCBNSyDms6jlhaXogIzpnIDopoHlv73nlaXlkI7nu63muLLmn5Pkuovku7bnmoTop4TliJnjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJZ25vcmVSdWxlIHtcbiAgbWs6IHN0cmluZztcbiAgaWdub3JlQ291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIENvbnNlY3V0aXZlTWtTdGF0ZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6hueUqOS6jui/vei4quWQjOS4gOS4qiBNSyDooqvov57nu63lpITnkIbmrKHmlbDnmoTnirbmgIHjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb25zZWN1dGl2ZU1rU3RhdGUge1xuICBtazogc3RyaW5nIHwgbnVsbDtcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAdmFyIHtDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsfSBjb25zZWN1dGl2ZU1rU3RhdGVcbiAqIEBkZXNjcmlwdGlvbiDov73ouKrlkIzkuIDkuKogTUsg6KKr6L+e57ut5aSE55CG5qyh5pWw55qE54q25oCB44CCXG4gKiAqKuS9nOeUqOWfnyoqOiDot6jmibnmrKHmjIHkuYXljJbjgILlnKjmlbTkuKrohJrmnKznlJ/lkb3lkajmnJ/lhoXvvIzorrDlvZXlrZfpnaLmhI/kuYnkuIrnmoTigJzkuIrkuIDmrKHigJ3miafooYznmoQgTUvjgIJcbiAqL1xubGV0IGNvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbCA9IG51bGw7XG5cbi8qKlxuICogKirjgJDovoXliqnlh73mlbDjgJHlpITnkIbnlLEgTUsg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu2KipcbiAqIEBwYXJhbSBldmVudFR5cGUgLSDlvZPliY3kuovku7bnmoTnsbvlnovjgIJcbiAqIEBwYXJhbSBjdXJyZW50TWsgLSDlvZPliY3mtojmga/nmoQgTUvjgIJcbiAqIEBwYXJhbSBta1RvSWdub3JlIC0g5b2T5YmN55qE5b+955Wl6KeE5YiZ44CCXG4gKiBAcmV0dXJucyB7eyBzaG91bGRTa2lwOiBib29sZWFuOyBuZXdJZ25vcmVSdWxlOiBJZ25vcmVSdWxlIHwgbnVsbCB9fSAtIOi/lOWbnuaYr+WQpuW6lOi3s+i/h+atpOS6i+S7tu+8jOS7peWPiuabtOaWsOWQjueahOW/veeVpeinhOWImeOAglxuICovXG5mdW5jdGlvbiBoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudChcbiAgZXZlbnRUeXBlOiBzdHJpbmcsXG4gIGN1cnJlbnRNazogc3RyaW5nIHwgbnVsbCxcbiAgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwsXG4pOiB7IHNob3VsZFNraXA6IGJvb2xlYW47IG5ld0lnbm9yZVJ1bGU6IElnbm9yZVJ1bGUgfCBudWxsIH0ge1xuICBpZiAobWtUb0lnbm9yZSAmJiBldmVudFR5cGUgPT09IHRhdmVybl9ldmVudHMuQ0hBUkFDVEVSX01FU1NBR0VfUkVOREVSRUQgJiYgY3VycmVudE1rID09PSBta1RvSWdub3JlLm1rKSB7XG4gICAgbG9nZ2VyLmxvZyhcbiAgICAgICdoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudCcsXG4gICAgICBg5b+955Wl55SxIE1LICgke21rVG9JZ25vcmUubWt9KSDms6jlhaXop6blj5HnmoTlhpfkvZnmuLLmn5Pkuovku7bjgILliankvZnlv73nlaXmrKHmlbA6ICR7bWtUb0lnbm9yZS5pZ25vcmVDb3VudCAtIDF9YCxcbiAgICApO1xuICAgIG1rVG9JZ25vcmUuaWdub3JlQ291bnQtLTtcbiAgICBpZiAobWtUb0lnbm9yZS5pZ25vcmVDb3VudCA8PSAwKSB7XG4gICAgICBta1RvSWdub3JlID0gbnVsbDsgLy8g5b+955Wl5qyh5pWw55So5a6M77yM6YeN572uXG4gICAgICBsb2dnZXIubG9nKCdoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudCcsIGDlv73nlaXmrKHmlbDnlKjlroxgKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc2hvdWxkU2tpcDogdHJ1ZSwgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSB9O1xuICB9XG4gIHJldHVybiB7IHNob3VsZFNraXA6IGZhbHNlLCBuZXdJZ25vcmVSdWxlOiBta1RvSWdub3JlIH07XG59XG5cbi8qKlxuICogKirjgJDovoXliqnlh73mlbDjgJHmm7TmlrDov57nu63lpITnkIborqHmlbAqKlxuICogQHJldHVybnMge251bWJlcn0gLSDov5Tlm57mm7TmlrDlkI7nmoTov57nu63lpITnkIbmrKHmlbDjgIJcbiAqL1xuZnVuY3Rpb24gdXBkYXRlQ29uc2VjdXRpdmVNa0NvdW50KCk6IG51bWJlciB7XG4gIGNvbnN0IG1rID0gbG9nQ29udGV4dC5taztcbiAgaWYgKG1rICYmIGNvbnNlY3V0aXZlTWtTdGF0ZSAmJiBjb25zZWN1dGl2ZU1rU3RhdGUubWsgPT09IG1rKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgJ3VwZGF0ZUNvbnNlY3V0aXZlTWtDb3VudCcsXG4gICAgICBg6L+e57ut5aSE55CG5YaZ5YWlL+WQjOatpeaTjeS9nOeahCBNSzogJHtta33jgILml6forqHmlbA6ICR7Y29uc2VjdXRpdmVNa1N0YXRlLmNvdW50fe+8jOaWsOiuoeaVsDogJHtjb25zZWN1dGl2ZU1rU3RhdGUuY291bnQgKyAxfWAsXG4gICAgKTtcbiAgICBjb25zZWN1dGl2ZU1rU3RhdGUuY291bnQrKztcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAndXBkYXRlQ29uc2VjdXRpdmVNa0NvdW50JyxcbiAgICAgIGDmlrDnmoTlhpnlhaUv5ZCM5q2l5pON5L2c55qEIE1LOiAke21rfeOAgumHjee9ruiuoeaVsOS4uiAx44CC5YmN5LiA5LiqIE1LIOaYrzogJHtjb25zZWN1dGl2ZU1rU3RhdGU/Lm1rfWAsXG4gICAgKTtcbiAgICBjb25zZWN1dGl2ZU1rU3RhdGUgPSB7IG1rOiBtaywgY291bnQ6IDEgfTtcbiAgfVxuICByZXR1cm4gY29uc2VjdXRpdmVNa1N0YXRlLmNvdW50O1xufVxuXG4vKipcbiAqICoq44CQ5Lu75Yqh5omn6KGM5Zmo44CRKipcbiAqIOi0n+i0o+aJp+ihjOWNleS4quS6i+S7tuS7u+WKoe+8jOWMheWQq+aJgOacieWJjee9ruOAgeWQjue9ruWkhOeQhuWSjOmUmeivr+aNleiOt+OAglxuICogQHBhcmFtIHtFdmVudEpvYn0gam9iIC0g6KaB5omn6KGM55qE5LqL5Lu25Lu75Yqh44CCXG4gKiBAcGFyYW0ge0lnbm9yZVJ1bGUgfCBudWxsfSBta1RvSWdub3JlIC0g5b2T5YmN55qE5b+955Wl6KeE5YiZ44CCKirkvZznlKjln58qKjog5LuF5Zyo5Y2V5qyh5om55aSE55CGIChldmVudCBxdWV1ZSBwcm9jZXNzaW5nIGxvb3ApIOS4reeUn+aViOOAglxuICogQHJldHVybnMge1Byb21pc2U8SWdub3JlUnVsZSB8IG51bGw+fSAtIOi/lOWbnuabtOaWsOWQjueahOW/veeVpeinhOWImeOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhqb2I6IEV2ZW50Sm9iLCBta1RvSWdub3JlOiBJZ25vcmVSdWxlIHwgbnVsbCk6IFByb21pc2U8SWdub3JlUnVsZSB8IG51bGw+IHtcbiAgY29uc3QgeyB0eXBlOiBldmVudFR5cGUgfSA9IGpvYjtcbiAgY29uc3QgZXZlbnRHcm91cCA9IGdldEV2ZW50R3JvdXAoZXZlbnRUeXBlKTtcbiAgbGV0IG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXG4gIC8vIOWcqOavj+i9ruS7u+WKoeW8gOWni+aXtu+8jOWIneWni+WMluaTjeS9nOiusOW9leWZqFxuICBjb25zdCBhY3Rpb25zVGFrZW46IEFjdGlvbnNUYWtlbiA9IHsgcm9sbGJhY2s6IGZhbHNlLCBhcHBseTogZmFsc2UsIHJlc3luYzogZmFsc2UsIGFwaTogZmFsc2UsIGFwaVdyaXRlOiBmYWxzZSB9O1xuXG4gIHRyeSB7XG4gICAgLy8gKirliY3nva7kv53pmpwqKjog56Gu5L+d5pyA5paw5raI5oGv5pyJIE1LIOW5tuiuvue9ruaXpeW/l+S4iuS4i+aWh+OAglxuICAgIGNvbnN0IHsgbWssIG1lc3NhZ2VfaWQ6IG1zZ0lkLCBpc05ld0tleSB9ID0gYXdhaXQgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlKCk7XG4gICAgaWYgKCFtayB8fCBtc2dJZCA9PT0gbnVsbCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLCAn5peg5rOV6I635Y+W5pyJ5pWI55qEIE1LIOaIlua2iOaBryBJRO+8jOi3s+i/h+S7u+WKoeaJp+ihjOOAgicpO1xuICAgICAgcmV0dXJuIG1rVG9JZ25vcmU7XG4gICAgfVxuICAgIGxvZ0NvbnRleHQubWsgPSBtaztcbiAgICBtZXNzYWdlX2lkID0gbXNnSWQ7XG5cbiAgICAvLyDlpoLmnpwgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlIOWImuWImuazqOWFpeS6huS4gOS4quaWsOeahCBNS++8jOWwseWIm+W7uuaIluabtOaWsOW/veeVpeinhOWImeOAglxuICAgIGlmIChpc05ld0tleSAmJiBtaykge1xuICAgICAgbWtUb0lnbm9yZSA9IHtcbiAgICAgICAgbWs6IG1rLFxuICAgICAgICBpZ25vcmVDb3VudDogUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyAqKuaguOW/g+S8mOWMlioqOiDmo4Dmn6XlubblpITnkIbnlLEgTUsg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu244CCXG4gICAgY29uc3QgeyBzaG91bGRTa2lwLCBuZXdJZ25vcmVSdWxlIH0gPSBoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudChldmVudFR5cGUsIG1rLCBta1RvSWdub3JlKTtcbiAgICBta1RvSWdub3JlID0gbmV3SWdub3JlUnVsZTsgLy8g5pu05paw5b+955Wl6KeE5YiZ55qE54q25oCBXG4gICAgaWYgKHNob3VsZFNraXApIHtcbiAgICAgIC8vIOWmguaenOS6i+S7tuiiq+W/veeVpe+8jOWImeebtOaOpei/lOWbnu+8jOS4jeabtOaWsOi/nue7reWkhOeQhuiuoeaVsFxuICAgICAgcmV0dXJuIG1rVG9JZ25vcmU7XG4gICAgfVxuXG4gICAgbG9nZ2VyLmxvZygnZGlzcGF0Y2hBbmRFeGVjdXRlVGFzaycsIGDmiafooYzku7vliqE6ICR7ZXZlbnRUeXBlfSAo5YiG57uEOiAke2V2ZW50R3JvdXB9KWApO1xuXG4gICAgLy8gKirku7vliqHliIblj5EqKlxuICAgIC8vIOWcqOWIhuWPkeWJje+8jOWHhuWkh+WlveWPr+iDvemcgOimgeWPkemAgSB3cml0ZURvbmUg5LqL5Lu255qEIHBheWxvYWRcbiAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhLCBzdGF0OiBzdGF0RGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBtazogbWssXG4gICAgICBtZXNzYWdlX2lkOiBtZXNzYWdlX2lkLFxuICAgICAgYWN0aW9uczogYWN0aW9uc1Rha2VuLFxuICAgICAgc2VsZWN0ZWRNa3M6IF8uZ2V0KG1ldGFEYXRhLCBTRUxfUEFUSCwgW10pLFxuICAgICAgZWRpdExvZ3M6IF8uZ2V0KG1ldGFEYXRhLCBMT0dTX1BBVEgsIHt9KSxcbiAgICAgIHN0YXQ6IHN0YXREYXRhLFxuICAgICAgc3RhdFdpdGhvdXRNZXRhOiByZW1vdmVNZXRhRmllbGRzKHN0YXREYXRhKSxcbiAgICAgIGNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50OiAxLCAvLyDliJ3lp4vlgLxcbiAgICB9O1xuXG4gICAgc3dpdGNoIChldmVudEdyb3VwKSB7XG4gICAgICBjYXNlICdJTklUJzpcbiAgICAgICAgaW5pdGlhbGl6ZUV4dGVybmFsU2V0dGluZ3MoKTtcbiAgICAgICAgLy8g5Li65LqG5YW85a655pen54mI6YWS6aaG55qEc3dpcGXpgLvovpHvvIzov5nph4zkuZ/osIPnlKjlkIzmraVcbiAgICAgICAgcGF5bG9hZC5jb25zZWN1dGl2ZVByb2Nlc3NpbmdDb3VudCA9IHVwZGF0ZUNvbnNlY3V0aXZlTWtDb3VudCgpO1xuICAgICAgICBhd2FpdCBoYW5kbGVTeW5jRXZlbnQoam9iLCBhY3Rpb25zVGFrZW4sIHBheWxvYWQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1NZTkMnOlxuICAgICAgICBwYXlsb2FkLmNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50ID0gdXBkYXRlQ29uc2VjdXRpdmVNa0NvdW50KCk7XG4gICAgICAgIGF3YWl0IGhhbmRsZVN5bmNFdmVudChqb2IsIGFjdGlvbnNUYWtlbiwgcGF5bG9hZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQVBJJzpcbiAgICAgICAgaGFuZGxlQXBpRXZlbnQoam9iLCBhY3Rpb25zVGFrZW4sIHBheWxvYWQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1VQREFURV9NS19PTkxZJzpcbiAgICAgICAgYXdhaXQgaGFuZGxlVXBkYXRlTWtPbmx5RXZlbnQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignZGlzcGF0Y2hBbmRFeGVjdXRlVGFzaycsIGDkuovku7YgJHtldmVudFR5cGV9IOWkhOeQhuW8guW4uDogJHtlcnJvcn1gLCBlcnJvcik7XG4gIH0gZmluYWxseSB7XG4gICAgLy8g5riF55CG5pel5b+X5LiK5LiL5paH77yM5Li65LiL5LiA5Liq5LqL5Lu25YGa5YeG5aSHXG4gICAgbG9nQ29udGV4dC5tayA9ICcnO1xuXG4gICAgLy8gKiroioLmtYEqKjog5Zyo5q+P5Liq54us56uL5Lu75Yqh5ZCO6YO96L+b6KGM55+t5pqC562J5b6F77yM56Gu5L+d6YWS6aaG5bqV5bGC5pyJ5pe26Ze05a6M5oiQ5YW25byC5q2l5pON5L2c44CCXG4gICAgLy/mmoLml7blj5bmtojnrYnlvoXpgLvovpHvvIzmj5Dpq5jljbPml7bmgKfjgIJcbiAgICAvL2F3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICB9XG5cbiAgcmV0dXJuIG1rVG9JZ25vcmU7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/dispatcher.ts\n\n}");
  },
  "./src/ERA变量框架/events/emitters/events.ts": 
  /*!***********************************************!*\
  !*** ./src/ERA变量框架/events/emitters/events.ts ***!
  \***********************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   debouncedEmitApiWrite: () => (/* binding */ debouncedEmitApiWrite),\n/* harmony export */   emitWriteDoneEvent: () => (/* binding */ emitWriteDoneEvent)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger();\n// ==================================================================\n// API 事件广播器\n// ==================================================================\n/**\n * 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件。\n * 这个事件通知主循环，有一个由 API 触发的、需要处理的变量变更。\n */\nconst debouncedEmitApiWrite = _.debounce(() => {\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n}, 50, // API 调用的防抖改成 50 毫秒，提高即时性\n{ leading: false, trailing: true });\n// ==================================================================\n// 核心事件广播器\n// ==================================================================\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）成功完成后，应调用此函数。\n * 它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {WriteDonePayload} payload - 包含写入操作关键信息的事件负载。\n */\nfunction emitWriteDoneEvent(payload) {\n    // 在广播前，对需要暴露给外部的数据进行反转义\n    const unescapedPayload = {\n        ...payload,\n        stat: (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.unescapeEraData)(payload.stat),\n        statWithoutMeta: (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.unescapeEraData)(payload.statWithoutMeta),\n    };\n    logger.debug('emitWriteDoneEvent', 'writeDone事件广播数据反转义', {\n        before: { stat: payload.stat, statWithoutMeta: payload.statWithoutMeta },\n        after: { stat: unescapedPayload.stat, statWithoutMeta: unescapedPayload.statWithoutMeta },\n    });\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_EVENT_EMITTER.WRITE_DONE, unescapedPayload);\n    logger.log('emitWriteDoneEvent', `已触发 ${_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_EVENT_EMITTER.WRITE_DONE} 事件。操作: ${JSON.stringify(payload.actions)}, MK: ${payload.mk}, MsgID: ${payload.message_id}, 连续处理次数: ${payload.consecutiveProcessingCount}`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9lbWl0dGVycy9ldmVudHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBYTtBQUUrRDtBQUN6QjtBQUNWO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCLHFFQUFxRTtBQUNyRSxZQUFZO0FBQ1oscUVBQXFFO0FBRXJFOzs7R0FHRztBQUNJLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FDN0MsR0FBRyxFQUFFO0lBQ0gsU0FBUyxDQUFDLCtEQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsV0FBVywrREFBaUIsQ0FBQyxTQUFTLE1BQU0sQ0FBQyxDQUFDO0FBQ3BGLENBQUMsRUFDRCxFQUFFLEVBQUUsMEJBQTBCO0FBQzlCLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQ25DLENBQUM7QUFFRixxRUFBcUU7QUFDckUsVUFBVTtBQUNWLHFFQUFxRTtBQUVyRTs7Ozs7O0dBTUc7QUFDSSxTQUFTLGtCQUFrQixDQUFDLE9BQXlCO0lBQzFELHdCQUF3QjtJQUN4QixNQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLEdBQUcsT0FBTztRQUNWLElBQUksRUFBRSw0REFBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDbkMsZUFBZSxFQUFFLDREQUFlLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQztLQUMxRCxDQUFDO0lBRUYsTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxvQkFBb0IsRUFBRTtRQUN2RCxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsT0FBTyxDQUFDLGVBQWUsRUFBRTtRQUN4RSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsQ0FBQyxlQUFlLEVBQUU7S0FDMUYsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLCtEQUFpQixDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzFELE1BQU0sQ0FBQyxHQUFHLENBQ1Isb0JBQW9CLEVBQ3BCLE9BQU8sK0RBQWlCLENBQUMsVUFBVSxXQUFXLElBQUksQ0FBQyxTQUFTLENBQzFELE9BQU8sQ0FBQyxPQUFPLENBQ2hCLFNBQVMsT0FBTyxDQUFDLEVBQUUsWUFBWSxPQUFPLENBQUMsVUFBVSxhQUFhLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSxDQUNwRyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9lbWl0dGVycy9ldmVudHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfRVZFTlRfRU1JVFRFUiwgV3JpdGVEb25lUGF5bG9hZCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyB1bmVzY2FwZUVyYURhdGEgfSBmcm9tICcuLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUEkg5LqL5Lu25bm/5pKt5ZmoXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDkvb/nlKggbG9kYXNoLmRlYm91bmNlIOWIm+W7uuS4gOS4qumYsuaKluWHveaVsOadpeWPkemAgSBBUEkg5YaZ5YWl5LqL5Lu244CCXG4gKiDov5nkuKrkuovku7bpgJrnn6XkuLvlvqrnjq/vvIzmnInkuIDkuKrnlLEgQVBJIOinpuWPkeeahOOAgemcgOimgeWkhOeQhueahOWPmOmHj+WPmOabtOOAglxuICovXG5leHBvcnQgY29uc3QgZGVib3VuY2VkRW1pdEFwaVdyaXRlID0gXy5kZWJvdW5jZShcbiAgKCkgPT4ge1xuICAgIGV2ZW50RW1pdChFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEUpO1xuICAgIGxvZ2dlci5sb2coJ2RlYm91bmNlZEVtaXRBcGlXcml0ZScsIGDlt7Lop6blj5HlkIjlubblkI7nmoQgJHtFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEV9IOS6i+S7tuOAgmApO1xuICB9LFxuICA1MCwgLy8gQVBJIOiwg+eUqOeahOmYsuaKluaUueaIkCA1MCDmr6vnp5LvvIzmj5Dpq5jljbPml7bmgKdcbiAgeyBsZWFkaW5nOiBmYWxzZSwgdHJhaWxpbmc6IHRydWUgfSxcbik7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5qC45b+D5LqL5Lu25bm/5pKt5ZmoXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOW5v+aSreWZqOOAkSoqIOinpuWPkSBgZXJhOndyaXRlRG9uZWAg5LqL5Lu244CCXG4gKiDlvZPkuIDmrKHlrozmlbTnmoTlj5jph4/lhpnlhaXmk43kvZzvvIjljIXmi6zlop7jgIHliKDjgIHmlLnvvInmiJDlip/lrozmiJDlkI7vvIzlupTosIPnlKjmraTlh73mlbDjgIJcbiAqIOWug+WQkeWklumDqOiEmuacrOW5v+aSreS4gOS4quS6i+S7tu+8jOmAmuefpeWug+S7rOWPmOmHj+eKtuaAgeW3suWPkeeUn+aUueWPmO+8jOW5tuaPkOS+m+ivpue7hueahOS4iuS4i+aWh+OAglxuICpcbiAqIEBwYXJhbSB7V3JpdGVEb25lUGF5bG9hZH0gcGF5bG9hZCAtIOWMheWQq+WGmeWFpeaTjeS9nOWFs+mUruS/oeaBr+eahOS6i+S7tui0n+i9veOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZW1pdFdyaXRlRG9uZUV2ZW50KHBheWxvYWQ6IFdyaXRlRG9uZVBheWxvYWQpIHtcbiAgLy8g5Zyo5bm/5pKt5YmN77yM5a+56ZyA6KaB5pq06Zyy57uZ5aSW6YOo55qE5pWw5o2u6L+b6KGM5Y+N6L2s5LmJXG4gIGNvbnN0IHVuZXNjYXBlZFBheWxvYWQgPSB7XG4gICAgLi4ucGF5bG9hZCxcbiAgICBzdGF0OiB1bmVzY2FwZUVyYURhdGEocGF5bG9hZC5zdGF0KSxcbiAgICBzdGF0V2l0aG91dE1ldGE6IHVuZXNjYXBlRXJhRGF0YShwYXlsb2FkLnN0YXRXaXRob3V0TWV0YSksXG4gIH07XG5cbiAgbG9nZ2VyLmRlYnVnKCdlbWl0V3JpdGVEb25lRXZlbnQnLCAnd3JpdGVEb25l5LqL5Lu25bm/5pKt5pWw5o2u5Y+N6L2s5LmJJywge1xuICAgIGJlZm9yZTogeyBzdGF0OiBwYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogcGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgICBhZnRlcjogeyBzdGF0OiB1bmVzY2FwZWRQYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogdW5lc2NhcGVkUGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgfSk7XG5cbiAgZXZlbnRFbWl0KEVSQV9FVkVOVF9FTUlUVEVSLldSSVRFX0RPTkUsIHVuZXNjYXBlZFBheWxvYWQpO1xuICBsb2dnZXIubG9nKFxuICAgICdlbWl0V3JpdGVEb25lRXZlbnQnLFxuICAgIGDlt7Lop6blj5EgJHtFUkFfRVZFTlRfRU1JVFRFUi5XUklURV9ET05FfSDkuovku7bjgILmk43kvZw6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICBwYXlsb2FkLmFjdGlvbnMsXG4gICAgKX0sIE1LOiAke3BheWxvYWQubWt9LCBNc2dJRDogJHtwYXlsb2FkLm1lc3NhZ2VfaWR9LCDov57nu63lpITnkIbmrKHmlbA6ICR7cGF5bG9hZC5jb25zZWN1dGl2ZVByb2Nlc3NpbmdDb3VudH1gLFxuICApO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/emitters/events.ts\n\n}");
  },
  "./src/ERA变量框架/events/handlers/api/dispatcher.ts": 
  /*!*******************************************************!*\
  !*** ./src/ERA变量框架/events/handlers/api/dispatcher.ts ***!
  \*******************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handleApiEvent: () => (/* binding */ handleApiEvent)\n/* harmony export */ });\n/* harmony import */ var _handler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./handler */ "./src/ERA变量框架/events/handlers/api/handler.ts");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/constants */ "./src/ERA变量框架/utils/constants.ts");\n\n\n\nfunction handleApiEvent(job, actionsTaken, payload) {\n    const { type: eventType, detail } = job;\n    actionsTaken.api = true;\n    // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n    if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.INSERT_BY_OBJECT)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.insertByObject)(detail);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.UPDATE_BY_OBJECT)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.updateByObject)(detail);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.INSERT_BY_PATH)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.insertByPath)(detail.path, detail.value);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.UPDATE_BY_PATH)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.updateByPath)(detail.path, detail.value);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.DELETE_BY_OBJECT)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.deleteByObject)(detail);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.DELETE_BY_PATH)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.deleteByPath)(detail.path);\n    else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS.GET_CURRENT_VARS)\n        (0,_handler__WEBPACK_IMPORTED_MODULE_0__.getCurrentVars)(payload);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9oYW5kbGVycy9hcGkvZGlzcGF0Y2hlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBYTtBQVVNO0FBQ3lEO0FBSXJFLFNBQVMsY0FBYyxDQUFDLEdBQWEsRUFBRSxZQUEwQixFQUFFLE9BQXlCO0lBQ2pHLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztJQUN4QyxZQUFZLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUV4Qix1REFBdUQ7SUFDdkQsSUFBSSxTQUFTLEtBQUssNERBQWMsQ0FBQyxnQkFBZ0I7UUFBRSx3REFBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3JFLElBQUksU0FBUyxLQUFLLDREQUFjLENBQUMsZ0JBQWdCO1FBQUUsd0RBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMxRSxJQUFJLFNBQVMsS0FBSyw0REFBYyxDQUFDLGNBQWM7UUFBRSxzREFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pGLElBQUksU0FBUyxLQUFLLDREQUFjLENBQUMsY0FBYztRQUFFLHNEQUFZLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDekYsSUFBSSxTQUFTLEtBQUssNERBQWMsQ0FBQyxnQkFBZ0I7UUFBRSx3REFBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzFFLElBQUksU0FBUyxLQUFLLDREQUFjLENBQUMsY0FBYztRQUFFLHNEQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNFLElBQUksU0FBUyxLQUFLLDREQUFjLENBQUMsZ0JBQWdCO1FBQUUsd0RBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNsRixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2hhbmRsZXJzL2FwaS9kaXNwYXRjaGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHtcbiAgZGVsZXRlQnlPYmplY3QsXG4gIGRlbGV0ZUJ5UGF0aCxcbiAgZ2V0Q3VycmVudFZhcnMsXG4gIGluc2VydEJ5T2JqZWN0LFxuICBpbnNlcnRCeVBhdGgsXG4gIHVwZGF0ZUJ5T2JqZWN0LFxuICB1cGRhdGVCeVBhdGgsXG59IGZyb20gJy4vaGFuZGxlcic7XG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgV3JpdGVEb25lUGF5bG9hZCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBFdmVudEpvYiB9IGZyb20gJy4uLy4uL21lcmdlcic7XG5pbXBvcnQgeyBBY3Rpb25zVGFrZW4gfSBmcm9tICcuLi8uLi90eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVBcGlFdmVudChqb2I6IEV2ZW50Sm9iLCBhY3Rpb25zVGFrZW46IEFjdGlvbnNUYWtlbiwgcGF5bG9hZDogV3JpdGVEb25lUGF5bG9hZCk6IHZvaWQge1xuICBjb25zdCB7IHR5cGU6IGV2ZW50VHlwZSwgZGV0YWlsIH0gPSBqb2I7XG4gIGFjdGlvbnNUYWtlbi5hcGkgPSB0cnVlO1xuXG4gIC8vIEFQSSDkuovku7bmmK/igJzljbPlj5HljbPlv5jigJ3nmoTvvIzlkIzmraXosIPnlKjlpITnkIblmajlsIbku7vliqHmjqjlhaUgYXBpLnRzIOeahOmYn+WIl+WQjueri+WNs+i/lOWbnu+8jOS4jemYu+WhnuS6i+S7tumYn+WIl+OAglxuICBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5JTlNFUlRfQllfT0JKRUNUKSBpbnNlcnRCeU9iamVjdChkZXRhaWwpO1xuICBlbHNlIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLlVQREFURV9CWV9PQkpFQ1QpIHVwZGF0ZUJ5T2JqZWN0KGRldGFpbCk7XG4gIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuSU5TRVJUX0JZX1BBVEgpIGluc2VydEJ5UGF0aChkZXRhaWwucGF0aCwgZGV0YWlsLnZhbHVlKTtcbiAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5VUERBVEVfQllfUEFUSCkgdXBkYXRlQnlQYXRoKGRldGFpbC5wYXRoLCBkZXRhaWwudmFsdWUpO1xuICBlbHNlIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLkRFTEVURV9CWV9PQkpFQ1QpIGRlbGV0ZUJ5T2JqZWN0KGRldGFpbCk7XG4gIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuREVMRVRFX0JZX1BBVEgpIGRlbGV0ZUJ5UGF0aChkZXRhaWwucGF0aCk7XG4gIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuR0VUX0NVUlJFTlRfVkFSUykgZ2V0Q3VycmVudFZhcnMocGF5bG9hZCk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/handlers/api/dispatcher.ts\n\n}');
  },
  "./src/ERA变量框架/events/handlers/api/handler.ts": 
  /*!****************************************************!*\
  !*** ./src/ERA变量框架/events/handlers/api/handler.ts ***!
  \****************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteByObject: () => (/* binding */ deleteByObject),\n/* harmony export */   deleteByPath: () => (/* binding */ deleteByPath),\n/* harmony export */   getCurrentVars: () => (/* binding */ getCurrentVars),\n/* harmony export */   insertByObject: () => (/* binding */ insertByObject),\n/* harmony export */   insertByPath: () => (/* binding */ insertByPath),\n/* harmony export */   updateByObject: () => (/* binding */ updateByObject),\n/* harmony export */   updateByPath: () => (/* binding */ updateByPath)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _emitters_events__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../emitters/events */ \"./src/ERA变量框架/events/emitters/events.ts\");\n/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger();\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job) {\n    // 1. 生成指令块\n    const contentString = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.J)(job.blockContent);\n    const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n    // 2. 查找目标消息并追加内容\n    const lastAiMessage = await (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!lastAiMessage) {\n        logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n        return;\n    }\n    const originalContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(lastAiMessage) ?? '';\n    const newContent = originalContent + block;\n    logger.log('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n    // 3. 实时更新消息内容\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.updateMessageContent)(lastAiMessage, newContent);\n    // 4. 调用防抖函数来调度写入事件的发送\n    (0,_emitters_events__WEBPACK_IMPORTED_MODULE_3__.debouncedEmitApiWrite)();\n}\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction insertByObject(data) {\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction updateByObject(data) {\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction insertByPath(path, value) {\n    const block = _.set({}, path, value);\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction updateByPath(path, value) {\n    const block = _.set({}, path, value);\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nfunction deleteByObject(data) {\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nfunction deleteByPath(path) {\n    // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n    const block = _.set({}, path, {});\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:getCurrentVars` 事件。\n * 这个函数是空的，因为它的目的只是为了触发 writeDone 事件，以便其他组件能通过这种方式获取到最新变量。\n */\nfunction getCurrentVars(payload) {\n    (0,_emitters_events__WEBPACK_IMPORTED_MODULE_3__.emitWriteDoneEvent)(payload);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9oYW5kbGVycy9hcGkvaGFuZGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0dBZ0JHO0FBR3FDO0FBQ0k7QUFDd0Q7QUFDbEI7QUFFbEYsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxFQUFFLENBQUM7QUFRNUIscUVBQXFFO0FBQ3JFLFdBQVc7QUFDWCxzREFBc0Q7QUFDdEQscUVBQXFFO0FBRXJFOzs7Ozs7OztHQVFHO0FBRUg7Ozs7Ozs7O0dBUUc7QUFFSDs7Ozs7Ozs7Ozs7R0FXRztBQUVIOzs7Ozs7Ozs7OztHQVdHO0FBRUg7Ozs7Ozs7Ozs7Ozs7OztHQWVHO0FBRUg7Ozs7Ozs7R0FPRztBQUVILHFFQUFxRTtBQUNyRSxTQUFTO0FBQ1QscUVBQXFFO0FBRXJFOzs7O0dBSUc7QUFFSDs7OztHQUlHO0FBQ0gsS0FBSyxVQUFVLGVBQWUsQ0FBQyxHQUFnQjtJQUM3QyxXQUFXO0lBQ1gsTUFBTSxhQUFhLEdBQUcsOENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDMUMsTUFBTSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsUUFBUSxNQUFNLGFBQWEsT0FBTyxHQUFHLENBQUMsUUFBUSxHQUFHLENBQUM7SUFFMUUsaUJBQWlCO0lBQ2pCLE1BQU0sYUFBYSxHQUFHLE1BQU0saUVBQWlCLEVBQUUsQ0FBQztJQUNoRCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQzNELE9BQU87SUFDVCxDQUFDO0lBRUQsTUFBTSxlQUFlLEdBQUcsaUVBQWlCLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQy9ELE1BQU0sVUFBVSxHQUFHLGVBQWUsR0FBRyxLQUFLLENBQUM7SUFFM0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsR0FBRyxDQUFDLFFBQVEsWUFBWSxhQUFhLENBQUMsVUFBVSxLQUFLLENBQUMsQ0FBQztJQUVyRyxjQUFjO0lBQ2QsTUFBTSxvRUFBb0IsQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFdEQsc0JBQXNCO0lBQ3RCLHVFQUFxQixFQUFFLENBQUM7QUFDMUIsQ0FBQztBQUVELHFFQUFxRTtBQUNyRSxnQ0FBZ0M7QUFDaEMscUVBQXFFO0FBRXJFOzs7R0FHRztBQUNJLFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDekMsZUFBZSxDQUFDLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ3RFLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxTQUFTLGNBQWMsQ0FBQyxJQUFZO0lBQ3pDLGVBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDcEUsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSSxTQUFTLFlBQVksQ0FBQyxJQUFZLEVBQUUsS0FBVTtJQUNuRCxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckMsZUFBZSxDQUFDLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLENBQUM7QUFFRDs7OztHQUlHO0FBQ0ksU0FBUyxZQUFZLENBQUMsSUFBWSxFQUFFLEtBQVU7SUFDbkQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLGVBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDckUsQ0FBQztBQUVEOzs7R0FHRztBQUNJLFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDekMsZUFBZSxDQUFDLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ3RFLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxTQUFTLFlBQVksQ0FBQyxJQUFZO0lBQ3ZDLGdDQUFnQztJQUNoQyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDbEMsZUFBZSxDQUFDLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxTQUFTLGNBQWMsQ0FBQyxPQUF5QjtJQUN0RCxvRUFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM5QixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2hhbmRsZXJzL2FwaS9oYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWklumDqOS6i+S7tiBBUEkg5a6e546w5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+aYryBFUkEg5qGG5p625LiO5aSW6YOo6ISa5pys5Lqk5LqS55qE5o6l5Y+j5bGC44CC5a6D5a6e546w5LqG5LiA57O75YiX6Ieq5a6a5LmJ5LqL5Lu255qE5aSE55CG5Zmo44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDmoYbmnrbkuI3nm7TmjqXlkJHlpJbmmrTpnLLlh73mlbDosIPnlKjmjqXlj6PjgILlpJbpg6johJrmnKzkuI4gRVJBIOS6pOS6kueahCoq5ZSv5LiAKirmlrnlvI/mmK/pgJrov4fphZLppobnmoRcbiAqIGBldmVudEVtaXQoZXZlbnROYW1lLCBldmVudERhdGEpYCDlh73mlbDvvIzlj5HpgIHnibnlrprmoLzlvI/nmoTkuovku7bjgIJcbiAqXG4gKiBgaW5kZXgudHNgIOaooeWdl+S8muebkeWQrOi/meS6myBgZXJhOipgIOWJjee8gOeahOS6i+S7tu+8jOW5tuWwhuWFtuaOqOWFpSBgZXZlbnRfcXVldWUudHNgIOS4rei/m+ihjOWkhOeQhuOAglxuICog5LqL5Lu26Zif5YiX5pyA57uI5Lya6LCD55So5pys5paH5Lu25Lit5a+55bqU55qE5aSE55CG5Zmo5Ye95pWw77yI5aaCIGBpbnNlcnRCeU9iamVjdGDvvInjgIJcbiAqXG4gKiDmnKzmqKHlnZfkuK3nmoTlh73mlbDpgJrov4fkuIDnp43lt6flppnjgIHop6PogKbnmoTmlrnlvI/lt6XkvZzvvJrlroPku6zlnKjmnIDmlrDnmoQgQUkg5raI5oGv5pyr5bC+5Yqo5oCB5rOo5YWlXG4gKiBgPFZhcmlhYmxlSW5zZXJ0PmAg5oiWIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk5Z2X77yM54S25ZCO6LCD55So6YWS6aaG55qEIGBzZXRDaGF0TWVzc2FnZXNgIOabtOaWsOa2iOaBr+OAglxuICog6L+Z5qyh5L+u5pS55Lya6Kem5Y+RIGBjaGFyYWN0ZXJfbWVzc2FnZV9yZW5kZXJlZGAg562J5LqL5Lu277yM6KKrIEVSQSDnmoTkuLvnm5HlkKzlmajmjZXojrfvvIxcbiAqIOS7juiAjOWwhiBBUEkg6LCD55So5peg57yd5Zyw5pW05ZCI5YiwIEVSQSDnmoTljp/nlJ/op6PmnpDlkozlkIzmraXmtYHnqIvkuK3jgIJcbiAqL1xuXG5pbXBvcnQgeyBXcml0ZURvbmVQYXlsb2FkIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvY29uc3RhbnRzJztcbmltcG9ydCB7IEogfSBmcm9tICcuLi8uLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBmaW5kTGFzdEFpTWVzc2FnZSwgZ2V0TWVzc2FnZUNvbnRlbnQsIHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbWVzc2FnZSc7XG5pbXBvcnQgeyBkZWJvdW5jZWRFbWl0QXBpV3JpdGUsIGVtaXRXcml0ZURvbmVFdmVudCB9IGZyb20gJy4uLy4uL2VtaXR0ZXJzL2V2ZW50cyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLy8gQVBJIOWGmeWFpeS7u+WKoeeahOaOpeWPo+WumuS5iVxuaW50ZXJmYWNlIEFwaVdyaXRlSm9iIHtcbiAgYmxvY2tUYWc6ICdWYXJpYWJsZUluc2VydCcgfCAnVmFyaWFibGVFZGl0JyB8ICdWYXJpYWJsZURlbGV0ZSc7XG4gIGJsb2NrQ29udGVudDogb2JqZWN0O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFQSSDkuovku7blj4LogINcbi8vICjkuovku7blkI3np7DnmoTluLjph4/lrprkuYnop4Hkuo4gYGNvbnN0YW50cy50c2Ag5Lit55qEIGBFUkFfQVBJX0VWRU5UU2Ag5a+56LGhKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmluc2VydEJ5T2JqZWN0J1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+S4gOS4quWvueixoe+8jOmdnuegtOWdj+aAp+WcsOaPkuWFpeaWsOWPmOmHj+OAguWPquS8muWGmeWFpeS4jeWtmOWcqOeahOi3r+W+hOOAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOimgeaPkuWFpeeahOWPmOmHj+WvueixoeOAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOmluc2VydEJ5T2JqZWN0Jywge1xuICogICBwbGF5ZXI6IHsgbmFtZTogXCLli4fogIVcIiwgaHA6IDEwMCwgaW52ZW50b3J5OiBbXSB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTp1cGRhdGVCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzkv67mlLnlt7LlrZjlnKjnmoTlj5jph4/jgILlpoLmnpzot6/lvoTkuI3lrZjlnKjvvIzliJnlv73nlaXjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDopoHmm7TmlrDnmoTlj5jph4/lr7nosaHjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTp1cGRhdGVCeU9iamVjdCcsIHtcbiAqICAgcGxheWVyOiB7IGhwOiAxMjAsIHN0YXR1czogJ2JsZXNzZWQnIH1cbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmluc2VydEJ5UGF0aCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmjIflrprot6/lvoTlkozlgLzvvIzpnZ7noLTlnY/mgKflnLDmj5LlhaXkuIDkuKrmlrDlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDljIXlkKvot6/lvoTlkozlgLznmoTlr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXRhaWwucGF0aCAtIOWPmOmHj+eahOi3r+W+hO+8jOS9v+eUqOeCueaIluaWueaLrOWPt+ihqOekuuazleOAglxuICogQHBhcmFtIHsqfSBkZXRhaWwudmFsdWUgLSDopoHmj5LlhaXnmoTlgLzjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTppbnNlcnRCeVBhdGgnLCB7XG4gKiAgIHBhdGg6ICdwbGF5ZXIuaW52ZW50b3J5WzBdJyxcbiAqICAgdmFsdWU6IHsgbmFtZTogJ+eUn+WRveiNr+awtCcsIGNvdW50OiAzIH1cbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOnVwZGF0ZUJ5UGF0aCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmjIflrprot6/lvoTlkozlgLzvvIzkv67mlLnkuIDkuKrlt7LlrZjlnKjnmoTlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDljIXlkKvot6/lvoTlkozlgLznmoTlr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXRhaWwucGF0aCAtIOWPmOmHj+eahOi3r+W+hOOAglxuICogQHBhcmFtIHsqfSBkZXRhaWwudmFsdWUgLSDopoHorr7nva7nmoTmlrDlgLzjgILlj6/ku6XmmK/nm7TmjqXnmoTlgLzvvIzkuZ/lj6/ku6XmmK/ov5Dnrpfooajovr7lvI/jgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTp1cGRhdGVCeVBhdGgnLCB7XG4gKiAgIHBhdGg6ICdwbGF5ZXIuaHAnLFxuICogICB2YWx1ZTogJys9MTAnXG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTpkZWxldGVCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzliKDpmaTlt7LlrZjlnKjnmoTlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDmj4/ov7DopoHliKDpmaTot6/lvoTnmoTnu5PmnoTjgILlgLznmoTnu5PmnoTlhrPlrprkuobliKDpmaTooYzkuLrjgIJcbiAqIEBleGFtcGxlXG4gKiAvLyDlh4blpIfliKDpmaQgcGxheWVyLmdvbGTjgILmjIfku6TkuK0gZ29sZCDnmoTlgLzlv4XpobvmmK/nqbrlr7nosaEge31cbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHsgZ29sZDoge30gfSB9KTtcbiAqXG4gKiAvLyDlh4blpIfliKDpmaTmlbTkuKogcGxheWVyIOWvueixoeOAglxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjoge30gfSk7XG4gKlxuICogLy8gKirph43opoEqKjog5aaC5p6cIHBsYXllciDlr7nosaHljIXlkKsgZ29sZCDlkowgbWFuYSDkuKTkuKrlsZ7mgKfvvIxcbiAqIC8vIOS7peS4i+aMh+S7pOWPquS8muWIoOmZpCBnb2xkIOWSjCBtYW5h77yM6ICMIHBsYXllciDlr7nosaHmnKzouqvkvJrooqvkv53nlZnvvIjlj5jkuLrnqbrlr7nosaHvvInjgIJcbiAqIC8vIOi/meS4jiBgZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjoge30gfSlgIOeahOaViOaenOaYr+S4jeWQjOeahOOAglxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjogeyBnb2xkOiB7fSwgbWFuYToge30gfSB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTpkZWxldGVCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E77yM5Yig6Zmk5LiA5Liq5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E55qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDopoHliKDpmaTnmoTlj5jph4/nmoTot6/lvoTjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeVBhdGgnLCB7IHBhdGg6ICdwbGF5ZXIuaW52ZW50b3J5WzBdJyB9KTtcbiAqL1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWGhemDqOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICog5Zyo6IGK5aSp6K6w5b2V5Lit5p+l5om+5bm26L+U5Zue5pyA5ZCO5LiA5p2h55SxIEFJIOWPkemAgeeahOa2iOaBr+OAglxuICog6L+Z5piv5rOo5YWl5Y+Y6YeP5L+u5pS55oyH5Luk55qE55uu5qCH5raI5oGv44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnkgfCBudWxsPn0g6L+U5Zue5om+5Yiw55qE5raI5oGv5a+56LGh77yM5aaC5p6c5LiN5a2Y5ZyoIEFJIOa2iOaBr+WImei/lOWbniBudWxs44CCXG4gKi9cblxuLyoqXG4gKiDmiafooYzkuIDmrKEgQVBJIOWGmeWFpeaTjeS9nOOAglxuICog5a6D5bCG5oyH5a6a55qE5Y+Y6YeP5L+u5pS55Z2X6L+95Yqg5Yiw5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr+eahOacq+Wwvu+8jOeEtuWQjuiwg+W6puS4gOS4qiAnZXJhOmFwaVdyaXRlJyDkuovku7bjgIJcbiAqIEBwYXJhbSB7QXBpV3JpdGVKb2J9IGpvYiAtIOimgeaJp+ihjOeahOWGmeWFpeS7u+WKoeOAglxuICovXG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtQXBpV3JpdGUoam9iOiBBcGlXcml0ZUpvYikge1xuICAvLyAxLiDnlJ/miJDmjIfku6TlnZdcbiAgY29uc3QgY29udGVudFN0cmluZyA9IEooam9iLmJsb2NrQ29udGVudCk7XG4gIGNvbnN0IGJsb2NrID0gYFxcbjwke2pvYi5ibG9ja1RhZ30+XFxuJHtjb250ZW50U3RyaW5nfVxcbjwvJHtqb2IuYmxvY2tUYWd9PmA7XG5cbiAgLy8gMi4g5p+l5om+55uu5qCH5raI5oGv5bm26L+95Yqg5YaF5a65XG4gIGNvbnN0IGxhc3RBaU1lc3NhZ2UgPSBhd2FpdCBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIWxhc3RBaU1lc3NhZ2UpIHtcbiAgICBsb2dnZXIud2FybigncGVyZm9ybUFwaVdyaXRlJywgJ+aJvuS4jeWIsOS7u+S9lSBBSSDmtojmga/vvIzml6Dms5XmiafooYwgQVBJIOWGmeWFpeOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KGxhc3RBaU1lc3NhZ2UpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gb3JpZ2luYWxDb250ZW50ICsgYmxvY2s7XG5cbiAgbG9nZ2VyLmxvZygncGVyZm9ybUFwaVdyaXRlJywgYOWunuaXtuWGmeWFpSBBUEkg5Lu75YqhICgke2pvYi5ibG9ja1RhZ30pIOWIsOa2iOaBryBJRCAke2xhc3RBaU1lc3NhZ2UubWVzc2FnZV9pZH0uLi5gKTtcblxuICAvLyAzLiDlrp7ml7bmm7TmlrDmtojmga/lhoXlrrlcbiAgYXdhaXQgdXBkYXRlTWVzc2FnZUNvbnRlbnQobGFzdEFpTWVzc2FnZSwgbmV3Q29udGVudCk7XG5cbiAgLy8gNC4g6LCD55So6Ziy5oqW5Ye95pWw5p2l6LCD5bqm5YaZ5YWl5LqL5Lu255qE5Y+R6YCBXG4gIGRlYm91bmNlZEVtaXRBcGlXcml0ZSgpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOS6i+S7tuWkhOeQhuWZqOWunueOsCAo55SxIGV2ZW50X3F1ZXVlLnRzIOiwg+eUqClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6aW5zZXJ0QnlPYmplY3RgIOS6i+S7tuOAglxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSDku47kuovku7bnmoQgYGRldGFpbGAg5Lit6I635Y+W55qE5Y+Y6YeP5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRCeU9iamVjdChkYXRhOiBvYmplY3QpIHtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZUluc2VydCcsIGJsb2NrQ29udGVudDogZGF0YSB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOnVwZGF0ZUJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+WvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVFZGl0JywgYmxvY2tDb250ZW50OiBkYXRhIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6aW5zZXJ0QnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKiBAcGFyYW0geyp9IHZhbHVlIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgdmFsdWVgIOWxnuaAp+iOt+WPluOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QnlQYXRoKHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB2YWx1ZSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnLCBibG9ja0NvbnRlbnQ6IGJsb2NrIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6dXBkYXRlQnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKiBAcGFyYW0geyp9IHZhbHVlIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgdmFsdWVgIOWxnuaAp+iOt+WPluOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnlQYXRoKHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB2YWx1ZSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVFZGl0JywgYmxvY2tDb250ZW50OiBibG9jayB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmRlbGV0ZUJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+e7k+aehOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVEZWxldGUnLCBibG9ja0NvbnRlbnQ6IGRhdGEgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTpkZWxldGVCeVBhdGhgIOS6i+S7tuOAglxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSDku47kuovku7YgYGRldGFpbGAg55qEIGBwYXRoYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUJ5UGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgLy8g5a+55LqO5Yig6Zmk5pON5L2c77yM5oiR5Lus55So5LiA5Liq56m65a+56LGh5L2c5Li65YC85p2l6KGo56S65Yig6Zmk6K+l6Lev5b6E55qE5oSP5Zu+XG4gIGNvbnN0IGJsb2NrID0gXy5zZXQoe30sIHBhdGgsIHt9KTtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZURlbGV0ZScsIGJsb2NrQ29udGVudDogYmxvY2sgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTpnZXRDdXJyZW50VmFyc2Ag5LqL5Lu244CCXG4gKiDov5nkuKrlh73mlbDmmK/nqbrnmoTvvIzlm6DkuLrlroPnmoTnm67nmoTlj6rmmK/kuLrkuobop6blj5Egd3JpdGVEb25lIOS6i+S7tu+8jOS7peS+v+WFtuS7lue7hOS7tuiDvemAmui/h+i/meenjeaWueW8j+iOt+WPluWIsOacgOaWsOWPmOmHj+OAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFZhcnMocGF5bG9hZDogV3JpdGVEb25lUGF5bG9hZCkge1xuICBlbWl0V3JpdGVEb25lRXZlbnQocGF5bG9hZCk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/handlers/api/handler.ts\n\n}");
  },
  "./src/ERA变量框架/events/handlers/sync.ts": 
  /*!*********************************************!*\
  !*** ./src/ERA变量框架/events/handlers/sync.ts ***!
  \*********************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handleSyncEvent: () => (/* binding */ handleSyncEvent)\n/* harmony export */ });\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/key/mk */ "./src/ERA变量框架/core/key/mk.ts");\n/* harmony import */ var _core_sync__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../core/sync */ "./src/ERA变量框架/core/sync.ts");\n/* harmony import */ var _ui_patch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../ui/patch */ "./src/ERA变量框架/ui/patch.ts");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/log */ "./src/ERA变量框架/utils/log.ts");\n/* harmony import */ var _emitters_events__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../emitters/events */ "./src/ERA变量框架/events/emitters/events.ts");\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger();\nasync function handleSyncEvent(job, actionsTaken, payload) {\n    const { type: eventType } = job;\n    logger.debug(\'handleSyncEvent\', `事件 ${eventType} 触发状态同步流程...`);\n    const isFullSync = eventType === \'manual_full_sync\';\n    await (0,_core_sync__WEBPACK_IMPORTED_MODULE_1__.resyncStateOnHistoryChange)(isFullSync);\n    actionsTaken.resync = true;\n    // 在同步完成后，强制重新渲染消息以触发宏\n    if (eventType != \'combo_sync\')\n        (0,_ui_patch__WEBPACK_IMPORTED_MODULE_2__.forceRenderRecentMessages)();\n    // 更新状态并发送事件\n    await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_0__.updateLatestSelectedMk)();\n    (0,_emitters_events__WEBPACK_IMPORTED_MODULE_4__.emitWriteDoneEvent)(payload);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9oYW5kbGVycy9zeW5jLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFhO0FBRThDO0FBQ0U7QUFDRjtBQUVsQjtBQUNlO0FBSXhELE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRXJCLEtBQUssVUFBVSxlQUFlLENBQ25DLEdBQWEsRUFDYixZQUEwQixFQUMxQixPQUF5QjtJQUV6QixNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLEdBQUcsQ0FBQztJQUNoQyxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLE1BQU0sU0FBUyxjQUFjLENBQUMsQ0FBQztJQUMvRCxNQUFNLFVBQVUsR0FBRyxTQUFTLEtBQUssa0JBQWtCLENBQUM7SUFDcEQsTUFBTSxzRUFBMEIsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM3QyxZQUFZLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUMzQixzQkFBc0I7SUFDdEIsSUFBSSxTQUFTLElBQUksWUFBWTtRQUFFLG9FQUF5QixFQUFFLENBQUM7SUFFM0QsWUFBWTtJQUNaLE1BQU0sb0VBQXNCLEVBQUUsQ0FBQztJQUMvQixvRUFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM5QixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2hhbmRsZXJzL3N5bmMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rIH0gZnJvbSAnLi4vLi4vY29yZS9rZXkvbWsnO1xuaW1wb3J0IHsgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgfSBmcm9tICcuLi8uLi9jb3JlL3N5bmMnO1xuaW1wb3J0IHsgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcyB9IGZyb20gJy4uLy4uL3VpL3BhdGNoJztcbmltcG9ydCB7IFdyaXRlRG9uZVBheWxvYWQgfSBmcm9tICcuLi8uLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IGVtaXRXcml0ZURvbmVFdmVudCB9IGZyb20gJy4uL2VtaXR0ZXJzL2V2ZW50cyc7XG5pbXBvcnQgeyBFdmVudEpvYiB9IGZyb20gJy4uL21lcmdlcic7XG5pbXBvcnQgeyBBY3Rpb25zVGFrZW4gfSBmcm9tICcuLi90eXBlcyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN5bmNFdmVudChcbiAgam9iOiBFdmVudEpvYixcbiAgYWN0aW9uc1Rha2VuOiBBY3Rpb25zVGFrZW4sXG4gIHBheWxvYWQ6IFdyaXRlRG9uZVBheWxvYWQsXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgeyB0eXBlOiBldmVudFR5cGUgfSA9IGpvYjtcbiAgbG9nZ2VyLmRlYnVnKCdoYW5kbGVTeW5jRXZlbnQnLCBg5LqL5Lu2ICR7ZXZlbnRUeXBlfSDop6blj5HnirbmgIHlkIzmraXmtYHnqIsuLi5gKTtcbiAgY29uc3QgaXNGdWxsU3luYyA9IGV2ZW50VHlwZSA9PT0gJ21hbnVhbF9mdWxsX3N5bmMnO1xuICBhd2FpdCByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZShpc0Z1bGxTeW5jKTtcbiAgYWN0aW9uc1Rha2VuLnJlc3luYyA9IHRydWU7XG4gIC8vIOWcqOWQjOatpeWujOaIkOWQju+8jOW8uuWItumHjeaWsOa4suafk+a2iOaBr+S7peinpuWPkeWuj1xuICBpZiAoZXZlbnRUeXBlICE9ICdjb21ib19zeW5jJykgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcygpO1xuXG4gIC8vIOabtOaWsOeKtuaAgeW5tuWPkemAgeS6i+S7tlxuICBhd2FpdCB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rKCk7XG4gIGVtaXRXcml0ZURvbmVFdmVudChwYXlsb2FkKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/handlers/sync.ts\n\n}');
  },
  "./src/ERA变量框架/events/handlers/updateMkOnly.ts": 
  /*!*****************************************************!*\
  !*** ./src/ERA变量框架/events/handlers/updateMkOnly.ts ***!
  \*****************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handleUpdateMkOnlyEvent: () => (/* binding */ handleUpdateMkOnlyEvent)\n/* harmony export */ });\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/key/mk */ "./src/ERA变量框架/core/key/mk.ts");\n\n\nasync function handleUpdateMkOnlyEvent() {\n    // 监听此事件仅用于为用户消息创建 MK。\n    await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_0__.updateLatestSelectedMk)();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9oYW5kbGVycy91cGRhdGVNa09ubHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBYTtBQUU4QztBQUVwRCxLQUFLLFVBQVUsdUJBQXVCO0lBQzNDLHNCQUFzQjtJQUN0QixNQUFNLG9FQUFzQixFQUFFLENBQUM7QUFDakMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9oYW5kbGVycy91cGRhdGVNa09ubHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rIH0gZnJvbSAnLi4vLi4vY29yZS9rZXkvbWsnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXBkYXRlTWtPbmx5RXZlbnQoKTogUHJvbWlzZTx2b2lkPiB7XG4gIC8vIOebkeWQrOatpOS6i+S7tuS7heeUqOS6juS4uueUqOaIt+a2iOaBr+WIm+W7uiBNS+OAglxuICBhd2FpdCB1cGRhdGVMYXRlc3RTZWxlY3RlZE1rKCk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/handlers/updateMkOnly.ts\n\n}');
  },
  "./src/ERA变量框架/events/merger.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/events/merger.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EVENT_COLLISION_MAP: () => (/* binding */ EVENT_COLLISION_MAP),\n/* harmony export */   EVENT_COMBO_MAP: () => (/* binding */ EVENT_COMBO_MAP),\n/* harmony export */   EVENT_DEBOUNCE_MAP: () => (/* binding */ EVENT_DEBOUNCE_MAP),\n/* harmony export */   EVENT_GROUPS: () => (/* binding */ EVENT_GROUPS),\n/* harmony export */   getEventGroup: () => (/* binding */ getEventGroup),\n/* harmony export */   mergeEventBatch: () => (/* binding */ mergeEventBatch)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger();\n/**\n * @description 定义需要监听的事件的分组\n */\nconst EVENT_GROUPS = {\n    INIT: [tavern_events.APP_READY],\n    SYNC: [\n        'manual_write',\n        _utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_EVENT_EMITTER.API_WRITE,\n        tavern_events.MESSAGE_RECEIVED,\n        tavern_events.MESSAGE_DELETED,\n        tavern_events.MESSAGE_SWIPED,\n        tavern_events.CHAT_CHANGED,\n        'manual_sync',\n        'manual_full_sync',\n        /** 由 message_updated 和 generation_started 组合而成的同步事件 */\n        'combo_sync',\n    ],\n    API: Object.values(_utils_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_API_EVENTS),\n    /** 仅更新MK的事件 */\n    UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n    /** 仅用于对冲检测的事件，本身不触发逻辑 */\n    COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n    /** 用于组合事件的起始事件 */\n    COMBO_STARTERS: [tavern_events.MESSAGE_UPDATED],\n};\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 500 }]\n * ])\n */\nconst EVENT_COLLISION_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 600 }],\n]);\n/**\n * @constant {Map<string, { next: string; resultType: string; maxInterval: number }>} EVENT_COMBO_MAP\n * @description\n * 定义了事件组合规则。\n * 如果在事件队列的同一次批处理中，一个 key 事件紧跟着一个 `next` 事件，\n * 它们将被合并成一个新的 `resultType` 事件。\n *\n * @example\n * // 当用户消息被AI编辑后立刻开始生成下一条消息时，会依次触发 `MESSAGE_UPDATED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并将它们合并为一个 `combo_sync` 事件，以确保数据一致性。\n * new Map([\n *   [tavern_events.MESSAGE_UPDATED, { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 2100 }]\n * ])\n */\nconst EVENT_COMBO_MAP = new Map([\n    [\n        tavern_events.MESSAGE_UPDATED,\n        { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 1600 },\n    ],\n]);\n/**\n * @constant {Map<string, number>} EVENT_DEBOUNCE_MAP\n * @description\n * 为特定事件定义自定义的防抖时间（毫秒）。\n * 在事件队列处理器中，如果一个事件在此映射中定义了时间，\n * 将使用该时间代替默认的防抖时间。\n * 这对于那些需要更长窗口来捕获后续事件的“前置事件”特别有用。\n *\n * @example\n * // 为 MESSAGE_SWIPED 设置更长的等待时间，以确保能捕获到后续的 GENERATION_STARTED\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, 500]\n * ])\n */\nconst EVENT_DEBOUNCE_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, 500], // 对冲事件的前置事件\n    [tavern_events.MESSAGE_UPDATED, 1500], // 组合事件的前置事件\n]);\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('INIT', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nfunction getEventGroup(eventType) {\n    // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n    if (EVENT_GROUPS.INIT.includes(eventType))\n        return 'INIT';\n    if (EVENT_GROUPS.SYNC.includes(eventType))\n        return 'SYNC';\n    if (EVENT_GROUPS.API.includes(eventType))\n        return 'API';\n    if (EVENT_GROUPS.UPDATE_MK_ONLY.includes(eventType))\n        return 'UPDATE_MK_ONLY';\n    if (EVENT_GROUPS.COLLISION_DETECTORS.includes(eventType))\n        return 'COLLISION_DETECTORS';\n    if (EVENT_GROUPS.COMBO_STARTERS.includes(eventType))\n        return 'COMBO_STARTERS';\n    return 'UNKNOWN';\n}\n/**\n * **【事件合并器】**\n * 对一批事件进行智能合并，包括处理事件对冲和合并同组可覆盖事件。\n * @param {EventJob[]} batchToProcess - 从队列中取出的一批原始事件。\n * @returns {EventJob[]} - 经过合并优化后的事件数组。\n */\nfunction mergeEventBatch(batchToProcess) {\n    const originalEvents = _.cloneDeep(batchToProcess);\n    const finalJobs = [];\n    // 使用 for...of 循环，让逻辑更清晰\n    for (const currentJob of batchToProcess) {\n        // 如果是第一个事件，直接放入结果中\n        if (finalJobs.length === 0) {\n            finalJobs.push(currentJob);\n            continue; // 继续处理下一个事件\n        }\n        const prevJob = finalJobs[finalJobs.length - 1];\n        const timeDifference = currentJob.timestamp - prevJob.timestamp;\n        // 1. 检查事件组合\n        const comboRule = EVENT_COMBO_MAP.get(prevJob.type);\n        if (comboRule && currentJob.type === comboRule.next) {\n            if (timeDifference <= comboRule.maxInterval) {\n                logger.debug('mergeEventBatch', `检测到事件组合: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${comboRule.maxInterval}ms)。将合并为 ${comboRule.resultType} 事件。`);\n                finalJobs.pop(); // 移除前一个事件\n                finalJobs.push({ type: comboRule.resultType, timestamp: currentJob.timestamp, detail: currentJob.detail });\n                continue;\n            }\n            else {\n                logger.debug('mergeEventBatch', `检测到潜在的事件组合，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${comboRule.maxInterval}ms)。`);\n            }\n        }\n        // 2. 检查事件对冲\n        const collisionRule = EVENT_COLLISION_MAP.get(prevJob.type);\n        if (collisionRule && currentJob.type === collisionRule.next) {\n            if (timeDifference <= collisionRule.maxInterval) {\n                logger.debug('mergeEventBatch', `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${collisionRule.maxInterval}ms)。将忽略这两个事件。`);\n                finalJobs.pop(); // 移除前一个事件\n                continue; // 跳过当前事件，从而忽略两者\n            }\n            else {\n                logger.debug('mergeEventBatch', `检测到潜在的事件对冲，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${collisionRule.maxInterval}ms)。`);\n            }\n        }\n        // 3. 如果不冲突或组合，则检查同组事件合并\n        const prevGroup = getEventGroup(prevJob.type);\n        const currentGroup = getEventGroup(currentJob.type);\n        // 定义合并条件，让 if 判断的意图更清晰\n        const areInSameGroup = prevGroup === currentGroup;\n        const isMergeableGroup = prevGroup === 'SYNC';\n        // 如果满足合并条件\n        if (areInSameGroup && isMergeableGroup) {\n            // 用当前事件覆盖掉结果数组中的最后一个事件\n            finalJobs[finalJobs.length - 1] = currentJob;\n        }\n        else {\n            // 否则，将当前事件追加到结果数组\n            finalJobs.push(currentJob);\n        }\n    }\n    // 最后，清理掉所有未配对的检测器和组合起始事件\n    const filteredJobs = finalJobs.filter(job => {\n        const group = getEventGroup(job.type);\n        const isOrphanedDetector = group === 'COLLISION_DETECTORS';\n        const isOrphanedComboStarter = group === 'COMBO_STARTERS';\n        if (isOrphanedDetector || isOrphanedComboStarter) {\n            logger.debug('mergeEventBatch', `清理未配对的事件: ${job.type}`);\n        }\n        return !isOrphanedDetector && !isOrphanedComboStarter;\n    });\n    // 打印合并日志\n    logger.debug('mergeEventBatch', `事件合并: ${originalEvents.length} -> ${filteredJobs.length}`, {\n        before: originalEvents.map((e) => e.type),\n        after: filteredJobs.map((e) => e.type),\n    });\n    return filteredJobs;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9tZXJnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgRVJBX0VWRU5UX0VNSVRURVIgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnpnIDopoHnm5HlkKznmoTkuovku7bnmoTliIbnu4RcbiAqL1xuZXhwb3J0IGNvbnN0IEVWRU5UX0dST1VQUyA9IHtcbiAgSU5JVDogW3RhdmVybl9ldmVudHMuQVBQX1JFQURZXSxcbiAgU1lOQzogW1xuICAgICdtYW51YWxfd3JpdGUnLFxuICAgIEVSQV9FVkVOVF9FTUlUVEVSLkFQSV9XUklURSxcbiAgICB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfUkVDRUlWRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX0RFTEVURUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1NXSVBFRCxcbiAgICB0YXZlcm5fZXZlbnRzLkNIQVRfQ0hBTkdFRCxcbiAgICAnbWFudWFsX3N5bmMnLFxuICAgICdtYW51YWxfZnVsbF9zeW5jJyxcbiAgICAvKiog55SxIG1lc3NhZ2VfdXBkYXRlZCDlkowgZ2VuZXJhdGlvbl9zdGFydGVkIOe7hOWQiOiAjOaIkOeahOWQjOatpeS6i+S7tiAqL1xuICAgICdjb21ib19zeW5jJyxcbiAgXSxcbiAgQVBJOiBPYmplY3QudmFsdWVzKEVSQV9BUElfRVZFTlRTKSxcbiAgLyoqIOS7heabtOaWsE1L55qE5LqL5Lu2ICovXG4gIFVQREFURV9NS19PTkxZOiBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1NFTlRdLFxuICAvKiog5LuF55So5LqO5a+55Yay5qOA5rWL55qE5LqL5Lu277yM5pys6Lqr5LiN6Kem5Y+R6YC76L6RICovXG4gIENPTExJU0lPTl9ERVRFQ1RPUlM6IFt0YXZlcm5fZXZlbnRzLkdFTkVSQVRJT05fU1RBUlRFRF0sXG4gIC8qKiDnlKjkuo7nu4TlkIjkuovku7bnmoTotbflp4vkuovku7YgKi9cbiAgQ09NQk9fU1RBUlRFUlM6IFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfVVBEQVRFRF0sXG59O1xuXG4vKipcbiAqIEBjb25zdGFudCB7TWFwPHN0cmluZywgc3RyaW5nPn0gRVZFTlRfQ09MTElTSU9OX01BUFxuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobkuovku7blr7nlhrLop4TliJnjgIJcbiAqIOWmguaenOWcqOS6i+S7tumYn+WIl+eahOWQjOS4gOasoeaJueWkhOeQhuS4re+8jOWQjOaXtuWHuueOsOS6hiBrZXkg5LqL5Lu25ZKMIHZhbHVlIOS6i+S7tu+8jFxuICog5YiZ6L+Z5Lik5Liq5LqL5Lu26YO95bCG6KKr5b+955Wl44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIOW9k+eUqOaIt+W/q+mAn+W3pua7keeEtuWQjueCueWHu+eUn+aIkOaXtu+8jOS8muS+neasoeinpuWPkSBgTUVTU0FHRV9TV0lQRURgIOWSjCBgR0VORVJBVElPTl9TVEFSVEVEYOOAglxuICogLy8g6L+Z5p2h6KeE5YiZ5Lya5o2V6I636L+Z56eN5qih5byP5bm25ZCM5pe25b+955Wl6L+Z5Lik5Liq5LqL5Lu277yM6YG/5YWN5LiN5b+F6KaB55qE5ZCM5q2l44CCXG4gKiBuZXcgTWFwKFtcbiAqICAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIHsgbmV4dDogdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURUQsIG1heEludGVydmFsOiA1MDAgfV1cbiAqIF0pXG4gKi9cbmV4cG9ydCBjb25zdCBFVkVOVF9DT0xMSVNJT05fTUFQID0gbmV3IE1hcDxzdHJpbmcsIHsgbmV4dDogc3RyaW5nOyBtYXhJbnRlcnZhbDogbnVtYmVyIH0+KFtcbiAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIHsgbmV4dDogdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURUQsIG1heEludGVydmFsOiA2MDAgfV0sXG5dKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIHsgbmV4dDogc3RyaW5nOyByZXN1bHRUeXBlOiBzdHJpbmc7IG1heEludGVydmFsOiBudW1iZXIgfT59IEVWRU5UX0NPTUJPX01BUFxuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobkuovku7bnu4TlkIjop4TliJnjgIJcbiAqIOWmguaenOWcqOS6i+S7tumYn+WIl+eahOWQjOS4gOasoeaJueWkhOeQhuS4re+8jOS4gOS4qiBrZXkg5LqL5Lu257Sn6Lef552A5LiA5LiqIGBuZXh0YCDkuovku7bvvIxcbiAqIOWug+S7rOWwhuiiq+WQiOW5tuaIkOS4gOS4quaWsOeahCBgcmVzdWx0VHlwZWAg5LqL5Lu244CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIOW9k+eUqOaIt+a2iOaBr+iiq0FJ57yW6L6R5ZCO56uL5Yi75byA5aeL55Sf5oiQ5LiL5LiA5p2h5raI5oGv5pe277yM5Lya5L6d5qyh6Kem5Y+RIGBNRVNTQUdFX1VQREFURURgIOWSjCBgR0VORVJBVElPTl9TVEFSVEVEYOOAglxuICogLy8g6L+Z5p2h6KeE5YiZ5Lya5o2V6I636L+Z56eN5qih5byP5bm25bCG5a6D5Lus5ZCI5bm25Li65LiA5LiqIGBjb21ib19zeW5jYCDkuovku7bvvIzku6Xnoa7kv53mlbDmja7kuIDoh7TmgKfjgIJcbiAqIG5ldyBNYXAoW1xuICogICBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1VQREFURUQsIHsgbmV4dDogdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURUQsIHJlc3VsdFR5cGU6ICdjb21ib19zeW5jJywgbWF4SW50ZXJ2YWw6IDIxMDAgfV1cbiAqIF0pXG4gKi9cbmV4cG9ydCBjb25zdCBFVkVOVF9DT01CT19NQVAgPSBuZXcgTWFwPHN0cmluZywgeyBuZXh0OiBzdHJpbmc7IHJlc3VsdFR5cGU6IHN0cmluZzsgbWF4SW50ZXJ2YWw6IG51bWJlciB9PihbXG4gIFtcbiAgICB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfVVBEQVRFRCxcbiAgICB7IG5leHQ6IHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVELCByZXN1bHRUeXBlOiAnY29tYm9fc3luYycsIG1heEludGVydmFsOiAxNjAwIH0sXG4gIF0sXG5dKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIG51bWJlcj59IEVWRU5UX0RFQk9VTkNFX01BUFxuICogQGRlc2NyaXB0aW9uXG4gKiDkuLrnibnlrprkuovku7blrprkuYnoh6rlrprkuYnnmoTpmLLmipbml7bpl7TvvIjmr6vnp5LvvInjgIJcbiAqIOWcqOS6i+S7tumYn+WIl+WkhOeQhuWZqOS4re+8jOWmguaenOS4gOS4quS6i+S7tuWcqOatpOaYoOWwhOS4reWumuS5ieS6huaXtumXtO+8jFxuICog5bCG5L2/55So6K+l5pe26Ze05Luj5pu/6buY6K6k55qE6Ziy5oqW5pe26Ze044CCXG4gKiDov5nlr7nkuo7pgqPkupvpnIDopoHmm7Tplb/nqpflj6PmnaXmjZXojrflkI7nu63kuovku7bnmoTigJzliY3nva7kuovku7bigJ3nibnliKvmnInnlKjjgIJcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8g5Li6IE1FU1NBR0VfU1dJUEVEIOiuvue9ruabtOmVv+eahOetieW+heaXtumXtO+8jOS7peehruS/neiDveaNleiOt+WIsOWQjue7reeahCBHRU5FUkFUSU9OX1NUQVJURURcbiAqIG5ldyBNYXAoW1xuICogICBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1NXSVBFRCwgNTAwXVxuICogXSlcbiAqL1xuZXhwb3J0IGNvbnN0IEVWRU5UX0RFQk9VTkNFX01BUCA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KFtcbiAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIDUwMF0sIC8vIOWvueWGsuS6i+S7tueahOWJjee9ruS6i+S7tlxuICBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1VQREFURUQsIDE1MDBdLCAvLyDnu4TlkIjkuovku7bnmoTliY3nva7kuovku7Zcbl0pO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgRXZlbnRKb2JcbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnkuobkuovku7bpmJ/liJfkuK3mr4/kuKrku7vliqHlr7nosaHnmoTnu5PmnoTjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFdmVudEpvYiB7XG4gIHR5cGU6IHN0cmluZztcbiAgZGV0YWlsPzogYW55O1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuLyoqXG4gKiDmoLnmja7kuovku7bnsbvlnovvvIzmn6Xmib7lroPlsZ7kuo7lk6rkuKrpooTlrprkuYnnmoTnu4TjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSDopoHmo4Dmn6XnmoTkuovku7bnsbvlnovjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS6i+S7tuaJgOWxnueahOe7hOWQjSAoJ0lOSVQnLCAnU1lOQycsICdBUEknLCAnVVBEQVRFX01LX09OTFknLCAnVU5LTk9XTicp44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudEdyb3VwKGV2ZW50VHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8g5L2/55SoIGFzIHN0cmluZ1tdIOadpeino+WGsyBUeXBlU2NyaXB0IOWboCAnYXMgY29uc3QnIOaOqOaWreWHuueahOi/h+S6juS4peagvOeahOexu+Wei+mXrumimFxuICBpZiAoKEVWRU5UX0dST1VQUy5JTklUIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ0lOSVQnO1xuICBpZiAoKEVWRU5UX0dST1VQUy5TWU5DIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1NZTkMnO1xuICBpZiAoKEVWRU5UX0dST1VQUy5BUEkgYXMgc3RyaW5nW10pLmluY2x1ZGVzKGV2ZW50VHlwZSkpIHJldHVybiAnQVBJJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuVVBEQVRFX01LX09OTFkgYXMgc3RyaW5nW10pLmluY2x1ZGVzKGV2ZW50VHlwZSkpIHJldHVybiAnVVBEQVRFX01LX09OTFknO1xuICBpZiAoKEVWRU5UX0dST1VQUy5DT0xMSVNJT05fREVURUNUT1JTIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ0NPTExJU0lPTl9ERVRFQ1RPUlMnO1xuICBpZiAoKEVWRU5UX0dST1VQUy5DT01CT19TVEFSVEVSUyBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdDT01CT19TVEFSVEVSUyc7XG4gIHJldHVybiAnVU5LTk9XTic7XG59XG5cbi8qKlxuICogKirjgJDkuovku7blkIjlubblmajjgJEqKlxuICog5a+55LiA5om55LqL5Lu26L+b6KGM5pm66IO95ZCI5bm277yM5YyF5ous5aSE55CG5LqL5Lu25a+55Yay5ZKM5ZCI5bm25ZCM57uE5Y+v6KaG55uW5LqL5Lu244CCXG4gKiBAcGFyYW0ge0V2ZW50Sm9iW119IGJhdGNoVG9Qcm9jZXNzIC0g5LuO6Zif5YiX5Lit5Y+W5Ye655qE5LiA5om55Y6f5aeL5LqL5Lu244CCXG4gKiBAcmV0dXJucyB7RXZlbnRKb2JbXX0gLSDnu4/ov4flkIjlubbkvJjljJblkI7nmoTkuovku7bmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRXZlbnRCYXRjaChiYXRjaFRvUHJvY2VzczogRXZlbnRKb2JbXSk6IEV2ZW50Sm9iW10ge1xuICBjb25zdCBvcmlnaW5hbEV2ZW50cyA9IF8uY2xvbmVEZWVwKGJhdGNoVG9Qcm9jZXNzKTtcbiAgY29uc3QgZmluYWxKb2JzOiBFdmVudEpvYltdID0gW107XG5cbiAgLy8g5L2/55SoIGZvci4uLm9mIOW+queOr++8jOiuqemAu+i+keabtOa4heaZsFxuICBmb3IgKGNvbnN0IGN1cnJlbnRKb2Igb2YgYmF0Y2hUb1Byb2Nlc3MpIHtcbiAgICAvLyDlpoLmnpzmmK/nrKzkuIDkuKrkuovku7bvvIznm7TmjqXmlL7lhaXnu5PmnpzkuK1cbiAgICBpZiAoZmluYWxKb2JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZmluYWxKb2JzLnB1c2goY3VycmVudEpvYik7XG4gICAgICBjb250aW51ZTsgLy8g57un57ut5aSE55CG5LiL5LiA5Liq5LqL5Lu2XG4gICAgfVxuXG4gICAgY29uc3QgcHJldkpvYiA9IGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgdGltZURpZmZlcmVuY2UgPSBjdXJyZW50Sm9iLnRpbWVzdGFtcCAtIHByZXZKb2IudGltZXN0YW1wO1xuXG4gICAgLy8gMS4g5qOA5p+l5LqL5Lu257uE5ZCIXG4gICAgY29uc3QgY29tYm9SdWxlID0gRVZFTlRfQ09NQk9fTUFQLmdldChwcmV2Sm9iLnR5cGUpO1xuICAgIGlmIChjb21ib1J1bGUgJiYgY3VycmVudEpvYi50eXBlID09PSBjb21ib1J1bGUubmV4dCkge1xuICAgICAgaWYgKHRpbWVEaWZmZXJlbmNlIDw9IGNvbWJvUnVsZS5tYXhJbnRlcnZhbCkge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ21lcmdlRXZlbnRCYXRjaCcsXG4gICAgICAgICAgYOajgOa1i+WIsOS6i+S7tue7hOWQiDogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcyA8PSAke2NvbWJvUnVsZS5tYXhJbnRlcnZhbH1tcynjgILlsIblkIjlubbkuLogJHtjb21ib1J1bGUucmVzdWx0VHlwZX0g5LqL5Lu244CCYCxcbiAgICAgICAgKTtcbiAgICAgICAgZmluYWxKb2JzLnBvcCgpOyAvLyDnp7vpmaTliY3kuIDkuKrkuovku7ZcbiAgICAgICAgZmluYWxKb2JzLnB1c2goeyB0eXBlOiBjb21ib1J1bGUucmVzdWx0VHlwZSwgdGltZXN0YW1wOiBjdXJyZW50Sm9iLnRpbWVzdGFtcCwgZGV0YWlsOiBjdXJyZW50Sm9iLmRldGFpbCB9KTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ21lcmdlRXZlbnRCYXRjaCcsXG4gICAgICAgICAgYOajgOa1i+WIsOa9nOWcqOeahOS6i+S7tue7hOWQiO+8jOS9huWboOi2heaXtuiAjOWksei0pTogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcyA+ICR7Y29tYm9SdWxlLm1heEludGVydmFsfW1zKeOAgmAsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gMi4g5qOA5p+l5LqL5Lu25a+55YayXG4gICAgY29uc3QgY29sbGlzaW9uUnVsZSA9IEVWRU5UX0NPTExJU0lPTl9NQVAuZ2V0KHByZXZKb2IudHlwZSk7XG4gICAgaWYgKGNvbGxpc2lvblJ1bGUgJiYgY3VycmVudEpvYi50eXBlID09PSBjb2xsaXNpb25SdWxlLm5leHQpIHtcbiAgICAgIGlmICh0aW1lRGlmZmVyZW5jZSA8PSBjb2xsaXNpb25SdWxlLm1heEludGVydmFsKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAnbWVyZ2VFdmVudEJhdGNoJyxcbiAgICAgICAgICBg5qOA5rWL5Yiw55u46YK75LqL5Lu25a+55YayOiAke3ByZXZKb2IudHlwZX0g5ZKMICR7Y3VycmVudEpvYi50eXBlfSAo5pe26Ze05beuOiAke3RpbWVEaWZmZXJlbmNlfW1zIDw9ICR7Y29sbGlzaW9uUnVsZS5tYXhJbnRlcnZhbH1tcynjgILlsIblv73nlaXov5nkuKTkuKrkuovku7bjgIJgLFxuICAgICAgICApO1xuICAgICAgICBmaW5hbEpvYnMucG9wKCk7IC8vIOenu+mZpOWJjeS4gOS4quS6i+S7tlxuICAgICAgICBjb250aW51ZTsgLy8g6Lez6L+H5b2T5YmN5LqL5Lu277yM5LuO6ICM5b+955Wl5Lik6ICFXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ21lcmdlRXZlbnRCYXRjaCcsXG4gICAgICAgICAgYOajgOa1i+WIsOa9nOWcqOeahOS6i+S7tuWvueWGsu+8jOS9huWboOi2heaXtuiAjOWksei0pTogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcyA+ICR7Y29sbGlzaW9uUnVsZS5tYXhJbnRlcnZhbH1tcynjgIJgLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDMuIOWmguaenOS4jeWGsueqgeaIlue7hOWQiO+8jOWImeajgOafpeWQjOe7hOS6i+S7tuWQiOW5tlxuICAgIGNvbnN0IHByZXZHcm91cCA9IGdldEV2ZW50R3JvdXAocHJldkpvYi50eXBlKTtcbiAgICBjb25zdCBjdXJyZW50R3JvdXAgPSBnZXRFdmVudEdyb3VwKGN1cnJlbnRKb2IudHlwZSk7XG5cbiAgICAvLyDlrprkuYnlkIjlubbmnaHku7bvvIzorqkgaWYg5Yik5pat55qE5oSP5Zu+5pu05riF5pmwXG4gICAgY29uc3QgYXJlSW5TYW1lR3JvdXAgPSBwcmV2R3JvdXAgPT09IGN1cnJlbnRHcm91cDtcbiAgICBjb25zdCBpc01lcmdlYWJsZUdyb3VwID0gcHJldkdyb3VwID09PSAnU1lOQyc7XG5cbiAgICAvLyDlpoLmnpzmu6HotrPlkIjlubbmnaHku7ZcbiAgICBpZiAoYXJlSW5TYW1lR3JvdXAgJiYgaXNNZXJnZWFibGVHcm91cCkge1xuICAgICAgLy8g55So5b2T5YmN5LqL5Lu26KaG55uW5o6J57uT5p6c5pWw57uE5Lit55qE5pyA5ZCO5LiA5Liq5LqL5Lu2XG4gICAgICBmaW5hbEpvYnNbZmluYWxKb2JzLmxlbmd0aCAtIDFdID0gY3VycmVudEpvYjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5ZCm5YiZ77yM5bCG5b2T5YmN5LqL5Lu26L+95Yqg5Yiw57uT5p6c5pWw57uEXG4gICAgICBmaW5hbEpvYnMucHVzaChjdXJyZW50Sm9iKTtcbiAgICB9XG4gIH1cbiAgLy8g5pyA5ZCO77yM5riF55CG5o6J5omA5pyJ5pyq6YWN5a+555qE5qOA5rWL5Zmo5ZKM57uE5ZCI6LW35aeL5LqL5Lu2XG4gIGNvbnN0IGZpbHRlcmVkSm9icyA9IGZpbmFsSm9icy5maWx0ZXIoam9iID0+IHtcbiAgICBjb25zdCBncm91cCA9IGdldEV2ZW50R3JvdXAoam9iLnR5cGUpO1xuICAgIGNvbnN0IGlzT3JwaGFuZWREZXRlY3RvciA9IGdyb3VwID09PSAnQ09MTElTSU9OX0RFVEVDVE9SUyc7XG4gICAgY29uc3QgaXNPcnBoYW5lZENvbWJvU3RhcnRlciA9IGdyb3VwID09PSAnQ09NQk9fU1RBUlRFUlMnO1xuICAgIGlmIChpc09ycGhhbmVkRGV0ZWN0b3IgfHwgaXNPcnBoYW5lZENvbWJvU3RhcnRlcikge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdtZXJnZUV2ZW50QmF0Y2gnLCBg5riF55CG5pyq6YWN5a+555qE5LqL5Lu2OiAke2pvYi50eXBlfWApO1xuICAgIH1cbiAgICByZXR1cm4gIWlzT3JwaGFuZWREZXRlY3RvciAmJiAhaXNPcnBoYW5lZENvbWJvU3RhcnRlcjtcbiAgfSk7XG5cbiAgLy8g5omT5Y2w5ZCI5bm25pel5b+XXG4gIGxvZ2dlci5kZWJ1ZygnbWVyZ2VFdmVudEJhdGNoJywgYOS6i+S7tuWQiOW5tjogJHtvcmlnaW5hbEV2ZW50cy5sZW5ndGh9IC0+ICR7ZmlsdGVyZWRKb2JzLmxlbmd0aH1gLCB7XG4gICAgYmVmb3JlOiBvcmlnaW5hbEV2ZW50cy5tYXAoKGU6IEV2ZW50Sm9iKSA9PiBlLnR5cGUpLFxuICAgIGFmdGVyOiBmaWx0ZXJlZEpvYnMubWFwKChlOiBFdmVudEpvYikgPT4gZS50eXBlKSxcbiAgfSk7XG5cbiAgcmV0dXJuIGZpbHRlcmVkSm9icztcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/merger.ts\n\n}");
  },
  "./src/ERA变量框架/events/queue.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/events/queue.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pushToQueue: () => (/* binding */ pushToQueue)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _dispatcher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dispatcher */ \"./src/ERA变量框架/events/dispatcher.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n/**\n * @file ERA 变量框架 - 事件队列与总调度模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”。它通过一个事件队列机制，将所有事件的接收、\n * 合并、分发和执行流程化，从根本上解决了并发和状态竞争问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有事件（来自酒馆或 API）都被封装成 `EventJob` 对象，推入 `eventQueue`。\n * 2. **单线程处理**: `processQueue` 函数使用 `isProcessing` 锁确保同一时间只有一个处理循环在运行。\n * 3. **防抖与批处理**: 在处理前会进行短暂防抖，以收集短时间内连续触发的多个事件，形成一个“批次”。\n * 4. **委托合并**: 将整个批次交由 `event_merger.ts` 模块进行智能合并（对冲、覆盖）。\n * 5. **委托执行**: 循环遍历合并后的任务，将每个任务委托给 `task_dispatcher.ts` 模块进行独立、原子的执行。\n * 6. **状态传递**: 在不同任务的执行之间，传递和更新必要的上下文状态（如 `mkToIgnore` 和 `consecutiveMkState`）。\n */\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger();\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue = [];\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\nlet isWaiting = false;\nlet unlockSignal = null;\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动或排队等待处理器。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nfunction pushToQueue(type, detail) {\n    logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n    eventQueue.push({ type, detail, timestamp: Date.now() });\n    processQueue();\n}\n/**\n * **【核心事件处理器】**\n * 采用“锁-等待-释放-通知”机制，确保事件处理的连续性。\n */\nasync function processQueue() {\n    // 如果已经有一个调用在“排队等待”，则本次调用直接返回，防止多个等待者。\n    if (isWaiting) {\n        logger.debug('processQueue', '已有处理函数在排队等待，本次调用忽略。');\n        return;\n    }\n    // 如果处理器正在忙碌，则进入“排队等待”状态。\n    if (isProcessing) {\n        logger.debug('processQueue', '处理器忙碌，进入排队等待状态...');\n        isWaiting = true;\n        // 等待当前处理器释放锁的信号\n        await new Promise(resolve => {\n            unlockSignal = resolve;\n        });\n        isWaiting = false;\n        logger.debug('processQueue', '等待结束，获取到处理权。');\n    }\n    // 获得处理权后，如果队列已经被前一个处理器清空，则无需做任何事。\n    if (eventQueue.length === 0) {\n        logger.debug('processQueue', '队列为空，无需处理。');\n        return;\n    }\n    // 【加锁】\n    // 正式开始处理，加锁以阻止其他调用进入。\n    isProcessing = true;\n    logger.log('processQueue', '处理器启动');\n    // 【防抖】\n    const firstJob = eventQueue[0];\n    const group = (0,_merger__WEBPACK_IMPORTED_MODULE_2__.getEventGroup)(firstJob.type);\n    if (group !== 'API') {\n        const debounceTime = _merger__WEBPACK_IMPORTED_MODULE_2__.EVENT_DEBOUNCE_MAP.get(firstJob.type) ?? 300;\n        logger.log('processQueue', `启动事件收集窗口，等待 ${debounceTime}ms...`);\n        await new Promise(resolve => setTimeout(resolve, debounceTime));\n    }\n    // 【调试日志】\n    logger.debug('processQueue', '事件收集窗口关闭，准备处理的队列内容:', JSON.stringify(eventQueue.map(e => e.type)));\n    // 【循环处理】\n    // 只要队列不为空，就持续处理。这能确保在防抖期间新到达的事件也被纳入处理范围。\n    let mkToIgnore = null;\n    while (eventQueue.length > 0) {\n        const batchToProcess = eventQueue.splice(0, eventQueue.length);\n        const finalJobs = (0,_merger__WEBPACK_IMPORTED_MODULE_2__.mergeEventBatch)(batchToProcess);\n        logger.debug('processQueue', `开始处理一个新批次，包含 ${batchToProcess.length} 个原始事件，合并后为 ${finalJobs.length} 个任务。`);\n        for (const job of finalJobs) {\n            const newIgnoreRule = await (0,_dispatcher__WEBPACK_IMPORTED_MODULE_1__.dispatchAndExecuteTask)(job, mkToIgnore);\n            mkToIgnore = newIgnoreRule;\n        }\n        logger.debug('processQueue', '本轮批次处理完毕。');\n    }\n    // 【解锁并通知】\n    isProcessing = false;\n    logger.log('processQueue', '处理器空闲，已释放锁。');\n    // 如果有等待者，则发送解锁信号，让它立即开始。\n    if (unlockSignal) {\n        logger.debug('processQueue', '通知排队的处理器开始工作。');\n        const signal = unlockSignal;\n        unlockSignal = null;\n        signal();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDVCx5Q0FBeUM7SUFDekMsSUFBSSxVQUFVLEdBQXNCLElBQUksQ0FBQztJQUN6QyxPQUFPLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDN0IsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9ELE1BQU0sU0FBUyxHQUFHLHdEQUFlLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFbEQsTUFBTSxDQUFDLEtBQUssQ0FDVixjQUFjLEVBQ2QsZ0JBQWdCLGNBQWMsQ0FBQyxNQUFNLGVBQWUsU0FBUyxDQUFDLE1BQU0sT0FBTyxDQUM1RSxDQUFDO1FBRUYsS0FBSyxNQUFNLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQztZQUM1QixNQUFNLGFBQWEsR0FBRyxNQUFNLG1FQUFzQixDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNwRSxVQUFVLEdBQUcsYUFBYSxDQUFDO1FBQzdCLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsVUFBVTtJQUNWLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFFMUMseUJBQXlCO0lBQ3pCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakIsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDOUMsTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDO1FBQzVCLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsTUFBTSxFQUFFLENBQUM7SUFDWCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuovku7bpmJ/liJfkuI7mgLvosIPluqbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTigJznpZ7nu4/kuK3mnqLigJ3jgILlroPpgJrov4fkuIDkuKrkuovku7bpmJ/liJfmnLrliLbvvIzlsIbmiYDmnInkuovku7bnmoTmjqXmlLbjgIFcbiAqIOWQiOW5tuOAgeWIhuWPkeWSjOaJp+ihjOa1geeoi+WMlu+8jOS7juagueacrOS4iuino+WGs+S6huW5tuWPkeWSjOeKtuaAgeernuS6iemXrumimOOAglxuICpcbiAqICoq5bel5L2c5Y6f55CGKio6XG4gKiAxLiAqKuS6i+S7tuWFpemYnyoqOiDmiYDmnInkuovku7bvvIjmnaXoh6rphZLppobmiJYgQVBJ77yJ6YO96KKr5bCB6KOF5oiQIGBFdmVudEpvYmAg5a+56LGh77yM5o6o5YWlIGBldmVudFF1ZXVlYOOAglxuICogMi4gKirljZXnur/nqIvlpITnkIYqKjogYHByb2Nlc3NRdWV1ZWAg5Ye95pWw5L2/55SoIGBpc1Byb2Nlc3NpbmdgIOmUgeehruS/neWQjOS4gOaXtumXtOWPquacieS4gOS4quWkhOeQhuW+queOr+WcqOi/kOihjOOAglxuICogMy4gKirpmLLmipbkuI7mibnlpITnkIYqKjog5Zyo5aSE55CG5YmN5Lya6L+b6KGM55+t5pqC6Ziy5oqW77yM5Lul5pS26ZuG55+t5pe26Ze05YaF6L+e57ut6Kem5Y+R55qE5aSa5Liq5LqL5Lu277yM5b2i5oiQ5LiA5Liq4oCc5om55qyh4oCd44CCXG4gKiA0LiAqKuWnlOaJmOWQiOW5tioqOiDlsIbmlbTkuKrmibnmrKHkuqTnlLEgYGV2ZW50X21lcmdlci50c2Ag5qih5Z2X6L+b6KGM5pm66IO95ZCI5bm277yI5a+55Yay44CB6KaG55uW77yJ44CCXG4gKiA1LiAqKuWnlOaJmOaJp+ihjCoqOiDlvqrnjq/pgY3ljoblkIjlubblkI7nmoTku7vliqHvvIzlsIbmr4/kuKrku7vliqHlp5TmiZjnu5kgYHRhc2tfZGlzcGF0Y2hlci50c2Ag5qih5Z2X6L+b6KGM54us56uL44CB5Y6f5a2Q55qE5omn6KGM44CCXG4gKiA2LiAqKueKtuaAgeS8oOmAkioqOiDlnKjkuI3lkIzku7vliqHnmoTmiafooYzkuYvpl7TvvIzkvKDpgJLlkozmm7TmlrDlv4XopoHnmoTkuIrkuIvmlofnirbmgIHvvIjlpoIgYG1rVG9JZ25vcmVgIOWSjCBgY29uc2VjdXRpdmVNa1N0YXRlYO+8ieOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IGRpc3BhdGNoQW5kRXhlY3V0ZVRhc2ssIElnbm9yZVJ1bGUgfSBmcm9tICcuL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgRVZFTlRfREVCT1VOQ0VfTUFQLCBFdmVudEpvYiwgZ2V0RXZlbnRHcm91cCwgbWVyZ2VFdmVudEJhdGNoIH0gZnJvbSAnLi9tZXJnZXInO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5cbi8qKlxuICogQGNvbnN0IHtFdmVudEpvYltdfSBldmVudFF1ZXVlXG4gKiBAZGVzY3JpcHRpb24g5LqL5Lu26Zif5YiX77yM5a2Y5YKo5omA5pyJ5b6F5aSE55CG55qE5LqL5Lu25Lu75Yqh44CCXG4gKi9cbmNvbnN0IGV2ZW50UXVldWU6IEV2ZW50Sm9iW10gPSBbXTtcblxuLyoqXG4gKiBAbGV0IHtib29sZWFufSBpc1Byb2Nlc3NpbmdcbiAqIEBkZXNjcmlwdGlvbiDlpITnkIblmajplIHjgILkuLogdHJ1ZSDml7booajnpLogYHByb2Nlc3NRdWV1ZWAg5q2j5Zyo6L+Q6KGM77yM6Ziy5q2i6YeN5YWl44CCXG4gKi9cbmxldCBpc1Byb2Nlc3NpbmcgPSBmYWxzZTtcbmxldCBpc1dhaXRpbmcgPSBmYWxzZTtcbmxldCB1bmxvY2tTaWduYWw6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuXG4vKipcbiAqICoq44CQ5LqL5Lu25YWl5Y+j44CRKipcbiAqIOWwhuS4gOS4quS6i+S7tuaOqOWFpemYn+WIl++8jOW5tuWwneivleWQr+WKqOaIluaOkumYn+etieW+heWkhOeQhuWZqOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSDkuovku7bnsbvlnosgKGUuZy4sIGB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfREVMRVRFRGAp44CCXG4gKiBAcGFyYW0ge2FueX0gW2RldGFpbF0gLSDkuovku7bpmYTluKbnmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHB1c2hUb1F1ZXVlKHR5cGU6IHN0cmluZywgZGV0YWlsPzogYW55KSB7XG4gIGxvZ2dlci5kZWJ1ZygncHVzaFRvUXVldWUnLCBg5o6l5pS25Yiw5LqL5Lu2OiAke3R5cGV977yM5bey5o6o5YWl6Zif5YiX44CCYCwgeyBkZXRhaWwgfSk7XG4gIGV2ZW50UXVldWUucHVzaCh7IHR5cGUsIGRldGFpbCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICBwcm9jZXNzUXVldWUoKTtcbn1cblxuLyoqXG4gKiAqKuOAkOaguOW/g+S6i+S7tuWkhOeQhuWZqOOAkSoqXG4gKiDph4fnlKjigJzplIEt562J5b6FLemHiuaUvi3pgJrnn6XigJ3mnLrliLbvvIznoa7kv53kuovku7blpITnkIbnmoTov57nu63mgKfjgIJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkge1xuICAvLyDlpoLmnpzlt7Lnu4/mnInkuIDkuKrosIPnlKjlnKjigJzmjpLpmJ/nrYnlvoXigJ3vvIzliJnmnKzmrKHosIPnlKjnm7TmjqXov5Tlm57vvIzpmLLmraLlpJrkuKrnrYnlvoXogIXjgIJcbiAgaWYgKGlzV2FpdGluZykge1xuICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc1F1ZXVlJywgJ+W3suacieWkhOeQhuWHveaVsOWcqOaOkumYn+etieW+he+8jOacrOasoeiwg+eUqOW/veeVpeOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOWmguaenOWkhOeQhuWZqOato+WcqOW/meeijO+8jOWImei/m+WFpeKAnOaOkumYn+etieW+heKAneeKtuaAgeOAglxuICBpZiAoaXNQcm9jZXNzaW5nKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo5b+Z56KM77yM6L+b5YWl5o6S6Zif562J5b6F54q25oCBLi4uJyk7XG4gICAgaXNXYWl0aW5nID0gdHJ1ZTtcbiAgICAvLyDnrYnlvoXlvZPliY3lpITnkIblmajph4rmlL7plIHnmoTkv6Hlj7dcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcbiAgICAgIHVubG9ja1NpZ25hbCA9IHJlc29sdmU7XG4gICAgfSk7XG4gICAgaXNXYWl0aW5nID0gZmFsc2U7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn562J5b6F57uT5p2f77yM6I635Y+W5Yiw5aSE55CG5p2D44CCJyk7XG4gIH1cblxuICAvLyDojrflvpflpITnkIbmnYPlkI7vvIzlpoLmnpzpmJ/liJflt7Lnu4/ooqvliY3kuIDkuKrlpITnkIblmajmuIXnqbrvvIzliJnml6DpnIDlgZrku7vkvZXkuovjgIJcbiAgaWYgKGV2ZW50UXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn6Zif5YiX5Li656m677yM5peg6ZyA5aSE55CG44CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g44CQ5Yqg6ZSB44CRXG4gIC8vIOato+W8j+W8gOWni+WkhOeQhu+8jOWKoOmUgeS7pemYu+atouWFtuS7luiwg+eUqOi/m+WFpeOAglxuICBpc1Byb2Nlc3NpbmcgPSB0cnVlO1xuICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo5ZCv5YqoJyk7XG5cbiAgLy8g44CQ6Ziy5oqW44CRXG4gIGNvbnN0IGZpcnN0Sm9iID0gZXZlbnRRdWV1ZVswXTtcbiAgY29uc3QgZ3JvdXAgPSBnZXRFdmVudEdyb3VwKGZpcnN0Sm9iLnR5cGUpO1xuICBpZiAoZ3JvdXAgIT09ICdBUEknKSB7XG4gICAgY29uc3QgZGVib3VuY2VUaW1lID0gRVZFTlRfREVCT1VOQ0VfTUFQLmdldChmaXJzdEpvYi50eXBlKSA/PyAzMDA7XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc1F1ZXVlJywgYOWQr+WKqOS6i+S7tuaUtumbhueql+WPo++8jOetieW+hSAke2RlYm91bmNlVGltZX1tcy4uLmApO1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWJvdW5jZVRpbWUpKTtcbiAgfVxuXG4gIC8vIOOAkOiwg+ivleaXpeW/l+OAkVxuICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NRdWV1ZScsICfkuovku7bmlLbpm4bnqpflj6PlhbPpl63vvIzlh4blpIflpITnkIbnmoTpmJ/liJflhoXlrrk6JywgSlNPTi5zdHJpbmdpZnkoZXZlbnRRdWV1ZS5tYXAoZSA9PiBlLnR5cGUpKSk7XG5cbiAgLy8g44CQ5b6q546v5aSE55CG44CRXG4gIC8vIOWPquimgemYn+WIl+S4jeS4uuepuu+8jOWwseaMgee7reWkhOeQhuOAgui/meiDveehruS/neWcqOmYsuaKluacn+mXtOaWsOWIsOi+vueahOS6i+S7tuS5n+iiq+e6s+WFpeWkhOeQhuiMg+WbtOOAglxuICBsZXQgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwgPSBudWxsO1xuICB3aGlsZSAoZXZlbnRRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgYmF0Y2hUb1Byb2Nlc3MgPSBldmVudFF1ZXVlLnNwbGljZSgwLCBldmVudFF1ZXVlLmxlbmd0aCk7XG4gICAgY29uc3QgZmluYWxKb2JzID0gbWVyZ2VFdmVudEJhdGNoKGJhdGNoVG9Qcm9jZXNzKTtcblxuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdwcm9jZXNzUXVldWUnLFxuICAgICAgYOW8gOWni+WkhOeQhuS4gOS4quaWsOaJueasoe+8jOWMheWQqyAke2JhdGNoVG9Qcm9jZXNzLmxlbmd0aH0g5Liq5Y6f5aeL5LqL5Lu277yM5ZCI5bm25ZCO5Li6ICR7ZmluYWxKb2JzLmxlbmd0aH0g5Liq5Lu75Yqh44CCYCxcbiAgICApO1xuXG4gICAgZm9yIChjb25zdCBqb2Igb2YgZmluYWxKb2JzKSB7XG4gICAgICBjb25zdCBuZXdJZ25vcmVSdWxlID0gYXdhaXQgZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhqb2IsIG1rVG9JZ25vcmUpO1xuICAgICAgbWtUb0lnbm9yZSA9IG5ld0lnbm9yZVJ1bGU7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc1F1ZXVlJywgJ+acrOi9ruaJueasoeWkhOeQhuWujOavleOAgicpO1xuICB9XG5cbiAgLy8g44CQ6Kej6ZSB5bm26YCa55+l44CRXG4gIGlzUHJvY2Vzc2luZyA9IGZhbHNlO1xuICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo56m66Zey77yM5bey6YeK5pS+6ZSB44CCJyk7XG5cbiAgLy8g5aaC5p6c5pyJ562J5b6F6ICF77yM5YiZ5Y+R6YCB6Kej6ZSB5L+h5Y+377yM6K6p5a6D56uL5Y2z5byA5aeL44CCXG4gIGlmICh1bmxvY2tTaWduYWwpIHtcbiAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NRdWV1ZScsICfpgJrnn6XmjpLpmJ/nmoTlpITnkIblmajlvIDlp4vlt6XkvZzjgIInKTtcbiAgICBjb25zdCBzaWduYWwgPSB1bmxvY2tTaWduYWw7XG4gICAgdW5sb2NrU2lnbmFsID0gbnVsbDtcbiAgICBzaWduYWwoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/queue.ts\n\n}");
  },
  "./src/ERA变量框架/index.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/index.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _events_merger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./events/merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _events_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./events/queue */ \"./src/ERA变量框架/events/queue.ts\");\n/* harmony import */ var _macro_parser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./macro/parser */ \"./src/ERA变量框架/macro/parser.ts\");\n/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui */ \"./src/ERA变量框架/ui/index.ts\");\n/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\n\n// 导入 UI 模块\n\n// ===============================\n// 事件监听器注册\n// ===============================\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.INIT,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.SYNC,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.API,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.UPDATE_MK_ONLY,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COLLISION_DETECTORS,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COMBO_STARTERS,\n];\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n    // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n    // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n    eventOn(ev, (detail) => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)(ev, detail));\n});\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_full_sync'));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7OztHQVlHO0FBRVU7QUFFa0M7QUFDRjtBQUU3Qyw0QkFBNEI7QUFDSjtBQUV4QixXQUFXO0FBQ0c7QUFFZCxrQ0FBa0M7QUFDbEMsVUFBVTtBQUNWLGtDQUFrQztBQUVsQzs7O0dBR0c7QUFDSCxNQUFNLGNBQWMsR0FBRztJQUNyQixHQUFHLHdEQUFZLENBQUMsSUFBSTtJQUNwQixHQUFHLHdEQUFZLENBQUMsSUFBSTtJQUNwQixHQUFHLHdEQUFZLENBQUMsR0FBRztJQUNuQixHQUFHLHdEQUFZLENBQUMsY0FBYztJQUM5QixHQUFHLHdEQUFZLENBQUMsbUJBQW1CO0lBQ25DLEdBQUcsd0RBQVksQ0FBQyxjQUFjO0NBQy9CLENBQUM7QUFFRix3QkFBd0I7QUFDeEIsb0JBQW9CO0FBQ3BCLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7SUFDMUIsbUNBQW1DO0lBQ25DLHdEQUF3RDtJQUN4RCxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsTUFBVyxFQUFFLEVBQUUsQ0FBQywwREFBVyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ3hELENBQUMsQ0FBQyxDQUFDO0FBRUgsd0JBQXdCO0FBQ3hCLDRCQUE0QjtBQUM1QixPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztBQUNyRSxPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztBQUNwRSxPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Li75YWl5Y+j5LiO5LqL5Lu255uR5ZCs5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaWh+S7tuaYr+aVtOS4qiBFUkEg5Y+Y6YeP5qGG5p6255qE6LW354K544CC5a6D55qE6IGM6LSj6Z2e5bi45riF5pmw5ZKM5LiT5LiA77yaXG4gKiAxLiAqKuWumuS5ieebkeWQrOiMg+WbtCoqOiDlo7DmmI7moYbmnrbmiYDlhbPlv4PnmoTmiYDmnInkuovku7bnsbvlnovjgIJcbiAqIDIuICoq5rOo5YaM55uR5ZCs5ZmoKio6IOS4uuS4iui/sOaJgOacieS6i+S7tuazqOWGjOebkeWQrOWZqOOAglxuICogMy4gKirnu5/kuIDmtL7lj5EqKjog5b2T5Lu75L2V5LiA5Liq6KKr55uR5ZCs55qE5LqL5Lu26Kem5Y+R5pe277yM5a6D5LiN6L+b6KGM5Lu75L2V6YC76L6R5aSE55CG77yMXG4gKiAgICDogIzmmK/nq4vljbPlsIbor6Xkuovku7bvvIjljIXmi6zkuovku7bnsbvlnovlkozpmYTluKbmlbDmja7vvInljp/lsIHkuI3liqjlnLDmjqjlhaXliLAgYGV2ZW50X3F1ZXVlLnRzYFxuICogICAg5Lit55qE5LqL5Lu25aSE55CG6Zif5YiX5Lit44CCXG4gKlxuICog6L+Z56eN6K6+6K6h5L2T546w5LqG6Imv5aW955qEKirlhbPms6jngrnliIbnprsqKuWOn+WIme+8mmBpbmRleC50c2Ag5Y+q6LSf6LSj4oCc5ZCs4oCd77yM6ICMIGBldmVudF9xdWV1ZS50c2BcbiAqIOi0n+i0o+KAnOaAneiAg+KAneWSjOKAnOihjOWKqOKAneOAgui/meS9v+W+l+S6i+S7tueahOadpea6kOWSjOWkhOeQhumAu+i+keWujOWFqOino+iApu+8jOmdnuW4uOa4heaZsOS4lOaYk+S6jue7tOaKpOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgRVZFTlRfR1JPVVBTIH0gZnJvbSAnLi9ldmVudHMvbWVyZ2VyJztcbmltcG9ydCB7IHB1c2hUb1F1ZXVlIH0gZnJvbSAnLi9ldmVudHMvcXVldWUnO1xuXG4vLyDlr7zlhaXmn6Xor6LmqKHlnZcsIOS7peazqOWGjCB7e0VSQTouLi59fSDlro9cbmltcG9ydCAnLi9tYWNyby9wYXJzZXInO1xuXG4vLyDlr7zlhaUgVUkg5qih5Z2XXG5pbXBvcnQgJy4vdWknO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7bnm5HlkKzlmajms6jlhoxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBAY29uc3Qge3N0cmluZ1tdfSBldmVudHNUb0xpc3RlblxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOaciemcgOimgeiiqyBFUkEg5qGG5p6255uR5ZCs55qE5LqL5Lu244CCXG4gKi9cbmNvbnN0IGV2ZW50c1RvTGlzdGVuID0gW1xuICAuLi5FVkVOVF9HUk9VUFMuSU5JVCxcbiAgLi4uRVZFTlRfR1JPVVBTLlNZTkMsXG4gIC4uLkVWRU5UX0dST1VQUy5BUEksXG4gIC4uLkVWRU5UX0dST1VQUy5VUERBVEVfTUtfT05MWSxcbiAgLi4uRVZFTlRfR1JPVVBTLkNPTExJU0lPTl9ERVRFQ1RPUlMsXG4gIC4uLkVWRU5UX0dST1VQUy5DT01CT19TVEFSVEVSUyxcbl07XG5cbi8vIOmBjeWOhuS6i+S7tuWIl+ihqO+8jOS4uuavj+S4quS6i+S7tuazqOWGjOS4gOS4quWbnuiwg+WHveaVsOOAglxuLy8g6L+Z5Liq5Zue6LCD5Ye95pWw5piv5omA5pyJ5LqL5Lu255qE57uf5LiA5YWl5Y+j44CCXG5ldmVudHNUb0xpc3Rlbi5mb3JFYWNoKGV2ID0+IHtcbiAgLy8gYGV2ZW50T25gIOaYr+mFkummhuWKqeaJi+aPkOS+m+eahOWFqOWxgOWHveaVsO+8jOeUqOS6juazqOWGjOS6i+S7tuebkeWQrOOAglxuICAvLyDlvZPkuovku7YgYGV2YCDop6blj5Hml7bvvIzlm57osIPlh73mlbDooqvosIPnlKjvvIzlubblsIbkuovku7bnsbvlnosgYGV2YCDlkozkuovku7bor6bmg4UgYGRldGFpbGAg5o6o5YWl6Zif5YiX44CCXG4gIGV2ZW50T24oZXYsIChkZXRhaWw6IGFueSkgPT4gcHVzaFRvUXVldWUoZXYsIGRldGFpbCkpO1xufSk7XG5cbi8vIOS4uumFkummhuWKqeaJi+iEmuacrOeVjOmdouS4reeahOaJi+WKqOaMiemSruazqOWGjOebkeWQrOWZqOOAglxuLy8g54K55Ye75oyJ6ZKu5pe277yM5ZCM5qC35piv5ZCR6Zif5YiX5Lit5o6o5YWl5LiA5Liq54m55a6a57G75Z6L55qE5LqL5Lu244CCXG5ldmVudE9uKGdldEJ1dHRvbkV2ZW50KCflhpnlhaXlj5jph4/kv67mlLknKSwgKCkgPT4gcHVzaFRvUXVldWUoJ21hbnVhbF93cml0ZScpKTtcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+aJi+WKqOWQjOatpeeKtuaAgScpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX3N5bmMnKSk7XG5ldmVudE9uKGdldEJ1dHRvbkV2ZW50KCflvLrliLblrozlhajph43nrpcnKSwgKCkgPT4gcHVzaFRvUXVldWUoJ21hbnVhbF9mdWxsX3N5bmMnKSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/index.ts\n\n}");
  },
  "./src/ERA变量框架/macro/parser.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/macro/parser.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseEraMacros: () => (/* binding */ parseEraMacros)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger();\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseEraMacros(text) {\n    const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{ERA')) {\n        return text;\n    }\n    // 获取 stat_data\n    const { stat } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.getEraData)();\n    if (!stat) {\n        logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n        // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n        return text;\n    }\n    return text.replace(macroRegex, (substring, withMeta, path) => {\n        const funcName = 'parseEraMacros';\n        const trimmedPath = path.trim();\n        const includeMeta = !!withMeta;\n        let data;\n        if (trimmedPath === '$ALLDATA') {\n            data = stat;\n        }\n        else {\n            data = _.get(stat, trimmedPath);\n        }\n        if (data === undefined) {\n            logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n            return ''; // 路径未找到, 返回空字符串\n        }\n        // 根据 withMeta 标志决定是否移除 $meta 字段\n        const dataBeforeUnescape = includeMeta ? data : (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.removeMetaFields)(data);\n        // 在返回数据前进行反转义\n        const finalData = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.unescapeEraData)(dataBeforeUnescape);\n        logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n            before: dataBeforeUnescape,\n            after: finalData,\n        });\n        // 如果是对象或数组, 转换为 JSON 字符串\n        if (typeof finalData === 'object' && finalData !== null) {\n            return JSON.stringify(finalData);\n        }\n        // 如果是原始类型, 直接转换为字符串\n        return String(finalData);\n    });\n}\n$(() => {\n    /**\n     * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n     *\n     * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n     *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n     * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n     *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n     */\n    registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n        // 直接复用 parseEraMacros 函数的逻辑。\n        // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n        return parseEraMacros(substring);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L21hY3JvL3BhcnNlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQWdEO0FBQ2lCO0FBQzNCO0FBRXRDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sRUFBRSxDQUFDO0FBRTVCOzs7OztHQUtHO0FBQ0ksU0FBUyxjQUFjLENBQUMsSUFBWTtJQUN6QyxNQUFNLFVBQVUsR0FBRyw0Q0FBNEMsQ0FBQztJQUVoRSw0QkFBNEI7SUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUM1QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxlQUFlO0lBQ2YsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLDJEQUFVLEVBQUUsQ0FBQztJQUM5QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDVixNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFDekQsb0NBQW9DO1FBQ3BDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQzVELE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDO1FBQ2xDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNoQyxNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBRS9CLElBQUksSUFBSSxDQUFDO1FBQ1QsSUFBSSxXQUFXLEtBQUssVUFBVSxFQUFFLENBQUM7WUFDL0IsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNkLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSx1QkFBdUIsV0FBVyxlQUFlLENBQUMsQ0FBQztZQUN6RSxPQUFPLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQjtRQUM3QixDQUFDO1FBRUQsZ0NBQWdDO1FBQ2hDLE1BQU0sa0JBQWtCLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGlFQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZFLGNBQWM7UUFDZCxNQUFNLFNBQVMsR0FBRyw0REFBZSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFdEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLFdBQVcsRUFBRSxFQUFFO1lBQ3pELE1BQU0sRUFBRSxrQkFBa0I7WUFDMUIsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQyxDQUFDO1FBRUgseUJBQXlCO1FBQ3pCLElBQUksT0FBTyxTQUFTLEtBQUssUUFBUSxJQUFJLFNBQVMsS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUN4RCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELG9CQUFvQjtRQUNwQixPQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMzQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxDQUFDLENBQUMsR0FBRyxFQUFFO0lBQ0w7Ozs7Ozs7T0FPRztJQUNILGlCQUFpQixDQUFDLDRDQUE0QyxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFDckcsNkJBQTZCO1FBQzdCLG9EQUFvRDtRQUNwRCxPQUFPLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNuQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvbWFjcm8vcGFyc2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVuZXNjYXBlRXJhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgcmVtb3ZlTWV0YUZpZWxkcyB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcblxuLyoqXG4gKiDop6PmnpDlrZfnrKbkuLLkuK3nmoQgRVJBIOWujywg5bm25bCG5YW25pu/5o2i5Li65a+55bqU55qE5Y+Y6YeP5YC844CCXG4gKiDov5nmmK/mj5Dkvpvnu5nlhbbku5bmqKHlnZfosIPnlKjnmoTlhazlhbHmjqXlj6PjgIJcbiAqIEBwYXJhbSB0ZXh0IC0g5YyF5ZCr5a6P55qE6L6T5YWl5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyAtIOabv+aNouWuj+WQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFcmFNYWNyb3ModGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbWFjcm9SZWdleCA9IC97e1xccypFUkEoLXdpdGhtZXRhKT9cXHMqOlxccyooW159XSs/KVxccyp9fS9naTtcblxuICAvLyDlpoLmnpzmlofmnKzkuK3kuI3ljIXlkKvlro/nibnlvoHlrZfnrKbkuLIsIOebtOaOpei/lOWbnuS7peS8mOWMluaAp+iDvVxuICBpZiAoIXRleHQuaW5jbHVkZXMoJ3t7RVJBJykpIHtcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIC8vIOiOt+WPliBzdGF0X2RhdGFcbiAgY29uc3QgeyBzdGF0IH0gPSBnZXRFcmFEYXRhKCk7XG4gIGlmICghc3RhdCkge1xuICAgIGxvZ2dlci53YXJuKCdwYXJzZUVyYU1hY3JvcycsICfml6Dms5Xojrflj5bliLAgc3RhdF9kYXRhLCDlro/mm7/mjaLlpLHotKUuJyk7XG4gICAgLy8g5aaC5p6c5rKh5pyJIHN0YXRfZGF0YSwg5Lu75L2V5a6P6YO95peg5rOV6Kej5p6QLCDnm7TmjqXov5Tlm57ljp/mlofmnKxcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIHJldHVybiB0ZXh0LnJlcGxhY2UobWFjcm9SZWdleCwgKHN1YnN0cmluZywgd2l0aE1ldGEsIHBhdGgpID0+IHtcbiAgICBjb25zdCBmdW5jTmFtZSA9ICdwYXJzZUVyYU1hY3Jvcyc7XG4gICAgY29uc3QgdHJpbW1lZFBhdGggPSBwYXRoLnRyaW0oKTtcbiAgICBjb25zdCBpbmNsdWRlTWV0YSA9ICEhd2l0aE1ldGE7XG5cbiAgICBsZXQgZGF0YTtcbiAgICBpZiAodHJpbW1lZFBhdGggPT09ICckQUxMREFUQScpIHtcbiAgICAgIGRhdGEgPSBzdGF0O1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhID0gXy5nZXQoc3RhdCwgdHJpbW1lZFBhdGgpO1xuICAgIH1cblxuICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGxvZ2dlci53YXJuKGZ1bmNOYW1lLCBg5ZyoIHN0YXRfZGF0YSDkuK3mnKrmib7liLDot6/lvoQgXCIke3RyaW1tZWRQYXRofVwiLCDlro/lsIbmm7/mjaLkuLrnqbrlrZfnrKbkuLIuYCk7XG4gICAgICByZXR1cm4gJyc7IC8vIOi3r+W+hOacquaJvuWIsCwg6L+U5Zue56m65a2X56ym5LiyXG4gICAgfVxuXG4gICAgLy8g5qC55o2uIHdpdGhNZXRhIOagh+W/l+WGs+WumuaYr+WQpuenu+mZpCAkbWV0YSDlrZfmrrVcbiAgICBjb25zdCBkYXRhQmVmb3JlVW5lc2NhcGUgPSBpbmNsdWRlTWV0YSA/IGRhdGEgOiByZW1vdmVNZXRhRmllbGRzKGRhdGEpO1xuXG4gICAgLy8g5Zyo6L+U5Zue5pWw5o2u5YmN6L+b6KGM5Y+N6L2s5LmJXG4gICAgY29uc3QgZmluYWxEYXRhID0gdW5lc2NhcGVFcmFEYXRhKGRhdGFCZWZvcmVVbmVzY2FwZSk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ3BhcnNlRXJhTWFjcm9zJywgYOWuj+abv+aNouaVsOaNruWPjei9rOS5iTogJHt0cmltbWVkUGF0aH1gLCB7XG4gICAgICBiZWZvcmU6IGRhdGFCZWZvcmVVbmVzY2FwZSxcbiAgICAgIGFmdGVyOiBmaW5hbERhdGEsXG4gICAgfSk7XG5cbiAgICAvLyDlpoLmnpzmmK/lr7nosaHmiJbmlbDnu4QsIOi9rOaNouS4uiBKU09OIOWtl+espuS4slxuICAgIGlmICh0eXBlb2YgZmluYWxEYXRhID09PSAnb2JqZWN0JyAmJiBmaW5hbERhdGEgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShmaW5hbERhdGEpO1xuICAgIH1cblxuICAgIC8vIOWmguaenOaYr+WOn+Wni+exu+Weiywg55u05o6l6L2s5o2i5Li65a2X56ym5LiyXG4gICAgcmV0dXJuIFN0cmluZyhmaW5hbERhdGEpO1xuICB9KTtcbn1cblxuJCgoKSA9PiB7XG4gIC8qKlxuICAgKiDms6jlhowgRVJBIOWujywg55So5LqO5Zyo5Y+R6YCB57uZIEFJIOeahOa2iOaBr+S4reafpeivouW9k+WJjeiBiuWkqeeahOWPmOmHj+aVsOaNrlxuICAgKlxuICAgKiAtIGB7e0VSQTpwYXRoLnRvLmRhdGF9fWA6IOafpeivouW5tuabv+aNouS4uioq5LiN5ZCrKiogYCRtZXRhYCDnmoTnuq/lh4DmlbDmja7jgIJcbiAgICogICAtIGB7e0VSQTokQUxMREFUQX19YCDlsIbov5Tlm57mlbTkuKrnp7vpmaQgYCRtZXRhYCDlkI7nmoQgYHN0YXRfZGF0YWAg5a+56LGh44CCXG4gICAqIC0gYHt7RVJBLXdpdGhtZXRhOnBhdGgudG8uZGF0YX19YDog5p+l6K+i5bm25pu/5o2i5Li6KirljIXlkKsqKiBgJG1ldGFgIOeahOWOn+Wni+aVsOaNruOAglxuICAgKiAgIC0gYHt7RVJBLXdpdGhtZXRhOiRBTExEQVRBfX1gIOWwhui/lOWbnuWujOaVtOeahCBgc3RhdF9kYXRhYCDlr7nosaHjgIJcbiAgICovXG4gIHJlZ2lzdGVyTWFjcm9MaWtlKC97e1xccypFUkEoLXdpdGhtZXRhKT9cXHMqOlxccyooW159XSs/KVxccyp9fS9naSwgKGNvbnRleHQsIHN1YnN0cmluZywgd2l0aE1ldGEsIHBhdGgpID0+IHtcbiAgICAvLyDnm7TmjqXlpI3nlKggcGFyc2VFcmFNYWNyb3Mg5Ye95pWw55qE6YC76L6R44CCXG4gICAgLy8gc3Vic3RyaW5nIOWPguaVsOaYr+WMuemFjeWIsOeahOWujOaVtOWuj+Wtl+espuS4siwg5aaCIFwie3tFUkE6cGF0aC50by5kYXRhfX1cIlxuICAgIHJldHVybiBwYXJzZUVyYU1hY3JvcyhzdWJzdHJpbmcpO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/macro/parser.ts\n\n}");
  },
  "./src/ERA变量框架/scriptIniter/settings.ts": 
  /*!**********************************************!*\
  !*** ./src/ERA变量框架/scriptIniter/settings.ts ***!
  \**********************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initializeExternalSettings: () => (/* binding */ initializeExternalSettings)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"zod\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(zod__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger();\n/**\n * 定义外部设定的变量结构和默认值。\n */\nconst SettingsSchema = zod__WEBPACK_IMPORTED_MODULE_1__.z.object({\n    强制重载功能: zod__WEBPACK_IMPORTED_MODULE_1__.z.boolean().default(false),\n    强制重载消息数: zod__WEBPACK_IMPORTED_MODULE_1__.z.number().default(2),\n});\n/**\n * 初始化脚本的外部设置变量。\n * 该函数会检查并创建缺失的脚本变量，如果已存在则不进行任何操作。\n * 同时，它会输出检查结果，报告哪些变量已存在，哪些缺失。\n */\nfunction initializeExternalSettings() {\n    const scriptId = getScriptId();\n    // 检查并初始化脚本变量\n    const currentVars = getVariables({ type: 'script', script_id: scriptId }) ?? {};\n    const defaultSettings = SettingsSchema.parse({}); // 从 Zod schema 获取一个包含所有默认值的对象\n    const missingVars = {};\n    const existingVarKeys = [];\n    logger.debug('initializeExternalSettings', '当前脚本变量为:', currentVars);\n    for (const key of Object.keys(defaultSettings)) {\n        if (key in currentVars) {\n            existingVarKeys.push(key);\n        }\n        else {\n            missingVars[key] = defaultSettings[key];\n        }\n    }\n    // 报告检查结果\n    if (existingVarKeys.length > 0) {\n        logger.debug('initializeExternalSettings', '检测到以下现有变量:', existingVarKeys);\n    }\n    const missingVarKeys = Object.keys(missingVars);\n    if (missingVarKeys.length > 0) {\n        logger.debug('initializeExternalSettings', '检测到以下缺失变量:', missingVarKeys);\n        // 创建缺失的变量\n        insertVariables(missingVars, { type: 'script', script_id: scriptId });\n        logger.log('initializeExternalSettings', '已初始化缺失的脚本变量。');\n    }\n    if (missingVarKeys.length === 0) {\n        logger.log('initializeExternalSettings', '所有必需的外部变量均已存在，无需初始化。');\n    }\n}\n// 导出函数，由事件分发器在 app_ready 事件时调用\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3NjcmlwdEluaXRlci9zZXR0aW5ncy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXNDOzs7QUFDdEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4Q0FBTSxDQUFDLENBQUM7QUFDM0IsQ0FBQyxDQUFDO0FBQ0YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEIsQ0FBQyxDQUFDO0FBQ0YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGtDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3RDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsa0NBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQztBQUNGLENBQUMsQ0FBQztBQUNGLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzdCLENBQUMsQ0FBQztBQUNLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25GLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNuRixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2hDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDckMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNiLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25ELENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNSLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNaLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2pGLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNuRCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbkMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2hGLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDN0UsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNyQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4RSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ0o7QUFDQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3NjcmlwdEluaXRlci9zZXR0aW5ncy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xuLyoqXG4gKiDlrprkuYnlpJbpg6jorr7lrprnmoTlj5jph4/nu5PmnoTlkozpu5jorqTlgLzjgIJcbiAqL1xuY29uc3QgU2V0dGluZ3NTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAg5by65Yi26YeN6L295Yqf6IO9OiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbiAgICDlvLrliLbph43ovb3mtojmga/mlbA6IHoubnVtYmVyKCkuZGVmYXVsdCgyKSxcbn0pO1xuLyoqXG4gKiDliJ3lp4vljJbohJrmnKznmoTlpJbpg6jorr7nva7lj5jph4/jgIJcbiAqIOivpeWHveaVsOS8muajgOafpeW5tuWIm+W7uue8uuWkseeahOiEmuacrOWPmOmHj++8jOWmguaenOW3suWtmOWcqOWImeS4jei/m+ihjOS7u+S9leaTjeS9nOOAglxuICog5ZCM5pe277yM5a6D5Lya6L6T5Ye65qOA5p+l57uT5p6c77yM5oql5ZGK5ZOq5Lqb5Y+Y6YeP5bey5a2Y5Zyo77yM5ZOq5Lqb57y65aSx44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncygpIHtcbiAgICBjb25zdCBzY3JpcHRJZCA9IGdldFNjcmlwdElkKCk7XG4gICAgLy8g5qOA5p+l5bm25Yid5aeL5YyW6ISa5pys5Y+Y6YePXG4gICAgY29uc3QgY3VycmVudFZhcnMgPSBnZXRWYXJpYWJsZXMoeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBzY3JpcHRJZCB9KSA/PyB7fTtcbiAgICBjb25zdCBkZWZhdWx0U2V0dGluZ3MgPSBTZXR0aW5nc1NjaGVtYS5wYXJzZSh7fSk7IC8vIOS7jiBab2Qgc2NoZW1hIOiOt+WPluS4gOS4quWMheWQq+aJgOaciem7mOiupOWAvOeahOWvueixoVxuICAgIGNvbnN0IG1pc3NpbmdWYXJzID0ge307XG4gICAgY29uc3QgZXhpc3RpbmdWYXJLZXlzID0gW107XG4gICAgbG9nZ2VyLmRlYnVnKCdpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncycsICflvZPliY3ohJrmnKzlj5jph4/kuLo6JywgY3VycmVudFZhcnMpO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGRlZmF1bHRTZXR0aW5ncykpIHtcbiAgICAgICAgaWYgKGtleSBpbiBjdXJyZW50VmFycykge1xuICAgICAgICAgICAgZXhpc3RpbmdWYXJLZXlzLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1pc3NpbmdWYXJzW2tleV0gPSBkZWZhdWx0U2V0dGluZ3Nba2V5XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyDmiqXlkYrmo4Dmn6Xnu5PmnpxcbiAgICBpZiAoZXhpc3RpbmdWYXJLZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncycsICfmo4DmtYvliLDku6XkuIvnjrDmnInlj5jph486JywgZXhpc3RpbmdWYXJLZXlzKTtcbiAgICB9XG4gICAgY29uc3QgbWlzc2luZ1ZhcktleXMgPSBPYmplY3Qua2V5cyhtaXNzaW5nVmFycyk7XG4gICAgaWYgKG1pc3NpbmdWYXJLZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncycsICfmo4DmtYvliLDku6XkuIvnvLrlpLHlj5jph486JywgbWlzc2luZ1ZhcktleXMpO1xuICAgICAgICAvLyDliJvlu7rnvLrlpLHnmoTlj5jph49cbiAgICAgICAgaW5zZXJ0VmFyaWFibGVzKG1pc3NpbmdWYXJzLCB7IHR5cGU6ICdzY3JpcHQnLCBzY3JpcHRfaWQ6IHNjcmlwdElkIH0pO1xuICAgICAgICBsb2dnZXIubG9nKCdpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncycsICflt7LliJ3lp4vljJbnvLrlpLHnmoTohJrmnKzlj5jph4/jgIInKTtcbiAgICB9XG4gICAgaWYgKG1pc3NpbmdWYXJLZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBsb2dnZXIubG9nKCdpbml0aWFsaXplRXh0ZXJuYWxTZXR0aW5ncycsICfmiYDmnInlv4XpnIDnmoTlpJbpg6jlj5jph4/lnYflt7LlrZjlnKjvvIzml6DpnIDliJ3lp4vljJbjgIInKTtcbiAgICB9XG59XG4vLyDlr7zlh7rlh73mlbDvvIznlLHkuovku7bliIblj5HlmajlnKggYXBwX3JlYWR5IOS6i+S7tuaXtuiwg+eUqFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/scriptIniter/settings.ts\n\n}");
  },
  "./src/ERA变量框架/ui/components/statusBar/index.ts": 
  /*!******************************************************!*\
  !*** ./src/ERA变量框架/ui/components/statusBar/index.ts ***!
  \******************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initStatusBar: () => (/* binding */ initStatusBar)\n/* harmony export */ });\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"jquery\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _statusBarContent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../statusBarContent */ \"./src/ERA变量框架/ui/components/statusBarContent/index.ts\");\n\n\nconst statusBarId = `era-status-bar-${getScriptId()}`;\nlet isExpanded = false; // 追踪展开/收缩状态\n// 定义不同状态下的样式\nconst collapsedStyle = {\n    width: '50px',\n    height: '50px',\n    'border-radius': '50%',\n    bottom: '20px',\n    left: '20px',\n    top: '',\n    right: '',\n    cursor: 'pointer',\n    'justify-content': 'center',\n    'align-items': 'center',\n    display: 'flex',\n    overflow: 'hidden',\n};\nconst expandedStyle = {\n    width: '300px',\n    height: '200px',\n    'border-radius': '10px',\n    cursor: 'default',\n    padding: '12px',\n    display: 'block',\n};\nfunction toggleExpand($statusBar, $content) {\n    isExpanded = !isExpanded;\n    if (isExpanded) {\n        // 展开\n        $statusBar.css(expandedStyle);\n        $statusBar.find('span').hide();\n        $content.show();\n        // 调用渲染函数，以确保显示的是最新的数据。\n        // 这是延迟渲染机制的一部分，用于解决在隐藏元素上更新 HTML 可能导致内容不全的问题。\n        (0,_statusBarContent__WEBPACK_IMPORTED_MODULE_1__.renderStatusBarContent)($content);\n    }\n    else {\n        // 收缩\n        $statusBar.css(collapsedStyle);\n        $statusBar.find('span').show();\n        $content.hide();\n    }\n}\nfunction createStatusBar() {\n    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${statusBarId}`).length > 0) {\n        return;\n    }\n    const $statusBar = jquery__WEBPACK_IMPORTED_MODULE_0___default()('<div>')\n        .attr('id', statusBarId)\n        .css({\n        position: 'fixed',\n        'background-color': 'rgba(0, 0, 0, 0.7)',\n        color: 'white',\n        'font-size': '14px',\n        'z-index': '10000',\n        'border-top': '1px solid #444',\n        transition: 'all 0.3s ease-in-out',\n        ...collapsedStyle,\n    })\n        .html('<span>ERA</span>');\n    const $content = jquery__WEBPACK_IMPORTED_MODULE_0___default()('<div>').css({\n        display: 'none',\n        'overflow-y': 'auto',\n        height: '100%',\n    });\n    $statusBar.append($content);\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()('body').append($statusBar);\n    $statusBar.draggable({\n        handle: `#${statusBarId}`,\n        containment: 'window',\n    });\n    $statusBar.on('click', () => {\n        setTimeout(() => {\n            if ($statusBar.hasClass('ui-draggable-dragging')) {\n                return;\n            }\n            toggleExpand($statusBar, $content);\n        }, 50);\n    });\n    return $statusBar;\n}\nfunction removeStatusBar() {\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${statusBarId}`).remove();\n}\n// 导出初始化函数，由 ui/index.ts 调用\nfunction initStatusBar() {\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(() => {\n        const $statusBar = createStatusBar();\n        if (!$statusBar)\n            return;\n        const $content = $statusBar.find('div');\n        (0,_statusBarContent__WEBPACK_IMPORTED_MODULE_1__.initStatusBarContent)($content);\n    });\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on('pagehide', () => {\n        removeStatusBar();\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2NvbXBvbmVudHMvc3RhdHVzQmFyL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBdUI7QUFDNEQ7QUFTbkYsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLFdBQVcsRUFBRSxFQUFFLENBQUM7QUFDdEQsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsWUFBWTtBQUVwQyxhQUFhO0FBQ2IsTUFBTSxjQUFjLEdBQUc7SUFDckIsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsTUFBTTtJQUNkLGVBQWUsRUFBRSxLQUFLO0lBQ3RCLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLE1BQU07SUFDWixHQUFHLEVBQUUsRUFBRTtJQUNQLEtBQUssRUFBRSxFQUFFO0lBQ1QsTUFBTSxFQUFFLFNBQVM7SUFDakIsaUJBQWlCLEVBQUUsUUFBUTtJQUMzQixhQUFhLEVBQUUsUUFBUTtJQUN2QixPQUFPLEVBQUUsTUFBTTtJQUNmLFFBQVEsRUFBRSxRQUFRO0NBQ25CLENBQUM7QUFFRixNQUFNLGFBQWEsR0FBRztJQUNwQixLQUFLLEVBQUUsT0FBTztJQUNkLE1BQU0sRUFBRSxPQUFPO0lBQ2YsZUFBZSxFQUFFLE1BQU07SUFDdkIsTUFBTSxFQUFFLFNBQVM7SUFDakIsT0FBTyxFQUFFLE1BQU07SUFDZixPQUFPLEVBQUUsT0FBTztDQUNqQixDQUFDO0FBRUYsU0FBUyxZQUFZLENBQUMsVUFBa0IsRUFBRSxRQUFnQjtJQUN4RCxVQUFVLEdBQUcsQ0FBQyxVQUFVLENBQUM7SUFDekIsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUNmLEtBQUs7UUFDTCxVQUFVLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzlCLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0IsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLHVCQUF1QjtRQUN2Qiw4Q0FBOEM7UUFDOUMseUVBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbkMsQ0FBQztTQUFNLENBQUM7UUFDTixLQUFLO1FBQ0wsVUFBVSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUMvQixVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQy9CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQixDQUFDO0FBQ0gsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0QixJQUFJLDZDQUFDLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUNwQyxPQUFPO0lBQ1QsQ0FBQztJQUVELE1BQU0sVUFBVSxHQUFHLDZDQUFDLENBQUMsT0FBTyxDQUFDO1NBQzFCLElBQUksQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDO1NBQ3ZCLEdBQUcsQ0FBQztRQUNILFFBQVEsRUFBRSxPQUFPO1FBQ2pCLGtCQUFrQixFQUFFLG9CQUFvQjtRQUN4QyxLQUFLLEVBQUUsT0FBTztRQUNkLFdBQVcsRUFBRSxNQUFNO1FBQ25CLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFlBQVksRUFBRSxnQkFBZ0I7UUFDOUIsVUFBVSxFQUFFLHNCQUFzQjtRQUNsQyxHQUFHLGNBQWM7S0FDbEIsQ0FBQztTQUNELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRTVCLE1BQU0sUUFBUSxHQUFHLDZDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQzlCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsWUFBWSxFQUFFLE1BQU07UUFDcEIsTUFBTSxFQUFFLE1BQU07S0FDZixDQUFDLENBQUM7SUFFSCxVQUFVLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzVCLDZDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRTdCLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFDbkIsTUFBTSxFQUFFLElBQUksV0FBVyxFQUFFO1FBQ3pCLFdBQVcsRUFBRSxRQUFRO0tBQ3RCLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUMxQixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQztnQkFDakQsT0FBTztZQUNULENBQUM7WUFDRCxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0Qiw2Q0FBQyxDQUFDLElBQUksV0FBVyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNoQyxDQUFDO0FBRUQsMkJBQTJCO0FBQ3BCLFNBQVMsYUFBYTtJQUMzQiw2Q0FBQyxDQUFDLEdBQUcsRUFBRTtRQUNMLE1BQU0sVUFBVSxHQUFHLGVBQWUsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTztRQUV4QixNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLHVFQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBRUgsNkNBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUM1QixlQUFlLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91aS9jb21wb25lbnRzL3N0YXR1c0Jhci9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IHsgaW5pdFN0YXR1c0JhckNvbnRlbnQsIHJlbmRlclN0YXR1c0JhckNvbnRlbnQgfSBmcm9tICcuLi9zdGF0dXNCYXJDb250ZW50JztcblxuLy8g55Sx5LqOIGpxdWVyeS11aS1kaXN0IOS4jeWQqyB0eXBlcywg5oiR5Lus6ZyA6KaB5omL5Yqo5aOw5piOIGRyYWdnYWJsZVxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgSlF1ZXJ5IHtcbiAgICBkcmFnZ2FibGUob3B0aW9ucz86IGFueSk6IEpRdWVyeTtcbiAgfVxufVxuXG5jb25zdCBzdGF0dXNCYXJJZCA9IGBlcmEtc3RhdHVzLWJhci0ke2dldFNjcmlwdElkKCl9YDtcbmxldCBpc0V4cGFuZGVkID0gZmFsc2U7IC8vIOi/vei4quWxleW8gC/mlLbnvKnnirbmgIFcblxuLy8g5a6a5LmJ5LiN5ZCM54q25oCB5LiL55qE5qC35byPXG5jb25zdCBjb2xsYXBzZWRTdHlsZSA9IHtcbiAgd2lkdGg6ICc1MHB4JyxcbiAgaGVpZ2h0OiAnNTBweCcsXG4gICdib3JkZXItcmFkaXVzJzogJzUwJScsXG4gIGJvdHRvbTogJzIwcHgnLFxuICBsZWZ0OiAnMjBweCcsXG4gIHRvcDogJycsXG4gIHJpZ2h0OiAnJyxcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gICdqdXN0aWZ5LWNvbnRlbnQnOiAnY2VudGVyJyxcbiAgJ2FsaWduLWl0ZW1zJzogJ2NlbnRlcicsXG4gIGRpc3BsYXk6ICdmbGV4JyxcbiAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxufTtcblxuY29uc3QgZXhwYW5kZWRTdHlsZSA9IHtcbiAgd2lkdGg6ICczMDBweCcsXG4gIGhlaWdodDogJzIwMHB4JyxcbiAgJ2JvcmRlci1yYWRpdXMnOiAnMTBweCcsXG4gIGN1cnNvcjogJ2RlZmF1bHQnLFxuICBwYWRkaW5nOiAnMTJweCcsXG4gIGRpc3BsYXk6ICdibG9jaycsXG59O1xuXG5mdW5jdGlvbiB0b2dnbGVFeHBhbmQoJHN0YXR1c0JhcjogSlF1ZXJ5LCAkY29udGVudDogSlF1ZXJ5KSB7XG4gIGlzRXhwYW5kZWQgPSAhaXNFeHBhbmRlZDtcbiAgaWYgKGlzRXhwYW5kZWQpIHtcbiAgICAvLyDlsZXlvIBcbiAgICAkc3RhdHVzQmFyLmNzcyhleHBhbmRlZFN0eWxlKTtcbiAgICAkc3RhdHVzQmFyLmZpbmQoJ3NwYW4nKS5oaWRlKCk7XG4gICAgJGNvbnRlbnQuc2hvdygpO1xuICAgIC8vIOiwg+eUqOa4suafk+WHveaVsO+8jOS7peehruS/neaYvuekuueahOaYr+acgOaWsOeahOaVsOaNruOAglxuICAgIC8vIOi/meaYr+W7tui/n+a4suafk+acuuWItueahOS4gOmDqOWIhu+8jOeUqOS6juino+WGs+WcqOmakOiXj+WFg+e0oOS4iuabtOaWsCBIVE1MIOWPr+iDveWvvOiHtOWGheWuueS4jeWFqOeahOmXrumimOOAglxuICAgIHJlbmRlclN0YXR1c0JhckNvbnRlbnQoJGNvbnRlbnQpO1xuICB9IGVsc2Uge1xuICAgIC8vIOaUtue8qVxuICAgICRzdGF0dXNCYXIuY3NzKGNvbGxhcHNlZFN0eWxlKTtcbiAgICAkc3RhdHVzQmFyLmZpbmQoJ3NwYW4nKS5zaG93KCk7XG4gICAgJGNvbnRlbnQuaGlkZSgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0YXR1c0JhcigpIHtcbiAgaWYgKCQoYCMke3N0YXR1c0JhcklkfWApLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCAkc3RhdHVzQmFyID0gJCgnPGRpdj4nKVxuICAgIC5hdHRyKCdpZCcsIHN0YXR1c0JhcklkKVxuICAgIC5jc3Moe1xuICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICdyZ2JhKDAsIDAsIDAsIDAuNyknLFxuICAgICAgY29sb3I6ICd3aGl0ZScsXG4gICAgICAnZm9udC1zaXplJzogJzE0cHgnLFxuICAgICAgJ3otaW5kZXgnOiAnMTAwMDAnLFxuICAgICAgJ2JvcmRlci10b3AnOiAnMXB4IHNvbGlkICM0NDQnLFxuICAgICAgdHJhbnNpdGlvbjogJ2FsbCAwLjNzIGVhc2UtaW4tb3V0JyxcbiAgICAgIC4uLmNvbGxhcHNlZFN0eWxlLFxuICAgIH0pXG4gICAgLmh0bWwoJzxzcGFuPkVSQTwvc3Bhbj4nKTtcblxuICBjb25zdCAkY29udGVudCA9ICQoJzxkaXY+JykuY3NzKHtcbiAgICBkaXNwbGF5OiAnbm9uZScsXG4gICAgJ292ZXJmbG93LXknOiAnYXV0bycsXG4gICAgaGVpZ2h0OiAnMTAwJScsXG4gIH0pO1xuXG4gICRzdGF0dXNCYXIuYXBwZW5kKCRjb250ZW50KTtcbiAgJCgnYm9keScpLmFwcGVuZCgkc3RhdHVzQmFyKTtcblxuICAkc3RhdHVzQmFyLmRyYWdnYWJsZSh7XG4gICAgaGFuZGxlOiBgIyR7c3RhdHVzQmFySWR9YCxcbiAgICBjb250YWlubWVudDogJ3dpbmRvdycsXG4gIH0pO1xuXG4gICRzdGF0dXNCYXIub24oJ2NsaWNrJywgKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCRzdGF0dXNCYXIuaGFzQ2xhc3MoJ3VpLWRyYWdnYWJsZS1kcmFnZ2luZycpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvZ2dsZUV4cGFuZCgkc3RhdHVzQmFyLCAkY29udGVudCk7XG4gICAgfSwgNTApO1xuICB9KTtcblxuICByZXR1cm4gJHN0YXR1c0Jhcjtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlU3RhdHVzQmFyKCkge1xuICAkKGAjJHtzdGF0dXNCYXJJZH1gKS5yZW1vdmUoKTtcbn1cblxuLy8g5a+85Ye65Yid5aeL5YyW5Ye95pWw77yM55SxIHVpL2luZGV4LnRzIOiwg+eUqFxuZXhwb3J0IGZ1bmN0aW9uIGluaXRTdGF0dXNCYXIoKSB7XG4gICQoKCkgPT4ge1xuICAgIGNvbnN0ICRzdGF0dXNCYXIgPSBjcmVhdGVTdGF0dXNCYXIoKTtcbiAgICBpZiAoISRzdGF0dXNCYXIpIHJldHVybjtcblxuICAgIGNvbnN0ICRjb250ZW50ID0gJHN0YXR1c0Jhci5maW5kKCdkaXYnKTtcbiAgICBpbml0U3RhdHVzQmFyQ29udGVudCgkY29udGVudCk7XG4gIH0pO1xuXG4gICQod2luZG93KS5vbigncGFnZWhpZGUnLCAoKSA9PiB7XG4gICAgcmVtb3ZlU3RhdHVzQmFyKCk7XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/components/statusBar/index.ts\n\n}");
  },
  "./src/ERA变量框架/ui/components/statusBarContent/index.ts": 
  /*!*************************************************************!*\
  !*** ./src/ERA变量框架/ui/components/statusBarContent/index.ts ***!
  \*************************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initStatusBarContent: () => (/* binding */ initStatusBarContent),\n/* harmony export */   renderStatusBarContent: () => (/* binding */ renderStatusBarContent)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger();\nlet latestStatData = null; // 用于缓存最新的数据\nfunction jsonToHtml(data) {\n    // 如果数据不是对象（是字符串、数字、布尔值等），直接返回值\n    if (typeof data !== 'object' || data === null) {\n        return `<span style=\"color: #98fb98;\">${String(data)}</span>`;\n    }\n    // 如果是对象，则创建一个列表来展示其键值对\n    let listHtml = '<ul style=\"list-style-type: none; padding-left: 20px; margin: 0;\">';\n    for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n            const value = data[key];\n            listHtml += '<li>';\n            // 显示键\n            listHtml += `<strong style=\"color: #87ceeb;\">${key}:</strong> `;\n            // 递归调用以处理值\n            listHtml += jsonToHtml(value);\n            listHtml += '</li>';\n        }\n    }\n    listHtml += '</ul>';\n    return listHtml;\n}\n/**\n * 使用缓存的最新数据渲染状态栏内容。\n * @param $contentContainer - 内容区的 JQuery 对象。\n */\nfunction renderStatusBarContent($contentContainer) {\n    if (latestStatData) {\n        const html = jsonToHtml(latestStatData);\n        $contentContainer.html(html);\n    }\n    else {\n        $contentContainer.html('数据加载中...');\n    }\n}\nfunction initStatusBarContent($contentContainer) {\n    renderStatusBarContent($contentContainer); // 初始渲染\n    // 监听事件，更新缓存，并仅在状态栏展开时渲染\n    eventOn('era:writeDone', detail => {\n        // 核心问题：直接在隐藏的 DOM 元素（display: none）上执行复杂的 .html() 更新，\n        // 可能会因浏览器的渲染优化或怪癖导致内容显示不全。\n        //\n        // 解决方案：采用延迟渲染机制。\n        // 1. 数据到达时，不直接渲染 DOM，而是先存入 `latestStatData` 缓存。\n        // 2. 仅当内容容器可见时（即状态栏是展开的），才立即从缓存渲染。\n        // 3. 当状态栏从折叠态展开时，由 statusBar 组件负责调用 renderStatusBarContent 来确保渲染。\n        logger.debug('initStatusBarContent', '接收到 era:writeDone 事件，缓存数据。', detail);\n        if (detail && detail.statWithoutMeta) {\n            latestStatData = detail.statWithoutMeta;\n            // 如果状态栏当前是展开的，则立即更新\n            if ($contentContainer.is(':visible')) {\n                renderStatusBarContent($contentContainer);\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2NvbXBvbmVudHMvc3RhdHVzQmFyQ29udGVudC9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEM7QUFFNUMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxFQUFFLENBQUM7QUFDNUIsSUFBSSxjQUFjLEdBQVEsSUFBSSxDQUFDLENBQUMsWUFBWTtBQUU1QyxTQUFTLFVBQVUsQ0FBQyxJQUFTO0lBQzNCLCtCQUErQjtJQUMvQixJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDOUMsT0FBTyxpQ0FBaUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDaEUsQ0FBQztJQUVELHVCQUF1QjtJQUN2QixJQUFJLFFBQVEsR0FBRyxvRUFBb0UsQ0FBQztJQUNwRixLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN4QixRQUFRLElBQUksTUFBTSxDQUFDO1lBQ25CLE1BQU07WUFDTixRQUFRLElBQUksbUNBQW1DLEdBQUcsYUFBYSxDQUFDO1lBQ2hFLFdBQVc7WUFDWCxRQUFRLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLFFBQVEsSUFBSSxPQUFPLENBQUM7UUFDdEIsQ0FBQztJQUNILENBQUM7SUFDRCxRQUFRLElBQUksT0FBTyxDQUFDO0lBQ3BCLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxTQUFTLHNCQUFzQixDQUFDLGlCQUF5QjtJQUM5RCxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ25CLE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN4QyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztTQUFNLENBQUM7UUFDTixpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDckMsQ0FBQztBQUNILENBQUM7QUFFTSxTQUFTLG9CQUFvQixDQUFDLGlCQUF5QjtJQUM1RCxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsT0FBTztJQUVsRCx3QkFBd0I7SUFDeEIsT0FBTyxDQUFDLGVBQWUsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNoQyxzREFBc0Q7UUFDdEQsMkJBQTJCO1FBQzNCLEVBQUU7UUFDRixpQkFBaUI7UUFDakIsZ0RBQWdEO1FBQ2hELG1DQUFtQztRQUNuQyxrRUFBa0U7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSw0QkFBNEIsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMzRSxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDckMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUM7WUFDeEMsb0JBQW9CO1lBQ3BCLElBQUksaUJBQWlCLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDNUMsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91aS9jb21wb25lbnRzL3N0YXR1c0JhckNvbnRlbnQvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO1xubGV0IGxhdGVzdFN0YXREYXRhOiBhbnkgPSBudWxsOyAvLyDnlKjkuo7nvJPlrZjmnIDmlrDnmoTmlbDmja5cblxuZnVuY3Rpb24ganNvblRvSHRtbChkYXRhOiBhbnkpOiBzdHJpbmcge1xuICAvLyDlpoLmnpzmlbDmja7kuI3mmK/lr7nosaHvvIjmmK/lrZfnrKbkuLLjgIHmlbDlrZfjgIHluIPlsJTlgLznrYnvvInvvIznm7TmjqXov5Tlm57lgLxcbiAgaWYgKHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JyB8fCBkYXRhID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGA8c3BhbiBzdHlsZT1cImNvbG9yOiAjOThmYjk4O1wiPiR7U3RyaW5nKGRhdGEpfTwvc3Bhbj5gO1xuICB9XG5cbiAgLy8g5aaC5p6c5piv5a+56LGh77yM5YiZ5Yib5bu65LiA5Liq5YiX6KGo5p2l5bGV56S65YW26ZSu5YC85a+5XG4gIGxldCBsaXN0SHRtbCA9ICc8dWwgc3R5bGU9XCJsaXN0LXN0eWxlLXR5cGU6IG5vbmU7IHBhZGRpbmctbGVmdDogMjBweDsgbWFyZ2luOiAwO1wiPic7XG4gIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuICAgICAgbGlzdEh0bWwgKz0gJzxsaT4nO1xuICAgICAgLy8g5pi+56S66ZSuXG4gICAgICBsaXN0SHRtbCArPSBgPHN0cm9uZyBzdHlsZT1cImNvbG9yOiAjODdjZWViO1wiPiR7a2V5fTo8L3N0cm9uZz4gYDtcbiAgICAgIC8vIOmAkuW9kuiwg+eUqOS7peWkhOeQhuWAvFxuICAgICAgbGlzdEh0bWwgKz0ganNvblRvSHRtbCh2YWx1ZSk7XG4gICAgICBsaXN0SHRtbCArPSAnPC9saT4nO1xuICAgIH1cbiAgfVxuICBsaXN0SHRtbCArPSAnPC91bD4nO1xuICByZXR1cm4gbGlzdEh0bWw7XG59XG5cbi8qKlxuICog5L2/55So57yT5a2Y55qE5pyA5paw5pWw5o2u5riy5p+T54q25oCB5qCP5YaF5a6544CCXG4gKiBAcGFyYW0gJGNvbnRlbnRDb250YWluZXIgLSDlhoXlrrnljLrnmoQgSlF1ZXJ5IOWvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyU3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcjogSlF1ZXJ5KSB7XG4gIGlmIChsYXRlc3RTdGF0RGF0YSkge1xuICAgIGNvbnN0IGh0bWwgPSBqc29uVG9IdG1sKGxhdGVzdFN0YXREYXRhKTtcbiAgICAkY29udGVudENvbnRhaW5lci5odG1sKGh0bWwpO1xuICB9IGVsc2Uge1xuICAgICRjb250ZW50Q29udGFpbmVyLmh0bWwoJ+aVsOaNruWKoOi9veS4rS4uLicpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0U3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcjogSlF1ZXJ5KSB7XG4gIHJlbmRlclN0YXR1c0JhckNvbnRlbnQoJGNvbnRlbnRDb250YWluZXIpOyAvLyDliJ3lp4vmuLLmn5NcblxuICAvLyDnm5HlkKzkuovku7bvvIzmm7TmlrDnvJPlrZjvvIzlubbku4XlnKjnirbmgIHmoI/lsZXlvIDml7bmuLLmn5NcbiAgZXZlbnRPbignZXJhOndyaXRlRG9uZScsIGRldGFpbCA9PiB7XG4gICAgLy8g5qC45b+D6Zeu6aKY77ya55u05o6l5Zyo6ZqQ6JeP55qEIERPTSDlhYPntKDvvIhkaXNwbGF5OiBub25l77yJ5LiK5omn6KGM5aSN5p2C55qEIC5odG1sKCkg5pu05paw77yMXG4gICAgLy8g5Y+v6IO95Lya5Zug5rWP6KeI5Zmo55qE5riy5p+T5LyY5YyW5oiW5oCq55mW5a+86Ie05YaF5a655pi+56S65LiN5YWo44CCXG4gICAgLy9cbiAgICAvLyDop6PlhrPmlrnmoYjvvJrph4fnlKjlu7bov5/muLLmn5PmnLrliLbjgIJcbiAgICAvLyAxLiDmlbDmja7liLDovr7ml7bvvIzkuI3nm7TmjqXmuLLmn5MgRE9N77yM6ICM5piv5YWI5a2Y5YWlIGBsYXRlc3RTdGF0RGF0YWAg57yT5a2Y44CCXG4gICAgLy8gMi4g5LuF5b2T5YaF5a655a655Zmo5Y+v6KeB5pe277yI5Y2z54q25oCB5qCP5piv5bGV5byA55qE77yJ77yM5omN56uL5Y2z5LuO57yT5a2Y5riy5p+T44CCXG4gICAgLy8gMy4g5b2T54q25oCB5qCP5LuO5oqY5Y+g5oCB5bGV5byA5pe277yM55SxIHN0YXR1c0JhciDnu4Tku7botJ/otKPosIPnlKggcmVuZGVyU3RhdHVzQmFyQ29udGVudCDmnaXnoa7kv53muLLmn5PjgIJcbiAgICBsb2dnZXIuZGVidWcoJ2luaXRTdGF0dXNCYXJDb250ZW50JywgJ+aOpeaUtuWIsCBlcmE6d3JpdGVEb25lIOS6i+S7tu+8jOe8k+WtmOaVsOaNruOAgicsIGRldGFpbCk7XG4gICAgaWYgKGRldGFpbCAmJiBkZXRhaWwuc3RhdFdpdGhvdXRNZXRhKSB7XG4gICAgICBsYXRlc3RTdGF0RGF0YSA9IGRldGFpbC5zdGF0V2l0aG91dE1ldGE7XG4gICAgICAvLyDlpoLmnpznirbmgIHmoI/lvZPliY3mmK/lsZXlvIDnmoTvvIzliJnnq4vljbPmm7TmlrBcbiAgICAgIGlmICgkY29udGVudENvbnRhaW5lci5pcygnOnZpc2libGUnKSkge1xuICAgICAgICByZW5kZXJTdGF0dXNCYXJDb250ZW50KCRjb250ZW50Q29udGFpbmVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/components/statusBarContent/index.ts\n\n}");
  },
  "./src/ERA变量框架/ui/index.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/ui/index.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _components_statusBar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/statusBar */ "./src/ERA变量框架/ui/components/statusBar/index.ts");\n/**\n * @file UI 主入口\n * @description\n * 该文件负责统一加载和初始化所有 UI 组件。\n * 它导入各个组件的初始化函数，并依次执行。\n */\n\n// 在这里可以继续添加其他 UI 组件的初始化函数\nfunction initUI() {\n    (0,_components_statusBar__WEBPACK_IMPORTED_MODULE_0__.initStatusBar)();\n    // 以后可以添加例如 initControlPanel(), initCharacterSheet() 等\n}\n// 执行所有 UI 初始化\ninitUI();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7O0dBS0c7QUFFb0Q7QUFFdkQsMEJBQTBCO0FBQzFCLFNBQVMsTUFBTTtJQUNiLG9FQUFhLEVBQUUsQ0FBQztJQUNoQixzREFBc0Q7QUFDeEQsQ0FBQztBQUVELGNBQWM7QUFDZCxNQUFNLEVBQUUsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgVUkg5Li75YWl5Y+jXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaWh+S7tui0n+i0o+e7n+S4gOWKoOi9veWSjOWIneWni+WMluaJgOaciSBVSSDnu4Tku7bjgIJcbiAqIOWug+WvvOWFpeWQhOS4que7hOS7tueahOWIneWni+WMluWHveaVsO+8jOW5tuS+neasoeaJp+ihjOOAglxuICovXG5cbmltcG9ydCB7IGluaXRTdGF0dXNCYXIgfSBmcm9tICcuL2NvbXBvbmVudHMvc3RhdHVzQmFyJztcblxuLy8g5Zyo6L+Z6YeM5Y+v5Lul57un57ut5re75Yqg5YW25LuWIFVJIOe7hOS7tueahOWIneWni+WMluWHveaVsFxuZnVuY3Rpb24gaW5pdFVJKCkge1xuICBpbml0U3RhdHVzQmFyKCk7XG4gIC8vIOS7peWQjuWPr+S7pea3u+WKoOS+i+WmgiBpbml0Q29udHJvbFBhbmVsKCksIGluaXRDaGFyYWN0ZXJTaGVldCgpIOetiVxufVxuXG4vLyDmiafooYzmiYDmnIkgVUkg5Yid5aeL5YyWXG5pbml0VUkoKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/index.ts\n\n}');
  },
  "./src/ERA变量框架/ui/patch.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/ui/patch.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceRenderRecentMessages: () => (/* binding */ forceRenderRecentMessages)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换。\n */\n\nconst log = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger();\n/*\n * 强制重新渲染单条消息 (UI事件模拟备份)。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\n// function forceRenderMessage_backup_by_UI_event(messageId: number): Promise<void> {\n//   return new Promise(resolve => {\n//     const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n//     const $message = $(messageSelector);\n//\n//     if ($message.length === 0) {\n//       log.warn('forceRenderMessage_backup_by_UI_event', `找不到消息ID为 ${messageId} 的div。`);\n//       return resolve();\n//     }\n//\n//     const { state, buttons } = analyzeMessageUI($message);\n//\n//     if (state === 'editing') {\n//       // 如果已经是编辑状态，直接点击取消\n//       buttons.cancelEdit?.trigger('click');\n//       log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 处于编辑状态，已点击取消。`);\n//       setTimeout(resolve, 50);\n//     } else {\n//       // 如果是常规状态，先点击编辑，再点击取消\n//       buttons.edit?.trigger('click');\n//       log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 处于常规状态，已点击编辑。`);\n//       setTimeout(() => {\n//         // 重新分析以获取新状态下的按钮\n//         const { buttons: updatedButtons } = analyzeMessageUI($message);\n//         updatedButtons.cancelEdit?.trigger('click');\n//         log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 已点击取消。`);\n//         resolve();\n//       }, 50);\n//     }\n//   });\n// }\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在操作完成后 resolve。\n */\nasync function forceRenderMessage(messageId) {\n    const messages = getChatMessages(messageId);\n    if (!messages || messages.length === 0) {\n        log.warn('forceRenderMessage', `找不到消息ID为 ${messageId} 的消息。`);\n        return;\n    }\n    const message = messages[0];\n    // 使用 setChatMessages 并传入原封不动的消息内容来触发刷新\n    await setChatMessages([{ message_id: messageId, message: message.message }]);\n    log.debug('forceRenderMessage', `已使用 setChatMessages 刷新消息 ${messageId}。`);\n}\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nasync function forceRenderRecentMessages() {\n    const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n    // 检查是否启用了强制重载功能\n    const forceReload = _.get(scriptVars, '强制重载功能', false);\n    if (!forceReload) {\n        log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n        return; // 如果未启用，则不执行任何操作\n    }\n    // 获取要重载的消息数量，默认为1\n    const messageCount = _.get(scriptVars, '强制重载消息数', 1);\n    log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n    // 等待一小段时间, 确保变量更新已经完成\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const allMessages = getChatMessages('0-{{lastMessageId}}');\n    if (!allMessages || allMessages.length === 0) {\n        log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n        return;\n    }\n    // 根据脚本变量设置的数量来截取最近的消息\n    const recentMessages = allMessages.slice(-messageCount);\n    for (const message of recentMessages) {\n        log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n        await forceRenderMessage(message.message_id);\n        // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUV4RCxLQUFLLE1BQU0sT0FBTyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsYUFBYSxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3Qyw2QkFBNkI7UUFDN0IsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsR0FBRyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsRCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdWkvcGF0Y2gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDlvLrliLblro/muLLmn5PmqKHlnZdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmqKHmi5/nlKjmiLdVSeaTjeS9nCwg5by65Yi26YWS6aaG6YeN5paw5riy5p+T5raI5oGvLCDku6Xop6blj5HlrozmlbTnmoTlro/mm7/mjaLjgIJcbiAqL1xuXG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCk7XG5cbi8qXG4gKiDlvLrliLbph43mlrDmuLLmn5PljZXmnaHmtojmga8gKFVJ5LqL5Lu25qih5ouf5aSH5Lu9KeOAglxuICogQHBhcmFtIG1lc3NhZ2VJZCDopoHlvLrliLbmuLLmn5PnmoTmtojmga9JROOAglxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaooeaLn+eCueWHu+WujOaIkOWQjiByZXNvbHZl44CCXG4gKi9cbi8vIGZ1bmN0aW9uIGZvcmNlUmVuZGVyTWVzc2FnZV9iYWNrdXBfYnlfVUlfZXZlbnQobWVzc2FnZUlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbi8vICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuLy8gICAgIGNvbnN0IG1lc3NhZ2VTZWxlY3RvciA9IGBkaXYubWVzW21lc2lkPVwiJHttZXNzYWdlSWR9XCJdYDtcbi8vICAgICBjb25zdCAkbWVzc2FnZSA9ICQobWVzc2FnZVNlbGVjdG9yKTtcbi8vXG4vLyAgICAgaWYgKCRtZXNzYWdlLmxlbmd0aCA9PT0gMCkge1xuLy8gICAgICAgbG9nLndhcm4oJ2ZvcmNlUmVuZGVyTWVzc2FnZV9iYWNrdXBfYnlfVUlfZXZlbnQnLCBg5om+5LiN5Yiw5raI5oGvSUTkuLogJHttZXNzYWdlSWR9IOeahGRpduOAgmApO1xuLy8gICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbi8vICAgICB9XG4vL1xuLy8gICAgIGNvbnN0IHsgc3RhdGUsIGJ1dHRvbnMgfSA9IGFuYWx5emVNZXNzYWdlVUkoJG1lc3NhZ2UpO1xuLy9cbi8vICAgICBpZiAoc3RhdGUgPT09ICdlZGl0aW5nJykge1xuLy8gICAgICAgLy8g5aaC5p6c5bey57uP5piv57yW6L6R54q25oCB77yM55u05o6l54K55Ye75Y+W5raIXG4vLyAgICAgICBidXR0b25zLmNhbmNlbEVkaXQ/LnRyaWdnZXIoJ2NsaWNrJyk7XG4vLyAgICAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyTWVzc2FnZV9iYWNrdXBfYnlfVUlfZXZlbnQnLCBg5raI5oGvICR7bWVzc2FnZUlkfSDlpITkuo7nvJbovpHnirbmgIHvvIzlt7Lngrnlh7vlj5bmtojjgIJgKTtcbi8vICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgNTApO1xuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICAvLyDlpoLmnpzmmK/luLjop4TnirbmgIHvvIzlhYjngrnlh7vnvJbovpHvvIzlho3ngrnlh7vlj5bmtohcbi8vICAgICAgIGJ1dHRvbnMuZWRpdD8udHJpZ2dlcignY2xpY2snKTtcbi8vICAgICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJNZXNzYWdlX2JhY2t1cF9ieV9VSV9ldmVudCcsIGDmtojmga8gJHttZXNzYWdlSWR9IOWkhOS6juW4uOinhOeKtuaAge+8jOW3sueCueWHu+e8lui+keOAgmApO1xuLy8gICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4vLyAgICAgICAgIC8vIOmHjeaWsOWIhuaekOS7peiOt+WPluaWsOeKtuaAgeS4i+eahOaMiemSrlxuLy8gICAgICAgICBjb25zdCB7IGJ1dHRvbnM6IHVwZGF0ZWRCdXR0b25zIH0gPSBhbmFseXplTWVzc2FnZVVJKCRtZXNzYWdlKTtcbi8vICAgICAgICAgdXBkYXRlZEJ1dHRvbnMuY2FuY2VsRWRpdD8udHJpZ2dlcignY2xpY2snKTtcbi8vICAgICAgICAgbG9nLmRlYnVnKCdmb3JjZVJlbmRlck1lc3NhZ2VfYmFja3VwX2J5X1VJX2V2ZW50JywgYOa2iOaBryAke21lc3NhZ2VJZH0g5bey54K55Ye75Y+W5raI44CCYCk7XG4vLyAgICAgICAgIHJlc29sdmUoKTtcbi8vICAgICAgIH0sIDUwKTtcbi8vICAgICB9XG4vLyAgIH0pO1xuLy8gfVxuXG4vKipcbiAqIOW8uuWItumHjeaWsOa4suafk+WNleadoea2iOaBr+OAglxuICogQHBhcmFtIG1lc3NhZ2VJZCDopoHlvLrliLbmuLLmn5PnmoTmtojmga9JROOAglxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaTjeS9nOWujOaIkOWQjiByZXNvbHZl44CCXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlSWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBtZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcyhtZXNzYWdlSWQpO1xuXG4gIGlmICghbWVzc2FnZXMgfHwgbWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgbG9nLndhcm4oJ2ZvcmNlUmVuZGVyTWVzc2FnZScsIGDmib7kuI3liLDmtojmga9JROS4uiAke21lc3NhZ2VJZH0g55qE5raI5oGv44CCYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZSA9IG1lc3NhZ2VzWzBdO1xuXG4gIC8vIOS9v+eUqCBzZXRDaGF0TWVzc2FnZXMg5bm25Lyg5YWl5Y6f5bCB5LiN5Yqo55qE5raI5oGv5YaF5a655p2l6Kem5Y+R5Yi35pawXG4gIGF3YWl0IHNldENoYXRNZXNzYWdlcyhbeyBtZXNzYWdlX2lkOiBtZXNzYWdlSWQsIG1lc3NhZ2U6IG1lc3NhZ2UubWVzc2FnZSB9XSk7XG4gIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJNZXNzYWdlJywgYOW3suS9v+eUqCBzZXRDaGF0TWVzc2FnZXMg5Yi35paw5raI5oGvICR7bWVzc2FnZUlkfeOAgmApO1xufVxuXG4vKipcbiAqIOW8uuWItumHjeaWsOa4suafk+acgOi/keeahE7mnaHmtojmga8sIOS7peehruS/neWuj+iiq+ato+ehruabv+aNouOAglxuICog5piv5ZCm5omn6KGM5Lul5Y+K5riy5p+T55qE5pWw6YeP55Sx6ISa5pys5Y+Y6YeP5o6n5Yi244CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzKCkge1xuICBjb25zdCBzY3JpcHRWYXJzID0gZ2V0VmFyaWFibGVzKHsgdHlwZTogJ3NjcmlwdCcsIHNjcmlwdF9pZDogZ2V0U2NyaXB0SWQoKSB9KTtcblxuICAvLyDmo4Dmn6XmmK/lkKblkK/nlKjkuoblvLrliLbph43ovb3lip/og71cbiAgY29uc3QgZm9yY2VSZWxvYWQgPSBfLmdldChzY3JpcHRWYXJzLCAn5by65Yi26YeN6L295Yqf6IO9JywgZmFsc2UpO1xuICBpZiAoIWZvcmNlUmVsb2FkKSB7XG4gICAgbG9nLmRlYnVnKCdmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzJywgJ+W8uuWItumHjei9veWKn+iDveacquWQr+eUqCwg6Lez6L+H44CCJyk7XG4gICAgcmV0dXJuOyAvLyDlpoLmnpzmnKrlkK/nlKjvvIzliJnkuI3miafooYzku7vkvZXmk43kvZxcbiAgfVxuXG4gIC8vIOiOt+WPluimgemHjei9veeahOa2iOaBr+aVsOmHj++8jOm7mOiupOS4ujFcbiAgY29uc3QgbWVzc2FnZUNvdW50ID0gXy5nZXQoc2NyaXB0VmFycywgJ+W8uuWItumHjei9vea2iOaBr+aVsCcsIDEpO1xuICBsb2cubG9nKCdmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzJywgYOW8gOWni+W8uuWItumHjei9vSwg5pWw6YePOiAke21lc3NhZ2VDb3VudH1gKTtcblxuICAvLyDnrYnlvoXkuIDlsI/mrrXml7bpl7QsIOehruS/neWPmOmHj+abtOaWsOW3sue7j+WujOaIkFxuICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xuXG4gIGNvbnN0IGFsbE1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19Jyk7XG4gIGlmICghYWxsTWVzc2FnZXMgfHwgYWxsTWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgbG9nLndhcm4oJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5peg5rOV6I635Y+W5Yiw5Lu75L2V5raI5oGvLCDnu4jmraLph43ovb3jgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmoLnmja7ohJrmnKzlj5jph4/orr7nva7nmoTmlbDph4/mnaXmiKrlj5bmnIDov5HnmoTmtojmga9cbiAgY29uc3QgcmVjZW50TWVzc2FnZXMgPSBhbGxNZXNzYWdlcy5zbGljZSgtbWVzc2FnZUNvdW50KTtcblxuICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgcmVjZW50TWVzc2FnZXMpIHtcbiAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCBg5q2j5Zyo5by65Yi25riy5p+T5raI5oGvOiAke21lc3NhZ2UubWVzc2FnZV9pZH1gKTtcbiAgICBhd2FpdCBmb3JjZVJlbmRlck1lc3NhZ2UobWVzc2FnZS5tZXNzYWdlX2lkKTtcbiAgICAvLyDlnKjmr4/mrKHmk43kvZzkuYvpl7Tnn63mmoLmmoLlgZwsIOmBv+WFjeaTjeS9nOi/h+W/q+WvvOiHtFVJ6Zeu6aKY44CCXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICB9XG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295a6M5oiQ44CCJyk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/patch.ts\n\n}");
  },
  "./src/ERA变量框架/utils/constants.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/utils/constants.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_SCOPE: () => (/* binding */ CHAT_SCOPE),\n/* harmony export */   ERA_API_EVENTS: () => (/* binding */ ERA_API_EVENTS),\n/* harmony export */   ERA_DATA_REGEX: () => (/* binding */ ERA_DATA_REGEX),\n/* harmony export */   ERA_DATA_TAG: () => (/* binding */ ERA_DATA_TAG),\n/* harmony export */   ERA_EVENT_EMITTER: () => (/* binding */ ERA_EVENT_EMITTER),\n/* harmony export */   LOGS_PATH: () => (/* binding */ LOGS_PATH),\n/* harmony export */   META_DATA_PATH: () => (/* binding */ META_DATA_PATH),\n/* harmony export */   SEL_PATH: () => (/* binding */ SEL_PATH),\n/* harmony export */   STAT_DATA_PATH: () => (/* binding */ STAT_DATA_PATH)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   "ERAMetaData": {\n *     "EditLogs": { ... },\n *     "SelectedMks": [ ... ]\n *   },\n *   "stat_data": {\n *     "player": { "hp": 100, "gold": 50 },\n *     "world_state": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nconst CHAT_SCOPE = { type: \'chat\' };\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nconst META_DATA_PATH = \'ERAMetaData\';\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nconst STAT_DATA_PATH = \'stat_data\';\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `"EditLogs"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * "era_mk_1759246942209_jipmrj": [\n *   { "op": "insert", "path": "testData.inventory", "value_new": { "gold": 100, "slots": ["sword", "shield"] } },\n *   { "op": "update", "path": "player.hp", "value_old": 90, "value_new": 100 }\n * ]\n */\nconst LOGS_PATH = \'EditLogs\';\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `"SelectedMks"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , "era_mk_greeting", "era_mk_abc123", , "era_mk_xyz789"]\n */\nconst SEL_PATH = \'SelectedMks\';\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nconst ERA_DATA_TAG = \'era_data\';\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nconst ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nconst ERA_API_EVENTS = {\n    INSERT_BY_OBJECT: \'era:insertByObject\',\n    UPDATE_BY_OBJECT: \'era:updateByObject\',\n    INSERT_BY_PATH: \'era:insertByPath\',\n    UPDATE_BY_PATH: \'era:updateByPath\',\n    DELETE_BY_OBJECT: \'era:deleteByObject\',\n    DELETE_BY_PATH: \'era:deleteByPath\',\n    GET_CURRENT_VARS: \'era:getCurrentVars\',\n};\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nconst ERA_EVENT_EMITTER = {\n    /** 当变量写入完成时触发 */\n    WRITE_DONE: \'era:writeDone\',\n    /** 当API执行写入时触发 */\n    API_WRITE: \'era:apiWrite\',\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRCRztBQUVVO0FBRWI7Ozs7OztHQU1HO0FBQ0ksTUFBTSxVQUFVLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBZSxFQUFFLENBQUM7QUFFcEQ7OztHQUdHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDOzs7R0FHRztBQUNJLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQztBQUUxQzs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDO0FBRXBDOzs7Ozs7Ozs7OztHQVdHO0FBQ0ksTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDO0FBRXRDOzs7OztHQUtHO0FBQ0ksTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDO0FBRXZDOzs7OztHQUtHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxZQUFZLGVBQWUsWUFBWSxHQUFHLENBQUMsQ0FBQztBQUV6Rjs7Ozs7R0FLRztBQUNJLE1BQU0sY0FBYyxHQUFHO0lBQzVCLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyxjQUFjLEVBQUUsa0JBQWtCO0lBQ2xDLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxjQUFjLEVBQUUsa0JBQWtCO0lBQ2xDLGdCQUFnQixFQUFFLG9CQUFvQjtDQUM5QixDQUFDO0FBRVg7OztHQUdHO0FBQ0ksTUFBTSxpQkFBaUIsR0FBRztJQUMvQixpQkFBaUI7SUFDakIsVUFBVSxFQUFFLGVBQWU7SUFDM0Isa0JBQWtCO0lBQ2xCLFNBQVMsRUFBRSxjQUFjO0NBQ2pCLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91dGlscy9jb25zdGFudHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5qC45b+D5bi46YeP5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaWh+S7tumbhuS4reWumuS5ieS6huaVtOS4qiBFUkEg5qGG5p625omA5L2/55So55qE5YWz6ZSu5bi46YeP44CCXG4gKiDov5nkupvluLjph4/kuLvopoHnlKjkvZzlnKjphZLppoYgYGNoYXRgIOWPmOmHj+S4reWtmOWCqOWSjOajgOe0oiBFUkEg5qC45b+D5pWw5o2u55qE6Lev5b6E77yI6ZSu5ZCN77yJ44CCXG4gKlxuICogKirmoLjlv4PmlbDmja7nu5PmnoQqKjpcbiAqIEVSQSDnmoTmlbDmja7ooqvliIbkuLrkuKTpg6jliIbvvIzlrZjlgqjlnKggYGNoYXRgIOWPmOmHj+S4i++8mlxuICogMS4gKirlhYPmlbDmja4gKEVSQU1ldGFEYXRhKSoqOiDljIXlkKvmoYbmnrboh6rouqvov5DooYzmiYDpnIDnmoTmoLjlv4PmlbDmja7vvIzlpoIgYEVkaXRMb2dzYCDlkowgYFNlbGVjdGVkTWtzYOOAglxuICogMi4gKirnirbmgIHmlbDmja4gKHN0YXRfZGF0YSkqKjog5YyF5ZCr5omA5pyJ55Sx55So5oi35ZKMIEFJIOeuoeeQhueahOa4uOaIjy/mlYXkuovlj5jph4/vvIzlpoIgYHBsYXllcmDjgIFgd29ybGRfc3RhdGVgIOetieOAglxuICpcbiAqIOWFtue7k+aehOWkp+iHtOWmguS4i++8mlxuICogYGBganNvblxuICoge1xuICogICBcIkVSQU1ldGFEYXRhXCI6IHtcbiAqICAgICBcIkVkaXRMb2dzXCI6IHsgLi4uIH0sXG4gKiAgICAgXCJTZWxlY3RlZE1rc1wiOiBbIC4uLiBdXG4gKiAgIH0sXG4gKiAgIFwic3RhdF9kYXRhXCI6IHtcbiAqICAgICBcInBsYXllclwiOiB7IFwiaHBcIjogMTAwLCBcImdvbGRcIjogNTAgfSxcbiAqICAgICBcIndvcmxkX3N0YXRlXCI6IHsgLi4uIH1cbiAqICAgfVxuICogfVxuICogYGBgXG4gKiDlsIbov5nkupvot6/lvoTlrprkuYnkuLrluLjph4/vvIzmnInliqnkuo7vvJpcbiAqIDEuICoq6YG/5YWN56Gs57yW56CBKirvvJrlh4/lsJHlm6Dmi7zlhpnplJnor6/lr7zoh7TnmoQgYnVn44CCXG4gKiAyLiAqKuaPkOmrmOWPr+e7tOaKpOaApyoq77ya5aaC5p6c5pyq5p2l6ZyA6KaB6LCD5pW05pWw5o2u57uT5p6E77yM5Y+q6ZyA5L+u5pS55q2k5paH5Lu25Y2z5Y+v44CCXG4gKiAzLiAqKuWinuW8uuS7o+eggeWPr+ivu+aApyoq77ya5bi46YeP55qE5ZCN56ew5riF5pmw5Zyw6KGo6L6+5LqG5YW25omA5oyH5ZCR55qE5pWw5o2u55qE5ZCr5LmJ44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBDSEFUX1NDT1BFXG4gKiBAZGVzY3JpcHRpb25cbiAqIOeUqOS6jumFkummhuWKqeaJiyBgZ2V0VmFyaWFibGVzYCDlkowgYHJlcGxhY2VWYXJpYWJsZXNgIOezu+WIl+WHveaVsOeahCBgc2NvcGVgIOWPguaVsOOAglxuICog5a6D5oyH5a6a5LqG5pON5L2c55qE55uu5qCH5piv5b2T5YmNKirogYrlpKnvvIhDaGF077yJKirnuqfliKvnmoTlj5jph4/jgIJcbiAqIEVSQSDmoYbmnrbnmoTmiYDmnInmoLjlv4PmlbDmja7lkoznlKjmiLflj5jph4/pg73lrZjlgqjlnKjmraTkvZznlKjln5/kuIvjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IENIQVRfU0NPUEUgPSB7IHR5cGU6ICdjaGF0JyBhcyBjb25zdCB9O1xuXG4vKipcbiAqIEBjb25zdGFudCB7c3RyaW5nfSBNRVRBX0RBVEFfUEFUSFxuICogQGRlc2NyaXB0aW9uIOWcqCBgY2hhdGAg5Y+Y6YeP5Lit77yM5a2Y5YKoIEVSQSDmoYbmnrYqKuWFg+aVsOaNrioq55qE5qC55a+56LGh55qE6ZSu5ZCN44CCXG4gKi9cbmV4cG9ydCBjb25zdCBNRVRBX0RBVEFfUEFUSCA9ICdFUkFNZXRhRGF0YSc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IFNUQVRfREFUQV9QQVRIXG4gKiBAZGVzY3JpcHRpb24g5ZyoIGBjaGF0YCDlj5jph4/kuK3vvIzlrZjlgqjnlKjmiLcqKueKtuaAgeaVsOaNrioq55qE5qC55a+56LGh55qE6ZSu5ZCN44CCXG4gKi9cbmV4cG9ydCBjb25zdCBTVEFUX0RBVEFfUEFUSCA9ICdzdGF0X2RhdGEnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7c3RyaW5nfSBMT0dTX1BBVEhcbiAqIEBkZXNjcmlwdGlvblxuICog5ZyoIGBFUkFNZXRhRGF0YWAg5a+56LGh5Lit77yM5a2Y5YKoKirnvJbovpHml6Xlv5fvvIhFZGl0IExvZ3PvvIkqKueahOWvueixoeeahOmUruWQje+8jOWNsyBgXCJFZGl0TG9nc1wiYOOAglxuICogYEVkaXRMb2dzYCDmmK/kuIDkuKrku6UqKua2iOaBr+WvhumSpe+8iE1L77yJKirkuLrplK7vvIzku6Xor6Xmtojmga/lvJXlj5HnmoTlj5jph4/lj5jmm7TorrDlvZXmlbDnu4TkuLrlgLznmoTlr7nosaHjgIJcbiAqIOi/meaYr+WunueOsOKAnOmAhuW6j+Wbnua7muKAneWKn+iDveeahOWfuuehgOaVsOaNruOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBjaGF0LkVSQU1ldGFEYXRhLkVkaXRMb2dzIOeahOS4gOS4quadoeebrlxuICogXCJlcmFfbWtfMTc1OTI0Njk0MjIwOV9qaXBtcmpcIjogW1xuICogICB7IFwib3BcIjogXCJpbnNlcnRcIiwgXCJwYXRoXCI6IFwidGVzdERhdGEuaW52ZW50b3J5XCIsIFwidmFsdWVfbmV3XCI6IHsgXCJnb2xkXCI6IDEwMCwgXCJzbG90c1wiOiBbXCJzd29yZFwiLCBcInNoaWVsZFwiXSB9IH0sXG4gKiAgIHsgXCJvcFwiOiBcInVwZGF0ZVwiLCBcInBhdGhcIjogXCJwbGF5ZXIuaHBcIiwgXCJ2YWx1ZV9vbGRcIjogOTAsIFwidmFsdWVfbmV3XCI6IDEwMCB9XG4gKiBdXG4gKi9cbmV4cG9ydCBjb25zdCBMT0dTX1BBVEggPSAnRWRpdExvZ3MnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7c3RyaW5nfSBTRUxfUEFUSFxuICogQGRlc2NyaXB0aW9uXG4gKiDlnKggYEVSQU1ldGFEYXRhYCDlr7nosaHkuK3vvIzlrZjlgqgqKuW3sumAieaLqea2iOaBr+WvhumSpemTvu+8iFNlbGVjdGVkIE1lc3NhZ2UgS2V5c++8iSoq55qE5pWw57uE55qE6ZSu5ZCN77yM5Y2zIGBcIlNlbGVjdGVkTWtzXCJg44CCXG4gKiBgU2VsZWN0ZWRNa3NgIOaYr+S4gOS4queogOeWj+aVsOe7hO+8jOWFtioq57Si5byV57qm562J5LqO5raI5oGvIElEKirvvIzlgLzmmK/or6XmpbzlsYLmtojmga/nmoQgTUvjgIJcbiAqIOi/meS4quaVsOe7hOaYryBFUkEg5qGG5p6255qE4oCc6ISK5qKB4oCd77yM5piv6L+e5o6l5oq96LGh5Y+Y6YeP54q25oCB5LiO5YW35L2T6IGK5aSp5Y6G5Y+y55qE5qGl5qKB44CCXG4gKiDmoYbmnrbpgJrov4fmr5Tlr7kgYFNlbGVjdGVkTWtzYCDkuI7lrp7pmYXmtojmga/mtYHkuK3nmoQgTUvvvIzmnaXliKTmlq3mlbDmja7mmK/lkKbpnIDopoHlkIzmraXjgIJcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gY2hhdC5FUkFNZXRhRGF0YS5TZWxlY3RlZE1rc1xuICogWyAsIFwiZXJhX21rX2dyZWV0aW5nXCIsIFwiZXJhX21rX2FiYzEyM1wiLCAsIFwiZXJhX21rX3h5ejc4OVwiXVxuICovXG5leHBvcnQgY29uc3QgU0VMX1BBVEggPSAnU2VsZWN0ZWRNa3MnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7c3RyaW5nfSBFUkFfREFUQV9UQUdcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO5Zyo5raI5oGv5YaF5a655Lit5YyF6KO5IEVSQSDlhYPmlbDmja7vvIjlpoLmtojmga/lr4bpkqUgTUvvvInnmoQgWE1MIOmjjuagvOagh+etvuWQjeOAglxuICogZS5nLiwgYDxlcmFfZGF0YT57Li4ufTwvZXJhX2RhdGE+YFxuICovXG5leHBvcnQgY29uc3QgRVJBX0RBVEFfVEFHID0gJ2VyYV9kYXRhJztcblxuLyoqXG4gKiBAY29uc3RhbnQge1JlZ0V4cH0gRVJBX0RBVEFfUkVHRVhcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO5LuO5raI5oGv5YaF5a655a2X56ym5Liy5Lit5Yy56YWN5ZKM5o+Q5Y+WIGA8ZXJhX2RhdGE+YCDlnZfnmoTmraPliJnooajovr7lvI/jgIJcbiAqIOi/meS4quW4uOmHj+iiq+WumuS5ieWcqOi/memHjO+8jOS7pemBv+WFjSBgbWVzc2FnZV9rZXkudHNgIOWSjCBgbWVzc2FnZV91dGlscy50c2Ag5LmL6Ze055qE5b6q546v5L6d6LWW44CCXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfREFUQV9SRUdFWCA9IG5ldyBSZWdFeHAoYDwke0VSQV9EQVRBX1RBR30+KHsuKj99KTxcXFxcLyR7RVJBX0RBVEFfVEFHfT5gKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge29iamVjdH0gRVJBX0FQSV9FVkVOVFNcbiAqIEBkZXNjcmlwdGlvblxuICog5a6a5LmJ5LqG5omA5pyJ5L6b5aSW6YOo6ISa5pys6YCa6L+HIGBldmVudEVtaXRgIOiwg+eUqOeahOiHquWumuS5iSBBUEkg5LqL5Lu25ZCN56ew44CCXG4gKiDkvb/nlKjov5nkupvluLjph4/lj6/ku6Xpgb/lhY3lnKjku6PnoIHkuK3kvb/nlKjnoaznvJbnoIHnmoTlrZfnrKbkuLLjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEVSQV9BUElfRVZFTlRTID0ge1xuICBJTlNFUlRfQllfT0JKRUNUOiAnZXJhOmluc2VydEJ5T2JqZWN0JyxcbiAgVVBEQVRFX0JZX09CSkVDVDogJ2VyYTp1cGRhdGVCeU9iamVjdCcsXG4gIElOU0VSVF9CWV9QQVRIOiAnZXJhOmluc2VydEJ5UGF0aCcsXG4gIFVQREFURV9CWV9QQVRIOiAnZXJhOnVwZGF0ZUJ5UGF0aCcsXG4gIERFTEVURV9CWV9PQkpFQ1Q6ICdlcmE6ZGVsZXRlQnlPYmplY3QnLFxuICBERUxFVEVfQllfUEFUSDogJ2VyYTpkZWxldGVCeVBhdGgnLFxuICBHRVRfQ1VSUkVOVF9WQVJTOiAnZXJhOmdldEN1cnJlbnRWYXJzJyxcbn0gYXMgY29uc3Q7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IEVSQV9FVkVOVF9FTUlUVEVSXG4gKiBAZGVzY3JpcHRpb24g5a6a5LmJ5LqG5omA5pyJ55SxIEVSQSDmoYbmnrYqKuWQkeWkluWPkeWHuioq55qE5LqL5Lu244CCXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfRVZFTlRfRU1JVFRFUiA9IHtcbiAgLyoqIOW9k+WPmOmHj+WGmeWFpeWujOaIkOaXtuinpuWPkSAqL1xuICBXUklURV9ET05FOiAnZXJhOndyaXRlRG9uZScsXG4gIC8qKiDlvZNBUEnmiafooYzlhpnlhaXml7bop6blj5EgKi9cbiAgQVBJX1dSSVRFOiAnZXJhOmFwaVdyaXRlJyxcbn0gYXMgY29uc3Q7XG5cbi8qKlxuICogYGVyYTp3cml0ZURvbmVgIOS6i+S7tueahOi0n+i9veWvueixoee7k+aehOOAguWug+aPkOS+m+S6huWFs+S6juS4gOasoeaIkOWKn+WGmeWFpeaTjeS9nOeahOWujOaVtOS4iuS4i+aWh+OAglxuICovXG5leHBvcnQgaW50ZXJmYWNlIFdyaXRlRG9uZVBheWxvYWQge1xuICAvKipcbiAgICog5pys6L2u5LqL5Lu25aSE55CG5b6q546v5Lit77yM5pyA5ZCO5pON5L2c55qE5raI5oGv55qEKirmtojmga/lr4bpkqUgKE1lc3NhZ2UgS2V5KSoq44CCXG4gICAqIOmAmuW4uOeUsSBgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlYCDlnKjlvqrnjq/lvIDlp4vml7bnoa7lrprjgIJcbiAgICovXG4gIG1rOiBzdHJpbmc7XG4gIC8qKlxuICAgKiDmnKzova7kuovku7blpITnkIblvqrnjq/kuK3vvIzmnIDlkI7mk43kvZznmoTmtojmga/nmoQqKua2iOaBryBJRCoq44CCXG4gICAqL1xuICBtZXNzYWdlX2lkOiBudW1iZXI7XG4gIC8qKlxuICAgKiDmj4/ov7DlnKjmnKzova7kuovku7blpITnkIbkuK3vvIzmiafooYzkuoblk6rkupvmoLjlv4Pmk43kvZzjgIJcbiAgICog6L+Z5a+55LqO5aSW6YOo6ISa5pys55CG6Kej54q25oCB5Y+Y5pu055qE5Y6f5Zug6Iez5YWz6YeN6KaB44CCXG4gICAqL1xuICBhY3Rpb25zOiB7XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBgcm9sbGJhY2tCeU1rYCDmk43kvZwgKi9cbiAgICByb2xsYmFjazogYm9vbGVhbjtcbiAgICAvKiog5piv5ZCm5omn6KGM5LqGIGBBcHBseVZhckNoYW5nZWAg5pON5L2cICovXG4gICAgYXBwbHk6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOaTjeS9nCAqL1xuICAgIHJlc3luYzogYm9vbGVhbjtcbiAgICAvKiog5piv5ZCm5omn6KGM5LqGIEFQSSDosIPnlKggKi9cbiAgICBhcGk6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaYr+eUsUFQSeiwg+eUqOinpuWPkeeahOWQjue7remAu+i+kSAqL1xuICAgIGFwaVdyaXRlOiBib29sZWFuO1xuICB9O1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jOaVtOS4quiBiuWkqeS8muivneeahCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+IChTZWxlY3RlZCBNZXNzYWdlIEtleXMpKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meaYr+S4gOS4queogOeWj+aVsOe7hO+8jOWFtue0ouW8lee6puetieS6jua2iOaBryBJRO+8jOWAvOaYr+WvueW6lOalvOWxgua2iOaBr+eahCBNS+OAglxuICAgKiDlroPku6PooajkuoblvZPliY3ogYrlpKnorrDlvZXnmoTigJzkuLvlubLigJ3vvIzmmK8gRVJBIOWIpOaWreWQjOatpeeKtuaAgeeahOaguOW/g+aVsOaNrue7k+aehOOAglxuICAgKi9cbiAgc2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdO1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jGBjaGF0YCDlj5jph4/kuK3lrZjlgqjnmoQqKuWujOaVtOeahOe8lui+keaXpeW/l+WvueixoSAoRWRpdExvZ3MpKirjgIJcbiAgICog6L+Z5piv5LiA5Liq5LulIE1LIOS4uumUru+8jOS7peWPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICAgKi9cbiAgZWRpdExvZ3M6IHsgW2tleTogc3RyaW5nXTogYW55W10gfTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzmlbTkuKrogYrlpKnkvJror53nmoQqKueKtuaAgeaVsOaNriAoYHN0YXRfZGF0YWApKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meS4queJiOacrCoq5YyF5ZCrKirmiYDmnInlhoXpg6jkvb/nlKjnmoQgYCRtZXRhYCDlrZfmrrXjgIJcbiAgICovXG4gIHN0YXQ6IGFueTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzkuIDkuKoqKuS4jeWMheWQqyoq5Lu75L2VIGAkbWV0YWAg5a2X5q6155qEIGBzdGF0X2RhdGFgIOeahOa3seaLt+i0neeJiOacrOOAglxuICAgKiDpgILnlKjkuo7pnIDopoHnuq/lh4DmlbDmja7ov5vooYzlsZXnpLrmiJbov5vkuIDmraXlpITnkIbnmoTlnLrmma/jgIJcbiAgICovXG4gIHN0YXRXaXRob3V0TWV0YTogYW55O1xuICAvKipcbiAgICog6KGo56S66L+Z5piv5a+55b2T5YmNIGBta2Ag55qE56ys5Yeg5qyh6L+e57ut5aSE55CG44CCXG4gICAqIOWmguaenOS4gOS4quaWsOeahCBgbWtgIOiiq+WkhOeQhu+8jOi/meS4quiuoeaVsOS8mumHjee9ruS4uiAx44CCXG4gICAqIOi/meWvueS6jumcgOimgeaEn+efpeeKtuaAgeaYr+WQpuWcqOWQjOS4gOa2iOaBr+S4iui/nue7reabtOaWsOeahOWklumDqOiEmuacrOW+iOacieeUqOOAglxuICAgKi9cbiAgY29uc2VjdXRpdmVQcm9jZXNzaW5nQ291bnQ6IG51bWJlcjtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/constants.ts\n\n}');
  },
  "./src/ERA变量框架/utils/data.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/data.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   J: () => (/* binding */ J),\n/* harmony export */   escapeEraData: () => (/* binding */ escapeEraData),\n/* harmony export */   isPO: () => (/* binding */ isPO),\n/* harmony export */   mergeReplaceArray: () => (/* binding */ mergeReplaceArray),\n/* harmony export */   parseEditLog: () => (/* binding */ parseEditLog),\n/* harmony export */   parseJsonl: () => (/* binding */ parseJsonl),\n/* harmony export */   sanitizeArrays: () => (/* binding */ sanitizeArrays),\n/* harmony export */   unescapeEraData: () => (/* binding */ unescapeEraData)\n/* harmony export */ });\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 通用数据处理模块\n */\n\n\nconst logger = new _log__WEBPACK_IMPORTED_MODULE_0__.Logger();\nconst ESCAPE_MAP = {\n    '.': '__DOT__',\n    '\"': '__DQUOTE__',\n    \"'\": '__SQUOTE__',\n};\nconst UNESCAPE_MAP = _.invert(ESCAPE_MAP);\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map(_.escapeRegExp).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map(_.escapeRegExp).join('|'), 'g');\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nfunction escapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => escapeEraData(item));\n    }\n    if (_.isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n                newObj[escapedKey] = escapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(escapeRegex, match => ESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nfunction unescapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => unescapeEraData(item));\n    }\n    if (_.isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n                newObj[unescapedKey] = unescapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nconst isPO = (v) => _.isPlainObject(v);\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nfunction sanitizeArrays(v) {\n    if (Array.isArray(v)) {\n        // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n        return v.map(e => (Array.isArray(e) || _.isPlainObject(e) ? JSON.stringify(e) : e));\n    }\n    else if (_.isPlainObject(v)) {\n        // 如果是对象，则递归地对其每个属性值进行净化。\n        const o = {};\n        for (const k in v)\n            o[k] = sanitizeArrays(v[k]);\n        return o;\n    }\n    else {\n        // 其他类型的值直接返回。\n        return v;\n    }\n}\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nconst J = (o) => {\n    try {\n        return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n    }\n    catch (e) {\n        return `<<stringify失败: ${e?.message || e}>>`;\n    }\n};\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nfunction mergeReplaceArray(base, patch) {\n    // 使用 _.cloneDeep 确保不修改原始对象。\n    return _.mergeWith(_.cloneDeep(base), _.cloneDeep(patch), (a, b) => {\n        // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n        if (Array.isArray(a) || Array.isArray(b))\n            return b;\n        // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n        return undefined;\n    });\n}\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nfunction parseEditLog(raw) {\n    if (Array.isArray(raw))\n        return raw;\n    if (raw && typeof raw === 'object')\n        return [raw]; // 单个对象也视为有效日志\n    if (typeof raw === 'string') {\n        const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n        try {\n            const arr = JSON.parse(s);\n            return Array.isArray(arr) ? arr : [];\n        }\n        catch {\n            return [];\n        }\n    }\n    return [];\n}\n/**\n * 智能地从字符串中移除各种风格的注释，同时保留字符串字面量中的内容。\n *\n * **工作原理**:\n * 该函数通过一个小型状态机来逐字解析输入字符串。它维护一个 `inString` 状态，\n * 用于判断当前字符是否位于一个双引号包裹的字符串内部。\n *\n * 1. 当检测到进入或退出一个字符串时（通过非转义的双引号 `\"`），`inString` 状态会翻转。\n * 2. 如果 `inString` 为 `true`，则所有字符都会被无条件地保留。这确保了字符串值（如 URL）中的 `//` 或 `/*` 不会被当作注释处理。\n * 3. 如果 `inString` 为 `false`，函数会检查是否存在注释标记（`//`, `/*`, `\x3c!--`）。\n * 4. 如果找到注释标记，函数会向前扫描直到注释结束，并跳过这部分内容。\n * 5. 如果没有找到注释，则将当前字符追加到结果中。\n *\n * @param str - 待处理的字符串。\n * @returns 移除了注释的字符串。\n */\nfunction stripComments(str) {\n    if (!str)\n        return '';\n    let result = '';\n    let inString = false; // 状态：是否在字符串内部\n    for (let i = 0; i < str.length; i++) {\n        const char = str[i];\n        // 检查是否进入或退出字符串。忽略转义的双引号 `\\\"`。\n        if (char === '\"' && (i === 0 || str[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，直接追加字符，不进行任何注释检查。\n        if (inString) {\n            result += char;\n            continue;\n        }\n        // --- 只有在字符串外部时，才进行注释检查 ---\n        const nextChar = str[i + 1];\n        // 检查行注释 `//`\n        if (char === '/' && nextChar === '/') {\n            const endOfLine = str.indexOf('\\n', i + 2);\n            if (endOfLine === -1) {\n                // 如果没有换行符，说明注释直到字符串末尾，直接结束循环。\n                break;\n            }\n            // 保留换行符，并将索引 `i` 快进到行尾。\n            result += '\\n';\n            i = endOfLine;\n            continue;\n        }\n        // 检查块注释 `/* ... */`\n        if (char === '/' && nextChar === '*') {\n            const endOfComment = str.indexOf('*/', i + 2);\n            if (endOfComment === -1) {\n                // 未闭合的注释，忽略剩余所有内容。\n                break;\n            }\n            // 将索引 `i` 快进到注释结尾。\n            i = endOfComment + 1;\n            continue;\n        }\n        // 检查 HTML 注释 `\x3c!-- ... --\x3e`\n        if (char === '<' && str.substring(i, i + 4) === '\x3c!--') {\n            const endOfComment = str.indexOf('--\x3e', i + 4);\n            if (endOfComment === -1) {\n                // 未闭合的注释。\n                break;\n            }\n            i = endOfComment + 2;\n            continue;\n        }\n        // 如果不是注释，则保留该字符。\n        result += char;\n    }\n    return result;\n}\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @returns {any[]} 解析出的对象数组。\n */\nfunction parseJsonl(str) {\n    const objects = [];\n    if (!str || typeof str !== 'string') {\n        return objects;\n    }\n    // 在解析 JSON 之前，必须先安全地移除所有注释。\n    // 不能使用简单的正则表达式（如 `/\\/\\/.*/g`），因为它无法区分代码中的注释和字符串值（如 URL \"https://...\"）中的 `//`，\n    // 会错误地破坏 JSON 字符串的结构。`stripComments` 函数通过状态管理解决了这个问题。\n    const strWithoutComments = stripComments(str);\n    const trimmedStr = strWithoutComments.trim();\n    let braceCount = 0; // 花括号平衡计数器\n    let startIndex = -1; // 当前 JSON 对象的起始索引\n    let inString = false; // 标记是否处于双引号字符串内部\n    for (let i = 0; i < trimmedStr.length; i++) {\n        const char = trimmedStr[i];\n        // 切换 inString 状态，忽略转义的双引号\n        if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，则跳过所有花括号的逻辑判断\n        if (inString)\n            continue;\n        if (char === '{') {\n            if (braceCount === 0) {\n                // 发现一个新 JSON 对象的开始\n                startIndex = i;\n            }\n            braceCount++;\n        }\n        else if (char === '}') {\n            if (braceCount > 0) {\n                braceCount--;\n                if (braceCount === 0 && startIndex !== -1) {\n                    // 花括号平衡，一个完整的 JSON 对象被找到\n                    const jsonString = trimmedStr.substring(startIndex, i + 1);\n                    try {\n                        const obj = JSON.parse(jsonString);\n                        objects.push(obj);\n                    }\n                    catch (e) {\n                        // 如果解析失败，记录错误并继续，不中断整个过程\n                        logger.error(`JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n                    }\n                    // 重置状态，准备寻找下一个对象\n                    startIndex = -1;\n                }\n            }\n        }\n    }\n    return objects;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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IjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91dGlscy9kYXRhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOmAmueUqOaVsOaNruWkhOeQhuaooeWdl1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5cbmNvbnN0IEVTQ0FQRV9NQVA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICcuJzogJ19fRE9UX18nLFxuICAnXCInOiAnX19EUVVPVEVfXycsXG4gIFwiJ1wiOiAnX19TUVVPVEVfXycsXG59O1xuXG5jb25zdCBVTkVTQ0FQRV9NQVA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSBfLmludmVydChFU0NBUEVfTUFQKTtcblxuY29uc3QgZXNjYXBlUmVnZXggPSBuZXcgUmVnRXhwKE9iamVjdC5rZXlzKEVTQ0FQRV9NQVApLm1hcChfLmVzY2FwZVJlZ0V4cCkuam9pbignfCcpLCAnZycpO1xuY29uc3QgdW5lc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoT2JqZWN0LnZhbHVlcyhFU0NBUEVfTUFQKS5tYXAoXy5lc2NhcGVSZWdFeHApLmpvaW4oJ3wnKSwgJ2cnKTtcblxuLyoqXG4gKiDpgJLlvZLlnLDovazkuYnlr7nosaHmiJbmlbDnu4TkuK3miYDmnInlrZfnrKbkuLLlgLzlkozplK7nmoTnibnmrorlrZfnrKbjgIJcbiAqIEBwYXJhbSBkYXRhIC0g6KaB5aSE55CG55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyAtIOi9rOS5ieWQjueahOaVsOaNruOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlRXJhRGF0YTxUPihkYXRhOiBUKTogVCB7XG4gIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gZXNjYXBlRXJhRGF0YShpdGVtKSkgYXMgYW55O1xuICB9XG4gIGlmIChfLmlzUGxhaW5PYmplY3QoZGF0YSkpIHtcbiAgICBjb25zdCBuZXdPYmo6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcbiAgICAgICAgY29uc3QgZXNjYXBlZEtleSA9IGtleS5yZXBsYWNlKGVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBFU0NBUEVfTUFQW21hdGNoXSk7XG4gICAgICAgIG5ld09ialtlc2NhcGVkS2V5XSA9IGVzY2FwZUVyYURhdGEoKGRhdGEgYXMgYW55KVtrZXldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ld09iaiBhcyBhbnk7XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBkYXRhLnJlcGxhY2UoZXNjYXBlUmVnZXgsIG1hdGNoID0+IEVTQ0FQRV9NQVBbbWF0Y2hdKSBhcyBhbnk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICog6YCS5b2S5Zyw5Y+N6L2s5LmJ5a+56LGh5oiW5pWw57uE5Lit5omA5pyJ5a2X56ym5Liy5YC85ZKM6ZSu55qE54m55q6K5a2X56ym44CCXG4gKiBAcGFyYW0gZGF0YSAtIOimgeWkhOeQhueahOaVsOaNruOAglxuICogQHJldHVybnMgLSDlj43ovazkuYnlkI7nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuZXNjYXBlRXJhRGF0YTxUPihkYXRhOiBUKTogVCB7XG4gIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gdW5lc2NhcGVFcmFEYXRhKGl0ZW0pKSBhcyBhbnk7XG4gIH1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChkYXRhKSkge1xuICAgIGNvbnN0IG5ld09iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSkge1xuICAgICAgICBjb25zdCB1bmVzY2FwZWRLZXkgPSBrZXkucmVwbGFjZSh1bmVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBVTkVTQ0FQRV9NQVBbbWF0Y2hdKTtcbiAgICAgICAgbmV3T2JqW3VuZXNjYXBlZEtleV0gPSB1bmVzY2FwZUVyYURhdGEoKGRhdGEgYXMgYW55KVtrZXldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ld09iaiBhcyBhbnk7XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBkYXRhLnJlcGxhY2UodW5lc2NhcGVSZWdleCwgbWF0Y2ggPT4gVU5FU0NBUEVfTUFQW21hdGNoXSkgYXMgYW55O1xuICB9XG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIOWIpOaWreS4gOS4quWAvOaYr+WQpuS4uuKAnOe6r+eyueeahOWvueixoeKAne+8iFBsYWluIE9iamVjdO+8ieOAglxuICog5pWw57uE44CBbnVsbOOAgeWHveaVsOOAgURhdGUg5a+56LGh562J6YO95Lya6L+U5ZueIGZhbHNl44CCXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXmo4Dmn6XnmoTlgLzjgIJcbiAqIEByZXR1cm5zIHtib29sZWFufSDlpoLmnpzmmK/nuq/nsrnnmoTlr7nosaHliJnov5Tlm54gdHJ1Ze+8jOWQpuWImei/lOWbniBmYWxzZeOAglxuICovXG5leHBvcnQgY29uc3QgaXNQTyA9ICh2OiBhbnkpOiB2IGlzIFJlY29yZDxzdHJpbmcsIGFueT4gPT4gXy5pc1BsYWluT2JqZWN0KHYpO1xuXG4vKipcbiAqIOmAkuW9kuWcsOKAnOWHgOWMluKAneS4gOS4quWvueixoe+8jOWwhuWFtuS4reeahOaVsOe7hOaIluWvueixoeWAvOi9rOaNouS4uuWtl+espuS4suOAglxuICog5Li76KaB55So5LqO5YeG5aSH5pWw5o2u5Lul5L6/5Zyo5p+Q5Lqb54m55a6a5Zy65pmv5LiL5bGV56S65oiW5a2Y5YKo44CCXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXlh4DljJbnmoTlgLzjgIJcbiAqIEByZXR1cm5zIHsqfSDlh4DljJblkI7nmoTlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplQXJyYXlzKHY6IGFueSk6IGFueSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YGN5Y6G5YW25YWD57Sg44CC5aaC5p6c5YWD57Sg5piv5pWw57uE5oiW5a+56LGh77yM5YiZ5a2X56ym5Liy5YyW5a6D44CCXG4gICAgcmV0dXJuIHYubWFwKGUgPT4gKEFycmF5LmlzQXJyYXkoZSkgfHwgXy5pc1BsYWluT2JqZWN0KGUpID8gSlNPTi5zdHJpbmdpZnkoZSkgOiBlKSk7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5a+56LGh77yM5YiZ6YCS5b2S5Zyw5a+55YW25q+P5Liq5bGe5oCn5YC86L+b6KGM5YeA5YyW44CCXG4gICAgY29uc3QgbzogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3QgayBpbiB2KSBvW2tdID0gc2FuaXRpemVBcnJheXModltrXSk7XG4gICAgcmV0dXJuIG87XG4gIH0gZWxzZSB7XG4gICAgLy8g5YW25LuW57G75Z6L55qE5YC855u05o6l6L+U5Zue44CCXG4gICAgcmV0dXJuIHY7XG4gIH1cbn1cblxuLyoqXG4gKiDlronlhajlnLDlsIbkuIDkuKrlr7nosaHluo/liJfljJbkuLrmoLzlvI/ljJbnmoQgSlNPTiDlrZfnrKbkuLLjgIJcbiAqIOWmguaenOW6j+WIl+WMluWksei0pe+8jOS4jeS8muaKm+WHuuW8guW4uO+8jOiAjOaYr+i/lOWbnuS4gOS4quWMheWQq+mUmeivr+S/oeaBr+eahOWtl+espuS4suOAglxuICogQHBhcmFtIHsqfSBvIC0g5b6F5bqP5YiX5YyW55qE5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDmiJDlip/liJnov5Tlm54gSlNPTiDlrZfnrKbkuLLvvIzlpLHotKXliJnov5Tlm57plJnor6/mj5DnpLrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEogPSAobzogYW55KTogc3RyaW5nID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobywgbnVsbCwgMik7IC8vIOS9v+eUqCAyIOS4quepuuagvOi/m+ihjOe8qei/m++8jOaPkOmrmOWPr+ivu+aAp+OAglxuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICByZXR1cm4gYDw8c3RyaW5naWZ55aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0+PmA7XG4gIH1cbn07XG5cbi8qKlxuICog5L2/55So4oCc5paw5pWw57uE6KaG55uW5pen5pWw57uE4oCd55qE562W55Wl5p2l5rex5bqm5ZCI5bm25Lik5Liq5a+56LGh44CCXG4gKiDov5nmmK8gYF8ubWVyZ2VgIOeahOS4gOS4quWPmOS9k++8jOS4k+mXqOeUqOS6juWkhOeQhuaooeadv+WQiOW5tuetieWcuuaZr++8jFxuICog5Zyo6L+Z5Lqb5Zy65pmv5Lit77yM5oiR5Lus5biM5pyb6KGl5LiB5a+56LGh5Lit55qE5pWw57uE6IO95aSf5a6M5YWo5pu/5o2i5Z+656GA5a+56LGh5Lit55qE5pWw57uE77yM6ICM5LiN5piv5ZCI5bm25a6D5Lus44CCXG4gKiBAcGFyYW0geyp9IGJhc2UgLSDln7rnoYDlr7nosaHjgIJcbiAqIEBwYXJhbSB7Kn0gcGF0Y2ggLSDooaXkuIHlr7nosaHjgIJcbiAqIEByZXR1cm5zIHsqfSDlkIjlubblkI7nmoTmlrDlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlUmVwbGFjZUFycmF5KGJhc2U6IGFueSwgcGF0Y2g6IGFueSk6IGFueSB7XG4gIC8vIOS9v+eUqCBfLmNsb25lRGVlcCDnoa7kv53kuI3kv67mlLnljp/lp4vlr7nosaHjgIJcbiAgcmV0dXJuIF8ubWVyZ2VXaXRoKF8uY2xvbmVEZWVwKGJhc2UpLCBfLmNsb25lRGVlcChwYXRjaCksIChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgIC8vIOiHquWumuS5ieWQiOW5tumAu+i+ke+8muWmguaenOS7u+S4gOWAvOS4uuaVsOe7hO+8jOWImeebtOaOpei/lOWbnuihpeS4geWAvO+8iGLvvInvvIzku47ogIzlrp7njrDopobnm5bjgIJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhKSB8fCBBcnJheS5pc0FycmF5KGIpKSByZXR1cm4gYjtcbiAgICAvLyDlr7nkuo7pnZ7mlbDnu4TnsbvlnovvvIzov5Tlm54gdW5kZWZpbmVkIOS7peS9v+eUqCBfLm1lcmdlIOeahOm7mOiupOWQiOW5tuihjOS4uuOAglxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0pO1xufVxuXG4vKipcbiAqIOWBpeWjruWcsOino+aekCBgRWRpdExvZ2Ag55qE5Y6f5aeL5pWw5o2u44CCXG4gKiBgRWRpdExvZ2Ag5Y+v6IO95Lul5aSa56eN5qC85byP5a2Y5Zyo77yI5a+56LGh44CB5pWw57uE44CBSlNPTuWtl+espuS4su+8ie+8jOatpOWHveaVsOaXqOWcqOe7n+S4gOWkhOeQhuWug+S7rOOAglxuICogQHBhcmFtIHsqfSByYXcgLSDku47lj5jph4/kuK3or7vlj5bnmoTljp/lp4sgYEVkaXRMb2dgIOaVsOaNruOAglxuICogQHJldHVybnMge2FueVtdfSDop6PmnpDlkI7nmoQgYEVkaXRMb2dgIOaVsOe7hOOAguWmguaenOino+aekOWksei0peaIlui+k+WFpeaXoOaViO+8jOWImei/lOWbnuS4gOS4quepuuaVsOe7hOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFZGl0TG9nKHJhdzogYW55KTogYW55W10ge1xuICBpZiAoQXJyYXkuaXNBcnJheShyYXcpKSByZXR1cm4gcmF3O1xuICBpZiAocmF3ICYmIHR5cGVvZiByYXcgPT09ICdvYmplY3QnKSByZXR1cm4gW3Jhd107IC8vIOWNleS4quWvueixoeS5n+inhuS4uuacieaViOaXpeW/l1xuICBpZiAodHlwZW9mIHJhdyA9PT0gJ3N0cmluZycpIHtcbiAgICBjb25zdCBzID0gcmF3LnJlcGxhY2UoL15cXHMqYGBgKD86anNvbik/XFxzKnxcXHMqYGBgXFxzKiQvZywgJycpOyAvLyDnp7vpmaTku6PnoIHlm7TmoI9cbiAgICB0cnkge1xuICAgICAgY29uc3QgYXJyID0gSlNPTi5wYXJzZShzKTtcbiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGFycikgPyBhcnIgOiBbXTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuXG4vKipcbiAqIOaZuuiDveWcsOS7juWtl+espuS4suS4reenu+mZpOWQhOenjemjjuagvOeahOazqOmHiu+8jOWQjOaXtuS/neeVmeWtl+espuS4suWtl+mdoumHj+S4reeahOWGheWuueOAglxuICpcbiAqICoq5bel5L2c5Y6f55CGKio6XG4gKiDor6Xlh73mlbDpgJrov4fkuIDkuKrlsI/lnovnirbmgIHmnLrmnaXpgJDlrZfop6PmnpDovpPlhaXlrZfnrKbkuLLjgILlroPnu7TmiqTkuIDkuKogYGluU3RyaW5nYCDnirbmgIHvvIxcbiAqIOeUqOS6juWIpOaWreW9k+WJjeWtl+espuaYr+WQpuS9jeS6juS4gOS4quWPjOW8leWPt+WMheijueeahOWtl+espuS4suWGhemDqOOAglxuICpcbiAqIDEuIOW9k+ajgOa1i+WIsOi/m+WFpeaIlumAgOWHuuS4gOS4quWtl+espuS4suaXtu+8iOmAmui/h+mdnui9rOS5ieeahOWPjOW8leWPtyBgXCJg77yJ77yMYGluU3RyaW5nYCDnirbmgIHkvJrnv7vovazjgIJcbiAqIDIuIOWmguaenCBgaW5TdHJpbmdgIOS4uiBgdHJ1ZWDvvIzliJnmiYDmnInlrZfnrKbpg73kvJrooqvml6DmnaHku7blnLDkv53nlZnjgILov5nnoa7kv53kuoblrZfnrKbkuLLlgLzvvIjlpoIgVVJM77yJ5Lit55qEIGAvL2Ag5oiWIGAvKmAg5LiN5Lya6KKr5b2T5L2c5rOo6YeK5aSE55CG44CCXG4gKiAzLiDlpoLmnpwgYGluU3RyaW5nYCDkuLogYGZhbHNlYO+8jOWHveaVsOS8muajgOafpeaYr+WQpuWtmOWcqOazqOmHiuagh+iusO+8iGAvL2AsIGAvKmAsIGA8IS0tYO+8ieOAglxuICogNC4g5aaC5p6c5om+5Yiw5rOo6YeK5qCH6K6w77yM5Ye95pWw5Lya5ZCR5YmN5omr5o+P55u05Yiw5rOo6YeK57uT5p2f77yM5bm26Lez6L+H6L+Z6YOo5YiG5YaF5a6544CCXG4gKiA1LiDlpoLmnpzmsqHmnInmib7liLDms6jph4rvvIzliJnlsIblvZPliY3lrZfnrKbov73liqDliLDnu5PmnpzkuK3jgIJcbiAqXG4gKiBAcGFyYW0gc3RyIC0g5b6F5aSE55CG55qE5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyDnp7vpmaTkuobms6jph4rnmoTlrZfnrKbkuLLjgIJcbiAqL1xuZnVuY3Rpb24gc3RyaXBDb21tZW50cyhzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghc3RyKSByZXR1cm4gJyc7XG5cbiAgbGV0IHJlc3VsdCA9ICcnO1xuICBsZXQgaW5TdHJpbmcgPSBmYWxzZTsgLy8g54q25oCB77ya5piv5ZCm5Zyo5a2X56ym5Liy5YaF6YOoXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaGFyID0gc3RyW2ldO1xuXG4gICAgLy8g5qOA5p+l5piv5ZCm6L+b5YWl5oiW6YCA5Ye65a2X56ym5Liy44CC5b+955Wl6L2s5LmJ55qE5Y+M5byV5Y+3IGBcXFwiYOOAglxuICAgIGlmIChjaGFyID09PSAnXCInICYmIChpID09PSAwIHx8IHN0cltpIC0gMV0gIT09ICdcXFxcJykpIHtcbiAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nO1xuICAgIH1cblxuICAgIC8vIOWmguaenOWcqOWtl+espuS4suWGhemDqO+8jOebtOaOpei/veWKoOWtl+espu+8jOS4jei/m+ihjOS7u+S9leazqOmHiuajgOafpeOAglxuICAgIGlmIChpblN0cmluZykge1xuICAgICAgcmVzdWx0ICs9IGNoYXI7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyAtLS0g5Y+q5pyJ5Zyo5a2X56ym5Liy5aSW6YOo5pe277yM5omN6L+b6KGM5rOo6YeK5qOA5p+lIC0tLVxuICAgIGNvbnN0IG5leHRDaGFyID0gc3RyW2kgKyAxXTtcblxuICAgIC8vIOajgOafpeihjOazqOmHiiBgLy9gXG4gICAgaWYgKGNoYXIgPT09ICcvJyAmJiBuZXh0Q2hhciA9PT0gJy8nKSB7XG4gICAgICBjb25zdCBlbmRPZkxpbmUgPSBzdHIuaW5kZXhPZignXFxuJywgaSArIDIpO1xuICAgICAgaWYgKGVuZE9mTGluZSA9PT0gLTEpIHtcbiAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5o2i6KGM56ym77yM6K+05piO5rOo6YeK55u05Yiw5a2X56ym5Liy5pyr5bC+77yM55u05o6l57uT5p2f5b6q546v44CCXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8g5L+d55WZ5o2i6KGM56ym77yM5bm25bCG57Si5byVIGBpYCDlv6vov5vliLDooYzlsL7jgIJcbiAgICAgIHJlc3VsdCArPSAnXFxuJztcbiAgICAgIGkgPSBlbmRPZkxpbmU7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyDmo4Dmn6XlnZfms6jph4ogYC8qIC4uLiAqL2BcbiAgICBpZiAoY2hhciA9PT0gJy8nICYmIG5leHRDaGFyID09PSAnKicpIHtcbiAgICAgIGNvbnN0IGVuZE9mQ29tbWVudCA9IHN0ci5pbmRleE9mKCcqLycsIGkgKyAyKTtcbiAgICAgIGlmIChlbmRPZkNvbW1lbnQgPT09IC0xKSB7XG4gICAgICAgIC8vIOacqumXreWQiOeahOazqOmHiu+8jOW/veeVpeWJqeS9meaJgOacieWGheWuueOAglxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIOWwhue0ouW8lSBgaWAg5b+r6L+b5Yiw5rOo6YeK57uT5bC+44CCXG4gICAgICBpID0gZW5kT2ZDb21tZW50ICsgMTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIOajgOafpSBIVE1MIOazqOmHiiBgPCEtLSAuLi4gLS0+YFxuICAgIGlmIChjaGFyID09PSAnPCcgJiYgc3RyLnN1YnN0cmluZyhpLCBpICsgNCkgPT09ICc8IS0tJykge1xuICAgICAgY29uc3QgZW5kT2ZDb21tZW50ID0gc3RyLmluZGV4T2YoJy0tPicsIGkgKyA0KTtcbiAgICAgIGlmIChlbmRPZkNvbW1lbnQgPT09IC0xKSB7XG4gICAgICAgIC8vIOacqumXreWQiOeahOazqOmHiuOAglxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGkgPSBlbmRPZkNvbW1lbnQgKyAyO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5LiN5piv5rOo6YeK77yM5YiZ5L+d55WZ6K+l5a2X56ym44CCXG4gICAgcmVzdWx0ICs9IGNoYXI7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiDop6PmnpDkuIDkuKrljIXlkKvlpJrkuKrkuLLogZQgSlNPTiDlr7nosaHnmoTlrZfnrKbkuLLvvIjnsbvkvLzkuo4gSlNPTkwg5qC85byP77yJ44CCXG4gKiDov5nnp43moLzlvI/mnInml7bkvJrnlLEgQUkg55Sf5oiQ44CC5q2k5Ye95pWw6IO95aSf6YCQ5Liq5o+Q5Y+W5bm26Kej5p6Q5a6D5Lus44CCXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciAtIOW+heino+aekOeahOWtl+espuS4suOAglxuICogQHJldHVybnMge2FueVtdfSDop6PmnpDlh7rnmoTlr7nosaHmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlSnNvbmwoc3RyOiBzdHJpbmcpOiBhbnlbXSB7XG4gIGNvbnN0IG9iamVjdHM6IGFueVtdID0gW107XG4gIGlmICghc3RyIHx8IHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG9iamVjdHM7XG4gIH1cblxuICAvLyDlnKjop6PmnpAgSlNPTiDkuYvliY3vvIzlv4XpobvlhYjlronlhajlnLDnp7vpmaTmiYDmnInms6jph4rjgIJcbiAgLy8g5LiN6IO95L2/55So566A5Y2V55qE5q2j5YiZ6KGo6L6+5byP77yI5aaCIGAvXFwvXFwvLiovZ2DvvInvvIzlm6DkuLrlroPml6Dms5XljLrliIbku6PnoIHkuK3nmoTms6jph4rlkozlrZfnrKbkuLLlgLzvvIjlpoIgVVJMIFwiaHR0cHM6Ly8uLi5cIu+8ieS4reeahCBgLy9g77yMXG4gIC8vIOS8mumUmeivr+WcsOegtOWdjyBKU09OIOWtl+espuS4sueahOe7k+aehOOAgmBzdHJpcENvbW1lbnRzYCDlh73mlbDpgJrov4fnirbmgIHnrqHnkIbop6PlhrPkuobov5nkuKrpl67popjjgIJcbiAgY29uc3Qgc3RyV2l0aG91dENvbW1lbnRzID0gc3RyaXBDb21tZW50cyhzdHIpO1xuICBjb25zdCB0cmltbWVkU3RyID0gc3RyV2l0aG91dENvbW1lbnRzLnRyaW0oKTtcblxuICBsZXQgYnJhY2VDb3VudCA9IDA7IC8vIOiKseaLrOWPt+W5s+ihoeiuoeaVsOWZqFxuICBsZXQgc3RhcnRJbmRleCA9IC0xOyAvLyDlvZPliY0gSlNPTiDlr7nosaHnmoTotbflp4vntKLlvJVcbiAgbGV0IGluU3RyaW5nID0gZmFsc2U7IC8vIOagh+iusOaYr+WQpuWkhOS6juWPjOW8leWPt+Wtl+espuS4suWGhemDqFxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpbW1lZFN0ci5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNoYXIgPSB0cmltbWVkU3RyW2ldO1xuXG4gICAgLy8g5YiH5o2iIGluU3RyaW5nIOeKtuaAge+8jOW/veeVpei9rOS5ieeahOWPjOW8leWPt1xuICAgIGlmIChjaGFyID09PSAnXCInICYmIChpID09PSAwIHx8IHRyaW1tZWRTdHJbaSAtIDFdICE9PSAnXFxcXCcpKSB7XG4gICAgICBpblN0cmluZyA9ICFpblN0cmluZztcbiAgICB9XG5cbiAgICAvLyDlpoLmnpzlnKjlrZfnrKbkuLLlhoXpg6jvvIzliJnot7Pov4fmiYDmnInoirHmi6zlj7fnmoTpgLvovpHliKTmlq1cbiAgICBpZiAoaW5TdHJpbmcpIGNvbnRpbnVlO1xuXG4gICAgaWYgKGNoYXIgPT09ICd7Jykge1xuICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDApIHtcbiAgICAgICAgLy8g5Y+R546w5LiA5Liq5pawIEpTT04g5a+56LGh55qE5byA5aeLXG4gICAgICAgIHN0YXJ0SW5kZXggPSBpO1xuICAgICAgfVxuICAgICAgYnJhY2VDb3VudCsrO1xuICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJ30nKSB7XG4gICAgICBpZiAoYnJhY2VDb3VudCA+IDApIHtcbiAgICAgICAgYnJhY2VDb3VudC0tO1xuICAgICAgICBpZiAoYnJhY2VDb3VudCA9PT0gMCAmJiBzdGFydEluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIC8vIOiKseaLrOWPt+W5s+ihoe+8jOS4gOS4quWujOaVtOeahCBKU09OIOWvueixoeiiq+aJvuWIsFxuICAgICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSB0cmltbWVkU3RyLnN1YnN0cmluZyhzdGFydEluZGV4LCBpICsgMSk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7XG4gICAgICAgICAgICBvYmplY3RzLnB1c2gob2JqKTtcbiAgICAgICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgICAgIC8vIOWmguaenOino+aekOWksei0pe+8jOiusOW9lemUmeivr+W5tue7p+e7re+8jOS4jeS4reaWreaVtOS4qui/h+eoi1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBKU09OTCDop6PmnpDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfS4g5aSx6LSl55qE54mH5q61OiAke2pzb25TdHJpbmd9YCwgZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIOmHjee9rueKtuaAge+8jOWHhuWkh+Wvu+aJvuS4i+S4gOS4quWvueixoVxuICAgICAgICAgIHN0YXJ0SW5kZXggPSAtMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gb2JqZWN0cztcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/era_data.ts": 
  /*!***************************************!*\
  !*** ./src/ERA变量框架/utils/era_data.ts ***!
  \***************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getEraData: () => (/* binding */ getEraData),\n/* harmony export */   removeMetaFields: () => (/* binding */ removeMetaFields),\n/* harmony export */   updateEraMetaData: () => (/* binding */ updateEraMetaData),\n/* harmony export */   updateEraStatData: () => (/* binding */ updateEraStatData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/**\n * @file ERA 变量框架 - ERA 核心变量读写模块\n */\n\n\n\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nfunction removeMetaFields(obj) {\n    // 对于非对象类型，直接返回原始值\n    if (!lodash__WEBPACK_IMPORTED_MODULE_0___default().isObject(obj)) {\n        return obj;\n    }\n    // 创建深拷贝以避免修改原始对象\n    const newObj = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(obj);\n    function recurse(current) {\n        if (Array.isArray(current)) {\n            // 如果是数组，则递归处理数组中的每个元素\n            current.forEach(item => recurse(item));\n        }\n        else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(current)) {\n            // 如果是纯粹的对象，遍历其所有键\n            for (const key in current) {\n                // 如果键以 '$' 开头，则删除该属性\n                if (key.startsWith('$')) {\n                    delete current[key];\n                }\n                else {\n                    // 否则，递归处理该属性的值\n                    recurse(current[key]);\n                }\n            }\n        }\n    }\n    recurse(newObj);\n    return newObj;\n}\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nfunction getEraData() {\n    const chatVars = getVariables(_constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE) || {};\n    const meta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n    const stat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n    return { meta, stat };\n}\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nasync function updateEraStatData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentStat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n        const newStat = await updater(currentStat);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, newStat);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nasync function updateEraMetaData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentMeta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n        const newMeta = await updater(currentMeta);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, newMeta);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Olsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2VyYV9kYXRhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIEVSQSDmoLjlv4Plj5jph4/or7vlhpnmqKHlnZdcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBDSEFUX1NDT1BFLCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbi8qKlxuICog6YCS5b2S5Zyw5LuO5a+56LGh5Lit56e76Zmk5omA5pyJ5LulIGAkYCDlvIDlpLTnmoTlrZfmrrXvvIjlpoIgYCRtZXRhYCwgYCR0ZW1wbGF0ZWDvvInjgIJcbiAqIOatpOWHveaVsOS8muWIm+W7uuS4gOS4quWvueixoeeahOa3seaLt+i0ne+8jOWboOatpOS4jeS8muS/ruaUueWOn+Wni+WvueixoeOAglxuICogQHBhcmFtIHthbnl9IG9iaiAtIOW+heWkhOeQhueahOWvueixoeaIluWAvOOAglxuICogQHJldHVybnMge2FueX0g5LiA5Liq5LiN5YyF5ZCrIGAkYCDliY3nvIDlrZfmrrXnmoTmlrDlr7nosaHmiJbljp/lp4vlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU1ldGFGaWVsZHMob2JqOiBhbnkpOiBhbnkge1xuICAvLyDlr7nkuo7pnZ7lr7nosaHnsbvlnovvvIznm7TmjqXov5Tlm57ljp/lp4vlgLxcbiAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgLy8g5Yib5bu65rex5ou36LSd5Lul6YG/5YWN5L+u5pS55Y6f5aeL5a+56LGhXG4gIGNvbnN0IG5ld09iaiA9IF8uY2xvbmVEZWVwKG9iaik7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50OiBhbnkpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YCS5b2S5aSE55CG5pWw57uE5Lit55qE5q+P5Liq5YWD57SgXG4gICAgICBjdXJyZW50LmZvckVhY2goaXRlbSA9PiByZWN1cnNlKGl0ZW0pKTtcbiAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv57qv57K555qE5a+56LGh77yM6YGN5Y6G5YW25omA5pyJ6ZSuXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBjdXJyZW50KSB7XG4gICAgICAgIC8vIOWmguaenOmUruS7pSAnJCcg5byA5aS077yM5YiZ5Yig6Zmk6K+l5bGe5oCnXG4gICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnJCcpKSB7XG4gICAgICAgICAgZGVsZXRlIGN1cnJlbnRba2V5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDlkKbliJnvvIzpgJLlvZLlpITnkIbor6XlsZ7mgKfnmoTlgLxcbiAgICAgICAgICByZWN1cnNlKGN1cnJlbnRba2V5XSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZWN1cnNlKG5ld09iaik7XG4gIHJldHVybiBuZXdPYmo7XG59XG5cbi8qKlxuICog6I635Y+W5bm256Gu5L+dIEVSQSDnmoTlhYPmlbDmja7lkoznirbmgIHmlbDmja7lr7nosaHnmoTlrZjlnKjjgIJcbiAqIEByZXR1cm5zIHt7bWV0YTogb2JqZWN0LCBzdGF0OiBvYmplY3R9fSDljIXlkKvlhYPmlbDmja7lkoznirbmgIHmlbDmja7nmoTlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVyYURhdGEoKTogeyBtZXRhOiBhbnk7IHN0YXQ6IGFueSB9IHtcbiAgY29uc3QgY2hhdFZhcnMgPSBnZXRWYXJpYWJsZXMoQ0hBVF9TQ09QRSkgfHwge307XG4gIGNvbnN0IG1ldGEgPSBfLmdldChjaGF0VmFycywgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgY29uc3Qgc3RhdCA9IF8uZ2V0KGNoYXRWYXJzLCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICByZXR1cm4geyBtZXRhLCBzdGF0IH07XG59XG5cbi8qKlxuICog5Y6f5a2Q5oCn5Zyw5pu05pawIEVSQSDnmoTnirbmgIHmlbDmja4gKHN0YXRfZGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRTdGF0RGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBzdGF0X2RhdGEg5bm26L+U5Zue5L+u5pS55ZCOIHN0YXRfZGF0YSDnmoTlh73mlbAgKOWPr+S7peaYryBhc3luYynjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUVyYVN0YXREYXRhKHVwZGF0ZXI6IChjdXJyZW50U3RhdERhdGE6IGFueSkgPT4gYW55IHwgUHJvbWlzZTxhbnk+KSB7XG4gIGF3YWl0IHVwZGF0ZVZhcmlhYmxlc1dpdGgoYXN5bmMgdiA9PiB7XG4gICAgY29uc3QgY3VycmVudFN0YXQgPSBfLmdldCh2LCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICAgIGNvbnN0IG5ld1N0YXQgPSBhd2FpdCB1cGRhdGVyKGN1cnJlbnRTdGF0KTtcbiAgICBfLnNldCh2LCBTVEFUX0RBVEFfUEFUSCwgbmV3U3RhdCk7XG4gICAgcmV0dXJuIHY7XG4gIH0sIENIQVRfU0NPUEUpO1xufVxuXG4vKipcbiAqIOWOn+WtkOaAp+WcsOabtOaWsCBFUkEg55qE5YWD5pWw5o2uIChFUkFNZXRhRGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBFUkFNZXRhRGF0YSDlubbov5Tlm57kv67mlLnlkI4gRVJBTWV0YURhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVFcmFNZXRhRGF0YSh1cGRhdGVyOiAoY3VycmVudE1ldGFEYXRhOiBhbnkpID0+IGFueSB8IFByb21pc2U8YW55Pikge1xuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZXRhID0gXy5nZXQodiwgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgICBjb25zdCBuZXdNZXRhID0gYXdhaXQgdXBkYXRlcihjdXJyZW50TWV0YSk7XG4gICAgXy5zZXQodiwgTUVUQV9EQVRBX1BBVEgsIG5ld01ldGEpO1xuICAgIHJldHVybiB2O1xuICB9LCBDSEFUX1NDT1BFKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/era_data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/log.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/utils/log.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Logger: () => (/* binding */ Logger),\n/* harmony export */   logContext: () => (/* binding */ logContext)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 日志记录模块 (V2 - 动态配置版)\n */\n\n// --- 新的运行时调试配置系统 ---\n/**\n * @constant {string} DEBUG_LS_KEY\n * @description 用于在 localStorage 中存储调试模式的键名。\n */\nconst DEBUG_LS_KEY = 'era_debug';\nlet activeNamespaces;\nlet skippedNamespaces;\n/**\n * 将用户输入的调试模式字符串（支持通配符 *）转换为正则表达式数组。\n * @param {string} pattern - 例如 'core-*,events-*,-core-key'\n */\nfunction parseDebugPattern(pattern) {\n    const patterns = pattern.split(/[\\s,]+/);\n    activeNamespaces = [];\n    skippedNamespaces = [];\n    for (const p of patterns) {\n        if (!p)\n            continue;\n        // 将通配符 * 转换为正则表达式的 .*?\n        const regexPattern = p.replace(/\\*/g, '.*?');\n        if (regexPattern.startsWith('-')) {\n            // 如果以 - 开头，表示排除该模式\n            skippedNamespaces.push(new RegExp(`^${regexPattern.slice(1)}$`));\n        }\n        else {\n            // 否则，为激活模式\n            activeNamespaces.push(new RegExp(`^${regexPattern}$`));\n        }\n    }\n}\n/**\n * 检查给定的模块名是否应该输出 debug 日志。\n * @param {string} moduleName - 要检查的模块名。\n * @returns {boolean} - 如果允许输出则返回 true。\n */\nfunction isDebugEnabled(moduleName) {\n    if (!moduleName)\n        return false;\n    // 如果模块名匹配任何一个“排除”模式，则禁用\n    if (skippedNamespaces.some(re => re.test(moduleName))) {\n        return false;\n    }\n    // 如果“激活”模式列表为空（即没有设置任何模式），则全部禁用\n    if (activeNamespaces.length === 0) {\n        return false;\n    }\n    // 如果模块名匹配任何一个“激活”模式，则启用\n    // 如果设置了 'all' 或 '*'，则全部启用\n    if (activeNamespaces.some(re => re.test('all') || re.test(moduleName))) {\n        return true;\n    }\n    return false;\n}\n/**\n * 从 localStorage 加载并解析调试模式。\n */\nfunction loadDebugConfig() {\n    const pattern = globalThis.localStorage?.getItem(DEBUG_LS_KEY) || '';\n    parseDebugPattern(pattern);\n}\n/**\n * 设置新的调试模式，并将其保存到 localStorage。\n * @param {string} pattern - 新的调试模式字符串。\n * @example\n * // 开启所有 core 和 ui 开头的模块\n * eraDebug('core-*,ui-*')\n * // 开启所有模块，但排除 core-key\n * eraDebug('*,-core-key')\n * // 关闭所有调试日志\n * eraDebug('')\n */\nfunction setDebug(pattern) {\n    globalThis.localStorage?.setItem(DEBUG_LS_KEY, pattern);\n    loadDebugConfig();\n    console.log(`%c《ERA-Log》调试模式已更新: %c${pattern || '(已禁用)'}%c。部分模块可能需刷新页面生效。`, 'color: #3498db; font-weight: bold;', 'color: #f39c12; font-style: italic;', 'color: #3498db; font-weight: bold;');\n}\n// 初始化配置\nloadDebugConfig();\n// 将设置函数暴露到全局，方便在浏览器控制台调用\nif (typeof globalThis !== 'undefined') {\n    globalThis.eraDebug = setDebug;\n}\n// --- Logger 类 ---\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持动态配置的日志记录器。\n *\n * **核心功能**:\n * 1. **动态调试**: 可通过浏览器控制台 `eraDebug('...')` 命令在运行时开启/关闭指定模块的 `debug` 日志。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式。\n * 3. **自动模块名**: 自动从调用栈解析模块名，推荐在每个文件中创建独立的 logger 实例以保证准确性。\n *    例如: `const logger = new Logger();`\n */\nconst logContext = {\n    mk: '',\n};\nclass Logger {\n    moduleName;\n    constructor(moduleName) {\n        if (moduleName) {\n            this.moduleName = moduleName;\n        }\n        else {\n            // 自动从调用栈获取模块名，能有效避免因实例共享导致的模块名不准问题\n            this.moduleName = this._getModuleNameFromStack() || 'unknown';\n        }\n    }\n    _getModuleNameFromStack() {\n        try {\n            const stack = new Error().stack || '';\n            const callerLine = stack.split('\\n')[3]; // 调整栈深度以获取实例化 Logger 的位置\n            if (!callerLine)\n                return null;\n            const match = callerLine.match(/\\((?:webpack-internal:\\/\\/\\/)?\\.\\/(.*)\\)/);\n            if (!match || !match[1])\n                return null;\n            let path = match[1];\n            path = path.split('?')[0];\n            path = path.replace(/\\.(vue|ts|js)$/, '');\n            // 将 'src/ERA变量框架/' 替换为空，并用 '-' 替换 '/'\n            return path\n                .replace(/^src\\/ERA变量框架\\//, '')\n                .replace(/\\/index$/, '')\n                .replace(/\\//g, '-');\n        }\n        catch (e) {\n            return null;\n        }\n    }\n    formatMessage(funcName, message) {\n        const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n        return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n    }\n    debug(funcName, message, obj) {\n        if (!isDebugEnabled(this.moduleName)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj !== undefined) {\n            console.debug(formattedMessage, obj);\n        }\n        else {\n            console.debug(formattedMessage);\n        }\n    }\n    log(funcName, message, obj) {\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj !== undefined) {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n        }\n        else {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;');\n        }\n    }\n    warn(funcName, message, obj) {\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj !== undefined) {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n        }\n        else {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n        }\n    }\n    error(funcName, message, errorObj) {\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (errorObj !== undefined) {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n        }\n        else {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c3JjL0VSQeWPmOmHj+ahhuaeti91dGlscy9sb2cudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5pel5b+X6K6w5b2V5qih5Z2XIChWMiAtIOWKqOaAgemFjee9rueJiClcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8vIC0tLSDmlrDnmoTov5DooYzml7bosIPor5XphY3nva7ns7vnu58gLS0tXG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IERFQlVHX0xTX0tFWVxuICogQGRlc2NyaXB0aW9uIOeUqOS6juWcqCBsb2NhbFN0b3JhZ2Ug5Lit5a2Y5YKo6LCD6K+V5qih5byP55qE6ZSu5ZCN44CCXG4gKi9cbmNvbnN0IERFQlVHX0xTX0tFWSA9ICdlcmFfZGVidWcnO1xuXG5sZXQgYWN0aXZlTmFtZXNwYWNlczogUmVnRXhwW107XG5sZXQgc2tpcHBlZE5hbWVzcGFjZXM6IFJlZ0V4cFtdO1xuXG4vKipcbiAqIOWwhueUqOaIt+i+k+WFpeeahOiwg+ivleaooeW8j+Wtl+espuS4su+8iOaUr+aMgemAmumFjeespiAq77yJ6L2s5o2i5Li65q2j5YiZ6KGo6L6+5byP5pWw57uE44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVybiAtIOS+i+WmgiAnY29yZS0qLGV2ZW50cy0qLC1jb3JlLWtleSdcbiAqL1xuZnVuY3Rpb24gcGFyc2VEZWJ1Z1BhdHRlcm4ocGF0dGVybjogc3RyaW5nKSB7XG4gIGNvbnN0IHBhdHRlcm5zID0gcGF0dGVybi5zcGxpdCgvW1xccyxdKy8pO1xuICBhY3RpdmVOYW1lc3BhY2VzID0gW107XG4gIHNraXBwZWROYW1lc3BhY2VzID0gW107XG5cbiAgZm9yIChjb25zdCBwIG9mIHBhdHRlcm5zKSB7XG4gICAgaWYgKCFwKSBjb250aW51ZTtcblxuICAgIC8vIOWwhumAmumFjeespiAqIOi9rOaNouS4uuato+WImeihqOi+vuW8j+eahCAuKj9cbiAgICBjb25zdCByZWdleFBhdHRlcm4gPSBwLnJlcGxhY2UoL1xcKi9nLCAnLio/Jyk7XG5cbiAgICBpZiAocmVnZXhQYXR0ZXJuLnN0YXJ0c1dpdGgoJy0nKSkge1xuICAgICAgLy8g5aaC5p6c5LulIC0g5byA5aS077yM6KGo56S65o6S6Zmk6K+l5qih5byPXG4gICAgICBza2lwcGVkTmFtZXNwYWNlcy5wdXNoKG5ldyBSZWdFeHAoYF4ke3JlZ2V4UGF0dGVybi5zbGljZSgxKX0kYCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDlkKbliJnvvIzkuLrmv4DmtLvmqKHlvI9cbiAgICAgIGFjdGl2ZU5hbWVzcGFjZXMucHVzaChuZXcgUmVnRXhwKGBeJHtyZWdleFBhdHRlcm59JGApKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiDmo4Dmn6Xnu5nlrprnmoTmqKHlnZflkI3mmK/lkKblupTor6XovpPlh7ogZGVidWcg5pel5b+X44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gbW9kdWxlTmFtZSAtIOimgeajgOafpeeahOaooeWdl+WQjeOAglxuICogQHJldHVybnMge2Jvb2xlYW59IC0g5aaC5p6c5YWB6K646L6T5Ye65YiZ6L+U5ZueIHRydWXjgIJcbiAqL1xuZnVuY3Rpb24gaXNEZWJ1Z0VuYWJsZWQobW9kdWxlTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGlmICghbW9kdWxlTmFtZSkgcmV0dXJuIGZhbHNlO1xuICAvLyDlpoLmnpzmqKHlnZflkI3ljLnphY3ku7vkvZXkuIDkuKrigJzmjpLpmaTigJ3mqKHlvI/vvIzliJnnpoHnlKhcbiAgaWYgKHNraXBwZWROYW1lc3BhY2VzLnNvbWUocmUgPT4gcmUudGVzdChtb2R1bGVOYW1lKSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8g5aaC5p6c4oCc5r+A5rS74oCd5qih5byP5YiX6KGo5Li656m677yI5Y2z5rKh5pyJ6K6+572u5Lu75L2V5qih5byP77yJ77yM5YiZ5YWo6YOo56aB55SoXG4gIGlmIChhY3RpdmVOYW1lc3BhY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvLyDlpoLmnpzmqKHlnZflkI3ljLnphY3ku7vkvZXkuIDkuKrigJzmv4DmtLvigJ3mqKHlvI/vvIzliJnlkK/nlKhcbiAgLy8g5aaC5p6c6K6+572u5LqGICdhbGwnIOaIliAnKifvvIzliJnlhajpg6jlkK/nlKhcbiAgaWYgKGFjdGl2ZU5hbWVzcGFjZXMuc29tZShyZSA9PiByZS50ZXN0KCdhbGwnKSB8fCByZS50ZXN0KG1vZHVsZU5hbWUpKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiDku44gbG9jYWxTdG9yYWdlIOWKoOi9veW5tuino+aekOiwg+ivleaooeW8j+OAglxuICovXG5mdW5jdGlvbiBsb2FkRGVidWdDb25maWcoKSB7XG4gIGNvbnN0IHBhdHRlcm4gPSBnbG9iYWxUaGlzLmxvY2FsU3RvcmFnZT8uZ2V0SXRlbShERUJVR19MU19LRVkpIHx8ICcnO1xuICBwYXJzZURlYnVnUGF0dGVybihwYXR0ZXJuKTtcbn1cblxuLyoqXG4gKiDorr7nva7mlrDnmoTosIPor5XmqKHlvI/vvIzlubblsIblhbbkv53lrZjliLAgbG9jYWxTdG9yYWdl44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVybiAtIOaWsOeahOiwg+ivleaooeW8j+Wtl+espuS4suOAglxuICogQGV4YW1wbGVcbiAqIC8vIOW8gOWQr+aJgOaciSBjb3JlIOWSjCB1aSDlvIDlpLTnmoTmqKHlnZdcbiAqIGVyYURlYnVnKCdjb3JlLSosdWktKicpXG4gKiAvLyDlvIDlkK/miYDmnInmqKHlnZfvvIzkvYbmjpLpmaQgY29yZS1rZXlcbiAqIGVyYURlYnVnKCcqLC1jb3JlLWtleScpXG4gKiAvLyDlhbPpl63miYDmnInosIPor5Xml6Xlv5dcbiAqIGVyYURlYnVnKCcnKVxuICovXG5mdW5jdGlvbiBzZXREZWJ1ZyhwYXR0ZXJuOiBzdHJpbmcpIHtcbiAgZ2xvYmFsVGhpcy5sb2NhbFN0b3JhZ2U/LnNldEl0ZW0oREVCVUdfTFNfS0VZLCBwYXR0ZXJuKTtcbiAgbG9hZERlYnVnQ29uZmlnKCk7XG4gIGNvbnNvbGUubG9nKFxuICAgIGAlY+OAikVSQS1Mb2fjgIvosIPor5XmqKHlvI/lt7Lmm7TmlrA6ICVjJHtwYXR0ZXJuIHx8ICco5bey56aB55SoKSd9JWPjgILpg6jliIbmqKHlnZflj6/og73pnIDliLfmlrDpobXpnaLnlJ/mlYjjgIJgLFxuICAgICdjb2xvcjogIzM0OThkYjsgZm9udC13ZWlnaHQ6IGJvbGQ7JyxcbiAgICAnY29sb3I6ICNmMzljMTI7IGZvbnQtc3R5bGU6IGl0YWxpYzsnLFxuICAgICdjb2xvcjogIzM0OThkYjsgZm9udC13ZWlnaHQ6IGJvbGQ7JyxcbiAgKTtcbn1cblxuLy8g5Yid5aeL5YyW6YWN572uXG5sb2FkRGVidWdDb25maWcoKTtcblxuLy8g5bCG6K6+572u5Ye95pWw5pq06Zyy5Yiw5YWo5bGA77yM5pa55L6/5Zyo5rWP6KeI5Zmo5o6n5Yi25Y+w6LCD55SoXG5pZiAodHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnKSB7XG4gIChnbG9iYWxUaGlzIGFzIGFueSkuZXJhRGVidWcgPSBzZXREZWJ1Zztcbn1cblxuLy8gLS0tIExvZ2dlciDnsbsgLS0tXG5cbi8qKlxuICogQGNsYXNzIExvZ2dlclxuICogQGRlc2NyaXB0aW9uIOS4gOS4quS4uiBFUkEg5qGG5p626K6+6K6h55qE44CB5pSv5oyB5Yqo5oCB6YWN572u55qE5pel5b+X6K6w5b2V5Zmo44CCXG4gKlxuICogKirmoLjlv4Plip/og70qKjpcbiAqIDEuICoq5Yqo5oCB6LCD6K+VKio6IOWPr+mAmui/h+a1j+iniOWZqOaOp+WItuWPsCBgZXJhRGVidWcoJy4uLicpYCDlkb3ku6TlnKjov5DooYzml7blvIDlkK8v5YWz6Zet5oyH5a6a5qih5Z2X55qEIGBkZWJ1Z2Ag5pel5b+X44CCXG4gKiAyLiAqKue7n+S4gOagvOW8jyoqOiDmiYDmnInml6Xlv5fpg73pgbXlvqogYOOAikVSQeOAi+OAjOaooeWdl+WQjeOAjeOAkOWHveaVsOWQjeOAkeaXpeW/l+WGheWuuWAg55qE5qC85byP44CCXG4gKiAzLiAqKuiHquWKqOaooeWdl+WQjSoqOiDoh6rliqjku47osIPnlKjmoIjop6PmnpDmqKHlnZflkI3vvIzmjqjojZDlnKjmr4/kuKrmlofku7bkuK3liJvlu7rni6znq4vnmoQgbG9nZ2VyIOWunuS+i+S7peS/neivgeWHhuehruaAp+OAglxuICogICAg5L6L5aaCOiBgY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigpO2BcbiAqL1xuZXhwb3J0IGNvbnN0IGxvZ0NvbnRleHQgPSB7XG4gIG1rOiAnJyxcbn07XG5cbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xuICBwcml2YXRlIG1vZHVsZU5hbWU6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihtb2R1bGVOYW1lPzogc3RyaW5nKSB7XG4gICAgaWYgKG1vZHVsZU5hbWUpIHtcbiAgICAgIHRoaXMubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOiHquWKqOS7juiwg+eUqOagiOiOt+WPluaooeWdl+WQje+8jOiDveacieaViOmBv+WFjeWboOWunuS+i+WFseS6q+WvvOiHtOeahOaooeWdl+WQjeS4jeWHhumXrumimFxuICAgICAgdGhpcy5tb2R1bGVOYW1lID0gdGhpcy5fZ2V0TW9kdWxlTmFtZUZyb21TdGFjaygpIHx8ICd1bmtub3duJztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9nZXRNb2R1bGVOYW1lRnJvbVN0YWNrKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrIHx8ICcnO1xuICAgICAgY29uc3QgY2FsbGVyTGluZSA9IHN0YWNrLnNwbGl0KCdcXG4nKVszXTsgLy8g6LCD5pW05qCI5rex5bqm5Lul6I635Y+W5a6e5L6L5YyWIExvZ2dlciDnmoTkvY3nva5cbiAgICAgIGlmICghY2FsbGVyTGluZSkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IG1hdGNoID0gY2FsbGVyTGluZS5tYXRjaCgvXFwoKD86d2VicGFjay1pbnRlcm5hbDpcXC9cXC9cXC8pP1xcLlxcLyguKilcXCkvKTtcbiAgICAgIGlmICghbWF0Y2ggfHwgIW1hdGNoWzFdKSByZXR1cm4gbnVsbDtcblxuICAgICAgbGV0IHBhdGggPSBtYXRjaFsxXTtcbiAgICAgIHBhdGggPSBwYXRoLnNwbGl0KCc/JylbMF07XG4gICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cXC4odnVlfHRzfGpzKSQvLCAnJyk7XG4gICAgICAvLyDlsIYgJ3NyYy9FUkHlj5jph4/moYbmnrYvJyDmm7/mjaLkuLrnqbrvvIzlubbnlKggJy0nIOabv+aNoiAnLydcbiAgICAgIHJldHVybiBwYXRoXG4gICAgICAgIC5yZXBsYWNlKC9ec3JjXFwvRVJB5Y+Y6YeP5qGG5p62XFwvLywgJycpXG4gICAgICAgIC5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJylcbiAgICAgICAgLnJlcGxhY2UoL1xcLy9nLCAnLScpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0TWVzc2FnZShmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IG1rU3RyaW5nID0gbG9nQ29udGV4dC5tayA/IGDvvIgke2xvZ0NvbnRleHQubWt977yJYCA6ICcnO1xuICAgIHJldHVybiBg44CKRVJB44CLJHtta1N0cmluZ33jgIwke3RoaXMubW9kdWxlTmFtZX3jgI3jgJAke2Z1bmNOYW1lfeOAkSR7U3RyaW5nKG1lc3NhZ2UpfWA7XG4gIH1cblxuICBkZWJ1ZyhmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xuICAgIGlmICghaXNEZWJ1Z0VuYWJsZWQodGhpcy5tb2R1bGVOYW1lKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChvYmogIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5kZWJ1Zyhmb3JtYXR0ZWRNZXNzYWdlLCBvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGZvcm1hdHRlZE1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGxvZyhmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChvYmogIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5sb2coYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogIzM0OThkYjsnLCBvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjMzQ5OGRiOycpO1xuICAgIH1cbiAgfVxuXG4gIHdhcm4oZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBvYmo/OiBhbnkpIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAob2JqICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnNvbGUud2FybihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZjM5YzEyOycsIG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZjM5YzEyOycpO1xuICAgIH1cbiAgfVxuXG4gIGVycm9yKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgZXJyb3JPYmo/OiBhbnkpIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAoZXJyb3JPYmogIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5lcnJvcihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZTc0YzNjOyBmb250LXdlaWdodDogYm9sZDsnLCBlcnJvck9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2U3NGMzYzsgZm9udC13ZWlnaHQ6IGJvbGQ7Jyk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/log.ts\n\n}");
  },
  "./src/ERA变量框架/utils/message.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/utils/message.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastAiMessage: () => (/* binding */ findLastAiMessage),\n/* harmony export */   getMessageContent: () => (/* binding */ getMessageContent),\n/* harmony export */   isUserMessage: () => (/* binding */ isUserMessage),\n/* harmony export */   updateMessageContent: () => (/* binding */ updateMessageContent)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _text__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./text */ \"./src/ERA变量框架/utils/text.ts\");\n/**\n * @file ERA 变量框架 - 消息处理模块\n * @description\n * 该文件提供了一系列用于处理、查询和更新酒馆消息对象的通用辅助函数。\n */\n\n\n\n\nconst log = new _log__WEBPACK_IMPORTED_MODULE_1__.Logger();\n// ==================================================================\n// 消息读取与解析\n// ==================================================================\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nfunction getMessageContent(msg) {\n    if (!msg)\n        return null;\n    let content = null;\n    // 优先检查 .mes 属性，这是新版酒馆的规范\n    if (typeof msg.mes === 'string') {\n        content = msg.mes;\n    }\n    // 如果没有 .mes，则处理 swipes\n    else if (Array.isArray(msg.swipes)) {\n        const sid = Number(msg.swipe_id ?? 0);\n        content = msg.swipes[sid] || null;\n    }\n    // 最后，作为兼容，检查旧版的 .message 属性\n    else if (typeof msg.message === 'string') {\n        content = msg.message;\n    }\n    if (content === null) {\n        return null;\n    }\n    // 在返回内容前进行宏替换。\n    // 这样做是因为酒馆自身的宏替换行为不一致：有时（如消息流式生成后）会替换，\n    // 但有时（如聊天记录刚加载时）则不会，这会导致读取到的内容状态混乱。\n    // 因此，我们统一在获取消息时手动执行一次宏替换，以确保数据的一致性。\n    return (0,_text__WEBPACK_IMPORTED_MODULE_2__.parseCharacterMacros)(content);\n}\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            const eraData = {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n            log.debug('parseEraData', '成功解析 EraData', eraData);\n            return eraData;\n        }\n        log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n        return null;\n    }\n    catch (e) {\n        log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n        return null;\n    }\n}\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nfunction isUserMessage(msg) {\n    const content = getMessageContent(msg);\n    const data = parseEraData(content);\n    if (data) {\n        return data['era-message-type'] === 'user';\n    }\n    // 回退到检查 role 属性\n    return msg?.role === 'user';\n}\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nfunction findLastAiMessage() {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    if (!messages || messages.length === 0) {\n        log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n        return null;\n    }\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const msg = messages[i];\n        if (!isUserMessage(msg)) {\n            log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n            return msg;\n        }\n    }\n    log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n    return null;\n}\n// ==================================================================\n// 消息写入\n// ==================================================================\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n */\nasync function updateMessageContent(message, newContent) {\n    const oldContent = getMessageContent(message);\n    log.debug('updateMessageContent', '更新前的消息内容:', oldContent);\n    log.debug('updateMessageContent', '更新后的消息内容:', newContent);\n    const updatePayload = {\n        message_id: message.message_id,\n    };\n    if (Array.isArray(message.swipes)) {\n        const sid = Number(message.swipe_id ?? 0);\n        const newSwipes = [...message.swipes];\n        newSwipes[sid] = newContent;\n        updatePayload.swipes = newSwipes;\n    }\n    else {\n        updatePayload.message = newContent;\n    }\n    await setChatMessages([updatePayload], { refresh: 'none' });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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mOmHj+ahhuaeti91dGlscy9tZXNzYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOa2iOaBr+WkhOeQhuaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6Xmlofku7bmj5DkvpvkuobkuIDns7vliJfnlKjkuo7lpITnkIbjgIHmn6Xor6Llkozmm7TmlrDphZLppobmtojmga/lr7nosaHnmoTpgJrnlKjovoXliqnlh73mlbDjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IEVSQV9EQVRBX1JFR0VYIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi9sb2cnO1xuaW1wb3J0IHsgcGFyc2VDaGFyYWN0ZXJNYWNyb3MgfSBmcm9tICcuL3RleHQnO1xuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCk7XG5cbi8qKlxuICogQHR5cGUge0VyYURhdGF9IC0g5a6a5LmJ5LqG5a2Y5YKo5ZyoIGA8ZXJhX2RhdGE+YCDlnZfkuK3nmoTlhYPmlbDmja7nu5PmnoTjgIJcbiAqL1xudHlwZSBFcmFEYXRhID0ge1xuICAnZXJhLW1lc3NhZ2Uta2V5Jzogc3RyaW5nO1xuICAnZXJhLW1lc3NhZ2UtdHlwZSc6ICd1c2VyJyB8ICdhc3Npc3RhbnQnO1xufTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDmtojmga/or7vlj5bkuI7op6PmnpBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqICoq44CQ6I635Y+W5raI5oGv5YaF5a6544CRKiog5LuO6YWS6aaG55qE5raI5oGv5a+56LGh5Lit5a6J5YWo5Zyw5o+Q5Y+W5b2T5YmN5r+A5rS777yI6KKr6YCJ5Lit77yJ55qE5raI5oGv5YaF5a655a2X56ym5Liy44CCXG4gKiDov5nkuKrlh73mlbDmmK8gRVJBIOS4reaJgOaciea2iOaBr+WGheWuueivu+WPlueahOWUr+S4gOWFpeWPo++8jOS7peehruS/nemAu+i+kee7n+S4gOWSjOWBpeWjruaAp+OAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmcgfCBudWxsfSDlvZPliY3mv4DmtLvnmoTmtojmga/lhoXlrrnvvJvlpoLmnpzml6Dms5Xojrflj5bvvIzliJnov5Tlm54gbnVsbOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWVzc2FnZUNvbnRlbnQobXNnOiBhbnkpOiBzdHJpbmcgfCBudWxsIHtcbiAgaWYgKCFtc2cpIHJldHVybiBudWxsO1xuXG4gIGxldCBjb250ZW50OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICAvLyDkvJjlhYjmo4Dmn6UgLm1lcyDlsZ7mgKfvvIzov5nmmK/mlrDniYjphZLppobnmoTop4TojINcbiAgaWYgKHR5cGVvZiBtc2cubWVzID09PSAnc3RyaW5nJykge1xuICAgIGNvbnRlbnQgPSBtc2cubWVzO1xuICB9XG4gIC8vIOWmguaenOayoeaciSAubWVz77yM5YiZ5aSE55CGIHN3aXBlc1xuICBlbHNlIGlmIChBcnJheS5pc0FycmF5KG1zZy5zd2lwZXMpKSB7XG4gICAgY29uc3Qgc2lkID0gTnVtYmVyKG1zZy5zd2lwZV9pZCA/PyAwKTtcbiAgICBjb250ZW50ID0gbXNnLnN3aXBlc1tzaWRdIHx8IG51bGw7XG4gIH1cbiAgLy8g5pyA5ZCO77yM5L2c5Li65YW85a6577yM5qOA5p+l5pen54mI55qEIC5tZXNzYWdlIOWxnuaAp1xuICBlbHNlIGlmICh0eXBlb2YgbXNnLm1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgY29udGVudCA9IG1zZy5tZXNzYWdlO1xuICB9XG5cbiAgaWYgKGNvbnRlbnQgPT09IG51bGwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIOWcqOi/lOWbnuWGheWuueWJjei/m+ihjOWuj+abv+aNouOAglxuICAvLyDov5nmoLflgZrmmK/lm6DkuLrphZLppoboh6rouqvnmoTlro/mm7/mjaLooYzkuLrkuI3kuIDoh7TvvJrmnInml7bvvIjlpoLmtojmga/mtYHlvI/nlJ/miJDlkI7vvInkvJrmm7/mjaLvvIxcbiAgLy8g5L2G5pyJ5pe277yI5aaC6IGK5aSp6K6w5b2V5Yia5Yqg6L295pe277yJ5YiZ5LiN5Lya77yM6L+Z5Lya5a+86Ie06K+75Y+W5Yiw55qE5YaF5a6554q25oCB5re35Lmx44CCXG4gIC8vIOWboOatpO+8jOaIkeS7rOe7n+S4gOWcqOiOt+WPlua2iOaBr+aXtuaJi+WKqOaJp+ihjOS4gOasoeWuj+abv+aNou+8jOS7peehruS/neaVsOaNrueahOS4gOiHtOaAp+OAglxuICByZXR1cm4gcGFyc2VDaGFyYWN0ZXJNYWNyb3MoY29udGVudCk7XG59XG5cbi8qKlxuICog5LuO5raI5oGv5YaF5a655a2X56ym5Liy5Lit6Kej5p6Q5Ye6IGBFcmFEYXRhYCDlr7nosaHjgILov5nmmK/kuIDkuKrlj6ror7vmk43kvZzjgIJcbiAqIEBwYXJhbSB7c3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZH0gbWVzc2FnZUNvbnRlbnQgLSDmtojmga/nmoTlhoXlrrnlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtFcmFEYXRhIHwgbnVsbH0g6Kej5p6Q5oiQ5Yqf5YiZ6L+U5ZueIGBFcmFEYXRhYCDlr7nosaHvvIzlkKbliJnov5Tlm54gbnVsbOOAglxuICovXG5mdW5jdGlvbiBwYXJzZUVyYURhdGEobWVzc2FnZUNvbnRlbnQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBFcmFEYXRhIHwgbnVsbCB7XG4gIGlmICh0eXBlb2YgbWVzc2FnZUNvbnRlbnQgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlQ29udGVudC5tYXRjaChFUkFfREFUQV9SRUdFWCk7XG4gIGlmICghbWF0Y2ggfHwgIW1hdGNoWzFdKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdHJ5IHtcbiAgICAvLyDnlLHkuo4gTUsg5Z2X5YaF6YOo5piv6Ieq5a6a5LmJ55qEIGB7XCJrZXlcIj1cInZhbHVlXCJ9YCDmoLzlvI/vvIzkuI3og73kvb/nlKggSlNPTi5wYXJzZeOAglxuICAgIC8vIOW/hemhu+S9v+eUqOato+WImeihqOi+vuW8j+i/m+ihjOWuveadvuWMuemFjeadpeaPkOWPlumUruWAvOOAglxuICAgIGNvbnN0IGN1c3RvbUZvcm1hdEJsb2NrID0gbWF0Y2hbMV07XG4gICAgY29uc3Qga2V5TWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS1rZXlcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuICAgIGNvbnN0IHR5cGVNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLXR5cGVcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuXG4gICAgaWYgKGtleU1hdGNoPy5bMV0gJiYgdHlwZU1hdGNoPy5bMV0pIHtcbiAgICAgIGNvbnN0IGVyYURhdGEgPSB7XG4gICAgICAgICdlcmEtbWVzc2FnZS1rZXknOiBrZXlNYXRjaFsxXSxcbiAgICAgICAgJ2VyYS1tZXNzYWdlLXR5cGUnOiB0eXBlTWF0Y2hbMV0gYXMgJ3VzZXInIHwgJ2Fzc2lzdGFudCcsXG4gICAgICB9O1xuICAgICAgbG9nLmRlYnVnKCdwYXJzZUVyYURhdGEnLCAn5oiQ5Yqf6Kej5p6QIEVyYURhdGEnLCBlcmFEYXRhKTtcbiAgICAgIHJldHVybiBlcmFEYXRhO1xuICAgIH1cbiAgICBsb2cuZGVidWcoJ3BhcnNlRXJhRGF0YScsICfmnKrog73lnKggRXJhRGF0YSDlnZfkuK3mib7liLDlrozmlbTnmoTplK7lgLzlr7knLCB7IGN1c3RvbUZvcm1hdEJsb2NrIH0pO1xuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLndhcm4oJ3BhcnNlRXJhRGF0YScsICfop6PmnpAgRXJhRGF0YSDlnZfml7blj5HnlJ/lvILluLgnLCBlKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqICoq44CQ5Yik5pat5raI5oGv57G75Z6L44CRKiog5qC55o2u5raI5oGv5YaF5a655Lit55qEIGBlcmEtbWVzc2FnZS10eXBlYCDlhYPmlbDmja7miJYgYHJvbGVgIOWxnuaAp+WIpOaWreaYr+WQpuS4uueUqOaIt+a2iOaBr+OAglxuICog5LyY5YWI5L+h5Lu75rOo5YWl55qE5YWD5pWw5o2u44CCXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge2Jvb2xlYW59IOWmguaenOaYr+eUqOaIt+a2iOaBr++8jOWImei/lOWbniB0cnVl44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1VzZXJNZXNzYWdlKG1zZzogYW55KTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpO1xuICBjb25zdCBkYXRhID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpO1xuICBpZiAoZGF0YSkge1xuICAgIHJldHVybiBkYXRhWydlcmEtbWVzc2FnZS10eXBlJ10gPT09ICd1c2VyJztcbiAgfVxuICAvLyDlm57pgIDliLDmo4Dmn6Ugcm9sZSDlsZ7mgKdcbiAgcmV0dXJuIG1zZz8ucm9sZSA9PT0gJ3VzZXInO1xufVxuXG4vKipcbiAqIOS7juWQjuWQkeWJjeafpeaJvuW5tui/lOWbnuacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIEByZXR1cm5zIHtUYXZlcm5NZXNzYWdlIHwgbnVsbH0g5om+5Yiw55qEIEFJIOa2iOaBr+Wvueixoe+8jOWmguaenOaJvuS4jeWIsOWImei/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kTGFzdEFpTWVzc2FnZSgpOiBhbnkgfCBudWxsIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nLCB7IGluY2x1ZGVfc3dpcGVzOiB0cnVlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZy5kZWJ1ZygnZmluZExhc3RBaU1lc3NhZ2UnLCAn6IGK5aSp6K6w5b2V5Li656m6LCDmnKrmib7liLDku7vkvZXmtojmga/jgIInKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSBtZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IG1zZyA9IG1lc3NhZ2VzW2ldO1xuICAgIGlmICghaXNVc2VyTWVzc2FnZShtc2cpKSB7XG4gICAgICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgYOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga8sIElEOiAke21zZy5tZXNzYWdlX2lkfWApO1xuICAgICAgcmV0dXJuIG1zZztcbiAgICB9XG4gIH1cblxuICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgJ+acquWcqOiBiuWkqeiusOW9leS4reaJvuWIsOS7u+S9lSBBSSDmtojmga/jgIInKTtcbiAgcmV0dXJuIG51bGw7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5raI5oGv5YaZ5YWlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOmAmueUqOOAkSoqIOabtOaWsOaMh+Wumua2iOaBr+eahOWGheWuueOAglxuICog6L+Z5Liq6L6F5Yqp5Ye95pWw5bCB6KOF5LqG5aSE55CGIGBzd2lwZXNgIOWSjOaZrumAmiBgbWVzc2FnZWAg55qE6YC76L6R77yM5o+Q5L6b5LiA5Liq57uf5LiA55qE5YaZ5YWl5o6l5Y+j44CCXG4gKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOimgeabtOaWsOeahOa2iOaBr+WvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IG5ld0NvbnRlbnQgLSDlhajmlrDnmoTmtojmga/lhoXlrrnjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1lc3NhZ2U6IGFueSwgbmV3Q29udGVudDogc3RyaW5nKSB7XG4gIGNvbnN0IG9sZENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtZXNzYWdlKTtcbiAgbG9nLmRlYnVnKCd1cGRhdGVNZXNzYWdlQ29udGVudCcsICfmm7TmlrDliY3nmoTmtojmga/lhoXlrrk6Jywgb2xkQ29udGVudCk7XG4gIGxvZy5kZWJ1ZygndXBkYXRlTWVzc2FnZUNvbnRlbnQnLCAn5pu05paw5ZCO55qE5raI5oGv5YaF5a65OicsIG5ld0NvbnRlbnQpO1xuXG4gIGNvbnN0IHVwZGF0ZVBheWxvYWQ6IHsgbWVzc2FnZV9pZDogbnVtYmVyOyBtZXNzYWdlPzogc3RyaW5nOyBzd2lwZXM/OiBzdHJpbmdbXSB9ID0ge1xuICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2UubWVzc2FnZV9pZCxcbiAgfTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlLnN3aXBlcykpIHtcbiAgICBjb25zdCBzaWQgPSBOdW1iZXIobWVzc2FnZS5zd2lwZV9pZCA/PyAwKTtcbiAgICBjb25zdCBuZXdTd2lwZXMgPSBbLi4ubWVzc2FnZS5zd2lwZXNdO1xuICAgIG5ld1N3aXBlc1tzaWRdID0gbmV3Q29udGVudDtcbiAgICB1cGRhdGVQYXlsb2FkLnN3aXBlcyA9IG5ld1N3aXBlcztcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGVQYXlsb2FkLm1lc3NhZ2UgPSBuZXdDb250ZW50O1xuICB9XG5cbiAgYXdhaXQgc2V0Q2hhdE1lc3NhZ2VzKFt1cGRhdGVQYXlsb2FkXSwgeyByZWZyZXNoOiAnbm9uZScgfSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/message.ts\n\n}");
  },
  "./src/ERA变量框架/utils/string.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/utils/string.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractBlocks: () => (/* binding */ extractBlocks),\n/* harmony export */   rnd: () => (/* binding */ rnd),\n/* harmony export */   stripCodeFence: () => (/* binding */ stripCodeFence)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 字符串处理模块\n */\n\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * 基于 `Math.random()`，在同一毫秒内也能保证极高的唯一性。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nfunction rnd() {\n    return Math.random().toString(36).slice(2, 8);\n}\n/**\n * 从文本中提取所有被特定 XML 风格标签包裹的内容块。\n * 使用非贪婪模式的正则表达式，但不处理嵌套标签。\n * @param {string} text - 包含标签的原始文本。\n * @param {string} tag - 要提取的标签名称（例如 'VariableEdit'）。\n * @returns {string[]} 包含所有提取并清理后（去除代码围栏和首尾空格）的内容块的数组。\n */\nfunction extractBlocks(text, tag) {\n    const blocks = [];\n    // 正则表达式: /<tag>([\\s\\S]*?)<\\/tag>/g\n    // - <${tag}>: 匹配开标签。\n    // - ([\\s\\S]*?): 非贪婪地捕获开闭标签之间的所有字符（包括换行符）。\n    // - <\\/${tag}>: 匹配闭标签。\n    // - g: 全局匹配，以找到所有匹配项。\n    const re = new RegExp(`<${tag}>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'g');\n    let m;\n    while ((m = re.exec(text))) {\n        const rawBody = (m[1] || '').trim();\n        // 在存入前，先剥离AI可能生成的多余代码围栏。\n        const body = stripCodeFence(rawBody);\n        if (body)\n            blocks.push(body);\n    }\n    return blocks;\n}\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nfunction stripCodeFence(s) {\n    if (!s)\n        return s;\n    let t = String(s).trim();\n    // 移除起始围栏，例如 ```json, ```, ~~~\n    t = t.replace(/^\\s*(?:```|~~~)\\[a-zA-Z0-9_-\\]*\\s*\\r?\\n/, '');\n    // 移除结束围栏\n    t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n    return t.trim();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3N0cmluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7R0FFRztBQUVVO0FBRWI7Ozs7R0FJRztBQUNJLFNBQVMsR0FBRztJQUNqQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0ksU0FBUyxhQUFhLENBQUMsSUFBWSxFQUFFLEdBQVc7SUFDckQsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBQzVCLG1DQUFtQztJQUNuQyxxQkFBcUI7SUFDckIsMENBQTBDO0lBQzFDLHVCQUF1QjtJQUN2QixzQkFBc0I7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxHQUFHLG9CQUFvQixHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5RCxJQUFJLENBQUMsQ0FBQztJQUNOLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDM0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDcEMseUJBQXlCO1FBQ3pCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLElBQUk7WUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNJLFNBQVMsY0FBYyxDQUFDLENBQVM7SUFDdEMsSUFBSSxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsOEJBQThCO0lBQzlCLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLHlDQUF5QyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELFNBQVM7SUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvc3RyaW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWtl+espuS4suWkhOeQhuaooeWdl1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiDnlJ/miJDkuIDkuKrmjIflrprplb/luqbnmoTpmo/mnLrlrZfnrKbkuLLvvIznlKjkvZzllK/kuIDmoIfor4bnrKbjgIJcbiAqIOWfuuS6jiBgTWF0aC5yYW5kb20oKWDvvIzlnKjlkIzkuIDmr6vnp5LlhoXkuZ/og73kv53or4HmnoHpq5jnmoTllK/kuIDmgKfjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS4gOS4qumaj+acuueahOOAgeeUseaVsOWtl+WSjOWwj+WGmeWtl+avjee7hOaIkOeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcm5kKCk6IHN0cmluZyB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KTtcbn1cblxuLyoqXG4gKiDku47mlofmnKzkuK3mj5Dlj5bmiYDmnInooqvnibnlrpogWE1MIOmjjuagvOagh+etvuWMheijueeahOWGheWuueWdl+OAglxuICog5L2/55So6Z2e6LSq5amq5qih5byP55qE5q2j5YiZ6KGo6L6+5byP77yM5L2G5LiN5aSE55CG5bWM5aWX5qCH562+44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIOWMheWQq+agh+etvueahOWOn+Wni+aWh+acrOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHRhZyAtIOimgeaPkOWPlueahOagh+etvuWQjeensO+8iOS+i+WmgiAnVmFyaWFibGVFZGl0J++8ieOAglxuICogQHJldHVybnMge3N0cmluZ1tdfSDljIXlkKvmiYDmnInmj5Dlj5blubbmuIXnkIblkI7vvIjljrvpmaTku6PnoIHlm7TmoI/lkozpppblsL7nqbrmoLzvvInnmoTlhoXlrrnlnZfnmoTmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RCbG9ja3ModGV4dDogc3RyaW5nLCB0YWc6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmxvY2tzOiBzdHJpbmdbXSA9IFtdO1xuICAvLyDmraPliJnooajovr7lvI86IC88dGFnPihbXFxzXFxTXSo/KTxcXC90YWc+L2dcbiAgLy8gLSA8JHt0YWd9Pjog5Yy56YWN5byA5qCH562+44CCXG4gIC8vIC0gKFtcXHNcXFNdKj8pOiDpnZ7otKrlqarlnLDmjZXojrflvIDpl63moIfnrb7kuYvpl7TnmoTmiYDmnInlrZfnrKbvvIjljIXmi6zmjaLooYznrKbvvInjgIJcbiAgLy8gLSA8XFwvJHt0YWd9Pjog5Yy56YWN6Zet5qCH562+44CCXG4gIC8vIC0gZzog5YWo5bGA5Yy56YWN77yM5Lul5om+5Yiw5omA5pyJ5Yy56YWN6aG544CCXG4gIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChgPCR7dGFnfT4oW1xcXFxzXFxcXFNdKj8pPFxcXFwvJHt0YWd9PmAsICdnJyk7XG4gIGxldCBtO1xuICB3aGlsZSAoKG0gPSByZS5leGVjKHRleHQpKSkge1xuICAgIGNvbnN0IHJhd0JvZHkgPSAobVsxXSB8fCAnJykudHJpbSgpO1xuICAgIC8vIOWcqOWtmOWFpeWJje+8jOWFiOWJpeemu0FJ5Y+v6IO955Sf5oiQ55qE5aSa5L2Z5Luj56CB5Zu05qCP44CCXG4gICAgY29uc3QgYm9keSA9IHN0cmlwQ29kZUZlbmNlKHJhd0JvZHkpO1xuICAgIGlmIChib2R5KSBibG9ja3MucHVzaChib2R5KTtcbiAgfVxuICByZXR1cm4gYmxvY2tzO1xufVxuXG4vKipcbiAqIOS7juWtl+espuS4suS4reenu+mZpCBBSSDnlJ/miJDnmoQgTWFya2Rvd24g5Luj56CB5Z2X5Zu05qCP77yI5aaCIGBgYGpzb24gLi4uIGBgYO+8ieOAglxuICogQHBhcmFtIHtzdHJpbmd9IHMgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOenu+mZpOWbtOagj+W5tuS/ruWJqummluWwvuepuuagvOWQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBDb2RlRmVuY2Uoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzKSByZXR1cm4gcztcbiAgbGV0IHQgPSBTdHJpbmcocykudHJpbSgpO1xuICAvLyDnp7vpmaTotbflp4vlm7TmoI/vvIzkvovlpoIgYGBganNvbiwgYGBgLCB+fn5cbiAgdCA9IHQucmVwbGFjZSgvXlxccyooPzpgYGB8fn5+KVxcW2EtekEtWjAtOV8tXFxdKlxccypcXHI/XFxuLywgJycpO1xuICAvLyDnp7vpmaTnu5PmnZ/lm7TmoI9cbiAgdCA9IHQucmVwbGFjZSgvXFxyP1xcbig/OmBgYHx+fn4pXFxzKiQvLCAnJyk7XG4gIHJldHVybiB0LnRyaW0oKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/string.ts\n\n}");
  },
  "./src/ERA变量框架/utils/text.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/text.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deepParseCharacterMacros: () => (/* binding */ deepParseCharacterMacros),\n/* harmony export */   parseCharacterMacros: () => (/* binding */ parseCharacterMacros)\n/* harmony export */ });\n/**\n * 解析字符串中的角色和用户宏, 并将其替换为对应的名称。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseCharacterMacros(text) {\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{')) {\n        return text;\n    }\n    let result = text;\n    // 使用全局不区分大小写的替换\n    result = result.replace(/{{user}}/gi, SillyTavern.name1);\n    result = result.replace(/{{char}}/gi, SillyTavern.name2);\n    return result;\n}\n/**\n * 深度遍历数据, 对所有字符串类型的值应用 parseCharacterMacros 宏替换。\n * @param data - 任何类型的数据。\n * @returns - 经过宏替换后的数据。\n */\nconst deepParseCharacterMacros = (data) => {\n    if (typeof data === 'string') {\n        return parseCharacterMacros(data);\n    }\n    if (Array.isArray(data)) {\n        return data.map(item => deepParseCharacterMacros(item));\n    }\n    if (typeof data === 'object' && data !== null) {\n        return Object.entries(data).reduce((acc, [key, value]) => {\n            acc[key] = deepParseCharacterMacros(value);\n            return acc;\n        }, {});\n    }\n    return data;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3RleHQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7R0FLRztBQUNJLFNBQVMsb0JBQW9CLENBQUMsSUFBWTtJQUMvQyw0QkFBNEI7SUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUN6QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDbEIsZ0JBQWdCO0lBQ2hCLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekQsTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6RCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNJLE1BQU0sd0JBQXdCLEdBQUcsQ0FBQyxJQUFTLEVBQU8sRUFBRTtJQUN6RCxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzdCLE9BQU8sb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUNELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUNELElBQUksT0FBTyxJQUFJLEtBQUssUUFBUSxJQUFJLElBQUksS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUM5QyxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUNoQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFO1lBQ3BCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyx3QkFBd0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMzQyxPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUMsRUFDRCxFQUF5QixDQUMxQixDQUFDO0lBQ0osQ0FBQztJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvdGV4dC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOino+aekOWtl+espuS4suS4reeahOinkuiJsuWSjOeUqOaIt+Wujywg5bm25bCG5YW25pu/5o2i5Li65a+55bqU55qE5ZCN56ew44CCXG4gKiDov5nmmK/mj5Dkvpvnu5nlhbbku5bmqKHlnZfosIPnlKjnmoTlhazlhbHmjqXlj6PjgIJcbiAqIEBwYXJhbSB0ZXh0IC0g5YyF5ZCr5a6P55qE6L6T5YWl5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyAtIOabv+aNouWuj+WQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDaGFyYWN0ZXJNYWNyb3ModGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8g5aaC5p6c5paH5pys5Lit5LiN5YyF5ZCr5a6P54m55b6B5a2X56ym5LiyLCDnm7TmjqXov5Tlm57ku6XkvJjljJbmgKfog71cbiAgaWYgKCF0ZXh0LmluY2x1ZGVzKCd7eycpKSB7XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICBsZXQgcmVzdWx0ID0gdGV4dDtcbiAgLy8g5L2/55So5YWo5bGA5LiN5Yy65YiG5aSn5bCP5YaZ55qE5pu/5o2iXG4gIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC97e3VzZXJ9fS9naSwgU2lsbHlUYXZlcm4ubmFtZTEpO1xuICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgve3tjaGFyfX0vZ2ksIFNpbGx5VGF2ZXJuLm5hbWUyKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiDmt7HluqbpgY3ljobmlbDmja4sIOWvueaJgOacieWtl+espuS4suexu+Wei+eahOWAvOW6lOeUqCBwYXJzZUNoYXJhY3Rlck1hY3JvcyDlro/mm7/mjaLjgIJcbiAqIEBwYXJhbSBkYXRhIC0g5Lu75L2V57G75Z6L55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyAtIOe7j+i/h+Wuj+abv+aNouWQjueahOaVsOaNruOAglxuICovXG5leHBvcnQgY29uc3QgZGVlcFBhcnNlQ2hhcmFjdGVyTWFjcm9zID0gKGRhdGE6IGFueSk6IGFueSA9PiB7XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gcGFyc2VDaGFyYWN0ZXJNYWNyb3MoZGF0YSk7XG4gIH1cbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICByZXR1cm4gZGF0YS5tYXAoaXRlbSA9PiBkZWVwUGFyc2VDaGFyYWN0ZXJNYWNyb3MoaXRlbSkpO1xuICB9XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgZGF0YSAhPT0gbnVsbCkge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhkYXRhKS5yZWR1Y2UoXG4gICAgICAoYWNjLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgYWNjW2tleV0gPSBkZWVwUGFyc2VDaGFyYWN0ZXJNYWNyb3ModmFsdWUpO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSxcbiAgICAgIHt9IGFzIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/text.ts\n\n}");
  },
  jquery: 
  /*!********************!*\
  !*** external "$" ***!
  \********************/ module => {
    module.exports = $;
  },
  lodash: 
  /*!********************!*\
  !*** external "_" ***!
  \********************/ module => {
    module.exports = _;
  },
  zod: 
  /*!********************!*\
  !*** external "z" ***!
  \********************/ module => {
    module.exports = z;
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/ERA变量框架/index.ts");
