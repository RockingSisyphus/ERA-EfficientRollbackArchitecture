var __webpack_modules__ = {
  "./src/ERA变量框架/api/command.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/api/command.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteByObject: () => (/* binding */ deleteByObject),\n/* harmony export */   deleteByPath: () => (/* binding */ deleteByPath),\n/* harmony export */   emitWriteDoneEvent: () => (/* binding */ emitWriteDoneEvent),\n/* harmony export */   insertByObject: () => (/* binding */ insertByObject),\n/* harmony export */   insertByPath: () => (/* binding */ insertByPath),\n/* harmony export */   updateByObject: () => (/* binding */ updateByObject),\n/* harmony export */   updateByPath: () => (/* binding */ updateByPath)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('api-command');\n// 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件\nconst debouncedEmitApiWrite = lodash__WEBPACK_IMPORTED_MODULE_0___default().debounce(() => {\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n}, 50, //API调用的防抖改成50毫秒，提高即时性\n{ leading: false, trailing: true });\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job) {\n    // 1. 生成指令块\n    const contentString = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.J)(job.blockContent);\n    const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n    // 2. 查找目标消息并追加内容\n    const lastAiMessage = await (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.findLastAiMessage)();\n    if (!lastAiMessage) {\n        logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n        return;\n    }\n    const originalContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(lastAiMessage) ?? '';\n    const newContent = originalContent + block;\n    logger.log('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n    // 3. 实时更新消息内容\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.updateMessageContent)(lastAiMessage, newContent);\n    // 4. 调用防抖函数来调度写入事件的发送\n    debouncedEmitApiWrite();\n}\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction insertByObject(data) {\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction updateByObject(data) {\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction insertByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction updateByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nfunction deleteByObject(data) {\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nfunction deleteByPath(path) {\n    // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, {});\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n// ==================================================================\n// 事件广播器实现 (由 variable_change_processor.ts 等内部模块调用)\n// ==================================================================\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）在 `variable_change_processor.ts` 中成功完成后，\n * 应调用此函数。它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {WriteDonePayload} payload - 包含写入操作关键信息的事件负载。\n * @example\n * // 这是一个在外部脚本中监听此事件的示例：\n * eventOn('era:writeDone', (detail) => {\n *   const { mk, message_id, actions, selectedMks, editLogs, stat, statWithoutMeta } = detail;\n *   console.log(`ERA 变量已更新！消息 ID: ${message_id}, MK: ${mk}`);\n *   console.log('执行的操作:', actions);\n *\n *   // 你可以根据需要使用 stat (带 meta) 或 statWithoutMeta (不带 meta)\n *   console.log('最新的纯净状态数据:', statWithoutMeta);\n *\n *   // 此时可以根据最新的状态数据更新你自己的 UI 或执行其他逻辑\n * });\n */\nfunction emitWriteDoneEvent(payload) {\n    // 在广播前，对需要暴露给外部的数据进行反转义\n    const unescapedPayload = {\n        ...payload,\n        stat: (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.unescapeEraData)(payload.stat),\n        statWithoutMeta: (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.unescapeEraData)(payload.statWithoutMeta),\n    };\n    logger.debug('emitWriteDoneEvent', 'writeDone事件广播数据反转义', {\n        before: { stat: payload.stat, statWithoutMeta: payload.statWithoutMeta },\n        after: { stat: unescapedPayload.stat, statWithoutMeta: unescapedPayload.statWithoutMeta },\n    });\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE, unescapedPayload);\n    logger.log('emitWriteDoneEvent', `已触发 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE} 事件。操作: ${JSON.stringify(payload.actions)}, MK: ${payload.mk}, MsgID: ${payload.message_id}, 连续处理次数: ${payload.consecutiveProcessingCount}`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9jb21tYW5kLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQUVvQjtBQUNrRDtBQUN0QjtBQUNiO0FBQ3dEO0FBRTlGLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQVF6QywwQ0FBMEM7QUFDMUMsTUFBTSxxQkFBcUIsR0FBRyxzREFBVSxDQUN0QyxHQUFHLEVBQUU7SUFDSCxTQUFTLENBQUMsK0RBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxXQUFXLCtEQUFpQixDQUFDLFNBQVMsTUFBTSxDQUFDLENBQUM7QUFDcEYsQ0FBQyxFQUNELEVBQUUsRUFBRSxzQkFBc0I7QUFDMUIsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FDbkMsQ0FBQztBQUVGLHFFQUFxRTtBQUNyRSxXQUFXO0FBQ1gsc0RBQXNEO0FBQ3RELHFFQUFxRTtBQUVyRTs7Ozs7Ozs7R0FRRztBQUVIOzs7Ozs7OztHQVFHO0FBRUg7Ozs7Ozs7Ozs7O0dBV0c7QUFFSDs7Ozs7Ozs7Ozs7R0FXRztBQUVIOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVIOzs7Ozs7O0dBT0c7QUFFSCxxRUFBcUU7QUFDckUsU0FBUztBQUNULHFFQUFxRTtBQUVyRTs7OztHQUlHO0FBRUg7Ozs7R0FJRztBQUNILEtBQUssVUFBVSxlQUFlLENBQUMsR0FBZ0I7SUFDN0MsV0FBVztJQUNYLE1BQU0sYUFBYSxHQUFHLDhDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzFDLE1BQU0sS0FBSyxHQUFHLE1BQU0sR0FBRyxDQUFDLFFBQVEsTUFBTSxhQUFhLE9BQU8sR0FBRyxDQUFDLFFBQVEsR0FBRyxDQUFDO0lBRTFFLGlCQUFpQjtJQUNqQixNQUFNLGFBQWEsR0FB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ZSxFQUFFO1FBQ3hFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixDQUFDLGVBQWUsRUFBRTtLQUMxRixDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsK0RBQWlCLENBQUMsVUFBVSxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDMUQsTUFBTSxDQUFDLEdBQUcsQ0FDUixvQkFBb0IsRUFDcEIsT0FBTywrREFBaUIsQ0FBQyxVQUFVLFdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FDMUQsT0FBTyxDQUFDLE9BQU8sQ0FDaEIsU0FBUyxPQUFPLENBQUMsRUFBRSxZQUFZLE9BQU8sQ0FBQyxVQUFVLGFBQWEsT0FBTyxDQUFDLDBCQUEwQixFQUFFLENBQ3BHLENBQUM7QUFDSixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvYXBpL2NvbW1hbmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5aSW6YOo5LqL5Lu2IEFQSSDlrp7njrDmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbkuI7lpJbpg6johJrmnKzkuqTkupLnmoTmjqXlj6PlsYLjgILlroPlrp7njrDkuobkuIDns7vliJfoh6rlrprkuYnkuovku7bnmoTlpITnkIblmajjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogRVJBIOahhuaetuS4jeebtOaOpeWQkeWkluaatOmcsuWHveaVsOiwg+eUqOaOpeWPo+OAguWklumDqOiEmuacrOS4jiBFUkEg5Lqk5LqS55qEKirllK/kuIAqKuaWueW8j+aYr+mAmui/h+mFkummhueahFxuICogYGV2ZW50RW1pdChldmVudE5hbWUsIGV2ZW50RGF0YSlgIOWHveaVsO+8jOWPkemAgeeJueWumuagvOW8j+eahOS6i+S7tuOAglxuICpcbiAqIGBpbmRleC50c2Ag5qih5Z2X5Lya55uR5ZCs6L+Z5LqbIGBlcmE6KmAg5YmN57yA55qE5LqL5Lu277yM5bm25bCG5YW25o6o5YWlIGBldmVudF9xdWV1ZS50c2Ag5Lit6L+b6KGM5aSE55CG44CCXG4gKiDkuovku7bpmJ/liJfmnIDnu4jkvJrosIPnlKjmnKzmlofku7bkuK3lr7nlupTnmoTlpITnkIblmajlh73mlbDvvIjlpoIgYGluc2VydEJ5T2JqZWN0YO+8ieOAglxuICpcbiAqIOacrOaooeWdl+S4reeahOWHveaVsOmAmui/h+S4gOenjeW3p+WmmeOAgeino+iApueahOaWueW8j+W3peS9nO+8muWug+S7rOWcqOacgOaWsOeahCBBSSDmtojmga/mnKvlsL7liqjmgIHms6jlhaVcbiAqIGA8VmFyaWFibGVJbnNlcnQ+YCDmiJYgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfvvIznhLblkI7osIPnlKjphZLppobnmoQgYHNldENoYXRNZXNzYWdlc2Ag5pu05paw5raI5oGv44CCXG4gKiDov5nmrKHkv67mlLnkvJrop6blj5EgYGNoYXJhY3Rlcl9tZXNzYWdlX3JlbmRlcmVkYCDnrYnkuovku7bvvIzooqsgRVJBIOeahOS4u+ebkeWQrOWZqOaNleiOt++8jFxuICog5LuO6ICM5bCGIEFQSSDosIPnlKjml6DnvJ3lnLDmlbTlkIjliLAgRVJBIOeahOWOn+eUn+ino+aekOWSjOWQjOatpea1geeoi+S4reOAglxuICovXG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBFUkFfRVZFTlRfRU1JVFRFUiwgV3JpdGVEb25lUGF5bG9hZCB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBKLCB1bmVzY2FwZUVyYURhdGEgfSBmcm9tICcuLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBmaW5kTGFzdEFpTWVzc2FnZSwgZ2V0TWVzc2FnZUNvbnRlbnQsIHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vdXRpbHMvbWVzc2FnZSc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2FwaS1jb21tYW5kJyk7XG5cbi8vIEFQSSDlhpnlhaXku7vliqHnmoTmjqXlj6PlrprkuYlcbmludGVyZmFjZSBBcGlXcml0ZUpvYiB7XG4gIGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnIHwgJ1ZhcmlhYmxlRWRpdCcgfCAnVmFyaWFibGVEZWxldGUnO1xuICBibG9ja0NvbnRlbnQ6IG9iamVjdDtcbn1cblxuLy8g5L2/55SoIGxvZGFzaC5kZWJvdW5jZSDliJvlu7rkuIDkuKrpmLLmipblh73mlbDmnaXlj5HpgIEgQVBJIOWGmeWFpeS6i+S7tlxuY29uc3QgZGVib3VuY2VkRW1pdEFwaVdyaXRlID0gXy5kZWJvdW5jZShcbiAgKCkgPT4ge1xuICAgIGV2ZW50RW1pdChFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEUpO1xuICAgIGxvZ2dlci5sb2coJ2RlYm91bmNlZEVtaXRBcGlXcml0ZScsIGDlt7Lop6blj5HlkIjlubblkI7nmoQgJHtFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEV9IOS6i+S7tuOAgmApO1xuICB9LFxuICA1MCwgLy9BUEnosIPnlKjnmoTpmLLmipbmlLnmiJA1MOavq+enku+8jOaPkOmrmOWNs+aXtuaAp1xuICB7IGxlYWRpbmc6IGZhbHNlLCB0cmFpbGluZzogdHJ1ZSB9LFxuKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUEkg5LqL5Lu25Y+C6ICDXG4vLyAo5LqL5Lu25ZCN56ew55qE5bi46YeP5a6a5LmJ6KeB5LqOIGBjb25zdGFudHMudHNgIOS4reeahCBgRVJBX0FQSV9FVkVOVFNgIOWvueixoSlcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTppbnNlcnRCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzpnZ7noLTlnY/mgKflnLDmj5LlhaXmlrDlj5jph4/jgILlj6rkvJrlhpnlhaXkuI3lrZjlnKjnmoTot6/lvoTjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDopoHmj5LlhaXnmoTlj5jph4/lr7nosaHjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTppbnNlcnRCeU9iamVjdCcsIHtcbiAqICAgcGxheWVyOiB7IG5hbWU6IFwi5YuH6ICFXCIsIGhwOiAxMDAsIGludmVudG9yeTogW10gfVxuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6dXBkYXRlQnlPYmplY3QnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5LiA5Liq5a+56LGh77yM5L+u5pS55bey5a2Y5Zyo55qE5Y+Y6YeP44CC5aaC5p6c6Lev5b6E5LiN5a2Y5Zyo77yM5YiZ5b+955Wl44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g6KaB5pu05paw55qE5Y+Y6YeP5a+56LGh44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6dXBkYXRlQnlPYmplY3QnLCB7XG4gKiAgIHBsYXllcjogeyBocDogMTIwLCBzdGF0dXM6ICdibGVzc2VkJyB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTppbnNlcnRCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E5ZKM5YC877yM6Z2e56C05Z2P5oCn5Zyw5o+S5YWl5LiA5Liq5paw5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E5ZKM5YC855qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDlj5jph4/nmoTot6/lvoTvvIzkvb/nlKjngrnmiJbmlrnmi6zlj7fooajnpLrms5XjgIJcbiAqIEBwYXJhbSB7Kn0gZGV0YWlsLnZhbHVlIC0g6KaB5o+S5YWl55qE5YC844CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6aW5zZXJ0QnlQYXRoJywge1xuICogICBwYXRoOiAncGxheWVyLmludmVudG9yeVswXScsXG4gKiAgIHZhbHVlOiB7IG5hbWU6ICfnlJ/lkb3oja/msLQnLCBjb3VudDogMyB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTp1cGRhdGVCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E5ZKM5YC877yM5L+u5pS55LiA5Liq5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E5ZKM5YC855qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDlj5jph4/nmoTot6/lvoTjgIJcbiAqIEBwYXJhbSB7Kn0gZGV0YWlsLnZhbHVlIC0g6KaB6K6+572u55qE5paw5YC844CC5Y+v5Lul5piv55u05o6l55qE5YC877yM5Lmf5Y+v5Lul5piv6L+Q566X6KGo6L6+5byP44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6dXBkYXRlQnlQYXRoJywge1xuICogICBwYXRoOiAncGxheWVyLmhwJyxcbiAqICAgdmFsdWU6ICcrPTEwJ1xuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6ZGVsZXRlQnlPYmplY3QnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5LiA5Liq5a+56LGh77yM5Yig6Zmk5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5o+P6L+w6KaB5Yig6Zmk6Lev5b6E55qE57uT5p6E44CC5YC855qE57uT5p6E5Yaz5a6a5LqG5Yig6Zmk6KGM5Li644CCXG4gKiBAZXhhbXBsZVxuICogLy8g5YeG5aSH5Yig6ZmkIHBsYXllci5nb2xk44CC5oyH5Luk5LitIGdvbGQg55qE5YC85b+F6aG75piv56m65a+56LGhIHt9XG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeU9iamVjdCcsIHsgcGxheWVyOiB7IGdvbGQ6IHt9IH0gfSk7XG4gKlxuICogLy8g5YeG5aSH5Yig6Zmk5pW05LiqIHBsYXllciDlr7nosaHjgIJcbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHt9IH0pO1xuICpcbiAqIC8vICoq6YeN6KaBKio6IOWmguaenCBwbGF5ZXIg5a+56LGh5YyF5ZCrIGdvbGQg5ZKMIG1hbmEg5Lik5Liq5bGe5oCn77yMXG4gKiAvLyDku6XkuIvmjIfku6Tlj6rkvJrliKDpmaQgZ29sZCDlkowgbWFuYe+8jOiAjCBwbGF5ZXIg5a+56LGh5pys6Lqr5Lya6KKr5L+d55WZ77yI5Y+Y5Li656m65a+56LGh77yJ44CCXG4gKiAvLyDov5nkuI4gYGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHt9IH0pYCDnmoTmlYjmnpzmmK/kuI3lkIznmoTjgIJcbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHsgZ29sZDoge30sIG1hbmE6IHt9IH0gfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6ZGVsZXRlQnlQYXRoJ1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+aMh+Wumui3r+W+hO+8jOWIoOmZpOS4gOS4quW3suWtmOWcqOeahOWPmOmHj+OAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOWMheWQq+i3r+W+hOeahOWvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IGRldGFpbC5wYXRoIC0g6KaB5Yig6Zmk55qE5Y+Y6YeP55qE6Lev5b6E44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlQYXRoJywgeyBwYXRoOiAncGxheWVyLmludmVudG9yeVswXScgfSk7XG4gKi9cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDlhoXpg6jmoLjlv4Plh73mlbBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIOWcqOiBiuWkqeiusOW9leS4reafpeaJvuW5tui/lOWbnuacgOWQjuS4gOadoeeUsSBBSSDlj5HpgIHnmoTmtojmga/jgIJcbiAqIOi/meaYr+azqOWFpeWPmOmHj+S/ruaUueaMh+S7pOeahOebruagh+a2iOaBr+OAglxuICogQHJldHVybnMge1Byb21pc2U8YW55IHwgbnVsbD59IOi/lOWbnuaJvuWIsOeahOa2iOaBr+Wvueixoe+8jOWmguaenOS4jeWtmOWcqCBBSSDmtojmga/liJnov5Tlm54gbnVsbOOAglxuICovXG5cbi8qKlxuICog5omn6KGM5LiA5qyhIEFQSSDlhpnlhaXmk43kvZzjgIJcbiAqIOWug+WwhuaMh+WumueahOWPmOmHj+S/ruaUueWdl+i/veWKoOWIsOacgOWQjuS4gOadoSBBSSDmtojmga/nmoTmnKvlsL7vvIznhLblkI7osIPluqbkuIDkuKogJ2VyYTphcGlXcml0ZScg5LqL5Lu244CCXG4gKiBAcGFyYW0ge0FwaVdyaXRlSm9ifSBqb2IgLSDopoHmiafooYznmoTlhpnlhaXku7vliqHjgIJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFwaVdyaXRlKGpvYjogQXBpV3JpdGVKb2IpIHtcbiAgLy8gMS4g55Sf5oiQ5oyH5Luk5Z2XXG4gIGNvbnN0IGNvbnRlbnRTdHJpbmcgPSBKKGpvYi5ibG9ja0NvbnRlbnQpO1xuICBjb25zdCBibG9jayA9IGBcXG48JHtqb2IuYmxvY2tUYWd9PlxcbiR7Y29udGVudFN0cmluZ31cXG48LyR7am9iLmJsb2NrVGFnfT5gO1xuXG4gIC8vIDIuIOafpeaJvuebruagh+a2iOaBr+W5tui/veWKoOWGheWuuVxuICBjb25zdCBsYXN0QWlNZXNzYWdlID0gYXdhaXQgZmluZExhc3RBaU1lc3NhZ2UoKTtcbiAgaWYgKCFsYXN0QWlNZXNzYWdlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ3BlcmZvcm1BcGlXcml0ZScsICfmib7kuI3liLDku7vkvZUgQUkg5raI5oGv77yM5peg5rOV5omn6KGMIEFQSSDlhpnlhaXjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBvcmlnaW5hbENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChsYXN0QWlNZXNzYWdlKSA/PyAnJztcbiAgY29uc3QgbmV3Q29udGVudCA9IG9yaWdpbmFsQ29udGVudCArIGJsb2NrO1xuXG4gIGxvZ2dlci5sb2coJ3BlcmZvcm1BcGlXcml0ZScsIGDlrp7ml7blhpnlhaUgQVBJIOS7u+WKoSAoJHtqb2IuYmxvY2tUYWd9KSDliLDmtojmga8gSUQgJHtsYXN0QWlNZXNzYWdlLm1lc3NhZ2VfaWR9Li4uYCk7XG5cbiAgLy8gMy4g5a6e5pe25pu05paw5raI5oGv5YaF5a65XG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KGxhc3RBaU1lc3NhZ2UsIG5ld0NvbnRlbnQpO1xuXG4gIC8vIDQuIOiwg+eUqOmYsuaKluWHveaVsOadpeiwg+W6puWGmeWFpeS6i+S7tueahOWPkemAgVxuICBkZWJvdW5jZWRFbWl0QXBpV3JpdGUoKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7blpITnkIblmajlrp7njrAgKOeUsSBldmVudF9xdWV1ZS50cyDosIPnlKgpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmluc2VydEJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+WvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnLCBibG9ja0NvbnRlbnQ6IGRhdGEgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTp1cGRhdGVCeU9iamVjdGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIOS7juS6i+S7tueahCBgZGV0YWlsYCDkuK3ojrflj5bnmoTlj5jph4/lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUJ5T2JqZWN0KGRhdGE6IG9iamVjdCkge1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRWRpdCcsIGJsb2NrQ29udGVudDogZGF0YSB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmluc2VydEJ5UGF0aGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHBhdGhgIOWxnuaAp+iOt+WPluOAglxuICogQHBhcmFtIHsqfSB2YWx1ZSAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHZhbHVlYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEJ5UGF0aChwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgY29uc3QgYmxvY2sgPSBfLnNldCh7fSwgcGF0aCwgdmFsdWUpO1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlSW5zZXJ0JywgYmxvY2tDb250ZW50OiBibG9jayB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOnVwZGF0ZUJ5UGF0aGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHBhdGhgIOWxnuaAp+iOt+WPluOAglxuICogQHBhcmFtIHsqfSB2YWx1ZSAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHZhbHVlYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUJ5UGF0aChwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgY29uc3QgYmxvY2sgPSBfLnNldCh7fSwgcGF0aCwgdmFsdWUpO1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRWRpdCcsIGJsb2NrQ29udGVudDogYmxvY2sgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTpkZWxldGVCeU9iamVjdGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIOS7juS6i+S7tueahCBgZGV0YWlsYCDkuK3ojrflj5bnmoTlj5jph4/nu5PmnoTjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUJ5T2JqZWN0KGRhdGE6IG9iamVjdCkge1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRGVsZXRlJywgYmxvY2tDb250ZW50OiBkYXRhIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6ZGVsZXRlQnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVCeVBhdGgocGF0aDogc3RyaW5nKSB7XG4gIC8vIOWvueS6juWIoOmZpOaTjeS9nO+8jOaIkeS7rOeUqOS4gOS4quepuuWvueixoeS9nOS4uuWAvOadpeihqOekuuWIoOmZpOivpei3r+W+hOeahOaEj+WbvlxuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB7fSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVEZWxldGUnLCBibG9ja0NvbnRlbnQ6IGJsb2NrIH0pO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOS6i+S7tuW5v+aSreWZqOWunueOsCAo55SxIHZhcmlhYmxlX2NoYW5nZV9wcm9jZXNzb3IudHMg562J5YaF6YOo5qih5Z2X6LCD55SoKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDlub/mkq3lmajjgJEqKiDop6blj5EgYGVyYTp3cml0ZURvbmVgIOS6i+S7tuOAglxuICog5b2T5LiA5qyh5a6M5pW055qE5Y+Y6YeP5YaZ5YWl5pON5L2c77yI5YyF5ous5aKe44CB5Yig44CB5pS577yJ5ZyoIGB2YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzYCDkuK3miJDlip/lrozmiJDlkI7vvIxcbiAqIOW6lOiwg+eUqOatpOWHveaVsOOAguWug+WQkeWklumDqOiEmuacrOW5v+aSreS4gOS4quS6i+S7tu+8jOmAmuefpeWug+S7rOWPmOmHj+eKtuaAgeW3suWPkeeUn+aUueWPmO+8jOW5tuaPkOS+m+ivpue7hueahOS4iuS4i+aWh+OAglxuICpcbiAqIEBwYXJhbSB7V3JpdGVEb25lUGF5bG9hZH0gcGF5bG9hZCAtIOWMheWQq+WGmeWFpeaTjeS9nOWFs+mUruS/oeaBr+eahOS6i+S7tui0n+i9veOAglxuICogQGV4YW1wbGVcbiAqIC8vIOi/meaYr+S4gOS4quWcqOWklumDqOiEmuacrOS4reebkeWQrOatpOS6i+S7tueahOekuuS+i++8mlxuICogZXZlbnRPbignZXJhOndyaXRlRG9uZScsIChkZXRhaWwpID0+IHtcbiAqICAgY29uc3QgeyBtaywgbWVzc2FnZV9pZCwgYWN0aW9ucywgc2VsZWN0ZWRNa3MsIGVkaXRMb2dzLCBzdGF0LCBzdGF0V2l0aG91dE1ldGEgfSA9IGRldGFpbDtcbiAqICAgY29uc29sZS5sb2coYEVSQSDlj5jph4/lt7Lmm7TmlrDvvIHmtojmga8gSUQ6ICR7bWVzc2FnZV9pZH0sIE1LOiAke21rfWApO1xuICogICBjb25zb2xlLmxvZygn5omn6KGM55qE5pON5L2cOicsIGFjdGlvbnMpO1xuICpcbiAqICAgLy8g5L2g5Y+v5Lul5qC55o2u6ZyA6KaB5L2/55SoIHN0YXQgKOW4piBtZXRhKSDmiJYgc3RhdFdpdGhvdXRNZXRhICjkuI3luKYgbWV0YSlcbiAqICAgY29uc29sZS5sb2coJ+acgOaWsOeahOe6r+WHgOeKtuaAgeaVsOaNrjonLCBzdGF0V2l0aG91dE1ldGEpO1xuICpcbiAqICAgLy8g5q2k5pe25Y+v5Lul5qC55o2u5pyA5paw55qE54q25oCB5pWw5o2u5pu05paw5L2g6Ieq5bex55qEIFVJIOaIluaJp+ihjOWFtuS7lumAu+i+kVxuICogfSk7XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbWl0V3JpdGVEb25lRXZlbnQocGF5bG9hZDogV3JpdGVEb25lUGF5bG9hZCkge1xuICAvLyDlnKjlub/mkq3liY3vvIzlr7npnIDopoHmmrTpnLLnu5nlpJbpg6jnmoTmlbDmja7ov5vooYzlj43ovazkuYlcbiAgY29uc3QgdW5lc2NhcGVkUGF5bG9hZCA9IHtcbiAgICAuLi5wYXlsb2FkLFxuICAgIHN0YXQ6IHVuZXNjYXBlRXJhRGF0YShwYXlsb2FkLnN0YXQpLFxuICAgIHN0YXRXaXRob3V0TWV0YTogdW5lc2NhcGVFcmFEYXRhKHBheWxvYWQuc3RhdFdpdGhvdXRNZXRhKSxcbiAgfTtcblxuICBsb2dnZXIuZGVidWcoJ2VtaXRXcml0ZURvbmVFdmVudCcsICd3cml0ZURvbmXkuovku7blub/mkq3mlbDmja7lj43ovazkuYknLCB7XG4gICAgYmVmb3JlOiB7IHN0YXQ6IHBheWxvYWQuc3RhdCwgc3RhdFdpdGhvdXRNZXRhOiBwYXlsb2FkLnN0YXRXaXRob3V0TWV0YSB9LFxuICAgIGFmdGVyOiB7IHN0YXQ6IHVuZXNjYXBlZFBheWxvYWQuc3RhdCwgc3RhdFdpdGhvdXRNZXRhOiB1bmVzY2FwZWRQYXlsb2FkLnN0YXRXaXRob3V0TWV0YSB9LFxuICB9KTtcblxuICBldmVudEVtaXQoRVJBX0VWRU5UX0VNSVRURVIuV1JJVEVfRE9ORSwgdW5lc2NhcGVkUGF5bG9hZCk7XG4gIGxvZ2dlci5sb2coXG4gICAgJ2VtaXRXcml0ZURvbmVFdmVudCcsXG4gICAgYOW3suinpuWPkSAke0VSQV9FVkVOVF9FTUlUVEVSLldSSVRFX0RPTkV9IOS6i+S7tuOAguaTjeS9nDogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHBheWxvYWQuYWN0aW9ucyxcbiAgICApfSwgTUs6ICR7cGF5bG9hZC5ta30sIE1zZ0lEOiAke3BheWxvYWQubWVzc2FnZV9pZH0sIOi/nue7reWkhOeQhuasoeaVsDogJHtwYXlsb2FkLmNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50fWAsXG4gICk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/command.ts\n\n}");
  },
  "./src/ERA变量框架/api/macro/parser.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/api/macro/parser.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseEraMacros: () => (/* binding */ parseEraMacros)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('api-macro-parser');\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseEraMacros(text) {\n    const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{ERA')) {\n        return text;\n    }\n    // 获取 stat_data\n    const { stat } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.getEraData)();\n    if (!stat) {\n        logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n        // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n        return text;\n    }\n    return text.replace(macroRegex, (substring, withMeta, path) => {\n        const funcName = 'parseEraMacros';\n        const trimmedPath = path.trim();\n        const includeMeta = !!withMeta;\n        let data;\n        if (trimmedPath === '$ALLDATA') {\n            data = stat;\n        }\n        else {\n            data = _.get(stat, trimmedPath);\n        }\n        if (data === undefined) {\n            logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n            return ''; // 路径未找到, 返回空字符串\n        }\n        // 根据 withMeta 标志决定是否移除 $meta 字段\n        const dataBeforeUnescape = includeMeta ? data : (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.removeMetaFields)(data);\n        // 在返回数据前进行反转义\n        const finalData = (0,_utils_data__WEBPACK_IMPORTED_MODULE_1__.unescapeEraData)(dataBeforeUnescape);\n        logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n            before: dataBeforeUnescape,\n            after: finalData,\n        });\n        // 如果是对象或数组, 转换为 JSON 字符串\n        if (typeof finalData === 'object' && finalData !== null) {\n            return JSON.stringify(finalData);\n        }\n        // 如果是原始类型, 直接转换为字符串\n        return String(finalData);\n    });\n}\n$(() => {\n    /**\n     * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n     *\n     * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n     *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n     * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n     *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n     */\n    registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n        // 直接复用 parseEraMacros 函数的逻辑。\n        // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n        return parseEraMacros(substring);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXJzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFvRTtBQUNqQjtBQUNWO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBRTlDOzs7OztHQUtHO0FBQ0ksU0FBUyxjQUFjLENBQUMsSUFBWTtJQUN6QyxNQUFNLFVBQVUsR0FBRyw0Q0FBNEMsQ0FBQztJQUVoRSw0QkFBNEI7SUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUM1QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxlQUFlO0lBQ2YsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLDJEQUFVLEVBQUUsQ0FBQztJQUM5QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDVixNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFDekQsb0NBQW9DO1FBQ3BDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQzVELE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDO1FBQ2xDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNoQyxNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBRS9CLElBQUksSUFBSSxDQUFDO1FBQ1QsSUFBSSxXQUFXLEtBQUssVUFBVSxFQUFFLENBQUM7WUFDL0IsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNkLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSx1QkFBdUIsV0FBVyxlQUFlLENBQUMsQ0FBQztZQUN6RSxPQUFPLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQjtRQUM3QixDQUFDO1FBRUQsZ0NBQWdDO1FBQ2hDLE1BQU0sa0JBQWtCLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGlFQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZFLGNBQWM7UUFDZCxNQUFNLFNBQVMsR0FBRyw0REFBZSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFdEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLFdBQVcsRUFBRSxFQUFFO1lBQ3pELE1BQU0sRUFBRSxrQkFBa0I7WUFDMUIsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQyxDQUFDO1FBRUgseUJBQXlCO1FBQ3pCLElBQUksT0FBTyxTQUFTLEtBQUssUUFBUSxJQUFJLFNBQVMsS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUN4RCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELG9CQUFvQjtRQUNwQixPQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMzQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxDQUFDLENBQUMsR0FBRyxFQUFFO0lBQ0w7Ozs7Ozs7T0FPRztJQUNILGlCQUFpQixDQUFDLDRDQUE0QyxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFDckcsNkJBQTZCO1FBQzdCLG9EQUFvRDtRQUNwRCxPQUFPLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNuQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvYXBpL21hY3JvL3BhcnNlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRFcmFEYXRhLCByZW1vdmVNZXRhRmllbGRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgdW5lc2NhcGVFcmFEYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdhcGktbWFjcm8tcGFyc2VyJyk7XG5cbi8qKlxuICog6Kej5p6Q5a2X56ym5Liy5Lit55qEIEVSQSDlro8sIOW5tuWwhuWFtuabv+aNouS4uuWvueW6lOeahOWPmOmHj+WAvOOAglxuICog6L+Z5piv5o+Q5L6b57uZ5YW25LuW5qih5Z2X6LCD55So55qE5YWs5YWx5o6l5Y+j44CCXG4gKiBAcGFyYW0gdGV4dCAtIOWMheWQq+Wuj+eahOi+k+WFpeWtl+espuS4suOAglxuICogQHJldHVybnMgLSDmm7/mjaLlro/lkI7nmoTlrZfnrKbkuLLjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRXJhTWFjcm9zKHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IG1hY3JvUmVnZXggPSAve3tcXHMqRVJBKC13aXRobWV0YSk/XFxzKjpcXHMqKFtefV0rPylcXHMqfX0vZ2k7XG5cbiAgLy8g5aaC5p6c5paH5pys5Lit5LiN5YyF5ZCr5a6P54m55b6B5a2X56ym5LiyLCDnm7TmjqXov5Tlm57ku6XkvJjljJbmgKfog71cbiAgaWYgKCF0ZXh0LmluY2x1ZGVzKCd7e0VSQScpKSB7XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICAvLyDojrflj5Ygc3RhdF9kYXRhXG4gIGNvbnN0IHsgc3RhdCB9ID0gZ2V0RXJhRGF0YSgpO1xuICBpZiAoIXN0YXQpIHtcbiAgICBsb2dnZXIud2FybigncGFyc2VFcmFNYWNyb3MnLCAn5peg5rOV6I635Y+W5YiwIHN0YXRfZGF0YSwg5a6P5pu/5o2i5aSx6LSlLicpO1xuICAgIC8vIOWmguaenOayoeaciSBzdGF0X2RhdGEsIOS7u+S9leWuj+mDveaXoOazleino+aekCwg55u05o6l6L+U5Zue5Y6f5paH5pysXG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICByZXR1cm4gdGV4dC5yZXBsYWNlKG1hY3JvUmVnZXgsIChzdWJzdHJpbmcsIHdpdGhNZXRhLCBwYXRoKSA9PiB7XG4gICAgY29uc3QgZnVuY05hbWUgPSAncGFyc2VFcmFNYWNyb3MnO1xuICAgIGNvbnN0IHRyaW1tZWRQYXRoID0gcGF0aC50cmltKCk7XG4gICAgY29uc3QgaW5jbHVkZU1ldGEgPSAhIXdpdGhNZXRhO1xuXG4gICAgbGV0IGRhdGE7XG4gICAgaWYgKHRyaW1tZWRQYXRoID09PSAnJEFMTERBVEEnKSB7XG4gICAgICBkYXRhID0gc3RhdDtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YSA9IF8uZ2V0KHN0YXQsIHRyaW1tZWRQYXRoKTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsb2dnZXIud2FybihmdW5jTmFtZSwgYOWcqCBzdGF0X2RhdGEg5Lit5pyq5om+5Yiw6Lev5b6EIFwiJHt0cmltbWVkUGF0aH1cIiwg5a6P5bCG5pu/5o2i5Li656m65a2X56ym5LiyLmApO1xuICAgICAgcmV0dXJuICcnOyAvLyDot6/lvoTmnKrmib7liLAsIOi/lOWbnuepuuWtl+espuS4slxuICAgIH1cblxuICAgIC8vIOagueaNriB3aXRoTWV0YSDmoIflv5flhrPlrprmmK/lkKbnp7vpmaQgJG1ldGEg5a2X5q61XG4gICAgY29uc3QgZGF0YUJlZm9yZVVuZXNjYXBlID0gaW5jbHVkZU1ldGEgPyBkYXRhIDogcmVtb3ZlTWV0YUZpZWxkcyhkYXRhKTtcblxuICAgIC8vIOWcqOi/lOWbnuaVsOaNruWJjei/m+ihjOWPjei9rOS5iVxuICAgIGNvbnN0IGZpbmFsRGF0YSA9IHVuZXNjYXBlRXJhRGF0YShkYXRhQmVmb3JlVW5lc2NhcGUpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdwYXJzZUVyYU1hY3JvcycsIGDlro/mm7/mjaLmlbDmja7lj43ovazkuYk6ICR7dHJpbW1lZFBhdGh9YCwge1xuICAgICAgYmVmb3JlOiBkYXRhQmVmb3JlVW5lc2NhcGUsXG4gICAgICBhZnRlcjogZmluYWxEYXRhLFxuICAgIH0pO1xuXG4gICAgLy8g5aaC5p6c5piv5a+56LGh5oiW5pWw57uELCDovazmjaLkuLogSlNPTiDlrZfnrKbkuLJcbiAgICBpZiAodHlwZW9mIGZpbmFsRGF0YSA9PT0gJ29iamVjdCcgJiYgZmluYWxEYXRhICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZmluYWxEYXRhKTtcbiAgICB9XG5cbiAgICAvLyDlpoLmnpzmmK/ljp/lp4vnsbvlnossIOebtOaOpei9rOaNouS4uuWtl+espuS4slxuICAgIHJldHVybiBTdHJpbmcoZmluYWxEYXRhKTtcbiAgfSk7XG59XG5cbiQoKCkgPT4ge1xuICAvKipcbiAgICog5rOo5YaMIEVSQSDlro8sIOeUqOS6juWcqOWPkemAgee7mSBBSSDnmoTmtojmga/kuK3mn6Xor6LlvZPliY3ogYrlpKnnmoTlj5jph4/mlbDmja5cbiAgICpcbiAgICogLSBge3tFUkE6cGF0aC50by5kYXRhfX1gOiDmn6Xor6Llubbmm7/mjaLkuLoqKuS4jeWQqyoqIGAkbWV0YWAg55qE57qv5YeA5pWw5o2u44CCXG4gICAqICAgLSBge3tFUkE6JEFMTERBVEF9fWAg5bCG6L+U5Zue5pW05Liq56e76ZmkIGAkbWV0YWAg5ZCO55qEIGBzdGF0X2RhdGFgIOWvueixoeOAglxuICAgKiAtIGB7e0VSQS13aXRobWV0YTpwYXRoLnRvLmRhdGF9fWA6IOafpeivouW5tuabv+aNouS4uioq5YyF5ZCrKiogYCRtZXRhYCDnmoTljp/lp4vmlbDmja7jgIJcbiAgICogICAtIGB7e0VSQS13aXRobWV0YTokQUxMREFUQX19YCDlsIbov5Tlm57lrozmlbTnmoQgYHN0YXRfZGF0YWAg5a+56LGh44CCXG4gICAqL1xuICByZWdpc3Rlck1hY3JvTGlrZSgve3tcXHMqRVJBKC13aXRobWV0YSk/XFxzKjpcXHMqKFtefV0rPylcXHMqfX0vZ2ksIChjb250ZXh0LCBzdWJzdHJpbmcsIHdpdGhNZXRhLCBwYXRoKSA9PiB7XG4gICAgLy8g55u05o6l5aSN55SoIHBhcnNlRXJhTWFjcm9zIOWHveaVsOeahOmAu+i+keOAglxuICAgIC8vIHN1YnN0cmluZyDlj4LmlbDmmK/ljLnphY3liLDnmoTlrozmlbTlro/lrZfnrKbkuLIsIOWmgiBcInt7RVJBOnBhdGgudG8uZGF0YX19XCJcbiAgICByZXR1cm4gcGFyc2VFcmFNYWNyb3Moc3Vic3RyaW5nKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/macro/parser.ts\n\n}");
  },
  "./src/ERA变量框架/api/macro/patch.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/api/macro/patch.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceRenderRecentMessages: () => (/* binding */ forceRenderRecentMessages)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换。\n */\n\n\nconst log = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('api-macro-patch');\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\nfunction forceRenderMessage(messageId) {\n    return new Promise(resolve => {\n        const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n        const $message = $(messageSelector);\n        // 模拟点击“编辑”\n        $message.find('.mes_button.mes_edit').trigger('click');\n        // 给予UI响应时间, 然后模拟点击“确认”\n        setTimeout(() => {\n            $message.find('.mes_edit_done.menu_button').trigger('click');\n            resolve();\n        }, 50);\n    });\n}\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nasync function forceRenderRecentMessages() {\n    const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n    // 检查是否启用了强制重载功能\n    const forceReload = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载功能', false);\n    if (!forceReload) {\n        log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n        return; // 如果未启用，则不执行任何操作\n    }\n    // 获取要重载的消息数量，默认为1\n    const messageCount = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载消息数', 1);\n    log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n    // 等待一小段时间, 确保变量更新已经完成\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const allMessages = getChatMessages('0-{{lastMessageId}}');\n    if (!allMessages || allMessages.length === 0) {\n        log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n        return;\n    }\n    // 根据脚本变量设置的数量来截取最近的消息\n    const recentMessages = allMessages.slice(-messageCount);\n    for (const message of recentMessages) {\n        log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n        await forceRenderMessage(message.message_id);\n        // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXRjaC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7OztHQUdHO0FBRW9CO0FBQ2tCO0FBRXpDLE1BQU0sR0FBRyxHQUFHLElBQUksOENBQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBRTFDOzs7O0dBSUc7QUFDSCxTQUFTLGtCQUFrQixDQUFDLFNBQWlCO0lBQzNDLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDM0IsTUFBTSxlQUFlLEdBQUcsa0JBQWtCLFNBQVMsSUFBSSxDQUFDO1FBQ3hELE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUVwQyxXQUFXO1FBQ1gsUUFBUSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV2RCx1QkFBdUI7UUFDdkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLFFBQVEsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0QsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxLQUFLLFVBQVUseUJBQXlCO0lBQzdDLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUU5RSxnQkFBZ0I7SUFDaEIsTUFBTSxXQUFXLEdBQUcsaURBQUssQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3ZELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNqQixHQUFHLENBQUMsS0FBSyxDQUFDLDJCQUEyQixFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDekQsT0FBTyxDQUFDLGlCQUFpQjtJQUMzQixDQUFDO0lBRUQsa0JBQWtCO0lBQ2xCLE1BQU0sWUFBWSxHQUFHLGlEQUFLLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNyRCxHQUFHLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLGVBQWUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUVwRSxzQkFBc0I7SUFDdEIsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUV4RCxNQUFNLFdBQVcsR0FBRyxlQUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMzRCxJQUFJLENBQUMsV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDN0MsR0FBRyxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQzFELE9BQU87SUFDVCxDQUFDO0lBRUQsc0JBQXNCO0lBQ3RCLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUV4RCxLQUFLLE1BQU0sT0FBTyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsYUFBYSxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3Qyw2QkFBNkI7UUFDN0IsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsR0FBRyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsRCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvYXBpL21hY3JvL3BhdGNoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUg5by65Yi25a6P5riy5p+T5qih5Z2XXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5qih5ouf55So5oi3VUnmk43kvZwsIOW8uuWItumFkummhumHjeaWsOa4suafk+a2iOaBrywg5Lul6Kem5Y+R5a6M5pW055qE5a6P5pu/5o2i44CCXG4gKi9cblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ2FwaS1tYWNyby1wYXRjaCcpO1xuXG4vKipcbiAqIOW8uuWItumHjeaWsOa4suafk+WNleadoea2iOaBr+OAglxuICogQHBhcmFtIG1lc3NhZ2VJZCDopoHlvLrliLbmuLLmn5PnmoTmtojmga9JROOAglxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaooeaLn+eCueWHu+WujOaIkOWQjiByZXNvbHZl44CCXG4gKi9cbmZ1bmN0aW9uIGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlSWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZVNlbGVjdG9yID0gYGRpdi5tZXNbbWVzaWQ9XCIke21lc3NhZ2VJZH1cIl1gO1xuICAgIGNvbnN0ICRtZXNzYWdlID0gJChtZXNzYWdlU2VsZWN0b3IpO1xuXG4gICAgLy8g5qih5ouf54K55Ye74oCc57yW6L6R4oCdXG4gICAgJG1lc3NhZ2UuZmluZCgnLm1lc19idXR0b24ubWVzX2VkaXQnKS50cmlnZ2VyKCdjbGljaycpO1xuXG4gICAgLy8g57uZ5LqIVUnlk43lupTml7bpl7QsIOeEtuWQjuaooeaLn+eCueWHu+KAnOehruiupOKAnVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgJG1lc3NhZ2UuZmluZCgnLm1lc19lZGl0X2RvbmUubWVudV9idXR0b24nKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0sIDUwKTtcbiAgfSk7XG59XG5cbi8qKlxuICog5by65Yi26YeN5paw5riy5p+T5pyA6L+R55qETuadoea2iOaBrywg5Lul56Gu5L+d5a6P6KKr5q2j56Gu5pu/5o2i44CCXG4gKiDmmK/lkKbmiafooYzku6Xlj4rmuLLmn5PnmoTmlbDph4/nlLHohJrmnKzlj5jph4/mjqfliLbjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKSB7XG4gIGNvbnN0IHNjcmlwdFZhcnMgPSBnZXRWYXJpYWJsZXMoeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0pO1xuXG4gIC8vIOajgOafpeaYr+WQpuWQr+eUqOS6huW8uuWItumHjei9veWKn+iDvVxuICBjb25zdCBmb3JjZVJlbG9hZCA9IF8uZ2V0KHNjcmlwdFZhcnMsICflvLrliLbph43ovb3lip/og70nLCBmYWxzZSk7XG4gIGlmICghZm9yY2VSZWxvYWQpIHtcbiAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295Yqf6IO95pyq5ZCv55SoLCDot7Pov4fjgIInKTtcbiAgICByZXR1cm47IC8vIOWmguaenOacquWQr+eUqO+8jOWImeS4jeaJp+ihjOS7u+S9leaTjeS9nFxuICB9XG5cbiAgLy8g6I635Y+W6KaB6YeN6L2955qE5raI5oGv5pWw6YeP77yM6buY6K6k5Li6MVxuICBjb25zdCBtZXNzYWdlQ291bnQgPSBfLmdldChzY3JpcHRWYXJzLCAn5by65Yi26YeN6L295raI5oGv5pWwJywgMSk7XG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCBg5byA5aeL5by65Yi26YeN6L29LCDmlbDph486ICR7bWVzc2FnZUNvdW50fWApO1xuXG4gIC8vIOetieW+heS4gOWwj+auteaXtumXtCwg56Gu5L+d5Y+Y6YeP5pu05paw5bey57uP5a6M5oiQXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG5cbiAgY29uc3QgYWxsTWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nKTtcbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2cud2FybignZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICfml6Dms5Xojrflj5bliLDku7vkvZXmtojmga8sIOe7iOatoumHjei9veOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOagueaNruiEmuacrOWPmOmHj+iuvue9rueahOaVsOmHj+adpeaIquWPluacgOi/keeahOa2iOaBr1xuICBjb25zdCByZWNlbnRNZXNzYWdlcyA9IGFsbE1lc3NhZ2VzLnNsaWNlKC1tZXNzYWdlQ291bnQpO1xuXG4gIGZvciAoY29uc3QgbWVzc2FnZSBvZiByZWNlbnRNZXNzYWdlcykge1xuICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsIGDmraPlnKjlvLrliLbmuLLmn5Pmtojmga86ICR7bWVzc2FnZS5tZXNzYWdlX2lkfWApO1xuICAgIGF3YWl0IGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlLm1lc3NhZ2VfaWQpO1xuICAgIC8vIOWcqOavj+asoeaTjeS9nOS5i+mXtOefreaaguaaguWBnCwg6YG/5YWN5pON5L2c6L+H5b+r5a+86Ie0VUnpl67popjjgIJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gIH1cbiAgbG9nLmxvZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICflvLrliLbph43ovb3lrozmiJDjgIInKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/macro/patch.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/delete.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/delete.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processDeleteBlocks: () => (/* binding */ processDeleteBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('core-crud-delete');\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData, basePath, patchObj, editLog) {\n    // --- 1. 入口守卫和状态获取 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n    // 精确判断豁免条件\n    const metaPatch = _.get(patchObj, '$meta');\n    const isBypassingProtection = \n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n        // 场景2: 指令明确要删除 $meta.necessary 键\n        _.has(patchObj, ['$meta', 'necessary']);\n    // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n    if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n        // **意图：递归删除子节点**\n        // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n        if (necessary === 'all' && !isBypassingProtection) {\n            logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`);\n            return;\n        }\n        // 权限通过，或存在豁免，继续向内递归。\n        for (const key of Object.keys(patchObj)) {\n            const fullPath = basePath ? `${basePath}.${key}` : key;\n            const subPatchObj = patchObj[key];\n            applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n        }\n        return; // 子节点处理完毕，返回。\n    }\n    // --- 3. 执行删除当前节点 ---\n    // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n    // **意图：删除当前节点 `basePath`**\n    // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n    // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n    if (necessary === 'self' || necessary === 'all') {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`);\n        return;\n    }\n    // 根节点（basePath 为 ''）不应被删除。\n    if (basePath === '') {\n        logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。');\n        return;\n    }\n    // 执行原子性删除\n    const valOld = _.cloneDeep(currentNodeInVars);\n    _.unset(statData, basePath);\n    editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n    logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n/**\n * 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processDeleteBlocks(allDeletes, editLog) {\n    if (allDeletes.length > 0) {\n        for (const deleteRoot of allDeletes) {\n            if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.updateEraStatData)(stat => {\n                    logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n                    // 从根路径开始递归\n                    applyDeleteAtLevel(stat, '', deleteRoot, editLog);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processDeleteBlocks', '所有 VariableDelete 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7R0FVRztBQUNVO0FBRTRDO0FBQ2hCO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBRTlDOzs7Ozs7OztHQVFHO0FBQ0gsU0FBUyxrQkFBa0IsQ0FBQyxRQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFhLEVBQUUsT0FBYztJQUN4Rix1QkFBdUI7SUFDdkIsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFFMUUsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLDhCQUE4QixRQUFRLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQztRQUN4RixPQUFPO0lBQ1QsQ0FBQztJQUVELE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUVuRSxXQUFXO0lBQ1gsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0MsTUFBTSxxQkFBcUI7SUFDekIsd0JBQXdCO0lBQ3hCLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELGlDQUFpQztRQUNqQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBRTFDLG9DQUFvQztJQUNwQyxJQUFJLENBQUMsQ0FBQyxhQUFh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RUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Y+Y6YeP5Yig6Zmk5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+i0n+i0o+WkhOeQhiBgPFZhcmlhYmxlRGVsZXRlPmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5Yig6Zmk77yM5bm255Sf5oiQ55u45bqU55qEIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq5oyH5Luk6amx5YqoKio6IOmAkuW9kuihjOS4uueUseaMh+S7pOWvueixoeeahOe7k+aehOmpseWKqOOAguepuuWvueixoSBge31gIOihqOekuuWIoOmZpOW9k+WJjeiKgueCue+8jOmdnuepuuWvueixoeihqOekuumAkuW9kuWIoOmZpOWtkOiKgueCueOAglxuICogLSAqKuWuieWFqOesrOS4gCoqOiDliKDpmaTmmK/noLTlnY/mgKfmk43kvZzvvIzlm6DmraTlvJXlhaXkuoYgYCRtZXRhLm5lY2Vzc2FyeWAg5p2D6ZmQ5py65Yi25p2l6Ziy5q2i6K+v5Yig44CCXG4gKiAtICoq57K+56Gu6LGB5YWNKio6IGBuZWNlc3NhcnlgIOeahOS/neaKpOWPquacieWcqOWIoOmZpOaMh+S7pOaYjuehruaMh+WQkSBgbmVjZXNzYXJ5YCDlsZ7mgKfoh6rouqvml7bmiY3kvJrooqvnu5Xov4fjgIJcbiAqIC0gKirljp/lrZDmgKfml6Xlv5cqKjog5Li65q+P5LiA5qyh5Yig6Zmk55Sf5oiQ5Y2V5LiA44CB57K+56Gu55qEIGBFZGl0TG9nYO+8jOehruS/neaTjeS9nOWPr+WujOWFqOWbnua7muOAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1jcnVkLWRlbGV0ZScpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5Yig6Zmk44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlRGVsZXRlPmAg55qE5qC45b+D6YC76L6R77yM5YW26KGM5Li655Sx5oyH5LukIGBwYXRjaE9iamAg55qE57uT5p6E6amx5Yqo44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeS4jiBgYmFzZVBhdGhgIOWvueW6lOeahOmDqOWIhuOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5mdW5jdGlvbiBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdERhdGE6IGFueSwgYmFzZVBhdGg6IHN0cmluZywgcGF0Y2hPYmo6IGFueSwgZWRpdExvZzogYW55W10pIHtcbiAgLy8gLS0tIDEuIOWFpeWPo+WuiOWNq+WSjOeKtuaAgeiOt+WPliAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcblxuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseURlbGV0ZUF0TGV2ZWwnLCBgVmFyaWFibGVEZWxldGUg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbmVjZXNzYXJ5ID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAnbmVjZXNzYXJ5J10pO1xuXG4gIC8vIOeyvuehruWIpOaWreixgeWFjeadoeS7tlxuICBjb25zdCBtZXRhUGF0Y2ggPSBfLmdldChwYXRjaE9iaiwgJyRtZXRhJyk7XG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgLy8g5Zy65pmvMTog5oyH5Luk6KaB5Yig6Zmk5pW05LiqICRtZXRhIOWvueixoVxuICAgIChfLmlzUGxhaW5PYmplY3QobWV0YVBhdGNoKSAmJiBfLmlzRW1wdHkobWV0YVBhdGNoKSkgfHxcbiAgICAvLyDlnLrmma8yOiDmjIfku6TmmI7noa7opoHliKDpmaQgJG1ldGEubmVjZXNzYXJ5IOmUrlxuICAgIF8uaGFzKHBhdGNoT2JqLCBbJyRtZXRhJywgJ25lY2Vzc2FyeSddKTtcblxuICAvLyAtLS0gMi4g5Yik5pat5oSP5Zu+77ya6YCS5b2S5Yig6Zmk5a2Q6IqC54K5IHZzIOWIoOmZpOW9k+WJjeiKgueCuSAtLS1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikgJiYgIV8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICAvLyAqKuaEj+Wbvu+8mumAkuW9kuWIoOmZpOWtkOiKgueCuSoqXG5cbiAgICAvLyDmnYPpmZDmo4Dmn6XvvJrlpoLmnpzoioLngrnlj5cgJ2FsbCcg5L+d5oqk77yM5LiU5oyH5Luk5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ56aB5q2i5rex5YWl44CCXG4gICAgaWYgKG5lY2Vzc2FyeSA9PT0gJ2FsbCcgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICdhcHBseURlbGV0ZUF0TGV2ZWwnLFxuICAgICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiBhbGxcIiDkv53miqTvvIzlhbblrZDoioLngrnml6Dms5XooqvliKDpmaTjgIJgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDmnYPpmZDpgJrov4fvvIzmiJblrZjlnKjosYHlhY3vvIznu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoT2JqID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIGFwcGx5RGVsZXRlQXRMZXZlbChzdGF0RGF0YSwgZnVsbFBhdGgsIHN1YlBhdGNoT2JqLCBlZGl0TG9nKTtcbiAgICB9XG4gICAgcmV0dXJuOyAvLyDlrZDoioLngrnlpITnkIblrozmr5XvvIzov5Tlm57jgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDmiafooYzliKDpmaTlvZPliY3oioLngrkgLS0tXG4gIC8vICjog73otbDliLDov5nph4zvvIzor7TmmI4gcGF0Y2hPYmog5piv56m65a+56LGh44CB6Z2e5a+56LGh5oiWIG51bGwpXG4gIC8vICoq5oSP5Zu+77ya5Yig6Zmk5b2T5YmN6IqC54K5IGBiYXNlUGF0aGAqKlxuXG4gIC8vIOadg+mZkOajgOafpe+8midzZWxmJyDmiJYgJ2FsbCcg6YO95Lya6Zi75q2i5b2T5YmN6IqC54K555qE55u05o6l5Yig6Zmk44CCXG4gIC8vIOebtOaOpeWIoOmZpOiKgueCueeahOaEj+WbvuaXoOazleixgeWFjeS/neaKpO+8jOW/hemhu+mAmui/h+mAkuW9kuaEj+WbvuWIoOmZpCAnJG1ldGEnIOadpeino+mZpOS/neaKpOOAglxuICBpZiAobmVjZXNzYXJ5ID09PSAnc2VsZicgfHwgbmVjZXNzYXJ5ID09PSAnYWxsJykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RGVsZXRlQXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiAke25lY2Vzc2FyeX1cIiDkv53miqTvvIzml6Dms5Xooqvnm7TmjqXliKDpmaTjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g5qC56IqC54K577yIYmFzZVBhdGgg5Li6ICcn77yJ5LiN5bqU6KKr5Yig6Zmk44CCXG4gIGlmIChiYXNlUGF0aCA9PT0gJycpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsICdWYXJpYWJsZURlbGV0ZSDlpLHotKXvvJrkuI3lhYHorrjliKDpmaTmoLnlr7nosaHjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmiafooYzljp/lrZDmgKfliKDpmaRcbiAgY29uc3QgdmFsT2xkID0gXy5jbG9uZURlZXAoY3VycmVudE5vZGVJblZhcnMpO1xuICBfLnVuc2V0KHN0YXREYXRhLCBiYXNlUGF0aCk7XG4gIGVkaXRMb2cucHVzaCh7IG9wOiAnZGVsZXRlJywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX29sZDogdmFsT2xkIH0pO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsIGDmiJDlip/liKDpmaToioLngrk6ICR7YmFzZVBhdGh9YCk7XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVEZWxldGU+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxEZWxldGVzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGRlbGV0ZSDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlczogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxEZWxldGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IGRlbGV0ZVJvb3Qgb2YgYWxsRGVsZXRlcykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZGVsZXRlUm9vdCkgfHwgXy5pc0VtcHR5KGRlbGV0ZVJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsIGDlpITnkIYgZGVsZXRlUm9vdDogJHtKU09OLnN0cmluZ2lmeShkZWxldGVSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoTlvIDlp4vpgJLlvZJcbiAgICAgICAgICBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdCwgJycsIGRlbGV0ZVJvb3QsIGVkaXRMb2cpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NEZWxldGVCbG9ja3MnLCBg5aSE55CGIGRlbGV0ZVJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVEZWxldGUg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/delete.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/insert.ts": 
  /*!************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/insert.ts ***!
  \************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyInsertAtLevel: () => (/* binding */ applyInsertAtLevel),\n/* harmony export */   processInsertBlocks: () => (/* binding */ processInsertBlocks)\n/* harmony export */ });\n/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./template */ \"./src/ERA变量框架/core/crud/insert/template.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('core-crud-insert-insert');\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nfunction applyInsertAtLevel(statData, basePath, patchObj, editLog, inheritedContent, parentData) {\n    // --- 1. 确定当前层级的模板内容 ---\n    // 调用 resolveTemplate，它现在直接使用传入的 parentData\n    const localTplContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.resolveTemplate)(inheritedContent, parentData);\n    logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n        statData: _.cloneDeep(statData),\n    });\n    // --- 2. 检查路径存在性，决定执行策略 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    logger.debug('applyInsertAtLevel', `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`, currentNodeInVars);\n    // **策略一：原子性插入 (Atomic Insert)**\n    // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n    if (basePath && currentNodeInVars === undefined) {\n        // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n        const composed = (0,_template__WEBPACK_IMPORTED_MODULE_0__.applyTemplateToPatch)(localTplContent, patchObj);\n        const finalValue = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(composed); // 清理数组中的 null 等无效值。\n        logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n        _.set(statData, basePath, finalValue); // 执行插入。\n        editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n        logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n        return; // 插入完成，终止递归。\n    }\n    // **策略二：递归补充 (Recursive Supplement)**\n    // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n    if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n        logger.debug('applyInsertAtLevel', `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`);\n        for (const key of Object.keys(patchObj)) {\n            const subPath = basePath ? `${basePath}.${key}` : key;\n            const subPatch = patchObj[key];\n            // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n            const subInheritedContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.getInheritedTemplateContent)(localTplContent, key);\n            logger.debug('applyInsertAtLevel', `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`);\n            // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n            applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n        }\n    }\n    else if (basePath) {\n        // **插入失败**\n        // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n        // 则记录警告。insert 不会覆盖已存在的值。\n        logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`);\n    }\n    // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n/**\n * 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processInsertBlocks(allInserts, editLog) {\n    if (allInserts.length > 0) {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n            logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(stat));\n            return stat;\n        });\n        /*\n         * N.B. 必须对每个 insertRoot 单独调用 updateVariablesWith，而不是将所有操作合并到一次调用中。\n         * 这是为了确保在同一条消息内，前一个 <VariableInsert> 块中插入的模板或数据，\n         * 可以被后一个 <VariableInsert> 或 <VariableEdit> 块访问和使用。\n         * 每次 await updateVariablesWith 完成后，变量状态都会被刷新，从而使后续操作能看到最新的结果。\n         */\n        for (const insertRoot of allInserts) {\n            if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(stat => {\n                    logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n                    applyInsertAtLevel(stat, '', insertRoot, editLog, null, null);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processInsertBlocks', '所有 VariableInsert 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ1U7QUFFbUY7QUFDcEM7QUFDUDtBQUNUO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBRXJEOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUNJLFNBQVMsa0JBQWtCLENBQ2hDLFFBQWEsRUFDYixRQUFnQixFQUNoQixRQUFhLEVBQ2IsT0FBYyxFQUNkLGdCQUFxQixFQUNyQixVQUFlO0lBRWYseUJBQXlCO0lBQ3pCLDJDQUEyQztJQUMzQyxNQUFNLGVBQWUsR0FBRywwREFBZSxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ3RFLE1BQU0sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsbUJBQW1CLFFBQVEsSUFBSSxNQUFNLEdBQUcsRUFBRTtRQUMzRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7S0FDaEMsQ0FBQyxDQUFDO0lBRUgsNEJBQTRCO0lBQzVCLE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQzFFLE1BQU0sQ0FBQyxLQUFLLENBQ1Ysb0JBQW9CLEVBQ3BCLG9CQUFvQixRQUFRLElBQUksTUFBTSwwQkFBMEIsRUFDaEUsaUJBQWlCLENBQ2xCLENBQUM7SUFFRixnQ0FBZ0M7SUFDaEMsbUNBQW1DO0lBQ25DLElBQUksUUFBUSxJQUFJLGlCQUFpQixLQUFLLFNBQVMsRUFBRSxDQUFDO1FBQ2hELDZDQUE2QztRQUM3QyxNQUFNLFFBQVEsR0FBRywrREFBb0IsQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFakUsTUFBTSxVQUFVLEdBQUcsMkRB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QUFJLENBQUMsRUFBRTtvQkFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQ3BGLG1DQUFtQztvQkFDbkMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDOUQsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+aPkuWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfotJ/otKPlpITnkIYgYDxWYXJpYWJsZUluc2VydD5gIOaMh+S7pO+8jOWunueOsOWPmOmHj+eahOmdnuegtOWdj+aAp+aPkuWFpe+8jOW5tueUn+aIkOebuOW6lOeahCBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuiBjOi0o+WNleS4gCoqOiDmqKHlnZflj6rlhbPlv4PlpoLkvZXmoLnmja7mjIfku6Tkv67mlLnlj5jph4/nirbmgIHlubbnlJ/miJDml6Xlv5fvvIzkuI3lhbPlv4PmjIfku6Tku47kvZXogIzmnaXjgIJcbiAqIC0gKirljp/lrZDmgKfmk43kvZwqKjogYGFwcGx5SW5zZXJ0QXRMZXZlbGAg5a6e546w5LqG5Y6f5a2Q5oCn55qE5o+S5YWl77yM56Gu5L+d5LqG5pWw5o2u57uT5p6E55qE5a6M5pW05oCn44CCXG4gKiAgIOWmguaenOS4gOS4quWfuuehgOi3r+W+hOS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4quWvueixoeS9nOS4uuS4gOaVtOS4quWNleWFg+S4gOasoeaAp+aPkuWFpeOAglxuICogLSAqKuWuuemUmeaApyoqOiDlvZPpgYfliLDml6DmlYjot6/lvoTvvIjlpoLlsJ3or5XlkJHlt7LlrZjlnKjnmoTot6/lvoTmj5LlhaXvvInml7bvvIzkvJrot7Pov4for6XmnaHmjIfku6Tlubbnu6fnu63lpITnkIblhbbku5bmnInmlYjmjIfku6TvvIxcbiAqICAg6ICM5LiN5piv5Lit5pat5pW05Liq5YaZ5YWl6L+H56iL44CCXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgYXBwbHlUZW1wbGF0ZVRvUGF0Y2gsIGdldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCwgcmVzb2x2ZVRlbXBsYXRlIH0gZnJvbSAnLi90ZW1wbGF0ZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHNhbml0aXplQXJyYXlzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdjb3JlLWNydWQtaW5zZXJ0LWluc2VydCcpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5o+S5YWl44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlSW5zZXJ0PmAg55qE5qC45b+D6YC76L6R77yaKirpnZ7noLTlnY/mgKflnLAqKumAkuW9kuaPkuWFpeWAvOOAglxuICpcbiAqICoq5qC45b+D6KeE5YiZKio6XG4gKiAxLiAqKuWPquWcqOi3r+W+hOS4jeWtmOWcqOaXtuWGmeWFpSoq44CC5aaC5p6c6Lev5b6E5bey5a2Y5Zyo77yM5YiZ6Lez6L+H6K+l6Lev5b6E55qE5YaZ5YWl44CCXG4gKiAyLiAqKuWOn+WtkOaAp+aPkuWFpSoq44CC5aaC5p6c5LiA5Liq5Z+656GA6Lev5b6E77yI5aaCIGBwbGF5ZXIuaW52ZW50b3J5YO+8ieS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4qiBgaW52ZW50b3J5YFxuICogICAg5a+56LGh5L2c5Li65LiA5pW05Liq5Y2V5YWD5LiA5qyh5oCn5o+S5YWl77yM5bm25Y+q6K6w5b2V5LiA5p2hIGBpbnNlcnRgIOaXpeW/l+OAglxuICogMy4gKirpgJLlvZLooaXlhYUqKuOAguWmguaenOWfuuehgOi3r+W+hOW3suWtmOWcqO+8jOWug+S8mumAkuW9kuWcsOa3seWFpe+8jOWwneivleWcqOWFtuS4i+ihpeWFheaPkuWFpeaWsOeahOWtkOi3r+W+hOOAglxuICogNC4gKirmqKHmnb/mlK/mjIEqKuOAguaUr+aMgeS7jiBgJHRlbXBsYXRlYCDkuK3nu6fmib/mqKHmnb/vvIzlrp7njrDmlbDmja7nu5PmnoTnmoTlpI3nlKjjgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g5LuO5oyH5Luk5Lit6Kej5p6Q5Ye655qE44CB6KaB5bqU55So5LqO5b2T5YmN5bGC57qn55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE77yI5byV55So5Lyg6YCS77yJ44CCXG4gKiBAcGFyYW0ge2FueX0gaW5oZXJpdGVkQ29udGVudCAtIOS7juS4iuWxgue7p+aJv+eahOOAgee6r+eyueeahOaooeadv+KAnOWGheWuueKAneWvueixoeOAglxuICogQHBhcmFtIHthbnl9IHBhcmVudERhdGEgLSDlvZPliY3oioLngrnnmoTniLboioLngrnlnKggYHN0YXREYXRhYCDkuK3nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5SW5zZXJ0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIGluaGVyaXRlZENvbnRlbnQ6IGFueSxcbiAgcGFyZW50RGF0YTogYW55LCAvLyDmlrDlop7lj4LmlbDvvIznm7TmjqXkvKDpgJLniLboioLngrnmlbDmja5cbikge1xuICAvLyAtLS0gMS4g56Gu5a6a5b2T5YmN5bGC57qn55qE5qih5p2/5YaF5a65IC0tLVxuICAvLyDosIPnlKggcmVzb2x2ZVRlbXBsYXRl77yM5a6D546w5Zyo55u05o6l5L2/55So5Lyg5YWl55qEIHBhcmVudERhdGFcbiAgY29uc3QgbG9jYWxUcGxDb250ZW50ID0gcmVzb2x2ZVRlbXBsYXRlKGluaGVyaXRlZENvbnRlbnQsIHBhcmVudERhdGEpO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGBb5YWl5Y+jXSBiYXNlUGF0aDogXCIke2Jhc2VQYXRoIHx8ICdyb290J31cImAsIHtcbiAgICBzdGF0RGF0YTogXy5jbG9uZURlZXAoc3RhdERhdGEpLFxuICB9KTtcblxuICAvLyAtLS0gMi4g5qOA5p+l6Lev5b6E5a2Y5Zyo5oCn77yM5Yaz5a6a5omn6KGM562W55WlIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgYFvot6/lvoTmo4Dmn6VdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCIuIGN1cnJlbnROb2RlSW5WYXJzIOeahOWAvDpgLFxuICAgIGN1cnJlbnROb2RlSW5WYXJzLFxuICApO1xuXG4gIC8vICoq562W55Wl5LiA77ya5Y6f5a2Q5oCn5o+S5YWlIChBdG9taWMgSW5zZXJ0KSoqXG4gIC8vIOWmguaenOW9k+WJjei3r+W+hOWcqOWPmOmHj+S4reS4jeWtmOWcqO+8jOWImeWwhuaVtOS4quihpeS4geWvueixoeS9nOS4uuaWsOWAvOS4gOasoeaAp+aPkuWFpeOAglxuICBpZiAoYmFzZVBhdGggJiYgY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIOiwg+eUqCBhcHBseVRlbXBsYXRlVG9QYXRjaCDlh73mlbDvvIzlsIblkIjlubblkI7nmoTmqKHmnb/lhoXlrrnlupTnlKjliLDooaXkuIHkuIpcbiAgICBjb25zdCBjb21wb3NlZCA9IGFwcGx5VGVtcGxhdGVUb1BhdGNoKGxvY2FsVHBsQ29udGVudCwgcGF0Y2hPYmopO1xuXG4gICAgY29uc3QgZmluYWxWYWx1ZSA9IHNhbml0aXplQXJyYXlzKGNvbXBvc2VkKTsgLy8g5riF55CG5pWw57uE5Lit55qEIG51bGwg562J5peg5pWI5YC844CCXG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseUluc2VydEF0TGV2ZWwnLCBg5pyA57uI5o+S5YWl5pWw5o2uIGF0ICR7YmFzZVBhdGh9OlxcbiR7SlNPTi5zdHJpbmdpZnkoZmluYWxWYWx1ZSwgbnVsbCwgMil9YCk7XG4gICAgXy5zZXQoc3RhdERhdGEsIGJhc2VQYXRoLCBmaW5hbFZhbHVlKTsgLy8g5omn6KGM5o+S5YWl44CCXG4gICAgZWRpdExvZy5wdXNoKHsgb3A6ICdpbnNlcnQnLCBwYXRoOiBiYXNlUGF0aCwgdmFsdWVfbmV3OiBfLmNsb25lRGVlcChmaW5hbFZhbHVlKSB9KTtcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGDljp/lrZDmgKfmj5LlhaXliLDmlrDot6/lvoQ6ICR7YmFzZVBhdGh9YCk7XG4gICAgcmV0dXJuOyAvLyDmj5LlhaXlrozmiJDvvIznu4jmraLpgJLlvZLjgIJcbiAgfVxuXG4gIC8vICoq562W55Wl5LqM77ya6YCS5b2S6KGl5YWFIChSZWN1cnNpdmUgU3VwcGxlbWVudCkqKlxuICAvLyDlpoLmnpzlvZPliY3ot6/lvoTlt7LlrZjlnKjvvIzlubbkuJTooaXkuIHlkozlvZPliY3lgLzpg73mmK/lr7nosaHvvIzliJnmt7HlhaXpgJLlvZLjgIJcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50Tm9kZUluVmFycykgJiYgXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdhcHBseUluc2VydEF0TGV2ZWwnLFxuICAgICAgYFvpgJLlvZLooaXlhYVdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCJcbiAgICAgIC0g5b2T5YmN5bGC57qn5qih5p2/IChsb2NhbFRwbENvbnRlbnQpOiAke0pTT04uc3RyaW5naWZ5KGxvY2FsVHBsQ29udGVudCl9YCxcbiAgICApO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHBhdGNoT2JqKSkge1xuICAgICAgY29uc3Qgc3ViUGF0aCA9IGJhc2VQYXRoID8gYCR7YmFzZVBhdGh9LiR7a2V5fWAgOiBrZXk7XG4gICAgICBjb25zdCBzdWJQYXRjaCA9IHBhdGNoT2JqW2tleV07XG4gICAgICAvLyDosIPnlKggZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW5077yM5LuO5b2T5YmN5qih5p2/5YaF5a655Lit5Li65a2Q6IqC54K55p+l5om+5YW25bqU57un5om/55qE5YaF5a65XG4gICAgICBjb25zdCBzdWJJbmhlcml0ZWRDb250ZW50ID0gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KGxvY2FsVHBsQ29udGVudCwga2V5KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgICAgIGAgIC0g5YeG5aSH6YCS5b2S5a2Q6IqC54K5OiBcIiR7a2V5fVwiXG4gICAgICAtIOWwhuS8oOmAkue7meWtkOiKgueCueeahOaooeadvyAoc3ViSW5oZXJpdGVkQ29udGVudCk6ICR7SlNPTi5zdHJpbmdpZnkoc3ViSW5oZXJpdGVkQ29udGVudCl9YCxcbiAgICAgICk7XG4gICAgICAvLyDlsIblvZPliY3oioLngrnmlbDmja4gY3VycmVudE5vZGVJblZhcnMg5L2c5Li65LiL5LiA5bGC55qEIHBhcmVudERhdGEg5Lyg6YCS5LiL5Y67XG4gICAgICBhcHBseUluc2VydEF0TGV2ZWwoc3RhdERhdGEsIHN1YlBhdGgsIHN1YlBhdGNoLCBlZGl0TG9nLCBzdWJJbmhlcml0ZWRDb250ZW50LCBjdXJyZW50Tm9kZUluVmFycyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGJhc2VQYXRoKSB7XG4gICAgLy8gKirmj5LlhaXlpLHotKUqKlxuICAgIC8vIOWmguaenOi3r+W+hOW3suWtmOWcqO+8jOS9huS4jeaYr+WPr+mAkuW9kuihpeWFheeahOWvueixoee7k+aehO+8iOS+i+Wmgu+8jOS4gOS4quaYr+Wvueixoe+8jOWPpuS4gOS4quaYr+Wtl+espuS4su+8ie+8jFxuICAgIC8vIOWImeiusOW9leitpuWRiuOAgmluc2VydCDkuI3kvJropobnm5blt7LlrZjlnKjnmoTlgLzjgIJcbiAgICBsb2dnZXIud2FybignYXBwbHlJbnNlcnRBdExldmVsJywgYFZhcmlhYmxlSW5zZXJ0IOWksei0pe+8mui3r+W+hOW3suWtmOWcqOS4lOaXoOazlemAkuW9kuihpeWFhSAtPiAke2Jhc2VQYXRofWApO1xuICB9XG4gIC8vIOWmguaenCBiYXNlUGF0aCDkuLrnqbrvvIjlnKjmoLnnuqfliKvvvInkuJQgcGF0Y2gg5LiN5piv5a+56LGh77yM5YiZ5LiN5omn6KGM5Lu75L2V5pON5L2c77yM5Zug5Li65qC55LiN6IO96KKr6Z2e5a+56LGh5pu/5o2i44CCXG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVJbnNlcnQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxJbnNlcnRzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGluc2VydCDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NJbnNlcnRCbG9ja3MoYWxsSW5zZXJ0czogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxJbnNlcnRzLmxlbmd0aCA+IDApIHtcbiAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShhc3luYyBzdGF0ID0+IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0luc2VydEJsb2NrcycsICdb5Yid5aeL54q25oCBXSDov5vlhaUgcHJvY2Vzc0luc2VydEJsb2NrcyDml7bnmoQgc3RhdERhdGE6JywgXy5jbG9uZURlZXAoc3RhdCkpO1xuICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgfSk7XG4gICAgLypcbiAgICAgKiBOLkIuIOW/hemhu+Wvueavj+S4qiBpbnNlcnRSb290IOWNleeLrOiwg+eUqCB1cGRhdGVWYXJpYWJsZXNXaXRo77yM6ICM5LiN5piv5bCG5omA5pyJ5pON5L2c5ZCI5bm25Yiw5LiA5qyh6LCD55So5Lit44CCXG4gICAgICog6L+Z5piv5Li65LqG56Gu5L+d5Zyo5ZCM5LiA5p2h5raI5oGv5YaF77yM5YmN5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5Z2X5Lit5o+S5YWl55qE5qih5p2/5oiW5pWw5o2u77yMXG4gICAgICog5Y+v5Lul6KKr5ZCO5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5oiWIDxWYXJpYWJsZUVkaXQ+IOWdl+iuv+mXruWSjOS9v+eUqOOAglxuICAgICAqIOavj+asoSBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoIOWujOaIkOWQju+8jOWPmOmHj+eKtuaAgemDveS8muiiq+WIt+aWsO+8jOS7juiAjOS9v+WQjue7reaTjeS9nOiDveeci+WIsOacgOaWsOeahOe7k+aenOOAglxuICAgICAqL1xuICAgIGZvciAoY29uc3QgaW5zZXJ0Um9vdCBvZiBhbGxJbnNlcnRzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChpbnNlcnRSb290KSB8fCBfLmlzRW1wdHkoaW5zZXJ0Um9vdCkpIGNvbnRpbnVlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdXBkYXRlRXJhU3RhdERhdGEoc3RhdCA9PiB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgYOWkhOeQhiBpbnNlcnRSb290OiAke0pTT04uc3RyaW5naWZ5KGluc2VydFJvb3QpfWApO1xuICAgICAgICAgIC8vIOS7juaguei3r+W+hCAnJyDlvIDlp4vnu5/kuIDpgJLlvZLlhaXlj6PvvIzpobblsYLosIPnlKjml7bvvIzniLboioLngrnkuLogbnVsbFxuICAgICAgICAgIGFwcGx5SW5zZXJ0QXRMZXZlbChzdGF0LCAnJywgaW5zZXJ0Um9vdCwgZWRpdExvZywgbnVsbCwgbnVsbCk7XG4gICAgICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcigncHJvY2Vzc0luc2VydEJsb2NrcycsIGDlpITnkIYgaW5zZXJ0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgJ+aJgOaciSBWYXJpYWJsZUluc2VydCDmk43kvZzlrozmiJAnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/insert.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/template.ts": 
  /*!**************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/template.ts ***!
  \**************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyTemplateToPatch: () => (/* binding */ applyTemplateToPatch),\n/* harmony export */   getInheritedTemplateContent: () => (/* binding */ getInheritedTemplateContent),\n/* harmony export */   resolveTemplate: () => (/* binding */ resolveTemplate)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ "./src/ERA变量框架/utils/data.ts");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/log */ "./src/ERA变量框架/utils/log.ts");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger(\'core-crud-insert-template\');\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nfunction resolveTemplate(inheritedContent, parentNodeData) {\n    // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n    const varsContent = _.get(parentNodeData, \'$template\');\n    logger.debug(\'resolveTemplate\', `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(varsContent)}`);\n    // 2. 按优先级合并 (父节点变量 > 继承)\n    let mergedContent = {};\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, inheritedContent);\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, varsContent);\n    logger.debug(\'resolveTemplate\', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n    if (_.isEmpty(mergedContent)) {\n        return null;\n    }\n    return mergedContent;\n}\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   "$template": { "hp": 10, "mana": 100, "a": { "d": 1 } },\n *   "lili": { "hp": 15, "class": "warrior", "a": { "c": 1 } }\n * };\n * const key = "lili";\n * // 输出 (合并后的内容):\n * // { "hp": 15, "mana": 100, "class": "warrior", "a": { "c": 1, "d": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nfunction getInheritedTemplateContent(parentTplContent, key) {\n    if (!parentTplContent)\n        return undefined;\n    // 步骤 1: 在父级模板内容中查找通用的原型规则\n    const prototypeContent = _.get(parentTplContent, \'$template\');\n    // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n    const specificContent = _.get(parentTplContent, key);\n    // 步骤 3: 根据查找结果决定最终模板内容\n    if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(prototypeContent)}\\n      - 特异性: ${JSON.stringify(specificContent)}`);\n        // 直接使用 mergeReplaceArray 进行合并\n        const merged = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(prototypeContent), specificContent);\n        logger.debug(\'getInheritedTemplateContent\', `  - 合并后: ${JSON.stringify(merged)}`);\n        return merged;\n    }\n    else if (_.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到特异性内容: ${JSON.stringify(specificContent)}`);\n        return specificContent;\n    }\n    else if (_.isPlainObject(prototypeContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到原型内容: ${JSON.stringify(prototypeContent)}`);\n        return prototypeContent;\n    }\n    logger.debug(\'getInheritedTemplateContent\', `在父级模板内容中未为子节点 "${key}" 找到任何可继承的规则。`);\n    return undefined;\n}\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nfunction applyTemplateToPatch(tplContent, patchObj) {\n    logger.debug(\'applyTemplateToPatch\', `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`);\n    if (!_.isPlainObject(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 补丁不是一个普通对象，直接返回。`);\n        return patchObj;\n    }\n    if (!tplContent) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 模板内容无效，直接返回补丁。`);\n        return patchObj;\n    }\n    // 如果补丁是空对象，直接使用模板内容\n    if (_.isEmpty(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `补丁为空对象，完全使用模板内容。`);\n        return _.cloneDeep(tplContent);\n    }\n    // 如果补丁非空，将模板内容作为默认值与补丁合并\n    const composed = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(tplContent), patchObj);\n    logger.debug(\'applyTemplateToPatch\', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n    return composed;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvdGVtcGxhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBYTtBQUUyQztBQUNaO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBRXZEOzs7Ozs7OztHQVFHO0FBQ0ksU0FBUyxlQUFlLENBQUMsZ0JBQXFCLEVBQUUsY0FBbUI7SUFDeEUsbUNBQW1DO0lBQ25DLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRXZELE1BQU0sQ0FBQyxLQUFLLENBQ1YsaUJBQWlCLEVBQ2pCLHdCQUF3QixJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUN0RixXQUFXLENBQ1osRUFBRSxDQUNKLENBQUM7SUFFRix5QkFBeUI7SUFDekIsSUFBSSxhQUFhLEdBQVEsRUFBRSxDQUFDO0lBQzVCLGFBQWEsR0FBRyw4REFBaUIsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUNuRSxhQUFhLEdBQUcsOERBQWlCLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRTlELE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsZUFBZSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVoRixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGFBQWEsQ0FBQztBQUN2QixDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFDSSxTQUFTLDJCQUEyQixDQUFDLGdCQUFxQixFQUFFLEdBQVc7SUFDNUUsSUFBSSxDQUFDLGdCQUFnQjtRQUFFLE9BQU8sU0FBUyxDQUFDO0lBRXhDLDBC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Q0FBQyxLQUFLLENBQUMsc0JBQXNCLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvaW5zZXJ0L3RlbXBsYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgbWVyZ2VSZXBsYWNlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2NvcmUtY3J1ZC1pbnNlcnQtdGVtcGxhdGUnKTtcblxuLyoqXG4gKiAqKuOAkOino+aekOW5tuWQiOW5tuaooeadv+WGheWuueOAkSoqXG4gKlxuICog5LuO57un5om/55qE5qih5p2/5YaF5a655ZKM54i26IqC54K55Y+Y6YeP5Lit5a6a5LmJ55qE5qih5p2/5YaF5a655Lit77yM5ZCI5bm25Ye65b2T5YmN5bGC57qn5Y+v55So55qE5qih5p2/44CCXG4gKlxuICogQHBhcmFtIGluaGVyaXRlZENvbnRlbnQgLSDku47kuIrkuIrlsYLnu6fmib/nmoTmqKHmnb/lhoXlrrnjgIJcbiAqIEBwYXJhbSBwYXJlbnROb2RlRGF0YSAtIOW9k+WJjeato+WcqOWkhOeQhueahOiKgueCueeahCAqKueItuiKgueCuSoqIOWcqOWPmOmHj+S4reeahOaVsOaNruOAglxuICogQHJldHVybnMge2FueX0gLSDlkIjlubblkI7nmoTljZXkuIDlhoXlrrnlr7nosaHvvIzlpoLmnpzmiYDmnInmnaXmupDpg73ml6DmlYjvvIzliJnov5Tlm54gYG51bGxg44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlVGVtcGxhdGUoaW5oZXJpdGVkQ29udGVudDogYW55LCBwYXJlbnROb2RlRGF0YTogYW55KTogYW55IHtcbiAgLy8gMS4g5LuO54i26IqC54K55Y+Y6YeP5Lit77yM5om+5Yiw5L2c5Li65b2T5YmN6IqC54K55YWE5byf55qEICR0ZW1wbGF0ZVxuICBjb25zdCB2YXJzQ29udGVudCA9IF8uZ2V0KHBhcmVudE5vZGVEYXRhLCAnJHRlbXBsYXRlJyk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXNvbHZlVGVtcGxhdGUnLFxuICAgIGDop6PmnpDlh7rnmoTmqKHmnb/lhoXlrrk6XFxuICAgIC0g57un5om/OiAke0pTT04uc3RyaW5naWZ5KGluaGVyaXRlZENvbnRlbnQpfVxcbiAgICAtIOeItuiKgueCueWPmOmHjzogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHZhcnNDb250ZW50LFxuICAgICl9YCxcbiAgKTtcblxuICAvLyAyLiDmjInkvJjlhYjnuqflkIjlubYgKOeItuiKgueCueWPmOmHjyA+IOe7p+aJvylcbiAgbGV0IG1lcmdlZENvbnRlbnQ6IGFueSA9IHt9O1xuICBtZXJnZWRDb250ZW50ID0gbWVyZ2VSZXBsYWNlQXJyYXkobWVyZ2VkQ29udGVudCwgaW5oZXJpdGVkQ29udGVudCk7XG4gIG1lcmdlZENvbnRlbnQgPSBtZXJnZVJlcGxhY2VBcnJheShtZXJnZWRDb250ZW50LCB2YXJzQ29udGVudCk7XG5cbiAgbG9nZ2VyLmRlYnVnKCdyZXNvbHZlVGVtcGxhdGUnLCBg5ZCI5bm25ZCO55qE5pyA57uI5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KG1lcmdlZENvbnRlbnQpfWApO1xuXG4gIGlmIChfLmlzRW1wdHkobWVyZ2VkQ29udGVudCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBtZXJnZWRDb250ZW50O1xufVxuXG4vKipcbiAqICoq44CQ6I635Y+W5a2Q6IqC54K56KaB57un5om/55qE5qih5p2/5YaF5a6544CRKipcbiAqXG4gKiDlnKjkuIDkuKrnu5nlrprnmoTigJzniLbnuqfmqKHmnb/lhoXlrrnigJ3kuK3vvIzmn6Xmib7lubblkIjlubblhbblhoXpg6jlrprkuYnnmoTigJzljp/lnovop4TliJnigJ0gKGAkdGVtcGxhdGVgKSDlkozigJznibnlvILmgKfop4TliJnigJ0gKGBrZXlgKe+8jFxuICog5Lul55Sf5oiQ5L6b54m55a6a5a2Q6IqC54K5IGBrZXlgIOS9v+eUqOeahOacgOe7iOaooeadv+WGheWuueOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDovpPlhaU6XG4gKiBjb25zdCBwYXJlbnRUcGxDb250ZW50ID0ge1xuICogICBcIiR0ZW1wbGF0ZVwiOiB7IFwiaHBcIjogMTAsIFwibWFuYVwiOiAxMDAsIFwiYVwiOiB7IFwiZFwiOiAxIH0gfSxcbiAqICAgXCJsaWxpXCI6IHsgXCJocFwiOiAxNSwgXCJjbGFzc1wiOiBcIndhcnJpb3JcIiwgXCJhXCI6IHsgXCJjXCI6IDEgfSB9XG4gKiB9O1xuICogY29uc3Qga2V5ID0gXCJsaWxpXCI7XG4gKiAvLyDovpPlh7ogKOWQiOW5tuWQjueahOWGheWuuSk6XG4gKiAvLyB7IFwiaHBcIjogMTUsIFwibWFuYVwiOiAxMDAsIFwiY2xhc3NcIjogXCJ3YXJyaW9yXCIsIFwiYVwiOiB7IFwiY1wiOiAxLCBcImRcIjogMSB9IH1cbiAqXG4gKiBAcGFyYW0gcGFyZW50VHBsQ29udGVudCAtIOeItue6p+eahOaooeadv+WGheWuue+8jOWug+acrOi6q+WPr+iDveWMheWQqyBgJHRlbXBsYXRlYCDlkowgYGtleWAg5L2c5Li65a2Q6ZSu44CCXG4gKiBAcGFyYW0ga2V5IC0g5q2j5Zyo5aSE55CG55qE5a2Q6IqC54K555qE6ZSu5ZCN44CCXG4gKiBAcmV0dXJucyB7YW55fSAtIOWtkOiKgueCueW6lOivpee7p+aJv+eahOOAgeW3suWQiOW5tueahOaooeadv+WGheWuue+8jOaIliBgdW5kZWZpbmVkYOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KHBhcmVudFRwbENvbnRlbnQ6IGFueSwga2V5OiBzdHJpbmcpOiBhbnkge1xuICBpZiAoIXBhcmVudFRwbENvbnRlbnQpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgLy8g5q2l6aqkIDE6IOWcqOeItue6p+aooeadv+WGheWuueS4reafpeaJvumAmueUqOeahOWOn+Wei+inhOWImVxuICBjb25zdCBwcm90b3R5cGVDb250ZW50ID0gXy5nZXQocGFyZW50VHBsQ29udGVudCwgJyR0ZW1wbGF0ZScpO1xuXG4gIC8vIOatpemqpCAyOiDlnKjniLbnuqfmqKHmnb/lhoXlrrnkuK3mn6Xmib7nu5kga2V5IOeahOeJueW8guaAp+inhOWImVxuICBjb25zdCBzcGVjaWZpY0NvbnRlbnQgPSBfLmdldChwYXJlbnRUcGxDb250ZW50LCBrZXkpO1xuXG4gIC8vIOatpemqpCAzOiDmoLnmja7mn6Xmib7nu5PmnpzlhrPlrprmnIDnu4jmqKHmnb/lhoXlrrlcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwcm90b3R5cGVDb250ZW50KSAmJiBfLmlzUGxhaW5PYmplY3Qoc3BlY2lmaWNDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWQjOaXtuaJvuWIsOWOn+Wei+WSjOeJueW8guaAp+WGheWuueOAglxcbiAgICAgIC0g5Y6f5Z6LOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICBwcm90b3R5cGVDb250ZW50LFxuICAgICAgKX1cXG4gICAgICAtIOeJueW8guaApzogJHtKU09OLnN0cmluZ2lmeShzcGVjaWZpY0NvbnRlbnQpfWAsXG4gICAgKTtcbiAgICAvLyDnm7TmjqXkvb/nlKggbWVyZ2VSZXBsYWNlQXJyYXkg6L+b6KGM5ZCI5bm2XG4gICAgY29uc3QgbWVyZ2VkID0gbWVyZ2VSZXBsYWNlQXJyYXkoXy5jbG9uZURlZXAocHJvdG90eXBlQ29udGVudCksIHNwZWNpZmljQ29udGVudCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBgICAtIOWQiOW5tuWQjjogJHtKU09OLnN0cmluZ2lmeShtZXJnZWQpfWApO1xuICAgIHJldHVybiBtZXJnZWQ7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHNwZWNpZmljQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDnibnlvILmgKflhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkoc3BlY2lmaWNDb250ZW50KX1gLFxuICAgICk7XG4gICAgcmV0dXJuIHNwZWNpZmljQ29udGVudDtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QocHJvdG90eXBlQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDljp/lnovlhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkocHJvdG90eXBlQ29udGVudCl9YCxcbiAgICApO1xuICAgIHJldHVybiBwcm90b3R5cGVDb250ZW50O1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBg5Zyo54i257qn5qih5p2/5YaF5a655Lit5pyq5Li65a2Q6IqC54K5IFwiJHtrZXl9XCIg5om+5Yiw5Lu75L2V5Y+v57un5om/55qE6KeE5YiZ44CCYCk7XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogKirjgJDlupTnlKjmqKHmnb/lhoXlrrnliLDooaXkuIHjgJEqKlxuICpcbiAqIOWwhuS4gOS4quKAnOaooeadv+WGheWuueKAneWvueixoeW6lOeUqOWIsOS4gOS4quKAnOihpeS4geKAneWvueixoeS4iu+8jOS9nOS4uuWFtum7mOiupOWAvOOAglxuICpcbiAqIEBwYXJhbSB0cGxDb250ZW50IC0g5b2T5YmN5bGC57qn5ZCI5bm25ZCO55qE5qih5p2/5YaF5a6544CCXG4gKiBAcGFyYW0gcGF0Y2hPYmogLSDopoHlupTnlKjmqKHmnb/nmoTooaXkuIHmlbDmja7jgIJcbiAqIEByZXR1cm5zIHthbnl9IC0g5bqU55So5LqG5qih5p2/6buY6K6k5YC85LmL5ZCO77yM5pyA57uI5ZCI5oiQ55qE5pWw5o2u5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRlbXBsYXRlVG9QYXRjaCh0cGxDb250ZW50OiBhbnksIHBhdGNoT2JqOiBhbnkpOiBhbnkge1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJyxcbiAgICBgW+i/m+WFpV0g5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KHRwbENvbnRlbnQpfSwg6KGl5LiBOiAke0pTT04uc3RyaW5naWZ5KHBhdGNoT2JqKX1gLFxuICApO1xuXG4gIGlmICghXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g6KGl5LiB5LiN5piv5LiA5Liq5pmu6YCa5a+56LGh77yM55u05o6l6L+U5Zue44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG4gIGlmICghdHBsQ29udGVudCkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g5qih5p2/5YaF5a655peg5pWI77yM55u05o6l6L+U5Zue6KGl5LiB44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG5cbiAgLy8g5aaC5p6c6KGl5LiB5piv56m65a+56LGh77yM55u05o6l5L2/55So5qih5p2/5YaF5a65XG4gIGlmIChfLmlzRW1wdHkocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGDooaXkuIHkuLrnqbrlr7nosaHvvIzlrozlhajkvb/nlKjmqKHmnb/lhoXlrrnjgIJgKTtcbiAgICByZXR1cm4gXy5jbG9uZURlZXAodHBsQ29udGVudCk7XG4gIH1cblxuICAvLyDlpoLmnpzooaXkuIHpnZ7nqbrvvIzlsIbmqKHmnb/lhoXlrrnkvZzkuLrpu5jorqTlgLzkuI7ooaXkuIHlkIjlubZcbiAgY29uc3QgY29tcG9zZWQgPSBtZXJnZVJlcGxhY2VBcnJheShfLmNsb25lRGVlcCh0cGxDb250ZW50KSwgcGF0Y2hPYmopO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJywgYOWQiOW5tuaooeadv+S4juihpeS4geWQjueahOe7k+aenDogJHtKU09OLnN0cmluZ2lmeShjb21wb3NlZCl9YCk7XG4gIHJldHVybiBjb21wb3NlZDtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/template.ts\n\n}');
  },
  "./src/ERA变量框架/core/crud/patcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/core/crud/patcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApplyVarChange: () => (/* binding */ ApplyVarChange),\n/* harmony export */   ApplyVarChangeForMessage: () => (/* binding */ ApplyVarChangeForMessage)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./delete */ \"./src/ERA变量框架/core/crud/delete.ts\");\n/* harmony import */ var _insert_insert__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./insert/insert */ \"./src/ERA变量框架/core/crud/insert/insert.ts\");\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _update__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./update */ \"./src/ERA变量框架/core/crud/update.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_9__.Logger('core-crud-patcher');\n/**\n * **【核心实现】** 对指定的消息应用变量修改。\n * 这是变量写入流程的核心，处理单个消息。\n *\n * @param {TavernMessage} msg - 要处理的酒馆消息对象。\n * @returns {Promise<string | null>} 如果成功处理，返回该消息的 MK；如果消息无需处理或处理失败，返回 null。\n */\nconst ApplyVarChangeForMessage = async (msg) => {\n    logger.debug('ApplyVarChangeForMessage', `开始处理消息...`, { msg });\n    try {\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ApplyVarChangeForMessage', '无效消息对象或缺少 message_id，退出');\n            return null;\n        }\n        const messageId = msg.message_id;\n        // 写入函数只负责读取 MK，不负责创建。创建的职责由上游的 `ensureMessageKey` 承担。\n        const MK = (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_3__.readMessageKey)(msg);\n        // 如果消息没有 MK（可能是一个异常状态，如新消息还未被注入 MK），则跳过。\n        if (!MK) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 不含 MK，跳过变量写入。`);\n            return null;\n        }\n        // 根据设计，用户消息自身不应包含变量修改指令，因此跳过变量处理，但返回其已有的 MK。\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.isUserMessage)(msg)) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 为用户消息，跳过变量写入，但保留其 MK。`);\n            return MK;\n        }\n        const rawContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(msg) || '';\n        // 1. 从消息内容中解析出所有指令块。\n        const insertBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableInsert');\n        const editBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableEdit');\n        const deleteBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_7__.extractBlocks)(rawContent, 'VariableDelete');\n        if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 未检测到变量修改标签。`);\n        }\n        const rawInserts = insertBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        const rawEdits = editBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        const rawDeletes = deleteBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseJsonl)(s));\n        // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n        const allInserts = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawInserts);\n        const allEdits = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawEdits);\n        const allDeletes = (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.escapeEraData)(rawDeletes);\n        logger.debug('ApplyVarChangeForMessage', '数据转义完成', {\n            before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n            after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n        });\n        const editLog = []; // 用于收集本轮操作产生的所有变更记录。\n        // 2. --- 处理所有插入操作 (`<VariableInsert>`) ---\n        await (0,_insert_insert__WEBPACK_IMPORTED_MODULE_2__.processInsertBlocks)(allInserts, editLog);\n        // 3. --- 处理所有编辑操作 (`<VariableEdit>`) ---\n        await (0,_update__WEBPACK_IMPORTED_MODULE_5__.processEditBlocks)(allEdits, editLog, messageId);\n        // 4. --- 处理所有删除操作 (`<VariableDelete>`) ---\n        await (0,_delete__WEBPACK_IMPORTED_MODULE_1__.processDeleteBlocks)(allDeletes, editLog);\n        // 5. --- 覆盖式写入 EditLog ---\n        /*\n         * 核心逻辑：无论本轮是否产生了有效的变量修改，都必须用当前的 editLog (哪怕是空数组) 覆盖旧的 EditLog。\n         *\n         * 为什么必须覆盖而不是在没有修改时跳过？\n         *\n         * 根本原因在于，必须确保每个 MK 对应的 EditLog，严格且唯一地反映其所属消息**当前内容**所产生的变量修改。\n         *\n         * 考虑一个场景：\n         * 1. 消息A (MK_A) 的内容包含指令，生成了 EditLog_A。\n         * 2. 用户对消息A进行 swipe，生成了消息B (MK_B)，其内容完全没有变量修改标签。\n         *\n         * 如果在处理消息B时，因为没有检测到指令就“跳过写入”，那么与 MK_B 关联的 EditLog 就会是空的或不存在的。\n         * 这在当前是正确的。\n         *\n         * 但如果用户再次 swipe，从消息B切换回消息A。此时框架会重新处理消息A。\n         * 如果我们不执行覆盖式写入，那么与 MK_A 关联的 EditLog 仍然是之前生成的 EditLog_A，这没有问题。\n         *\n         * 真正的问题在于状态的明确性。覆盖式写入确保了任何一个 MK 的日志，在任何时间点，\n         * 都是其**当前可见内容**的直接产物，没有任何历史遗留。这使得整个系统的状态变迁变得清晰、可预测，\n         * 极大地降低了在复杂操作（如多次 `swipe`、删除、编辑）中出现状态不一致的风险。\n         *\n         * 因此，正确的做法是：用本次解析消息内容生成的 editLog (在无指令的场景下是 `[]`) 去覆盖，\n         * 从而斩断任何可能存在的历史关联，确保数据的一致性和纯粹性。\n         */\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n                const newArr = Array.isArray(editLog) ? editLog : (0,_utils_data__WEBPACK_IMPORTED_MODULE_8__.parseEditLog)(editLog);\n                logger.debug('ApplyVarChangeForMessage', `准备为 MK=${MK} (MsgID=${messageId}) 写入 EditLog:\\n${JSON.stringify(newArr, null, 2)}`);\n                // 将本轮生成的日志数组，以当前消息的 MK 为键，存入 `EditLogs` 对象。\n                _.set(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK], JSON.stringify(newArr));\n                /*\n                 * N.B. 此函数不再负责更新 SelectedMks 数组。\n                 * 更新 SelectedMks 的职责已移交至上层调用者 (resyncStateOnHistoryChange 或 ApplyVarChange)，\n                 * 以避免在 resync 循环中意外修改正在被读取的 oldSelectedMks 状态。\n                 */\n                return meta;\n            });\n            logger.debug('ApplyVarChangeForMessage', `成功为 MK=${MK} 写入 EditLog。`);\n        }\n        catch (e) {\n            logger.error('ApplyVarChangeForMessage', `为 MK=${MK} 写入 EditLogs 失败: ${e?.message || e}`, e);\n        }\n        return MK;\n    }\n    catch (err) {\n        logger.error('ApplyVarChangeForMessage', `变量写入器异常: ${err?.message || err}`, err);\n        return null;\n    }\n};\n/**\n * **【标准事件处理入口】**\n * 这是一个上层封装，用于处理最新 AI 消息的变量写入，并负责更新 `SelectedMks` 数组。\n * 它会自动寻找最后一条 AI 消息进行操作，通常被绑定到“新消息生成”等事件上。\n */\nconst ApplyVarChange = async () => {\n    logger.debug('ApplyVarChange', `函数被调用...`);\n    // 1. 智能查找最后一条 AI 消息\n    const msg = (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.log('ApplyVarChange', '未找到可处理的 AI 消息，退出。');\n        return;\n    }\n    const messageId = msg.message_id;\n    logger.log('ApplyVarChange', `找到目标 AI 消息 (ID: ${messageId})，开始处理变量写入...`);\n    // 2. 调用核心实现来处理变量和 EditLog 的写入。\n    // EditLog 会被自动关联到从该消息中读取到的 MK 上。\n    const MK = await ApplyVarChangeForMessage(msg);\n    // 3. 在核心流程执行完毕后，在此处统一更新 SelectedMks，确保状态一致。\n    try {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n            const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n            // 关键：必须使用我们正在处理的 AI 消息的 messageId 作为索引，\n            // 来更新 SelectedMks 数组中对应的 MK 记录。\n            selectedMks[messageId] = MK;\n            _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n            return meta;\n        });\n    }\n    catch (e) {\n        logger.error('ApplyVarChange', `更新 SelectedMks 失败: ${e?.message || e}`, e);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9wYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBRVU7QUFFK0M7QUFDYjtBQUNPO0FBQ0g7QUFDdUM7QUFDN0M7QUFDWTtBQUNOO0FBQ3dCO0FBQ2xDO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBRS9DOzs7Ozs7R0FNRztBQUNJLE1BQU0sd0JBQXdCLEdBQUcsS0FBSyxFQUFFLEdBQVEsRUFBMEIsRUFBRTtJQUNqRixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1lBQ25FLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7UUFDakMsc0RBQXNEO1FBQ3RELE1BQU0sRUFBRSxHQUFHLDREQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFL0IseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNSLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLGlCQUFpQixDQUFDLENBQUM7WUFDaEYsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksNkRBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLHlCQUF5QixDQUFDLENBQUM7WUFD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R0FBRyxNQUFNLHdCQUF3QixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRS9DLDRDQUE0QztJQUM1QyxJQUFJLENBQUM7UUFDSCxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzdCLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDOUMsd0NBQXdDO1lBQ3hDLGdDQUFnQztZQUNoQyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzVCLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDbkMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO1FBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsc0JBQXNCLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDN0UsQ0FBQztBQUNILENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9wYXRjaGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+WGmeWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmmK8gRVJBIOahhuaetueahOKAnOaJp+ihjOW8leaTjuKAne+8jOi0n+i0o+Wwhua2iOaBr+WGheWuueS4reeahOWPmOmHj+S/ruaUueaMh+S7pOW6lOeUqOWIsOWunumZheeahCBgY2hhdGAg5Y+Y6YeP5Lit44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIOWPmOmHj+eahOWGmeWFpeaYr+S4gOS4quS4peiwqOeahOi/h+eoi++8jOW/hemhu+ehruS/neaJgOacieWPmOabtOmDveiiq+ato+ehruiusOW9le+8jOS7peS+v+WQjue7reeahOWbnua7muWSjOWQjOatpeOAglxuICog5q2k5qih5Z2X55qE5qC45b+D6IGM6LSj5piv77yaXG4gKiAxLiAqKuino+aekOaMh+S7pCoqOiDku44gQUkg5raI5oGv5Lit5o+Q5Y+WIGA8VmFyaWFibGVJbnNlcnQ+YCDlkowgYDxWYXJpYWJsZUVkaXQ+YCDlnZfjgIJcbiAqIDIuICoq6aG65bqP5omn6KGMKio6IOehruS/neWQjOS4gOa2iOaBr+WGheeahOWkmuS4quaMh+S7pOWdl+aMiemhuuW6j+aJp+ihjO+8jOS4lOWQjue7reaMh+S7pOiDveaEn+efpeWIsOWJjemdouaMh+S7pOeahOe7k+aenOOAglxuICogMy4gKirnlJ/miJDml6Xlv5cqKjog5Zyo5bqU55So5Y+Y5pu055qE5ZCM5pe277yM6LCD55SoIGByZWN1cnNpdmUudHNgIOS4reeahOmAkuW9kuWHveaVsOadpeeUn+aIkOeyvuehrueahCBgRWRpdExvZ2DjgIJcbiAqIDQuICoq6KaG55uW5byP5pel5b+X5YaZ5YWlKio6IOehruS/neavj+S4qua2iOaBr+WvhumSpe+8iE1L77yJ5a+55bqU55qEIGBFZGl0TG9nYCDkuKXmoLzlj43mmKDlhbblvZPliY3lhoXlrrnvvIxcbiAqICAgIOWNs+S9v+WGheWuueS4reayoeacieS7u+S9leaMh+S7pO+8iOatpOaXtuS8muWGmeWFpeepuuaXpeW/l++8ie+8jOS5n+imgeimhuebluaXp+aXpeW/l++8jOi/meaYr+mYsuatoiBgc3dpcGVgIOmAoOaIkOaVsOaNruaxoeafk+eahOWFs+mUruOAglxuICpcbiAqICoq6IGM6LSj6L6555WMKio6XG4gKiAtIOacrOaooeWdlyoq5Y+q6LSf6LSj6K+75Y+WIE1LKirvvIzkuI3otJ/otKPliJvlu7rjgILliJvlu7ogTUsg55qE6IGM6LSj55Sx5LiK5ri455qEIGBtZXNzYWdlX2tleS50c2Ag5om/5ouF44CCXG4gKiAtIGBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2VgIOWHveaVsCoq5Y+q6LSf6LSj5YaZ5YWl5Y+Y6YeP5ZKMIGBFZGl0TG9nYCoq77yM5LiN6LSf6LSj5pu05pawIGBTZWxlY3RlZE1rc2DjgIJcbiAqICAg5pu05pawIGBTZWxlY3RlZE1rc2Ag55qE6IGM6LSj6KKr56e75Lqk57uZ5LqG5pu05LiK5bGC55qE6LCD55So6ICF77yI5aaCIGBBcHBseVZhckNoYW5nZWAg5oiW5ZCM5q2l5Ye95pWw77yJ77yMXG4gKiAgIOS7pemBv+WFjeWcqOWQjOatpeW+queOr+S4reS/ruaUueato+WcqOiiq+ivu+WPlueahOeKtuaAge+8jOi/meaYr+S4gOenjemHjeimgeeahOW5tuWPkeaOp+WItuetlueVpeOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTE9HU19QQVRILCBTRUxfUEFUSCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBwcm9jZXNzRGVsZXRlQmxvY2tzIH0gZnJvbSAnLi9kZWxldGUnO1xuaW1wb3J0IHsgcHJvY2Vzc0luc2VydEJsb2NrcyB9IGZyb20gJy4vaW5zZXJ0L2luc2VydCc7XG5pbXBvcnQgeyByZWFkTWVzc2FnZUtleSB9IGZyb20gJy4uLy4uL2NvcmUva2V5L21rJztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uLy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgcHJvY2Vzc0VkaXRCbG9ja3MgfSBmcm9tICcuL3VwZGF0ZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IGV4dHJhY3RCbG9ja3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHJpbmcnO1xuaW1wb3J0IHsgZXNjYXBlRXJhRGF0YSwgcGFyc2VFZGl0TG9nLCBwYXJzZUpzb25sIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdjb3JlLWNydWQtcGF0Y2hlcicpO1xuXG4vKipcbiAqICoq44CQ5qC45b+D5a6e546w44CRKiog5a+55oyH5a6a55qE5raI5oGv5bqU55So5Y+Y6YeP5L+u5pS544CCXG4gKiDov5nmmK/lj5jph4/lhpnlhaXmtYHnqIvnmoTmoLjlv4PvvIzlpITnkIbljZXkuKrmtojmga/jgIJcbiAqXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOimgeWkhOeQhueahOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nIHwgbnVsbD59IOWmguaenOaIkOWKn+WkhOeQhu+8jOi/lOWbnuivpea2iOaBr+eahCBNS++8m+WmguaenOa2iOaBr+aXoOmcgOWkhOeQhuaIluWkhOeQhuWksei0pe+8jOi/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBjb25zdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UgPSBhc3luYyAobXNnOiBhbnkpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5byA5aeL5aSE55CG5raI5oGvLi4uYCwgeyBtc2cgfSk7XG4gIHRyeSB7XG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsICfml6DmlYjmtojmga/lr7nosaHmiJbnvLrlsJEgbWVzc2FnZV9pZO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gICAgLy8g5YaZ5YWl5Ye95pWw5Y+q6LSf6LSj6K+75Y+WIE1L77yM5LiN6LSf6LSj5Yib5bu644CC5Yib5bu655qE6IGM6LSj55Sx5LiK5ri455qEIGBlbnN1cmVNZXNzYWdlS2V5YCDmib/mi4XjgIJcbiAgICBjb25zdCBNSyA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG5cbiAgICAvLyDlpoLmnpzmtojmga/msqHmnIkgTUvvvIjlj6/og73mmK/kuIDkuKrlvILluLjnirbmgIHvvIzlpoLmlrDmtojmga/ov5jmnKrooqvms6jlhaUgTUvvvInvvIzliJnot7Pov4fjgIJcbiAgICBpZiAoIU1LKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOS4jeWQqyBNS++8jOi3s+i/h+WPmOmHj+WGmeWFpeOAgmApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8g5qC55o2u6K6+6K6h77yM55So5oi35raI5oGv6Ieq6Lqr5LiN5bqU5YyF5ZCr5Y+Y6YeP5L+u5pS55oyH5Luk77yM5Zug5q2k6Lez6L+H5Y+Y6YeP5aSE55CG77yM5L2G6L+U5Zue5YW25bey5pyJ55qEIE1L44CCXG4gICAgaWYgKGlzVXNlck1lc3NhZ2UobXNnKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5raI5oGvIChJRDogJHttZXNzYWdlSWR9KSDkuLrnlKjmiLfmtojmga/vvIzot7Pov4flj5jph4/lhpnlhaXvvIzkvYbkv53nlZnlhbYgTUvjgIJgKTtcbiAgICAgIHJldHVybiBNSztcbiAgICB9XG5cbiAgICBjb25zdCByYXdDb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobXNnKSB8fCAnJztcblxuICAgIC8vIDEuIOS7jua2iOaBr+WGheWuueS4reino+aekOWHuuaJgOacieaMh+S7pOWdl+OAglxuICAgIGNvbnN0IGluc2VydEJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlSW5zZXJ0Jyk7XG4gICAgY29uc3QgZWRpdEJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlRWRpdCcpO1xuICAgIGNvbnN0IGRlbGV0ZUJsb2NrcyA9IGV4dHJhY3RCbG9ja3MocmF3Q29udGVudCwgJ1ZhcmlhYmxlRGVsZXRlJyk7XG5cbiAgICBpZiAoIWluc2VydEJsb2Nrcy5sZW5ndGggJiYgIWVkaXRCbG9ja3MubGVuZ3RoICYmICFkZWxldGVCbG9ja3MubGVuZ3RoKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOacquajgOa1i+WIsOWPmOmHj+S/ruaUueagh+etvuOAgmApO1xuICAgIH1cblxuICAgIGNvbnN0IHJhd0luc2VydHMgPSBpbnNlcnRCbG9ja3MuZmxhdE1hcChzID0+IHBhcnNlSnNvbmwocykpO1xuICAgIGNvbnN0IHJhd0VkaXRzID0gZWRpdEJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG4gICAgY29uc3QgcmF3RGVsZXRlcyA9IGRlbGV0ZUJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG5cbiAgICAvLyDlnKjov5nph4zlr7nku47mtojmga/kuK3op6PmnpDlh7rnmoTljp/lp4vmlbDmja7ov5vooYzovazkuYnvvIznoa7kv53miYDmnInlkI7nu63lpITnkIbpg73kvb/nlKjovazkuYnlkI7nmoTmlbDmja7jgIJcbiAgICBjb25zdCBhbGxJbnNlcnRzID0gZXNjYXBlRXJhRGF0YShyYXdJbnNlcnRzKTtcbiAgICBjb25zdCBhbGxFZGl0cyA9IGVzY2FwZUVyYURhdGEocmF3RWRpdHMpO1xuICAgIGNvbnN0IGFsbERlbGV0ZXMgPSBlc2NhcGVFcmFEYXRhKHJhd0RlbGV0ZXMpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCAn5pWw5o2u6L2s5LmJ5a6M5oiQJywge1xuICAgICAgYmVmb3JlOiB7IGluc2VydHM6IHJhd0luc2VydHMsIGVkaXRzOiByYXdFZGl0cywgZGVsZXRlczogcmF3RGVsZXRlcyB9LFxuICAgICAgYWZ0ZXI6IHsgaW5zZXJ0czogYWxsSW5zZXJ0cywgZWRpdHM6IGFsbEVkaXRzLCBkZWxldGVzOiBhbGxEZWxldGVzIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBlZGl0TG9nOiBhbnlbXSA9IFtdOyAvLyDnlKjkuo7mlLbpm4bmnKzova7mk43kvZzkuqfnlJ/nmoTmiYDmnInlj5jmm7TorrDlvZXjgIJcblxuICAgIC8vIDIuIC0tLSDlpITnkIbmiYDmnInmj5LlhaXmk43kvZwgKGA8VmFyaWFibGVJbnNlcnQ+YCkgLS0tXG4gICAgYXdhaXQgcHJvY2Vzc0luc2VydEJsb2NrcyhhbGxJbnNlcnRzLCBlZGl0TG9nKTtcblxuICAgIC8vIDMuIC0tLSDlpITnkIbmiYDmnInnvJbovpHmk43kvZwgKGA8VmFyaWFibGVFZGl0PmApIC0tLVxuICAgIGF3YWl0IHByb2Nlc3NFZGl0QmxvY2tzKGFsbEVkaXRzLCBlZGl0TG9nLCBtZXNzYWdlSWQpO1xuXG4gICAgLy8gNC4gLS0tIOWkhOeQhuaJgOacieWIoOmZpOaTjeS9nCAoYDxWYXJpYWJsZURlbGV0ZT5gKSAtLS1cbiAgICBhd2FpdCBwcm9jZXNzRGVsZXRlQmxvY2tzKGFsbERlbGV0ZXMsIGVkaXRMb2cpO1xuXG4gICAgLy8gNS4gLS0tIOimhuebluW8j+WGmeWFpSBFZGl0TG9nIC0tLVxuICAgIC8qXG4gICAgICog5qC45b+D6YC76L6R77ya5peg6K665pys6L2u5piv5ZCm5Lqn55Sf5LqG5pyJ5pWI55qE5Y+Y6YeP5L+u5pS577yM6YO95b+F6aG755So5b2T5YmN55qEIGVkaXRMb2cgKOWTquaAleaYr+epuuaVsOe7hCkg6KaG55uW5pen55qEIEVkaXRMb2fjgIJcbiAgICAgKlxuICAgICAqIOS4uuS7gOS5iOW/hemhu+imhuebluiAjOS4jeaYr+WcqOayoeacieS/ruaUueaXtui3s+i/h++8n1xuICAgICAqXG4gICAgICog5qC55pys5Y6f5Zug5Zyo5LqO77yM5b+F6aG756Gu5L+d5q+P5LiqIE1LIOWvueW6lOeahCBFZGl0TG9n77yM5Lil5qC85LiU5ZSv5LiA5Zyw5Y+N5pig5YW25omA5bGe5raI5oGvKirlvZPliY3lhoXlrrkqKuaJgOS6p+eUn+eahOWPmOmHj+S/ruaUueOAglxuICAgICAqXG4gICAgICog6ICD6JmR5LiA5Liq5Zy65pmv77yaXG4gICAgICogMS4g5raI5oGvQSAoTUtfQSkg55qE5YaF5a655YyF5ZCr5oyH5Luk77yM55Sf5oiQ5LqGIEVkaXRMb2dfQeOAglxuICAgICAqIDIuIOeUqOaIt+Wvuea2iOaBr0Hov5vooYwgc3dpcGXvvIznlJ/miJDkuobmtojmga9CIChNS19CKe+8jOWFtuWGheWuueWujOWFqOayoeacieWPmOmHj+S/ruaUueagh+etvuOAglxuICAgICAqXG4gICAgICog5aaC5p6c5Zyo5aSE55CG5raI5oGvQuaXtu+8jOWboOS4uuayoeacieajgOa1i+WIsOaMh+S7pOWwseKAnOi3s+i/h+WGmeWFpeKAne+8jOmCo+S5iOS4jiBNS19CIOWFs+iBlOeahCBFZGl0TG9nIOWwseS8muaYr+epuueahOaIluS4jeWtmOWcqOeahOOAglxuICAgICAqIOi/meWcqOW9k+WJjeaYr+ato+ehrueahOOAglxuICAgICAqXG4gICAgICog5L2G5aaC5p6c55So5oi35YaN5qyhIHN3aXBl77yM5LuO5raI5oGvQuWIh+aNouWbnua2iOaBr0HjgILmraTml7bmoYbmnrbkvJrph43mlrDlpITnkIbmtojmga9B44CCXG4gICAgICog5aaC5p6c5oiR5Lus5LiN5omn6KGM6KaG55uW5byP5YaZ5YWl77yM6YKj5LmI5LiOIE1LX0Eg5YWz6IGU55qEIEVkaXRMb2cg5LuN54S25piv5LmL5YmN55Sf5oiQ55qEIEVkaXRMb2dfQe+8jOi/meayoeaciemXrumimOOAglxuICAgICAqXG4gICAgICog55yf5q2j55qE6Zeu6aKY5Zyo5LqO54q25oCB55qE5piO56Gu5oCn44CC6KaG55uW5byP5YaZ5YWl56Gu5L+d5LqG5Lu75L2V5LiA5LiqIE1LIOeahOaXpeW/l++8jOWcqOS7u+S9leaXtumXtOeCue+8jFxuICAgICAqIOmDveaYr+WFtioq5b2T5YmN5Y+v6KeB5YaF5a65KirnmoTnm7TmjqXkuqfnianvvIzmsqHmnInku7vkvZXljoblj7LpgZfnlZnjgILov5nkvb/lvpfmlbTkuKrns7vnu5/nmoTnirbmgIHlj5jov4Hlj5jlvpfmuIXmmbDjgIHlj6/pooTmtYvvvIxcbiAgICAgKiDmnoHlpKflnLDpmY3kvY7kuoblnKjlpI3mnYLmk43kvZzvvIjlpoLlpJrmrKEgYHN3aXBlYOOAgeWIoOmZpOOAgee8lui+ke+8ieS4reWHuueOsOeKtuaAgeS4jeS4gOiHtOeahOmjjumZqeOAglxuICAgICAqXG4gICAgICog5Zug5q2k77yM5q2j56Gu55qE5YGa5rOV5piv77ya55So5pys5qyh6Kej5p6Q5raI5oGv5YaF5a6555Sf5oiQ55qEIGVkaXRMb2cgKOWcqOaXoOaMh+S7pOeahOWcuuaZr+S4i+aYryBgW11gKSDljrvopobnm5bvvIxcbiAgICAgKiDku47ogIzmlqnmlq3ku7vkvZXlj6/og73lrZjlnKjnmoTljoblj7LlhbPogZTvvIznoa7kv53mlbDmja7nmoTkuIDoh7TmgKflkoznuq/nsrnmgKfjgIJcbiAgICAgKi9cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0FyciA9IEFycmF5LmlzQXJyYXkoZWRpdExvZykgPyBlZGl0TG9nIDogcGFyc2VFZGl0TG9nKGVkaXRMb2cpO1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsXG4gICAgICAgICAgYOWHhuWkh+S4uiBNSz0ke01LfSAoTXNnSUQ9JHttZXNzYWdlSWR9KSDlhpnlhaUgRWRpdExvZzpcXG4ke0pTT04uc3RyaW5naWZ5KG5ld0FyciwgbnVsbCwgMil9YCxcbiAgICAgICAgKTtcbiAgICAgICAgLy8g5bCG5pys6L2u55Sf5oiQ55qE5pel5b+X5pWw57uE77yM5Lul5b2T5YmN5raI5oGv55qEIE1LIOS4uumUru+8jOWtmOWFpSBgRWRpdExvZ3NgIOWvueixoeOAglxuICAgICAgICBfLnNldChtZXRhLCBbTE9HU19QQVRILCBNS10sIEpTT04uc3RyaW5naWZ5KG5ld0FycikpO1xuICAgICAgICAvKlxuICAgICAgICAgKiBOLkIuIOatpOWHveaVsOS4jeWGjei0n+i0o+abtOaWsCBTZWxlY3RlZE1rcyDmlbDnu4TjgIJcbiAgICAgICAgICog5pu05pawIFNlbGVjdGVkTWtzIOeahOiBjOi0o+W3suenu+S6pOiHs+S4iuWxguiwg+eUqOiAhSAocmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2Ug5oiWIEFwcGx5VmFyQ2hhbmdlKe+8jFxuICAgICAgICAgKiDku6Xpgb/lhY3lnKggcmVzeW5jIOW+queOr+S4reaEj+WkluS/ruaUueato+WcqOiiq+ivu+WPlueahCBvbGRTZWxlY3RlZE1rcyDnirbmgIHjgIJcbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiBtZXRhO1xuICAgICAgfSk7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmiJDlip/kuLogTUs9JHtNS30g5YaZ5YWlIEVkaXRMb2fjgIJgKTtcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOS4uiBNSz0ke01LfSDlhpnlhaUgRWRpdExvZ3Mg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTUs7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5Y+Y6YeP5YaZ5YWl5Zmo5byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuLyoqXG4gKiAqKuOAkOagh+WHhuS6i+S7tuWkhOeQhuWFpeWPo+OAkSoqXG4gKiDov5nmmK/kuIDkuKrkuIrlsYLlsIHoo4XvvIznlKjkuo7lpITnkIbmnIDmlrAgQUkg5raI5oGv55qE5Y+Y6YeP5YaZ5YWl77yM5bm26LSf6LSj5pu05pawIGBTZWxlY3RlZE1rc2Ag5pWw57uE44CCXG4gKiDlroPkvJroh6rliqjlr7vmib7mnIDlkI7kuIDmnaEgQUkg5raI5oGv6L+b6KGM5pON5L2c77yM6YCa5bi46KKr57uR5a6a5Yiw4oCc5paw5raI5oGv55Sf5oiQ4oCd562J5LqL5Lu25LiK44CCXG4gKi9cbmV4cG9ydCBjb25zdCBBcHBseVZhckNoYW5nZSA9IGFzeW5jICgpID0+IHtcbiAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZScsIGDlh73mlbDooqvosIPnlKguLi5gKTtcbiAgLy8gMS4g5pm66IO95p+l5om+5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr1xuICBjb25zdCBtc2cgPSBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgbG9nZ2VyLmxvZygnQXBwbHlWYXJDaGFuZ2UnLCAn5pyq5om+5Yiw5Y+v5aSE55CG55qEIEFJIOa2iOaBr++8jOmAgOWHuuOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuICBsb2dnZXIubG9nKCdBcHBseVZhckNoYW5nZScsIGDmib7liLDnm67moIcgQUkg5raI5oGvIChJRDogJHttZXNzYWdlSWR9Ke+8jOW8gOWni+WkhOeQhuWPmOmHj+WGmeWFpS4uLmApO1xuXG4gIC8vIDIuIOiwg+eUqOaguOW/g+WunueOsOadpeWkhOeQhuWPmOmHj+WSjCBFZGl0TG9nIOeahOWGmeWFpeOAglxuICAvLyBFZGl0TG9nIOS8muiiq+iHquWKqOWFs+iBlOWIsOS7juivpea2iOaBr+S4reivu+WPluWIsOeahCBNSyDkuIrjgIJcbiAgY29uc3QgTUsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcblxuICAvLyAzLiDlnKjmoLjlv4PmtYHnqIvmiafooYzlrozmr5XlkI7vvIzlnKjmraTlpITnu5/kuIDmm7TmlrAgU2VsZWN0ZWRNa3PvvIznoa7kv53nirbmgIHkuIDoh7TjgIJcbiAgdHJ5IHtcbiAgICBhd2FpdCB1cGRhdGVFcmFNZXRhRGF0YShtZXRhID0+IHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAgIC8vIOWFs+mUru+8muW/hemhu+S9v+eUqOaIkeS7rOato+WcqOWkhOeQhueahCBBSSDmtojmga/nmoQgbWVzc2FnZUlkIOS9nOS4uue0ouW8le+8jFxuICAgICAgLy8g5p2l5pu05pawIFNlbGVjdGVkTWtzIOaVsOe7hOS4reWvueW6lOeahCBNSyDorrDlvZXjgIJcbiAgICAgIHNlbGVjdGVkTWtzW21lc3NhZ2VJZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgICByZXR1cm4gbWV0YTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZScsIGDmm7TmlrAgU2VsZWN0ZWRNa3Mg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/patcher.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/update.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/update.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyEditAtLevel: () => (/* binding */ applyEditAtLevel),\n/* harmony export */   processEditBlocks: () => (/* binding */ processEditBlocks)\n/* harmony export */ });\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('core-crud-update');\n/**\n * **【递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {Map<string, any>} intraMessageState - 用于跟踪在**同一条消息内部**对同一变量的连续修改。\n */\nasync function applyEditAtLevel(statData, basePath, patchObj, editLog, messageId, intraMessageState) {\n    // --- 1. 路径和存在性检查 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    // --- 2. 权限检查 (`updatable`) ---\n    // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n    const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n    // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n    const isBypassingProtection = isUpdatable === false && // 当前是受保护的\n        _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n    // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n    if (isUpdatable === false && !isBypassingProtection) {\n        logger.warn('applyEditAtLevel', `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`);\n        return; // 终止此分支的递归。\n    }\n    // --- 3. 递归或执行 ---\n    // 遍历指令的键，以驱动递归。\n    for (const key of Object.keys(patchObj)) {\n        const subPath = basePath ? `${basePath}.${key}` : key;\n        const valNew = patchObj[key];\n        // **策略一：递归深入**\n        // 如果指令的值是对象，则继续向内递归。\n        if (_.isPlainObject(valNew)) {\n            await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, intraMessageState);\n            continue; // 继续处理下一个键。\n        }\n        // **策略二：执行更新 (叶子节点)**\n        // 只有当指令的值不是对象时，才执行更新操作。\n        // 路径合法性检查：确保要写入的完整路径是存在的。\n        if (!_.has(statData, subPath)) {\n            logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`);\n            continue;\n        }\n        // a. 查找旧值 (`valOld`)\n        // 这是确保回滚准确性的核心。\n        logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n        let valOld = await (0,_rollback__WEBPACK_IMPORTED_MODULE_0__.findLatestNewValue)(subPath, messageId, logger);\n        if (valOld === null) {\n            valOld = _.get(statData, subPath);\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`);\n        }\n        else {\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n        }\n        const cleaned = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(valNew); // 清理新值\n        // b. 记录编辑意图\n        // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n        // 这对于调试和历史追溯非常有用。\n        _.set(statData, subPath, cleaned);\n        editLog.push({\n            op: 'update',\n            path: subPath,\n            value_old: _.cloneDeep(valOld),\n            value_new: _.cloneDeep(cleaned),\n        });\n        // c. 更新楼内状态 Map，以便同一消息内的后续操作能正确追溯到这个新值。\n        intraMessageState.set(subPath, _.cloneDeep(cleaned));\n    }\n}\n/**\n * 处理所有 `<VariableEdit>` 指令块。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n */\nasync function processEditBlocks(allEdits, editLog, messageId) {\n    if (allEdits.length > 0) {\n        const intraMessageState = new Map(); // 用于跟踪在**本消息内部**对变量的连续修改。\n        // N.B. 同样，编辑操作也需要独立调用以确保能读取到同一消息中、此前已完成的插入或编辑操作的结果。\n        for (const editRoot of allEdits) {\n            if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n                    logger.debug('processEditBlocks', `处理 editRoot: ${JSON.stringify(editRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n                    await applyEditAtLevel(stat, '', editRoot, editLog, messageId, intraMessageState);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processEditBlocks', '所有 VariableEdit 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC91cGRhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFDVTtBQUVvQztBQUNRO0FBQ1A7QUFDVDtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUU5Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSSxLQUFLLFVBQVUsZ0JBQWdCLENBQ3BDLFFBQWEsRUFDYixRQUFnQixFQUNoQixRQUFhLEVBQ2IsT0FBYyxFQUNkLFNBQWlCLEVBQ2pCLGlCQUFtQztJQUVuQyxzQkFBc0I7SUFDdEIsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFDMUUsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLDRCQUE0QixRQUFRLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNwRixPQUFPO0lBQ1QsQ0FBQztJQUVELGdDQUFnQztJQUNoQywwQ0FBMEM7SUFDMUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUUzRSxzREFBc0Q7SUFDdEQsTUFBTSxxQkFBcUIsR0FDekIsV0FBVyxLQUFLLEtBQUssSUFBSSxVQUFVO1FBQ25DLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMscUJBQXFCO0lBRXpFLDRCQUE0QjtJQUM1QixJQUFJLFdBQVcsS0FBSyxLQUFLLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFD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MEI7UUFDNUUsb0RBQW9EO1FBQ3BELEtBQUssTUFBTSxRQUFRLElBQUksUUFBUSxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQUUsU0FBUztZQUNoRSxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxLQUFLLEVBQUMsSUFBSSxFQUFDLEVBQUU7b0JBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUM5RSw0QkFBNEI7b0JBQzVCLE1BQU0sZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO29CQUNsRixPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO2dCQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdFLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFELENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9jcnVkL3VwZGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/nvJbovpHmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5L+u5pS577yM5bm255Sf5oiQ55So5LqO5Zue5rua55qE57K+56GuIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq6IGM6LSj5Y2V5LiAKio6IOaooeWdl+WPquWFs+W/g+WmguS9leagueaNruaMh+S7pOS/ruaUueWPmOmHj+eKtuaAgeW5tueUn+aIkOaXpeW/l++8jOS4jeWFs+W/g+aMh+S7pOS7juS9leiAjOadpeOAglxuICogLSAqKueyvuehruaXpeW/lyoqOiBgRWRpdExvZ2Ag55qE5YeG56Gu5oCn5piv5Zue5rua5Yqf6IO955qE5Z+656GA44CCYGFwcGx5RWRpdEF0TGV2ZWxgIOmAmui/h+eyvuW3p+eahOmAu+i+ke+8jFxuICogICDnibnliKvmmK/lr7nigJzml6flgLzigJ3nmoTljoblj7Lov73muq/vvIznoa7kv53kuobml6Xlv5fnmoTnu53lr7nlj6/pnaDjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V57yW6L6R5LiN5a2Y5Zyo55qE6Lev5b6E77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IGZpbmRMYXRlc3ROZXdWYWx1ZSB9IGZyb20gJy4uL3JvbGxiYWNrJztcbmltcG9ydCB7IHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgc2FuaXRpemVBcnJheXMgfSBmcm9tICcuLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2NvcmUtY3J1ZC11cGRhdGUnKTtcblxuLyoqXG4gKiAqKuOAkOmAkuW9kue8lui+keOAkSoqXG4gKiDlrp7njrDkuoYgYDxWYXJpYWJsZUVkaXQ+YCDnmoTmoLjlv4PpgLvovpHvvJoqKuWPquS/ruaUueW3suWtmOWcqOeahOi3r+W+hCoq44CCXG4gKlxuICogKirmoLjlv4Pop4TliJkqKjpcbiAqIDEuICoq6Lev5b6E5b+F6aG75a2Y5ZyoKirjgILlpoLmnpzmjIfku6TkuK3mjIflrprnmoTot6/lvoTlnKjlvZPliY3lj5jph4/nirbmgIHkuK3kuI3lrZjlnKjvvIzliJnot7Pov4for6Xmk43kvZzjgIJcbiAqIDIuICoq5Y+25a2Q6IqC54K55pON5L2cKirjgILlj6rlnKjpgYfliLDmjIfku6Tlr7nosaHkuK3nmoTlj7blrZDoioLngrnvvIjpnZ7lr7nosaHlgLzvvInml7bmiY3miafooYzlrp7pmYXnmoTkv67mlLnlkozml6Xlv5forrDlvZXjgIJcbiAqIDMuICoq57K+56Gu55qE5pen5YC85p+l5om+KirjgILkuLrkuobnlJ/miJDlj6/kvpvlm57mu5rnmoQgYEVkaXRMb2dg77yM5a6D6ZyA6KaB5om+5Yiw5Y+Y6YeP5Zyo5pys5qyh5L+u5pS55Y+R55SfKirkuYvliY0qKueahOKAnOaXp+WAvOKAneOAglxuICogICAg5p+l5om+6aG65bqP5Li677ya6aaW5YWI6YCa6L+HIGBmaW5kTGF0ZXN0TmV3VmFsdWVgIOWcqOWOhuWPsiBgRWRpdExvZ2Ag5Lit5Zue5rqv77yb5aaC5p6c5om+5LiN5Yiw77yMXG4gKiAgICDliJnku47lvZPliY3mtojmga/lpITnkIblvIDlp4vml7bnmoTlj5jph4/lv6vnhafkuK3ojrflj5bjgILov5nmmK/noa7kv53ml6Xlv5flh4bnoa7mgKfnmoTlhbPplK7jgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g6KaB5bqU55So55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE44CCXG4gKiBAcGFyYW0ge251bWJlcn0gbWVzc2FnZUlkIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE5raI5oGv55qEIElE77yM55So5LqO5Y6G5Y+y6L+95rqv44CCXG4gKiBAcGFyYW0ge01hcDxzdHJpbmcsIGFueT59IGludHJhTWVzc2FnZVN0YXRlIC0g55So5LqO6Lef6Liq5ZyoKirlkIzkuIDmnaHmtojmga/lhoXpg6gqKuWvueWQjOS4gOWPmOmHj+eahOi/nue7reS/ruaUueOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlFZGl0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIG1lc3NhZ2VJZDogbnVtYmVyLFxuICBpbnRyYU1lc3NhZ2VTdGF0ZTogTWFwPHN0cmluZywgYW55Pixcbikge1xuICAvLyAtLS0gMS4g6Lev5b6E5ZKM5a2Y5Zyo5oCn5qOA5p+lIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseUVkaXRBdExldmVsJywgYFZhcmlhYmxlRWRpdCDot7Pov4fvvJrot6/lvoTkuI3lrZjlnKggLT4gJHtiYXNlUGF0aCB8fCAnKHJvb3QpJ31gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAtLS0gMi4g5p2D6ZmQ5qOA5p+lIChgdXBkYXRhYmxlYCkgLS0tXG4gIC8vIOivu+WPliB1cGRhdGFibGUg5qCH5b+X77yM5aaC5p6c5pyq5a6a5LmJ77yM5YiZ6buY6K6k5Li6IHRydWUgKOWFgeiuuOabtOaWsCnjgIJcbiAgY29uc3QgaXNVcGRhdGFibGUgPSBfLmdldChjdXJyZW50Tm9kZUluVmFycywgWyckbWV0YScsICd1cGRhdGFibGUnXSwgdHJ1ZSk7XG5cbiAgLy8g5a6a5LmJ6LGB5YWN5p2h5Lu277ya5Y+q5pyJ5b2T5oyH5Luk5piO56Gu6KaB5bCGIHVwZGF0YWJsZSDku44gZmFsc2Ug5pS55Li6IHRydWUg5pe277yM5omN5YWB6K645pON5L2c44CCXG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgaXNVcGRhdGFibGUgPT09IGZhbHNlICYmIC8vIOW9k+WJjeaYr+WPl+S/neaKpOeahFxuICAgIF8uZ2V0KHBhdGNoT2JqLCBbJyRtZXRhJywgJ3VwZGF0YWJsZSddKSA9PT0gdHJ1ZTsgLy8g5LiU5oyH5Luk5oSP5Zu+5piv5piO56Gu5Zyw5bCG5YW25pS55Li6IHRydWVcblxuICAvLyDlpoLmnpzlj5fkv53miqTkuJTkuI3mu6HotrPosYHlhY3mnaHku7bvvIzliJnpmLvmraLmlbTkuKrlrZDmoJHnmoTmm7TmlrDjgIJcbiAgaWYgKGlzVXBkYXRhYmxlID09PSBmYWxzZSAmJiAhaXNCeXBhc3NpbmdQcm90ZWN0aW9uKSB7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hCA8JHtiYXNlUGF0aH0+IOWPlyBcIiRtZXRhLnVwZGF0YWJsZTogZmFsc2VcIiDkv53miqTvvIzml6Dms5Xooqvkv67mlLnjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuOyAvLyDnu4jmraLmraTliIbmlK/nmoTpgJLlvZLjgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDpgJLlvZLmiJbmiafooYwgLS0tXG4gIC8vIOmBjeWOhuaMh+S7pOeahOmUru+8jOS7pempseWKqOmAkuW9kuOAglxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICBjb25zdCBzdWJQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICBjb25zdCB2YWxOZXcgPSBwYXRjaE9ialtrZXldO1xuXG4gICAgLy8gKirnrZbnlaXkuIDvvJrpgJLlvZLmt7HlhaUqKlxuICAgIC8vIOWmguaenOaMh+S7pOeahOWAvOaYr+Wvueixoe+8jOWImee7p+e7reWQkeWGhemAkuW9kuOAglxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QodmFsTmV3KSkge1xuICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0RGF0YSwgc3ViUGF0aCwgdmFsTmV3LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDnu6fnu63lpITnkIbkuIvkuIDkuKrplK7jgIJcbiAgICB9XG5cbiAgICAvLyAqKuetlueVpeS6jO+8muaJp+ihjOabtOaWsCAo5Y+25a2Q6IqC54K5KSoqXG4gICAgLy8g5Y+q5pyJ5b2T5oyH5Luk55qE5YC85LiN5piv5a+56LGh5pe277yM5omN5omn6KGM5pu05paw5pON5L2c44CCXG5cbiAgICAvLyDot6/lvoTlkIjms5XmgKfmo4Dmn6XvvJrnoa7kv53opoHlhpnlhaXnmoTlrozmlbTot6/lvoTmmK/lrZjlnKjnmoTjgIJcbiAgICBpZiAoIV8uaGFzKHN0YXREYXRhLCBzdWJQYXRoKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hOmdnuazle+8jOaXoOazleWGmeWFpSAtPiAke3N1YlBhdGh9YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBhLiDmn6Xmib7ml6flgLwgKGB2YWxPbGRgKVxuICAgIC8vIOi/meaYr+ehruS/neWbnua7muWHhuehruaAp+eahOaguOW/g+OAglxuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDlh4blpIfkuLrot6/lvoQgPCR7c3ViUGF0aH0+IOS7jua2iOaBryBJRCA8JHttZXNzYWdlSWR9PiDlkJHkuIrov73muq8uLi5gKTtcbiAgICBsZXQgdmFsT2xkID0gYXdhaXQgZmluZExhdGVzdE5ld1ZhbHVlKHN1YlBhdGgsIG1lc3NhZ2VJZCwgbG9nZ2VyKTtcbiAgICBpZiAodmFsT2xkID09PSBudWxsKSB7XG4gICAgICB2YWxPbGQgPSBfLmdldChzdGF0RGF0YSwgc3ViUGF0aCk7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdhcHBseUVkaXRBdExldmVsJyxcbiAgICAgICAgYFvml6flgLzmn6Xmib5dIOi/vea6r+acquaJvuWIsOWOhuWPsuWAvO+8jOS7juW9k+WJjSBzdGF0X2RhdGEg5Lit6I635Y+W5Yiw5pen5YC8OiAke0pTT04uc3RyaW5naWZ5KHZhbE9sZCl9YCxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDov73muq/miJDlip/vvIzmib7liLDljoblj7Lml6flgLw6ICR7SlNPTi5zdHJpbmdpZnkodmFsT2xkKX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGVhbmVkID0gc2FuaXRpemVBcnJheXModmFsTmV3KTsgLy8g5riF55CG5paw5YC8XG5cbiAgICAvLyBiLiDorrDlvZXnvJbovpHmhI/lm75cbiAgICAvLyDljbPkvb/mlrDml6flgLznm7jlkIzvvIzkuZ/orrDlvZUgRWRpdExvZ++8jOS7peWujOaVtOWPjeaYoOS9nOiAheeahOe8lui+keaEj+WbvuOAglxuICAgIC8vIOi/meWvueS6juiwg+ivleWSjOWOhuWPsui/vea6r+mdnuW4uOacieeUqOOAglxuICAgIF8uc2V0KHN0YXREYXRhLCBzdWJQYXRoLCBjbGVhbmVkKTtcbiAgICBlZGl0TG9nLnB1c2goe1xuICAgICAgb3A6ICd1cGRhdGUnLFxuICAgICAgcGF0aDogc3ViUGF0aCxcbiAgICAgIHZhbHVlX29sZDogXy5jbG9uZURlZXAodmFsT2xkKSxcbiAgICAgIHZhbHVlX25ldzogXy5jbG9uZURlZXAoY2xlYW5lZCksXG4gICAgfSk7XG4gICAgLy8gYy4g5pu05paw5qW85YaF54q25oCBIE1hcO+8jOS7peS+v+WQjOS4gOa2iOaBr+WGheeahOWQjue7reaTjeS9nOiDveato+ehrui/vea6r+WIsOi/meS4quaWsOWAvOOAglxuICAgIGludHJhTWVzc2FnZVN0YXRlLnNldChzdWJQYXRoLCBfLmNsb25lRGVlcChjbGVhbmVkKSk7XG4gIH1cbn1cblxuLyoqXG4gKiDlpITnkIbmiYDmnIkgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxFZGl0cyAtIOS7jua2iOaBr+S4reino+aekOWHuueahOaJgOaciSBlZGl0IOaMh+S7pOWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IG1lc3NhZ2VJZCAtIOW9k+WJjeato+WcqOWkhOeQhueahOa2iOaBr+eahCBJROOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHM6IGFueVtdLCBlZGl0TG9nOiBhbnlbXSwgbWVzc2FnZUlkOiBudW1iZXIpIHtcbiAgaWYgKGFsbEVkaXRzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBpbnRyYU1lc3NhZ2VTdGF0ZSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7IC8vIOeUqOS6jui3n+i4quWcqCoq5pys5raI5oGv5YaF6YOoKirlr7nlj5jph4/nmoTov57nu63kv67mlLnjgIJcbiAgICAvLyBOLkIuIOWQjOagt++8jOe8lui+keaTjeS9nOS5n+mcgOimgeeLrOeri+iwg+eUqOS7peehruS/neiDveivu+WPluWIsOWQjOS4gOa2iOaBr+S4reOAgeatpOWJjeW3suWujOaIkOeahOaPkuWFpeaIlue8lui+keaTjeS9nOeahOe7k+aenOOAglxuICAgIGZvciAoY29uc3QgZWRpdFJvb3Qgb2YgYWxsRWRpdHMpIHtcbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KGVkaXRSb290KSB8fCBfLmlzRW1wdHkoZWRpdFJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKGFzeW5jIHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0VkaXRCbG9ja3MnLCBg5aSE55CGIGVkaXRSb290OiAke0pTT04uc3RyaW5naWZ5KGVkaXRSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoQgJycg5byA5aeL57uf5LiA6YCS5b2S5YWl5Y+j77yM5L+d5oyB6YC76L6R5LiA6Ie05oCn44CCXG4gICAgICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0LCAnJywgZWRpdFJvb3QsIGVkaXRMb2csIG1lc3NhZ2VJZCwgaW50cmFNZXNzYWdlU3RhdGUpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NFZGl0QmxvY2tzJywgYOWkhOeQhiBlZGl0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzRWRpdEJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVFZGl0IOaTjeS9nOWujOaIkCcpO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/update.ts\n\n}");
  },
  "./src/ERA变量框架/core/key/mk.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/core/key/mk.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureMessageKey: () => (/* binding */ ensureMessageKey),\n/* harmony export */   ensureMkForLatestMessage: () => (/* binding */ ensureMkForLatestMessage),\n/* harmony export */   readMessageKey: () => (/* binding */ readMessageKey),\n/* harmony export */   updateLatestSelectedMk: () => (/* binding */ updateLatestSelectedMk)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `\x3c!-- --\x3e`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('core-key-mk');\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            return {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n        }\n        return null;\n    }\n    catch {\n        return null;\n    }\n}\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nfunction readMessageKey(msg) {\n    if (!msg)\n        return '';\n    // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n    const content = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg);\n    const mk = parseEraData(content)?.['era-message-key'] || '';\n    // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n    // 以强制 ensureMessageKey 生成新的 MK。\n    return mk;\n    /*\n     * ==================================================================\n     * 【已废弃的兼容逻辑】 - 2025/10/02\n     *\n     * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n     * 因此 MK 可能存在于任何一个 swipe 中。\n     *\n     * **废弃原因**:\n     * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n     * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n     * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n     * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n     *\n     * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n     * ==================================================================\n     */\n    // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n    // if (mkFromCurrent) {\n    //   return mkFromCurrent;\n    // }\n    // if (Array.isArray(msg.swipes)) {\n    //   for (const swipeContent of msg.swipes) {\n    //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n    //     if (mkFromSwipe) {\n    //       return mkFromSwipe;\n    //     }\n    //   }\n    // }\n    // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n    // if (mkFromMessage) {\n    //   return mkFromMessage;\n    // }\n    // return '';\n}\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nasync function ensureMessageKey(msg) {\n    if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n        logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。msg=${JSON.stringify(msg)}`);\n        return { mk: '', isNew: false };\n    }\n    // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n    const existingMk = readMessageKey(msg);\n    if (existingMk) {\n        return { mk: existingMk, isNew: false }; // 已存在，直接返回\n    }\n    // 2. 生成新的 MK 和元数据块\n    const newMk = `era_mk_${Date.now()}_${(0,_utils_string__WEBPACK_IMPORTED_MODULE_4__.rnd)()}`;\n    const messageType = msg.role === 'user' ? 'user' : 'assistant';\n    const dataString = `<${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>`;\n    logger.log('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n    // 3. 构造新的消息内容并统一调用更新函数\n    const currentContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg) ?? '';\n    const newContent = dataString + '\\n' + currentContent;\n    // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.updateMessageContent)(msg, newContent);\n    return { mk: newMk, isNew: true };\n}\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nconst ensureMkForLatestMessage = async () => {\n    try {\n        const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n        // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n        logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg): ${JSON.stringify(msg)}`);\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出');\n            return { mk: '', message_id: null, isNewKey: false };\n        }\n        // ensureMessageKey 会返回最终的 MK 和一个布尔值\n        const { mk, isNew } = await ensureMessageKey(msg);\n        logger.log('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n        return { mk, message_id: msg.message_id, isNewKey: isNew };\n    }\n    catch (err) {\n        logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, err);\n        return { mk: '', message_id: null, isNewKey: false };\n    }\n};\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nconst updateLatestSelectedMk = async () => {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    if (!msg || typeof msg.message_id !== 'number')\n        return;\n    // 确保 MK 存在并获取它\n    const { mk: MK } = await ensureMessageKey(msg);\n    if (!MK)\n        return;\n    // 更新 ERAMetaData 中的 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n        const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, []);\n        // 只有在记录不一致时才执行写操作，以优化性能\n        if (selectedMks[msg.message_id] !== MK) {\n            selectedMks[msg.message_id] = MK;\n            lodash__WEBPACK_IMPORTED_MODULE_0___default().set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, selectedMks);\n        }\n        return meta;\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RTtJQUMvQyxNQUFNLEdBQUcsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsVUFBVSxLQUFLLFFBQVE7UUFBRSxPQUFPO0lBRXZELGVBQWU7SUFDZixNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0MsSUFBSSxDQUFDLEVBQUU7UUFBRSxPQUFPO0lBRWhCLG1DQUFtQztJQUNuQyxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzdCLE1BQU0sV0FBVyxHQUFHLGlEQUFLLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUMsd0JBQXdCO1FBQ3hCLElBQUksV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUN2QyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNqQyxpREFBSyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9rZXkvbWsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5raI5oGv5a+G6ZKlIChNSykg566h55CG5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOi/meS4quaooeWdl+aYryBFUkEg5qGG5p6255qE5Z+655+z77yM6LSf6LSj566h55CG4oCc5raI5oGv5a+G6ZKl4oCd77yITWVzc2FnZSBLZXksIE1L77yJ44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDnmoTmoLjlv4PkvJjlir/lnKjkuo7lhbbpsoHmo5LmgKfvvIzlroPpgJrov4flsIblj5jph4/nirbmgIHkuI4gU2lsbHlUYXZlcm4g5LiN56iz5a6a55qE5raI5oGv5Y+Y6YeP77yIbWVzc2FnZSB2YXJpYWJsZXPvvIlcbiAqIOino+iApuadpeWunueOsOi/meS4gOeCueOAgk1LIOato+aYr+WunueOsOino+iApueahOWFs+mUruOAglxuICpcbiAqIE1LIOaYr+S4gOS4queUsSAqKkVSQSDmoYbmnrboh6rouqsqKiDliqjmgIHnlJ/miJDlubYqKuazqOWFpeWIsOa2iOaBr+WGheWuueWtl+espuS4sumhtumDqCoq55qE5ZSv5LiA5qCH6K+G56ym44CCXG4gKiDlroPlsLHlg4/kuIDkuKrkuI3lj6/lj5jnmoTigJzplJrngrnigJ3vvIzpmo/mtojmga/lhoXlrrnmnKzouqvkuIDotbflrZjlnKjjgIJFUkEg55qE5omA5pyJ5qC45b+D6YC76L6R77yM5YyF5ous5Y+Y6YeP6L+96Liq44CBXG4gKiDlm57mu5rlkozlkIzmraXvvIzpg73lm7Tnu5XnnYDor4bliKvlkozmk43kvZzov5nkupvplJrngrnmnaXov5vooYzvvIzogIzkuI3mmK/kvp3otZbkuo7lj6/og73lj5HnlJ/plJnkvY3miJbooqvplJnor6/nu6fmib/nmoTmtojmga/lj5jph4/jgIJcbiAqXG4gKiAqKk1LIOagvOW8jyoqOlxuICogTUsg6KKr5YyF6KO55Zyo5LiA5Liq54us54m555qE44CB57G75Ly8IFhNTCDnmoQgYDxlcmFfZGF0YT5gIOagh+etvuS4re+8jOWFtuWGhemDqOaYr+S4gOenjSoq6Z2e5qCH5YeGKirnmoTnsbsgSlNPTiDmoLzlvI/vvIxcbiAqIOS9v+eUqCBgPWAg5L2c5Li65YiG6ZqU56ym77yM5Lul6YG/5YWN5LiOIEFJIOWPr+iDveeUn+aIkOeahOagh+WHhiBKU09OIOa3t+a3huOAglxuICogZS5nLiwgYDxlcmFfZGF0YT57XCJlcmEtbWVzc2FnZS1rZXlcIj1cImVyYV9ta18uLi5cIixcImVyYS1tZXNzYWdlLXR5cGVcIj1cInVzZXJcIn08L2VyYV9kYXRhPmBcbiAqIOi/meenjeiuvuiuoe+8iOiAjOS4jeaYr+eUqCBIVE1MIOazqOmHiiBgPCEtLSAtLT5g77yJ5piv5Li65LqG6Ziy5q2iIE1LIOiiq+WFtuS7luWPr+iDveenu+mZpOazqOmHiueahOiEmuacrOaXoOaEj+S4reegtOWdj+OAglxuICpcbiAqICoq5qC45b+D5Yqf6IO9Kio6XG4gKiAxLiAqKueUn+aIkOS4juazqOWFpSoqOiBgZW5zdXJlTWVzc2FnZUtleWAg5Ye95pWw56Gu5L+d5Lu75L2V6ZyA6KaB6L+96Liq55qE5raI5oGv6YO95oul5pyJ5LiA5LiqIE1L44CC5aaC5p6c5LiN5a2Y5Zyo77yMXG4gKiAgICDlroPkvJrnlJ/miJDkuIDkuKrmlrDnmoQgTUsg5bm25rOo5YWl5Yiw5raI5oGv5YaF5a6555qE5byA5aS044CCXG4gKiAyLiAqKuino+aekOS4juivu+WPlioqOiBgcmVhZE1lc3NhZ2VLZXlgIOWHveaVsOaPkOS+m+S6huS4gOS4quWPquivu+eahOaOpeWPo++8jOeUqOS6juS7jua2iOaBr+WGheWuueS4reino+aekOWHuiBNS+OAglxuICogMy4gKirlkIzmraXkv53pmpwqKjogYHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWtgIOetieWHveaVsOehruS/neaguOW/g+aVsOaNrue7k+aehCBgU2VsZWN0ZWRNa3NgIOS4juacgOaWsOeahFxuICogICAg5raI5oGv54q25oCB5L+d5oyB5LiA6Ie077yM5piv5qGG5p626Ieq5oSI6IO95Yqb55qE6YeN6KaB57uE5oiQ6YOo5YiG44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRVJBX0RBVEFfUkVHRVgsIEVSQV9EQVRBX1RBRywgU0VMX1BBVEggfSBmcm9tICcuLi8uLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TWVzc2FnZUNvbnRlbnQsIHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vLi4vdXRpbHMvbWVzc2FnZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHJuZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdjb3JlLWtleS1taycpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5YaF6YOo6L6F5Yqp5Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3op6PmnpDlh7ogYEVyYURhdGFgIOWvueixoeOAgui/meaYr+S4gOS4quWPquivu+aTjeS9nOOAglxuICogQHBhcmFtIHtzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkfSBtZXNzYWdlQ29udGVudCAtIOa2iOaBr+eahOWGheWuueWtl+espuS4suOAglxuICogQHJldHVybnMge0VyYURhdGEgfCBudWxsfSDop6PmnpDmiJDlip/liJnov5Tlm54gYEVyYURhdGFgIOWvueixoe+8jOWQpuWImei/lOWbniBudWxs44CCXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRXJhRGF0YShtZXNzYWdlQ29udGVudDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IEVyYURhdGEgfCBudWxsIHtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlQ29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKEVSQV9EQVRBX1JFR0VYKTtcbiAgaWYgKCFtYXRjaCB8fCAhbWF0Y2hbMV0pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICB0cnkge1xuICAgIC8vIOeUseS6jiBNSyDlnZflhoXpg6jmmK/oh6rlrprkuYnnmoQgYHtcImtleVwiPVwidmFsdWVcIn1gIOagvOW8j++8jOS4jeiDveS9v+eUqCBKU09OLnBhcnNl44CCXG4gICAgLy8g5b+F6aG75L2/55So5q2j5YiZ6KGo6L6+5byP6L+b6KGM5a695p2+5Yy56YWN5p2l5o+Q5Y+W6ZSu5YC844CCXG4gICAgY29uc3QgY3VzdG9tRm9ybWF0QmxvY2sgPSBtYXRjaFsxXTtcbiAgICBjb25zdCBrZXlNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLWtleVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG4gICAgY29uc3QgdHlwZU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2UtdHlwZVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG5cbiAgICBpZiAoa2V5TWF0Y2g/LlsxXSAmJiB0eXBlTWF0Y2g/LlsxXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ2VyYS1tZXNzYWdlLWtleSc6IGtleU1hdGNoWzFdLFxuICAgICAgICAnZXJhLW1lc3NhZ2UtdHlwZSc6IHR5cGVNYXRjaFsxXSBhcyAndXNlcicgfCAnYXNzaXN0YW50JyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWvvOWHuueahOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDor7vlj5YgTUvjgJEqKiDku47kuIDkuKrmtojmga/lr7nosaHkuK3lj6ror7vlnLDmj5Dlj5blhbbmtojmga/lr4bpkqXvvIhNS++8ieOAglxuICog6L+Z5Liq5Ye95pWw57uP6L+H54m55Yir5LyY5YyW77yM5Lul5bqU5a+55ruR5Yqo77yIc3dpcGXvvInnrYnlnLrmma/kuIvmtojmga/lr7nosaHnu5PmnoTkuI3kuIDoh7TnmoTpl67popjjgIJcbiAqIOWug+S8muWFqOmdouajgOafpea2iOaBr+eahCBgbWVzYOOAgWBtZXNzYWdlYCDku6Xlj4ogYHN3aXBlc2Ag5pWw57uE5Lit55qE5q+P5LiA5Liq5YWD57Sg77yM55u05Yiw5om+5Yiw56ys5LiA5Liq5pyJ5pWI55qEIE1LIOS4uuatouOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOaJvuWIsOeahCBNS++8m+WmguaenOS4jeWtmOWcqO+8jOWImei/lOWbnuepuuWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZE1lc3NhZ2VLZXkobXNnOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoIW1zZykgcmV0dXJuICcnO1xuXG4gIC8vIOaguOW/g+mAu+i+ke+8muWni+e7iOS4lOS7heagueaNriBnZXRNZXNzYWdlQ29udGVudCDnmoTnu5PmnpzmnaXop6PmnpAgTUvjgIJcbiAgY29uc3QgY29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KG1zZyk7XG5cbiAgY29uc3QgbWsgPSBwYXJzZUVyYURhdGEoY29udGVudCk/LlsnZXJhLW1lc3NhZ2Uta2V5J10gfHwgJyc7XG5cbiAgLy8g56e76Zmk6YGN5Y6G5YW25LuWIHN3aXBlcyDnmoTplJnor6/pgLvovpHjgILlpoLmnpzlvZPliY3mv4DmtLvnmoTlhoXlrrnmsqHmnIkgTUvvvIzlsLHlv4Xpobvov5Tlm57nqbrlrZfnrKbkuLLvvIxcbiAgLy8g5Lul5by65Yi2IGVuc3VyZU1lc3NhZ2VLZXkg55Sf5oiQ5paw55qEIE1L44CCXG4gIHJldHVybiBtaztcblxuICAvKlxuICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICog44CQ5bey5bqf5byD55qE5YW85a656YC76L6R44CRIC0gMjAyNS8xMC8wMlxuICAgKlxuICAgKiDku6XkuIvku6PnoIHlnZfmmK/kuLrkuoblhbzlrrnml6fniYjphZLppobnmoTkuIDkuKrnibnmgKfvvJrkuIDkuKrmtojmga/nmoTlpJrkuKogc3dpcGUg5Y+v6IO95YWx5Lqr5ZCM5LiA5Liq5bqV5bGC5raI5oGv5Y+Y6YeP77yMXG4gICAqIOWboOatpCBNSyDlj6/og73lrZjlnKjkuo7ku7vkvZXkuIDkuKogc3dpcGUg5Lit44CCXG4gICAqXG4gICAqICoq5bqf5byD5Y6f5ZugKio6XG4gICAqIOWcqOW9k+WJjeeahCBFUkEg5p625p6E5Lit77yM5q+P5LiqIHN3aXBlIOmDveiiq+inhuS4uueLrOeri+eahOWGheWuueOAguWmguaenOW9k+WJjea/gOa0u+eahCBzd2lwZSDlhoXlrrnkuK3msqHmnIkgTUvvvIxcbiAgICog5bCx5oSP5ZGz552A5a6D5piv5LiA5Liq5YWo5paw55qE44CB6ZyA6KaB6KKr6LWL5LqI5pawIE1LIOeahOa2iOaBr+OAguatpOaXtuiLpee7p+e7reafpeaJvuW5tui/lOWbnuWFtuS7liBzd2lwZSDnmoTml6cgTUvvvIxcbiAgICog5bCG5Lya5a+86Ie0IGBlbnN1cmVNZXNzYWdlS2V5YCDplJnor6/lnLDorqTkuLrmlrDmtojmga/lt7LmnIkgTUvvvIzku47ogIzot7Pov4flv4XopoHnmoTigJznlJ/miJDmlrAgTUvigJ3mtYHnqIvjgIJcbiAgICog6L+Z5q2j5piv5a+86Ie0IHN3aXBlIOaWsOa2iOaBr+aXtuaXoOazleato+ehruWGmeWFpeWPmOmHj+eahOagueacrOWOn+WboOOAglxuICAgKlxuICAgKiDlm6DmraTvvIzor6XlhbzlrrnpgLvovpHlt7Looqvms6jph4rmjonvvIzku6Xnoa7kv50gYHJlYWRNZXNzYWdlS2V5YCDnmoTooYzkuLrkuI7lvZPliY3mnrbmnoTnmoTorr7orqHmhI/lm77kv53mjIHkuIDoh7TjgIJcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAqL1xuICAvLyBjb25zdCBta0Zyb21DdXJyZW50ID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tQ3VycmVudCkge1xuICAvLyAgIHJldHVybiBta0Zyb21DdXJyZW50O1xuICAvLyB9XG4gIC8vIGlmIChBcnJheS5pc0FycmF5KG1zZy5zd2lwZXMpKSB7XG4gIC8vICAgZm9yIChjb25zdCBzd2lwZUNvbnRlbnQgb2YgbXNnLnN3aXBlcykge1xuICAvLyAgICAgY29uc3QgbWtGcm9tU3dpcGUgPSBwYXJzZUVyYURhdGEoc3dpcGVDb250ZW50KT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gICAgIGlmIChta0Zyb21Td2lwZSkge1xuICAvLyAgICAgICByZXR1cm4gbWtGcm9tU3dpcGU7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG1rRnJvbU1lc3NhZ2UgPSBwYXJzZUVyYURhdGEobXNnLm1lc3NhZ2UpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tTWVzc2FnZSkge1xuICAvLyAgIHJldHVybiBta0Zyb21NZXNzYWdlO1xuICAvLyB9XG4gIC8vIHJldHVybiAnJztcbn1cblxuLyoqXG4gKiAqKuOAkOehruS/nSBNSyDlrZjlnKjjgJEqKlxuICog6L+Z5piv5pys5qih5Z2X5pyA5qC45b+D55qE5Ye95pWw44CC5a6D5qOA5p+l5LiA5Liq5raI5oGv5piv5ZCm5bey5oul5pyJIE1L77yM5aaC5p6c5bCa5pyq5oul5pyJ77yM5YiZ5Li65YW255Sf5oiQ5LiA5Liq5paw55qEIE1LIOW5tuazqOWFpeWIsOa2iOaBr+WGheWuueS4reOAglxuICog6L+Z5piv6Kej5Yaz4oCc6bih55Sf6JuLL+ibi+eUn+m4oeKAnemXrumimOeahOWFs+mUru+8muWcqOWvueWPmOmHj+i/m+ihjOS7u+S9leaTjeS9nOS5i+WJje+8jOW/hemhu+WFiOehruS/neacieS4gOS4quWPr+S+m+S+nemZhOeahOmUmueCue+8iE1L77yJ44CCXG4gKlxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDnm67moIfmtojmga/lr7nosaEgKOW/hemhu+WMheWQqyBgbWVzc2FnZV9pZGAsIGByb2xlYCwg5Lul5Y+KIGBtZXNzYWdlYCDmiJYgYHN3aXBlc2Ap44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bWs6IHN0cmluZywgaXNOZXc6IGJvb2xlYW59Pn0g6L+U5Zue5YyF5ZCrIE1LIOWSjOS4gOS4quW4g+WwlOWAvOeahOWvueixoe+8jOivpeW4g+WwlOWAvOaMh+ekuuaYr+WQpuWIm+W7uuS6huaWsOeahCBNS+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlTWVzc2FnZUtleShtc2c6IGFueSk6IFByb21pc2U8eyBtazogc3RyaW5nOyBpc05ldzogYm9vbGVhbiB9PiB7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicgfHwgIW1zZy5yb2xlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5peg5pWI55qE5raI5oGv5a+56LGh57uT5p6E77yM5peg5rOV56Gu5L+dS2V544CCbXNnPSR7SlNPTi5zdHJpbmdpZnkobXNnKX1gKTtcbiAgICByZXR1cm4geyBtazogJycsIGlzTmV3OiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gMS4g5L2/55So5aKe5by655qEIHJlYWRNZXNzYWdlS2V5IOajgOafpeaYr+WQpuW3suWtmOWcqCBNS1xuICBjb25zdCBleGlzdGluZ01rID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKGV4aXN0aW5nTWspIHtcbiAgICByZXR1cm4geyBtazogZXhpc3RpbmdNaywgaXNOZXc6IGZhbHNlIH07IC8vIOW3suWtmOWcqO+8jOebtOaOpei/lOWbnlxuICB9XG5cbiAgLy8gMi4g55Sf5oiQ5paw55qEIE1LIOWSjOWFg+aVsOaNruWdl1xuICBjb25zdCBuZXdNayA9IGBlcmFfbWtfJHtEYXRlLm5vdygpfV8ke3JuZCgpfWA7XG4gIGNvbnN0IG1lc3NhZ2VUeXBlID0gbXNnLnJvbGUgPT09ICd1c2VyJyA/ICd1c2VyJyA6ICdhc3Npc3RhbnQnO1xuICBjb25zdCBkYXRhU3RyaW5nID0gYDwke0VSQV9EQVRBX1RBR30+e1wiZXJhLW1lc3NhZ2Uta2V5XCI9XCIke25ld01rfVwiLFwiZXJhLW1lc3NhZ2UtdHlwZVwiPVwiJHttZXNzYWdlVHlwZX1cIn08LyR7RVJBX0RBVEFfVEFHfT5gO1xuXG4gIGxvZ2dlci5sb2coJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5Li65raI5oGvIChJRDogJHttc2cubWVzc2FnZV9pZH0pIOazqOWFpeaWsOeahEtleTogJHtuZXdNa31gKTtcblxuICAvLyAzLiDmnoTpgKDmlrDnmoTmtojmga/lhoXlrrnlubbnu5/kuIDosIPnlKjmm7TmlrDlh73mlbBcbiAgY29uc3QgY3VycmVudENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gZGF0YVN0cmluZyArICdcXG4nICsgY3VycmVudENvbnRlbnQ7XG5cbiAgLy8g5L2/55So5LuOIHV0aWxzLnRzIOWvvOWFpeeahOmAmueUqOWHveaVsOadpeabtOaWsOa2iOaBr++8jOivpeWHveaVsOW3suWwgeijheS6huWkhOeQhiBzd2lwZXMg55qE6YC76L6R44CCXG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1zZywgbmV3Q29udGVudCk7XG5cbiAgcmV0dXJuIHsgbWs6IG5ld01rLCBpc05ldzogdHJ1ZSB9O1xufVxuXG4vKipcbiAqICoq44CQ56Gu5L+d5pyA5paw5raI5oGv55qEIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quS+v+aNt+WHveaVsO+8jOS4k+mXqOeUqOS6juehruS/neW9k+WJjeiBiuWkqeiusOW9leS4reeahOacgOWQjuS4gOadoea2iOaBr+aLpeaciSBNS+OAglxuICog5a6D6YCa5bi45Zyo55uR5ZCs5Yiw5paw5raI5oGv55Sf5oiQ562J5LqL5Lu25pe26KKr6LCD55So77yM5Lul56Gu5L+d5paw5raI5oGv6IO96KKrIEVSQSDns7vnu5/mraPnoa7ov73ouKrjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHttazogc3RyaW5nLCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsLCBpc05ld0tleTogYm9vbGVhbn0+fSDov5Tlm57ljIXlkKsgTUvjgIHmtojmga8gSUQg5ZKM5LiA5Liq5biD5bCU5YC855qE5a+56LGh77yM6K+l5biD5bCU5YC85oyH56S65piv5ZCm5Yib5bu65LqG5paw55qEIE1L44CCXG4gKi9cbmV4cG9ydCBjb25zdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UgPSBhc3luYyAoKTogUHJvbWlzZTx7XG4gIG1rOiBzdHJpbmc7XG4gIG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGw7XG4gIGlzTmV3S2V5OiBib29sZWFuO1xufT4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICAgIC8vIOS/neeVmeatpOaXpeW/l++8jOWboOS4uuWug+WvueS6juiwg+ivleS6i+S7tuinpuWPkeaXtueahOa2iOaBr+eKtuaAgeiHs+WFs+mHjeimgeOAglxuICAgIGxvZ2dlci5kZWJ1ZygnZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOiOt+WPluWIsOeahOacgOaWsOa2iOaBr+WvueixoSAobXNnKTogJHtKU09OLnN0cmluZ2lmeShtc2cpfWApO1xuXG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsICfml6Dms5Xor7vlj5bmnIDmlrDmtojmga/miJblhbZJRO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIHsgbWs6ICcnLCBtZXNzYWdlX2lkOiBudWxsLCBpc05ld0tleTogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvLyBlbnN1cmVNZXNzYWdlS2V5IOS8mui/lOWbnuacgOe7iOeahCBNSyDlkozkuIDkuKrluIPlsJTlgLxcbiAgICBjb25zdCB7IG1rLCBpc05ldyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICAgIGxvZ2dlci5sb2coJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDlt7LkuLrmnIDmlrDmtojmga8gJHttc2cubWVzc2FnZV9pZH0g56Gu5L+dIE1LIOWtmOWcqOOAgiAo5piv5ZCm5paw5bu6OiAke2lzTmV3fSlgKTtcbiAgICByZXR1cm4geyBtaywgbWVzc2FnZV9pZDogbXNnLm1lc3NhZ2VfaWQsIGlzTmV3S2V5OiBpc05ldyB9O1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGxvZ2dlci5lcnJvcignZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOehruS/nU1L5pe25byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4geyBtazogJycsIG1lc3NhZ2VfaWQ6IG51bGwsIGlzTmV3S2V5OiBmYWxzZSB9O1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5pu05paw5pyA5paw5bey6YCJIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quKAnOS/nemZqeKAneWHveaVsO+8jOeUqOS6juWcqOavj+asoeS6i+S7tuWkhOeQhueahOacgOWQju+8jOW8uuWItuagoeWHhiBgU2VsZWN0ZWRNa3NgIOaVsOe7hOS4reWFs+S6jioq5pyA5paw5raI5oGvKirnmoTorrDlvZXjgIJcbiAqIOWug+ehruS/neWNs+S9v+WcqOWkjeadgueahOW8guatpea1geeoi+S4re+8jGBTZWxlY3RlZE1rc2Ag55qE5bC+6YOo5Lmf5aeL57uI5LiO5a6e6ZmF55qE5pyA5paw5raI5oGv5L+d5oyB5Lil5qC85ZCM5q2l44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGNvbnN0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSByZXR1cm47XG5cbiAgLy8g56Gu5L+dIE1LIOWtmOWcqOW5tuiOt+WPluWug1xuICBjb25zdCB7IG1rOiBNSyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICBpZiAoIU1LKSByZXR1cm47XG5cbiAgLy8g5pu05pawIEVSQU1ldGFEYXRhIOS4reeahCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgIC8vIOWPquacieWcqOiusOW9leS4jeS4gOiHtOaXtuaJjeaJp+ihjOWGmeaTjeS9nO+8jOS7peS8mOWMluaAp+iDvVxuICAgIGlmIChzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gIT09IE1LKSB7XG4gICAgICBzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgfVxuICAgIHJldHVybiBtZXRhO1xuICB9KTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/key/mk.ts\n\n}");
  },
  "./src/ERA变量框架/core/rollback.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/core/rollback.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLatestNewValue: () => (/* binding */ findLatestNewValue),\n/* harmony export */   rollbackByMk: () => (/* binding */ rollbackByMk)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 回滚与历史追溯模块\n * @description\n * 该模块提供了 ERA 框架“时间旅行”能力的核心实现。它负责根据 `EditLog` 精确地撤销变量修改，\n * 以及在需要时向上追溯历史以查找变量的旧值。\n *\n * **设计理念**:\n * - **可逆操作**: 所有的变量写入操作都必须是可逆的。`rollbackByMk` 函数通过读取 `EditLog`\n *   并执行反向操作（`insert` -> `unset`, `update` -> `set to value_old`）来保证这一点。\n * - **历史的权威性**: `EditLog` 是变量状态变迁的唯一真实记录。`findLatestNewValue` 函数\n *   体现了这一原则，它不信任任何临时的变量快照，而是通过回溯 `EditLog` 链来查找一个变量\n *   在特定时间点之前的真实值。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('core-rollback');\n/**\n * **【回滚】**\n * 根据一个给定的消息密钥（MK），精确地撤销该消息所引入的所有变量变更。\n *\n * @param {string} MK - 要回滚的目标消息的密钥。\n * @param {boolean} [silent=false] - 是否为静默模式。在静默模式下，函数不会自己触发日志刷新，\n *   这在 `resyncStateOnHistoryChange` 等批量操作中非常有用，可以避免产生大量冗余日志。\n */\nasync function rollbackByMk(MK, silent = false) {\n    try {\n        logger.log('rollbackByMk', `开始回滚, MK=${MK}`);\n        await updateVariablesWith(v => {\n            const meta = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.META_DATA_PATH, {});\n            const stat = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, {});\n            const raw = _.get(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK]);\n            const arr = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(raw);\n            if (!arr || !arr.length) {\n                logger.debug('rollbackByMk', `EditLog 为空或无效，跳过回滚。`);\n                return v;\n            }\n            // 关键：必须逆序遍历 EditLog 来执行回滚。\n            // 这确保了对同一变量的多次修改能够被正确地、按相反的顺序撤销。\n            for (let i = arr.length - 1; i >= 0; i--) {\n                const e = arr[i];\n                const op = String(e?.op || '').toLowerCase();\n                const path = String(e?.path || '');\n                if (!path)\n                    continue;\n                if (op === 'insert') {\n                    // 对于“插入”操作，回滚即为“删除”。\n                    _.unset(stat, path);\n                    continue;\n                }\n                if (op === 'update' || op === 'delete') {\n                    // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n                    if (typeof e?.value_old === 'undefined') {\n                        // 如果日志中没有记录旧值，最安全的回滚方式是直接删除该路径。\n                        _.unset(stat, path);\n                    }\n                    else {\n                        _.set(stat, path, _.cloneDeep(e.value_old));\n                    }\n                }\n            }\n            _.set(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, stat);\n            return v;\n        }, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.CHAT_SCOPE);\n        logger.log('rollbackByMk', `回滚完成：MK=${MK}`);\n    }\n    catch (e) {\n        logger.error('rollbackByMk', `回滚异常：MK=${MK} → ${e?.message || e}`, e);\n    }\n}\n/**\n * **【历史追溯】**\n * 向上追溯聊天历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是为 `applyEditAtLevel` 函数提供支持的关键辅助函数，用于在生成 `update` 日志时，\n * 准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID 的**前一条**消息开始向上查找。\n * @param {Logger} [logger] - 可选的 Logger 实例，用于记录详细的追溯过程。\n * @returns {Promise<any>} 返回找到的 `value_new`。如果追溯到聊天记录的开头都未找到，则返回 `null`。\n */\nasync function findLatestNewValue(path, startMessageId, logger) {\n    logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息ID <${startMessageId}> 向上追溯历史值...`);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    if (!messages || messages.length < 1) {\n        logger?.debug('findLatestNewValue', `消息历史为空，无法追溯。`);\n        return null;\n    }\n    const startIndex = messages.findIndex(m => m.message_id === startMessageId);\n    if (startIndex === -1) {\n        logger?.warn('findLatestNewValue', `错误：在消息列表中未找到起始消息ID: ${startMessageId}`);\n        return null;\n    }\n    // 从起始消息的前一条开始，向上（向旧）遍历历史消息。\n    for (let i = startIndex - 1; i >= 0; i--) {\n        const message = messages[i];\n        const msgId = message?.message_id;\n        logger?.debug('findLatestNewValue', `[进度] 正在检查消息 (ID: ${msgId})，内容: \"${((0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message) || '').substring(0, 100)}...\"`);\n        // 使用 isUserMessage 辅助函数，并检查 message_id\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.isUserMessage)(message) || typeof msgId !== 'number') {\n            continue;\n        }\n        const mk = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(message);\n        if (!mk) {\n            logger?.debug('findLatestNewValue', `[进度] 消息 (ID: ${msgId}) 无 MK，跳过。`);\n            continue; // 跳过没有 MK 的 AI 消息。\n        }\n        const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.getEraData)();\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(editLogRaw);\n        if (!editLog || editLog.length === 0) {\n            logger?.debug('findLatestNewValue', `[进度] MK ${mk} 的 EditLog 为空，跳过。`);\n            continue; // 跳过 EditLog 为空的。\n        }\n        logger?.debug('findLatestNewValue', `[进度] 正在检查 MK ${mk} 的 EditLog...\\n${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(editLog)}`);\n        // 关键：从后向前遍历该消息的 EditLog，这样找到的第一个匹配项就是最新的。\n        for (let j = editLog.length - 1; j >= 0; j--) {\n            const logEntry = editLog[j];\n            if (!logEntry || !logEntry.path)\n                continue;\n            // Case 1: 精确路径匹配。\n            if (logEntry.path === path) {\n                // 如果在历史追溯中找到了 delete 记录，这意味着状态可能不一致。\n                // 因为 applyEditAtLevel 的前置检查应阻止对已删除变量的更新。\n                // 记录一个错误以供调试，并返回 null，因为该变量在逻辑上是不存在的。\n                if (logEntry.op === 'delete') {\n                    logger?.error('findLatestNewValue', `>> 状态异常! 在消息(ID:${message.message_id}, MK:${mk})中为路径 <${path}> 找到了 'delete' 记录。这表明 update 操作可能正在尝试修改一个已被删除的变量。`);\n                    return null;\n                }\n                logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到精确路径 <${path}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(logEntry.value_new)}`);\n                return _.cloneDeep(logEntry.value_new);\n            }\n            // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n            // 例如, 查找 \"a.b.c\", 而日志中有对 \"a.b\" 的修改。\n            if (path.startsWith(logEntry.path + '.')) {\n                const subPath = path.substring(logEntry.path.length + 1);\n                const parentNewVal = logEntry.value_new;\n                if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n                    const foundVal = _.get(parentNewVal, subPath);\n                    logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(foundVal)}`);\n                    return _.cloneDeep(foundVal);\n                }\n            }\n        }\n    }\n    // 如果追溯到聊天记录的开头都未找到，说明这是该变量的首次出现。\n    logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvcm9sbGJhY2sudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUU4RTtBQUNqRDtBQUMwQjtBQUNyQjtBQUNDO0FBQ1Y7QUFFdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNDOzs7Ozs7O0dBT0c7QUFDSSxLQUFLLFVBQVUsWUFBWSxDQUFDLEVBQVUsRUFBRSxNQUFNLEdBQUcsS0FBSztJQUMzRCxJQUFJLENBQUM7UUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0MsTUFBTSxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM1QixNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSw0REFBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDREQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFMUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyx1REFBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDekMsTUFBTSxHQUFHLEdBQUcseURBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN4QixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNwRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUM7WUFFRCwyQkFBMkI7WUFDM0IsaUNBQWlDO1lBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENB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RyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN4QyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDbEUsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzlDLE1BQU0sRUFBRSxLQUFLLENBQ1gsb0JBQW9CLEVBQ3BCLGlCQUFpQixPQUFPLENBQUMsVUFBVSxRQUFRLEVBQUUsYUFBYSxRQUFRLENBQUMsSUFBSSxnQkFBZ0IsT0FBTyxVQUFVLDhDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDdEgsQ0FBQztvQkFDRixPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLElBQUksdUJBQXVCLENBQUMsQ0FBQztJQUM5RSxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3JvbGxiYWNrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWbnua7muS4juWOhuWPsui/vea6r+aooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmj5DkvpvkuoYgRVJBIOahhuaetuKAnOaXtumXtOaXheihjOKAneiDveWKm+eahOaguOW/g+WunueOsOOAguWug+i0n+i0o+agueaNriBgRWRpdExvZ2Ag57K+56Gu5Zyw5pKk6ZSA5Y+Y6YeP5L+u5pS577yMXG4gKiDku6Xlj4rlnKjpnIDopoHml7blkJHkuIrov73muq/ljoblj7Lku6Xmn6Xmib7lj5jph4/nmoTml6flgLzjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuWPr+mAhuaTjeS9nCoqOiDmiYDmnInnmoTlj5jph4/lhpnlhaXmk43kvZzpg73lv4XpobvmmK/lj6/pgIbnmoTjgIJgcm9sbGJhY2tCeU1rYCDlh73mlbDpgJrov4for7vlj5YgYEVkaXRMb2dgXG4gKiAgIOW5tuaJp+ihjOWPjeWQkeaTjeS9nO+8iGBpbnNlcnRgIC0+IGB1bnNldGAsIGB1cGRhdGVgIC0+IGBzZXQgdG8gdmFsdWVfb2xkYO+8ieadpeS/neivgei/meS4gOeCueOAglxuICogLSAqKuWOhuWPsueahOadg+WogeaApyoqOiBgRWRpdExvZ2Ag5piv5Y+Y6YeP54q25oCB5Y+Y6L+B55qE5ZSv5LiA55yf5a6e6K6w5b2V44CCYGZpbmRMYXRlc3ROZXdWYWx1ZWAg5Ye95pWwXG4gKiAgIOS9k+eOsOS6hui/meS4gOWOn+WIme+8jOWug+S4jeS/oeS7u+S7u+S9leS4tOaXtueahOWPmOmHj+W/q+eFp++8jOiAjOaYr+mAmui/h+Wbnua6ryBgRWRpdExvZ2Ag6ZO+5p2l5p+l5om+5LiA5Liq5Y+Y6YePXG4gKiAgIOWcqOeJueWumuaXtumXtOeCueS5i+WJjeeahOecn+WunuWAvOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgQ0hBVF9TQ09QRSwgTE9HU19QQVRILCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tayc7XG5pbXBvcnQgeyBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IEosIHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1yb2xsYmFjaycpO1xuXG4vKipcbiAqICoq44CQ5Zue5rua44CRKipcbiAqIOagueaNruS4gOS4que7meWumueahOa2iOaBr+WvhumSpe+8iE1L77yJ77yM57K+56Gu5Zyw5pKk6ZSA6K+l5raI5oGv5omA5byV5YWl55qE5omA5pyJ5Y+Y6YeP5Y+Y5pu044CCXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IE1LIC0g6KaB5Zue5rua55qE55uu5qCH5raI5oGv55qE5a+G6ZKl44CCXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtzaWxlbnQ9ZmFsc2VdIC0g5piv5ZCm5Li66Z2Z6buY5qih5byP44CC5Zyo6Z2Z6buY5qih5byP5LiL77yM5Ye95pWw5LiN5Lya6Ieq5bex6Kem5Y+R5pel5b+X5Yi35paw77yMXG4gKiAgIOi/meWcqCBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOetieaJuemHj+aTjeS9nOS4remdnuW4uOacieeUqO+8jOWPr+S7pemBv+WFjeS6p+eUn+Wkp+mHj+WGl+S9meaXpeW/l+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcm9sbGJhY2tCeU1rKE1LOiBzdHJpbmcsIHNpbGVudCA9IGZhbHNlKSB7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmxvZygncm9sbGJhY2tCeU1rJywgYOW8gOWni+Wbnua7miwgTUs9JHtNS31gKTtcbiAgICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKHYgPT4ge1xuICAgICAgY29uc3QgbWV0YSA9IF8uZ2V0KHYsIE1FVEFfREFUQV9QQVRILCB7fSk7XG4gICAgICBjb25zdCBzdGF0ID0gXy5nZXQodiwgU1RBVF9EQVRBX1BBVEgsIHt9KTtcblxuICAgICAgY29uc3QgcmF3ID0gXy5nZXQobWV0YSwgW0xPR1NfUEFUSCwgTUtdKTtcbiAgICAgIGNvbnN0IGFyciA9IHBhcnNlRWRpdExvZyhyYXcpO1xuICAgICAgaWYgKCFhcnIgfHwgIWFyci5sZW5ndGgpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdyb2xsYmFja0J5TWsnLCBgRWRpdExvZyDkuLrnqbrmiJbml6DmlYjvvIzot7Pov4flm57mu5rjgIJgKTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgICB9XG5cbiAgICAgIC8vIOWFs+mUru+8muW/hemhu+mAhuW6j+mBjeWOhiBFZGl0TG9nIOadpeaJp+ihjOWbnua7muOAglxuICAgICAgLy8g6L+Z56Gu5L+d5LqG5a+55ZCM5LiA5Y+Y6YeP55qE5aSa5qyh5L+u5pS56IO95aSf6KKr5q2j56Gu5Zyw44CB5oyJ55u45Y+N55qE6aG65bqP5pKk6ZSA44CCXG4gICAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhcnJbaV07XG4gICAgICAgIGNvbnN0IG9wID0gU3RyaW5nKGU/Lm9wIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBwYXRoID0gU3RyaW5nKGU/LnBhdGggfHwgJycpO1xuICAgICAgICBpZiAoIXBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAgIGlmIChvcCA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAvLyDlr7nkuo7igJzmj5LlhaXigJ3mk43kvZzvvIzlm57mu5rljbPkuLrigJzliKDpmaTigJ3jgIJcbiAgICAgICAgICBfLnVuc2V0KHN0YXQsIHBhdGgpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcCA9PT0gJ3VwZGF0ZScgfHwgb3AgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgLy8g5a+55LqO4oCc5pu05paw4oCd5oiW4oCc5Yig6Zmk4oCd5pON5L2c77yM5Zue5rua5Y2z5Li65oGi5aSN5Yiw4oCc5pen5YC84oCd44CCXG4gICAgICAgICAgaWYgKHR5cGVvZiBlPy52YWx1ZV9vbGQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzml6Xlv5fkuK3msqHmnInorrDlvZXml6flgLzvvIzmnIDlronlhajnmoTlm57mu5rmlrnlvI/mmK/nm7TmjqXliKDpmaTor6Xot6/lvoTjgIJcbiAgICAgICAgICAgIF8udW5zZXQoc3RhdCwgcGF0aCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF8uc2V0KHN0YXQsIHBhdGgsIF8uY2xvbmVEZWVwKGUudmFsdWVfb2xkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIF8uc2V0KHYsIFNUQVRfREFUQV9QQVRILCBzdGF0KTtcbiAgICAgIHJldHVybiB2O1xuICAgIH0sIENIQVRfU0NPUEUpO1xuICAgIGxvZ2dlci5sb2coJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlrozmiJDvvJpNSz0ke01LfWApO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlvILluLjvvJpNSz0ke01LfSDihpIgJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gIH1cbn1cblxuLyoqXG4gKiAqKuOAkOWOhuWPsui/vea6r+OAkSoqXG4gKiDlkJHkuIrov73muq/ogYrlpKnljoblj7LvvIzmn6Xmib7mn5DkuKrlj5jph4/ot6/lvoTlnKjmjIflrprmtojmga/kuYvliY3nmoTmnIDlkI7kuIDkuKrlgLwgKGB2YWx1ZV9uZXdgKeOAglxuICog6L+Z5piv5Li6IGBhcHBseUVkaXRBdExldmVsYCDlh73mlbDmj5DkvpvmlK/mjIHnmoTlhbPplK7ovoXliqnlh73mlbDvvIznlKjkuo7lnKjnlJ/miJAgYHVwZGF0ZWAg5pel5b+X5pe277yMXG4gKiDlh4bnoa7lnLDorrDlvZXkuIsgYHZhbHVlX29sZGDjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOimgeafpeaJvueahOWPmOmHj+eahOWujOaVtOi3r+W+hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0TWVzc2FnZUlkIC0g5LuO5q2k5raI5oGvIElEIOeahCoq5YmN5LiA5p2hKirmtojmga/lvIDlp4vlkJHkuIrmn6Xmib7jgIJcbiAqIEBwYXJhbSB7TG9nZ2VyfSBbbG9nZ2VyXSAtIOWPr+mAieeahCBMb2dnZXIg5a6e5L6L77yM55So5LqO6K6w5b2V6K+m57uG55qE6L+95rqv6L+H56iL44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fSDov5Tlm57mib7liLDnmoQgYHZhbHVlX25ld2DjgILlpoLmnpzov73muq/liLDogYrlpKnorrDlvZXnmoTlvIDlpLTpg73mnKrmib7liLDvvIzliJnov5Tlm54gYG51bGxg44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kTGF0ZXN0TmV3VmFsdWUocGF0aDogc3RyaW5nLCBzdGFydE1lc3NhZ2VJZDogbnVtYmVyLCBsb2dnZXI/OiBMb2dnZXIpOiBQcm9taXNlPGFueT4ge1xuICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5byA5aeL5Li66Lev5b6EIDwke3BhdGh9PiDku47mtojmga9JRCA8JHtzdGFydE1lc3NhZ2VJZH0+IOWQkeS4iui/vea6r+WOhuWPsuWAvC4uLmApO1xuICBjb25zdCBtZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IGZhbHNlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA8IDEpIHtcbiAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5raI5oGv5Y6G5Y+y5Li656m677yM5peg5rOV6L+95rqv44CCYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBzdGFydEluZGV4ID0gbWVzc2FnZXMuZmluZEluZGV4KG0gPT4gbS5tZXNzYWdlX2lkID09PSBzdGFydE1lc3NhZ2VJZCk7XG4gIGlmIChzdGFydEluZGV4ID09PSAtMSkge1xuICAgIGxvZ2dlcj8ud2FybignZmluZExhdGVzdE5ld1ZhbHVlJywgYOmUmeivr++8muWcqOa2iOaBr+WIl+ihqOS4reacquaJvuWIsOi1t+Wni+a2iOaBr0lEOiAke3N0YXJ0TWVzc2FnZUlkfWApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8g5LuO6LW35aeL5raI5oGv55qE5YmN5LiA5p2h5byA5aeL77yM5ZCR5LiK77yI5ZCR5pen77yJ6YGN5Y6G5Y6G5Y+y5raI5oGv44CCXG4gIGZvciAobGV0IGkgPSBzdGFydEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZXNbaV07XG4gICAgY29uc3QgbXNnSWQgPSBtZXNzYWdlPy5tZXNzYWdlX2lkO1xuICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgIGBb6L+b5bqmXSDmraPlnKjmo4Dmn6Xmtojmga8gKElEOiAke21zZ0lkfSnvvIzlhoXlrrk6IFwiJHsoZ2V0TWVzc2FnZUNvbnRlbnQobWVzc2FnZSkgfHwgJycpLnN1YnN0cmluZygwLCAxMDApfS4uLlwiYCxcbiAgICApO1xuXG4gICAgLy8g5L2/55SoIGlzVXNlck1lc3NhZ2Ug6L6F5Yqp5Ye95pWw77yM5bm25qOA5p+lIG1lc3NhZ2VfaWRcbiAgICBpZiAoaXNVc2VyTWVzc2FnZShtZXNzYWdlKSB8fCB0eXBlb2YgbXNnSWQgIT09ICdudW1iZXInKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtayA9IHJlYWRNZXNzYWdlS2V5KG1lc3NhZ2UpO1xuICAgIGlmICghbWspIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSDmtojmga8gKElEOiAke21zZ0lkfSkg5pegIE1L77yM6Lez6L+H44CCYCk7XG4gICAgICBjb250aW51ZTsgLy8g6Lez6L+H5rKh5pyJIE1LIOeahCBBSSDmtojmga/jgIJcbiAgICB9XG5cbiAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gICAgY29uc3QgZWRpdExvZ1JhdyA9IF8uZ2V0KG1ldGFEYXRhLCBbTE9HU19QQVRILCBta10pO1xuICAgIGNvbnN0IGVkaXRMb2cgPSBwYXJzZUVkaXRMb2coZWRpdExvZ1Jhdyk7XG5cbiAgICBpZiAoIWVkaXRMb2cgfHwgZWRpdExvZy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSBNSyAke21rfSDnmoQgRWRpdExvZyDkuLrnqbrvvIzot7Pov4fjgIJgKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDot7Pov4cgRWRpdExvZyDkuLrnqbrnmoTjgIJcbiAgICB9XG4gICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYFvov5vluqZdIOato+WcqOajgOafpSBNSyAke21rfSDnmoQgRWRpdExvZy4uLlxcbiR7SihlZGl0TG9nKX1gKTtcblxuICAgIC8vIOWFs+mUru+8muS7juWQjuWQkeWJjemBjeWOhuivpea2iOaBr+eahCBFZGl0TG9n77yM6L+Z5qC35om+5Yiw55qE56ys5LiA5Liq5Yy56YWN6aG55bCx5piv5pyA5paw55qE44CCXG4gICAgZm9yIChsZXQgaiA9IGVkaXRMb2cubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgIGNvbnN0IGxvZ0VudHJ5ID0gZWRpdExvZ1tqXTtcbiAgICAgIGlmICghbG9nRW50cnkgfHwgIWxvZ0VudHJ5LnBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAvLyBDYXNlIDE6IOeyvuehrui3r+W+hOWMuemFjeOAglxuICAgICAgaWYgKGxvZ0VudHJ5LnBhdGggPT09IHBhdGgpIHtcbiAgICAgICAgLy8g5aaC5p6c5Zyo5Y6G5Y+y6L+95rqv5Lit5om+5Yiw5LqGIGRlbGV0ZSDorrDlvZXvvIzov5nmhI/lkbPnnYDnirbmgIHlj6/og73kuI3kuIDoh7TjgIJcbiAgICAgICAgLy8g5Zug5Li6IGFwcGx5RWRpdEF0TGV2ZWwg55qE5YmN572u5qOA5p+l5bqU6Zi75q2i5a+55bey5Yig6Zmk5Y+Y6YeP55qE5pu05paw44CCXG4gICAgICAgIC8vIOiusOW9leS4gOS4qumUmeivr+S7peS+m+iwg+ivle+8jOW5tui/lOWbniBudWxs77yM5Zug5Li66K+l5Y+Y6YeP5Zyo6YC76L6R5LiK5piv5LiN5a2Y5Zyo55qE44CCXG4gICAgICAgIGlmIChsb2dFbnRyeS5vcCA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICBsb2dnZXI/LmVycm9yKFxuICAgICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgICBgPj4g54q25oCB5byC5bi4ISDlnKjmtojmga8oSUQ6JHttZXNzYWdlLm1lc3NhZ2VfaWR9LCBNSzoke21rfSnkuK3kuLrot6/lvoQgPCR7cGF0aH0+IOaJvuWIsOS6hiAnZGVsZXRlJyDorrDlvZXjgILov5nooajmmI4gdXBkYXRlIOaTjeS9nOWPr+iDveato+WcqOWwneivleS/ruaUueS4gOS4quW3suiiq+WIoOmZpOeahOWPmOmHj+OAgmAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw57K+56Gu6Lev5b6EIDwke3BhdGh9PiDnmoTlgLzkuLo6ICR7Sihsb2dFbnRyeS52YWx1ZV9uZXcpfWAsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBfLmNsb25lRGVlcChsb2dFbnRyeS52YWx1ZV9uZXcpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYXNlIDI6IOafpeaJvueahOi3r+W+hOaYr+aXpeW/l+adoeebrui3r+W+hOeahOWtkOi3r+W+hCAo5Y2zIGxvZ0VudHJ5LnBhdGgg5piv54i257qnKeOAglxuICAgICAgLy8g5L6L5aaCLCDmn6Xmib4gXCJhLmIuY1wiLCDogIzml6Xlv5fkuK3mnInlr7kgXCJhLmJcIiDnmoTkv67mlLnjgIJcbiAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgobG9nRW50cnkucGF0aCArICcuJykpIHtcbiAgICAgICAgY29uc3Qgc3ViUGF0aCA9IHBhdGguc3Vic3RyaW5nKGxvZ0VudHJ5LnBhdGgubGVuZ3RoICsgMSk7XG4gICAgICAgIGNvbnN0IHBhcmVudE5ld1ZhbCA9IGxvZ0VudHJ5LnZhbHVlX25ldztcbiAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXJlbnROZXdWYWwpICYmIF8uaGFzKHBhcmVudE5ld1ZhbCwgc3ViUGF0aCkpIHtcbiAgICAgICAgICBjb25zdCBmb3VuZFZhbCA9IF8uZ2V0KHBhcmVudE5ld1ZhbCwgc3ViUGF0aCk7XG4gICAgICAgICAgbG9nZ2VyPy5kZWJ1ZyhcbiAgICAgICAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw54i257qn6Lev5b6EIDwke2xvZ0VudHJ5LnBhdGh9Piwg5bm25LuO5Lit5o+Q5Y+W5a2Q6Lev5b6EIDwke3N1YlBhdGh9PiDnmoTlgLzkuLo6ICR7Sihmb3VuZFZhbCl9YCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBfLmNsb25lRGVlcChmb3VuZFZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyDlpoLmnpzov73muq/liLDogYrlpKnorrDlvZXnmoTlvIDlpLTpg73mnKrmib7liLDvvIzor7TmmI7ov5nmmK/or6Xlj5jph4/nmoTpppbmrKHlh7rnjrDjgIJcbiAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYOWQkeS4iui/vea6r+acquaJvuWIsOi3r+W+hCAke3BhdGh9IOeahOS7u+S9leWOhuWPsuWAvO+8jOWwhuS9v+eUqCBudWxsIOS9nOS4uuaXp+WAvGApO1xuICByZXR1cm4gbnVsbDtcbn1cblxuLypcbiAqIOaXp+eahCBjYWxpYnJhdGUg5Ye95pWw77yM5YW25qC45b+D5oCd5oOz5bey6KKr5ZC45pS26L+bIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg55qE5L+d6Zmp5py65Yi25Lit44CCXG4gKiDmraTlpITnmoTms6jph4rooqvkv53nlZnvvIzlm6DkuLrlroPmnoHlpb3lnLDop6Pph4rkuoYgRVJBIOahhuaetuWmguS9leW3p+WmmeWcsOW6lOWvuSBTaWxseVRhdmVybiDnmoTkuIDkuKrmoLjlv4PigJzmgKrnmZbigJ3jgIJcbiAqXG4gKiAjIyMg5qCh5YeG5Li75rWB56iL77ya5q+U6L6D4oCc5b2T5YmN5raI5oGv4oCd5LiO4oCc5LiK5qyh6YCJ5Lit55qE5raI5oGv4oCd5bm25Yip55So6YWS6aaG55qE54m55oCn5ben5aaZ5Zyw5L+u5aSN5Y+Y6YeP54q25oCB44CCXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiDov5nmmK8gRVJBIOWPmOmHj+ahhuaetuacgOaguOW/g+eahOWHveaVsOS5i+S4gO+8jOWug+ino+WGs+S6huS4gOS4qumdnuW4uOajmOaJi+eahOmXrumimO+8mioq5Yig6ZmkIHN3aXBlIOaXtueahOWPmOmHj+eKtuaAgeiHquWKqOS/ruWkjSoq44CCXG4gKlxuICogKirphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1Zyk6KipcbiAqIOW9k+WIoOmZpOS4gOadoSBzd2lwZSAo5L6L5aaC77yM5bim5pyJ5Y+Y6YePIGlkPTIg55qE5raI5oGvKSDml7bvvJpcbiAqIDEuICoq5YaF5a655LiO5Y+Y6YeP6ZSZ5L2NKio6IOWQjuS4gOadoSBzd2lwZSAoaWQ9Mykg55qEKirlhoXlrrkqKuS8muKAnOmhtuKAneWIsOiiq+WIoOmZpOeahCBzd2lwZSAoaWQ9Mikg55qE5L2N572u5LiK77yM5L2GKirlj5jph48qKuWNtOS/neeVmeS6hiBpZD0yIOeahOWPmOmHj+OAglxuICogMi4gKirlraTlhL/lj5jph4/mrovnlZkqKjog5Y6f5pys55qEIHN3aXBlIDMg5raI5oGv6Jm954S25Zyo55WM6Z2i5LiK5raI5aSx5LqG77yM5L2G5a6D5a+55bqU55qEKirmtojmga/lj5jph48qKiAoaWQ9Mykg5LuN54S25q6L55WZ5Zyo6IGK5aSp5pWw5o2u5Lit77yM5oiQ5Li64oCc5a2k5YS/5Y+Y6YeP4oCd44CCXG4gKiAzLiAqKuWtpOWEv+WPmOmHj+e7p+aJvyoqOiDlpoLmnpznlKjmiLfmraTml7blho0gc3dpcGUg5LiA5qyh77yM5paw55Sf5oiQ55qEIHN3aXBlIDMg5bCG5LyaKirnu6fmib8qKui/meS4quaui+eVmeeahOWtpOWEv+WPmOmHjyAoaWQ9MynvvIzlr7zoh7TmlrDlhoXlrrnphY3ml6flj5jph4/vvIzov5vkuIDmraXliqDliafnirbmgIHmt7fkubHjgIJcbiAqIDQuICoq57uT5p6cKio6IOaIkeS7rOW+l+WIsOS6huS4gOS4quWGheWuueaYryBpZD0z44CB5Y+Y6YeP5pivIGlkPTIg55qE4oCc5re35ZCI4oCd5raI5oGv77yM5bm25LiU6L+Y5pyJ5LiA5LiqIGlkPTMg55qE5a2k5YS/5Y+Y6YeP6ZqP5pe25Y+v6IO96KKr5paw5raI5oGv57un5om/77yM6YCg5oiQ5Lil6YeN55qE54q25oCB5LiN5LiA6Ie044CCXG4gKiA1LiAqKuaXoOeJueWumuS6i+S7tioqOiDmraTlpJbvvIzov5nkuKrmk43kvZzkuI3kvJrop6blj5Hku7vkvZXni6znibnnmoTkuovku7bvvIzlj6rkvJrop6blj5EgYGNoYXRfaWRfY2hhbmdlZGAg562J6YCa55So5LqL5Lu244CCXG4gKlxuICogKirmnKzlh73mlbDnmoTmoKHlh4blt6forqE6KipcbiAqIOacrOWHveaVsOeyvuehruWcsOWIqeeUqOS6huS4iui/sOKAnOeKtuaAgemUmeS9jeKAneadpeWujOaIkOiHquWKqOS/ruWkje+8mlxuICogMS4gYGNhbGlicmF0ZWAg6KKrIGBjaGF0X2lkX2NoYW5nZWRgIOS6i+S7tuinpuWPkeOAglxuICogMi4g5a6D5qOA5rWL5YiwIGBvbGRNS2Ag5a2Y5ZyoICjlroPorrDlvZXkuobooqvliKDpmaTmtojmga/nmoQgTUvvvIzljbMgaWQ9MiDnmoQgTUsp44CCXG4gKiAzLiAqKuaJp+ihjOWbnua7mioqOiBgYXBwbHlSb2xsYmFja0J5TUsob2xkTUspYCDooqvosIPnlKjvvIzlsIYgaWQ9MiDlvJXlhaXnmoTlj5jph4/kv67mlLnlhajpg6jmkqTplIDjgIJcbiAqIDQuICoq6Kem5Y+R6YeN5YaZKio6IGBldmVudEVtaXQoJ3JvbGxiYWNrX2RvbmVfcmVhcHBseV92YXJfc3RhcnQnKWAg6KKr6Kem5Y+R44CCXG4gKiA1LiBgQXBwbHlWYXJDaGFuZ2VgIOWHveaVsOWTjeW6lOmHjeWGmeS6i+S7tu+8jOivu+WPlioq5b2T5YmNKirmtojmga/nmoQqKuWGheWuuSoqICjnjrDlnKjmmK8gaWQ9MyDnmoTlhoXlrrkp77yM5bm25qC55o2u5a6D6YeN5paw5YaZ5YWl5Y+Y6YeP44CCXG4gKlxuICogKirmnIDnu4jmlYjmnpwqKjog4oCc5Zue5rua5LqG5pen55qEKGlkPTIp77yM6YeN5YaZ5LqG5paw55qEKGlkPTMp4oCd77yM5Y+Y6YeP54q25oCB6KKr5a6M576O5Zyw6Ieq5Yqo5L+u5aSN44CCXG4gKi9cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/rollback.ts\n\n}");
  },
  "./src/ERA变量框架/core/sync.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/core/sync.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceSyncLastAiMessage: () => (/* binding */ forceSyncLastAiMessage),\n/* harmony export */   resyncStateOnHistoryChange: () => (/* binding */ resyncStateOnHistoryChange)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _crud_patcher__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./crud/patcher */ \"./src/ERA变量框架/core/crud/patcher.ts\");\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_6__.Logger('core-sync');\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg) => {\n    const key = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!key)\n        return null;\n    return key;\n};\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks) => {\n    const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    for (const mk of mks) {\n        if (!mk)\n            continue; // 跳过 null (用户消息)\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_5__.parseEditLog)(editLogRaw);\n        if (editLog.length > 0) {\n            return false; // 发现一个非空 log，直接返回 false\n        }\n    }\n    return true; // 所有 log 都为空\n};\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nconst resyncStateOnHistoryChange = async (forceFullResync = false) => {\n    if (forceFullResync) {\n        logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    }\n    else {\n        logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n    const { meta: oldMetaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    const oldSelectedMks = _.cloneDeep(_.get(oldMetaData, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []));\n    logger.debug('resyncStateOnHistoryChange', `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`);\n    if (!allMessages || allMessages.length === 0) {\n        logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n        return;\n    }\n    let firstRecalcId = -1;\n    if (forceFullResync) {\n        firstRecalcId = 0;\n        logger.log('resyncStateOnHistoryChange', '强制模式：设置重算起点为 0。');\n    }\n    // Case 1: 消息被删除 (新列表比旧列表短)\n    else if (allMessages.length < oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息删除。');\n        // 从后往前，寻找第一个 \"currentMk === oldMk_at_same_index\" 的对齐点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[删除-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk === recordedMk) {\n                firstRecalcId = i + 1;\n                logger.log('resyncStateOnHistoryChange', `找到对齐点于 message_id=${i} (MK=${currentMk})。将从 ID ${firstRecalcId} 开始检查。`);\n                break;\n            }\n        }\n        if (firstRecalcId === -1) {\n            firstRecalcId = 0;\n            logger.log('resyncStateOnHistoryChange', '未找到任何对齐点，将从头开始检查。');\n        }\n        // 【优化】检查被删除的 MK 是否影响变量\n        // 稳健地找出被删除的 MK：对比新旧 MK 序列的差异\n        const currentMkSequence = allMessages.map(getMkFromMsg).filter(mk => mk);\n        const oldMkSequence = oldSelectedMks.filter(mk => mk);\n        const deletedMks = _.difference(oldMkSequence, currentMkSequence);\n        logger.debug('resyncStateOnHistoryChange', `旧MK序列: [${oldMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `新MK序列: [${currentMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `计算出的被删除MK: [${deletedMks.join(', ')}]`);\n        if (deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks)) {\n            logger.log('resyncStateOnHistoryChange', `检测到被删除的 ${deletedMks.length} 条消息均不含变量修改，执行快速同步。`);\n            const newSelectedMks = [];\n            for (let i = 0; i < allMessages.length; i++) {\n                newSelectedMks[i] = getMkFromMsg(allMessages[i]);\n            }\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n                return meta;\n            });\n            logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n            return;\n        }\n    }\n    // Case 2: 消息被修改/切换 (长度不变)\n    else if (allMessages.length === oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息长度不变，可能为修改或切换。');\n        // 从后往前，寻找第一个不匹配的点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[切换-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk !== recordedMk) {\n                firstRecalcId = i;\n            }\n        }\n        if (firstRecalcId === -1) {\n            logger.log('resyncStateOnHistoryChange', '所有MK均匹配，无需重算。');\n            // N.B. 在当前架构下，MK 已被直接写入消息内容，与内容强绑定。\n            // 因此，任何导致内容变化的操作（如 swipe）也必然会导致 MK 的变化。\n            // 这意味着，如果 MK 序列完全匹配，那么内容也必然完全匹配，无需进行任何重算或保险性检查。\n            return; // 直接返回，终止同步。\n        }\n        else {\n            logger.log('resyncStateOnHistoryChange', `找到最早的不匹配点于 message_id=${firstRecalcId}。将从该点开始重算。`);\n        }\n    }\n    // Case 3: 消息被添加 (新列表比旧列表长)\n    else {\n        logger.log('resyncStateOnHistoryChange', '检测到消息添加。');\n        // 将重算起点设置为新消息的起始索引，让同步流程统一处理\n        firstRecalcId = oldSelectedMks.length;\n        logger.log('resyncStateOnHistoryChange', `新增消息的写入逻辑已由同步流程接管。将从新增消息 (ID: ${firstRecalcId}) 开始处理。`);\n    }\n    // 3. 收集需要回滚的 MK 列表，并执行逆序回滚\n    if (firstRecalcId > -1) {\n        const mksToRollback = oldSelectedMks.slice(firstRecalcId).filter(mk => mk);\n        if (mksToRollback.length > 0) {\n            logger.log('resyncStateOnHistoryChange', `准备回滚 ${mksToRollback.length} 个MK: [${mksToRollback.join(', ')}]`);\n            for (const mk of mksToRollback.reverse()) {\n                logger.debug('resyncStateOnHistoryChange', `[回滚] 正在回滚 MK: ${mk}`);\n                await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(mk, true); // true 表示只回滚，不重写\n            }\n            logger.log('resyncStateOnHistoryChange', '逆序回滚完成。');\n        }\n    }\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n        const msg = allMessages[i];\n        logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}`);\n        const newMk = await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        newSelectedMks[i] = newMk; // 使用重算后的新 message_id (即 i) 作为索引\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n    // 5. 更新 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n        _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n        return meta;\n    });\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n    // ==================================================================\n    // 【保险机制】 - 已于 2025/10/02 移除\n    //\n    // **历史原因**:\n    // 该机制最初是为了解决一个旧架构下的“内容-变量错位”问题。在旧架构中，当删除一条 swipe 时，\n    // 后一条 swipe 的内容会“顶替”上来，但其底层的消息变量（及其 MK）却保持不变。\n    // 这导致主同步逻辑的 MK 比对失效，无法发现状态变化。\n    // 为此，保险机制被设计为：通过 `oldSelectedMks`（状态变更前的快照）找到被删除的旧 MK，\n    // 强制回滚它，然后根据当前可见的新内容重新写入变量，从而修复错位。\n    //\n    // **当前架构下的情况与移除原因**:\n    // 在当前架构中，MK 已被直接写入消息内容，与内容强绑定。当 swipe 导致内容变化时，MK 也会随之变化。\n    // 这使得主同步逻辑（逆序回滚、顺序重算）已经能够完全、正确地处理 swipe 等场景，不再需要此保险机制。\n    //\n    // 继续保留该机制不仅是冗余的，而且会主动引发 Bug：\n    // 它依然按照旧逻辑，使用 `oldSelectedMks` 回滚一个过时的、不相关的 MK，这会破坏主逻辑刚刚同步好的正确状态。\n    // 随后，在被破坏的状态上进行的重写操作会失败或产生错误结果（例如，生成一个空的 EditLog），\n    // 并覆盖掉之前由主逻辑正确生成的 EditLog，导致数据丢失。\n    //\n    // 综上，该机制已从“保险”变为“风险”，因此被完全注释掉。\n    // ==================================================================\n    // logger.log('resyncStateOnHistoryChange', '执行【保险机制】：无条件回滚并重写最后一楼...');\n    // const lastWrittenMk = [...oldSelectedMks].reverse().find(mk => mk);\n    // if (lastWrittenMk) {\n    //   logger.log('resyncStateOnHistoryChange', `找到最后一个写入的MK: ${lastWrittenMk}，执行回滚...`);\n    //   await rollbackByMk(lastWrittenMk, true);\n    //   logger.log('resyncStateOnHistoryChange', '回滚完成，准备根据当前最后一楼内容重写...');\n    //   await ApplyVarChange(); // ApplyVarChange 默认处理最后一楼\n    //   logger.log('resyncStateOnHistoryChange', '保险性重写完成。');\n    // } else {\n    //   logger.log('resyncStateOnHistoryChange', '未找到任何可供回滚的旧MK，跳过保险机制。');\n    // }\n};\n/**\n * **【强制同步最后一条AI消息】**\n * 这是一个用于特定场景的函数，例如由外部 API 触发，需要强制重算最后一条 AI 消息的变量。\n * 它解决了在消息内容被外部修改（但 MK 未变）时，状态无法自动更新的问题。\n *\n * **执行逻辑**:\n * 1. **定位**: 找到最后一条 AI 消息。\n * 2. **回滚**: 如果该消息存在且有 MK，则无条件回滚此 MK 引入的所有变量修改。\n * 3. **重算**: 立即根据该消息的**当前内容**重新计算变量，并生成新的 `EditLog`。\n * 4. **更新**: 将新的 MK 更新到 `SelectedMks` 数组的正确位置。\n *\n * **安全性**:\n * 此函数操作目标明确（最后一条 AI 消息），且回滚和重算在同一调用链中完成，\n * 避免了旧“保险机制”中因目标不明确而破坏 `resync` 状态的风险。\n */\nconst forceSyncLastAiMessage = async () => {\n    logger.log('forceSyncLastAiMessage', '启动强制同步最后一条 AI 消息...');\n    // 1. 定位\n    const msg = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.warn('forceSyncLastAiMessage', '未找到可供强制同步的 AI 消息。');\n        return;\n    }\n    const messageId = msg.message_id;\n    const MK = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!MK) {\n        logger.warn('forceSyncLastAiMessage', `消息 (ID: ${messageId}) 不含 MK，无法执行强制同步。将转为执行常规写入...`);\n        // 如果没有 MK，说明是新消息，直接走标准写入流程即可\n        await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        return;\n    }\n    logger.log('forceSyncLastAiMessage', `目标消息 (ID: ${messageId}, MK: ${MK})。`);\n    // 2. 回滚\n    logger.debug('forceSyncLastAiMessage', `正在回滚 MK: ${MK}...`);\n    await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(MK, true); // silent=true，避免不必要的日志刷新\n    // 3. 重算\n    logger.debug('forceSyncLastAiMessage', `回滚完成，正在根据当前内容重算 MK: ${MK}...`);\n    const newMK = await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n    // 4. 更新 SelectedMks\n    if (newMK) {\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n                selectedMks[messageId] = newMK;\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n                return meta;\n            });\n            logger.log('forceSyncLastAiMessage', `强制同步完成，已更新 SelectedMks[${messageId}] = ${newMK}`);\n        }\n        catch (e) {\n            logger.error('forceSyncLastAiMessage', `强制同步后更新 SelectedMks 失败: ${e?.message || e}`, e);\n        }\n    }\n    else {\n        logger.error('forceSyncLastAiMessage', `重算后未能获取新的 MK，SelectedMks 可能未更新。`);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvc3luYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWE7QUFFYjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFFc0Q7QUFDZjtBQUNXO0FBQ1g7QUFDd0I7QUFDckI7QUFDUDtBQUNvQjtBQUUxRCxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFdkM7Ozs7R0FJRztBQUNILE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBUSxFQUFpQixFQUFFO0lBQy9DLE1BQU0sR0FBRyxHQUFHLHVEQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEMsSUFBSSxDQUFDLEdBQUc7UUFBRSxPQUFPLElBQUksQ0FBQztJQUV0QixPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSCxNQUFNLHFCQUFxQixHQUFHLENBQUMsR0FBc0IsRUFBVyxFQUFFO0lBQ2hFLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsMkRBQVUsRUFBRSxDQUFDO0lBQ3hDLEtBQUssTUFBTSxFQUFFLElBQUksR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLEVBQUU7WUFBRSxTQUFTLENBQUMsaUJBQWlCO1FBQ3BDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsdURBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sT0FBTyxHQUFHLHlEQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE9BQU8sS0FBSyxDQUFDLENBQUMsd0JBQXdCO1FBQ3hDLENBQUM7SUFDSCxDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUMsQ0FBQyxhQUFhO0FBQzVCLENBQUMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSSxNQUFNLDBCQUEw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Q3ZFLE1BQU0sS0FBSyxHQUFHLE1BQU0sdUVBQXdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFbEQsb0JBQW9CO0lBQ3BCLElBQUksS0FBSyxFQUFFLENBQUM7UUFDVixJQUFJLENBQUM7WUFDSCxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDO2dCQUMvQixDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUNuQyxPQUFPLElBQUksQ0FBQztZQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSwwQkFBMEIsU0FBUyxPQUFPLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDMUYsQ0FBQztRQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSwyQkFBMkIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMxRixDQUFDO0lBQ0gsQ0FBQztTQUFNLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLGlDQUFpQyxDQUFDLENBQUM7SUFDNUUsQ0FBQztBQUNILENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvc3luYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGZpbGUg54q25oCB5ZCM5q2l5qC45b+DXG4gKiBAZGVzY3JpcHRpb24g5pys5paH5Lu25Lit55qEIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg5pivIEVSQSDlj5jph4/moYbmnrbmnIDmoLjlv4PnmoTlh73mlbDkuYvkuIDjgIJcbiAqIOWug+mAmui/h+WunueOsOKAnOmAhuW6j+Wbnua7mu+8jOmhuuW6j+mHjeeul+KAneeahOmAu+i+ke+8jOino+WGs+S6huWboOa2iOaBr+WIoOmZpOOAgeWIh+aNouWIhuaUryAoc3dpcGUpIOetieaTjeS9nOWvvOiHtOeahOWPmOmHj+eKtuaAgeS4jua2iOaBr+WOhuWPsuS4jeS4gOiHtOeahOajmOaJi+mXrumimOOAglxuICpcbiAqICMjIyDphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1ZylcbiAqXG4gKiDlvZPliKDpmaTkuIDmnaEgc3dpcGUgKOS+i+Wmgu+8jOW4puacieWPmOmHjyBpZD0yIOeahOa2iOaBrykg5pe277yaXG4gKiAxLiAqKuWGheWuueS4juWPmOmHj+mUmeS9jSoqOiDlkI7kuIDmnaEgc3dpcGUgKGlkPTMpIOeahCoq5YaF5a65KirkvJrigJzpobbigJ3liLDooqvliKDpmaTnmoQgc3dpcGUgKGlkPTIpIOeahOS9jee9ruS4iu+8jOS9hioq5Y+Y6YePKirljbTkv53nlZnkuoYgaWQ9MiDnmoTlj5jph4/jgIJcbiAqIDIuICoq5a2k5YS/5Y+Y6YeP5q6L55WZKio6IOWOn+acrOeahCBzd2lwZSAzIOa2iOaBr+iZveeEtuWcqOeVjOmdouS4iua2iOWkseS6hu+8jOS9huWug+WvueW6lOeahCoq5raI5oGv5Y+Y6YePKiogKGlkPTMpIOS7jeeEtuaui+eVmeWcqOiBiuWkqeaVsOaNruS4re+8jOaIkOS4uuKAnOWtpOWEv+WPmOmHj+KAneOAglxuICogMy4gKirlraTlhL/lj5jph4/nu6fmib8qKjog5aaC5p6c55So5oi35q2k5pe25YaNIHN3aXBlIOS4gOasoe+8jOaWsOeUn+aIkOeahCBzd2lwZSAzIOWwhuS8mioq57un5om/Kirov5nkuKrmrovnlZnnmoTlraTlhL/lj5jph48gKGlkPTMp77yM5a+86Ie05paw5YaF5a656YWN5pen5Y+Y6YeP77yM6L+b5LiA5q2l5Yqg5Ymn54q25oCB5re35Lmx44CCXG4gKiA0LiAqKue7k+aenCoqOiDmiJHku6zlvpfliLDkuobkuIDkuKrlhoXlrrnmmK8gaWQ9M+OAgeWPmOmHj+aYryBpZD0yIOeahOKAnOa3t+WQiOKAnea2iOaBr++8jOW5tuS4lOi/mOacieS4gOS4qiBpZD0zIOeahOWtpOWEv+WPmOmHj+maj+aXtuWPr+iDveiiq+aWsOa2iOaBr+e7p+aJv++8jOmAoOaIkOS4pemHjeeahOeKtuaAgeS4jeS4gOiHtOOAglxuICpcbiAqICMjIyDmnKzlh73mlbDnmoTop6PlhrPnrZbnlaVcbiAqXG4gKiBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOmAmui/h+WFqOmdoueahOeKtuaAgeavlOWvueadpeino+WGs+atpOmXrumimO+8mlxuICogMS4g5ZyoIGBtZXNzYWdlX2RlbGV0ZWRgLCBgbWVzc2FnZV9zd2lwZWRgIOetieS6i+S7tuinpuWPkeaXtuiiq+iwg+eUqOOAglxuICogMi4g5YWo6Z2i6I635Y+W5b2T5YmN5a6e6ZmF55qE5raI5oGv5YiX6KGo77yM5bm25LiO5LmL5YmN6K6w5b2V55qEIGBTZWxlY3RlZE1rc2Ag5bqP5YiX6L+b6KGM5q+U5a+544CCXG4gKiAzLiDnsr7noa7mib7liLDnrKzkuIDkuKrkuI3kuIDoh7TnmoTngrnvvIjml6DorrrmmK/liKDpmaTjgIHov5jmmK/kv67mlLnvvInjgIJcbiAqIDQuICoq6YCG5bqP5Zue5ruaKio6IOS7juWQjuW+gOWJje+8jOWwhuaJgOacieS4jeS4gOiHtOeahCBgTUtgIOaJgOW8leWFpeeahOWPmOmHj+S/ruaUueWFqOmDqOaSpOmUgOOAglxuICogNS4gKirpobrluo/ph43nrpcqKjog5LuO5LiN5LiA6Ie054K55byA5aeL77yM5qC55o2u5b2T5YmN5raI5oGv55qEKirlrp7pmYXlhoXlrrkqKu+8jOmHjeaWsOiuoeeul+W5tuWGmeWFpeWPmOmHj+OAglxuICpcbiAqICoq5pyA57uI5pWI5p6cKio6IOaXoOiuuuWOhuWPsuiusOW9leWPkeeUn+S9leenjeWPmOWMlu+8jOWPmOmHj+eKtuaAgemDveiDveiiq+WujOe+juWcsOiHquWKqOS/ruWkje+8jOehruS/neaVsOaNruS4gOiHtOaAp+OAglxuICovXG5cbmltcG9ydCB7IExPR1NfUEFUSCwgU0VMX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tayc7XG5pbXBvcnQgeyBmaW5kTGFzdEFpTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgcm9sbGJhY2tCeU1rIH0gZnJvbSAnLi9yb2xsYmFjayc7XG5pbXBvcnQgeyBnZXRFcmFEYXRhLCB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZSB9IGZyb20gJy4vY3J1ZC9wYXRjaGVyJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1zeW5jJyk7XG5cbi8qKlxuICog6I635Y+W55So5LqO5Y+Y6YeP5pON5L2c55qETUvjgILlpoLmnpzmtojmga/mmK/nlKjmiLfmtojmga/vvIzliJnov5Tlm55udWxs5Lul6Lez6L+H5pON5L2c44CCXG4gKiBAcGFyYW0gbXNnIOa2iOaBr+WvueixoVxuICogQHJldHVybnMgTUsg5a2X56ym5Liy5oiWIG51bGxcbiAqL1xuY29uc3QgZ2V0TWtGcm9tTXNnID0gKG1zZzogYW55KTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGtleSA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG4gIGlmICgha2V5KSByZXR1cm4gbnVsbDtcblxuICByZXR1cm4ga2V5O1xufTtcblxuLyoqXG4gKiDmo4Dmn6XkuIDnu4QgTUsg5a+55bqU55qEIEVkaXRMb2cg5piv5ZCm6YO95Li656m6XG4gKiBAcGFyYW0gbWtzIE1LIOWIl+ihqFxuICogQHJldHVybnMg5aaC5p6c5omA5pyJIEVkaXRMb2cg6YO95Li656m65YiZ6L+U5ZueIHRydWVcbiAqL1xuY29uc3QgY2hlY2tFZGl0TG9nc0FyZUVtcHR5ID0gKG1rczogKHN0cmluZyB8IG51bGwpW10pOiBib29sZWFuID0+IHtcbiAgY29uc3QgeyBtZXRhOiBtZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICBmb3IgKGNvbnN0IG1rIG9mIG1rcykge1xuICAgIGlmICghbWspIGNvbnRpbnVlOyAvLyDot7Pov4cgbnVsbCAo55So5oi35raI5oGvKVxuICAgIGNvbnN0IGVkaXRMb2dSYXcgPSBfLmdldChtZXRhRGF0YSwgW0xPR1NfUEFUSCwgbWtdKTtcbiAgICBjb25zdCBlZGl0TG9nID0gcGFyc2VFZGl0TG9nKGVkaXRMb2dSYXcpO1xuICAgIGlmIChlZGl0TG9nLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTsgLy8g5Y+R546w5LiA5Liq6Z2e56m6IGxvZ++8jOebtOaOpei/lOWbniBmYWxzZVxuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTsgLy8g5omA5pyJIGxvZyDpg73kuLrnqbpcbn07XG5cbi8qKlxuICog5b2T6IGK5aSp6K6w5b2V5Y+R55Sf5Y+Y5YyW77yI5Yig6Zmk44CB5YiH5o2i5YiG5pSv77yJ5pe277yM6YeN5paw5ZCM5q2l54q25oCB55qE5qC45b+D5Ye95pWwXG4gKiDlrp7njrDkuobigJzpgIbluo/lm57mu5rvvIzpobrluo/ph43nrpfigJ3nmoTpgLvovpFcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlRnVsbFJlc3luYz1mYWxzZV0gLSDlpoLmnpzkuLogdHJ1Ze+8jOWImeW8uuWItuS7juWktOW8gOWni+WujOWFqOmHjeeul++8jOW/veeVpeW3ruW8guajgOa1i+OAglxuICovXG5leHBvcnQgY29uc3QgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgPSBhc3luYyAoZm9yY2VGdWxsUmVzeW5jID0gZmFsc2UpID0+IHtcbiAgaWYgKGZvcmNlRnVsbFJlc3luYykge1xuICAgIGxvZ2dlci53YXJuKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLblrozlhajph43nrpfmqKHlvI/lt7LlkK/liqjvvIEnKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfogYrlpKnorrDlvZXlj5jmm7TvvIzlkK/liqjnirbmgIHlkIzmraUuLi4nKTtcbiAgfVxuXG4gIC8vIOaguOW/g+WBh+iuvu+8mmdldENoYXRNZXNzYWdlcyDkvJrph43mlrDnlJ/miJAgbWVzc2FnZV9pZO+8jOS9v+WFtuS/neaMgeS7jiAwIOW8gOWni+eahOi/nue7reW6j+WIl+OAglxuICBjb25zdCBhbGxNZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk7XG4gIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn6I635Y+W5Yiw55qEIGFsbE1lc3NhZ2VzOicsIGFsbE1lc3NhZ2VzKTtcbiAgY29uc3QgeyBtZXRhOiBvbGRNZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICBjb25zdCBvbGRTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBfLmNsb25lRGVlcChfLmdldChvbGRNZXRhRGF0YSwgU0VMX1BBVEgsIFtdKSk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgYOeKtuaAgeW/q+eFpzogb2xkU2VsZWN0ZWRNa3MubGVuZ3RoPSR7b2xkU2VsZWN0ZWRNa3MubGVuZ3RofSwgYWxsTWVzc2FnZXMubGVuZ3RoPSR7YWxsTWVzc2FnZXM/Lmxlbmd0aCA/PyAwfWAsXG4gICk7XG5cbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvZPliY3ogYrlpKnorrDlvZXkuLrnqbrvvIzkuI3miafooYzku7vkvZXmk43kvZzvvIzlkIzmraXnu4jmraLjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgZmlyc3RSZWNhbGNJZCA9IC0xO1xuXG4gIGlmIChmb3JjZUZ1bGxSZXN5bmMpIHtcbiAgICBmaXJzdFJlY2FsY0lkID0gMDtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLbmqKHlvI/vvJrorr7nva7ph43nrpfotbfngrnkuLogMOOAgicpO1xuICB9XG4gIC8vIENhc2UgMTog5raI5oGv6KKr5Yig6ZmkICjmlrDliJfooajmr5Tml6fliJfooajnn60pXG4gIGVsc2UgaWYgKGFsbE1lc3NhZ2VzLmxlbmd0aCA8IG9sZFNlbGVjdGVkTWtzLmxlbmd0aCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+WIoOmZpOOAgicpO1xuICAgIC8vIOS7juWQjuW+gOWJje+8jOWvu+aJvuesrOS4gOS4qiBcImN1cnJlbnRNayA9PT0gb2xkTWtfYXRfc2FtZV9pbmRleFwiIOeahOWvuem9kOeCuVxuICAgIGZvciAobGV0IGkgPSBhbGxNZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgY3VycmVudE1rID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIGNvbnN0IHJlY29yZGVkTWsgPSBvbGRTZWxlY3RlZE1rc1tpXTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgICAgYFvliKDpmaQt5a+56b2Q5qOA5p+lXSBpPSR7aX0sIGN1cnJlbnRNaz0ke2N1cnJlbnRNa30sIHJlY29yZGVkTWs9JHtyZWNvcmRlZE1rfWAsXG4gICAgICApO1xuXG4gICAgICBpZiAoY3VycmVudE1rID09PSByZWNvcmRlZE1rKSB7XG4gICAgICAgIGZpcnN0UmVjYWxjSWQgPSBpICsgMTtcbiAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICAgIGDmib7liLDlr7npvZDngrnkuo4gbWVzc2FnZV9pZD0ke2l9IChNSz0ke2N1cnJlbnRNa30p44CC5bCG5LuOIElEICR7Zmlyc3RSZWNhbGNJZH0g5byA5aeL5qOA5p+l44CCYCxcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgZmlyc3RSZWNhbGNJZCA9IDA7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlr7npvZDngrnvvIzlsIbku47lpLTlvIDlp4vmo4Dmn6XjgIInKTtcbiAgICB9XG5cbiAgICAvLyDjgJDkvJjljJbjgJHmo4Dmn6XooqvliKDpmaTnmoQgTUsg5piv5ZCm5b2x5ZON5Y+Y6YePXG4gICAgLy8g56iz5YGl5Zyw5om+5Ye66KKr5Yig6Zmk55qEIE1L77ya5a+55q+U5paw5penIE1LIOW6j+WIl+eahOW3ruW8glxuICAgIGNvbnN0IGN1cnJlbnRNa1NlcXVlbmNlID0gYWxsTWVzc2FnZXMubWFwKGdldE1rRnJvbU1zZykuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBvbGRNa1NlcXVlbmNlID0gb2xkU2VsZWN0ZWRNa3MuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBkZWxldGVkTWtzID0gXy5kaWZmZXJlbmNlKG9sZE1rU2VxdWVuY2UsIGN1cnJlbnRNa1NlcXVlbmNlKTtcblxuICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5penTUvluo/liJc6IFske29sZE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmlrBNS+W6j+WIlzogWyR7Y3VycmVudE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDorqHnrpflh7rnmoTooqvliKDpmaRNSzogWyR7ZGVsZXRlZE1rcy5qb2luKCcsICcpfV1gKTtcblxuICAgIGlmIChkZWxldGVkTWtzLmxlbmd0aCA+IDAgJiYgY2hlY2tFZGl0TG9nc0FyZUVtcHR5KGRlbGV0ZWRNa3MpKSB7XG4gICAgICBsb2dnZXIubG9nKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBg5qOA5rWL5Yiw6KKr5Yig6Zmk55qEICR7ZGVsZXRlZE1rcy5sZW5ndGh9IOadoea2iOaBr+Wdh+S4jeWQq+WPmOmHj+S/ruaUue+8jOaJp+ihjOW/q+mAn+WQjOatpeOAgmAsXG4gICAgICApO1xuICAgICAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbE1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG5ld1NlbGVjdGVkTWtzW2ldID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgbmV3U2VsZWN0ZWRNa3MpO1xuICAgICAgICByZXR1cm4gbWV0YTtcbiAgICAgIH0pO1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5b+r6YCf5ZCM5q2l5a6M5oiQ77yM5LuF5L+u5q2jIFNlbGVjdGVkTWtzIOaVsOe7hOOAgicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICAvLyBDYXNlIDI6IOa2iOaBr+iiq+S/ruaUuS/liIfmjaIgKOmVv+W6puS4jeWPmClcbiAgZWxzZSBpZiAoYWxsTWVzc2FnZXMubGVuZ3RoID09PSBvbGRTZWxlY3RlZE1rcy5sZW5ndGgpIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmo4DmtYvliLDmtojmga/plb/luqbkuI3lj5jvvIzlj6/og73kuLrkv67mlLnmiJbliIfmjaLjgIInKTtcbiAgICAvLyDku47lkI7lvoDliY3vvIzlr7vmib7nrKzkuIDkuKrkuI3ljLnphY3nmoTngrlcbiAgICBmb3IgKGxldCBpID0gYWxsTWVzc2FnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRNayA9IGdldE1rRnJvbU1zZyhhbGxNZXNzYWdlc1tpXSk7XG4gICAgICBjb25zdCByZWNvcmRlZE1rID0gb2xkU2VsZWN0ZWRNa3NbaV07XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgIGBb5YiH5o2iLeWvuem9kOajgOafpV0gaT0ke2l9LCBjdXJyZW50TWs9JHtjdXJyZW50TWt9LCByZWNvcmRlZE1rPSR7cmVjb3JkZWRNa31gLFxuICAgICAgKTtcbiAgICAgIGlmIChjdXJyZW50TWsgIT09IHJlY29yZGVkTWspIHtcbiAgICAgICAgZmlyc3RSZWNhbGNJZCA9IGk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5omA5pyJTUvlnYfljLnphY3vvIzml6DpnIDph43nrpfjgIInKTtcbiAgICAgIC8vIE4uQi4g5Zyo5b2T5YmN5p625p6E5LiL77yMTUsg5bey6KKr55u05o6l5YaZ5YWl5raI5oGv5YaF5a6577yM5LiO5YaF5a655by657uR5a6a44CCXG4gICAgICAvLyDlm6DmraTvvIzku7vkvZXlr7zoh7TlhoXlrrnlj5jljJbnmoTmk43kvZzvvIjlpoIgc3dpcGXvvInkuZ/lv4XnhLbkvJrlr7zoh7QgTUsg55qE5Y+Y5YyW44CCXG4gICAgICAvLyDov5nmhI/lkbPnnYDvvIzlpoLmnpwgTUsg5bqP5YiX5a6M5YWo5Yy56YWN77yM6YKj5LmI5YaF5a655Lmf5b+F54S25a6M5YWo5Yy56YWN77yM5peg6ZyA6L+b6KGM5Lu75L2V6YeN566X5oiW5L+d6Zmp5oCn5qOA5p+l44CCXG4gICAgICByZXR1cm47IC8vIOebtOaOpei/lOWbnu+8jOe7iOatouWQjOatpeOAglxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDml6nnmoTkuI3ljLnphY3ngrnkuo4gbWVzc2FnZV9pZD0ke2ZpcnN0UmVjYWxjSWR944CC5bCG5LuO6K+l54K55byA5aeL6YeN566X44CCYCk7XG4gICAgfVxuICB9XG4gIC8vIENhc2UgMzog5raI5oGv6KKr5re75YqgICjmlrDliJfooajmr5Tml6fliJfooajplb8pXG4gIGVsc2Uge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+a3u+WKoOOAgicpO1xuICAgIC8vIOWwhumHjeeul+i1t+eCueiuvue9ruS4uuaWsOa2iOaBr+eahOi1t+Wni+e0ouW8le+8jOiuqeWQjOatpea1geeoi+e7n+S4gOWkhOeQhlxuICAgIGZpcnN0UmVjYWxjSWQgPSBvbGRTZWxlY3RlZE1rcy5sZW5ndGg7XG4gICAgbG9nZ2VyLmxvZyhcbiAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICBg5paw5aKe5raI5oGv55qE5YaZ5YWl6YC76L6R5bey55Sx5ZCM5q2l5rWB56iL5o6l566h44CC5bCG5LuO5paw5aKe5raI5oGvIChJRDogJHtmaXJzdFJlY2FsY0lkfSkg5byA5aeL5aSE55CG44CCYCxcbiAgICApO1xuICB9XG5cbiAgLy8gMy4g5pS26ZuG6ZyA6KaB5Zue5rua55qEIE1LIOWIl+ihqO+8jOW5tuaJp+ihjOmAhuW6j+Wbnua7mlxuICBpZiAoZmlyc3RSZWNhbGNJZCA+IC0xKSB7XG4gICAgY29uc3QgbWtzVG9Sb2xsYmFjayA9IG9sZFNlbGVjdGVkTWtzLnNsaWNlKGZpcnN0UmVjYWxjSWQpLmZpbHRlcihtayA9PiBtaykgYXMgc3RyaW5nW107XG4gICAgaWYgKG1rc1RvUm9sbGJhY2subGVuZ3RoID4gMCkge1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5YeG5aSH5Zue5ruaICR7bWtzVG9Sb2xsYmFjay5sZW5ndGh9IOS4qk1LOiBbJHtta3NUb1JvbGxiYWNrLmpvaW4oJywgJyl9XWApO1xuICAgICAgZm9yIChjb25zdCBtayBvZiBta3NUb1JvbGxiYWNrLnJldmVyc2UoKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvlm57mu5pdIOato+WcqOWbnua7miBNSzogJHtta31gKTtcbiAgICAgICAgYXdhaXQgcm9sbGJhY2tCeU1rKG1rLCB0cnVlKTsgLy8gdHJ1ZSDooajnpLrlj6rlm57mu5rvvIzkuI3ph43lhplcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+mAhuW6j+Wbnua7muWujOaIkOOAgicpO1xuICAgIH1cbiAgfVxuXG4gIC8vIDQuIOS7juS4jeWMuemFjeeCueW8gOWni++8jOmhuuW6j+mHjeaWsOW6lOeUqOWPmOmHj+S/ruaUue+8jOW5tuaehOW7uuaWsOeahCBzZWxlY3RlZE1rc1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDku44gSUQgJHtmaXJzdFJlY2FsY0lkfSDlvIDlp4vpobrluo/ph43nrpcuLi5gKTtcbiAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gb2xkU2VsZWN0ZWRNa3Muc2xpY2UoMCwgZmlyc3RSZWNhbGNJZCk7IC8vIOe7p+aJv+WMuemFjemDqOWIhlxuXG4gIGZvciAobGV0IGkgPSBmaXJzdFJlY2FsY0lkOyBpIDwgYWxsTWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBtc2cgPSBhbGxNZXNzYWdlc1tpXTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvph43nrpddIOato+WcqOWkhOeQhua2iOaBr+e0ouW8lTogJHtpfWApO1xuICAgIGNvbnN0IG5ld01rID0gYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4gICAgbmV3U2VsZWN0ZWRNa3NbaV0gPSBuZXdNazsgLy8g5L2/55So6YeN566X5ZCO55qE5pawIG1lc3NhZ2VfaWQgKOWNsyBpKSDkvZzkuLrntKLlvJVcbiAgfVxuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfpobrluo/ph43nrpflrozmiJDjgIInKTtcblxuICAvLyA1LiDmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uEXG4gIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBuZXdTZWxlY3RlZE1rcyk7XG4gICAgcmV0dXJuIG1ldGE7XG4gIH0pO1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfnirbmgIHlkIzmraXlrozmiJDjgIInKTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g44CQ5L+d6Zmp5py65Yi244CRIC0g5bey5LqOIDIwMjUvMTAvMDIg56e76ZmkXG4gIC8vXG4gIC8vICoq5Y6G5Y+y5Y6f5ZugKio6XG4gIC8vIOivpeacuuWItuacgOWIneaYr+S4uuS6huino+WGs+S4gOS4quaXp+aetuaehOS4i+eahOKAnOWGheWuuS3lj5jph4/plJnkvY3igJ3pl67popjjgILlnKjml6fmnrbmnoTkuK3vvIzlvZPliKDpmaTkuIDmnaEgc3dpcGUg5pe277yMXG4gIC8vIOWQjuS4gOadoSBzd2lwZSDnmoTlhoXlrrnkvJrigJzpobbmm7/igJ3kuIrmnaXvvIzkvYblhbblupXlsYLnmoTmtojmga/lj5jph4/vvIjlj4rlhbYgTUvvvInljbTkv53mjIHkuI3lj5jjgIJcbiAgLy8g6L+Z5a+86Ie05Li75ZCM5q2l6YC76L6R55qEIE1LIOavlOWvueWkseaViO+8jOaXoOazleWPkeeOsOeKtuaAgeWPmOWMluOAglxuICAvLyDkuLrmraTvvIzkv53pmanmnLrliLbooqvorr7orqHkuLrvvJrpgJrov4cgYG9sZFNlbGVjdGVkTWtzYO+8iOeKtuaAgeWPmOabtOWJjeeahOW/q+eFp++8ieaJvuWIsOiiq+WIoOmZpOeahOaXpyBNS++8jFxuICAvLyDlvLrliLblm57mu5rlroPvvIznhLblkI7moLnmja7lvZPliY3lj6/op4HnmoTmlrDlhoXlrrnph43mlrDlhpnlhaXlj5jph4/vvIzku47ogIzkv67lpI3plJnkvY3jgIJcbiAgLy9cbiAgLy8gKirlvZPliY3mnrbmnoTkuIvnmoTmg4XlhrXkuI7np7vpmaTljp/lm6AqKjpcbiAgLy8g5Zyo5b2T5YmN5p625p6E5Lit77yMTUsg5bey6KKr55u05o6l5YaZ5YWl5raI5oGv5YaF5a6577yM5LiO5YaF5a655by657uR5a6a44CC5b2TIHN3aXBlIOWvvOiHtOWGheWuueWPmOWMluaXtu+8jE1LIOS5n+S8mumaj+S5i+WPmOWMluOAglxuICAvLyDov5nkvb/lvpfkuLvlkIzmraXpgLvovpHvvIjpgIbluo/lm57mu5rjgIHpobrluo/ph43nrpfvvInlt7Lnu4/og73lpJ/lrozlhajjgIHmraPnoa7lnLDlpITnkIYgc3dpcGUg562J5Zy65pmv77yM5LiN5YaN6ZyA6KaB5q2k5L+d6Zmp5py65Yi244CCXG4gIC8vXG4gIC8vIOe7p+e7reS/neeVmeivpeacuuWItuS4jeS7heaYr+WGl+S9meeahO+8jOiAjOS4lOS8muS4u+WKqOW8leWPkSBCdWfvvJpcbiAgLy8g5a6D5L6d54S25oyJ54Wn5pen6YC76L6R77yM5L2/55SoIGBvbGRTZWxlY3RlZE1rc2Ag5Zue5rua5LiA5Liq6L+H5pe255qE44CB5LiN55u45YWz55qEIE1L77yM6L+Z5Lya56C05Z2P5Li76YC76L6R5Yia5Yia5ZCM5q2l5aW955qE5q2j56Gu54q25oCB44CCXG4gIC8vIOmaj+WQju+8jOWcqOiiq+egtOWdj+eahOeKtuaAgeS4iui/m+ihjOeahOmHjeWGmeaTjeS9nOS8muWksei0peaIluS6p+eUn+mUmeivr+e7k+aenO+8iOS+i+Wmgu+8jOeUn+aIkOS4gOS4quepuueahCBFZGl0TG9n77yJ77yMXG4gIC8vIOW5tuimhuebluaOieS5i+WJjeeUseS4u+mAu+i+keato+ehrueUn+aIkOeahCBFZGl0TG9n77yM5a+86Ie05pWw5o2u5Lii5aSx44CCXG4gIC8vXG4gIC8vIOe7vOS4iu+8jOivpeacuuWItuW3suS7juKAnOS/nemZqeKAneWPmOS4uuKAnOmjjumZqeKAne+8jOWboOatpOiiq+WujOWFqOazqOmHiuaOieOAglxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5omn6KGM44CQ5L+d6Zmp5py65Yi244CR77ya5peg5p2h5Lu25Zue5rua5bm26YeN5YaZ5pyA5ZCO5LiA5qW8Li4uJyk7XG4gIC8vIGNvbnN0IGxhc3RXcml0dGVuTWsgPSBbLi4ub2xkU2VsZWN0ZWRNa3NdLnJldmVyc2UoKS5maW5kKG1rID0+IG1rKTtcbiAgLy8gaWYgKGxhc3RXcml0dGVuTWspIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDlkI7kuIDkuKrlhpnlhaXnmoRNSzogJHtsYXN0V3JpdHRlbk1rfe+8jOaJp+ihjOWbnua7mi4uLmApO1xuICAvLyAgIGF3YWl0IHJvbGxiYWNrQnlNayhsYXN0V3JpdHRlbk1rLCB0cnVlKTtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflm57mu5rlrozmiJDvvIzlh4blpIfmoLnmja7lvZPliY3mnIDlkI7kuIDmpbzlhoXlrrnph43lhpkuLi4nKTtcbiAgLy8gICBhd2FpdCBBcHBseVZhckNoYW5nZSgpOyAvLyBBcHBseVZhckNoYW5nZSDpu5jorqTlpITnkIbmnIDlkI7kuIDmpbxcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfkv53pmanmgKfph43lhpnlrozmiJDjgIInKTtcbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlj6/kvpvlm57mu5rnmoTml6dNS++8jOi3s+i/h+S/nemZqeacuuWItuOAgicpO1xuICAvLyB9XG59O1xuXG4vKipcbiAqICoq44CQ5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hQUnmtojmga/jgJEqKlxuICog6L+Z5piv5LiA5Liq55So5LqO54m55a6a5Zy65pmv55qE5Ye95pWw77yM5L6L5aaC55Sx5aSW6YOoIEFQSSDop6blj5HvvIzpnIDopoHlvLrliLbph43nrpfmnIDlkI7kuIDmnaEgQUkg5raI5oGv55qE5Y+Y6YeP44CCXG4gKiDlroPop6PlhrPkuoblnKjmtojmga/lhoXlrrnooqvlpJbpg6jkv67mlLnvvIjkvYYgTUsg5pyq5Y+Y77yJ5pe277yM54q25oCB5peg5rOV6Ieq5Yqo5pu05paw55qE6Zeu6aKY44CCXG4gKlxuICogKirmiafooYzpgLvovpEqKjpcbiAqIDEuICoq5a6a5L2NKio6IOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIDIuICoq5Zue5ruaKio6IOWmguaenOivpea2iOaBr+WtmOWcqOS4lOaciSBNS++8jOWImeaXoOadoeS7tuWbnua7muatpCBNSyDlvJXlhaXnmoTmiYDmnInlj5jph4/kv67mlLnjgIJcbiAqIDMuICoq6YeN566XKio6IOeri+WNs+agueaNruivpea2iOaBr+eahCoq5b2T5YmN5YaF5a65Kirph43mlrDorqHnrpflj5jph4/vvIzlubbnlJ/miJDmlrDnmoQgYEVkaXRMb2dg44CCXG4gKiA0LiAqKuabtOaWsCoqOiDlsIbmlrDnmoQgTUsg5pu05paw5YiwIGBTZWxlY3RlZE1rc2Ag5pWw57uE55qE5q2j56Gu5L2N572u44CCXG4gKlxuICogKirlronlhajmgKcqKjpcbiAqIOatpOWHveaVsOaTjeS9nOebruagh+aYjuehru+8iOacgOWQjuS4gOadoSBBSSDmtojmga/vvInvvIzkuJTlm57mu5rlkozph43nrpflnKjlkIzkuIDosIPnlKjpk77kuK3lrozmiJDvvIxcbiAqIOmBv+WFjeS6huaXp+KAnOS/nemZqeacuuWItuKAneS4reWboOebruagh+S4jeaYjuehruiAjOegtOWdjyBgcmVzeW5jYCDnirbmgIHnmoTpo47pmanjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IGZvcmNlU3luY0xhc3RBaU1lc3NhZ2UgPSBhc3luYyAoKSA9PiB7XG4gIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5ZCv5Yqo5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hIEFJIOa2iOaBry4uLicpO1xuXG4gIC8vIDEuIOWumuS9jVxuICBjb25zdCBtc2cgPSBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5pyq5om+5Yiw5Y+v5L6b5by65Yi25ZCM5q2l55qEIEFJIOa2iOaBr+OAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuICBjb25zdCBNSyA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG5cbiAgaWYgKCFNSykge1xuICAgIGxvZ2dlci53YXJuKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5LiN5ZCrIE1L77yM5peg5rOV5omn6KGM5by65Yi25ZCM5q2l44CC5bCG6L2s5Li65omn6KGM5bi46KeE5YaZ5YWlLi4uYCk7XG4gICAgLy8g5aaC5p6c5rKh5pyJIE1L77yM6K+05piO5piv5paw5raI5oGv77yM55u05o6l6LWw5qCH5YeG5YaZ5YWl5rWB56iL5Y2z5Y+vXG4gICAgYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDnm67moIfmtojmga8gKElEOiAke21lc3NhZ2VJZH0sIE1LOiAke01LfSnjgIJgKTtcblxuICAvLyAyLiDlm57mu5pcbiAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOato+WcqOWbnua7miBNSzogJHtNS30uLi5gKTtcbiAgYXdhaXQgcm9sbGJhY2tCeU1rKE1LLCB0cnVlKTsgLy8gc2lsZW50PXRydWXvvIzpgb/lhY3kuI3lv4XopoHnmoTml6Xlv5fliLfmlrBcblxuICAvLyAzLiDph43nrpdcbiAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOWbnua7muWujOaIkO+8jOato+WcqOagueaNruW9k+WJjeWGheWuuemHjeeulyBNSzogJHtNS30uLi5gKTtcbiAgY29uc3QgbmV3TUsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcblxuICAvLyA0LiDmm7TmlrAgU2VsZWN0ZWRNa3NcbiAgaWYgKG5ld01LKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1rcyA9IF8uZ2V0KG1ldGEsIFNFTF9QQVRILCBbXSk7XG4gICAgICAgIHNlbGVjdGVkTWtzW21lc3NhZ2VJZF0gPSBuZXdNSztcbiAgICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbiAgICAgICAgcmV0dXJuIG1ldGE7XG4gICAgICB9KTtcbiAgICAgIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5by65Yi25ZCM5q2l5a6M5oiQ77yM5bey5pu05pawIFNlbGVjdGVkTWtzWyR7bWVzc2FnZUlkfV0gPSAke25ld01LfWApO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOW8uuWItuWQjOatpeWQjuabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg6YeN566X5ZCO5pyq6IO96I635Y+W5paw55qEIE1L77yMU2VsZWN0ZWRNa3Mg5Y+v6IO95pyq5pu05paw44CCYCk7XG4gIH1cbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/sync.ts\n\n}");
  },
  "./src/ERA变量框架/events/dispatcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/events/dispatcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dispatchAndExecuteTask: () => (/* binding */ dispatchAndExecuteTask)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _api_command__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/command */ \"./src/ERA变量框架/api/command.ts\");\n/* harmony import */ var _api_macro_patch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../api/macro/patch */ \"./src/ERA变量框架/api/macro/patch.ts\");\n/* harmony import */ var _core_crud_patcher__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../core/crud/patcher */ \"./src/ERA变量框架/core/crud/patcher.ts\");\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _core_rollback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../core/rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _core_sync__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../core/sync */ \"./src/ERA变量框架/core/sync.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_9__.Logger('events-dispatcher');\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n/**\n * **【辅助函数】处理由 MK 注入触发的冗余渲染事件**\n * @param eventType - 当前事件的类型。\n * @param currentMk - 当前消息的 MK。\n * @param mkToIgnore - 当前的忽略规则。\n * @returns {{ shouldSkip: boolean; newIgnoreRule: IgnoreRule | null }} - 返回是否应跳过此事件，以及更新后的忽略规则。\n */\nfunction handleRedundantRenderEvent(eventType, currentMk, mkToIgnore) {\n    if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && currentMk === mkToIgnore.mk) {\n        logger.log('handleRedundantRenderEvent', `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`);\n        mkToIgnore.ignoreCount--;\n        if (mkToIgnore.ignoreCount <= 0) {\n            mkToIgnore = null; // 忽略次数用完，重置\n            logger.log('handleRedundantRenderEvent', `忽略次数用完`);\n        }\n        return { shouldSkip: true, newIgnoreRule: mkToIgnore };\n    }\n    return { shouldSkip: false, newIgnoreRule: mkToIgnore };\n}\n/**\n * **【任务执行器】**\n * 负责执行单个事件任务，包含所有前置、后置处理和错误捕获。\n * @param {EventJob} job - 要执行的事件任务。\n * @param {IgnoreRule | null} mkToIgnore - 当前的忽略规则。\n * @param {ConsecutiveMkState | null} consecutiveMkState - 当前的连续处理计数状态。\n * @returns {Promise<{\n *   newIgnoreRule: IgnoreRule | null;\n *   newConsecutiveMkState: ConsecutiveMkState | null;\n * }>} - 返回更新后的状态。\n */\nasync function dispatchAndExecuteTask(job, mkToIgnore, consecutiveMkState) {\n    const { type: eventType, detail } = job;\n    const eventGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_10__.getEventGroup)(eventType);\n    let message_id = null;\n    let currentConsecutiveCount = 1;\n    // 在每轮任务开始时，初始化操作记录器\n    const actionsTaken = { rollback: false, apply: false, resync: false, api: false };\n    try {\n        // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n        const { mk, message_id: msgId, isNewKey } = await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_4__.ensureMkForLatestMessage)();\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = mk;\n        message_id = msgId;\n        // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就创建或更新忽略规则。\n        if (isNewKey && mk) {\n            mkToIgnore = {\n                mk: mk,\n                ignoreCount: RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n            };\n        }\n        // **核心优化**: 检查并处理由 MK 注入触发的冗余渲染事件。\n        const { shouldSkip, newIgnoreRule } = handleRedundantRenderEvent(eventType, mk, mkToIgnore);\n        mkToIgnore = newIgnoreRule; // 更新忽略规则的状态\n        if (shouldSkip) {\n            // 如果事件被忽略，则直接返回，不更新连续处理计数\n            return { newIgnoreRule: mkToIgnore, newConsecutiveMkState: consecutiveMkState };\n        }\n        // **只有在事件不被忽略时，才更新连续处理计数**\n        if (mk && consecutiveMkState && consecutiveMkState.mk === mk) {\n            consecutiveMkState.count++;\n        }\n        else {\n            consecutiveMkState = { mk: mk, count: 1 };\n        }\n        currentConsecutiveCount = consecutiveMkState.count;\n        logger.log('dispatchAndExecuteTask', `执行任务: ${eventType} (分组: ${eventGroup})`);\n        // **任务分发**\n        logger.debug('dispatchAndExecuteTask - task dispatch', `分发事件: ${eventType}`, { detail, eventGroup });\n        if (eventGroup === 'WRITE') {\n            // 关键：写入前先回滚，确保操作的幂等性。\n            // 即使事件被意外触发多次，也只会产生一次有效写入。\n            const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n            if (msg) {\n                const MK = (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_4__.readMessageKey)(msg);\n                if (MK) {\n                    await (0,_core_rollback__WEBPACK_IMPORTED_MODULE_5__.rollbackByMk)(MK, true);\n                    actionsTaken.rollback = true;\n                }\n            }\n            await (0,_core_crud_patcher__WEBPACK_IMPORTED_MODULE_3__.ApplyVarChange)();\n            actionsTaken.apply = true;\n            // 在变量写入完成后，强制重新渲染消息以触发宏\n            (0,_api_macro_patch__WEBPACK_IMPORTED_MODULE_2__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'SYNC') {\n            logger.debug('dispatchAndExecuteTask - task dispatch', `事件 ${eventType} 触发状态同步流程...`);\n            const isFullSync = eventType === 'manual_full_sync';\n            await (0,_core_sync__WEBPACK_IMPORTED_MODULE_6__.resyncStateOnHistoryChange)(isFullSync);\n            actionsTaken.resync = true;\n            // 在同步完成后，强制重新渲染消息以触发宏\n            (0,_api_macro_patch__WEBPACK_IMPORTED_MODULE_2__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'API') {\n            actionsTaken.api = true;\n            // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n            if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.INSERT_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.UPDATE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.INSERT_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.UPDATE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.DELETE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.DELETE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByPath)(detail.path);\n        }\n        else if (eventGroup === 'UPDATE_MK_ONLY') {\n            // 监听此事件仅用于为用户消息创建 MK。\n            await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_4__.updateLatestSelectedMk)();\n        }\n    }\n    catch (error) {\n        logger.error('dispatchAndExecuteTask', `事件 ${eventType} 处理异常: ${error}`, error);\n    }\n    finally {\n        // 仅当本轮处理中实际执行了 ERA 核心操作时，才校准并广播事件\n        // --- 3. 触发写入完成事件 ---\n        if (actionsTaken.rollback || actionsTaken.apply || actionsTaken.resync || actionsTaken.api) {\n            // **后置保障**: 强制校准 `SelectedMks` 的最新记录。\n            await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_4__.updateLatestSelectedMk)();\n            // 在所有操作（包括校准）完成后，获取最新状态并广播事件\n            if (_utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk && message_id !== null) {\n                const { meta: metaData, stat: statData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.getEraData)();\n                const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_7__.SEL_PATH, []);\n                const editLogs = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_7__.LOGS_PATH, {});\n                const statWithoutMeta = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.removeMetaFields)(statData);\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.emitWriteDoneEvent)({\n                    mk: _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk,\n                    message_id: message_id,\n                    actions: actionsTaken,\n                    selectedMks: selectedMks,\n                    editLogs: editLogs,\n                    stat: statData,\n                    statWithoutMeta: statWithoutMeta,\n                    consecutiveProcessingCount: currentConsecutiveCount,\n                });\n            }\n        }\n        // 清理日志上下文，为下一个事件做准备\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = '';\n        // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n        //暂时取消等待逻辑，提高即时性。\n        //await new Promise(resolve => setTimeout(resolve, 50));\n    }\n    return { newIgnoreRule: mkToIgnore, newConsecutiveMkState: consecutiveMkState };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9kaXNwYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBYTtBQUVVO0FBU0M7QUFDdUM7QUFDVDtBQUM0QztBQUNsRDtBQUNVO0FBQ2U7QUFDUjtBQUNmO0FBQ0M7QUFFbkQsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFFL0M7Ozs7R0FJRztBQUNILE1BQU0sMENBQTBDLEdBQUcsQ0FBQyxDQUFDO0FBb0JyRDs7Ozs7O0dBTUc7QUFDSCxTQUFTLDBCQUEwQixDQUNqQyxTQUFpQixFQUNqQixTQUF3QixFQUN4QixVQUE2QjtJQUU3QixJQUFJLFVBQVUsSUFBSSxTQUFTLEtBQUssYUFBYSxDQUFDLDBCQUEwQixJQUFJLFNBQVMsS0FBSyxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDeEcsTUFBTSxDQUFDLEdBQUcsQ0FDUiw0QkFBNEIsRUFDNUIsV0FBVyxVQUFVLENBQUMsRUFBRSx5QkFBeUIsVUFBVSxDQUFDLFdBQVcsR0FBRyxDQUFDLEVBQUUsQ0FDOUUsQ0FBQztRQUNGLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN6QixJQUFJLFVBQVUsQ0FBQyxXQUFXLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDaEMsVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLFlBQVk7WUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBQ0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxDQUFDO0lBQ3pELENBQUM7SUFDRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLENBQUM7QUFDMUQsQ0FBQztBQUVEOzs7Ozs7Ozs7O0dBVUc7QUFDSSxLQUFLLFVBQVUsc0JBQXNCLENBQzFDLEdBQWEsRUFDYixVQUE2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b0JBQW9CO1FBQ3BCLGtEQUFVLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUVuQiw0Q0FBNEM7UUFDNUMsaUJBQWlCO1FBQ2pCLHdEQUF3RDtJQUMxRCxDQUFDO0lBRUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUscUJBQXFCLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQztBQUNsRixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2Rpc3BhdGNoZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgZGVsZXRlQnlPYmplY3QsXG4gIGRlbGV0ZUJ5UGF0aCxcbiAgZW1pdFdyaXRlRG9uZUV2ZW50LFxuICBpbnNlcnRCeU9iamVjdCxcbiAgaW5zZXJ0QnlQYXRoLFxuICB1cGRhdGVCeU9iamVjdCxcbiAgdXBkYXRlQnlQYXRoLFxufSBmcm9tICcuLi9hcGkvY29tbWFuZCc7XG5pbXBvcnQgeyBmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzIH0gZnJvbSAnLi4vYXBpL21hY3JvL3BhdGNoJztcbmltcG9ydCB7IEFwcGx5VmFyQ2hhbmdlIH0gZnJvbSAnLi4vY29yZS9jcnVkL3BhdGNoZXInO1xuaW1wb3J0IHsgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlLCByZWFkTWVzc2FnZUtleSwgdXBkYXRlTGF0ZXN0U2VsZWN0ZWRNayB9IGZyb20gJy4uL2NvcmUva2V5L21rJztcbmltcG9ydCB7IHJvbGxiYWNrQnlNayB9IGZyb20gJy4uL2NvcmUvcm9sbGJhY2snO1xuaW1wb3J0IHsgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgfSBmcm9tICcuLi9jb3JlL3N5bmMnO1xuaW1wb3J0IHsgRVJBX0FQSV9FVkVOVFMsIExPR1NfUEFUSCwgU0VMX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgcmVtb3ZlTWV0YUZpZWxkcyB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IGxvZ0NvbnRleHQsIExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBFdmVudEpvYiwgZ2V0RXZlbnRHcm91cCB9IGZyb20gJy4vbWVyZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLWRpc3BhdGNoZXInKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge251bWJlcn0gUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OXG4gKiBAZGVzY3JpcHRpb24g5b2TIGBlbnN1cmVNZXNzYWdlS2V5YCDms6jlhaXkuIDkuKrmlrDnmoQgTUsg5ZCO77yM6ZyA6KaB5b+955Wl55qE55Sx6K+l5pON5L2c6Kem5Y+R55qEIGBjaGFyYWN0ZXJfbWVzc2FnZV9yZW5kZXJlZGAg5LqL5Lu255qE5pWw6YeP44CCXG4gKiDpgJrluLjorr7nva7kuLogMe+8jOWboOS4uuS4gOasoea2iOaBr+WGheWuueabtOaWsOmAmuW4uOWPquS8muinpuWPkeS4gOasoea4suafk+S6i+S7tuOAglxuICovXG5jb25zdCBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT04gPSAxO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgSWdub3JlUnVsZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huWboCBNSyDms6jlhaXogIzpnIDopoHlv73nlaXlkI7nu63muLLmn5Pkuovku7bnmoTop4TliJnjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJZ25vcmVSdWxlIHtcbiAgbWs6IHN0cmluZztcbiAgaWdub3JlQ291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIENvbnNlY3V0aXZlTWtTdGF0ZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6hueUqOS6jui/vei4quWQjOS4gOS4qiBNSyDooqvov57nu63lpITnkIbmrKHmlbDnmoTnirbmgIHjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb25zZWN1dGl2ZU1rU3RhdGUge1xuICBtazogc3RyaW5nIHwgbnVsbDtcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiAqKuOAkOi+heWKqeWHveaVsOOAkeWkhOeQhueUsSBNSyDms6jlhaXop6blj5HnmoTlhpfkvZnmuLLmn5Pkuovku7YqKlxuICogQHBhcmFtIGV2ZW50VHlwZSAtIOW9k+WJjeS6i+S7tueahOexu+Wei+OAglxuICogQHBhcmFtIGN1cnJlbnRNayAtIOW9k+WJjea2iOaBr+eahCBNS+OAglxuICogQHBhcmFtIG1rVG9JZ25vcmUgLSDlvZPliY3nmoTlv73nlaXop4TliJnjgIJcbiAqIEByZXR1cm5zIHt7IHNob3VsZFNraXA6IGJvb2xlYW47IG5ld0lnbm9yZVJ1bGU6IElnbm9yZVJ1bGUgfCBudWxsIH19IC0g6L+U5Zue5piv5ZCm5bqU6Lez6L+H5q2k5LqL5Lu277yM5Lul5Y+K5pu05paw5ZCO55qE5b+955Wl6KeE5YiZ44CCXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50KFxuICBldmVudFR5cGU6IHN0cmluZyxcbiAgY3VycmVudE1rOiBzdHJpbmcgfCBudWxsLFxuICBta1RvSWdub3JlOiBJZ25vcmVSdWxlIHwgbnVsbCxcbik6IHsgc2hvdWxkU2tpcDogYm9vbGVhbjsgbmV3SWdub3JlUnVsZTogSWdub3JlUnVsZSB8IG51bGwgfSB7XG4gIGlmIChta1RvSWdub3JlICYmIGV2ZW50VHlwZSA9PT0gdGF2ZXJuX2V2ZW50cy5DSEFSQUNURVJfTUVTU0FHRV9SRU5ERVJFRCAmJiBjdXJyZW50TWsgPT09IG1rVG9JZ25vcmUubWspIHtcbiAgICBsb2dnZXIubG9nKFxuICAgICAgJ2hhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50JyxcbiAgICAgIGDlv73nlaXnlLEgTUsgKCR7bWtUb0lnbm9yZS5ta30pIOazqOWFpeinpuWPkeeahOWGl+S9mea4suafk+S6i+S7tuOAguWJqeS9meW/veeVpeasoeaVsDogJHtta1RvSWdub3JlLmlnbm9yZUNvdW50IC0gMX1gLFxuICAgICk7XG4gICAgbWtUb0lnbm9yZS5pZ25vcmVDb3VudC0tO1xuICAgIGlmIChta1RvSWdub3JlLmlnbm9yZUNvdW50IDw9IDApIHtcbiAgICAgIG1rVG9JZ25vcmUgPSBudWxsOyAvLyDlv73nlaXmrKHmlbDnlKjlrozvvIzph43nva5cbiAgICAgIGxvZ2dlci5sb2coJ2hhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50JywgYOW/veeVpeasoeaVsOeUqOWujGApO1xuICAgIH1cbiAgICByZXR1cm4geyBzaG91bGRTa2lwOiB0cnVlLCBuZXdJZ25vcmVSdWxlOiBta1RvSWdub3JlIH07XG4gIH1cbiAgcmV0dXJuIHsgc2hvdWxkU2tpcDogZmFsc2UsIG5ld0lnbm9yZVJ1bGU6IG1rVG9JZ25vcmUgfTtcbn1cblxuLyoqXG4gKiAqKuOAkOS7u+WKoeaJp+ihjOWZqOOAkSoqXG4gKiDotJ/otKPmiafooYzljZXkuKrkuovku7bku7vliqHvvIzljIXlkKvmiYDmnInliY3nva7jgIHlkI7nva7lpITnkIblkozplJnor6/mjZXojrfjgIJcbiAqIEBwYXJhbSB7RXZlbnRKb2J9IGpvYiAtIOimgeaJp+ihjOeahOS6i+S7tuS7u+WKoeOAglxuICogQHBhcmFtIHtJZ25vcmVSdWxlIHwgbnVsbH0gbWtUb0lnbm9yZSAtIOW9k+WJjeeahOW/veeVpeinhOWImeOAglxuICogQHBhcmFtIHtDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsfSBjb25zZWN1dGl2ZU1rU3RhdGUgLSDlvZPliY3nmoTov57nu63lpITnkIborqHmlbDnirbmgIHjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHtcbiAqICAgbmV3SWdub3JlUnVsZTogSWdub3JlUnVsZSB8IG51bGw7XG4gKiAgIG5ld0NvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbDtcbiAqIH0+fSAtIOi/lOWbnuabtOaWsOWQjueahOeKtuaAgeOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhcbiAgam9iOiBFdmVudEpvYixcbiAgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwsXG4gIGNvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbCxcbik6IFByb21pc2U8e1xuICBuZXdJZ25vcmVSdWxlOiBJZ25vcmVSdWxlIHwgbnVsbDtcbiAgbmV3Q29uc2VjdXRpdmVNa1N0YXRlOiBDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsO1xufT4ge1xuICBjb25zdCB7IHR5cGU6IGV2ZW50VHlwZSwgZGV0YWlsIH0gPSBqb2I7XG4gIGNvbnN0IGV2ZW50R3JvdXAgPSBnZXRFdmVudEdyb3VwKGV2ZW50VHlwZSk7XG4gIGxldCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgbGV0IGN1cnJlbnRDb25zZWN1dGl2ZUNvdW50ID0gMTtcblxuICAvLyDlnKjmr4/ova7ku7vliqHlvIDlp4vml7bvvIzliJ3lp4vljJbmk43kvZzorrDlvZXlmahcbiAgY29uc3QgYWN0aW9uc1Rha2VuID0geyByb2xsYmFjazogZmFsc2UsIGFwcGx5OiBmYWxzZSwgcmVzeW5jOiBmYWxzZSwgYXBpOiBmYWxzZSB9O1xuXG4gIHRyeSB7XG4gICAgLy8gKirliY3nva7kv53pmpwqKjog56Gu5L+d5pyA5paw5raI5oGv5pyJIE1LIOW5tuiuvue9ruaXpeW/l+S4iuS4i+aWh+OAglxuICAgIGNvbnN0IHsgbWssIG1lc3NhZ2VfaWQ6IG1zZ0lkLCBpc05ld0tleSB9ID0gYXdhaXQgZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlKCk7XG4gICAgbG9nQ29udGV4dC5tayA9IG1rO1xuICAgIG1lc3NhZ2VfaWQgPSBtc2dJZDtcblxuICAgIC8vIOWmguaenCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2Ug5Yia5Yia5rOo5YWl5LqG5LiA5Liq5paw55qEIE1L77yM5bCx5Yib5bu65oiW5pu05paw5b+955Wl6KeE5YiZ44CCXG4gICAgaWYgKGlzTmV3S2V5ICYmIG1rKSB7XG4gICAgICBta1RvSWdub3JlID0ge1xuICAgICAgICBtazogbWssXG4gICAgICAgIGlnbm9yZUNvdW50OiBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT04sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vICoq5qC45b+D5LyY5YyWKio6IOajgOafpeW5tuWkhOeQhueUsSBNSyDms6jlhaXop6blj5HnmoTlhpfkvZnmuLLmn5Pkuovku7bjgIJcbiAgICBjb25zdCB7IHNob3VsZFNraXAsIG5ld0lnbm9yZVJ1bGUgfSA9IGhhbmRsZVJlZHVuZGFudFJlbmRlckV2ZW50KGV2ZW50VHlwZSwgbWssIG1rVG9JZ25vcmUpO1xuICAgIG1rVG9JZ25vcmUgPSBuZXdJZ25vcmVSdWxlOyAvLyDmm7TmlrDlv73nlaXop4TliJnnmoTnirbmgIFcbiAgICBpZiAoc2hvdWxkU2tpcCkge1xuICAgICAgLy8g5aaC5p6c5LqL5Lu26KKr5b+955Wl77yM5YiZ55u05o6l6L+U5Zue77yM5LiN5pu05paw6L+e57ut5aSE55CG6K6h5pWwXG4gICAgICByZXR1cm4geyBuZXdJZ25vcmVSdWxlOiBta1RvSWdub3JlLCBuZXdDb25zZWN1dGl2ZU1rU3RhdGU6IGNvbnNlY3V0aXZlTWtTdGF0ZSB9O1xuICAgIH1cblxuICAgIC8vICoq5Y+q5pyJ5Zyo5LqL5Lu25LiN6KKr5b+955Wl5pe277yM5omN5pu05paw6L+e57ut5aSE55CG6K6h5pWwKipcbiAgICBpZiAobWsgJiYgY29uc2VjdXRpdmVNa1N0YXRlICYmIGNvbnNlY3V0aXZlTWtTdGF0ZS5tayA9PT0gbWspIHtcbiAgICAgIGNvbnNlY3V0aXZlTWtTdGF0ZS5jb3VudCsrO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zZWN1dGl2ZU1rU3RhdGUgPSB7IG1rOiBtaywgY291bnQ6IDEgfTtcbiAgICB9XG4gICAgY3VycmVudENvbnNlY3V0aXZlQ291bnQgPSBjb25zZWN1dGl2ZU1rU3RhdGUuY291bnQ7XG5cbiAgICBsb2dnZXIubG9nKCdkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrJywgYOaJp+ihjOS7u+WKoTogJHtldmVudFR5cGV9ICjliIbnu4Q6ICR7ZXZlbnRHcm91cH0pYCk7XG5cbiAgICAvLyAqKuS7u+WKoeWIhuWPkSoqXG4gICAgbG9nZ2VyLmRlYnVnKCdkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrIC0gdGFzayBkaXNwYXRjaCcsIGDliIblj5Hkuovku7Y6ICR7ZXZlbnRUeXBlfWAsIHsgZGV0YWlsLCBldmVudEdyb3VwIH0pO1xuICAgIGlmIChldmVudEdyb3VwID09PSAnV1JJVEUnKSB7XG4gICAgICAvLyDlhbPplK7vvJrlhpnlhaXliY3lhYjlm57mu5rvvIznoa7kv53mk43kvZznmoTluYLnrYnmgKfjgIJcbiAgICAgIC8vIOWNs+S9v+S6i+S7tuiiq+aEj+WkluinpuWPkeWkmuasoe+8jOS5n+WPquS8muS6p+eUn+S4gOasoeacieaViOWGmeWFpeOAglxuICAgICAgY29uc3QgbXNnID0gZ2V0Q2hhdE1lc3NhZ2VzKC0xLCB7IGluY2x1ZGVfc3dpcGVzOiB0cnVlIH0pPy5bMF07XG4gICAgICBpZiAobXNnKSB7XG4gICAgICAgIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgICAgICAgaWYgKE1LKSB7XG4gICAgICAgICAgYXdhaXQgcm9sbGJhY2tCeU1rKE1LLCB0cnVlKTtcbiAgICAgICAgICBhY3Rpb25zVGFrZW4ucm9sbGJhY2sgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhd2FpdCBBcHBseVZhckNoYW5nZSgpO1xuICAgICAgYWN0aW9uc1Rha2VuLmFwcGx5ID0gdHJ1ZTtcblxuICAgICAgLy8g5Zyo5Y+Y6YeP5YaZ5YWl5a6M5oiQ5ZCO77yM5by65Yi26YeN5paw5riy5p+T5raI5oGv5Lul6Kem5Y+R5a6PXG4gICAgICBmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzKCk7XG4gICAgfSBlbHNlIGlmIChldmVudEdyb3VwID09PSAnU1lOQycpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayAtIHRhc2sgZGlzcGF0Y2gnLCBg5LqL5Lu2ICR7ZXZlbnRUeXBlfSDop6blj5HnirbmgIHlkIzmraXmtYHnqIsuLi5gKTtcbiAgICAgIGNvbnN0IGlzRnVsbFN5bmMgPSBldmVudFR5cGUgPT09ICdtYW51YWxfZnVsbF9zeW5jJztcbiAgICAgIGF3YWl0IHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlKGlzRnVsbFN5bmMpO1xuICAgICAgYWN0aW9uc1Rha2VuLnJlc3luYyA9IHRydWU7XG4gICAgICAvLyDlnKjlkIzmraXlrozmiJDlkI7vvIzlvLrliLbph43mlrDmuLLmn5Pmtojmga/ku6Xop6blj5Hlro9cbiAgICAgIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50R3JvdXAgPT09ICdBUEknKSB7XG4gICAgICBhY3Rpb25zVGFrZW4uYXBpID0gdHJ1ZTtcbiAgICAgIC8vIEFQSSDkuovku7bmmK/igJzljbPlj5HljbPlv5jigJ3nmoTvvIzlkIzmraXosIPnlKjlpITnkIblmajlsIbku7vliqHmjqjlhaUgYXBpLnRzIOeahOmYn+WIl+WQjueri+WNs+i/lOWbnu+8jOS4jemYu+WhnuS6i+S7tumYn+WIl+OAglxuICAgICAgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuSU5TRVJUX0JZX09CSkVDVCkgaW5zZXJ0QnlPYmplY3QoZGV0YWlsKTtcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuVVBEQVRFX0JZX09CSkVDVCkgdXBkYXRlQnlPYmplY3QoZGV0YWlsKTtcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuSU5TRVJUX0JZX1BBVEgpIGluc2VydEJ5UGF0aChkZXRhaWwucGF0aCwgZGV0YWlsLnZhbHVlKTtcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuVVBEQVRFX0JZX1BBVEgpIHVwZGF0ZUJ5UGF0aChkZXRhaWwucGF0aCwgZGV0YWlsLnZhbHVlKTtcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuREVMRVRFX0JZX09CSkVDVCkgZGVsZXRlQnlPYmplY3QoZGV0YWlsKTtcbiAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuREVMRVRFX0JZX1BBVEgpIGRlbGV0ZUJ5UGF0aChkZXRhaWwucGF0aCk7XG4gICAgfSBlbHNlIGlmIChldmVudEdyb3VwID09PSAnVVBEQVRFX01LX09OTFknKSB7XG4gICAgICAvLyDnm5HlkKzmraTkuovku7bku4XnlKjkuo7kuLrnlKjmiLfmtojmga/liJvlu7ogTUvjgIJcbiAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrJywgYOS6i+S7tiAke2V2ZW50VHlwZX0g5aSE55CG5byC5bi4OiAke2Vycm9yfWAsIGVycm9yKTtcbiAgfSBmaW5hbGx5IHtcbiAgICAvLyDku4XlvZPmnKzova7lpITnkIbkuK3lrp7pmYXmiafooYzkuoYgRVJBIOaguOW/g+aTjeS9nOaXtu+8jOaJjeagoeWHhuW5tuW5v+aSreS6i+S7tlxuICAgIC8vIC0tLSAzLiDop6blj5HlhpnlhaXlrozmiJDkuovku7YgLS0tXG4gICAgaWYgKGFjdGlvbnNUYWtlbi5yb2xsYmFjayB8fCBhY3Rpb25zVGFrZW4uYXBwbHkgfHwgYWN0aW9uc1Rha2VuLnJlc3luYyB8fCBhY3Rpb25zVGFrZW4uYXBpKSB7XG4gICAgICAvLyAqKuWQjue9ruS/nemanCoqOiDlvLrliLbmoKHlh4YgYFNlbGVjdGVkTWtzYCDnmoTmnIDmlrDorrDlvZXjgIJcbiAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcbiAgICAgIC8vIOWcqOaJgOacieaTjeS9nO+8iOWMheaLrOagoeWHhu+8ieWujOaIkOWQju+8jOiOt+WPluacgOaWsOeKtuaAgeW5tuW5v+aSreS6i+S7tlxuICAgICAgaWYgKGxvZ0NvbnRleHQubWsgJiYgbWVzc2FnZV9pZCAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhLCBzdGF0OiBzdGF0RGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1rcyA9IF8uZ2V0KG1ldGFEYXRhLCBTRUxfUEFUSCwgW10pO1xuICAgICAgICBjb25zdCBlZGl0TG9ncyA9IF8uZ2V0KG1ldGFEYXRhLCBMT0dTX1BBVEgsIHt9KTtcbiAgICAgICAgY29uc3Qgc3RhdFdpdGhvdXRNZXRhID0gcmVtb3ZlTWV0YUZpZWxkcyhzdGF0RGF0YSk7XG5cbiAgICAgICAgZW1pdFdyaXRlRG9uZUV2ZW50KHtcbiAgICAgICAgICBtazogbG9nQ29udGV4dC5tayxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBtZXNzYWdlX2lkLFxuICAgICAgICAgIGFjdGlvbnM6IGFjdGlvbnNUYWtlbixcbiAgICAgICAgICBzZWxlY3RlZE1rczogc2VsZWN0ZWRNa3MsXG4gICAgICAgICAgZWRpdExvZ3M6IGVkaXRMb2dzLFxuICAgICAgICAgIHN0YXQ6IHN0YXREYXRhLFxuICAgICAgICAgIHN0YXRXaXRob3V0TWV0YTogc3RhdFdpdGhvdXRNZXRhLFxuICAgICAgICAgIGNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50OiBjdXJyZW50Q29uc2VjdXRpdmVDb3VudCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5riF55CG5pel5b+X5LiK5LiL5paH77yM5Li65LiL5LiA5Liq5LqL5Lu25YGa5YeG5aSHXG4gICAgbG9nQ29udGV4dC5tayA9ICcnO1xuXG4gICAgLy8gKiroioLmtYEqKjog5Zyo5q+P5Liq54us56uL5Lu75Yqh5ZCO6YO96L+b6KGM55+t5pqC562J5b6F77yM56Gu5L+d6YWS6aaG5bqV5bGC5pyJ5pe26Ze05a6M5oiQ5YW25byC5q2l5pON5L2c44CCXG4gICAgLy/mmoLml7blj5bmtojnrYnlvoXpgLvovpHvvIzmj5Dpq5jljbPml7bmgKfjgIJcbiAgICAvL2F3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MCkpO1xuICB9XG5cbiAgcmV0dXJuIHsgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSwgbmV3Q29uc2VjdXRpdmVNa1N0YXRlOiBjb25zZWN1dGl2ZU1rU3RhdGUgfTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/dispatcher.ts\n\n}");
  },
  "./src/ERA变量框架/events/merger.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/events/merger.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EVENT_COLLISION_MAP: () => (/* binding */ EVENT_COLLISION_MAP),\n/* harmony export */   EVENT_GROUPS: () => (/* binding */ EVENT_GROUPS),\n/* harmony export */   getEventGroup: () => (/* binding */ getEventGroup),\n/* harmony export */   mergeEventBatch: () => (/* binding */ mergeEventBatch)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('events-merger');\n/**\n * @description 定义需要监听的事件的分组\n */\nconst EVENT_GROUPS = {\n    WRITE: [\n        //tavern_events.CHARACTER_MESSAGE_RENDERED,\n        tavern_events.APP_READY,\n        'manual_write',\n        _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE,\n        //tavern_events.MESSAGE_RECEIVED,\n    ],\n    SYNC: [\n        tavern_events.MESSAGE_RECEIVED,\n        tavern_events.MESSAGE_DELETED,\n        tavern_events.MESSAGE_SWIPED,\n        tavern_events.CHAT_CHANGED,\n        'manual_sync',\n        'manual_full_sync',\n    ],\n    API: Object.values(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS),\n    /** 仅更新MK的事件 */\n    UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n    /** 仅用于对冲检测的事件，本身不触发逻辑 */\n    COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n};\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED]\n * ])\n */\nconst EVENT_COLLISION_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED],\n]);\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('WRITE', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nfunction getEventGroup(eventType) {\n    // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n    if (EVENT_GROUPS.WRITE.includes(eventType))\n        return 'WRITE';\n    if (EVENT_GROUPS.SYNC.includes(eventType))\n        return 'SYNC';\n    if (EVENT_GROUPS.API.includes(eventType))\n        return 'API';\n    if (EVENT_GROUPS.UPDATE_MK_ONLY.includes(eventType))\n        return 'UPDATE_MK_ONLY';\n    if (EVENT_GROUPS.COLLISION_DETECTORS.includes(eventType))\n        return 'COLLISION_DETECTORS';\n    return 'UNKNOWN';\n}\n/**\n * **【事件合并器】**\n * 对一批事件进行智能合并，包括处理事件对冲和合并同组可覆盖事件。\n * @param {EventJob[]} batchToProcess - 从队列中取出的一批原始事件。\n * @returns {EventJob[]} - 经过合并优化后的事件数组。\n */\nfunction mergeEventBatch(batchToProcess) {\n    const originalEvents = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(batchToProcess);\n    const finalJobs = [];\n    // 使用 for...of 循环，让逻辑更清晰\n    for (const currentJob of batchToProcess) {\n        // 如果是第一个事件，直接放入结果中\n        if (finalJobs.length === 0) {\n            finalJobs.push(currentJob);\n            continue; // 继续处理下一个事件\n        }\n        const prevJob = finalJobs[finalJobs.length - 1];\n        // 1. 检查事件对冲\n        const expectedNextEvent = EVENT_COLLISION_MAP.get(prevJob.type);\n        const timeDifference = currentJob.timestamp - prevJob.timestamp;\n        if (expectedNextEvent && currentJob.type === expectedNextEvent && timeDifference <= 300) {\n            logger.debug('mergeEventBatch', `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms)。将忽略这两个事件。`);\n            finalJobs.pop(); // 移除前一个事件\n            continue; // 跳过当前事件，从而忽略两者\n        }\n        // 2. 如果不对冲，则检查同组事件合并\n        const prevGroup = getEventGroup(prevJob.type);\n        const currentGroup = getEventGroup(currentJob.type);\n        // 定义合并条件，让 if 判断的意图更清晰\n        const areInSameGroup = prevGroup === currentGroup;\n        const isMergeableGroup = prevGroup === 'WRITE' || prevGroup === 'SYNC';\n        // 如果满足合并条件\n        if (areInSameGroup && isMergeableGroup) {\n            // 用当前事件覆盖掉结果数组中的最后一个事件\n            finalJobs[finalJobs.length - 1] = currentJob;\n        }\n        else {\n            // 否则，将当前事件追加到结果数组\n            finalJobs.push(currentJob);\n        }\n    }\n    // 最后，过滤掉所有单独存在的对冲检测器事件，因为它们已经完成了自己的使命\n    const filteredJobs = finalJobs.filter(job => {\n        const isDetector = getEventGroup(job.type) === 'COLLISION_DETECTORS';\n        if (isDetector) {\n            logger.debug('mergeEventBatch', `清理未配对的对冲检测器事件: ${job.type}`);\n        }\n        return !isDetector;\n    });\n    // 打印合并日志\n    logger.debug('mergeEventBatch', `事件合并: ${originalEvents.length} -> ${filteredJobs.length}`, {\n        before: originalEvents.map(e => e.type),\n        after: filteredJobs.map(e => e.type),\n    });\n    return filteredJobs;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLFNBQVMsY0FBYyxDQUFDLE1BQU0sT0FBTyxZQUFZLENBQUMsTUFBTSxFQUFFLEVBQUU7UUFDMUYsTUFBTSxFQUFFLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3ZDLEtBQUssRUFBRSxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztLQUNyQyxDQUFDLENBQUM7SUFFSCxPQUFPLFlBQVksQ0FBQztBQUN0QixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL21lcmdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgRVJBX0VWRU5UX0VNSVRURVIgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLW1lcmdlcicpO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnpnIDopoHnm5HlkKznmoTkuovku7bnmoTliIbnu4RcbiAqL1xuZXhwb3J0IGNvbnN0IEVWRU5UX0dST1VQUyA9IHtcbiAgV1JJVEU6IFtcbiAgICAvL3RhdmVybl9ldmVudHMuQ0hBUkFDVEVSX01FU1NBR0VfUkVOREVSRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5BUFBfUkVBRFksXG4gICAgJ21hbnVhbF93cml0ZScsXG4gICAgRVJBX0VWRU5UX0VNSVRURVIuQVBJX1dSSVRFLFxuICAgIC8vdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICBdLFxuICBTWU5DOiBbXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9ERUxFVEVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5DSEFUX0NIQU5HRUQsXG4gICAgJ21hbnVhbF9zeW5jJyxcbiAgICAnbWFudWFsX2Z1bGxfc3luYycsXG4gIF0sXG4gIEFQSTogT2JqZWN0LnZhbHVlcyhFUkFfQVBJX0VWRU5UUyksXG4gIC8qKiDku4Xmm7TmlrBNS+eahOS6i+S7tiAqL1xuICBVUERBVEVfTUtfT05MWTogW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TRU5UXSxcbiAgLyoqIOS7heeUqOS6juWvueWGsuajgOa1i+eahOS6i+S7tu+8jOacrOi6q+S4jeinpuWPkemAu+i+kSAqL1xuICBDT0xMSVNJT05fREVURUNUT1JTOiBbdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURURdLFxufTtcblxuLyoqXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIHN0cmluZz59IEVWRU5UX0NPTExJU0lPTl9NQVBcbiAqIEBkZXNjcmlwdGlvblxuICog5a6a5LmJ5LqG5LqL5Lu25a+55Yay6KeE5YiZ44CCXG4gKiDlpoLmnpzlnKjkuovku7bpmJ/liJfnmoTlkIzkuIDmrKHmibnlpITnkIbkuK3vvIzlkIzml7blh7rnjrDkuoYga2V5IOS6i+S7tuWSjCB2YWx1ZSDkuovku7bvvIxcbiAqIOWImei/meS4pOS4quS6i+S7tumDveWwhuiiq+W/veeVpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDlvZPnlKjmiLflv6vpgJ/lt6bmu5HnhLblkI7ngrnlh7vnlJ/miJDml7bvvIzkvJrkvp3mrKHop6blj5EgYE1FU1NBR0VfU1dJUEVEYCDlkowgYEdFTkVSQVRJT05fU1RBUlRFRGDjgIJcbiAqIC8vIOi/meadoeinhOWImeS8muaNleiOt+i/meenjeaooeW8j+W5tuWQjOaXtuW/veeVpei/meS4pOS4quS6i+S7tu+8jOmBv+WFjeS4jeW/heimgeeahOWQjOatpeOAglxuICogbmV3IE1hcChbXG4gKiAgIFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELCB0YXZlcm5fZXZlbnRzLkdFTkVSQVRJT05fU1RBUlRFRF1cbiAqIF0pXG4gKi9cbmV4cG9ydCBjb25zdCBFVkVOVF9DT0xMSVNJT05fTUFQID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oW1xuICBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1NXSVBFRCwgdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURURdLFxuXSk7XG5cbi8qKlxuICogQGludGVyZmFjZSBFdmVudEpvYlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huS6i+S7tumYn+WIl+S4reavj+S4quS7u+WKoeWvueixoeeahOe7k+aehOOAglxuICovXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50Sm9iIHtcbiAgdHlwZTogc3RyaW5nO1xuICBkZXRhaWw/OiBhbnk7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG4vKipcbiAqIOagueaNruS6i+S7tuexu+Wei++8jOafpeaJvuWug+WxnuS6juWTquS4qumihOWumuS5ieeahOe7hOOAglxuICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIOimgeajgOafpeeahOS6i+S7tuexu+Wei+OAglxuICogQHJldHVybnMge3N0cmluZ30g5LqL5Lu25omA5bGe55qE57uE5ZCNICgnV1JJVEUnLCAnU1lOQycsICdBUEknLCAnVVBEQVRFX01LX09OTFknLCAnVU5LTk9XTicp44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudEdyb3VwKGV2ZW50VHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8g5L2/55SoIGFzIHN0cmluZ1tdIOadpeino+WGsyBUeXBlU2NyaXB0IOWboCAnYXMgY29uc3QnIOaOqOaWreWHuueahOi/h+S6juS4peagvOeahOexu+Wei+mXrumimFxuICBpZiAoKEVWRU5UX0dST1VQUy5XUklURSBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdXUklURSc7XG4gIGlmICgoRVZFTlRfR1JPVVBTLlNZTkMgYXMgc3RyaW5nW10pLmluY2x1ZGVzKGV2ZW50VHlwZSkpIHJldHVybiAnU1lOQyc7XG4gIGlmICgoRVZFTlRfR1JPVVBTLkFQSSBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdBUEknO1xuICBpZiAoKEVWRU5UX0dST1VQUy5VUERBVEVfTUtfT05MWSBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdVUERBVEVfTUtfT05MWSc7XG4gIGlmICgoRVZFTlRfR1JPVVBTLkNPTExJU0lPTl9ERVRFQ1RPUlMgYXMgc3RyaW5nW10pLmluY2x1ZGVzKGV2ZW50VHlwZSkpIHJldHVybiAnQ09MTElTSU9OX0RFVEVDVE9SUyc7XG4gIHJldHVybiAnVU5LTk9XTic7XG59XG5cbi8qKlxuICogKirjgJDkuovku7blkIjlubblmajjgJEqKlxuICog5a+55LiA5om55LqL5Lu26L+b6KGM5pm66IO95ZCI5bm277yM5YyF5ous5aSE55CG5LqL5Lu25a+55Yay5ZKM5ZCI5bm25ZCM57uE5Y+v6KaG55uW5LqL5Lu244CCXG4gKiBAcGFyYW0ge0V2ZW50Sm9iW119IGJhdGNoVG9Qcm9jZXNzIC0g5LuO6Zif5YiX5Lit5Y+W5Ye655qE5LiA5om55Y6f5aeL5LqL5Lu244CCXG4gKiBAcmV0dXJucyB7RXZlbnRKb2JbXX0gLSDnu4/ov4flkIjlubbkvJjljJblkI7nmoTkuovku7bmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRXZlbnRCYXRjaChiYXRjaFRvUHJvY2VzczogRXZlbnRKb2JbXSk6IEV2ZW50Sm9iW10ge1xuICBjb25zdCBvcmlnaW5hbEV2ZW50cyA9IF8uY2xvbmVEZWVwKGJhdGNoVG9Qcm9jZXNzKTtcbiAgY29uc3QgZmluYWxKb2JzOiBFdmVudEpvYltdID0gW107XG5cbiAgLy8g5L2/55SoIGZvci4uLm9mIOW+queOr++8jOiuqemAu+i+keabtOa4heaZsFxuICBmb3IgKGNvbnN0IGN1cnJlbnRKb2Igb2YgYmF0Y2hUb1Byb2Nlc3MpIHtcbiAgICAvLyDlpoLmnpzmmK/nrKzkuIDkuKrkuovku7bvvIznm7TmjqXmlL7lhaXnu5PmnpzkuK1cbiAgICBpZiAoZmluYWxKb2JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZmluYWxKb2JzLnB1c2goY3VycmVudEpvYik7XG4gICAgICBjb250aW51ZTsgLy8g57un57ut5aSE55CG5LiL5LiA5Liq5LqL5Lu2XG4gICAgfVxuXG4gICAgY29uc3QgcHJldkpvYiA9IGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV07XG5cbiAgICAvLyAxLiDmo4Dmn6Xkuovku7blr7nlhrJcbiAgICBjb25zdCBleHBlY3RlZE5leHRFdmVudCA9IEVWRU5UX0NPTExJU0lPTl9NQVAuZ2V0KHByZXZKb2IudHlwZSk7XG4gICAgY29uc3QgdGltZURpZmZlcmVuY2UgPSBjdXJyZW50Sm9iLnRpbWVzdGFtcCAtIHByZXZKb2IudGltZXN0YW1wO1xuICAgIGlmIChleHBlY3RlZE5leHRFdmVudCAmJiBjdXJyZW50Sm9iLnR5cGUgPT09IGV4cGVjdGVkTmV4dEV2ZW50ICYmIHRpbWVEaWZmZXJlbmNlIDw9IDMwMCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAnbWVyZ2VFdmVudEJhdGNoJyxcbiAgICAgICAgYOajgOa1i+WIsOebuOmCu+S6i+S7tuWvueWGsjogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcynjgILlsIblv73nlaXov5nkuKTkuKrkuovku7bjgIJgLFxuICAgICAgKTtcbiAgICAgIGZpbmFsSm9icy5wb3AoKTsgLy8g56e76Zmk5YmN5LiA5Liq5LqL5Lu2XG4gICAgICBjb250aW51ZTsgLy8g6Lez6L+H5b2T5YmN5LqL5Lu277yM5LuO6ICM5b+955Wl5Lik6ICFXG4gICAgfVxuXG4gICAgLy8gMi4g5aaC5p6c5LiN5a+55Yay77yM5YiZ5qOA5p+l5ZCM57uE5LqL5Lu25ZCI5bm2XG4gICAgY29uc3QgcHJldkdyb3VwID0gZ2V0RXZlbnRHcm91cChwcmV2Sm9iLnR5cGUpO1xuICAgIGNvbnN0IGN1cnJlbnRHcm91cCA9IGdldEV2ZW50R3JvdXAoY3VycmVudEpvYi50eXBlKTtcblxuICAgIC8vIOWumuS5ieWQiOW5tuadoeS7tu+8jOiuqSBpZiDliKTmlq3nmoTmhI/lm77mm7TmuIXmmbBcbiAgICBjb25zdCBhcmVJblNhbWVHcm91cCA9IHByZXZHcm91cCA9PT0gY3VycmVudEdyb3VwO1xuICAgIGNvbnN0IGlzTWVyZ2VhYmxlR3JvdXAgPSBwcmV2R3JvdXAgPT09ICdXUklURScgfHwgcHJldkdyb3VwID09PSAnU1lOQyc7XG5cbiAgICAvLyDlpoLmnpzmu6HotrPlkIjlubbmnaHku7ZcbiAgICBpZiAoYXJlSW5TYW1lR3JvdXAgJiYgaXNNZXJnZWFibGVHcm91cCkge1xuICAgICAgLy8g55So5b2T5YmN5LqL5Lu26KaG55uW5o6J57uT5p6c5pWw57uE5Lit55qE5pyA5ZCO5LiA5Liq5LqL5Lu2XG4gICAgICBmaW5hbEpvYnNbZmluYWxKb2JzLmxlbmd0aCAtIDFdID0gY3VycmVudEpvYjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5ZCm5YiZ77yM5bCG5b2T5YmN5LqL5Lu26L+95Yqg5Yiw57uT5p6c5pWw57uEXG4gICAgICBmaW5hbEpvYnMucHVzaChjdXJyZW50Sm9iKTtcbiAgICB9XG4gIH1cbiAgLy8g5pyA5ZCO77yM6L+H5ruk5o6J5omA5pyJ5Y2V54us5a2Y5Zyo55qE5a+55Yay5qOA5rWL5Zmo5LqL5Lu277yM5Zug5Li65a6D5Lus5bey57uP5a6M5oiQ5LqG6Ieq5bex55qE5L2/5ZG9XG4gIGNvbnN0IGZpbHRlcmVkSm9icyA9IGZpbmFsSm9icy5maWx0ZXIoam9iID0+IHtcbiAgICBjb25zdCBpc0RldGVjdG9yID0gZ2V0RXZlbnRHcm91cChqb2IudHlwZSkgPT09ICdDT0xMSVNJT05fREVURUNUT1JTJztcbiAgICBpZiAoaXNEZXRlY3Rvcikge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdtZXJnZUV2ZW50QmF0Y2gnLCBg5riF55CG5pyq6YWN5a+555qE5a+55Yay5qOA5rWL5Zmo5LqL5Lu2OiAke2pvYi50eXBlfWApO1xuICAgIH1cbiAgICByZXR1cm4gIWlzRGV0ZWN0b3I7XG4gIH0pO1xuXG4gIC8vIOaJk+WNsOWQiOW5tuaXpeW/l1xuICBsb2dnZXIuZGVidWcoJ21lcmdlRXZlbnRCYXRjaCcsIGDkuovku7blkIjlubY6ICR7b3JpZ2luYWxFdmVudHMubGVuZ3RofSAtPiAke2ZpbHRlcmVkSm9icy5sZW5ndGh9YCwge1xuICAgIGJlZm9yZTogb3JpZ2luYWxFdmVudHMubWFwKGUgPT4gZS50eXBlKSxcbiAgICBhZnRlcjogZmlsdGVyZWRKb2JzLm1hcChlID0+IGUudHlwZSksXG4gIH0pO1xuXG4gIHJldHVybiBmaWx0ZXJlZEpvYnM7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/merger.ts\n\n}");
  },
  "./src/ERA变量框架/events/queue.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/events/queue.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pushToQueue: () => (/* binding */ pushToQueue)\n/* harmony export */ });\n/* harmony import */ var _dispatcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dispatcher */ \"./src/ERA变量框架/events/dispatcher.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 事件队列与总调度模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”。它通过一个事件队列机制，将所有事件的接收、\n * 合并、分发和执行流程化，从根本上解决了并发和状态竞争问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有事件（来自酒馆或 API）都被封装成 `EventJob` 对象，推入 `eventQueue`。\n * 2. **单线程处理**: `processQueue` 函数使用 `isProcessing` 锁确保同一时间只有一个处理循环在运行。\n * 3. **防抖与批处理**: 在处理前会进行短暂防抖，以收集短时间内连续触发的多个事件，形成一个“批次”。\n * 4. **委托合并**: 将整个批次交由 `event_merger.ts` 模块进行智能合并（对冲、覆盖）。\n * 5. **委托执行**: 循环遍历合并后的任务，将每个任务委托给 `task_dispatcher.ts` 模块进行独立、原子的执行。\n * 6. **状态传递**: 在不同任务的执行之间，传递和更新必要的上下文状态（如 `mkToIgnore` 和 `consecutiveMkState`）。\n */\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('events-queue');\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue = [];\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动处理器。这是所有事件监听器的统一入口点。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nfunction pushToQueue(type, detail) {\n    logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n    eventQueue.push({ type, detail, timestamp: Date.now() });\n    processQueue(); // 尝试启动处理器\n}\n/**\n * **【核心事件处理器】**\n * 持续从队列中取出事件、合并、并按顺序执行。\n * 这是一个自驱动的异步函数，只要队列不为空就会一直运行，直到处理完所有任务。\n */\nasync function processQueue() {\n    if (isProcessing)\n        return; // 如果已在处理中，则直接返回，等待当前循环完成。\n    isProcessing = true;\n    logger.log('processQueue', '处理器启动...');\n    // --- 状态初始化 ---\n    // 这些状态变量定义在 while 循环外部，以在不同批次的事件处理之间保持连续性。\n    let mkToIgnore = null;\n    let consecutiveMkState = null;\n    while (eventQueue.length > 0) {\n        // 【事件收集窗口与防抖】\n        const nextJob = eventQueue[0];\n        const nextGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_1__.getEventGroup)(nextJob.type);\n        if (nextGroup !== 'API') {\n            logger.log('processQueue', `下一个事件 (${nextJob.type}) 需要防抖，等待300毫秒...`);\n            await new Promise(resolve => setTimeout(resolve, 300));\n        }\n        // --- 1. 事件批处理与合并 ---\n        const batchToProcess = eventQueue.splice(0, eventQueue.length);\n        const finalJobs = (0,_merger__WEBPACK_IMPORTED_MODULE_1__.mergeEventBatch)(batchToProcess); // **委托合并**\n        // --- 2. 严格按顺序执行合并后的任务 ---\n        for (const job of finalJobs) {\n            // **委托执行**\n            // 将当前任务和上下文状态传递给执行器\n            const { newIgnoreRule, newConsecutiveMkState } = await (0,_dispatcher__WEBPACK_IMPORTED_MODULE_0__.dispatchAndExecuteTask)(job, mkToIgnore, consecutiveMkState);\n            // 更新上下文状态，为下一个任务做准备\n            mkToIgnore = newIgnoreRule;\n            consecutiveMkState = newConsecutiveMkState;\n        }\n        logger.debug('processQueue', '本轮批次处理完毕。');\n    }\n    // 队列处理完毕，释放锁，等待下一次事件入队。\n    isProcessing = false;\n    logger.log('processQueue', '处理器空闲，已释放锁。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUVVO0FBR3lFO0FBQ2xCO0FBQzlCO0FBRXRDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUUxQzs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsR0FBZSxFQUFFLENBQUM7QUFFbEM7OztHQUdHO0FBQ0gsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO0FBRXpCOzs7OztHQUtHO0FBQ0ksU0FBUyxXQUFXLENBQUMsSUFBWSxFQUFFLE1BQVk7SUFDcEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsVUFBVSxJQUFJLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDakUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDekQsWUFBWSxFQUFFLENBQUMsQ0FBQyxVQUFVO0FBQzVCLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsS0FBSyxVQUFVLFlBQVk7SUFDekIsSUFBSSxZQUFZO1FBQUUsT0FBTyxDQUFDLDBCQUEwQjtJQUNwRCxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBRXBCLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRXZDLGdCQUFnQjtJQUNoQiwyQ0FBMkM7SUFDM0MsSUFBSSxVQUFVLEdBQXNCLElBQUksQ0FBQztJQUN6QyxJQUFJLGtCQUFrQixHQUE4QixJQUFJLENBQUM7SUFFekQsT0FBTyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQzdCLGNBQWM7UUFDZCxNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxTQUFTLEdBQUcsc0RBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsSUFBSSxTQUFTLEtBQUssS0FBSyxFQUFFLENBQUM7WUFDeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsVUFBVSxPQUFPLENBQUMsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekQsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixNQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0QsTUFBTSxTQUFTLEdBQUcsd0RBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFdBQVc7UUFFOUQsMkJBQTJCO1FBQzNCLEtBQUssTUFBTSxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7WUFDNUIsV0FBVztZQUNYLG9CQUFvQjtZQUNwQixNQUFNLEVBQUUsYUFBYSxFQUFFLHFCQUFxQixFQUFFLEdBQUcsTUFBTSxtRUFBc0IsQ0FDM0UsR0FBRyxFQUNILFVBQVUsRUFDVixrQkFBa0IsQ0FDbkIsQ0FBQztZQUVGLG9CQUFvQjtZQUNwQixVQUFVLEdBQUcsYUFBYSxDQUFDO1lBQzNCLGtCQUFrQixHQUFHLHFCQUFxQixDQUFDO1FBQzdDLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsd0JBQXdCO0lBQ3hCLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDNUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuovku7bpmJ/liJfkuI7mgLvosIPluqbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTigJznpZ7nu4/kuK3mnqLigJ3jgILlroPpgJrov4fkuIDkuKrkuovku7bpmJ/liJfmnLrliLbvvIzlsIbmiYDmnInkuovku7bnmoTmjqXmlLbjgIFcbiAqIOWQiOW5tuOAgeWIhuWPkeWSjOaJp+ihjOa1geeoi+WMlu+8jOS7juagueacrOS4iuino+WGs+S6huW5tuWPkeWSjOeKtuaAgeernuS6iemXrumimOOAglxuICpcbiAqICoq5bel5L2c5Y6f55CGKio6XG4gKiAxLiAqKuS6i+S7tuWFpemYnyoqOiDmiYDmnInkuovku7bvvIjmnaXoh6rphZLppobmiJYgQVBJ77yJ6YO96KKr5bCB6KOF5oiQIGBFdmVudEpvYmAg5a+56LGh77yM5o6o5YWlIGBldmVudFF1ZXVlYOOAglxuICogMi4gKirljZXnur/nqIvlpITnkIYqKjogYHByb2Nlc3NRdWV1ZWAg5Ye95pWw5L2/55SoIGBpc1Byb2Nlc3NpbmdgIOmUgeehruS/neWQjOS4gOaXtumXtOWPquacieS4gOS4quWkhOeQhuW+queOr+WcqOi/kOihjOOAglxuICogMy4gKirpmLLmipbkuI7mibnlpITnkIYqKjog5Zyo5aSE55CG5YmN5Lya6L+b6KGM55+t5pqC6Ziy5oqW77yM5Lul5pS26ZuG55+t5pe26Ze05YaF6L+e57ut6Kem5Y+R55qE5aSa5Liq5LqL5Lu277yM5b2i5oiQ5LiA5Liq4oCc5om55qyh4oCd44CCXG4gKiA0LiAqKuWnlOaJmOWQiOW5tioqOiDlsIbmlbTkuKrmibnmrKHkuqTnlLEgYGV2ZW50X21lcmdlci50c2Ag5qih5Z2X6L+b6KGM5pm66IO95ZCI5bm277yI5a+55Yay44CB6KaG55uW77yJ44CCXG4gKiA1LiAqKuWnlOaJmOaJp+ihjCoqOiDlvqrnjq/pgY3ljoblkIjlubblkI7nmoTku7vliqHvvIzlsIbmr4/kuKrku7vliqHlp5TmiZjnu5kgYHRhc2tfZGlzcGF0Y2hlci50c2Ag5qih5Z2X6L+b6KGM54us56uL44CB5Y6f5a2Q55qE5omn6KGM44CCXG4gKiA2LiAqKueKtuaAgeS8oOmAkioqOiDlnKjkuI3lkIzku7vliqHnmoTmiafooYzkuYvpl7TvvIzkvKDpgJLlkozmm7TmlrDlv4XopoHnmoTkuIrkuIvmlofnirbmgIHvvIjlpoIgYG1rVG9JZ25vcmVgIOWSjCBgY29uc2VjdXRpdmVNa1N0YXRlYO+8ieOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IENvbnNlY3V0aXZlTWtTdGF0ZSwgZGlzcGF0Y2hBbmRFeGVjdXRlVGFzaywgSWdub3JlUnVsZSB9IGZyb20gJy4vZGlzcGF0Y2hlcic7XG5pbXBvcnQgeyBFdmVudEpvYiwgZ2V0RXZlbnRHcm91cCwgbWVyZ2VFdmVudEJhdGNoIH0gZnJvbSAnLi9tZXJnZXInO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLXF1ZXVlJyk7XG5cbi8qKlxuICogQGNvbnN0IHtFdmVudEpvYltdfSBldmVudFF1ZXVlXG4gKiBAZGVzY3JpcHRpb24g5LqL5Lu26Zif5YiX77yM5a2Y5YKo5omA5pyJ5b6F5aSE55CG55qE5LqL5Lu25Lu75Yqh44CCXG4gKi9cbmNvbnN0IGV2ZW50UXVldWU6IEV2ZW50Sm9iW10gPSBbXTtcblxuLyoqXG4gKiBAbGV0IHtib29sZWFufSBpc1Byb2Nlc3NpbmdcbiAqIEBkZXNjcmlwdGlvbiDlpITnkIblmajplIHjgILkuLogdHJ1ZSDml7booajnpLogYHByb2Nlc3NRdWV1ZWAg5q2j5Zyo6L+Q6KGM77yM6Ziy5q2i6YeN5YWl44CCXG4gKi9cbmxldCBpc1Byb2Nlc3NpbmcgPSBmYWxzZTtcblxuLyoqXG4gKiAqKuOAkOS6i+S7tuWFpeWPo+OAkSoqXG4gKiDlsIbkuIDkuKrkuovku7bmjqjlhaXpmJ/liJfvvIzlubblsJ3or5XlkK/liqjlpITnkIblmajjgILov5nmmK/miYDmnInkuovku7bnm5HlkKzlmajnmoTnu5/kuIDlhaXlj6PngrnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0g5LqL5Lu257G75Z6LIChlLmcuLCBgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX0RFTEVURURgKeOAglxuICogQHBhcmFtIHthbnl9IFtkZXRhaWxdIC0g5LqL5Lu26ZmE5bim55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwdXNoVG9RdWV1ZSh0eXBlOiBzdHJpbmcsIGRldGFpbD86IGFueSkge1xuICBsb2dnZXIuZGVidWcoJ3B1c2hUb1F1ZXVlJywgYOaOpeaUtuWIsOS6i+S7tjogJHt0eXBlfe+8jOW3suaOqOWFpemYn+WIl+OAgmAsIHsgZGV0YWlsIH0pO1xuICBldmVudFF1ZXVlLnB1c2goeyB0eXBlLCBkZXRhaWwsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTtcbiAgcHJvY2Vzc1F1ZXVlKCk7IC8vIOWwneivleWQr+WKqOWkhOeQhuWZqFxufVxuXG4vKipcbiAqICoq44CQ5qC45b+D5LqL5Lu25aSE55CG5Zmo44CRKipcbiAqIOaMgee7reS7jumYn+WIl+S4reWPluWHuuS6i+S7tuOAgeWQiOW5tuOAgeW5tuaMiemhuuW6j+aJp+ihjOOAglxuICog6L+Z5piv5LiA5Liq6Ieq6amx5Yqo55qE5byC5q2l5Ye95pWw77yM5Y+q6KaB6Zif5YiX5LiN5Li656m65bCx5Lya5LiA55u06L+Q6KGM77yM55u05Yiw5aSE55CG5a6M5omA5pyJ5Lu75Yqh44CCXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NRdWV1ZSgpIHtcbiAgaWYgKGlzUHJvY2Vzc2luZykgcmV0dXJuOyAvLyDlpoLmnpzlt7LlnKjlpITnkIbkuK3vvIzliJnnm7TmjqXov5Tlm57vvIznrYnlvoXlvZPliY3lvqrnjq/lrozmiJDjgIJcbiAgaXNQcm9jZXNzaW5nID0gdHJ1ZTtcblxuICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo5ZCv5YqoLi4uJyk7XG5cbiAgLy8gLS0tIOeKtuaAgeWIneWni+WMliAtLS1cbiAgLy8g6L+Z5Lqb54q25oCB5Y+Y6YeP5a6a5LmJ5ZyoIHdoaWxlIOW+queOr+WklumDqO+8jOS7peWcqOS4jeWQjOaJueasoeeahOS6i+S7tuWkhOeQhuS5i+mXtOS/neaMgei/nue7reaAp+OAglxuICBsZXQgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwgPSBudWxsO1xuICBsZXQgY29uc2VjdXRpdmVNa1N0YXRlOiBDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsID0gbnVsbDtcblxuICB3aGlsZSAoZXZlbnRRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgLy8g44CQ5LqL5Lu25pS26ZuG56qX5Y+j5LiO6Ziy5oqW44CRXG4gICAgY29uc3QgbmV4dEpvYiA9IGV2ZW50UXVldWVbMF07XG4gICAgY29uc3QgbmV4dEdyb3VwID0gZ2V0RXZlbnRHcm91cChuZXh0Sm9iLnR5cGUpO1xuICAgIGlmIChuZXh0R3JvdXAgIT09ICdBUEknKSB7XG4gICAgICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCBg5LiL5LiA5Liq5LqL5Lu2ICgke25leHRKb2IudHlwZX0pIOmcgOimgemYsuaKlu+8jOetieW+hTMwMOavq+enki4uLmApO1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDMwMCkpO1xuICAgIH1cblxuICAgIC8vIC0tLSAxLiDkuovku7bmibnlpITnkIbkuI7lkIjlubYgLS0tXG4gICAgY29uc3QgYmF0Y2hUb1Byb2Nlc3MgPSBldmVudFF1ZXVlLnNwbGljZSgwLCBldmVudFF1ZXVlLmxlbmd0aCk7XG4gICAgY29uc3QgZmluYWxKb2JzID0gbWVyZ2VFdmVudEJhdGNoKGJhdGNoVG9Qcm9jZXNzKTsgLy8gKirlp5TmiZjlkIjlubYqKlxuXG4gICAgLy8gLS0tIDIuIOS4peagvOaMiemhuuW6j+aJp+ihjOWQiOW5tuWQjueahOS7u+WKoSAtLS1cbiAgICBmb3IgKGNvbnN0IGpvYiBvZiBmaW5hbEpvYnMpIHtcbiAgICAgIC8vICoq5aeU5omY5omn6KGMKipcbiAgICAgIC8vIOWwhuW9k+WJjeS7u+WKoeWSjOS4iuS4i+aWh+eKtuaAgeS8oOmAkue7meaJp+ihjOWZqFxuICAgICAgY29uc3QgeyBuZXdJZ25vcmVSdWxlLCBuZXdDb25zZWN1dGl2ZU1rU3RhdGUgfSA9IGF3YWl0IGRpc3BhdGNoQW5kRXhlY3V0ZVRhc2soXG4gICAgICAgIGpvYixcbiAgICAgICAgbWtUb0lnbm9yZSxcbiAgICAgICAgY29uc2VjdXRpdmVNa1N0YXRlLFxuICAgICAgKTtcblxuICAgICAgLy8g5pu05paw5LiK5LiL5paH54q25oCB77yM5Li65LiL5LiA5Liq5Lu75Yqh5YGa5YeG5aSHXG4gICAgICBta1RvSWdub3JlID0gbmV3SWdub3JlUnVsZTtcbiAgICAgIGNvbnNlY3V0aXZlTWtTdGF0ZSA9IG5ld0NvbnNlY3V0aXZlTWtTdGF0ZTtcbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn5pys6L2u5om55qyh5aSE55CG5a6M5q+V44CCJyk7XG4gIH1cblxuICAvLyDpmJ/liJflpITnkIblrozmr5XvvIzph4rmlL7plIHvvIznrYnlvoXkuIvkuIDmrKHkuovku7blhaXpmJ/jgIJcbiAgaXNQcm9jZXNzaW5nID0gZmFsc2U7XG4gIGxvZ2dlci5sb2coJ3Byb2Nlc3NRdWV1ZScsICflpITnkIblmajnqbrpl7LvvIzlt7Lph4rmlL7plIHjgIInKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/queue.ts\n\n}");
  },
  "./src/ERA变量框架/index.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/index.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _events_merger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./events/merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _events_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./events/queue */ \"./src/ERA变量框架/events/queue.ts\");\n/* harmony import */ var _api_macro_parser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/macro/parser */ \"./src/ERA变量框架/api/macro/parser.ts\");\n/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\n\n// ===============================\n// 事件监听器注册\n// ===============================\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.WRITE,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.SYNC,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.API,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.UPDATE_MK_ONLY,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COLLISION_DETECTORS,\n];\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n    // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n    // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n    eventOn(ev, (detail) => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)(ev, detail));\n});\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_full_sync'));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUVrQztBQUNGO0FBRTdDLDRCQUE0QjtBQUNBO0FBRTVCLGtDQUFrQztBQUNsQyxVQUFVO0FBQ1Ysa0NBQWtDO0FBRWxDOzs7R0FHRztBQUNILE1BQU0sY0FBYyxHQUFHO0lBQ3JCLEdBQUcsd0RBQVksQ0FBQyxLQUFLO0lBQ3JCLEdBQUcsd0RBQVksQ0FBQyxJQUFJO0lBQ3BCLEdBQUcsd0RBQVksQ0FBQyxHQUFHO0lBQ25CLEdBQUcsd0RBQVksQ0FBQyxjQUFjO0lBQzlCLEdBQUcsd0RBQVksQ0FBQyxtQkFBbUI7Q0FDcEMsQ0FBQztBQUVGLHdCQUF3QjtBQUN4QixvQkFBb0I7QUFDcEIsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtJQUMxQixtQ0FBbUM7SUFDbkMsd0RBQXdEO0lBQ3hELE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFXLEVBQUUsRUFBRSxDQUFDLDBEQUFXLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFDLENBQUM7QUFFSCx3QkFBd0I7QUFDeEIsNEJBQTRCO0FBQzVCLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO0FBQ3JFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO0FBQ3BFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsMERBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuLvlhaXlj6PkuI7kuovku7bnm5HlkKzmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25piv5pW05LiqIEVSQSDlj5jph4/moYbmnrbnmoTotbfngrnjgILlroPnmoTogYzotKPpnZ7luLjmuIXmmbDlkozkuJPkuIDvvJpcbiAqIDEuICoq5a6a5LmJ55uR5ZCs6IyD5Zu0Kio6IOWjsOaYjuahhuaetuaJgOWFs+W/g+eahOaJgOacieS6i+S7tuexu+Wei+OAglxuICogMi4gKirms6jlhoznm5HlkKzlmagqKjog5Li65LiK6L+w5omA5pyJ5LqL5Lu25rOo5YaM55uR5ZCs5Zmo44CCXG4gKiAzLiAqKue7n+S4gOa0vuWPkSoqOiDlvZPku7vkvZXkuIDkuKrooqvnm5HlkKznmoTkuovku7bop6blj5Hml7bvvIzlroPkuI3ov5vooYzku7vkvZXpgLvovpHlpITnkIbvvIxcbiAqICAgIOiAjOaYr+eri+WNs+WwhuivpeS6i+S7tu+8iOWMheaLrOS6i+S7tuexu+Wei+WSjOmZhOW4puaVsOaNru+8ieWOn+WwgeS4jeWKqOWcsOaOqOWFpeWIsCBgZXZlbnRfcXVldWUudHNgXG4gKiAgICDkuK3nmoTkuovku7blpITnkIbpmJ/liJfkuK3jgIJcbiAqXG4gKiDov5nnp43orr7orqHkvZPnjrDkuoboia/lpb3nmoQqKuWFs+azqOeCueWIhuemuyoq5Y6f5YiZ77yaYGluZGV4LnRzYCDlj6rotJ/otKPigJzlkKzigJ3vvIzogIwgYGV2ZW50X3F1ZXVlLnRzYFxuICog6LSf6LSj4oCc5oCd6ICD4oCd5ZKM4oCc6KGM5Yqo4oCd44CC6L+Z5L2/5b6X5LqL5Lu255qE5p2l5rqQ5ZKM5aSE55CG6YC76L6R5a6M5YWo6Kej6ICm77yM6Z2e5bi45riF5pmw5LiU5piT5LqO57u05oqk44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFVkVOVF9HUk9VUFMgfSBmcm9tICcuL2V2ZW50cy9tZXJnZXInO1xuaW1wb3J0IHsgcHVzaFRvUXVldWUgfSBmcm9tICcuL2V2ZW50cy9xdWV1ZSc7XG5cbi8vIOWvvOWFpeafpeivouaooeWdlywg5Lul5rOo5YaMIHt7RVJBOi4uLn19IOWuj1xuaW1wb3J0ICcuL2FwaS9tYWNyby9wYXJzZXInO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7bnm5HlkKzlmajms6jlhoxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBAY29uc3Qge3N0cmluZ1tdfSBldmVudHNUb0xpc3RlblxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOaciemcgOimgeiiqyBFUkEg5qGG5p6255uR5ZCs55qE5LqL5Lu244CCXG4gKi9cbmNvbnN0IGV2ZW50c1RvTGlzdGVuID0gW1xuICAuLi5FVkVOVF9HUk9VUFMuV1JJVEUsXG4gIC4uLkVWRU5UX0dST1VQUy5TWU5DLFxuICAuLi5FVkVOVF9HUk9VUFMuQVBJLFxuICAuLi5FVkVOVF9HUk9VUFMuVVBEQVRFX01LX09OTFksXG4gIC4uLkVWRU5UX0dST1VQUy5DT0xMSVNJT05fREVURUNUT1JTLFxuXTtcblxuLy8g6YGN5Y6G5LqL5Lu25YiX6KGo77yM5Li65q+P5Liq5LqL5Lu25rOo5YaM5LiA5Liq5Zue6LCD5Ye95pWw44CCXG4vLyDov5nkuKrlm57osIPlh73mlbDmmK/miYDmnInkuovku7bnmoTnu5/kuIDlhaXlj6PjgIJcbmV2ZW50c1RvTGlzdGVuLmZvckVhY2goZXYgPT4ge1xuICAvLyBgZXZlbnRPbmAg5piv6YWS6aaG5Yqp5omL5o+Q5L6b55qE5YWo5bGA5Ye95pWw77yM55So5LqO5rOo5YaM5LqL5Lu255uR5ZCs44CCXG4gIC8vIOW9k+S6i+S7tiBgZXZgIOinpuWPkeaXtu+8jOWbnuiwg+WHveaVsOiiq+iwg+eUqO+8jOW5tuWwhuS6i+S7tuexu+WeiyBgZXZgIOWSjOS6i+S7tuivpuaDhSBgZGV0YWlsYCDmjqjlhaXpmJ/liJfjgIJcbiAgZXZlbnRPbihldiwgKGRldGFpbDogYW55KSA9PiBwdXNoVG9RdWV1ZShldiwgZGV0YWlsKSk7XG59KTtcblxuLy8g5Li66YWS6aaG5Yqp5omL6ISa5pys55WM6Z2i5Lit55qE5omL5Yqo5oyJ6ZKu5rOo5YaM55uR5ZCs5Zmo44CCXG4vLyDngrnlh7vmjInpkq7ml7bvvIzlkIzmoLfmmK/lkJHpmJ/liJfkuK3mjqjlhaXkuIDkuKrnibnlrprnsbvlnovnmoTkuovku7bjgIJcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+WGmeWFpeWPmOmHj+S/ruaUuScpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX3dyaXRlJykpO1xuZXZlbnRPbihnZXRCdXR0b25FdmVudCgn5omL5Yqo5ZCM5q2l54q25oCBJyksICgpID0+IHB1c2hUb1F1ZXVlKCdtYW51YWxfc3luYycpKTtcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+W8uuWItuWujOWFqOmHjeeulycpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX2Z1bGxfc3luYycpKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/index.ts\n\n}");
  },
  "./src/ERA变量框架/utils/constants.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/utils/constants.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_SCOPE: () => (/* binding */ CHAT_SCOPE),\n/* harmony export */   ERA_API_EVENTS: () => (/* binding */ ERA_API_EVENTS),\n/* harmony export */   ERA_DATA_REGEX: () => (/* binding */ ERA_DATA_REGEX),\n/* harmony export */   ERA_DATA_TAG: () => (/* binding */ ERA_DATA_TAG),\n/* harmony export */   ERA_EVENT_EMITTER: () => (/* binding */ ERA_EVENT_EMITTER),\n/* harmony export */   LOGS_PATH: () => (/* binding */ LOGS_PATH),\n/* harmony export */   META_DATA_PATH: () => (/* binding */ META_DATA_PATH),\n/* harmony export */   SEL_PATH: () => (/* binding */ SEL_PATH),\n/* harmony export */   STAT_DATA_PATH: () => (/* binding */ STAT_DATA_PATH)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   "ERAMetaData": {\n *     "EditLogs": { ... },\n *     "SelectedMks": [ ... ]\n *   },\n *   "stat_data": {\n *     "player": { "hp": 100, "gold": 50 },\n *     "world_state": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nconst CHAT_SCOPE = { type: \'chat\' };\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nconst META_DATA_PATH = \'ERAMetaData\';\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nconst STAT_DATA_PATH = \'stat_data\';\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `"EditLogs"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * "era_mk_1759246942209_jipmrj": [\n *   { "op": "insert", "path": "testData.inventory", "value_new": { "gold": 100, "slots": ["sword", "shield"] } },\n *   { "op": "update", "path": "player.hp", "value_old": 90, "value_new": 100 }\n * ]\n */\nconst LOGS_PATH = \'EditLogs\';\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `"SelectedMks"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , "era_mk_greeting", "era_mk_abc123", , "era_mk_xyz789"]\n */\nconst SEL_PATH = \'SelectedMks\';\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nconst ERA_DATA_TAG = \'era_data\';\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nconst ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nconst ERA_API_EVENTS = {\n    INSERT_BY_OBJECT: \'era:insertByObject\',\n    UPDATE_BY_OBJECT: \'era:updateByObject\',\n    INSERT_BY_PATH: \'era:insertByPath\',\n    UPDATE_BY_PATH: \'era:updateByPath\',\n    DELETE_BY_OBJECT: \'era:deleteByObject\',\n    DELETE_BY_PATH: \'era:deleteByPath\',\n};\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nconst ERA_EVENT_EMITTER = {\n    /** 当变量写入完成时触发 */\n    WRITE_DONE: \'era:writeDone\',\n    /** 当API执行写入时触发 */\n    API_WRITE: \'era:apiWrite\',\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRCRztBQUVVO0FBRWI7Ozs7OztHQU1HO0FBQ0ksTUFBTSxVQUFVLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBZSxFQUFFLENBQUM7QUFFcEQ7OztHQUdHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDOzs7R0FHRztBQUNJLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQztBQUUxQzs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDO0FBRXBDOzs7Ozs7Ozs7OztHQVdHO0FBQ0ksTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDO0FBRXRDOzs7OztHQUtHO0FBQ0ksTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDO0FBRXZDOzs7OztHQUtHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxZQUFZLGVBQWUsWUFBWSxHQUFHLENBQUMsQ0FBQztBQUV6Rjs7Ozs7R0FLRztBQUNJLE1BQU0sY0FBYyxHQUFHO0lBQzVCLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyxjQUFjLEVBQUUsa0JBQWtCO0lBQ2xDLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxjQUFjLEVBQUUsa0JBQWtCO0NBQzFCLENBQUM7QUFFWDs7O0dBR0c7QUFDSSxNQUFNLGlCQUFpQixHQUFHO0lBQy9CLGlCQUFpQjtJQUNqQixVQUFVLEVBQUUsZUFBZTtJQUMzQixrQkFBa0I7SUFDbEIsU0FBUyxFQUFFLGNBQWM7Q0FDakIsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmoLjlv4PluLjph4/mqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu26ZuG5Lit5a6a5LmJ5LqG5pW05LiqIEVSQSDmoYbmnrbmiYDkvb/nlKjnmoTlhbPplK7luLjph4/jgIJcbiAqIOi/meS6m+W4uOmHj+S4u+imgeeUqOS9nOWcqOmFkummhiBgY2hhdGAg5Y+Y6YeP5Lit5a2Y5YKo5ZKM5qOA57SiIEVSQSDmoLjlv4PmlbDmja7nmoTot6/lvoTvvIjplK7lkI3vvInjgIJcbiAqXG4gKiAqKuaguOW/g+aVsOaNrue7k+aehCoqOlxuICogRVJBIOeahOaVsOaNruiiq+WIhuS4uuS4pOmDqOWIhu+8jOWtmOWCqOWcqCBgY2hhdGAg5Y+Y6YeP5LiL77yaXG4gKiAxLiAqKuWFg+aVsOaNriAoRVJBTWV0YURhdGEpKio6IOWMheWQq+ahhuaetuiHqui6q+i/kOihjOaJgOmcgOeahOaguOW/g+aVsOaNru+8jOWmgiBgRWRpdExvZ3NgIOWSjCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAyLiAqKueKtuaAgeaVsOaNriAoc3RhdF9kYXRhKSoqOiDljIXlkKvmiYDmnInnlLHnlKjmiLflkowgQUkg566h55CG55qE5ri45oiPL+aVheS6i+WPmOmHj++8jOWmgiBgcGxheWVyYOOAgWB3b3JsZF9zdGF0ZWAg562J44CCXG4gKlxuICog5YW257uT5p6E5aSn6Ie05aaC5LiL77yaXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgIFwiRVJBTWV0YURhdGFcIjoge1xuICogICAgIFwiRWRpdExvZ3NcIjogeyAuLi4gfSxcbiAqICAgICBcIlNlbGVjdGVkTWtzXCI6IFsgLi4uIF1cbiAqICAgfSxcbiAqICAgXCJzdGF0X2RhdGFcIjoge1xuICogICAgIFwicGxheWVyXCI6IHsgXCJocFwiOiAxMDAsIFwiZ29sZFwiOiA1MCB9LFxuICogICAgIFwid29ybGRfc3RhdGVcIjogeyAuLi4gfVxuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqIOWwhui/meS6m+i3r+W+hOWumuS5ieS4uuW4uOmHj++8jOacieWKqeS6ju+8mlxuICogMS4gKirpgb/lhY3noaznvJbnoIEqKu+8muWHj+WwkeWboOaLvOWGmemUmeivr+WvvOiHtOeahCBidWfjgIJcbiAqIDIuICoq5o+Q6auY5Y+v57u05oqk5oCnKirvvJrlpoLmnpzmnKrmnaXpnIDopoHosIPmlbTmlbDmja7nu5PmnoTvvIzlj6rpnIDkv67mlLnmraTmlofku7bljbPlj6/jgIJcbiAqIDMuICoq5aKe5by65Luj56CB5Y+v6K+75oCnKirvvJrluLjph4/nmoTlkI3np7DmuIXmmbDlnLDooajovr7kuoblhbbmiYDmjIflkJHnmoTmlbDmja7nmoTlkKvkuYnjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IENIQVRfU0NPUEVcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO6YWS6aaG5Yqp5omLIGBnZXRWYXJpYWJsZXNgIOWSjCBgcmVwbGFjZVZhcmlhYmxlc2Ag57O75YiX5Ye95pWw55qEIGBzY29wZWAg5Y+C5pWw44CCXG4gKiDlroPmjIflrprkuobmk43kvZznmoTnm67moIfmmK/lvZPliY0qKuiBiuWkqe+8iENoYXTvvIkqKue6p+WIq+eahOWPmOmHj+OAglxuICogRVJBIOahhuaetueahOaJgOacieaguOW/g+aVsOaNruWSjOeUqOaIt+WPmOmHj+mDveWtmOWCqOWcqOatpOS9nOeUqOWfn+S4i+OAglxuICovXG5leHBvcnQgY29uc3QgQ0hBVF9TQ09QRSA9IHsgdHlwZTogJ2NoYXQnIGFzIGNvbnN0IH07XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IE1FVEFfREFUQV9QQVRIXG4gKiBAZGVzY3JpcHRpb24g5ZyoIGBjaGF0YCDlj5jph4/kuK3vvIzlrZjlgqggRVJBIOahhuaetioq5YWD5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IE1FVEFfREFUQV9QQVRIID0gJ0VSQU1ldGFEYXRhJztcblxuLyoqXG4gKiBAY29uc3RhbnQge3N0cmluZ30gU1RBVF9EQVRBX1BBVEhcbiAqIEBkZXNjcmlwdGlvbiDlnKggYGNoYXRgIOWPmOmHj+S4re+8jOWtmOWCqOeUqOaItyoq54q25oCB5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IFNUQVRfREFUQV9QQVRIID0gJ3N0YXRfZGF0YSc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IExPR1NfUEFUSFxuICogQGRlc2NyaXB0aW9uXG4gKiDlnKggYEVSQU1ldGFEYXRhYCDlr7nosaHkuK3vvIzlrZjlgqgqKue8lui+keaXpeW/l++8iEVkaXQgTG9nc++8iSoq55qE5a+56LGh55qE6ZSu5ZCN77yM5Y2zIGBcIkVkaXRMb2dzXCJg44CCXG4gKiBgRWRpdExvZ3NgIOaYr+S4gOS4quS7pSoq5raI5oGv5a+G6ZKl77yITUvvvIkqKuS4uumUru+8jOS7peivpea2iOaBr+W8leWPkeeahOWPmOmHj+WPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICog6L+Z5piv5a6e546w4oCc6YCG5bqP5Zue5rua4oCd5Yqf6IO955qE5Z+656GA5pWw5o2u44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIGNoYXQuRVJBTWV0YURhdGEuRWRpdExvZ3Mg55qE5LiA5Liq5p2h55uuXG4gKiBcImVyYV9ta18xNzU5MjQ2OTQyMjA5X2ppcG1yalwiOiBbXG4gKiAgIHsgXCJvcFwiOiBcImluc2VydFwiLCBcInBhdGhcIjogXCJ0ZXN0RGF0YS5pbnZlbnRvcnlcIiwgXCJ2YWx1ZV9uZXdcIjogeyBcImdvbGRcIjogMTAwLCBcInNsb3RzXCI6IFtcInN3b3JkXCIsIFwic2hpZWxkXCJdIH0gfSxcbiAqICAgeyBcIm9wXCI6IFwidXBkYXRlXCIsIFwicGF0aFwiOiBcInBsYXllci5ocFwiLCBcInZhbHVlX29sZFwiOiA5MCwgXCJ2YWx1ZV9uZXdcIjogMTAwIH1cbiAqIF1cbiAqL1xuZXhwb3J0IGNvbnN0IExPR1NfUEFUSCA9ICdFZGl0TG9ncyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IFNFTF9QQVRIXG4gKiBAZGVzY3JpcHRpb25cbiAqIOWcqCBgRVJBTWV0YURhdGFgIOWvueixoeS4re+8jOWtmOWCqCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+77yIU2VsZWN0ZWQgTWVzc2FnZSBLZXlz77yJKirnmoTmlbDnu4TnmoTplK7lkI3vvIzljbMgYFwiU2VsZWN0ZWRNa3NcImDjgIJcbiAqIGBTZWxlY3RlZE1rc2Ag5piv5LiA5Liq56iA55aP5pWw57uE77yM5YW2KirntKLlvJXnuqbnrYnkuo7mtojmga8gSUQqKu+8jOWAvOaYr+ivpealvOWxgua2iOaBr+eahCBNS+OAglxuICog6L+Z5Liq5pWw57uE5pivIEVSQSDmoYbmnrbnmoTigJzohIrmooHigJ3vvIzmmK/ov57mjqXmir3osaHlj5jph4/nirbmgIHkuI7lhbfkvZPogYrlpKnljoblj7LnmoTmoaXmooHjgIJcbiAqIOahhuaetumAmui/h+avlOWvuSBgU2VsZWN0ZWRNa3NgIOS4juWunumZhea2iOaBr+a1geS4reeahCBNS++8jOadpeWIpOaWreaVsOaNruaYr+WQpumcgOimgeWQjOatpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBjaGF0LkVSQU1ldGFEYXRhLlNlbGVjdGVkTWtzXG4gKiBbICwgXCJlcmFfbWtfZ3JlZXRpbmdcIiwgXCJlcmFfbWtfYWJjMTIzXCIsICwgXCJlcmFfbWtfeHl6Nzg5XCJdXG4gKi9cbmV4cG9ydCBjb25zdCBTRUxfUEFUSCA9ICdTZWxlY3RlZE1rcyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IEVSQV9EQVRBX1RBR1xuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7lnKjmtojmga/lhoXlrrnkuK3ljIXoo7kgRVJBIOWFg+aVsOaNru+8iOWmgua2iOaBr+WvhumSpSBNS++8ieeahCBYTUwg6aOO5qC85qCH562+5ZCN44CCXG4gKiBlLmcuLCBgPGVyYV9kYXRhPnsuLi59PC9lcmFfZGF0YT5gXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfREFUQV9UQUcgPSAnZXJhX2RhdGEnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7UmVnRXhwfSBFUkFfREFUQV9SRUdFWFxuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7ku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3ljLnphY3lkozmj5Dlj5YgYDxlcmFfZGF0YT5gIOWdl+eahOato+WImeihqOi+vuW8j+OAglxuICog6L+Z5Liq5bi46YeP6KKr5a6a5LmJ5Zyo6L+Z6YeM77yM5Lul6YG/5YWNIGBtZXNzYWdlX2tleS50c2Ag5ZKMIGBtZXNzYWdlX3V0aWxzLnRzYCDkuYvpl7TnmoTlvqrnjq/kvp3otZbjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEVSQV9EQVRBX1JFR0VYID0gbmV3IFJlZ0V4cChgPCR7RVJBX0RBVEFfVEFHfT4oey4qP30pPFxcXFwvJHtFUkFfREFUQV9UQUd9PmApO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfQVBJX0VWRU5UU1xuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobmiYDmnInkvpvlpJbpg6johJrmnKzpgJrov4cgYGV2ZW50RW1pdGAg6LCD55So55qE6Ieq5a6a5LmJIEFQSSDkuovku7blkI3np7DjgIJcbiAqIOS9v+eUqOi/meS6m+W4uOmHj+WPr+S7pemBv+WFjeWcqOS7o+eggeS4reS9v+eUqOehrOe8lueggeeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0FQSV9FVkVOVFMgPSB7XG4gIElOU0VSVF9CWV9PQkpFQ1Q6ICdlcmE6aW5zZXJ0QnlPYmplY3QnLFxuICBVUERBVEVfQllfT0JKRUNUOiAnZXJhOnVwZGF0ZUJ5T2JqZWN0JyxcbiAgSU5TRVJUX0JZX1BBVEg6ICdlcmE6aW5zZXJ0QnlQYXRoJyxcbiAgVVBEQVRFX0JZX1BBVEg6ICdlcmE6dXBkYXRlQnlQYXRoJyxcbiAgREVMRVRFX0JZX09CSkVDVDogJ2VyYTpkZWxldGVCeU9iamVjdCcsXG4gIERFTEVURV9CWV9QQVRIOiAnZXJhOmRlbGV0ZUJ5UGF0aCcsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfRVZFTlRfRU1JVFRFUlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOacieeUsSBFUkEg5qGG5p62KirlkJHlpJblj5Hlh7oqKueahOS6i+S7tuOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0VWRU5UX0VNSVRURVIgPSB7XG4gIC8qKiDlvZPlj5jph4/lhpnlhaXlrozmiJDml7bop6blj5EgKi9cbiAgV1JJVEVfRE9ORTogJ2VyYTp3cml0ZURvbmUnLFxuICAvKiog5b2TQVBJ5omn6KGM5YaZ5YWl5pe26Kem5Y+RICovXG4gIEFQSV9XUklURTogJ2VyYTphcGlXcml0ZScsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIGBlcmE6d3JpdGVEb25lYCDkuovku7bnmoTotJ/ovb3lr7nosaHnu5PmnoTjgILlroPmj5DkvpvkuoblhbPkuo7kuIDmrKHmiJDlip/lhpnlhaXmk43kvZznmoTlrozmlbTkuIrkuIvmlofjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXcml0ZURvbmVQYXlsb2FkIHtcbiAgLyoqXG4gICAqIOacrOi9ruS6i+S7tuWkhOeQhuW+queOr+S4re+8jOacgOWQjuaTjeS9nOeahOa2iOaBr+eahCoq5raI5oGv5a+G6ZKlIChNZXNzYWdlIEtleSkqKuOAglxuICAgKiDpgJrluLjnlLEgYGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZWAg5Zyo5b6q546v5byA5aeL5pe256Gu5a6a44CCXG4gICAqL1xuICBtazogc3RyaW5nO1xuICAvKipcbiAgICog5pys6L2u5LqL5Lu25aSE55CG5b6q546v5Lit77yM5pyA5ZCO5pON5L2c55qE5raI5oGv55qEKirmtojmga8gSUQqKuOAglxuICAgKi9cbiAgbWVzc2FnZV9pZDogbnVtYmVyO1xuICAvKipcbiAgICog5o+P6L+w5Zyo5pys6L2u5LqL5Lu25aSE55CG5Lit77yM5omn6KGM5LqG5ZOq5Lqb5qC45b+D5pON5L2c44CCXG4gICAqIOi/meWvueS6juWklumDqOiEmuacrOeQhuino+eKtuaAgeWPmOabtOeahOWOn+WboOiHs+WFs+mHjeimgeOAglxuICAgKi9cbiAgYWN0aW9uczoge1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJvbGxiYWNrQnlNa2Ag5pON5L2cICovXG4gICAgcm9sbGJhY2s6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBgQXBwbHlWYXJDaGFuZ2VgIOaTjeS9nCAqL1xuICAgIGFwcGx5OiBib29sZWFuO1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDmk43kvZwgKi9cbiAgICByZXN5bmM6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBBUEkg6LCD55SoICovXG4gICAgYXBpOiBib29sZWFuO1xuICB9O1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jOaVtOS4quiBiuWkqeS8muivneeahCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+IChTZWxlY3RlZCBNZXNzYWdlIEtleXMpKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meaYr+S4gOS4queogOeWj+aVsOe7hO+8jOWFtue0ouW8lee6puetieS6jua2iOaBryBJRO+8jOWAvOaYr+WvueW6lOalvOWxgua2iOaBr+eahCBNS+OAglxuICAgKiDlroPku6PooajkuoblvZPliY3ogYrlpKnorrDlvZXnmoTigJzkuLvlubLigJ3vvIzmmK8gRVJBIOWIpOaWreWQjOatpeeKtuaAgeeahOaguOW/g+aVsOaNrue7k+aehOOAglxuICAgKi9cbiAgc2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdO1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jGBjaGF0YCDlj5jph4/kuK3lrZjlgqjnmoQqKuWujOaVtOeahOe8lui+keaXpeW/l+WvueixoSAoRWRpdExvZ3MpKirjgIJcbiAgICog6L+Z5piv5LiA5Liq5LulIE1LIOS4uumUru+8jOS7peWPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICAgKi9cbiAgZWRpdExvZ3M6IHsgW2tleTogc3RyaW5nXTogYW55W10gfTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzmlbTkuKrogYrlpKnkvJror53nmoQqKueKtuaAgeaVsOaNriAoYHN0YXRfZGF0YWApKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meS4queJiOacrCoq5YyF5ZCrKirmiYDmnInlhoXpg6jkvb/nlKjnmoQgYCRtZXRhYCDlrZfmrrXjgIJcbiAgICovXG4gIHN0YXQ6IGFueTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzkuIDkuKoqKuS4jeWMheWQqyoq5Lu75L2VIGAkbWV0YWAg5a2X5q6155qEIGBzdGF0X2RhdGFgIOeahOa3seaLt+i0neeJiOacrOOAglxuICAgKiDpgILnlKjkuo7pnIDopoHnuq/lh4DmlbDmja7ov5vooYzlsZXnpLrmiJbov5vkuIDmraXlpITnkIbnmoTlnLrmma/jgIJcbiAgICovXG4gIHN0YXRXaXRob3V0TWV0YTogYW55O1xuICAvKipcbiAgICog6KGo56S66L+Z5piv5a+55b2T5YmNIGBta2Ag55qE56ys5Yeg5qyh6L+e57ut5aSE55CG44CCXG4gICAqIOWmguaenOS4gOS4quaWsOeahCBgbWtgIOiiq+WkhOeQhu+8jOi/meS4quiuoeaVsOS8mumHjee9ruS4uiAx44CCXG4gICAqIOi/meWvueS6jumcgOimgeaEn+efpeeKtuaAgeaYr+WQpuWcqOWQjOS4gOa2iOaBr+S4iui/nue7reabtOaWsOeahOWklumDqOiEmuacrOW+iOacieeUqOOAglxuICAgKi9cbiAgY29uc2VjdXRpdmVQcm9jZXNzaW5nQ291bnQ6IG51bWJlcjtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/constants.ts\n\n}');
  },
  "./src/ERA变量框架/utils/data.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/data.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   J: () => (/* binding */ J),\n/* harmony export */   escapeEraData: () => (/* binding */ escapeEraData),\n/* harmony export */   isPO: () => (/* binding */ isPO),\n/* harmony export */   mergeReplaceArray: () => (/* binding */ mergeReplaceArray),\n/* harmony export */   parseEditLog: () => (/* binding */ parseEditLog),\n/* harmony export */   parseJsonl: () => (/* binding */ parseJsonl),\n/* harmony export */   sanitizeArrays: () => (/* binding */ sanitizeArrays),\n/* harmony export */   unescapeEraData: () => (/* binding */ unescapeEraData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * @file ERA 变量框架 - 通用数据处理模块\n */\n\n\nconst ESCAPE_MAP = {\n    '.': '__DOT__',\n    '\"': '__DQUOTE__',\n    \"'\": '__SQUOTE__',\n};\nconst UNESCAPE_MAP = lodash__WEBPACK_IMPORTED_MODULE_0___default().invert(ESCAPE_MAP);\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nfunction escapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => escapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n                newObj[escapedKey] = escapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(escapeRegex, match => ESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nfunction unescapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => unescapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n                newObj[unescapedKey] = unescapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nconst isPO = (v) => lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v);\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nfunction sanitizeArrays(v) {\n    if (Array.isArray(v)) {\n        // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n        return v.map(e => (Array.isArray(e) || lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(e) ? JSON.stringify(e) : e));\n    }\n    else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v)) {\n        // 如果是对象，则递归地对其每个属性值进行净化。\n        const o = {};\n        for (const k in v)\n            o[k] = sanitizeArrays(v[k]);\n        return o;\n    }\n    else {\n        // 其他类型的值直接返回。\n        return v;\n    }\n}\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nconst J = (o) => {\n    try {\n        return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n    }\n    catch (e) {\n        return `<<stringify失败: ${e?.message || e}>>`;\n    }\n};\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nfunction mergeReplaceArray(base, patch) {\n    // 使用 _.cloneDeep 确保不修改原始对象。\n    return lodash__WEBPACK_IMPORTED_MODULE_0___default().mergeWith(lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(base), lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(patch), (a, b) => {\n        // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n        if (Array.isArray(a) || Array.isArray(b))\n            return b;\n        // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n        return undefined;\n    });\n}\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nfunction parseEditLog(raw) {\n    if (Array.isArray(raw))\n        return raw;\n    if (raw && typeof raw === 'object')\n        return [raw]; // 单个对象也视为有效日志\n    if (typeof raw === 'string') {\n        const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n        try {\n            const arr = JSON.parse(s);\n            return Array.isArray(arr) ? arr : [];\n        }\n        catch {\n            return [];\n        }\n    }\n    return [];\n}\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @returns {any[]} 解析出的对象数组。\n */\nfunction parseJsonl(str) {\n    const objects = [];\n    if (!str || typeof str !== 'string') {\n        return objects;\n    }\n    // 在解析前，先移除所有类型的注释，以提高解析的鲁棒性。\n    const strWithoutComments = str\n        .replace(/\\/\\/.*/g, '') // 移除 // 风格的单行注释\n        .replace(/\\/\\*[\\s\\S]*?\\*\\//g, '') // 移除 /* ... */ 风格的多行注释\n        .replace(/\x3c!--[\\s\\S]*?--\x3e/g, ''); // 移除 \x3c!-- ... --\x3e 风格的 HTML/XML 注释\n    const trimmedStr = strWithoutComments.trim();\n    let braceCount = 0; // 花括号平衡计数器\n    let startIndex = -1; // 当前 JSON 对象的起始索引\n    let inString = false; // 标记是否处于双引号字符串内部\n    for (let i = 0; i < trimmedStr.length; i++) {\n        const char = trimmedStr[i];\n        // 切换 inString 状态，忽略转义的双引号\n        if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，则跳过所有花括号的逻辑判断\n        if (inString)\n            continue;\n        if (char === '{') {\n            if (braceCount === 0) {\n                // 发现一个新 JSON 对象的开始\n                startIndex = i;\n            }\n            braceCount++;\n        }\n        else if (char === '}') {\n            if (braceCount > 0) {\n                braceCount--;\n                if (braceCount === 0 && startIndex !== -1) {\n                    // 花括号平衡，一个完整的 JSON 对象被找到\n                    const jsonString = trimmedStr.substring(startIndex, i + 1);\n                    try {\n                        const obj = JSON.parse(jsonString);\n                        objects.push(obj);\n                    }\n                    catch (e) {\n                        // 如果解析失败，在控制台打印错误并继续，不中断整个过程\n                        console.error(`[ERA/utils/parseJsonl] JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n                    }\n                    // 重置状态，准备寻找下一个对象\n                    startIndex = -1;\n                }\n            }\n        }\n    }\n    return objects;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQ2xHLENBQUM7b0JBQ0QsaUJBQWlCO29CQUNqQixVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxPQUFPLE9BQU8sQ0FBQztBQUNqQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvZGF0YS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDpgJrnlKjmlbDmja7lpITnkIbmqKHlnZdcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IEVTQ0FQRV9NQVA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICcuJzogJ19fRE9UX18nLFxuICAnXCInOiAnX19EUVVPVEVfXycsXG4gIFwiJ1wiOiAnX19TUVVPVEVfXycsXG59O1xuXG5jb25zdCBVTkVTQ0FQRV9NQVA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSBfLmludmVydChFU0NBUEVfTUFQKTtcblxuY29uc3QgZXNjYXBlUmVnZXggPSBuZXcgUmVnRXhwKE9iamVjdC5rZXlzKEVTQ0FQRV9NQVApLm1hcChfLmVzY2FwZVJlZ0V4cCkuam9pbignfCcpLCAnZycpO1xuY29uc3QgdW5lc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoT2JqZWN0LnZhbHVlcyhFU0NBUEVfTUFQKS5tYXAoXy5lc2NhcGVSZWdFeHApLmpvaW4oJ3wnKSwgJ2cnKTtcblxuLyoqXG4gKiDpgJLlvZLlnLDovazkuYnlr7nosaHmiJbmlbDnu4TkuK3miYDmnInlrZfnrKbkuLLlgLzlkozplK7nmoTnibnmrorlrZfnrKbjgIJcbiAqIEBwYXJhbSBkYXRhIC0g6KaB5aSE55CG55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyAtIOi9rOS5ieWQjueahOaVsOaNruOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlRXJhRGF0YTxUPihkYXRhOiBUKTogVCB7XG4gIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gZXNjYXBlRXJhRGF0YShpdGVtKSkgYXMgYW55O1xuICB9XG4gIGlmIChfLmlzUGxhaW5PYmplY3QoZGF0YSkpIHtcbiAgICBjb25zdCBuZXdPYmo6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcbiAgICAgICAgY29uc3QgZXNjYXBlZEtleSA9IGtleS5yZXBsYWNlKGVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBFU0NBUEVfTUFQW21hdGNoXSk7XG4gICAgICAgIG5ld09ialtlc2NhcGVkS2V5XSA9IGVzY2FwZUVyYURhdGEoKGRhdGEgYXMgYW55KVtrZXldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ld09iaiBhcyBhbnk7XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBkYXRhLnJlcGxhY2UoZXNjYXBlUmVnZXgsIG1hdGNoID0+IEVTQ0FQRV9NQVBbbWF0Y2hdKSBhcyBhbnk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICog6YCS5b2S5Zyw5Y+N6L2s5LmJ5a+56LGh5oiW5pWw57uE5Lit5omA5pyJ5a2X56ym5Liy5YC85ZKM6ZSu55qE54m55q6K5a2X56ym44CCXG4gKiBAcGFyYW0gZGF0YSAtIOimgeWkhOeQhueahOaVsOaNruOAglxuICogQHJldHVybnMgLSDlj43ovazkuYnlkI7nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuZXNjYXBlRXJhRGF0YTxUPihkYXRhOiBUKTogVCB7XG4gIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gdW5lc2NhcGVFcmFEYXRhKGl0ZW0pKSBhcyBhbnk7XG4gIH1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChkYXRhKSkge1xuICAgIGNvbnN0IG5ld09iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSkge1xuICAgICAgICBjb25zdCB1bmVzY2FwZWRLZXkgPSBrZXkucmVwbGFjZSh1bmVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBVTkVTQ0FQRV9NQVBbbWF0Y2hdKTtcbiAgICAgICAgbmV3T2JqW3VuZXNjYXBlZEtleV0gPSB1bmVzY2FwZUVyYURhdGEoKGRhdGEgYXMgYW55KVtrZXldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ld09iaiBhcyBhbnk7XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBkYXRhLnJlcGxhY2UodW5lc2NhcGVSZWdleCwgbWF0Y2ggPT4gVU5FU0NBUEVfTUFQW21hdGNoXSkgYXMgYW55O1xuICB9XG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIOWIpOaWreS4gOS4quWAvOaYr+WQpuS4uuKAnOe6r+eyueeahOWvueixoeKAne+8iFBsYWluIE9iamVjdO+8ieOAglxuICog5pWw57uE44CBbnVsbOOAgeWHveaVsOOAgURhdGUg5a+56LGh562J6YO95Lya6L+U5ZueIGZhbHNl44CCXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXmo4Dmn6XnmoTlgLzjgIJcbiAqIEByZXR1cm5zIHtib29sZWFufSDlpoLmnpzmmK/nuq/nsrnnmoTlr7nosaHliJnov5Tlm54gdHJ1Ze+8jOWQpuWImei/lOWbniBmYWxzZeOAglxuICovXG5leHBvcnQgY29uc3QgaXNQTyA9ICh2OiBhbnkpOiB2IGlzIFJlY29yZDxzdHJpbmcsIGFueT4gPT4gXy5pc1BsYWluT2JqZWN0KHYpO1xuXG4vKipcbiAqIOmAkuW9kuWcsOKAnOWHgOWMluKAneS4gOS4quWvueixoe+8jOWwhuWFtuS4reeahOaVsOe7hOaIluWvueixoeWAvOi9rOaNouS4uuWtl+espuS4suOAglxuICog5Li76KaB55So5LqO5YeG5aSH5pWw5o2u5Lul5L6/5Zyo5p+Q5Lqb54m55a6a5Zy65pmv5LiL5bGV56S65oiW5a2Y5YKo44CCXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXlh4DljJbnmoTlgLzjgIJcbiAqIEByZXR1cm5zIHsqfSDlh4DljJblkI7nmoTlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplQXJyYXlzKHY6IGFueSk6IGFueSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YGN5Y6G5YW25YWD57Sg44CC5aaC5p6c5YWD57Sg5piv5pWw57uE5oiW5a+56LGh77yM5YiZ5a2X56ym5Liy5YyW5a6D44CCXG4gICAgcmV0dXJuIHYubWFwKGUgPT4gKEFycmF5LmlzQXJyYXkoZSkgfHwgXy5pc1BsYWluT2JqZWN0KGUpID8gSlNPTi5zdHJpbmdpZnkoZSkgOiBlKSk7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5a+56LGh77yM5YiZ6YCS5b2S5Zyw5a+55YW25q+P5Liq5bGe5oCn5YC86L+b6KGM5YeA5YyW44CCXG4gICAgY29uc3QgbzogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3QgayBpbiB2KSBvW2tdID0gc2FuaXRpemVBcnJheXModltrXSk7XG4gICAgcmV0dXJuIG87XG4gIH0gZWxzZSB7XG4gICAgLy8g5YW25LuW57G75Z6L55qE5YC855u05o6l6L+U5Zue44CCXG4gICAgcmV0dXJuIHY7XG4gIH1cbn1cblxuLyoqXG4gKiDlronlhajlnLDlsIbkuIDkuKrlr7nosaHluo/liJfljJbkuLrmoLzlvI/ljJbnmoQgSlNPTiDlrZfnrKbkuLLjgIJcbiAqIOWmguaenOW6j+WIl+WMluWksei0pe+8jOS4jeS8muaKm+WHuuW8guW4uO+8jOiAjOaYr+i/lOWbnuS4gOS4quWMheWQq+mUmeivr+S/oeaBr+eahOWtl+espuS4suOAglxuICogQHBhcmFtIHsqfSBvIC0g5b6F5bqP5YiX5YyW55qE5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDmiJDlip/liJnov5Tlm54gSlNPTiDlrZfnrKbkuLLvvIzlpLHotKXliJnov5Tlm57plJnor6/mj5DnpLrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEogPSAobzogYW55KTogc3RyaW5nID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobywgbnVsbCwgMik7IC8vIOS9v+eUqCAyIOS4quepuuagvOi/m+ihjOe8qei/m++8jOaPkOmrmOWPr+ivu+aAp+OAglxuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICByZXR1cm4gYDw8c3RyaW5naWZ55aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0+PmA7XG4gIH1cbn07XG5cbi8qKlxuICog5L2/55So4oCc5paw5pWw57uE6KaG55uW5pen5pWw57uE4oCd55qE562W55Wl5p2l5rex5bqm5ZCI5bm25Lik5Liq5a+56LGh44CCXG4gKiDov5nmmK8gYF8ubWVyZ2VgIOeahOS4gOS4quWPmOS9k++8jOS4k+mXqOeUqOS6juWkhOeQhuaooeadv+WQiOW5tuetieWcuuaZr++8jFxuICog5Zyo6L+Z5Lqb5Zy65pmv5Lit77yM5oiR5Lus5biM5pyb6KGl5LiB5a+56LGh5Lit55qE5pWw57uE6IO95aSf5a6M5YWo5pu/5o2i5Z+656GA5a+56LGh5Lit55qE5pWw57uE77yM6ICM5LiN5piv5ZCI5bm25a6D5Lus44CCXG4gKiBAcGFyYW0geyp9IGJhc2UgLSDln7rnoYDlr7nosaHjgIJcbiAqIEBwYXJhbSB7Kn0gcGF0Y2ggLSDooaXkuIHlr7nosaHjgIJcbiAqIEByZXR1cm5zIHsqfSDlkIjlubblkI7nmoTmlrDlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlUmVwbGFjZUFycmF5KGJhc2U6IGFueSwgcGF0Y2g6IGFueSk6IGFueSB7XG4gIC8vIOS9v+eUqCBfLmNsb25lRGVlcCDnoa7kv53kuI3kv67mlLnljp/lp4vlr7nosaHjgIJcbiAgcmV0dXJuIF8ubWVyZ2VXaXRoKF8uY2xvbmVEZWVwKGJhc2UpLCBfLmNsb25lRGVlcChwYXRjaCksIChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgIC8vIOiHquWumuS5ieWQiOW5tumAu+i+ke+8muWmguaenOS7u+S4gOWAvOS4uuaVsOe7hO+8jOWImeebtOaOpei/lOWbnuihpeS4geWAvO+8iGLvvInvvIzku47ogIzlrp7njrDopobnm5bjgIJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhKSB8fCBBcnJheS5pc0FycmF5KGIpKSByZXR1cm4gYjtcbiAgICAvLyDlr7nkuo7pnZ7mlbDnu4TnsbvlnovvvIzov5Tlm54gdW5kZWZpbmVkIOS7peS9v+eUqCBfLm1lcmdlIOeahOm7mOiupOWQiOW5tuihjOS4uuOAglxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0pO1xufVxuXG4vKipcbiAqIOWBpeWjruWcsOino+aekCBgRWRpdExvZ2Ag55qE5Y6f5aeL5pWw5o2u44CCXG4gKiBgRWRpdExvZ2Ag5Y+v6IO95Lul5aSa56eN5qC85byP5a2Y5Zyo77yI5a+56LGh44CB5pWw57uE44CBSlNPTuWtl+espuS4su+8ie+8jOatpOWHveaVsOaXqOWcqOe7n+S4gOWkhOeQhuWug+S7rOOAglxuICogQHBhcmFtIHsqfSByYXcgLSDku47lj5jph4/kuK3or7vlj5bnmoTljp/lp4sgYEVkaXRMb2dgIOaVsOaNruOAglxuICogQHJldHVybnMge2FueVtdfSDop6PmnpDlkI7nmoQgYEVkaXRMb2dgIOaVsOe7hOOAguWmguaenOino+aekOWksei0peaIlui+k+WFpeaXoOaViO+8jOWImei/lOWbnuS4gOS4quepuuaVsOe7hOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFZGl0TG9nKHJhdzogYW55KTogYW55W10ge1xuICBpZiAoQXJyYXkuaXNBcnJheShyYXcpKSByZXR1cm4gcmF3O1xuICBpZiAocmF3ICYmIHR5cGVvZiByYXcgPT09ICdvYmplY3QnKSByZXR1cm4gW3Jhd107IC8vIOWNleS4quWvueixoeS5n+inhuS4uuacieaViOaXpeW/l1xuICBpZiAodHlwZW9mIHJhdyA9PT0gJ3N0cmluZycpIHtcbiAgICBjb25zdCBzID0gcmF3LnJlcGxhY2UoL15cXHMqYGBgKD86anNvbik/XFxzKnxcXHMqYGBgXFxzKiQvZywgJycpOyAvLyDnp7vpmaTku6PnoIHlm7TmoI9cbiAgICB0cnkge1xuICAgICAgY29uc3QgYXJyID0gSlNPTi5wYXJzZShzKTtcbiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGFycikgPyBhcnIgOiBbXTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuXG4vKipcbiAqIOino+aekOS4gOS4quWMheWQq+WkmuS4quS4suiBlCBKU09OIOWvueixoeeahOWtl+espuS4su+8iOexu+S8vOS6jiBKU09OTCDmoLzlvI/vvInjgIJcbiAqIOi/meenjeagvOW8j+acieaXtuS8mueUsSBBSSDnlJ/miJDjgILmraTlh73mlbDog73lpJ/pgJDkuKrmj5Dlj5blubbop6PmnpDlroPku6zjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIC0g5b6F6Kej5p6Q55qE5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyB7YW55W119IOino+aekOWHuueahOWvueixoeaVsOe7hOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VKc29ubChzdHI6IHN0cmluZyk6IGFueVtdIHtcbiAgY29uc3Qgb2JqZWN0czogYW55W10gPSBbXTtcbiAgaWYgKCFzdHIgfHwgdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gb2JqZWN0cztcbiAgfVxuXG4gIC8vIOWcqOino+aekOWJje+8jOWFiOenu+mZpOaJgOacieexu+Wei+eahOazqOmHiu+8jOS7peaPkOmrmOino+aekOeahOmygeajkuaAp+OAglxuICBjb25zdCBzdHJXaXRob3V0Q29tbWVudHMgPSBzdHJcbiAgICAucmVwbGFjZSgvXFwvXFwvLiovZywgJycpIC8vIOenu+mZpCAvLyDpo47moLznmoTljZXooYzms6jph4pcbiAgICAucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcLy9nLCAnJykgLy8g56e76ZmkIC8qIC4uLiAqLyDpo47moLznmoTlpJrooYzms6jph4pcbiAgICAucmVwbGFjZSgvPCEtLVtcXHNcXFNdKj8tLT4vZywgJycpOyAvLyDnp7vpmaQgPCEtLSAuLi4gLS0+IOmjjuagvOeahCBIVE1ML1hNTCDms6jph4pcbiAgY29uc3QgdHJpbW1lZFN0ciA9IHN0cldpdGhvdXRDb21tZW50cy50cmltKCk7XG5cbiAgbGV0IGJyYWNlQ291bnQgPSAwOyAvLyDoirHmi6zlj7flubPooaHorqHmlbDlmahcbiAgbGV0IHN0YXJ0SW5kZXggPSAtMTsgLy8g5b2T5YmNIEpTT04g5a+56LGh55qE6LW35aeL57Si5byVXG4gIGxldCBpblN0cmluZyA9IGZhbHNlOyAvLyDmoIforrDmmK/lkKblpITkuo7lj4zlvJXlj7flrZfnrKbkuLLlhoXpg6hcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaW1tZWRTdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaGFyID0gdHJpbW1lZFN0cltpXTtcblxuICAgIC8vIOWIh+aNoiBpblN0cmluZyDnirbmgIHvvIzlv73nlaXovazkuYnnmoTlj4zlvJXlj7dcbiAgICBpZiAoY2hhciA9PT0gJ1wiJyAmJiAoaSA9PT0gMCB8fCB0cmltbWVkU3RyW2kgLSAxXSAhPT0gJ1xcXFwnKSkge1xuICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5Zyo5a2X56ym5Liy5YaF6YOo77yM5YiZ6Lez6L+H5omA5pyJ6Iqx5ous5Y+355qE6YC76L6R5Yik5patXG4gICAgaWYgKGluU3RyaW5nKSBjb250aW51ZTtcblxuICAgIGlmIChjaGFyID09PSAneycpIHtcbiAgICAgIGlmIChicmFjZUNvdW50ID09PSAwKSB7XG4gICAgICAgIC8vIOWPkeeOsOS4gOS4quaWsCBKU09OIOWvueixoeeahOW8gOWni1xuICAgICAgICBzdGFydEluZGV4ID0gaTtcbiAgICAgIH1cbiAgICAgIGJyYWNlQ291bnQrKztcbiAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICd9Jykge1xuICAgICAgaWYgKGJyYWNlQ291bnQgPiAwKSB7XG4gICAgICAgIGJyYWNlQ291bnQtLTtcbiAgICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDAgJiYgc3RhcnRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAvLyDoirHmi6zlj7flubPooaHvvIzkuIDkuKrlrozmlbTnmoQgSlNPTiDlr7nosaHooqvmib7liLBcbiAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gdHJpbW1lZFN0ci5zdWJzdHJpbmcoc3RhcnRJbmRleCwgaSArIDEpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKGpzb25TdHJpbmcpO1xuICAgICAgICAgICAgb2JqZWN0cy5wdXNoKG9iaik7XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzop6PmnpDlpLHotKXvvIzlnKjmjqfliLblj7DmiZPljbDplJnor6/lubbnu6fnu63vvIzkuI3kuK3mlq3mlbTkuKrov4fnqItcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtFUkEvdXRpbHMvcGFyc2VKc29ubF0gSlNPTkwg6Kej5p6Q5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0uIOWksei0peeahOeJh+autTogJHtqc29uU3RyaW5nfWAsIGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyDph43nva7nirbmgIHvvIzlh4blpIflr7vmib7kuIvkuIDkuKrlr7nosaFcbiAgICAgICAgICBzdGFydEluZGV4ID0gLTE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9iamVjdHM7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/era_data.ts": 
  /*!***************************************!*\
  !*** ./src/ERA变量框架/utils/era_data.ts ***!
  \***************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getEraData: () => (/* binding */ getEraData),\n/* harmony export */   removeMetaFields: () => (/* binding */ removeMetaFields),\n/* harmony export */   updateEraMetaData: () => (/* binding */ updateEraMetaData),\n/* harmony export */   updateEraStatData: () => (/* binding */ updateEraStatData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/**\n * @file ERA 变量框架 - ERA 核心变量读写模块\n */\n\n\n\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nfunction removeMetaFields(obj) {\n    // 对于非对象类型，直接返回原始值\n    if (!lodash__WEBPACK_IMPORTED_MODULE_0___default().isObject(obj)) {\n        return obj;\n    }\n    // 创建深拷贝以避免修改原始对象\n    const newObj = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(obj);\n    function recurse(current) {\n        if (Array.isArray(current)) {\n            // 如果是数组，则递归处理数组中的每个元素\n            current.forEach(item => recurse(item));\n        }\n        else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(current)) {\n            // 如果是纯粹的对象，遍历其所有键\n            for (const key in current) {\n                // 如果键以 '$' 开头，则删除该属性\n                if (key.startsWith('$')) {\n                    delete current[key];\n                }\n                else {\n                    // 否则，递归处理该属性的值\n                    recurse(current[key]);\n                }\n            }\n        }\n    }\n    recurse(newObj);\n    return newObj;\n}\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nfunction getEraData() {\n    const chatVars = getVariables(_constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE) || {};\n    const meta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n    const stat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n    return { meta, stat };\n}\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nasync function updateEraStatData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentStat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n        const newStat = await updater(currentStat);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, newStat);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nasync function updateEraMetaData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentMeta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n        const newMeta = await updater(currentMeta);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, newMeta);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Olsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2VyYV9kYXRhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIEVSQSDmoLjlv4Plj5jph4/or7vlhpnmqKHlnZdcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBDSEFUX1NDT1BFLCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbi8qKlxuICog6YCS5b2S5Zyw5LuO5a+56LGh5Lit56e76Zmk5omA5pyJ5LulIGAkYCDlvIDlpLTnmoTlrZfmrrXvvIjlpoIgYCRtZXRhYCwgYCR0ZW1wbGF0ZWDvvInjgIJcbiAqIOatpOWHveaVsOS8muWIm+W7uuS4gOS4quWvueixoeeahOa3seaLt+i0ne+8jOWboOatpOS4jeS8muS/ruaUueWOn+Wni+WvueixoeOAglxuICogQHBhcmFtIHthbnl9IG9iaiAtIOW+heWkhOeQhueahOWvueixoeaIluWAvOOAglxuICogQHJldHVybnMge2FueX0g5LiA5Liq5LiN5YyF5ZCrIGAkYCDliY3nvIDlrZfmrrXnmoTmlrDlr7nosaHmiJbljp/lp4vlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU1ldGFGaWVsZHMob2JqOiBhbnkpOiBhbnkge1xuICAvLyDlr7nkuo7pnZ7lr7nosaHnsbvlnovvvIznm7TmjqXov5Tlm57ljp/lp4vlgLxcbiAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgLy8g5Yib5bu65rex5ou36LSd5Lul6YG/5YWN5L+u5pS55Y6f5aeL5a+56LGhXG4gIGNvbnN0IG5ld09iaiA9IF8uY2xvbmVEZWVwKG9iaik7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50OiBhbnkpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YCS5b2S5aSE55CG5pWw57uE5Lit55qE5q+P5Liq5YWD57SgXG4gICAgICBjdXJyZW50LmZvckVhY2goaXRlbSA9PiByZWN1cnNlKGl0ZW0pKTtcbiAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv57qv57K555qE5a+56LGh77yM6YGN5Y6G5YW25omA5pyJ6ZSuXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBjdXJyZW50KSB7XG4gICAgICAgIC8vIOWmguaenOmUruS7pSAnJCcg5byA5aS077yM5YiZ5Yig6Zmk6K+l5bGe5oCnXG4gICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnJCcpKSB7XG4gICAgICAgICAgZGVsZXRlIGN1cnJlbnRba2V5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDlkKbliJnvvIzpgJLlvZLlpITnkIbor6XlsZ7mgKfnmoTlgLxcbiAgICAgICAgICByZWN1cnNlKGN1cnJlbnRba2V5XSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZWN1cnNlKG5ld09iaik7XG4gIHJldHVybiBuZXdPYmo7XG59XG5cbi8qKlxuICog6I635Y+W5bm256Gu5L+dIEVSQSDnmoTlhYPmlbDmja7lkoznirbmgIHmlbDmja7lr7nosaHnmoTlrZjlnKjjgIJcbiAqIEByZXR1cm5zIHt7bWV0YTogb2JqZWN0LCBzdGF0OiBvYmplY3R9fSDljIXlkKvlhYPmlbDmja7lkoznirbmgIHmlbDmja7nmoTlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVyYURhdGEoKTogeyBtZXRhOiBhbnk7IHN0YXQ6IGFueSB9IHtcbiAgY29uc3QgY2hhdFZhcnMgPSBnZXRWYXJpYWJsZXMoQ0hBVF9TQ09QRSkgfHwge307XG4gIGNvbnN0IG1ldGEgPSBfLmdldChjaGF0VmFycywgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgY29uc3Qgc3RhdCA9IF8uZ2V0KGNoYXRWYXJzLCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICByZXR1cm4geyBtZXRhLCBzdGF0IH07XG59XG5cbi8qKlxuICog5Y6f5a2Q5oCn5Zyw5pu05pawIEVSQSDnmoTnirbmgIHmlbDmja4gKHN0YXRfZGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRTdGF0RGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBzdGF0X2RhdGEg5bm26L+U5Zue5L+u5pS55ZCOIHN0YXRfZGF0YSDnmoTlh73mlbAgKOWPr+S7peaYryBhc3luYynjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUVyYVN0YXREYXRhKHVwZGF0ZXI6IChjdXJyZW50U3RhdERhdGE6IGFueSkgPT4gYW55IHwgUHJvbWlzZTxhbnk+KSB7XG4gIGF3YWl0IHVwZGF0ZVZhcmlhYmxlc1dpdGgoYXN5bmMgdiA9PiB7XG4gICAgY29uc3QgY3VycmVudFN0YXQgPSBfLmdldCh2LCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICAgIGNvbnN0IG5ld1N0YXQgPSBhd2FpdCB1cGRhdGVyKGN1cnJlbnRTdGF0KTtcbiAgICBfLnNldCh2LCBTVEFUX0RBVEFfUEFUSCwgbmV3U3RhdCk7XG4gICAgcmV0dXJuIHY7XG4gIH0sIENIQVRfU0NPUEUpO1xufVxuXG4vKipcbiAqIOWOn+WtkOaAp+WcsOabtOaWsCBFUkEg55qE5YWD5pWw5o2uIChFUkFNZXRhRGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBFUkFNZXRhRGF0YSDlubbov5Tlm57kv67mlLnlkI4gRVJBTWV0YURhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVFcmFNZXRhRGF0YSh1cGRhdGVyOiAoY3VycmVudE1ldGFEYXRhOiBhbnkpID0+IGFueSB8IFByb21pc2U8YW55Pikge1xuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZXRhID0gXy5nZXQodiwgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgICBjb25zdCBuZXdNZXRhID0gYXdhaXQgdXBkYXRlcihjdXJyZW50TWV0YSk7XG4gICAgXy5zZXQodiwgTUVUQV9EQVRBX1BBVEgsIG5ld01ldGEpO1xuICAgIHJldHVybiB2O1xuICB9LCBDSEFUX1NDT1BFKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/era_data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/log.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/utils/log.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LOG_CONFIG: () => (/* binding */ LOG_CONFIG),\n/* harmony export */   Logger: () => (/* binding */ Logger),\n/* harmony export */   logContext: () => (/* binding */ logContext)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 日志记录模块\n */\n\n/**\n * @constant {object} LOG_CONFIG\n * @description\n * 用于控制日志输出的配置对象。\n */\nconst LOG_CONFIG = {\n    // 定义所有可用的日志级别及其权重。数字越小，级别越低。\n    levels: {\n        debug: 0,\n        log: 1,\n        warn: 2,\n        error: 3,\n    },\n    // 设置当前全局日志级别。只有权重等于或高于此级别的日志才会被输出。\n    currentLevel: 0, // 默认为 'debug'\n    // 'debug' 级别的白名单。只有当 currentLevel 为 debug 时，此列表才生效。\n    // 只有在此列表中的模块才会输出 debug 日志。\n    debugWhitelist: [\n        'api-command',\n        'api-macro-parser',\n        'api-macro-patch',\n        'core-rollback',\n        'core-sync',\n        'core-crud-delete',\n        'core-crud-update',\n        'core-crud-patcher',\n        'core-crud-insert-insert',\n        'core-crud-insert-template',\n        //'core-key-mk',\n        'events-dispatcher',\n        'events-queue',\n        'events-merger',\n        'utils-message',\n    ],\n};\n// 初始化时将 currentLevel 设置为 debug 级别\nLOG_CONFIG.currentLevel = LOG_CONFIG.levels.debug;\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持日志分级的记录器。\n *\n * **核心功能**:\n * 1. **日志分级**: 提供 `debug`, `log`, `warn`, `error` 四个级别，方便过滤和定位问题。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式，清晰明了。\n * 3. **控制台输出**: 日志会根据级别使用不同颜色和样式的 `console` 方法输出，便于在浏览器中实时调试。\n * 4. **纯粹的控制台日志**: 日志系统不再向酒馆聊天变量中写入任何数据，避免了性能问题和数据污染。\n */\n/**\n * @type {{mk: string}}\n * @description 一个用于在事件处理期间临时存储日志上下文（如 Message Key）的对象。\n */\nconst logContext = {\n    mk: '',\n};\nclass Logger {\n    /**\n     * @private\n     * @property {string} moduleName - 该 Logger 实例绑定的模块名称。\n     * @description\n     * 命名规则:\n     * 为了方便在日志中快速定位来源，模块名应遵循 `目录-子目录-...-文件名` 的格式。\n     * 例如，位于 `src/ERA变量框架/core/crud/insert/insert.ts` 的文件，\n     * 其模块名应为 `core-crud-insert-insert`。\n     */\n    moduleName;\n    /**\n     * 创建一个新的 Logger 实例。\n     * @param {string} moduleName - 该 Logger 实例绑定的模块名称。\n     */\n    constructor(moduleName) {\n        this.moduleName = moduleName;\n    }\n    /**\n     * 格式化日志消息。\n     * @param {string} funcName - 调用日志的函数名。\n     * @param {any} message - 日志内容。\n     * @returns {string} 格式化后的日志字符串。\n     */\n    formatMessage(funcName, message) {\n        const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n        return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n    }\n    /**\n     * 记录一条 debug 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    debug(funcName, message, obj) {\n        // 1. 全局级别检查\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.debug)\n            return;\n        // 2. 白名单检查 (仅对 debug 生效)\n        if (LOG_CONFIG.currentLevel === LOG_CONFIG.levels.debug && !LOG_CONFIG.debugWhitelist.includes(this.moduleName)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.debug(formattedMessage, obj);\n        }\n        else {\n            console.debug(formattedMessage);\n        }\n    }\n    /**\n     * 记录一条 log 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    log(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.log)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n        }\n        else {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;');\n        }\n    }\n    /**\n     * 记录一条 warn 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    warn(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.warn)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n        }\n        else {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n        }\n    }\n    /**\n     * 记录一条 error 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [errorObj] - 可选的、附加到日志中的错误对象。\n     */\n    error(funcName, message, errorObj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.error)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (errorObj) {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n        }\n        else {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBb0MsQ0FBQyxDQUFDO1FBQy9FLENBQUM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91dGlscy9sb2cudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5pel5b+X6K6w5b2V5qih5Z2XXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBMT0dfQ09ORklHXG4gKiBAZGVzY3JpcHRpb25cbiAqIOeUqOS6juaOp+WItuaXpeW/l+i+k+WHuueahOmFjee9ruWvueixoeOAglxuICovXG5leHBvcnQgY29uc3QgTE9HX0NPTkZJRyA9IHtcbiAgLy8g5a6a5LmJ5omA5pyJ5Y+v55So55qE5pel5b+X57qn5Yir5Y+K5YW25p2D6YeN44CC5pWw5a2X6LaK5bCP77yM57qn5Yir6LaK5L2O44CCXG4gIGxldmVsczoge1xuICAgIGRlYnVnOiAwLFxuICAgIGxvZzogMSxcbiAgICB3YXJuOiAyLFxuICAgIGVycm9yOiAzLFxuICB9LFxuXG4gIC8vIOiuvue9ruW9k+WJjeWFqOWxgOaXpeW/l+e6p+WIq+OAguWPquacieadg+mHjeetieS6juaIlumrmOS6juatpOe6p+WIq+eahOaXpeW/l+aJjeS8muiiq+i+k+WHuuOAglxuICBjdXJyZW50TGV2ZWw6IDAsIC8vIOm7mOiupOS4uiAnZGVidWcnXG5cbiAgLy8gJ2RlYnVnJyDnuqfliKvnmoTnmb3lkI3ljZXjgILlj6rmnInlvZMgY3VycmVudExldmVsIOS4uiBkZWJ1ZyDml7bvvIzmraTliJfooajmiY3nlJ/mlYjjgIJcbiAgLy8g5Y+q5pyJ5Zyo5q2k5YiX6KGo5Lit55qE5qih5Z2X5omN5Lya6L6T5Ye6IGRlYnVnIOaXpeW/l+OAglxuICBkZWJ1Z1doaXRlbGlzdDogW1xuICAgICdhcGktY29tbWFuZCcsXG4gICAgJ2FwaS1tYWNyby1wYXJzZXInLFxuICAgICdhcGktbWFjcm8tcGF0Y2gnLFxuICAgICdjb3JlLXJvbGxiYWNrJyxcbiAgICAnY29yZS1zeW5jJyxcbiAgICAnY29yZS1jcnVkLWRlbGV0ZScsXG4gICAgJ2NvcmUtY3J1ZC11cGRhdGUnLFxuICAgICdjb3JlLWNydWQtcGF0Y2hlcicsXG4gICAgJ2NvcmUtY3J1ZC1pbnNlcnQtaW5zZXJ0JyxcbiAgICAnY29yZS1jcnVkLWluc2VydC10ZW1wbGF0ZScsXG4gICAgLy8nY29yZS1rZXktbWsnLFxuICAgICdldmVudHMtZGlzcGF0Y2hlcicsXG4gICAgJ2V2ZW50cy1xdWV1ZScsXG4gICAgJ2V2ZW50cy1tZXJnZXInLFxuICAgICd1dGlscy1tZXNzYWdlJyxcbiAgXSBhcyBzdHJpbmdbXSxcbn07XG4vLyDliJ3lp4vljJbml7blsIYgY3VycmVudExldmVsIOiuvue9ruS4uiBkZWJ1ZyDnuqfliKtcbkxPR19DT05GSUcuY3VycmVudExldmVsID0gTE9HX0NPTkZJRy5sZXZlbHMuZGVidWc7XG5cbi8qKlxuICogQGNsYXNzIExvZ2dlclxuICogQGRlc2NyaXB0aW9uIOS4gOS4quS4uiBFUkEg5qGG5p626K6+6K6h55qE44CB5pSv5oyB5pel5b+X5YiG57qn55qE6K6w5b2V5Zmo44CCXG4gKlxuICogKirmoLjlv4Plip/og70qKjpcbiAqIDEuICoq5pel5b+X5YiG57qnKio6IOaPkOS+myBgZGVidWdgLCBgbG9nYCwgYHdhcm5gLCBgZXJyb3JgIOWbm+S4que6p+WIq++8jOaWueS+v+i/h+a7pOWSjOWumuS9jemXrumimOOAglxuICogMi4gKirnu5/kuIDmoLzlvI8qKjog5omA5pyJ5pel5b+X6YO96YG15b6qIGDjgIpFUkHjgIvjgIzmqKHlnZflkI3jgI3jgJDlh73mlbDlkI3jgJHml6Xlv5flhoXlrrlgIOeahOagvOW8j++8jOa4heaZsOaYjuS6huOAglxuICogMy4gKirmjqfliLblj7DovpPlh7oqKjog5pel5b+X5Lya5qC55o2u57qn5Yir5L2/55So5LiN5ZCM6aKc6Imy5ZKM5qC35byP55qEIGBjb25zb2xlYCDmlrnms5XovpPlh7rvvIzkvr/kuo7lnKjmtY/op4jlmajkuK3lrp7ml7bosIPor5XjgIJcbiAqIDQuICoq57qv57K555qE5o6n5Yi25Y+w5pel5b+XKio6IOaXpeW/l+ezu+e7n+S4jeWGjeWQkemFkummhuiBiuWkqeWPmOmHj+S4reWGmeWFpeS7u+S9leaVsOaNru+8jOmBv+WFjeS6huaAp+iDvemXrumimOWSjOaVsOaNruaxoeafk+OAglxuICovXG4vKipcbiAqIEB0eXBlIHt7bWs6IHN0cmluZ319XG4gKiBAZGVzY3JpcHRpb24g5LiA5Liq55So5LqO5Zyo5LqL5Lu25aSE55CG5pyf6Ze05Li05pe25a2Y5YKo5pel5b+X5LiK5LiL5paH77yI5aaCIE1lc3NhZ2UgS2V577yJ55qE5a+56LGh44CCXG4gKi9cbmV4cG9ydCBjb25zdCBsb2dDb250ZXh0ID0ge1xuICBtazogJycsXG59O1xuXG5leHBvcnQgY2xhc3MgTG9nZ2VyIHtcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBtb2R1bGVOYW1lIC0g6K+lIExvZ2dlciDlrp7kvovnu5HlrprnmoTmqKHlnZflkI3np7DjgIJcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIOWRveWQjeinhOWImTpcbiAgICog5Li65LqG5pa55L6/5Zyo5pel5b+X5Lit5b+r6YCf5a6a5L2N5p2l5rqQ77yM5qih5Z2X5ZCN5bqU6YG15b6qIGDnm67lvZUt5a2Q55uu5b2VLS4uLi3mlofku7blkI1gIOeahOagvOW8j+OAglxuICAgKiDkvovlpoLvvIzkvY3kuo4gYHNyYy9FUkHlj5jph4/moYbmnrYvY29yZS9jcnVkL2luc2VydC9pbnNlcnQudHNgIOeahOaWh+S7tu+8jFxuICAgKiDlhbbmqKHlnZflkI3lupTkuLogYGNvcmUtY3J1ZC1pbnNlcnQtaW5zZXJ0YOOAglxuICAgKi9cbiAgcHJpdmF0ZSBtb2R1bGVOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIOWIm+W7uuS4gOS4quaWsOeahCBMb2dnZXIg5a6e5L6L44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtb2R1bGVOYW1lIC0g6K+lIExvZ2dlciDlrp7kvovnu5HlrprnmoTmqKHlnZflkI3np7DjgIJcbiAgICovXG4gIGNvbnN0cnVjdG9yKG1vZHVsZU5hbWU6IHN0cmluZykge1xuICAgIHRoaXMubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWU7XG4gIH1cblxuICAvKipcbiAgICog5qC85byP5YyW5pel5b+X5raI5oGv44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOiwg+eUqOaXpeW/l+eahOWHveaVsOWQjeOAglxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSDmoLzlvI/ljJblkI7nmoTml6Xlv5flrZfnrKbkuLLjgIJcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0TWVzc2FnZShmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IG1rU3RyaW5nID0gbG9nQ29udGV4dC5tayA/IGDvvIgke2xvZ0NvbnRleHQubWt977yJYCA6ICcnO1xuICAgIHJldHVybiBg44CKRVJB44CLJHtta1N0cmluZ33jgIwke3RoaXMubW9kdWxlTmFtZX3jgI3jgJAke2Z1bmNOYW1lfeOAkSR7U3RyaW5nKG1lc3NhZ2UpfWA7XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5p2hIGRlYnVnIOe6p+WIq+eahOaXpeW/l+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDlh73mlbDlkI3jgIJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXG4gICAqL1xuICBkZWJ1ZyhmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xuICAgIC8vIDEuIOWFqOWxgOe6p+WIq+ajgOafpVxuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA+IExPR19DT05GSUcubGV2ZWxzLmRlYnVnKSByZXR1cm47XG4gICAgLy8gMi4g55m95ZCN5Y2V5qOA5p+lICjku4Xlr7kgZGVidWcg55Sf5pWIKVxuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA9PT0gTE9HX0NPTkZJRy5sZXZlbHMuZGVidWcgJiYgIUxPR19DT05GSUcuZGVidWdXaGl0ZWxpc3QuaW5jbHVkZXModGhpcy5tb2R1bGVOYW1lKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChvYmopIHtcbiAgICAgIGNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzc2FnZSwgb2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5kZWJ1Zyhmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5p2hIGxvZyDnuqfliKvnmoTml6Xlv5fjgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g5Ye95pWw5ZCN44CCXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXG4gICAqIEBwYXJhbSB7YW55fSBbb2JqXSAtIOWPr+mAieeahOOAgemZhOWKoOWIsOaXpeW/l+S4reeahOWvueixoeOAglxuICAgKi9cbiAgbG9nKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgb2JqPzogYW55KSB7XG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMubG9nKSByZXR1cm47XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAob2JqKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjMzQ5OGRiOycsIG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICMzNDk4ZGI7Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiusOW9leS4gOadoSB3YXJuIOe6p+WIq+eahOaXpeW/l+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDlh73mlbDlkI3jgIJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXG4gICAqL1xuICB3YXJuKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgb2JqPzogYW55KSB7XG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMud2FybikgcmV0dXJuO1xuXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XG4gICAgaWYgKG9iaikge1xuICAgICAgY29uc29sZS53YXJuKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNmMzljMTI7Jywgb2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNmMzljMTI7Jyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiusOW9leS4gOadoSBlcnJvciDnuqfliKvnmoTml6Xlv5fjgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g5Ye95pWw5ZCN44CCXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXG4gICAqIEBwYXJhbSB7YW55fSBbZXJyb3JPYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE6ZSZ6K+v5a+56LGh44CCXG4gICAqL1xuICBlcnJvcihmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIGVycm9yT2JqPzogYW55KSB7XG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMuZXJyb3IpIHJldHVybjtcblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChlcnJvck9iaikge1xuICAgICAgY29uc29sZS5lcnJvcihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZTc0YzNjOyBmb250LXdlaWdodDogYm9sZDsnLCBlcnJvck9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2U3NGMzYzsgZm9udC13ZWlnaHQ6IGJvbGQ7Jyk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/log.ts\n\n}");
  },
  "./src/ERA变量框架/utils/message.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/utils/message.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastAiMessage: () => (/* binding */ findLastAiMessage),\n/* harmony export */   getMessageContent: () => (/* binding */ getMessageContent),\n/* harmony export */   isUserMessage: () => (/* binding */ isUserMessage),\n/* harmony export */   updateMessageContent: () => (/* binding */ updateMessageContent)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 消息处理模块\n * @description\n * 该文件提供了一系列用于处理、查询和更新酒馆消息对象的通用辅助函数。\n */\n\n\n\nconst log = new _log__WEBPACK_IMPORTED_MODULE_1__.Logger('utils-message');\n// ==================================================================\n// 消息读取与解析\n// ==================================================================\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nfunction getMessageContent(msg) {\n    if (!msg)\n        return null;\n    // 优先检查 .mes 属性，这是新版酒馆的规范\n    if (typeof msg.mes === 'string') {\n        return msg.mes;\n    }\n    // 如果没有 .mes，则处理 swipes\n    if (Array.isArray(msg.swipes)) {\n        const sid = Number(msg.swipe_id ?? 0);\n        return msg.swipes[sid] || null;\n    }\n    // 最后，作为兼容，检查旧版的 .message 属性\n    if (typeof msg.message === 'string') {\n        return msg.message;\n    }\n    return null;\n}\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            const eraData = {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n            log.debug('parseEraData', '成功解析 EraData', eraData);\n            return eraData;\n        }\n        log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n        return null;\n    }\n    catch (e) {\n        log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n        return null;\n    }\n}\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nfunction isUserMessage(msg) {\n    const content = getMessageContent(msg);\n    const data = parseEraData(content);\n    if (data) {\n        return data['era-message-type'] === 'user';\n    }\n    // 回退到检查 role 属性\n    return msg?.role === 'user';\n}\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nfunction findLastAiMessage() {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    if (!messages || messages.length === 0) {\n        log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n        return null;\n    }\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const msg = messages[i];\n        if (!isUserMessage(msg)) {\n            log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n            return msg;\n        }\n    }\n    log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n    return null;\n}\n// ==================================================================\n// 消息写入\n// ==================================================================\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n */\nasync function updateMessageContent(message, newContent) {\n    const updatePayload = {\n        message_id: message.message_id,\n    };\n    if (Array.isArray(message.swipes)) {\n        const sid = Number(message.swipe_id ?? 0);\n        const newSwipes = [...message.swipes];\n        newSwipes[sid] = newContent;\n        updatePayload.swipes = newSwipes;\n    }\n    else {\n        updatePayload.message = newContent;\n    }\n    await setChatMessages([updatePayload]);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL21lc3NhZ2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7R0FJRztBQUVVO0FBRWdDO0FBQ2Q7QUFFL0IsTUFBTSxHQUFHLEdBQUcsSUFBSSx3Q0FBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBVXhDLHFFQUFxRTtBQUNyRSxVQUFVO0FBQ1YscUVBQXFFO0FBRXJFOzs7OztHQUtHO0FBQ0ksU0FBUyxpQkFBaUIsQ0FBQyxHQUFRO0lBQ3hDLElBQUksQ0FBQyxHQUFHO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFFdEIseUJBQXlCO0lBQ3pCLElBQUksT0FBTyxHQUFHLENBQUMsR0FBRyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUNqQixDQUFDO0lBQ0QsdUJBQXVCO0lBQ3ZCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUM5QixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDO0lBQ2pDLENBQUM7SUFDRCw0QkFBNEI7SUFDNUIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxPQUFPLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDcEMsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDO0lBQ3JCLENBQUM7SUFDRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBUyxZQUFZLENBQUMsY0FBeUM7SUFDN0QsSUFBSSxPQUFPLGNBQWMsS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUN2QyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxNQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLHNEQUFjLENBQUMsQ0FBQztJQUNu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QixDQUFDLE9BQVksRUFBRSxVQUFrQjtJQUN6RSxNQUFNLGFBQWEsR0FBZ0U7UUFDakYsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO0tBQy9CLENBQUM7SUFFRixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDbEMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDMUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN0QyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQzVCLGFBQWEsQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO0lBQ25DLENBQUM7U0FBTSxDQUFDO1FBQ04sYUFBYSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUM7SUFDckMsQ0FBQztJQUVELE1BQU0sZUFBZSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztBQUN6QyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvbWVzc2FnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lpITnkIbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25o+Q5L6b5LqG5LiA57O75YiX55So5LqO5aSE55CG44CB5p+l6K+i5ZKM5pu05paw6YWS6aaG5raI5oGv5a+56LGh55qE6YCa55So6L6F5Yqp5Ye95pWw44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfREFUQV9SRUdFWCB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vbG9nJztcblxuY29uc3QgbG9nID0gbmV3IExvZ2dlcigndXRpbHMtbWVzc2FnZScpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5raI5oGv6K+75Y+W5LiO6Kej5p6QXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOiOt+WPlua2iOaBr+WGheWuueOAkSoqIOS7jumFkummhueahOa2iOaBr+WvueixoeS4reWuieWFqOWcsOaPkOWPluW9k+WJjea/gOa0u++8iOiiq+mAieS4re+8ieeahOa2iOaBr+WGheWuueWtl+espuS4suOAglxuICog6L+Z5Liq5Ye95pWw5pivIEVSQSDkuK3miYDmnInmtojmga/lhoXlrrnor7vlj5bnmoTllK/kuIDlhaXlj6PvvIzku6Xnoa7kv53pgLvovpHnu5/kuIDlkozlgaXlo67mgKfjgIJcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nIHwgbnVsbH0g5b2T5YmN5r+A5rS755qE5raI5oGv5YaF5a6577yb5aaC5p6c5peg5rOV6I635Y+W77yM5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1lc3NhZ2VDb250ZW50KG1zZzogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghbXNnKSByZXR1cm4gbnVsbDtcblxuICAvLyDkvJjlhYjmo4Dmn6UgLm1lcyDlsZ7mgKfvvIzov5nmmK/mlrDniYjphZLppobnmoTop4TojINcbiAgaWYgKHR5cGVvZiBtc2cubWVzID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBtc2cubWVzO1xuICB9XG4gIC8vIOWmguaenOayoeaciSAubWVz77yM5YiZ5aSE55CGIHN3aXBlc1xuICBpZiAoQXJyYXkuaXNBcnJheShtc2cuc3dpcGVzKSkge1xuICAgIGNvbnN0IHNpZCA9IE51bWJlcihtc2cuc3dpcGVfaWQgPz8gMCk7XG4gICAgcmV0dXJuIG1zZy5zd2lwZXNbc2lkXSB8fCBudWxsO1xuICB9XG4gIC8vIOacgOWQju+8jOS9nOS4uuWFvOWuue+8jOajgOafpeaXp+eJiOeahCAubWVzc2FnZSDlsZ7mgKdcbiAgaWYgKHR5cGVvZiBtc2cubWVzc2FnZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbXNnLm1lc3NhZ2U7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICog5LuO5raI5oGv5YaF5a655a2X56ym5Liy5Lit6Kej5p6Q5Ye6IGBFcmFEYXRhYCDlr7nosaHjgILov5nmmK/kuIDkuKrlj6ror7vmk43kvZzjgIJcbiAqIEBwYXJhbSB7c3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZH0gbWVzc2FnZUNvbnRlbnQgLSDmtojmga/nmoTlhoXlrrnlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtFcmFEYXRhIHwgbnVsbH0g6Kej5p6Q5oiQ5Yqf5YiZ6L+U5ZueIGBFcmFEYXRhYCDlr7nosaHvvIzlkKbliJnov5Tlm54gbnVsbOOAglxuICovXG5mdW5jdGlvbiBwYXJzZUVyYURhdGEobWVzc2FnZUNvbnRlbnQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBFcmFEYXRhIHwgbnVsbCB7XG4gIGlmICh0eXBlb2YgbWVzc2FnZUNvbnRlbnQgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlQ29udGVudC5tYXRjaChFUkFfREFUQV9SRUdFWCk7XG4gIGlmICghbWF0Y2ggfHwgIW1hdGNoWzFdKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdHJ5IHtcbiAgICAvLyDnlLHkuo4gTUsg5Z2X5YaF6YOo5piv6Ieq5a6a5LmJ55qEIGB7XCJrZXlcIj1cInZhbHVlXCJ9YCDmoLzlvI/vvIzkuI3og73kvb/nlKggSlNPTi5wYXJzZeOAglxuICAgIC8vIOW/hemhu+S9v+eUqOato+WImeihqOi+vuW8j+i/m+ihjOWuveadvuWMuemFjeadpeaPkOWPlumUruWAvOOAglxuICAgIGNvbnN0IGN1c3RvbUZvcm1hdEJsb2NrID0gbWF0Y2hbMV07XG4gICAgY29uc3Qga2V5TWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS1rZXlcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuICAgIGNvbnN0IHR5cGVNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLXR5cGVcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuXG4gICAgaWYgKGtleU1hdGNoPy5bMV0gJiYgdHlwZU1hdGNoPy5bMV0pIHtcbiAgICAgIGNvbnN0IGVyYURhdGEgPSB7XG4gICAgICAgICdlcmEtbWVzc2FnZS1rZXknOiBrZXlNYXRjaFsxXSxcbiAgICAgICAgJ2VyYS1tZXNzYWdlLXR5cGUnOiB0eXBlTWF0Y2hbMV0gYXMgJ3VzZXInIHwgJ2Fzc2lzdGFudCcsXG4gICAgICB9O1xuICAgICAgbG9nLmRlYnVnKCdwYXJzZUVyYURhdGEnLCAn5oiQ5Yqf6Kej5p6QIEVyYURhdGEnLCBlcmFEYXRhKTtcbiAgICAgIHJldHVybiBlcmFEYXRhO1xuICAgIH1cbiAgICBsb2cuZGVidWcoJ3BhcnNlRXJhRGF0YScsICfmnKrog73lnKggRXJhRGF0YSDlnZfkuK3mib7liLDlrozmlbTnmoTplK7lgLzlr7knLCB7IGN1c3RvbUZvcm1hdEJsb2NrIH0pO1xuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLndhcm4oJ3BhcnNlRXJhRGF0YScsICfop6PmnpAgRXJhRGF0YSDlnZfml7blj5HnlJ/lvILluLgnLCBlKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqICoq44CQ5Yik5pat5raI5oGv57G75Z6L44CRKiog5qC55o2u5raI5oGv5YaF5a655Lit55qEIGBlcmEtbWVzc2FnZS10eXBlYCDlhYPmlbDmja7miJYgYHJvbGVgIOWxnuaAp+WIpOaWreaYr+WQpuS4uueUqOaIt+a2iOaBr+OAglxuICog5LyY5YWI5L+h5Lu75rOo5YWl55qE5YWD5pWw5o2u44CCXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge2Jvb2xlYW59IOWmguaenOaYr+eUqOaIt+a2iOaBr++8jOWImei/lOWbniB0cnVl44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1VzZXJNZXNzYWdlKG1zZzogYW55KTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpO1xuICBjb25zdCBkYXRhID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpO1xuICBpZiAoZGF0YSkge1xuICAgIHJldHVybiBkYXRhWydlcmEtbWVzc2FnZS10eXBlJ10gPT09ICd1c2VyJztcbiAgfVxuICAvLyDlm57pgIDliLDmo4Dmn6Ugcm9sZSDlsZ7mgKdcbiAgcmV0dXJuIG1zZz8ucm9sZSA9PT0gJ3VzZXInO1xufVxuXG4vKipcbiAqIOS7juWQjuWQkeWJjeafpeaJvuW5tui/lOWbnuacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIEByZXR1cm5zIHtUYXZlcm5NZXNzYWdlIHwgbnVsbH0g5om+5Yiw55qEIEFJIOa2iOaBr+Wvueixoe+8jOWmguaenOaJvuS4jeWIsOWImei/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kTGFzdEFpTWVzc2FnZSgpOiBhbnkgfCBudWxsIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nLCB7IGluY2x1ZGVfc3dpcGVzOiB0cnVlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZy5kZWJ1ZygnZmluZExhc3RBaU1lc3NhZ2UnLCAn6IGK5aSp6K6w5b2V5Li656m6LCDmnKrmib7liLDku7vkvZXmtojmga/jgIInKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSBtZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IG1zZyA9IG1lc3NhZ2VzW2ldO1xuICAgIGlmICghaXNVc2VyTWVzc2FnZShtc2cpKSB7XG4gICAgICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgYOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga8sIElEOiAke21zZy5tZXNzYWdlX2lkfWApO1xuICAgICAgcmV0dXJuIG1zZztcbiAgICB9XG4gIH1cblxuICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgJ+acquWcqOiBiuWkqeiusOW9leS4reaJvuWIsOS7u+S9lSBBSSDmtojmga/jgIInKTtcbiAgcmV0dXJuIG51bGw7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5raI5oGv5YaZ5YWlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOmAmueUqOOAkSoqIOabtOaWsOaMh+Wumua2iOaBr+eahOWGheWuueOAglxuICog6L+Z5Liq6L6F5Yqp5Ye95pWw5bCB6KOF5LqG5aSE55CGIGBzd2lwZXNgIOWSjOaZrumAmiBgbWVzc2FnZWAg55qE6YC76L6R77yM5o+Q5L6b5LiA5Liq57uf5LiA55qE5YaZ5YWl5o6l5Y+j44CCXG4gKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOimgeabtOaWsOeahOa2iOaBr+WvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IG5ld0NvbnRlbnQgLSDlhajmlrDnmoTmtojmga/lhoXlrrnjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1lc3NhZ2U6IGFueSwgbmV3Q29udGVudDogc3RyaW5nKSB7XG4gIGNvbnN0IHVwZGF0ZVBheWxvYWQ6IHsgbWVzc2FnZV9pZDogbnVtYmVyOyBtZXNzYWdlPzogc3RyaW5nOyBzd2lwZXM/OiBzdHJpbmdbXSB9ID0ge1xuICAgIG1lc3NhZ2VfaWQ6IG1lc3NhZ2UubWVzc2FnZV9pZCxcbiAgfTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlLnN3aXBlcykpIHtcbiAgICBjb25zdCBzaWQgPSBOdW1iZXIobWVzc2FnZS5zd2lwZV9pZCA/PyAwKTtcbiAgICBjb25zdCBuZXdTd2lwZXMgPSBbLi4ubWVzc2FnZS5zd2lwZXNdO1xuICAgIG5ld1N3aXBlc1tzaWRdID0gbmV3Q29udGVudDtcbiAgICB1cGRhdGVQYXlsb2FkLnN3aXBlcyA9IG5ld1N3aXBlcztcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGVQYXlsb2FkLm1lc3NhZ2UgPSBuZXdDb250ZW50O1xuICB9XG5cbiAgYXdhaXQgc2V0Q2hhdE1lc3NhZ2VzKFt1cGRhdGVQYXlsb2FkXSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/message.ts\n\n}");
  },
  "./src/ERA变量框架/utils/string.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/utils/string.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractBlocks: () => (/* binding */ extractBlocks),\n/* harmony export */   rnd: () => (/* binding */ rnd),\n/* harmony export */   stripCodeFence: () => (/* binding */ stripCodeFence)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 字符串处理模块\n */\n\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * 基于 `Math.random()`，在同一毫秒内也能保证极高的唯一性。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nfunction rnd() {\n    return Math.random().toString(36).slice(2, 8);\n}\n/**\n * 从文本中提取所有被特定 XML 风格标签包裹的内容块。\n * 使用非贪婪模式的正则表达式，但不处理嵌套标签。\n * @param {string} text - 包含标签的原始文本。\n * @param {string} tag - 要提取的标签名称（例如 'VariableEdit'）。\n * @returns {string[]} 包含所有提取并清理后（去除代码围栏和首尾空格）的内容块的数组。\n */\nfunction extractBlocks(text, tag) {\n    const blocks = [];\n    // 正则表达式: /<tag>([\\s\\S]*?)<\\/tag>/g\n    // - <${tag}>: 匹配开标签。\n    // - ([\\s\\S]*?): 非贪婪地捕获开闭标签之间的所有字符（包括换行符）。\n    // - <\\/${tag}>: 匹配闭标签。\n    // - g: 全局匹配，以找到所有匹配项。\n    const re = new RegExp(`<${tag}>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'g');\n    let m;\n    while ((m = re.exec(text))) {\n        const rawBody = (m[1] || '').trim();\n        // 在存入前，先剥离AI可能生成的多余代码围栏。\n        const body = stripCodeFence(rawBody);\n        if (body)\n            blocks.push(body);\n    }\n    return blocks;\n}\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nfunction stripCodeFence(s) {\n    if (!s)\n        return s;\n    let t = String(s).trim();\n    // 移除起始围栏，例如 ```json, ```, ~~~\n    t = t.replace(/^\\s*(?:```|~~~)\\[a-zA-Z0-9_-\\]*\\s*\\r?\\n/, '');\n    // 移除结束围栏\n    t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n    return t.trim();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3N0cmluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7R0FFRztBQUVVO0FBRWI7Ozs7R0FJRztBQUNJLFNBQVMsR0FBRztJQUNqQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0ksU0FBUyxhQUFhLENBQUMsSUFBWSxFQUFFLEdBQVc7SUFDckQsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBQzVCLG1DQUFtQztJQUNuQyxxQkFBcUI7SUFDckIsMENBQTBDO0lBQzFDLHVCQUF1QjtJQUN2QixzQkFBc0I7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxHQUFHLG9CQUFvQixHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5RCxJQUFJLENBQUMsQ0FBQztJQUNOLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDM0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDcEMseUJBQXlCO1FBQ3pCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLElBQUk7WUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNJLFNBQVMsY0FBYyxDQUFDLENBQVM7SUFDdEMsSUFBSSxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsOEJBQThCO0lBQzlCLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLHlDQUF5QyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELFNBQVM7SUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvc3RyaW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWtl+espuS4suWkhOeQhuaooeWdl1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiDnlJ/miJDkuIDkuKrmjIflrprplb/luqbnmoTpmo/mnLrlrZfnrKbkuLLvvIznlKjkvZzllK/kuIDmoIfor4bnrKbjgIJcbiAqIOWfuuS6jiBgTWF0aC5yYW5kb20oKWDvvIzlnKjlkIzkuIDmr6vnp5LlhoXkuZ/og73kv53or4HmnoHpq5jnmoTllK/kuIDmgKfjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS4gOS4qumaj+acuueahOOAgeeUseaVsOWtl+WSjOWwj+WGmeWtl+avjee7hOaIkOeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcm5kKCk6IHN0cmluZyB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KTtcbn1cblxuLyoqXG4gKiDku47mlofmnKzkuK3mj5Dlj5bmiYDmnInooqvnibnlrpogWE1MIOmjjuagvOagh+etvuWMheijueeahOWGheWuueWdl+OAglxuICog5L2/55So6Z2e6LSq5amq5qih5byP55qE5q2j5YiZ6KGo6L6+5byP77yM5L2G5LiN5aSE55CG5bWM5aWX5qCH562+44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIOWMheWQq+agh+etvueahOWOn+Wni+aWh+acrOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHRhZyAtIOimgeaPkOWPlueahOagh+etvuWQjeensO+8iOS+i+WmgiAnVmFyaWFibGVFZGl0J++8ieOAglxuICogQHJldHVybnMge3N0cmluZ1tdfSDljIXlkKvmiYDmnInmj5Dlj5blubbmuIXnkIblkI7vvIjljrvpmaTku6PnoIHlm7TmoI/lkozpppblsL7nqbrmoLzvvInnmoTlhoXlrrnlnZfnmoTmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RCbG9ja3ModGV4dDogc3RyaW5nLCB0YWc6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmxvY2tzOiBzdHJpbmdbXSA9IFtdO1xuICAvLyDmraPliJnooajovr7lvI86IC88dGFnPihbXFxzXFxTXSo/KTxcXC90YWc+L2dcbiAgLy8gLSA8JHt0YWd9Pjog5Yy56YWN5byA5qCH562+44CCXG4gIC8vIC0gKFtcXHNcXFNdKj8pOiDpnZ7otKrlqarlnLDmjZXojrflvIDpl63moIfnrb7kuYvpl7TnmoTmiYDmnInlrZfnrKbvvIjljIXmi6zmjaLooYznrKbvvInjgIJcbiAgLy8gLSA8XFwvJHt0YWd9Pjog5Yy56YWN6Zet5qCH562+44CCXG4gIC8vIC0gZzog5YWo5bGA5Yy56YWN77yM5Lul5om+5Yiw5omA5pyJ5Yy56YWN6aG544CCXG4gIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChgPCR7dGFnfT4oW1xcXFxzXFxcXFNdKj8pPFxcXFwvJHt0YWd9PmAsICdnJyk7XG4gIGxldCBtO1xuICB3aGlsZSAoKG0gPSByZS5leGVjKHRleHQpKSkge1xuICAgIGNvbnN0IHJhd0JvZHkgPSAobVsxXSB8fCAnJykudHJpbSgpO1xuICAgIC8vIOWcqOWtmOWFpeWJje+8jOWFiOWJpeemu0FJ5Y+v6IO955Sf5oiQ55qE5aSa5L2Z5Luj56CB5Zu05qCP44CCXG4gICAgY29uc3QgYm9keSA9IHN0cmlwQ29kZUZlbmNlKHJhd0JvZHkpO1xuICAgIGlmIChib2R5KSBibG9ja3MucHVzaChib2R5KTtcbiAgfVxuICByZXR1cm4gYmxvY2tzO1xufVxuXG4vKipcbiAqIOS7juWtl+espuS4suS4reenu+mZpCBBSSDnlJ/miJDnmoQgTWFya2Rvd24g5Luj56CB5Z2X5Zu05qCP77yI5aaCIGBgYGpzb24gLi4uIGBgYO+8ieOAglxuICogQHBhcmFtIHtzdHJpbmd9IHMgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOenu+mZpOWbtOagj+W5tuS/ruWJqummluWwvuepuuagvOWQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBDb2RlRmVuY2Uoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzKSByZXR1cm4gcztcbiAgbGV0IHQgPSBTdHJpbmcocykudHJpbSgpO1xuICAvLyDnp7vpmaTotbflp4vlm7TmoI/vvIzkvovlpoIgYGBganNvbiwgYGBgLCB+fn5cbiAgdCA9IHQucmVwbGFjZSgvXlxccyooPzpgYGB8fn5+KVxcW2EtekEtWjAtOV8tXFxdKlxccypcXHI/XFxuLywgJycpO1xuICAvLyDnp7vpmaTnu5PmnZ/lm7TmoI9cbiAgdCA9IHQucmVwbGFjZSgvXFxyP1xcbig/OmBgYHx+fn4pXFxzKiQvLCAnJyk7XG4gIHJldHVybiB0LnRyaW0oKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/string.ts\n\n}");
  },
  lodash: 
  /*!********************!*\
  !*** external "_" ***!
  \********************/ module => {
    module.exports = _;
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/ERA变量框架/index.ts");