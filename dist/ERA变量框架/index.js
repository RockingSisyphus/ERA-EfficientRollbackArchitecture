var __webpack_modules__ = {
  "./src/ERA变量框架/api/command.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/api/command.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteByObject: () => (/* binding */ deleteByObject),\n/* harmony export */   deleteByPath: () => (/* binding */ deleteByPath),\n/* harmony export */   emitWriteDoneEvent: () => (/* binding */ emitWriteDoneEvent),\n/* harmony export */   insertByObject: () => (/* binding */ insertByObject),\n/* harmony export */   insertByPath: () => (/* binding */ insertByPath),\n/* harmony export */   updateByObject: () => (/* binding */ updateByObject),\n/* harmony export */   updateByPath: () => (/* binding */ updateByPath)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('api-command');\n// 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件\nconst debouncedEmitApiWrite = lodash__WEBPACK_IMPORTED_MODULE_0___default().debounce(() => {\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n}, 50, //API调用的防抖改成50毫秒，提高即时性\n{ leading: false, trailing: true });\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job) {\n    // 1. 生成指令块\n    const contentString = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.J)(job.blockContent);\n    const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n    // 2. 查找目标消息并追加内容\n    const lastAiMessage = await (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.findLastAiMessage)();\n    if (!lastAiMessage) {\n        logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n        return;\n    }\n    const originalContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(lastAiMessage) ?? '';\n    const newContent = originalContent + block;\n    logger.log('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n    // 3. 实时更新消息内容\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_4__.updateMessageContent)(lastAiMessage, newContent);\n    // 4. 调用防抖函数来调度写入事件的发送\n    debouncedEmitApiWrite();\n}\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction insertByObject(data) {\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction updateByObject(data) {\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction insertByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction updateByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nfunction deleteByObject(data) {\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nfunction deleteByPath(path) {\n    // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, {});\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n// ==================================================================\n// 事件广播器实现 (由 variable_change_processor.ts 等内部模块调用)\n// ==================================================================\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）在 `variable_change_processor.ts` 中成功完成后，\n * 应调用此函数。它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {WriteDonePayload} payload - 包含写入操作关键信息的事件负载。\n * @example\n * // 这是一个在外部脚本中监听此事件的示例：\n * eventOn('era:writeDone', (detail) => {\n *   const { mk, message_id, actions, selectedMks, editLogs, stat, statWithoutMeta } = detail;\n *   console.log(`ERA 变量已更新！消息 ID: ${message_id}, MK: ${mk}`);\n *   console.log('执行的操作:', actions);\n *\n *   // 你可以根据需要使用 stat (带 meta) 或 statWithoutMeta (不带 meta)\n *   console.log('最新的纯净状态数据:', statWithoutMeta);\n *\n *   // 此时可以根据最新的状态数据更新你自己的 UI 或执行其他逻辑\n * });\n */\nfunction emitWriteDoneEvent(payload) {\n    // 在广播前，对需要暴露给外部的数据进行反转义\n    const unescapedPayload = {\n        ...payload,\n        stat: (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.unescapeEraData)(payload.stat),\n        statWithoutMeta: (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.unescapeEraData)(payload.statWithoutMeta),\n    };\n    logger.debug('emitWriteDoneEvent', 'writeDone事件广播数据反转义', {\n        before: { stat: payload.stat, statWithoutMeta: payload.statWithoutMeta },\n        after: { stat: unescapedPayload.stat, statWithoutMeta: unescapedPayload.statWithoutMeta },\n    });\n    eventEmit(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE, unescapedPayload);\n    logger.log('emitWriteDoneEvent', `已触发 ${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE} 事件。操作: ${JSON.stringify(payload.actions)}, MK: ${payload.mk}, MsgID: ${payload.message_id}, 连续处理次数: ${payload.consecutiveProcessingCount}`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9jb21tYW5kLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRztBQUVvQjtBQUNrRDtBQUN0QjtBQUNiO0FBQ3dEO0FBRTlGLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQVF6QywwQ0FBMEM7QUFDMUMsTUFBTSxxQkFBcUIsR0FBRyxzREFBVSxDQUN0QyxHQUFHLEVBQUU7SUFDSCxTQUFTLENBQUMsK0RBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxXQUFXLCtEQUFpQixDQUFDLFNBQVMsTUFBTSxDQUFDLENBQUM7QUFDcEYsQ0FBQyxFQUNELEVBQUUsRUFBRSxzQkFBc0I7QUFDMUIsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FDbkMsQ0FBQztBQUVGLHFFQUFxRTtBQUNyRSxXQUFXO0FBQ1gsc0RBQXNEO0FBQ3RELHFFQUFxRTtBQUVyRTs7Ozs7Ozs7R0FRRztBQUVIOzs7Ozs7OztHQVFHO0FBRUg7Ozs7Ozs7Ozs7O0dBV0c7QUFFSDs7Ozs7Ozs7Ozs7R0FXRztBQUVIOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVIOzs7Ozs7O0dBT0c7QUFFSCxxRUFBcUU7QUFDckUsU0FBUztBQUNULHFFQUFxRTtBQUVyRTs7OztHQUlHO0FBRUg7Ozs7R0FJRztBQUNILEtBQUssVUFBVSxlQUFlLENBQUMsR0FBZ0I7SUFDN0MsV0FBVztJQUNYLE1BQU0sYUFBYSxHQUFHLDhDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzFDLE1BQU0sS0FBSyxHQUFHLE1BQU0sR0FBRyxDQUFDLFFBQVEsTUFBTSxhQUFhLE9BQU8sR0FBRyxDQUFDLFFBQVEsR0FBRyxDQUFDO0lBRTFFLGlCQUFpQjtJQUNqQixNQUFNLGFBQWEsR0FB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ZSxFQUFFO1FBQ3hFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixDQUFDLGVBQWUsRUFBRTtLQUMxRixDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsK0RBQWlCLENBQUMsVUFBVSxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDMUQsTUFBTSxDQUFDLEdBQUcsQ0FDUixvQkFBb0IsRUFDcEIsT0FBTywrREFBaUIsQ0FBQyxVQUFVLFdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FDMUQsT0FBTyxDQUFDLE9BQU8sQ0FDaEIsU0FBUyxPQUFPLENBQUMsRUFBRSxZQUFZLE9BQU8sQ0FBQyxVQUFVLGFBQWEsT0FBTyxDQUFDLDBCQUEwQixFQUFFLENBQ3BHLENBQUM7QUFDSixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvYXBpL2NvbW1hbmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5aSW6YOo5LqL5Lu2IEFQSSDlrp7njrDmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbkuI7lpJbpg6johJrmnKzkuqTkupLnmoTmjqXlj6PlsYLjgILlroPlrp7njrDkuobkuIDns7vliJfoh6rlrprkuYnkuovku7bnmoTlpITnkIblmajjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogRVJBIOahhuaetuS4jeebtOaOpeWQkeWkluaatOmcsuWHveaVsOiwg+eUqOaOpeWPo+OAguWklumDqOiEmuacrOS4jiBFUkEg5Lqk5LqS55qEKirllK/kuIAqKuaWueW8j+aYr+mAmui/h+mFkummhueahFxuICogYGV2ZW50RW1pdChldmVudE5hbWUsIGV2ZW50RGF0YSlgIOWHveaVsO+8jOWPkemAgeeJueWumuagvOW8j+eahOS6i+S7tuOAglxuICpcbiAqIGBpbmRleC50c2Ag5qih5Z2X5Lya55uR5ZCs6L+Z5LqbIGBlcmE6KmAg5YmN57yA55qE5LqL5Lu277yM5bm25bCG5YW25o6o5YWlIGBldmVudF9xdWV1ZS50c2Ag5Lit6L+b6KGM5aSE55CG44CCXG4gKiDkuovku7bpmJ/liJfmnIDnu4jkvJrosIPnlKjmnKzmlofku7bkuK3lr7nlupTnmoTlpITnkIblmajlh73mlbDvvIjlpoIgYGluc2VydEJ5T2JqZWN0YO+8ieOAglxuICpcbiAqIOacrOaooeWdl+S4reeahOWHveaVsOmAmui/h+S4gOenjeW3p+WmmeOAgeino+iApueahOaWueW8j+W3peS9nO+8muWug+S7rOWcqOacgOaWsOeahCBBSSDmtojmga/mnKvlsL7liqjmgIHms6jlhaVcbiAqIGA8VmFyaWFibGVJbnNlcnQ+YCDmiJYgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfvvIznhLblkI7osIPnlKjphZLppobnmoQgYHNldENoYXRNZXNzYWdlc2Ag5pu05paw5raI5oGv44CCXG4gKiDov5nmrKHkv67mlLnkvJrop6blj5EgYGNoYXJhY3Rlcl9tZXNzYWdlX3JlbmRlcmVkYCDnrYnkuovku7bvvIzooqsgRVJBIOeahOS4u+ebkeWQrOWZqOaNleiOt++8jFxuICog5LuO6ICM5bCGIEFQSSDosIPnlKjml6DnvJ3lnLDmlbTlkIjliLAgRVJBIOeahOWOn+eUn+ino+aekOWSjOWQjOatpea1geeoi+S4reOAglxuICovXG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBFUkFfRVZFTlRfRU1JVFRFUiwgV3JpdGVEb25lUGF5bG9hZCB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBKLCB1bmVzY2FwZUVyYURhdGEgfSBmcm9tICcuLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBmaW5kTGFzdEFpTWVzc2FnZSwgZ2V0TWVzc2FnZUNvbnRlbnQsIHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vdXRpbHMvbWVzc2FnZSc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2FwaS1jb21tYW5kJyk7XG5cbi8vIEFQSSDlhpnlhaXku7vliqHnmoTmjqXlj6PlrprkuYlcbmludGVyZmFjZSBBcGlXcml0ZUpvYiB7XG4gIGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnIHwgJ1ZhcmlhYmxlRWRpdCcgfCAnVmFyaWFibGVEZWxldGUnO1xuICBibG9ja0NvbnRlbnQ6IG9iamVjdDtcbn1cblxuLy8g5L2/55SoIGxvZGFzaC5kZWJvdW5jZSDliJvlu7rkuIDkuKrpmLLmipblh73mlbDmnaXlj5HpgIEgQVBJIOWGmeWFpeS6i+S7tlxuY29uc3QgZGVib3VuY2VkRW1pdEFwaVdyaXRlID0gXy5kZWJvdW5jZShcbiAgKCkgPT4ge1xuICAgIGV2ZW50RW1pdChFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEUpO1xuICAgIGxvZ2dlci5sb2coJ2RlYm91bmNlZEVtaXRBcGlXcml0ZScsIGDlt7Lop6blj5HlkIjlubblkI7nmoQgJHtFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEV9IOS6i+S7tuOAgmApO1xuICB9LFxuICA1MCwgLy9BUEnosIPnlKjnmoTpmLLmipbmlLnmiJA1MOavq+enku+8jOaPkOmrmOWNs+aXtuaAp1xuICB7IGxlYWRpbmc6IGZhbHNlLCB0cmFpbGluZzogdHJ1ZSB9LFxuKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBUEkg5LqL5Lu25Y+C6ICDXG4vLyAo5LqL5Lu25ZCN56ew55qE5bi46YeP5a6a5LmJ6KeB5LqOIGBjb25zdGFudHMudHNgIOS4reeahCBgRVJBX0FQSV9FVkVOVFNgIOWvueixoSlcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTppbnNlcnRCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzpnZ7noLTlnY/mgKflnLDmj5LlhaXmlrDlj5jph4/jgILlj6rkvJrlhpnlhaXkuI3lrZjlnKjnmoTot6/lvoTjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDopoHmj5LlhaXnmoTlj5jph4/lr7nosaHjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTppbnNlcnRCeU9iamVjdCcsIHtcbiAqICAgcGxheWVyOiB7IG5hbWU6IFwi5YuH6ICFXCIsIGhwOiAxMDAsIGludmVudG9yeTogW10gfVxuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6dXBkYXRlQnlPYmplY3QnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5LiA5Liq5a+56LGh77yM5L+u5pS55bey5a2Y5Zyo55qE5Y+Y6YeP44CC5aaC5p6c6Lev5b6E5LiN5a2Y5Zyo77yM5YiZ5b+955Wl44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g6KaB5pu05paw55qE5Y+Y6YeP5a+56LGh44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6dXBkYXRlQnlPYmplY3QnLCB7XG4gKiAgIHBsYXllcjogeyBocDogMTIwLCBzdGF0dXM6ICdibGVzc2VkJyB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTppbnNlcnRCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E5ZKM5YC877yM6Z2e56C05Z2P5oCn5Zyw5o+S5YWl5LiA5Liq5paw5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E5ZKM5YC855qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDlj5jph4/nmoTot6/lvoTvvIzkvb/nlKjngrnmiJbmlrnmi6zlj7fooajnpLrms5XjgIJcbiAqIEBwYXJhbSB7Kn0gZGV0YWlsLnZhbHVlIC0g6KaB5o+S5YWl55qE5YC844CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6aW5zZXJ0QnlQYXRoJywge1xuICogICBwYXRoOiAncGxheWVyLmludmVudG9yeVswXScsXG4gKiAgIHZhbHVlOiB7IG5hbWU6ICfnlJ/lkb3oja/msLQnLCBjb3VudDogMyB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTp1cGRhdGVCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E5ZKM5YC877yM5L+u5pS55LiA5Liq5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E5ZKM5YC855qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDlj5jph4/nmoTot6/lvoTjgIJcbiAqIEBwYXJhbSB7Kn0gZGV0YWlsLnZhbHVlIC0g6KaB6K6+572u55qE5paw5YC844CC5Y+v5Lul5piv55u05o6l55qE5YC877yM5Lmf5Y+v5Lul5piv6L+Q566X6KGo6L6+5byP44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6dXBkYXRlQnlQYXRoJywge1xuICogICBwYXRoOiAncGxheWVyLmhwJyxcbiAqICAgdmFsdWU6ICcrPTEwJ1xuICogfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6ZGVsZXRlQnlPYmplY3QnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5LiA5Liq5a+56LGh77yM5Yig6Zmk5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5o+P6L+w6KaB5Yig6Zmk6Lev5b6E55qE57uT5p6E44CC5YC855qE57uT5p6E5Yaz5a6a5LqG5Yig6Zmk6KGM5Li644CCXG4gKiBAZXhhbXBsZVxuICogLy8g5YeG5aSH5Yig6ZmkIHBsYXllci5nb2xk44CC5oyH5Luk5LitIGdvbGQg55qE5YC85b+F6aG75piv56m65a+56LGhIHt9XG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeU9iamVjdCcsIHsgcGxheWVyOiB7IGdvbGQ6IHt9IH0gfSk7XG4gKlxuICogLy8g5YeG5aSH5Yig6Zmk5pW05LiqIHBsYXllciDlr7nosaHjgIJcbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHt9IH0pO1xuICpcbiAqIC8vICoq6YeN6KaBKio6IOWmguaenCBwbGF5ZXIg5a+56LGh5YyF5ZCrIGdvbGQg5ZKMIG1hbmEg5Lik5Liq5bGe5oCn77yMXG4gKiAvLyDku6XkuIvmjIfku6Tlj6rkvJrliKDpmaQgZ29sZCDlkowgbWFuYe+8jOiAjCBwbGF5ZXIg5a+56LGh5pys6Lqr5Lya6KKr5L+d55WZ77yI5Y+Y5Li656m65a+56LGh77yJ44CCXG4gKiAvLyDov5nkuI4gYGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHt9IH0pYCDnmoTmlYjmnpzmmK/kuI3lkIznmoTjgIJcbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHsgZ29sZDoge30sIG1hbmE6IHt9IH0gfSk7XG4gKi9cblxuLyoqXG4gKiBAc2VjdGlvbiBBUEkgRXZlbnQ6ICdlcmE6ZGVsZXRlQnlQYXRoJ1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+aMh+Wumui3r+W+hO+8jOWIoOmZpOS4gOS4quW3suWtmOWcqOeahOWPmOmHj+OAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOWMheWQq+i3r+W+hOeahOWvueixoeOAglxuICogQHBhcmFtIHtzdHJpbmd9IGRldGFpbC5wYXRoIC0g6KaB5Yig6Zmk55qE5Y+Y6YeP55qE6Lev5b6E44CCXG4gKiBAZXhhbXBsZVxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlQYXRoJywgeyBwYXRoOiAncGxheWVyLmludmVudG9yeVswXScgfSk7XG4gKi9cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDlhoXpg6jmoLjlv4Plh73mlbBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIOWcqOiBiuWkqeiusOW9leS4reafpeaJvuW5tui/lOWbnuacgOWQjuS4gOadoeeUsSBBSSDlj5HpgIHnmoTmtojmga/jgIJcbiAqIOi/meaYr+azqOWFpeWPmOmHj+S/ruaUueaMh+S7pOeahOebruagh+a2iOaBr+OAglxuICogQHJldHVybnMge1Byb21pc2U8YW55IHwgbnVsbD59IOi/lOWbnuaJvuWIsOeahOa2iOaBr+Wvueixoe+8jOWmguaenOS4jeWtmOWcqCBBSSDmtojmga/liJnov5Tlm54gbnVsbOOAglxuICovXG5cbi8qKlxuICog5omn6KGM5LiA5qyhIEFQSSDlhpnlhaXmk43kvZzjgIJcbiAqIOWug+WwhuaMh+WumueahOWPmOmHj+S/ruaUueWdl+i/veWKoOWIsOacgOWQjuS4gOadoSBBSSDmtojmga/nmoTmnKvlsL7vvIznhLblkI7osIPluqbkuIDkuKogJ2VyYTphcGlXcml0ZScg5LqL5Lu244CCXG4gKiBAcGFyYW0ge0FwaVdyaXRlSm9ifSBqb2IgLSDopoHmiafooYznmoTlhpnlhaXku7vliqHjgIJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFwaVdyaXRlKGpvYjogQXBpV3JpdGVKb2IpIHtcbiAgLy8gMS4g55Sf5oiQ5oyH5Luk5Z2XXG4gIGNvbnN0IGNvbnRlbnRTdHJpbmcgPSBKKGpvYi5ibG9ja0NvbnRlbnQpO1xuICBjb25zdCBibG9jayA9IGBcXG48JHtqb2IuYmxvY2tUYWd9PlxcbiR7Y29udGVudFN0cmluZ31cXG48LyR7am9iLmJsb2NrVGFnfT5gO1xuXG4gIC8vIDIuIOafpeaJvuebruagh+a2iOaBr+W5tui/veWKoOWGheWuuVxuICBjb25zdCBsYXN0QWlNZXNzYWdlID0gYXdhaXQgZmluZExhc3RBaU1lc3NhZ2UoKTtcbiAgaWYgKCFsYXN0QWlNZXNzYWdlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ3BlcmZvcm1BcGlXcml0ZScsICfmib7kuI3liLDku7vkvZUgQUkg5raI5oGv77yM5peg5rOV5omn6KGMIEFQSSDlhpnlhaXjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBvcmlnaW5hbENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChsYXN0QWlNZXNzYWdlKSA/PyAnJztcbiAgY29uc3QgbmV3Q29udGVudCA9IG9yaWdpbmFsQ29udGVudCArIGJsb2NrO1xuXG4gIGxvZ2dlci5sb2coJ3BlcmZvcm1BcGlXcml0ZScsIGDlrp7ml7blhpnlhaUgQVBJIOS7u+WKoSAoJHtqb2IuYmxvY2tUYWd9KSDliLDmtojmga8gSUQgJHtsYXN0QWlNZXNzYWdlLm1lc3NhZ2VfaWR9Li4uYCk7XG5cbiAgLy8gMy4g5a6e5pe25pu05paw5raI5oGv5YaF5a65XG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KGxhc3RBaU1lc3NhZ2UsIG5ld0NvbnRlbnQpO1xuXG4gIC8vIDQuIOiwg+eUqOmYsuaKluWHveaVsOadpeiwg+W6puWGmeWFpeS6i+S7tueahOWPkemAgVxuICBkZWJvdW5jZWRFbWl0QXBpV3JpdGUoKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDkuovku7blpITnkIblmajlrp7njrAgKOeUsSBldmVudF9xdWV1ZS50cyDosIPnlKgpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmluc2VydEJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+WvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnLCBibG9ja0NvbnRlbnQ6IGRhdGEgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTp1cGRhdGVCeU9iamVjdGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIOS7juS6i+S7tueahCBgZGV0YWlsYCDkuK3ojrflj5bnmoTlj5jph4/lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUJ5T2JqZWN0KGRhdGE6IG9iamVjdCkge1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRWRpdCcsIGJsb2NrQ29udGVudDogZGF0YSB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmluc2VydEJ5UGF0aGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHBhdGhgIOWxnuaAp+iOt+WPluOAglxuICogQHBhcmFtIHsqfSB2YWx1ZSAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHZhbHVlYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEJ5UGF0aChwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgY29uc3QgYmxvY2sgPSBfLnNldCh7fSwgcGF0aCwgdmFsdWUpO1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlSW5zZXJ0JywgYmxvY2tDb250ZW50OiBibG9jayB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOnVwZGF0ZUJ5UGF0aGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHBhdGhgIOWxnuaAp+iOt+WPluOAglxuICogQHBhcmFtIHsqfSB2YWx1ZSAtIOS7juS6i+S7tiBgZGV0YWlsYCDnmoQgYHZhbHVlYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUJ5UGF0aChwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgY29uc3QgYmxvY2sgPSBfLnNldCh7fSwgcGF0aCwgdmFsdWUpO1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRWRpdCcsIGJsb2NrQ29udGVudDogYmxvY2sgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTpkZWxldGVCeU9iamVjdGAg5LqL5Lu244CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIOS7juS6i+S7tueahCBgZGV0YWlsYCDkuK3ojrflj5bnmoTlj5jph4/nu5PmnoTjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUJ5T2JqZWN0KGRhdGE6IG9iamVjdCkge1xuICBwZXJmb3JtQXBpV3JpdGUoeyBibG9ja1RhZzogJ1ZhcmlhYmxlRGVsZXRlJywgYmxvY2tDb250ZW50OiBkYXRhIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6ZGVsZXRlQnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVCeVBhdGgocGF0aDogc3RyaW5nKSB7XG4gIC8vIOWvueS6juWIoOmZpOaTjeS9nO+8jOaIkeS7rOeUqOS4gOS4quepuuWvueixoeS9nOS4uuWAvOadpeihqOekuuWIoOmZpOivpei3r+W+hOeahOaEj+WbvlxuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB7fSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVEZWxldGUnLCBibG9ja0NvbnRlbnQ6IGJsb2NrIH0pO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOS6i+S7tuW5v+aSreWZqOWunueOsCAo55SxIHZhcmlhYmxlX2NoYW5nZV9wcm9jZXNzb3IudHMg562J5YaF6YOo5qih5Z2X6LCD55SoKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDlub/mkq3lmajjgJEqKiDop6blj5EgYGVyYTp3cml0ZURvbmVgIOS6i+S7tuOAglxuICog5b2T5LiA5qyh5a6M5pW055qE5Y+Y6YeP5YaZ5YWl5pON5L2c77yI5YyF5ous5aKe44CB5Yig44CB5pS577yJ5ZyoIGB2YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzYCDkuK3miJDlip/lrozmiJDlkI7vvIxcbiAqIOW6lOiwg+eUqOatpOWHveaVsOOAguWug+WQkeWklumDqOiEmuacrOW5v+aSreS4gOS4quS6i+S7tu+8jOmAmuefpeWug+S7rOWPmOmHj+eKtuaAgeW3suWPkeeUn+aUueWPmO+8jOW5tuaPkOS+m+ivpue7hueahOS4iuS4i+aWh+OAglxuICpcbiAqIEBwYXJhbSB7V3JpdGVEb25lUGF5bG9hZH0gcGF5bG9hZCAtIOWMheWQq+WGmeWFpeaTjeS9nOWFs+mUruS/oeaBr+eahOS6i+S7tui0n+i9veOAglxuICogQGV4YW1wbGVcbiAqIC8vIOi/meaYr+S4gOS4quWcqOWklumDqOiEmuacrOS4reebkeWQrOatpOS6i+S7tueahOekuuS+i++8mlxuICogZXZlbnRPbignZXJhOndyaXRlRG9uZScsIChkZXRhaWwpID0+IHtcbiAqICAgY29uc3QgeyBtaywgbWVzc2FnZV9pZCwgYWN0aW9ucywgc2VsZWN0ZWRNa3MsIGVkaXRMb2dzLCBzdGF0LCBzdGF0V2l0aG91dE1ldGEgfSA9IGRldGFpbDtcbiAqICAgY29uc29sZS5sb2coYEVSQSDlj5jph4/lt7Lmm7TmlrDvvIHmtojmga8gSUQ6ICR7bWVzc2FnZV9pZH0sIE1LOiAke21rfWApO1xuICogICBjb25zb2xlLmxvZygn5omn6KGM55qE5pON5L2cOicsIGFjdGlvbnMpO1xuICpcbiAqICAgLy8g5L2g5Y+v5Lul5qC55o2u6ZyA6KaB5L2/55SoIHN0YXQgKOW4piBtZXRhKSDmiJYgc3RhdFdpdGhvdXRNZXRhICjkuI3luKYgbWV0YSlcbiAqICAgY29uc29sZS5sb2coJ+acgOaWsOeahOe6r+WHgOeKtuaAgeaVsOaNrjonLCBzdGF0V2l0aG91dE1ldGEpO1xuICpcbiAqICAgLy8g5q2k5pe25Y+v5Lul5qC55o2u5pyA5paw55qE54q25oCB5pWw5o2u5pu05paw5L2g6Ieq5bex55qEIFVJIOaIluaJp+ihjOWFtuS7lumAu+i+kVxuICogfSk7XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbWl0V3JpdGVEb25lRXZlbnQocGF5bG9hZDogV3JpdGVEb25lUGF5bG9hZCkge1xuICAvLyDlnKjlub/mkq3liY3vvIzlr7npnIDopoHmmrTpnLLnu5nlpJbpg6jnmoTmlbDmja7ov5vooYzlj43ovazkuYlcbiAgY29uc3QgdW5lc2NhcGVkUGF5bG9hZCA9IHtcbiAgICAuLi5wYXlsb2FkLFxuICAgIHN0YXQ6IHVuZXNjYXBlRXJhRGF0YShwYXlsb2FkLnN0YXQpLFxuICAgIHN0YXRXaXRob3V0TWV0YTogdW5lc2NhcGVFcmFEYXRhKHBheWxvYWQuc3RhdFdpdGhvdXRNZXRhKSxcbiAgfTtcblxuICBsb2dnZXIuZGVidWcoJ2VtaXRXcml0ZURvbmVFdmVudCcsICd3cml0ZURvbmXkuovku7blub/mkq3mlbDmja7lj43ovazkuYknLCB7XG4gICAgYmVmb3JlOiB7IHN0YXQ6IHBheWxvYWQuc3RhdCwgc3RhdFdpdGhvdXRNZXRhOiBwYXlsb2FkLnN0YXRXaXRob3V0TWV0YSB9LFxuICAgIGFmdGVyOiB7IHN0YXQ6IHVuZXNjYXBlZFBheWxvYWQuc3RhdCwgc3RhdFdpdGhvdXRNZXRhOiB1bmVzY2FwZWRQYXlsb2FkLnN0YXRXaXRob3V0TWV0YSB9LFxuICB9KTtcblxuICBldmVudEVtaXQoRVJBX0VWRU5UX0VNSVRURVIuV1JJVEVfRE9ORSwgdW5lc2NhcGVkUGF5bG9hZCk7XG4gIGxvZ2dlci5sb2coXG4gICAgJ2VtaXRXcml0ZURvbmVFdmVudCcsXG4gICAgYOW3suinpuWPkSAke0VSQV9FVkVOVF9FTUlUVEVSLldSSVRFX0RPTkV9IOS6i+S7tuOAguaTjeS9nDogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHBheWxvYWQuYWN0aW9ucyxcbiAgICApfSwgTUs6ICR7cGF5bG9hZC5ta30sIE1zZ0lEOiAke3BheWxvYWQubWVzc2FnZV9pZH0sIOi/nue7reWkhOeQhuasoeaVsDogJHtwYXlsb2FkLmNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50fWAsXG4gICk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/command.ts\n\n}");
  },
  "./src/ERA变量框架/api/macro/parser.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/api/macro/parser.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseEraMacros: () => (/* binding */ parseEraMacros)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('api-macro-parser');\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseEraMacros(text) {\n    const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{ERA')) {\n        return text;\n    }\n    // 获取 stat_data\n    const { stat } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.getEraData)();\n    if (!stat) {\n        logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n        // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n        return text;\n    }\n    return text.replace(macroRegex, (substring, withMeta, path) => {\n        const funcName = 'parseEraMacros';\n        const trimmedPath = path.trim();\n        const includeMeta = !!withMeta;\n        let data;\n        if (trimmedPath === '$ALLDATA') {\n            data = stat;\n        }\n        else {\n            data = _.get(stat, trimmedPath);\n        }\n        if (data === undefined) {\n            logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n            return ''; // 路径未找到, 返回空字符串\n        }\n        // 根据 withMeta 标志决定是否移除 $meta 字段\n        const dataBeforeUnescape = includeMeta ? data : (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.removeMetaFields)(data);\n        // 在返回数据前进行反转义\n        const finalData = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.unescapeEraData)(dataBeforeUnescape);\n        logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n            before: dataBeforeUnescape,\n            after: finalData,\n        });\n        // 如果是对象或数组, 转换为 JSON 字符串\n        if (typeof finalData === 'object' && finalData !== null) {\n            return JSON.stringify(finalData);\n        }\n        // 如果是原始类型, 直接转换为字符串\n        return String(finalData);\n    });\n}\n$(() => {\n    /**\n     * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n     *\n     * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n     *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n     * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n     *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n     */\n    registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n        // 直接复用 parseEraMacros 函数的逻辑。\n        // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n        return parseEraMacros(substring);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXJzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFtRDtBQUNpQjtBQUMzQjtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUU5Qzs7Ozs7R0FLRztBQUNJLFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDekMsTUFBTSxVQUFVLEdBQUcsNENBQTRDLENBQUM7SUFFaEUsNEJBQTRCO0lBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDNUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsZUFBZTtJQUNmLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRywyREFBVSxFQUFFLENBQUM7SUFDOUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1YsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3pELG9DQUFvQztRQUNwQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUM1RCxNQUFNLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQztRQUNsQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUUvQixJQUFJLElBQUksQ0FBQztRQUNULElBQUksV0FBVyxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQy9CLElBQUksR0FBRyxJQUFJLENBQUM7UUFDZCxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsdUJBQXVCLFdBQVcsZUFBZSxDQUFDLENBQUM7WUFDekUsT0FBTyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0I7UUFDN0IsQ0FBQztRQUVELGdDQUFnQztRQUNoQyxNQUFNLGtCQUFrQixHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxpRUFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV2RSxjQUFjO1FBQ2QsTUFBTSxTQUFTLEdBQUcsNERBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRXRELE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxXQUFXLEVBQUUsRUFBRTtZQUN6RCxNQUFNLEVBQUUsa0JBQWtCO1lBQzFCLEtBQUssRUFBRSxTQUFTO1NBQ2pCLENBQUMsQ0FBQztRQUVILHlCQUF5QjtRQUN6QixJQUFJLE9BQU8sU0FBUyxLQUFLLFFBQVEsSUFBSSxTQUFTLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDeEQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsQ0FBQyxDQUFDLEdBQUcsRUFBRTtJQUNMOzs7Ozs7O09BT0c7SUFDSCxpQkFBaUIsQ0FBQyw0Q0FBNEMsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ3JHLDZCQUE2QjtRQUM3QixvREFBb0Q7UUFDcEQsT0FBTyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2FwaS9tYWNyby9wYXJzZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdW5lc2NhcGVFcmFEYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBnZXRFcmFEYXRhLCByZW1vdmVNZXRhRmllbGRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignYXBpLW1hY3JvLXBhcnNlcicpO1xuXG4vKipcbiAqIOino+aekOWtl+espuS4suS4reeahCBFUkEg5a6PLCDlubblsIblhbbmm7/mjaLkuLrlr7nlupTnmoTlj5jph4/lgLzjgIJcbiAqIOi/meaYr+aPkOS+m+e7meWFtuS7luaooeWdl+iwg+eUqOeahOWFrOWFseaOpeWPo+OAglxuICogQHBhcmFtIHRleHQgLSDljIXlkKvlro/nmoTovpPlhaXlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIC0g5pu/5o2i5a6P5ZCO55qE5a2X56ym5Liy44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUVyYU1hY3Jvcyh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBtYWNyb1JlZ2V4ID0gL3t7XFxzKkVSQSgtd2l0aG1ldGEpP1xccyo6XFxzKihbXn1dKz8pXFxzKn19L2dpO1xuXG4gIC8vIOWmguaenOaWh+acrOS4reS4jeWMheWQq+Wuj+eJueW+geWtl+espuS4siwg55u05o6l6L+U5Zue5Lul5LyY5YyW5oCn6IO9XG4gIGlmICghdGV4dC5pbmNsdWRlcygne3tFUkEnKSkge1xuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgLy8g6I635Y+WIHN0YXRfZGF0YVxuICBjb25zdCB7IHN0YXQgfSA9IGdldEVyYURhdGEoKTtcbiAgaWYgKCFzdGF0KSB7XG4gICAgbG9nZ2VyLndhcm4oJ3BhcnNlRXJhTWFjcm9zJywgJ+aXoOazleiOt+WPluWIsCBzdGF0X2RhdGEsIOWuj+abv+aNouWksei0pS4nKTtcbiAgICAvLyDlpoLmnpzmsqHmnIkgc3RhdF9kYXRhLCDku7vkvZXlro/pg73ml6Dms5Xop6PmnpAsIOebtOaOpei/lOWbnuWOn+aWh+acrFxuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgcmV0dXJuIHRleHQucmVwbGFjZShtYWNyb1JlZ2V4LCAoc3Vic3RyaW5nLCB3aXRoTWV0YSwgcGF0aCkgPT4ge1xuICAgIGNvbnN0IGZ1bmNOYW1lID0gJ3BhcnNlRXJhTWFjcm9zJztcbiAgICBjb25zdCB0cmltbWVkUGF0aCA9IHBhdGgudHJpbSgpO1xuICAgIGNvbnN0IGluY2x1ZGVNZXRhID0gISF3aXRoTWV0YTtcblxuICAgIGxldCBkYXRhO1xuICAgIGlmICh0cmltbWVkUGF0aCA9PT0gJyRBTExEQVRBJykge1xuICAgICAgZGF0YSA9IHN0YXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGEgPSBfLmdldChzdGF0LCB0cmltbWVkUGF0aCk7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgbG9nZ2VyLndhcm4oZnVuY05hbWUsIGDlnKggc3RhdF9kYXRhIOS4reacquaJvuWIsOi3r+W+hCBcIiR7dHJpbW1lZFBhdGh9XCIsIOWuj+Wwhuabv+aNouS4uuepuuWtl+espuS4si5gKTtcbiAgICAgIHJldHVybiAnJzsgLy8g6Lev5b6E5pyq5om+5YiwLCDov5Tlm57nqbrlrZfnrKbkuLJcbiAgICB9XG5cbiAgICAvLyDmoLnmja4gd2l0aE1ldGEg5qCH5b+X5Yaz5a6a5piv5ZCm56e76ZmkICRtZXRhIOWtl+autVxuICAgIGNvbnN0IGRhdGFCZWZvcmVVbmVzY2FwZSA9IGluY2x1ZGVNZXRhID8gZGF0YSA6IHJlbW92ZU1ldGFGaWVsZHMoZGF0YSk7XG5cbiAgICAvLyDlnKjov5Tlm57mlbDmja7liY3ov5vooYzlj43ovazkuYlcbiAgICBjb25zdCBmaW5hbERhdGEgPSB1bmVzY2FwZUVyYURhdGEoZGF0YUJlZm9yZVVuZXNjYXBlKTtcblxuICAgIGxvZ2dlci5kZWJ1ZygncGFyc2VFcmFNYWNyb3MnLCBg5a6P5pu/5o2i5pWw5o2u5Y+N6L2s5LmJOiAke3RyaW1tZWRQYXRofWAsIHtcbiAgICAgIGJlZm9yZTogZGF0YUJlZm9yZVVuZXNjYXBlLFxuICAgICAgYWZ0ZXI6IGZpbmFsRGF0YSxcbiAgICB9KTtcblxuICAgIC8vIOWmguaenOaYr+WvueixoeaIluaVsOe7hCwg6L2s5o2i5Li6IEpTT04g5a2X56ym5LiyXG4gICAgaWYgKHR5cGVvZiBmaW5hbERhdGEgPT09ICdvYmplY3QnICYmIGZpbmFsRGF0YSAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGZpbmFsRGF0YSk7XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5piv5Y6f5aeL57G75Z6LLCDnm7TmjqXovazmjaLkuLrlrZfnrKbkuLJcbiAgICByZXR1cm4gU3RyaW5nKGZpbmFsRGF0YSk7XG4gIH0pO1xufVxuXG4kKCgpID0+IHtcbiAgLyoqXG4gICAqIOazqOWGjCBFUkEg5a6PLCDnlKjkuo7lnKjlj5HpgIHnu5kgQUkg55qE5raI5oGv5Lit5p+l6K+i5b2T5YmN6IGK5aSp55qE5Y+Y6YeP5pWw5o2uXG4gICAqXG4gICAqIC0gYHt7RVJBOnBhdGgudG8uZGF0YX19YDog5p+l6K+i5bm25pu/5o2i5Li6KirkuI3lkKsqKiBgJG1ldGFgIOeahOe6r+WHgOaVsOaNruOAglxuICAgKiAgIC0gYHt7RVJBOiRBTExEQVRBfX1gIOWwhui/lOWbnuaVtOS4quenu+mZpCBgJG1ldGFgIOWQjueahCBgc3RhdF9kYXRhYCDlr7nosaHjgIJcbiAgICogLSBge3tFUkEtd2l0aG1ldGE6cGF0aC50by5kYXRhfX1gOiDmn6Xor6Llubbmm7/mjaLkuLoqKuWMheWQqyoqIGAkbWV0YWAg55qE5Y6f5aeL5pWw5o2u44CCXG4gICAqICAgLSBge3tFUkEtd2l0aG1ldGE6JEFMTERBVEF9fWAg5bCG6L+U5Zue5a6M5pW055qEIGBzdGF0X2RhdGFgIOWvueixoeOAglxuICAgKi9cbiAgcmVnaXN0ZXJNYWNyb0xpa2UoL3t7XFxzKkVSQSgtd2l0aG1ldGEpP1xccyo6XFxzKihbXn1dKz8pXFxzKn19L2dpLCAoY29udGV4dCwgc3Vic3RyaW5nLCB3aXRoTWV0YSwgcGF0aCkgPT4ge1xuICAgIC8vIOebtOaOpeWkjeeUqCBwYXJzZUVyYU1hY3JvcyDlh73mlbDnmoTpgLvovpHjgIJcbiAgICAvLyBzdWJzdHJpbmcg5Y+C5pWw5piv5Yy56YWN5Yiw55qE5a6M5pW05a6P5a2X56ym5LiyLCDlpoIgXCJ7e0VSQTpwYXRoLnRvLmRhdGF9fVwiXG4gICAgcmV0dXJuIHBhcnNlRXJhTWFjcm9zKHN1YnN0cmluZyk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api/macro/parser.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/delete.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/delete.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processDeleteBlocks: () => (/* binding */ processDeleteBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('core-crud-delete');\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData, basePath, patchObj, editLog) {\n    // --- 1. 入口守卫和状态获取 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n    // 精确判断豁免条件\n    const metaPatch = _.get(patchObj, '$meta');\n    const isBypassingProtection = \n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n        // 场景2: 指令明确要删除 $meta.necessary 键\n        _.has(patchObj, ['$meta', 'necessary']);\n    // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n    if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n        // **意图：递归删除子节点**\n        // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n        if (necessary === 'all' && !isBypassingProtection) {\n            logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`);\n            return;\n        }\n        // 权限通过，或存在豁免，继续向内递归。\n        for (const key of Object.keys(patchObj)) {\n            const fullPath = basePath ? `${basePath}.${key}` : key;\n            const subPatchObj = patchObj[key];\n            applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n        }\n        return; // 子节点处理完毕，返回。\n    }\n    // --- 3. 执行删除当前节点 ---\n    // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n    // **意图：删除当前节点 `basePath`**\n    // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n    // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n    if (necessary === 'self' || necessary === 'all') {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`);\n        return;\n    }\n    // 根节点（basePath 为 ''）不应被删除。\n    if (basePath === '') {\n        logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。');\n        return;\n    }\n    // 执行原子性删除\n    const valOld = _.cloneDeep(currentNodeInVars);\n    _.unset(statData, basePath);\n    editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n    logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n/**\n * 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processDeleteBlocks(allDeletes, editLog) {\n    if (allDeletes.length > 0) {\n        for (const deleteRoot of allDeletes) {\n            if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_0__.updateEraStatData)(stat => {\n                    logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n                    // 从根路径开始递归\n                    applyDeleteAtLevel(stat, '', deleteRoot, editLog);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processDeleteBlocks', '所有 VariableDelete 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7R0FVRztBQUNVO0FBRTRDO0FBQ2hCO0FBRXpDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBRTlDOzs7Ozs7OztHQVFHO0FBQ0gsU0FBUyxrQkFBa0IsQ0FBQyxRQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFhLEVBQUUsT0FBYztJQUN4Rix1QkFBdUI7SUFDdkIsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFFMUUsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLDhCQUE4QixRQUFRLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQztRQUN4RixPQUFPO0lBQ1QsQ0FBQztJQUVELE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUVuRSxXQUFXO0lBQ1gsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0MsTUFBTSxxQkFBcUI7SUFDekIsd0JBQXdCO0lBQ3hCLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELGlDQUFpQztRQUNqQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBRTFDLG9DQUFvQztJQUNwQyxJQUFJLENBQUMsQ0FBQyxhQUFh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RUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9kZWxldGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Y+Y6YeP5Yig6Zmk5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+i0n+i0o+WkhOeQhiBgPFZhcmlhYmxlRGVsZXRlPmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5Yig6Zmk77yM5bm255Sf5oiQ55u45bqU55qEIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq5oyH5Luk6amx5YqoKio6IOmAkuW9kuihjOS4uueUseaMh+S7pOWvueixoeeahOe7k+aehOmpseWKqOOAguepuuWvueixoSBge31gIOihqOekuuWIoOmZpOW9k+WJjeiKgueCue+8jOmdnuepuuWvueixoeihqOekuumAkuW9kuWIoOmZpOWtkOiKgueCueOAglxuICogLSAqKuWuieWFqOesrOS4gCoqOiDliKDpmaTmmK/noLTlnY/mgKfmk43kvZzvvIzlm6DmraTlvJXlhaXkuoYgYCRtZXRhLm5lY2Vzc2FyeWAg5p2D6ZmQ5py65Yi25p2l6Ziy5q2i6K+v5Yig44CCXG4gKiAtICoq57K+56Gu6LGB5YWNKio6IGBuZWNlc3NhcnlgIOeahOS/neaKpOWPquacieWcqOWIoOmZpOaMh+S7pOaYjuehruaMh+WQkSBgbmVjZXNzYXJ5YCDlsZ7mgKfoh6rouqvml7bmiY3kvJrooqvnu5Xov4fjgIJcbiAqIC0gKirljp/lrZDmgKfml6Xlv5cqKjog5Li65q+P5LiA5qyh5Yig6Zmk55Sf5oiQ5Y2V5LiA44CB57K+56Gu55qEIGBFZGl0TG9nYO+8jOehruS/neaTjeS9nOWPr+WujOWFqOWbnua7muOAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1jcnVkLWRlbGV0ZScpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5Yig6Zmk44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlRGVsZXRlPmAg55qE5qC45b+D6YC76L6R77yM5YW26KGM5Li655Sx5oyH5LukIGBwYXRjaE9iamAg55qE57uT5p6E6amx5Yqo44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeS4jiBgYmFzZVBhdGhgIOWvueW6lOeahOmDqOWIhuOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5mdW5jdGlvbiBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdERhdGE6IGFueSwgYmFzZVBhdGg6IHN0cmluZywgcGF0Y2hPYmo6IGFueSwgZWRpdExvZzogYW55W10pIHtcbiAgLy8gLS0tIDEuIOWFpeWPo+WuiOWNq+WSjOeKtuaAgeiOt+WPliAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcblxuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseURlbGV0ZUF0TGV2ZWwnLCBgVmFyaWFibGVEZWxldGUg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbmVjZXNzYXJ5ID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAnbmVjZXNzYXJ5J10pO1xuXG4gIC8vIOeyvuehruWIpOaWreixgeWFjeadoeS7tlxuICBjb25zdCBtZXRhUGF0Y2ggPSBfLmdldChwYXRjaE9iaiwgJyRtZXRhJyk7XG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgLy8g5Zy65pmvMTog5oyH5Luk6KaB5Yig6Zmk5pW05LiqICRtZXRhIOWvueixoVxuICAgIChfLmlzUGxhaW5PYmplY3QobWV0YVBhdGNoKSAmJiBfLmlzRW1wdHkobWV0YVBhdGNoKSkgfHxcbiAgICAvLyDlnLrmma8yOiDmjIfku6TmmI7noa7opoHliKDpmaQgJG1ldGEubmVjZXNzYXJ5IOmUrlxuICAgIF8uaGFzKHBhdGNoT2JqLCBbJyRtZXRhJywgJ25lY2Vzc2FyeSddKTtcblxuICAvLyAtLS0gMi4g5Yik5pat5oSP5Zu+77ya6YCS5b2S5Yig6Zmk5a2Q6IqC54K5IHZzIOWIoOmZpOW9k+WJjeiKgueCuSAtLS1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikgJiYgIV8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICAvLyAqKuaEj+Wbvu+8mumAkuW9kuWIoOmZpOWtkOiKgueCuSoqXG5cbiAgICAvLyDmnYPpmZDmo4Dmn6XvvJrlpoLmnpzoioLngrnlj5cgJ2FsbCcg5L+d5oqk77yM5LiU5oyH5Luk5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ56aB5q2i5rex5YWl44CCXG4gICAgaWYgKG5lY2Vzc2FyeSA9PT0gJ2FsbCcgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICdhcHBseURlbGV0ZUF0TGV2ZWwnLFxuICAgICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiBhbGxcIiDkv53miqTvvIzlhbblrZDoioLngrnml6Dms5XooqvliKDpmaTjgIJgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDmnYPpmZDpgJrov4fvvIzmiJblrZjlnKjosYHlhY3vvIznu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoT2JqID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIGFwcGx5RGVsZXRlQXRMZXZlbChzdGF0RGF0YSwgZnVsbFBhdGgsIHN1YlBhdGNoT2JqLCBlZGl0TG9nKTtcbiAgICB9XG4gICAgcmV0dXJuOyAvLyDlrZDoioLngrnlpITnkIblrozmr5XvvIzov5Tlm57jgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDmiafooYzliKDpmaTlvZPliY3oioLngrkgLS0tXG4gIC8vICjog73otbDliLDov5nph4zvvIzor7TmmI4gcGF0Y2hPYmog5piv56m65a+56LGh44CB6Z2e5a+56LGh5oiWIG51bGwpXG4gIC8vICoq5oSP5Zu+77ya5Yig6Zmk5b2T5YmN6IqC54K5IGBiYXNlUGF0aGAqKlxuXG4gIC8vIOadg+mZkOajgOafpe+8midzZWxmJyDmiJYgJ2FsbCcg6YO95Lya6Zi75q2i5b2T5YmN6IqC54K555qE55u05o6l5Yig6Zmk44CCXG4gIC8vIOebtOaOpeWIoOmZpOiKgueCueeahOaEj+WbvuaXoOazleixgeWFjeS/neaKpO+8jOW/hemhu+mAmui/h+mAkuW9kuaEj+WbvuWIoOmZpCAnJG1ldGEnIOadpeino+mZpOS/neaKpOOAglxuICBpZiAobmVjZXNzYXJ5ID09PSAnc2VsZicgfHwgbmVjZXNzYXJ5ID09PSAnYWxsJykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RGVsZXRlQXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiAke25lY2Vzc2FyeX1cIiDkv53miqTvvIzml6Dms5Xooqvnm7TmjqXliKDpmaTjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g5qC56IqC54K577yIYmFzZVBhdGgg5Li6ICcn77yJ5LiN5bqU6KKr5Yig6Zmk44CCXG4gIGlmIChiYXNlUGF0aCA9PT0gJycpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsICdWYXJpYWJsZURlbGV0ZSDlpLHotKXvvJrkuI3lhYHorrjliKDpmaTmoLnlr7nosaHjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmiafooYzljp/lrZDmgKfliKDpmaRcbiAgY29uc3QgdmFsT2xkID0gXy5jbG9uZURlZXAoY3VycmVudE5vZGVJblZhcnMpO1xuICBfLnVuc2V0KHN0YXREYXRhLCBiYXNlUGF0aCk7XG4gIGVkaXRMb2cucHVzaCh7IG9wOiAnZGVsZXRlJywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX29sZDogdmFsT2xkIH0pO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsIGDmiJDlip/liKDpmaToioLngrk6ICR7YmFzZVBhdGh9YCk7XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVEZWxldGU+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxEZWxldGVzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGRlbGV0ZSDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlczogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxEZWxldGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IGRlbGV0ZVJvb3Qgb2YgYWxsRGVsZXRlcykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZGVsZXRlUm9vdCkgfHwgXy5pc0VtcHR5KGRlbGV0ZVJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsIGDlpITnkIYgZGVsZXRlUm9vdDogJHtKU09OLnN0cmluZ2lmeShkZWxldGVSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoTlvIDlp4vpgJLlvZJcbiAgICAgICAgICBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdCwgJycsIGRlbGV0ZVJvb3QsIGVkaXRMb2cpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NEZWxldGVCbG9ja3MnLCBg5aSE55CGIGRlbGV0ZVJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVEZWxldGUg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/delete.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/insert.ts": 
  /*!************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/insert.ts ***!
  \************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyInsertAtLevel: () => (/* binding */ applyInsertAtLevel),\n/* harmony export */   processInsertBlocks: () => (/* binding */ processInsertBlocks)\n/* harmony export */ });\n/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./template */ \"./src/ERA变量框架/core/crud/insert/template.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('core-crud-insert-insert');\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nfunction applyInsertAtLevel(statData, basePath, patchObj, editLog, inheritedContent, parentData) {\n    // --- 1. 确定当前层级的模板内容 ---\n    // 调用 resolveTemplate，它现在直接使用传入的 parentData\n    const localTplContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.resolveTemplate)(inheritedContent, parentData);\n    logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n        statData: _.cloneDeep(statData),\n    });\n    // --- 2. 检查路径存在性，决定执行策略 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    logger.debug('applyInsertAtLevel', `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`, currentNodeInVars);\n    // **策略一：原子性插入 (Atomic Insert)**\n    // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n    if (basePath && currentNodeInVars === undefined) {\n        // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n        const composed = (0,_template__WEBPACK_IMPORTED_MODULE_0__.applyTemplateToPatch)(localTplContent, patchObj);\n        const finalValue = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(composed); // 清理数组中的 null 等无效值。\n        logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n        _.set(statData, basePath, finalValue); // 执行插入。\n        editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n        logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n        return; // 插入完成，终止递归。\n    }\n    // **策略二：递归补充 (Recursive Supplement)**\n    // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n    if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n        logger.debug('applyInsertAtLevel', `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`);\n        for (const key of Object.keys(patchObj)) {\n            const subPath = basePath ? `${basePath}.${key}` : key;\n            const subPatch = patchObj[key];\n            // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n            const subInheritedContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.getInheritedTemplateContent)(localTplContent, key);\n            logger.debug('applyInsertAtLevel', `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`);\n            // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n            applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n        }\n    }\n    else if (basePath) {\n        // **插入失败**\n        // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n        // 则记录警告。insert 不会覆盖已存在的值。\n        logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`);\n    }\n    // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n/**\n * 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processInsertBlocks(allInserts, editLog) {\n    if (allInserts.length > 0) {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n            logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(stat));\n            return stat;\n        });\n        /*\n         * N.B. 必须对每个 insertRoot 单独调用 updateVariablesWith，而不是将所有操作合并到一次调用中。\n         * 这是为了确保在同一条消息内，前一个 <VariableInsert> 块中插入的模板或数据，\n         * 可以被后一个 <VariableInsert> 或 <VariableEdit> 块访问和使用。\n         * 每次 await updateVariablesWith 完成后，变量状态都会被刷新，从而使后续操作能看到最新的结果。\n         */\n        for (const insertRoot of allInserts) {\n            if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(stat => {\n                    logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n                    applyInsertAtLevel(stat, '', insertRoot, editLog, null, null);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processInsertBlocks', '所有 VariableInsert 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ1U7QUFFbUY7QUFDcEM7QUFDUDtBQUNUO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBRXJEOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUNJLFNBQVMsa0JBQWtCLENBQ2hDLFFBQWEsRUFDYixRQUFnQixFQUNoQixRQUFhLEVBQ2IsT0FBYyxFQUNkLGdCQUFxQixFQUNyQixVQUFlO0lBRWYseUJBQXlCO0lBQ3pCLDJDQUEyQztJQUMzQyxNQUFNLGVBQWUsR0FBRywwREFBZSxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ3RFLE1BQU0sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsbUJBQW1CLFFBQVEsSUFBSSxNQUFNLEdBQUcsRUFBRTtRQUMzRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7S0FDaEMsQ0FBQyxDQUFDO0lBRUgsNEJBQTRCO0lBQzVCLE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQzFFLE1BQU0sQ0FBQyxLQUFLLENBQ1Ysb0JBQW9CLEVBQ3BCLG9CQUFvQixRQUFRLElBQUksTUFBTSwwQkFBMEIsRUFDaEUsaUJBQWlCLENBQ2xCLENBQUM7SUFFRixnQ0FBZ0M7SUFDaEMsbUNBQW1DO0lBQ25DLElBQUksUUFBUSxJQUFJLGlCQUFpQixLQUFLLFNBQVMsRUFBRSxDQUFDO1FBQ2hELDZDQUE2QztRQUM3QyxNQUFNLFFBQVEsR0FBRywrREFBb0IsQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFakUsTUFBTSxVQUFVLEdBQUcsMkRB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QUFJLENBQUMsRUFBRTtvQkFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQ3BGLG1DQUFtQztvQkFDbkMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDOUQsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRixDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+aPkuWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfotJ/otKPlpITnkIYgYDxWYXJpYWJsZUluc2VydD5gIOaMh+S7pO+8jOWunueOsOWPmOmHj+eahOmdnuegtOWdj+aAp+aPkuWFpe+8jOW5tueUn+aIkOebuOW6lOeahCBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuiBjOi0o+WNleS4gCoqOiDmqKHlnZflj6rlhbPlv4PlpoLkvZXmoLnmja7mjIfku6Tkv67mlLnlj5jph4/nirbmgIHlubbnlJ/miJDml6Xlv5fvvIzkuI3lhbPlv4PmjIfku6Tku47kvZXogIzmnaXjgIJcbiAqIC0gKirljp/lrZDmgKfmk43kvZwqKjogYGFwcGx5SW5zZXJ0QXRMZXZlbGAg5a6e546w5LqG5Y6f5a2Q5oCn55qE5o+S5YWl77yM56Gu5L+d5LqG5pWw5o2u57uT5p6E55qE5a6M5pW05oCn44CCXG4gKiAgIOWmguaenOS4gOS4quWfuuehgOi3r+W+hOS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4quWvueixoeS9nOS4uuS4gOaVtOS4quWNleWFg+S4gOasoeaAp+aPkuWFpeOAglxuICogLSAqKuWuuemUmeaApyoqOiDlvZPpgYfliLDml6DmlYjot6/lvoTvvIjlpoLlsJ3or5XlkJHlt7LlrZjlnKjnmoTot6/lvoTmj5LlhaXvvInml7bvvIzkvJrot7Pov4for6XmnaHmjIfku6Tlubbnu6fnu63lpITnkIblhbbku5bmnInmlYjmjIfku6TvvIxcbiAqICAg6ICM5LiN5piv5Lit5pat5pW05Liq5YaZ5YWl6L+H56iL44CCXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgYXBwbHlUZW1wbGF0ZVRvUGF0Y2gsIGdldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCwgcmVzb2x2ZVRlbXBsYXRlIH0gZnJvbSAnLi90ZW1wbGF0ZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHNhbml0aXplQXJyYXlzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGF0YSc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdjb3JlLWNydWQtaW5zZXJ0LWluc2VydCcpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5o+S5YWl44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlSW5zZXJ0PmAg55qE5qC45b+D6YC76L6R77yaKirpnZ7noLTlnY/mgKflnLAqKumAkuW9kuaPkuWFpeWAvOOAglxuICpcbiAqICoq5qC45b+D6KeE5YiZKio6XG4gKiAxLiAqKuWPquWcqOi3r+W+hOS4jeWtmOWcqOaXtuWGmeWFpSoq44CC5aaC5p6c6Lev5b6E5bey5a2Y5Zyo77yM5YiZ6Lez6L+H6K+l6Lev5b6E55qE5YaZ5YWl44CCXG4gKiAyLiAqKuWOn+WtkOaAp+aPkuWFpSoq44CC5aaC5p6c5LiA5Liq5Z+656GA6Lev5b6E77yI5aaCIGBwbGF5ZXIuaW52ZW50b3J5YO+8ieS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4qiBgaW52ZW50b3J5YFxuICogICAg5a+56LGh5L2c5Li65LiA5pW05Liq5Y2V5YWD5LiA5qyh5oCn5o+S5YWl77yM5bm25Y+q6K6w5b2V5LiA5p2hIGBpbnNlcnRgIOaXpeW/l+OAglxuICogMy4gKirpgJLlvZLooaXlhYUqKuOAguWmguaenOWfuuehgOi3r+W+hOW3suWtmOWcqO+8jOWug+S8mumAkuW9kuWcsOa3seWFpe+8jOWwneivleWcqOWFtuS4i+ihpeWFheaPkuWFpeaWsOeahOWtkOi3r+W+hOOAglxuICogNC4gKirmqKHmnb/mlK/mjIEqKuOAguaUr+aMgeS7jiBgJHRlbXBsYXRlYCDkuK3nu6fmib/mqKHmnb/vvIzlrp7njrDmlbDmja7nu5PmnoTnmoTlpI3nlKjjgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g5LuO5oyH5Luk5Lit6Kej5p6Q5Ye655qE44CB6KaB5bqU55So5LqO5b2T5YmN5bGC57qn55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE77yI5byV55So5Lyg6YCS77yJ44CCXG4gKiBAcGFyYW0ge2FueX0gaW5oZXJpdGVkQ29udGVudCAtIOS7juS4iuWxgue7p+aJv+eahOOAgee6r+eyueeahOaooeadv+KAnOWGheWuueKAneWvueixoeOAglxuICogQHBhcmFtIHthbnl9IHBhcmVudERhdGEgLSDlvZPliY3oioLngrnnmoTniLboioLngrnlnKggYHN0YXREYXRhYCDkuK3nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5SW5zZXJ0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIGluaGVyaXRlZENvbnRlbnQ6IGFueSxcbiAgcGFyZW50RGF0YTogYW55LCAvLyDmlrDlop7lj4LmlbDvvIznm7TmjqXkvKDpgJLniLboioLngrnmlbDmja5cbikge1xuICAvLyAtLS0gMS4g56Gu5a6a5b2T5YmN5bGC57qn55qE5qih5p2/5YaF5a65IC0tLVxuICAvLyDosIPnlKggcmVzb2x2ZVRlbXBsYXRl77yM5a6D546w5Zyo55u05o6l5L2/55So5Lyg5YWl55qEIHBhcmVudERhdGFcbiAgY29uc3QgbG9jYWxUcGxDb250ZW50ID0gcmVzb2x2ZVRlbXBsYXRlKGluaGVyaXRlZENvbnRlbnQsIHBhcmVudERhdGEpO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGBb5YWl5Y+jXSBiYXNlUGF0aDogXCIke2Jhc2VQYXRoIHx8ICdyb290J31cImAsIHtcbiAgICBzdGF0RGF0YTogXy5jbG9uZURlZXAoc3RhdERhdGEpLFxuICB9KTtcblxuICAvLyAtLS0gMi4g5qOA5p+l6Lev5b6E5a2Y5Zyo5oCn77yM5Yaz5a6a5omn6KGM562W55WlIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgYFvot6/lvoTmo4Dmn6VdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCIuIGN1cnJlbnROb2RlSW5WYXJzIOeahOWAvDpgLFxuICAgIGN1cnJlbnROb2RlSW5WYXJzLFxuICApO1xuXG4gIC8vICoq562W55Wl5LiA77ya5Y6f5a2Q5oCn5o+S5YWlIChBdG9taWMgSW5zZXJ0KSoqXG4gIC8vIOWmguaenOW9k+WJjei3r+W+hOWcqOWPmOmHj+S4reS4jeWtmOWcqO+8jOWImeWwhuaVtOS4quihpeS4geWvueixoeS9nOS4uuaWsOWAvOS4gOasoeaAp+aPkuWFpeOAglxuICBpZiAoYmFzZVBhdGggJiYgY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIOiwg+eUqCBhcHBseVRlbXBsYXRlVG9QYXRjaCDlh73mlbDvvIzlsIblkIjlubblkI7nmoTmqKHmnb/lhoXlrrnlupTnlKjliLDooaXkuIHkuIpcbiAgICBjb25zdCBjb21wb3NlZCA9IGFwcGx5VGVtcGxhdGVUb1BhdGNoKGxvY2FsVHBsQ29udGVudCwgcGF0Y2hPYmopO1xuXG4gICAgY29uc3QgZmluYWxWYWx1ZSA9IHNhbml0aXplQXJyYXlzKGNvbXBvc2VkKTsgLy8g5riF55CG5pWw57uE5Lit55qEIG51bGwg562J5peg5pWI5YC844CCXG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseUluc2VydEF0TGV2ZWwnLCBg5pyA57uI5o+S5YWl5pWw5o2uIGF0ICR7YmFzZVBhdGh9OlxcbiR7SlNPTi5zdHJpbmdpZnkoZmluYWxWYWx1ZSwgbnVsbCwgMil9YCk7XG4gICAgXy5zZXQoc3RhdERhdGEsIGJhc2VQYXRoLCBmaW5hbFZhbHVlKTsgLy8g5omn6KGM5o+S5YWl44CCXG4gICAgZWRpdExvZy5wdXNoKHsgb3A6ICdpbnNlcnQnLCBwYXRoOiBiYXNlUGF0aCwgdmFsdWVfbmV3OiBfLmNsb25lRGVlcChmaW5hbFZhbHVlKSB9KTtcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGDljp/lrZDmgKfmj5LlhaXliLDmlrDot6/lvoQ6ICR7YmFzZVBhdGh9YCk7XG4gICAgcmV0dXJuOyAvLyDmj5LlhaXlrozmiJDvvIznu4jmraLpgJLlvZLjgIJcbiAgfVxuXG4gIC8vICoq562W55Wl5LqM77ya6YCS5b2S6KGl5YWFIChSZWN1cnNpdmUgU3VwcGxlbWVudCkqKlxuICAvLyDlpoLmnpzlvZPliY3ot6/lvoTlt7LlrZjlnKjvvIzlubbkuJTooaXkuIHlkozlvZPliY3lgLzpg73mmK/lr7nosaHvvIzliJnmt7HlhaXpgJLlvZLjgIJcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50Tm9kZUluVmFycykgJiYgXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdhcHBseUluc2VydEF0TGV2ZWwnLFxuICAgICAgYFvpgJLlvZLooaXlhYVdIGF0IHBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCJcbiAgICAgIC0g5b2T5YmN5bGC57qn5qih5p2/IChsb2NhbFRwbENvbnRlbnQpOiAke0pTT04uc3RyaW5naWZ5KGxvY2FsVHBsQ29udGVudCl9YCxcbiAgICApO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHBhdGNoT2JqKSkge1xuICAgICAgY29uc3Qgc3ViUGF0aCA9IGJhc2VQYXRoID8gYCR7YmFzZVBhdGh9LiR7a2V5fWAgOiBrZXk7XG4gICAgICBjb25zdCBzdWJQYXRjaCA9IHBhdGNoT2JqW2tleV07XG4gICAgICAvLyDosIPnlKggZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW5077yM5LuO5b2T5YmN5qih5p2/5YaF5a655Lit5Li65a2Q6IqC54K55p+l5om+5YW25bqU57un5om/55qE5YaF5a65XG4gICAgICBjb25zdCBzdWJJbmhlcml0ZWRDb250ZW50ID0gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KGxvY2FsVHBsQ29udGVudCwga2V5KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsXG4gICAgICAgIGAgIC0g5YeG5aSH6YCS5b2S5a2Q6IqC54K5OiBcIiR7a2V5fVwiXG4gICAgICAtIOWwhuS8oOmAkue7meWtkOiKgueCueeahOaooeadvyAoc3ViSW5oZXJpdGVkQ29udGVudCk6ICR7SlNPTi5zdHJpbmdpZnkoc3ViSW5oZXJpdGVkQ29udGVudCl9YCxcbiAgICAgICk7XG4gICAgICAvLyDlsIblvZPliY3oioLngrnmlbDmja4gY3VycmVudE5vZGVJblZhcnMg5L2c5Li65LiL5LiA5bGC55qEIHBhcmVudERhdGEg5Lyg6YCS5LiL5Y67XG4gICAgICBhcHBseUluc2VydEF0TGV2ZWwoc3RhdERhdGEsIHN1YlBhdGgsIHN1YlBhdGNoLCBlZGl0TG9nLCBzdWJJbmhlcml0ZWRDb250ZW50LCBjdXJyZW50Tm9kZUluVmFycyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGJhc2VQYXRoKSB7XG4gICAgLy8gKirmj5LlhaXlpLHotKUqKlxuICAgIC8vIOWmguaenOi3r+W+hOW3suWtmOWcqO+8jOS9huS4jeaYr+WPr+mAkuW9kuihpeWFheeahOWvueixoee7k+aehO+8iOS+i+Wmgu+8jOS4gOS4quaYr+Wvueixoe+8jOWPpuS4gOS4quaYr+Wtl+espuS4su+8ie+8jFxuICAgIC8vIOWImeiusOW9leitpuWRiuOAgmluc2VydCDkuI3kvJropobnm5blt7LlrZjlnKjnmoTlgLzjgIJcbiAgICBsb2dnZXIud2FybignYXBwbHlJbnNlcnRBdExldmVsJywgYFZhcmlhYmxlSW5zZXJ0IOWksei0pe+8mui3r+W+hOW3suWtmOWcqOS4lOaXoOazlemAkuW9kuihpeWFhSAtPiAke2Jhc2VQYXRofWApO1xuICB9XG4gIC8vIOWmguaenCBiYXNlUGF0aCDkuLrnqbrvvIjlnKjmoLnnuqfliKvvvInkuJQgcGF0Y2gg5LiN5piv5a+56LGh77yM5YiZ5LiN5omn6KGM5Lu75L2V5pON5L2c77yM5Zug5Li65qC55LiN6IO96KKr6Z2e5a+56LGh5pu/5o2i44CCXG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVJbnNlcnQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxJbnNlcnRzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGluc2VydCDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NJbnNlcnRCbG9ja3MoYWxsSW5zZXJ0czogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxJbnNlcnRzLmxlbmd0aCA+IDApIHtcbiAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShhc3luYyBzdGF0ID0+IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0luc2VydEJsb2NrcycsICdb5Yid5aeL54q25oCBXSDov5vlhaUgcHJvY2Vzc0luc2VydEJsb2NrcyDml7bnmoQgc3RhdERhdGE6JywgXy5jbG9uZURlZXAoc3RhdCkpO1xuICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgfSk7XG4gICAgLypcbiAgICAgKiBOLkIuIOW/hemhu+Wvueavj+S4qiBpbnNlcnRSb290IOWNleeLrOiwg+eUqCB1cGRhdGVWYXJpYWJsZXNXaXRo77yM6ICM5LiN5piv5bCG5omA5pyJ5pON5L2c5ZCI5bm25Yiw5LiA5qyh6LCD55So5Lit44CCXG4gICAgICog6L+Z5piv5Li65LqG56Gu5L+d5Zyo5ZCM5LiA5p2h5raI5oGv5YaF77yM5YmN5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5Z2X5Lit5o+S5YWl55qE5qih5p2/5oiW5pWw5o2u77yMXG4gICAgICog5Y+v5Lul6KKr5ZCO5LiA5LiqIDxWYXJpYWJsZUluc2VydD4g5oiWIDxWYXJpYWJsZUVkaXQ+IOWdl+iuv+mXruWSjOS9v+eUqOOAglxuICAgICAqIOavj+asoSBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoIOWujOaIkOWQju+8jOWPmOmHj+eKtuaAgemDveS8muiiq+WIt+aWsO+8jOS7juiAjOS9v+WQjue7reaTjeS9nOiDveeci+WIsOacgOaWsOeahOe7k+aenOOAglxuICAgICAqL1xuICAgIGZvciAoY29uc3QgaW5zZXJ0Um9vdCBvZiBhbGxJbnNlcnRzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChpbnNlcnRSb290KSB8fCBfLmlzRW1wdHkoaW5zZXJ0Um9vdCkpIGNvbnRpbnVlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdXBkYXRlRXJhU3RhdERhdGEoc3RhdCA9PiB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgYOWkhOeQhiBpbnNlcnRSb290OiAke0pTT04uc3RyaW5naWZ5KGluc2VydFJvb3QpfWApO1xuICAgICAgICAgIC8vIOS7juaguei3r+W+hCAnJyDlvIDlp4vnu5/kuIDpgJLlvZLlhaXlj6PvvIzpobblsYLosIPnlKjml7bvvIzniLboioLngrnkuLogbnVsbFxuICAgICAgICAgIGFwcGx5SW5zZXJ0QXRMZXZlbChzdGF0LCAnJywgaW5zZXJ0Um9vdCwgZWRpdExvZywgbnVsbCwgbnVsbCk7XG4gICAgICAgICAgcmV0dXJuIHN0YXQ7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcigncHJvY2Vzc0luc2VydEJsb2NrcycsIGDlpITnkIYgaW5zZXJ0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzSW5zZXJ0QmxvY2tzJywgJ+aJgOaciSBWYXJpYWJsZUluc2VydCDmk43kvZzlrozmiJAnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/insert.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/insert/template.ts": 
  /*!**************************************************!*\
  !*** ./src/ERA变量框架/core/crud/insert/template.ts ***!
  \**************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyTemplateToPatch: () => (/* binding */ applyTemplateToPatch),\n/* harmony export */   getInheritedTemplateContent: () => (/* binding */ getInheritedTemplateContent),\n/* harmony export */   resolveTemplate: () => (/* binding */ resolveTemplate)\n/* harmony export */ });\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/data */ "./src/ERA变量框架/utils/data.ts");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/log */ "./src/ERA变量框架/utils/log.ts");\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger(\'core-crud-insert-template\');\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nfunction resolveTemplate(inheritedContent, parentNodeData) {\n    // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n    const varsContent = _.get(parentNodeData, \'$template\');\n    logger.debug(\'resolveTemplate\', `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(varsContent)}`);\n    // 2. 按优先级合并 (父节点变量 > 继承)\n    let mergedContent = {};\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, inheritedContent);\n    mergedContent = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, varsContent);\n    logger.debug(\'resolveTemplate\', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n    if (_.isEmpty(mergedContent)) {\n        return null;\n    }\n    return mergedContent;\n}\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   "$template": { "hp": 10, "mana": 100, "a": { "d": 1 } },\n *   "lili": { "hp": 15, "class": "warrior", "a": { "c": 1 } }\n * };\n * const key = "lili";\n * // 输出 (合并后的内容):\n * // { "hp": 15, "mana": 100, "class": "warrior", "a": { "c": 1, "d": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nfunction getInheritedTemplateContent(parentTplContent, key) {\n    if (!parentTplContent)\n        return undefined;\n    // 步骤 1: 在父级模板内容中查找通用的原型规则\n    const prototypeContent = _.get(parentTplContent, \'$template\');\n    // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n    const specificContent = _.get(parentTplContent, key);\n    // 步骤 3: 根据查找结果决定最终模板内容\n    if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(prototypeContent)}\\n      - 特异性: ${JSON.stringify(specificContent)}`);\n        // 直接使用 mergeReplaceArray 进行合并\n        const merged = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(prototypeContent), specificContent);\n        logger.debug(\'getInheritedTemplateContent\', `  - 合并后: ${JSON.stringify(merged)}`);\n        return merged;\n    }\n    else if (_.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到特异性内容: ${JSON.stringify(specificContent)}`);\n        return specificContent;\n    }\n    else if (_.isPlainObject(prototypeContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到原型内容: ${JSON.stringify(prototypeContent)}`);\n        return prototypeContent;\n    }\n    logger.debug(\'getInheritedTemplateContent\', `在父级模板内容中未为子节点 "${key}" 找到任何可继承的规则。`);\n    return undefined;\n}\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nfunction applyTemplateToPatch(tplContent, patchObj) {\n    logger.debug(\'applyTemplateToPatch\', `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`);\n    if (!_.isPlainObject(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 补丁不是一个普通对象，直接返回。`);\n        return patchObj;\n    }\n    if (!tplContent) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 模板内容无效，直接返回补丁。`);\n        return patchObj;\n    }\n    // 如果补丁是空对象，直接使用模板内容\n    if (_.isEmpty(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `补丁为空对象，完全使用模板内容。`);\n        return _.cloneDeep(tplContent);\n    }\n    // 如果补丁非空，将模板内容作为默认值与补丁合并\n    const composed = (0,_utils_data__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(tplContent), patchObj);\n    logger.debug(\'applyTemplateToPatch\', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n    return composed;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvdGVtcGxhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBYTtBQUUyQztBQUNaO0FBRTVDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBRXZEOzs7Ozs7OztHQVFHO0FBQ0ksU0FBUyxlQUFlLENBQUMsZ0JBQXFCLEVBQUUsY0FBbUI7SUFDeEUsbUNBQW1DO0lBQ25DLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRXZELE1BQU0sQ0FBQyxLQUFLLENBQ1YsaUJBQWlCLEVBQ2pCLHdCQUF3QixJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUN0RixXQUFXLENBQ1osRUFBRSxDQUNKLENBQUM7SUFFRix5QkFBeUI7SUFDekIsSUFBSSxhQUFhLEdBQVEsRUFBRSxDQUFDO0lBQzVCLGFBQWEsR0FBRyw4REFBaUIsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUNuRSxhQUFhLEdBQUcsOERBQWlCLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRTlELE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsZUFBZSxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVoRixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGFBQWEsQ0FBQztBQUN2QixDQUFDO0FBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFDSSxTQUFTLDJCQUEyQixDQUFDLGdCQUFxQixFQUFFLEdBQVc7SUFDNUUsSUFBSSxDQUFDLGdCQUFnQjtRQUFFLE9BQU8sU0FBUyxDQUFDO0lBRXhDLDBC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Q0FBQyxLQUFLLENBQUMsc0JBQXNCLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pGLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvaW5zZXJ0L3RlbXBsYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgbWVyZ2VSZXBsYWNlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2NvcmUtY3J1ZC1pbnNlcnQtdGVtcGxhdGUnKTtcblxuLyoqXG4gKiAqKuOAkOino+aekOW5tuWQiOW5tuaooeadv+WGheWuueOAkSoqXG4gKlxuICog5LuO57un5om/55qE5qih5p2/5YaF5a655ZKM54i26IqC54K55Y+Y6YeP5Lit5a6a5LmJ55qE5qih5p2/5YaF5a655Lit77yM5ZCI5bm25Ye65b2T5YmN5bGC57qn5Y+v55So55qE5qih5p2/44CCXG4gKlxuICogQHBhcmFtIGluaGVyaXRlZENvbnRlbnQgLSDku47kuIrkuIrlsYLnu6fmib/nmoTmqKHmnb/lhoXlrrnjgIJcbiAqIEBwYXJhbSBwYXJlbnROb2RlRGF0YSAtIOW9k+WJjeato+WcqOWkhOeQhueahOiKgueCueeahCAqKueItuiKgueCuSoqIOWcqOWPmOmHj+S4reeahOaVsOaNruOAglxuICogQHJldHVybnMge2FueX0gLSDlkIjlubblkI7nmoTljZXkuIDlhoXlrrnlr7nosaHvvIzlpoLmnpzmiYDmnInmnaXmupDpg73ml6DmlYjvvIzliJnov5Tlm54gYG51bGxg44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlVGVtcGxhdGUoaW5oZXJpdGVkQ29udGVudDogYW55LCBwYXJlbnROb2RlRGF0YTogYW55KTogYW55IHtcbiAgLy8gMS4g5LuO54i26IqC54K55Y+Y6YeP5Lit77yM5om+5Yiw5L2c5Li65b2T5YmN6IqC54K55YWE5byf55qEICR0ZW1wbGF0ZVxuICBjb25zdCB2YXJzQ29udGVudCA9IF8uZ2V0KHBhcmVudE5vZGVEYXRhLCAnJHRlbXBsYXRlJyk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXNvbHZlVGVtcGxhdGUnLFxuICAgIGDop6PmnpDlh7rnmoTmqKHmnb/lhoXlrrk6XFxuICAgIC0g57un5om/OiAke0pTT04uc3RyaW5naWZ5KGluaGVyaXRlZENvbnRlbnQpfVxcbiAgICAtIOeItuiKgueCueWPmOmHjzogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgIHZhcnNDb250ZW50LFxuICAgICl9YCxcbiAgKTtcblxuICAvLyAyLiDmjInkvJjlhYjnuqflkIjlubYgKOeItuiKgueCueWPmOmHjyA+IOe7p+aJvylcbiAgbGV0IG1lcmdlZENvbnRlbnQ6IGFueSA9IHt9O1xuICBtZXJnZWRDb250ZW50ID0gbWVyZ2VSZXBsYWNlQXJyYXkobWVyZ2VkQ29udGVudCwgaW5oZXJpdGVkQ29udGVudCk7XG4gIG1lcmdlZENvbnRlbnQgPSBtZXJnZVJlcGxhY2VBcnJheShtZXJnZWRDb250ZW50LCB2YXJzQ29udGVudCk7XG5cbiAgbG9nZ2VyLmRlYnVnKCdyZXNvbHZlVGVtcGxhdGUnLCBg5ZCI5bm25ZCO55qE5pyA57uI5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KG1lcmdlZENvbnRlbnQpfWApO1xuXG4gIGlmIChfLmlzRW1wdHkobWVyZ2VkQ29udGVudCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBtZXJnZWRDb250ZW50O1xufVxuXG4vKipcbiAqICoq44CQ6I635Y+W5a2Q6IqC54K56KaB57un5om/55qE5qih5p2/5YaF5a6544CRKipcbiAqXG4gKiDlnKjkuIDkuKrnu5nlrprnmoTigJzniLbnuqfmqKHmnb/lhoXlrrnigJ3kuK3vvIzmn6Xmib7lubblkIjlubblhbblhoXpg6jlrprkuYnnmoTigJzljp/lnovop4TliJnigJ0gKGAkdGVtcGxhdGVgKSDlkozigJznibnlvILmgKfop4TliJnigJ0gKGBrZXlgKe+8jFxuICog5Lul55Sf5oiQ5L6b54m55a6a5a2Q6IqC54K5IGBrZXlgIOS9v+eUqOeahOacgOe7iOaooeadv+WGheWuueOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDovpPlhaU6XG4gKiBjb25zdCBwYXJlbnRUcGxDb250ZW50ID0ge1xuICogICBcIiR0ZW1wbGF0ZVwiOiB7IFwiaHBcIjogMTAsIFwibWFuYVwiOiAxMDAsIFwiYVwiOiB7IFwiZFwiOiAxIH0gfSxcbiAqICAgXCJsaWxpXCI6IHsgXCJocFwiOiAxNSwgXCJjbGFzc1wiOiBcIndhcnJpb3JcIiwgXCJhXCI6IHsgXCJjXCI6IDEgfSB9XG4gKiB9O1xuICogY29uc3Qga2V5ID0gXCJsaWxpXCI7XG4gKiAvLyDovpPlh7ogKOWQiOW5tuWQjueahOWGheWuuSk6XG4gKiAvLyB7IFwiaHBcIjogMTUsIFwibWFuYVwiOiAxMDAsIFwiY2xhc3NcIjogXCJ3YXJyaW9yXCIsIFwiYVwiOiB7IFwiY1wiOiAxLCBcImRcIjogMSB9IH1cbiAqXG4gKiBAcGFyYW0gcGFyZW50VHBsQ29udGVudCAtIOeItue6p+eahOaooeadv+WGheWuue+8jOWug+acrOi6q+WPr+iDveWMheWQqyBgJHRlbXBsYXRlYCDlkowgYGtleWAg5L2c5Li65a2Q6ZSu44CCXG4gKiBAcGFyYW0ga2V5IC0g5q2j5Zyo5aSE55CG55qE5a2Q6IqC54K555qE6ZSu5ZCN44CCXG4gKiBAcmV0dXJucyB7YW55fSAtIOWtkOiKgueCueW6lOivpee7p+aJv+eahOOAgeW3suWQiOW5tueahOaooeadv+WGheWuue+8jOaIliBgdW5kZWZpbmVkYOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50KHBhcmVudFRwbENvbnRlbnQ6IGFueSwga2V5OiBzdHJpbmcpOiBhbnkge1xuICBpZiAoIXBhcmVudFRwbENvbnRlbnQpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgLy8g5q2l6aqkIDE6IOWcqOeItue6p+aooeadv+WGheWuueS4reafpeaJvumAmueUqOeahOWOn+Wei+inhOWImVxuICBjb25zdCBwcm90b3R5cGVDb250ZW50ID0gXy5nZXQocGFyZW50VHBsQ29udGVudCwgJyR0ZW1wbGF0ZScpO1xuXG4gIC8vIOatpemqpCAyOiDlnKjniLbnuqfmqKHmnb/lhoXlrrnkuK3mn6Xmib7nu5kga2V5IOeahOeJueW8guaAp+inhOWImVxuICBjb25zdCBzcGVjaWZpY0NvbnRlbnQgPSBfLmdldChwYXJlbnRUcGxDb250ZW50LCBrZXkpO1xuXG4gIC8vIOatpemqpCAzOiDmoLnmja7mn6Xmib7nu5PmnpzlhrPlrprmnIDnu4jmqKHmnb/lhoXlrrlcbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwcm90b3R5cGVDb250ZW50KSAmJiBfLmlzUGxhaW5PYmplY3Qoc3BlY2lmaWNDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWQjOaXtuaJvuWIsOWOn+Wei+WSjOeJueW8guaAp+WGheWuueOAglxcbiAgICAgIC0g5Y6f5Z6LOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICBwcm90b3R5cGVDb250ZW50LFxuICAgICAgKX1cXG4gICAgICAtIOeJueW8guaApzogJHtKU09OLnN0cmluZ2lmeShzcGVjaWZpY0NvbnRlbnQpfWAsXG4gICAgKTtcbiAgICAvLyDnm7TmjqXkvb/nlKggbWVyZ2VSZXBsYWNlQXJyYXkg6L+b6KGM5ZCI5bm2XG4gICAgY29uc3QgbWVyZ2VkID0gbWVyZ2VSZXBsYWNlQXJyYXkoXy5jbG9uZURlZXAocHJvdG90eXBlQ29udGVudCksIHNwZWNpZmljQ29udGVudCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBgICAtIOWQiOW5tuWQjjogJHtKU09OLnN0cmluZ2lmeShtZXJnZWQpfWApO1xuICAgIHJldHVybiBtZXJnZWQ7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHNwZWNpZmljQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDnibnlvILmgKflhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkoc3BlY2lmaWNDb250ZW50KX1gLFxuICAgICk7XG4gICAgcmV0dXJuIHNwZWNpZmljQ29udGVudDtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QocHJvdG90eXBlQ29udGVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnZ2V0SW5oZXJpdGVkVGVtcGxhdGVDb250ZW50JyxcbiAgICAgIGDkuLrlrZDoioLngrkgXCIke2tleX1cIiDlj6rmib7liLDljp/lnovlhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkocHJvdG90eXBlQ29udGVudCl9YCxcbiAgICApO1xuICAgIHJldHVybiBwcm90b3R5cGVDb250ZW50O1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLCBg5Zyo54i257qn5qih5p2/5YaF5a655Lit5pyq5Li65a2Q6IqC54K5IFwiJHtrZXl9XCIg5om+5Yiw5Lu75L2V5Y+v57un5om/55qE6KeE5YiZ44CCYCk7XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogKirjgJDlupTnlKjmqKHmnb/lhoXlrrnliLDooaXkuIHjgJEqKlxuICpcbiAqIOWwhuS4gOS4quKAnOaooeadv+WGheWuueKAneWvueixoeW6lOeUqOWIsOS4gOS4quKAnOihpeS4geKAneWvueixoeS4iu+8jOS9nOS4uuWFtum7mOiupOWAvOOAglxuICpcbiAqIEBwYXJhbSB0cGxDb250ZW50IC0g5b2T5YmN5bGC57qn5ZCI5bm25ZCO55qE5qih5p2/5YaF5a6544CCXG4gKiBAcGFyYW0gcGF0Y2hPYmogLSDopoHlupTnlKjmqKHmnb/nmoTooaXkuIHmlbDmja7jgIJcbiAqIEByZXR1cm5zIHthbnl9IC0g5bqU55So5LqG5qih5p2/6buY6K6k5YC85LmL5ZCO77yM5pyA57uI5ZCI5oiQ55qE5pWw5o2u5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRlbXBsYXRlVG9QYXRjaCh0cGxDb250ZW50OiBhbnksIHBhdGNoT2JqOiBhbnkpOiBhbnkge1xuICBsb2dnZXIuZGVidWcoXG4gICAgJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJyxcbiAgICBgW+i/m+WFpV0g5qih5p2/5YaF5a65OiAke0pTT04uc3RyaW5naWZ5KHRwbENvbnRlbnQpfSwg6KGl5LiBOiAke0pTT04uc3RyaW5naWZ5KHBhdGNoT2JqKX1gLFxuICApO1xuXG4gIGlmICghXy5pc1BsYWluT2JqZWN0KHBhdGNoT2JqKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g6KGl5LiB5LiN5piv5LiA5Liq5pmu6YCa5a+56LGh77yM55u05o6l6L+U5Zue44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG4gIGlmICghdHBsQ29udGVudCkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBgW+mAgOWHul0g5qih5p2/5YaF5a655peg5pWI77yM55u05o6l6L+U5Zue6KGl5LiB44CCYCk7XG4gICAgcmV0dXJuIHBhdGNoT2JqO1xuICB9XG5cbiAgLy8g5aaC5p6c6KGl5LiB5piv56m65a+56LGh77yM55u05o6l5L2/55So5qih5p2/5YaF5a65XG4gIGlmIChfLmlzRW1wdHkocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGDooaXkuIHkuLrnqbrlr7nosaHvvIzlrozlhajkvb/nlKjmqKHmnb/lhoXlrrnjgIJgKTtcbiAgICByZXR1cm4gXy5jbG9uZURlZXAodHBsQ29udGVudCk7XG4gIH1cblxuICAvLyDlpoLmnpzooaXkuIHpnZ7nqbrvvIzlsIbmqKHmnb/lhoXlrrnkvZzkuLrpu5jorqTlgLzkuI7ooaXkuIHlkIjlubZcbiAgY29uc3QgY29tcG9zZWQgPSBtZXJnZVJlcGxhY2VBcnJheShfLmNsb25lRGVlcCh0cGxDb250ZW50KSwgcGF0Y2hPYmopO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJywgYOWQiOW5tuaooeadv+S4juihpeS4geWQjueahOe7k+aenDogJHtKU09OLnN0cmluZ2lmeShjb21wb3NlZCl9YCk7XG4gIHJldHVybiBjb21wb3NlZDtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/insert/template.ts\n\n}');
  },
  "./src/ERA变量框架/core/crud/patcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/core/crud/patcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApplyVarChange: () => (/* binding */ ApplyVarChange),\n/* harmony export */   ApplyVarChangeForMessage: () => (/* binding */ ApplyVarChangeForMessage)\n/* harmony export */ });\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./delete */ \"./src/ERA变量框架/core/crud/delete.ts\");\n/* harmony import */ var _insert_insert__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./insert/insert */ \"./src/ERA变量框架/core/crud/insert/insert.ts\");\n/* harmony import */ var _update__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./update */ \"./src/ERA变量框架/core/crud/update.ts\");\n/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_4__.Logger('core-crud-patcher');\n/**\n * **【核心实现】** 对指定的消息应用变量修改。\n * 这是变量写入流程的核心，处理单个消息。\n *\n * @param {TavernMessage} msg - 要处理的酒馆消息对象。\n * @returns {Promise<string | null>} 如果成功处理，返回该消息的 MK；如果消息无需处理或处理失败，返回 null。\n */\nconst ApplyVarChangeForMessage = async (msg) => {\n    logger.debug('ApplyVarChangeForMessage', `开始处理消息...`, { msg });\n    try {\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ApplyVarChangeForMessage', '无效消息对象或缺少 message_id，退出');\n            return null;\n        }\n        const messageId = msg.message_id;\n        // 写入函数只负责读取 MK，不负责创建。创建的职责由上游的 `ensureMessageKey` 承担。\n        const MK = (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_0__.readMessageKey)(msg);\n        // 如果消息没有 MK（可能是一个异常状态，如新消息还未被注入 MK），则跳过。\n        if (!MK) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 不含 MK，跳过变量写入。`);\n            return null;\n        }\n        // 根据设计，用户消息自身不应包含变量修改指令，因此跳过变量处理，但返回其已有的 MK。\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.isUserMessage)(msg)) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 为用户消息，跳过变量写入，但保留其 MK。`);\n            return MK;\n        }\n        const rawContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.getMessageContent)(msg) || '';\n        // 1. 从消息内容中解析出所有指令块。\n        const insertBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableInsert');\n        const editBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableEdit');\n        const deleteBlocks = (0,_utils_string__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableDelete');\n        // 调试日志：输出提取的原始块\n        //logger.debug('【ERA调试】原始指令块', insertBlocks);\n        if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 未检测到变量修改标签。`);\n        }\n        const rawInserts = insertBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        const rawEdits = editBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        const rawDeletes = deleteBlocks.flatMap(s => (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseJsonl)(s));\n        // 调试日志：输出 JSONL 解析结果\n        //logger.debug('【ERA调试】JSONL解析结果', rawInserts);\n        // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n        const allInserts = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawInserts);\n        const allEdits = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawEdits);\n        const allDeletes = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.escapeEraData)(rawDeletes);\n        logger.debug('ApplyVarChangeForMessage', '数据转义完成', {\n            before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n            after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n        });\n        const editLog = []; // 用于收集本轮操作产生的所有变更记录。\n        // 2. --- 处理所有插入操作 (`<VariableInsert>`) ---\n        await (0,_insert_insert__WEBPACK_IMPORTED_MODULE_8__.processInsertBlocks)(allInserts, editLog);\n        // 3. --- 处理所有编辑操作 (`<VariableEdit>`) ---\n        await (0,_update__WEBPACK_IMPORTED_MODULE_9__.processEditBlocks)(allEdits, editLog, messageId);\n        // 4. --- 处理所有删除操作 (`<VariableDelete>`) ---\n        await (0,_delete__WEBPACK_IMPORTED_MODULE_7__.processDeleteBlocks)(allDeletes, editLog);\n        // 5. --- 覆盖式写入 EditLog ---\n        /*\n         * 核心逻辑：无论本轮是否产生了有效的变量修改，都必须用当前的 editLog (哪怕是空数组) 覆盖旧的 EditLog。\n         *\n         * 为什么必须覆盖而不是在没有修改时跳过？\n         *\n         * 根本原因在于，必须确保每个 MK 对应的 EditLog，严格且唯一地反映其所属消息**当前内容**所产生的变量修改。\n         *\n         * 考虑一个场景：\n         * 1. 消息A (MK_A) 的内容包含指令，生成了 EditLog_A。\n         * 2. 用户对消息A进行 swipe，生成了消息B (MK_B)，其内容完全没有变量修改标签。\n         *\n         * 如果在处理消息B时，因为没有检测到指令就“跳过写入”，那么与 MK_B 关联的 EditLog 就会是空的或不存在的。\n         * 这在当前是正确的。\n         *\n         * 但如果用户再次 swipe，从消息B切换回消息A。此时框架会重新处理消息A。\n         * 如果我们不执行覆盖式写入，那么与 MK_A 关联的 EditLog 仍然是之前生成的 EditLog_A，这没有问题。\n         *\n         * 真正的问题在于状态的明确性。覆盖式写入确保了任何一个 MK 的日志，在任何时间点，\n         * 都是其**当前可见内容**的直接产物，没有任何历史遗留。这使得整个系统的状态变迁变得清晰、可预测，\n         * 极大地降低了在复杂操作（如多次 `swipe`、删除、编辑）中出现状态不一致的风险。\n         *\n         * 因此，正确的做法是：用本次解析消息内容生成的 editLog (在无指令的场景下是 `[]`) 去覆盖，\n         * 从而斩断任何可能存在的历史关联，确保数据的一致性和纯粹性。\n         */\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n                const newArr = Array.isArray(editLog) ? editLog : (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.parseEditLog)(editLog);\n                logger.debug('ApplyVarChangeForMessage', `准备为 MK=${MK} (MsgID=${messageId}) 写入 EditLog:\\n${JSON.stringify(newArr, null, 2)}`);\n                // 将本轮生成的日志数组，以当前消息的 MK 为键，存入 `EditLogs` 对象。\n                _.set(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_1__.LOGS_PATH, MK], JSON.stringify(newArr));\n                /*\n                 * N.B. 此函数不再负责更新 SelectedMks 数组。\n                 * 更新 SelectedMks 的职责已移交至上层调用者 (resyncStateOnHistoryChange 或 ApplyVarChange)，\n                 * 以避免在 resync 循环中意外修改正在被读取的 oldSelectedMks 状态。\n                 */\n                return meta;\n            });\n            logger.debug('ApplyVarChangeForMessage', `成功为 MK=${MK} 写入 EditLog。`);\n        }\n        catch (e) {\n            logger.error('ApplyVarChangeForMessage', `为 MK=${MK} 写入 EditLogs 失败: ${e?.message || e}`, e);\n        }\n        return MK;\n    }\n    catch (err) {\n        logger.error('ApplyVarChangeForMessage', `变量写入器异常: ${err?.message || err}`, err);\n        return null;\n    }\n};\n/**\n * **【标准事件处理入口】**\n * 这是一个上层封装，用于处理最新 AI 消息的变量写入，并负责更新 `SelectedMks` 数组。\n * 它会自动寻找最后一条 AI 消息进行操作，通常被绑定到“新消息生成”等事件上。\n */\nconst ApplyVarChange = async () => {\n    logger.debug('ApplyVarChange', `函数被调用...`);\n    // 1. 智能查找最后一条 AI 消息\n    const msg = (0,_utils_message__WEBPACK_IMPORTED_MODULE_5__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.log('ApplyVarChange', '未找到可处理的 AI 消息，退出。');\n        return;\n    }\n    const messageId = msg.message_id;\n    logger.log('ApplyVarChange', `找到目标 AI 消息 (ID: ${messageId})，开始处理变量写入...`);\n    // 2. 调用核心实现来处理变量和 EditLog 的写入。\n    // EditLog 会被自动关联到从该消息中读取到的 MK 上。\n    const MK = await ApplyVarChangeForMessage(msg);\n    // 3. 在核心流程执行完毕后，在此处统一更新 SelectedMks，确保状态一致。\n    try {\n        await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n            const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, []);\n            // 关键：必须使用我们正在处理的 AI 消息的 messageId 作为索引，\n            // 来更新 SelectedMks 数组中对应的 MK 记录。\n            selectedMks[messageId] = MK;\n            _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, selectedMks);\n            return meta;\n        });\n    }\n    catch (e) {\n        logger.error('ApplyVarChange', `更新 SelectedMks 失败: ${e?.message || e}`, e);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9wYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBRVU7QUFFc0M7QUFDUztBQUNlO0FBQ2xCO0FBQ2hCO0FBQ2lEO0FBQ3ZDO0FBQ0o7QUFDTztBQUNUO0FBRTdDLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBRS9DOzs7Ozs7R0FNRztBQUNJLE1BQU0sd0JBQXdCLEdBQUcsS0FBSyxFQUFFLEdBQVEsRUFBMEIsRUFBRTtJQUNqRixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1lBQ25FLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7UUFDakMsc0RBQXNEO1FBQ3RELE1BQU0sRUFBRSxHQUFHLDREQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFL0IseUNBQXlDO1FBQ3pDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNSLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLGlCQUFpQixDQUFDLENBQUM7WUFDaEYsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksNkRBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsV0FBVyxTQUFTLHlCQUF5QixDQUFDLENBQUM7WUFDeEYsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDO1FBRUQsTUFBTSxVQUFVLEdBQUcsaUVBQWlCLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRWhELHFCQUFxQjtRQUNyQixNQUFNLFlBQVksR0FBRyw0REFBYSxDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2pFLE1BQU0sVUFBVSxHQUFHLDREQUFhLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sWUFBWSxHQUFHLDREQUFhLENBQUMsVUFBVSxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFFakUsZ0JBQWdCO1FBQ2hCLDZDQUE2QztRQUU3QyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDdkUsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxXQUFXLFNBQVMsZUFBZSxDQUFDLENBQUM7UUFDaEYsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyx1REFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUQsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLHVEQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RCxNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsdURBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVELHFCQUFxQjtRQUNyQiwrQ0FBK0M7UUFFL0MsMENBQTBDO1FBQzFDLE1BQU0sVUFBVSxHQUFHLDBEQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0MsTUFBTSxRQUFRLEdBQUcsMERBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QyxNQUFNLFVBQVUsR0FBRywwREFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTdDLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLEVBQUUsUUFBUSxFQUFFO1lBQ2pELE1BQU0sRUFBRSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFO1lBQ3JFLEtBQUssRUFBRSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFO1NBQ3JFLENBQUMsQ0FBQztRQUVILE1BQU0sT0FBTyxHQUFVLEVBQUUsQ0FBQyxDQUFDLHFCQUFxQjtRQUVoRCwyQ0FBMkM7UUFDM0MsTUFBTSxtRUFBbUIsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFL0MseUNBQXlDO1FBQ3pDLE1BQU0sMERBQWlCLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztRQUV0RCwyQ0FBMkM7UUFDM0MsTUFBTSw0REFBbUIsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFL0MsMkJBQTJCO1FBQzNCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQXVCRztRQUNILElBQUksQ0FBQztZQUNILE1BQU0sa0VBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMseURBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDeEUsTUFBTSxDQUFDLEtBQUssQ0FDViwwQkFBMEIsRUFDMUIsVUFBVSxFQUFFLFdBQVcsU0FBUyxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQ3BGLENBQUM7Z0JBQ0YsNENBQTRDO2dCQUM1QyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLHVEQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNyRDs7OzttQkFJRztnQkFDSCxPQUFPLElBQUksQ0FBQztZQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxVQUFVLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDdkUsQ0FBQztRQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxRQUFRLEVBQUUsb0JBQW9CLENBQUMsRUFBRSxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0YsQ0FBQztRQUVELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxZQUFZLEdBQUcsRUFBRSxPQUFPLElBQUksR0FBRyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDakYsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBRUY7Ozs7R0FJRztBQUNJLE1BQU0sY0FBYyxHQUFHLEtBQUssSUFBSSxFQUFFO0lBQ3ZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDM0Msb0JBQW9CO0lBQ3BCLE1BQU0sR0FBRyxHQUFHLGlFQUFpQixFQUFFLENBQUM7SUFDaEMsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDL0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2xELE9BQU87SUFDVCxDQUFDO0lBRUQsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQztJQUNqQyxNQUFNLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLG1CQUFtQixTQUFTLGVBQWUsQ0FBQyxDQUFDO0lBRTFFLCtCQUErQjtJQUMvQixpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEdBQUcsTUFBTSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUvQyw0Q0FBNEM7SUFDNUMsSUFBSSxDQUFDO1FBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlDLHdDQUF3QztZQUN4QyxnQ0FBZ0M7WUFDaEMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ25DLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztRQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLHNCQUFzQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL2NydWQvcGF0Y2hlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/lhpnlhaXmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTigJzmiafooYzlvJXmk47igJ3vvIzotJ/otKPlsIbmtojmga/lhoXlrrnkuK3nmoTlj5jph4/kv67mlLnmjIfku6TlupTnlKjliLDlrp7pmYXnmoQgYGNoYXRgIOWPmOmHj+S4reOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiDlj5jph4/nmoTlhpnlhaXmmK/kuIDkuKrkuKXosKjnmoTov4fnqIvvvIzlv4Xpobvnoa7kv53miYDmnInlj5jmm7Tpg73ooqvmraPnoa7orrDlvZXvvIzku6Xkvr/lkI7nu63nmoTlm57mu5rlkozlkIzmraXjgIJcbiAqIOatpOaooeWdl+eahOaguOW/g+iBjOi0o+aYr++8mlxuICogMS4gKirop6PmnpDmjIfku6QqKjog5LuOIEFJIOa2iOaBr+S4reaPkOWPliBgPFZhcmlhYmxlSW5zZXJ0PmAg5ZKMIGA8VmFyaWFibGVFZGl0PmAg5Z2X44CCXG4gKiAyLiAqKumhuuW6j+aJp+ihjCoqOiDnoa7kv53lkIzkuIDmtojmga/lhoXnmoTlpJrkuKrmjIfku6TlnZfmjInpobrluo/miafooYzvvIzkuJTlkI7nu63mjIfku6Tog73mhJ/nn6XliLDliY3pnaLmjIfku6TnmoTnu5PmnpzjgIJcbiAqIDMuICoq55Sf5oiQ5pel5b+XKio6IOWcqOW6lOeUqOWPmOabtOeahOWQjOaXtu+8jOiwg+eUqCBgcmVjdXJzaXZlLnRzYCDkuK3nmoTpgJLlvZLlh73mlbDmnaXnlJ/miJDnsr7noa7nmoQgYEVkaXRMb2dg44CCXG4gKiA0LiAqKuimhuebluW8j+aXpeW/l+WGmeWFpSoqOiDnoa7kv53mr4/kuKrmtojmga/lr4bpkqXvvIhNS++8ieWvueW6lOeahCBgRWRpdExvZ2Ag5Lil5qC85Y+N5pig5YW25b2T5YmN5YaF5a6577yMXG4gKiAgICDljbPkvb/lhoXlrrnkuK3msqHmnInku7vkvZXmjIfku6TvvIjmraTml7bkvJrlhpnlhaXnqbrml6Xlv5fvvInvvIzkuZ/opoHopobnm5bml6fml6Xlv5fvvIzov5nmmK/pmLLmraIgYHN3aXBlYCDpgKDmiJDmlbDmja7msaHmn5PnmoTlhbPplK7jgIJcbiAqXG4gKiAqKuiBjOi0o+i+ueeVjCoqOlxuICogLSDmnKzmqKHlnZcqKuWPqui0n+i0o+ivu+WPliBNSyoq77yM5LiN6LSf6LSj5Yib5bu644CC5Yib5bu6IE1LIOeahOiBjOi0o+eUseS4iua4uOeahCBgbWVzc2FnZV9rZXkudHNgIOaJv+aLheOAglxuICogLSBgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlYCDlh73mlbAqKuWPqui0n+i0o+WGmeWFpeWPmOmHj+WSjCBgRWRpdExvZ2AqKu+8jOS4jei0n+i0o+abtOaWsCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAgIOabtOaWsCBgU2VsZWN0ZWRNa3NgIOeahOiBjOi0o+iiq+enu+S6pOe7meS6huabtOS4iuWxgueahOiwg+eUqOiAhe+8iOWmgiBgQXBwbHlWYXJDaGFuZ2VgIOaIluWQjOatpeWHveaVsO+8ie+8jFxuICogICDku6Xpgb/lhY3lnKjlkIzmraXlvqrnjq/kuK3kv67mlLnmraPlnKjooqvor7vlj5bnmoTnirbmgIHvvIzov5nmmK/kuIDnp43ph43opoHnmoTlubblj5HmjqfliLbnrZbnlaXjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IHJlYWRNZXNzYWdlS2V5IH0gZnJvbSAnLi4vLi4vY29yZS9rZXkvbWsnO1xuaW1wb3J0IHsgTE9HU19QQVRILCBTRUxfUEFUSCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBlc2NhcGVFcmFEYXRhLCBwYXJzZUVkaXRMb2csIHBhcnNlSnNvbmwgfSBmcm9tICcuLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IHVwZGF0ZUVyYU1ldGFEYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uLy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgZXh0cmFjdEJsb2NrcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBwcm9jZXNzRGVsZXRlQmxvY2tzIH0gZnJvbSAnLi9kZWxldGUnO1xuaW1wb3J0IHsgcHJvY2Vzc0luc2VydEJsb2NrcyB9IGZyb20gJy4vaW5zZXJ0L2luc2VydCc7XG5pbXBvcnQgeyBwcm9jZXNzRWRpdEJsb2NrcyB9IGZyb20gJy4vdXBkYXRlJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1jcnVkLXBhdGNoZXInKTtcblxuLyoqXG4gKiAqKuOAkOaguOW/g+WunueOsOOAkSoqIOWvueaMh+WumueahOa2iOaBr+W6lOeUqOWPmOmHj+S/ruaUueOAglxuICog6L+Z5piv5Y+Y6YeP5YaZ5YWl5rWB56iL55qE5qC45b+D77yM5aSE55CG5Y2V5Liq5raI5oGv44CCXG4gKlxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDopoHlpITnkIbnmoTphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZyB8IG51bGw+fSDlpoLmnpzmiJDlip/lpITnkIbvvIzov5Tlm57or6Xmtojmga/nmoQgTUvvvJvlpoLmnpzmtojmga/ml6DpnIDlpITnkIbmiJblpITnkIblpLHotKXvvIzov5Tlm54gbnVsbOOAglxuICovXG5leHBvcnQgY29uc3QgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlID0gYXN5bmMgKG1zZzogYW55KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiA9PiB7XG4gIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOW8gOWni+WkhOeQhua2iOaBry4uLmAsIHsgbXNnIH0pO1xuICB0cnkge1xuICAgIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCAn5peg5pWI5raI5oGv5a+56LGh5oiW57y65bCRIG1lc3NhZ2VfaWTvvIzpgIDlh7onKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuICAgIC8vIOWGmeWFpeWHveaVsOWPqui0n+i0o+ivu+WPliBNS++8jOS4jei0n+i0o+WIm+W7uuOAguWIm+W7uueahOiBjOi0o+eUseS4iua4uOeahCBgZW5zdXJlTWVzc2FnZUtleWAg5om/5ouF44CCXG4gICAgY29uc3QgTUsgPSByZWFkTWVzc2FnZUtleShtc2cpO1xuXG4gICAgLy8g5aaC5p6c5raI5oGv5rKh5pyJIE1L77yI5Y+v6IO95piv5LiA5Liq5byC5bi454q25oCB77yM5aaC5paw5raI5oGv6L+Y5pyq6KKr5rOo5YWlIE1L77yJ77yM5YiZ6Lez6L+H44CCXG4gICAgaWYgKCFNSykge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5raI5oGvIChJRDogJHttZXNzYWdlSWR9KSDkuI3lkKsgTUvvvIzot7Pov4flj5jph4/lhpnlhaXjgIJgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIOagueaNruiuvuiuoe+8jOeUqOaIt+a2iOaBr+iHqui6q+S4jeW6lOWMheWQq+WPmOmHj+S/ruaUueaMh+S7pO+8jOWboOatpOi3s+i/h+WPmOmHj+WkhOeQhu+8jOS9hui/lOWbnuWFtuW3suacieeahCBNS+OAglxuICAgIGlmIChpc1VzZXJNZXNzYWdlKG1zZykpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5Li655So5oi35raI5oGv77yM6Lez6L+H5Y+Y6YeP5YaZ5YWl77yM5L2G5L+d55WZ5YW2IE1L44CCYCk7XG4gICAgICByZXR1cm4gTUs7XG4gICAgfVxuXG4gICAgY29uc3QgcmF3Q29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KG1zZykgfHwgJyc7XG5cbiAgICAvLyAxLiDku47mtojmga/lhoXlrrnkuK3op6PmnpDlh7rmiYDmnInmjIfku6TlnZfjgIJcbiAgICBjb25zdCBpbnNlcnRCbG9ja3MgPSBleHRyYWN0QmxvY2tzKHJhd0NvbnRlbnQsICdWYXJpYWJsZUluc2VydCcpO1xuICAgIGNvbnN0IGVkaXRCbG9ja3MgPSBleHRyYWN0QmxvY2tzKHJhd0NvbnRlbnQsICdWYXJpYWJsZUVkaXQnKTtcbiAgICBjb25zdCBkZWxldGVCbG9ja3MgPSBleHRyYWN0QmxvY2tzKHJhd0NvbnRlbnQsICdWYXJpYWJsZURlbGV0ZScpO1xuXG4gICAgLy8g6LCD6K+V5pel5b+X77ya6L6T5Ye65o+Q5Y+W55qE5Y6f5aeL5Z2XXG4gICAgLy9sb2dnZXIuZGVidWcoJ+OAkEVSQeiwg+ivleOAkeWOn+Wni+aMh+S7pOWdlycsIGluc2VydEJsb2Nrcyk7XG5cbiAgICBpZiAoIWluc2VydEJsb2Nrcy5sZW5ndGggJiYgIWVkaXRCbG9ja3MubGVuZ3RoICYmICFkZWxldGVCbG9ja3MubGVuZ3RoKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOacquajgOa1i+WIsOWPmOmHj+S/ruaUueagh+etvuOAgmApO1xuICAgIH1cblxuICAgIGNvbnN0IHJhd0luc2VydHMgPSBpbnNlcnRCbG9ja3MuZmxhdE1hcChzID0+IHBhcnNlSnNvbmwocykpO1xuICAgIGNvbnN0IHJhd0VkaXRzID0gZWRpdEJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG4gICAgY29uc3QgcmF3RGVsZXRlcyA9IGRlbGV0ZUJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzKSk7XG5cbiAgICAvLyDosIPor5Xml6Xlv5fvvJrovpPlh7ogSlNPTkwg6Kej5p6Q57uT5p6cXG4gICAgLy9sb2dnZXIuZGVidWcoJ+OAkEVSQeiwg+ivleOAkUpTT05M6Kej5p6Q57uT5p6cJywgcmF3SW5zZXJ0cyk7XG5cbiAgICAvLyDlnKjov5nph4zlr7nku47mtojmga/kuK3op6PmnpDlh7rnmoTljp/lp4vmlbDmja7ov5vooYzovazkuYnvvIznoa7kv53miYDmnInlkI7nu63lpITnkIbpg73kvb/nlKjovazkuYnlkI7nmoTmlbDmja7jgIJcbiAgICBjb25zdCBhbGxJbnNlcnRzID0gZXNjYXBlRXJhRGF0YShyYXdJbnNlcnRzKTtcbiAgICBjb25zdCBhbGxFZGl0cyA9IGVzY2FwZUVyYURhdGEocmF3RWRpdHMpO1xuICAgIGNvbnN0IGFsbERlbGV0ZXMgPSBlc2NhcGVFcmFEYXRhKHJhd0RlbGV0ZXMpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCAn5pWw5o2u6L2s5LmJ5a6M5oiQJywge1xuICAgICAgYmVmb3JlOiB7IGluc2VydHM6IHJhd0luc2VydHMsIGVkaXRzOiByYXdFZGl0cywgZGVsZXRlczogcmF3RGVsZXRlcyB9LFxuICAgICAgYWZ0ZXI6IHsgaW5zZXJ0czogYWxsSW5zZXJ0cywgZWRpdHM6IGFsbEVkaXRzLCBkZWxldGVzOiBhbGxEZWxldGVzIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBlZGl0TG9nOiBhbnlbXSA9IFtdOyAvLyDnlKjkuo7mlLbpm4bmnKzova7mk43kvZzkuqfnlJ/nmoTmiYDmnInlj5jmm7TorrDlvZXjgIJcblxuICAgIC8vIDIuIC0tLSDlpITnkIbmiYDmnInmj5LlhaXmk43kvZwgKGA8VmFyaWFibGVJbnNlcnQ+YCkgLS0tXG4gICAgYXdhaXQgcHJvY2Vzc0luc2VydEJsb2NrcyhhbGxJbnNlcnRzLCBlZGl0TG9nKTtcblxuICAgIC8vIDMuIC0tLSDlpITnkIbmiYDmnInnvJbovpHmk43kvZwgKGA8VmFyaWFibGVFZGl0PmApIC0tLVxuICAgIGF3YWl0IHByb2Nlc3NFZGl0QmxvY2tzKGFsbEVkaXRzLCBlZGl0TG9nLCBtZXNzYWdlSWQpO1xuXG4gICAgLy8gNC4gLS0tIOWkhOeQhuaJgOacieWIoOmZpOaTjeS9nCAoYDxWYXJpYWJsZURlbGV0ZT5gKSAtLS1cbiAgICBhd2FpdCBwcm9jZXNzRGVsZXRlQmxvY2tzKGFsbERlbGV0ZXMsIGVkaXRMb2cpO1xuXG4gICAgLy8gNS4gLS0tIOimhuebluW8j+WGmeWFpSBFZGl0TG9nIC0tLVxuICAgIC8qXG4gICAgICog5qC45b+D6YC76L6R77ya5peg6K665pys6L2u5piv5ZCm5Lqn55Sf5LqG5pyJ5pWI55qE5Y+Y6YeP5L+u5pS577yM6YO95b+F6aG755So5b2T5YmN55qEIGVkaXRMb2cgKOWTquaAleaYr+epuuaVsOe7hCkg6KaG55uW5pen55qEIEVkaXRMb2fjgIJcbiAgICAgKlxuICAgICAqIOS4uuS7gOS5iOW/hemhu+imhuebluiAjOS4jeaYr+WcqOayoeacieS/ruaUueaXtui3s+i/h++8n1xuICAgICAqXG4gICAgICog5qC55pys5Y6f5Zug5Zyo5LqO77yM5b+F6aG756Gu5L+d5q+P5LiqIE1LIOWvueW6lOeahCBFZGl0TG9n77yM5Lil5qC85LiU5ZSv5LiA5Zyw5Y+N5pig5YW25omA5bGe5raI5oGvKirlvZPliY3lhoXlrrkqKuaJgOS6p+eUn+eahOWPmOmHj+S/ruaUueOAglxuICAgICAqXG4gICAgICog6ICD6JmR5LiA5Liq5Zy65pmv77yaXG4gICAgICogMS4g5raI5oGvQSAoTUtfQSkg55qE5YaF5a655YyF5ZCr5oyH5Luk77yM55Sf5oiQ5LqGIEVkaXRMb2dfQeOAglxuICAgICAqIDIuIOeUqOaIt+Wvuea2iOaBr0Hov5vooYwgc3dpcGXvvIznlJ/miJDkuobmtojmga9CIChNS19CKe+8jOWFtuWGheWuueWujOWFqOayoeacieWPmOmHj+S/ruaUueagh+etvuOAglxuICAgICAqXG4gICAgICog5aaC5p6c5Zyo5aSE55CG5raI5oGvQuaXtu+8jOWboOS4uuayoeacieajgOa1i+WIsOaMh+S7pOWwseKAnOi3s+i/h+WGmeWFpeKAne+8jOmCo+S5iOS4jiBNS19CIOWFs+iBlOeahCBFZGl0TG9nIOWwseS8muaYr+epuueahOaIluS4jeWtmOWcqOeahOOAglxuICAgICAqIOi/meWcqOW9k+WJjeaYr+ato+ehrueahOOAglxuICAgICAqXG4gICAgICog5L2G5aaC5p6c55So5oi35YaN5qyhIHN3aXBl77yM5LuO5raI5oGvQuWIh+aNouWbnua2iOaBr0HjgILmraTml7bmoYbmnrbkvJrph43mlrDlpITnkIbmtojmga9B44CCXG4gICAgICog5aaC5p6c5oiR5Lus5LiN5omn6KGM6KaG55uW5byP5YaZ5YWl77yM6YKj5LmI5LiOIE1LX0Eg5YWz6IGU55qEIEVkaXRMb2cg5LuN54S25piv5LmL5YmN55Sf5oiQ55qEIEVkaXRMb2dfQe+8jOi/meayoeaciemXrumimOOAglxuICAgICAqXG4gICAgICog55yf5q2j55qE6Zeu6aKY5Zyo5LqO54q25oCB55qE5piO56Gu5oCn44CC6KaG55uW5byP5YaZ5YWl56Gu5L+d5LqG5Lu75L2V5LiA5LiqIE1LIOeahOaXpeW/l++8jOWcqOS7u+S9leaXtumXtOeCue+8jFxuICAgICAqIOmDveaYr+WFtioq5b2T5YmN5Y+v6KeB5YaF5a65KirnmoTnm7TmjqXkuqfnianvvIzmsqHmnInku7vkvZXljoblj7LpgZfnlZnjgILov5nkvb/lvpfmlbTkuKrns7vnu5/nmoTnirbmgIHlj5jov4Hlj5jlvpfmuIXmmbDjgIHlj6/pooTmtYvvvIxcbiAgICAgKiDmnoHlpKflnLDpmY3kvY7kuoblnKjlpI3mnYLmk43kvZzvvIjlpoLlpJrmrKEgYHN3aXBlYOOAgeWIoOmZpOOAgee8lui+ke+8ieS4reWHuueOsOeKtuaAgeS4jeS4gOiHtOeahOmjjumZqeOAglxuICAgICAqXG4gICAgICog5Zug5q2k77yM5q2j56Gu55qE5YGa5rOV5piv77ya55So5pys5qyh6Kej5p6Q5raI5oGv5YaF5a6555Sf5oiQ55qEIGVkaXRMb2cgKOWcqOaXoOaMh+S7pOeahOWcuuaZr+S4i+aYryBgW11gKSDljrvopobnm5bvvIxcbiAgICAgKiDku47ogIzmlqnmlq3ku7vkvZXlj6/og73lrZjlnKjnmoTljoblj7LlhbPogZTvvIznoa7kv53mlbDmja7nmoTkuIDoh7TmgKflkoznuq/nsrnmgKfjgIJcbiAgICAgKi9cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0FyciA9IEFycmF5LmlzQXJyYXkoZWRpdExvZykgPyBlZGl0TG9nIDogcGFyc2VFZGl0TG9nKGVkaXRMb2cpO1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsXG4gICAgICAgICAgYOWHhuWkh+S4uiBNSz0ke01LfSAoTXNnSUQ9JHttZXNzYWdlSWR9KSDlhpnlhaUgRWRpdExvZzpcXG4ke0pTT04uc3RyaW5naWZ5KG5ld0FyciwgbnVsbCwgMil9YCxcbiAgICAgICAgKTtcbiAgICAgICAgLy8g5bCG5pys6L2u55Sf5oiQ55qE5pel5b+X5pWw57uE77yM5Lul5b2T5YmN5raI5oGv55qEIE1LIOS4uumUru+8jOWtmOWFpSBgRWRpdExvZ3NgIOWvueixoeOAglxuICAgICAgICBfLnNldChtZXRhLCBbTE9HU19QQVRILCBNS10sIEpTT04uc3RyaW5naWZ5KG5ld0FycikpO1xuICAgICAgICAvKlxuICAgICAgICAgKiBOLkIuIOatpOWHveaVsOS4jeWGjei0n+i0o+abtOaWsCBTZWxlY3RlZE1rcyDmlbDnu4TjgIJcbiAgICAgICAgICog5pu05pawIFNlbGVjdGVkTWtzIOeahOiBjOi0o+W3suenu+S6pOiHs+S4iuWxguiwg+eUqOiAhSAocmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2Ug5oiWIEFwcGx5VmFyQ2hhbmdlKe+8jFxuICAgICAgICAgKiDku6Xpgb/lhY3lnKggcmVzeW5jIOW+queOr+S4reaEj+WkluS/ruaUueato+WcqOiiq+ivu+WPlueahCBvbGRTZWxlY3RlZE1rcyDnirbmgIHjgIJcbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiBtZXRhO1xuICAgICAgfSk7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmiJDlip/kuLogTUs9JHtNS30g5YaZ5YWlIEVkaXRMb2fjgIJgKTtcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOS4uiBNSz0ke01LfSDlhpnlhaUgRWRpdExvZ3Mg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTUs7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5Y+Y6YeP5YaZ5YWl5Zmo5byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuLyoqXG4gKiAqKuOAkOagh+WHhuS6i+S7tuWkhOeQhuWFpeWPo+OAkSoqXG4gKiDov5nmmK/kuIDkuKrkuIrlsYLlsIHoo4XvvIznlKjkuo7lpITnkIbmnIDmlrAgQUkg5raI5oGv55qE5Y+Y6YeP5YaZ5YWl77yM5bm26LSf6LSj5pu05pawIGBTZWxlY3RlZE1rc2Ag5pWw57uE44CCXG4gKiDlroPkvJroh6rliqjlr7vmib7mnIDlkI7kuIDmnaEgQUkg5raI5oGv6L+b6KGM5pON5L2c77yM6YCa5bi46KKr57uR5a6a5Yiw4oCc5paw5raI5oGv55Sf5oiQ4oCd562J5LqL5Lu25LiK44CCXG4gKi9cbmV4cG9ydCBjb25zdCBBcHBseVZhckNoYW5nZSA9IGFzeW5jICgpID0+IHtcbiAgbG9nZ2VyLmRlYnVnKCdBcHBseVZhckNoYW5nZScsIGDlh73mlbDooqvosIPnlKguLi5gKTtcbiAgLy8gMS4g5pm66IO95p+l5om+5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr1xuICBjb25zdCBtc2cgPSBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgbG9nZ2VyLmxvZygnQXBwbHlWYXJDaGFuZ2UnLCAn5pyq5om+5Yiw5Y+v5aSE55CG55qEIEFJIOa2iOaBr++8jOmAgOWHuuOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuICBsb2dnZXIubG9nKCdBcHBseVZhckNoYW5nZScsIGDmib7liLDnm67moIcgQUkg5raI5oGvIChJRDogJHttZXNzYWdlSWR9Ke+8jOW8gOWni+WkhOeQhuWPmOmHj+WGmeWFpS4uLmApO1xuXG4gIC8vIDIuIOiwg+eUqOaguOW/g+WunueOsOadpeWkhOeQhuWPmOmHj+WSjCBFZGl0TG9nIOeahOWGmeWFpeOAglxuICAvLyBFZGl0TG9nIOS8muiiq+iHquWKqOWFs+iBlOWIsOS7juivpea2iOaBr+S4reivu+WPluWIsOeahCBNSyDkuIrjgIJcbiAgY29uc3QgTUsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcblxuICAvLyAzLiDlnKjmoLjlv4PmtYHnqIvmiafooYzlrozmr5XlkI7vvIzlnKjmraTlpITnu5/kuIDmm7TmlrAgU2VsZWN0ZWRNa3PvvIznoa7kv53nirbmgIHkuIDoh7TjgIJcbiAgdHJ5IHtcbiAgICBhd2FpdCB1cGRhdGVFcmFNZXRhRGF0YShtZXRhID0+IHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAgIC8vIOWFs+mUru+8muW/hemhu+S9v+eUqOaIkeS7rOato+WcqOWkhOeQhueahCBBSSDmtojmga/nmoQgbWVzc2FnZUlkIOS9nOS4uue0ouW8le+8jFxuICAgICAgLy8g5p2l5pu05pawIFNlbGVjdGVkTWtzIOaVsOe7hOS4reWvueW6lOeahCBNSyDorrDlvZXjgIJcbiAgICAgIHNlbGVjdGVkTWtzW21lc3NhZ2VJZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgICByZXR1cm4gbWV0YTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZScsIGDmm7TmlrAgU2VsZWN0ZWRNa3Mg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/patcher.ts\n\n}");
  },
  "./src/ERA变量框架/core/crud/update.ts": 
  /*!*****************************************!*\
  !*** ./src/ERA变量框架/core/crud/update.ts ***!
  \*****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyEditAtLevel: () => (/* binding */ applyEditAtLevel),\n/* harmony export */   processEditBlocks: () => (/* binding */ processEditBlocks)\n/* harmony export */ });\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_3__.Logger('core-crud-update');\n/**\n * **【递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {Map<string, any>} intraMessageState - 用于跟踪在**同一条消息内部**对同一变量的连续修改。\n */\nasync function applyEditAtLevel(statData, basePath, patchObj, editLog, messageId, intraMessageState) {\n    // --- 1. 路径和存在性检查 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    // --- 2. 权限检查 (`updatable`) ---\n    // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n    const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n    // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n    const isBypassingProtection = isUpdatable === false && // 当前是受保护的\n        _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n    // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n    if (isUpdatable === false && !isBypassingProtection) {\n        logger.warn('applyEditAtLevel', `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`);\n        return; // 终止此分支的递归。\n    }\n    // --- 3. 递归或执行 ---\n    // 遍历指令的键，以驱动递归。\n    for (const key of Object.keys(patchObj)) {\n        const subPath = basePath ? `${basePath}.${key}` : key;\n        const valNew = patchObj[key];\n        // **策略一：递归深入**\n        // 如果指令的值是对象，则继续向内递归。\n        if (_.isPlainObject(valNew)) {\n            await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, intraMessageState);\n            continue; // 继续处理下一个键。\n        }\n        // **策略二：执行更新 (叶子节点)**\n        // 只有当指令的值不是对象时，才执行更新操作。\n        // 路径合法性检查：确保要写入的完整路径是存在的。\n        if (!_.has(statData, subPath)) {\n            logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`);\n            continue;\n        }\n        // a. 查找旧值 (`valOld`)\n        // 这是确保回滚准确性的核心。\n        logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n        let valOld = await (0,_rollback__WEBPACK_IMPORTED_MODULE_0__.findLatestNewValue)(subPath, messageId, logger);\n        if (valOld === null) {\n            valOld = _.get(statData, subPath);\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`);\n        }\n        else {\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n        }\n        const cleaned = (0,_utils_data__WEBPACK_IMPORTED_MODULE_2__.sanitizeArrays)(valNew); // 清理新值\n        // b. 记录编辑意图\n        // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n        // 这对于调试和历史追溯非常有用。\n        _.set(statData, subPath, cleaned);\n        editLog.push({\n            op: 'update',\n            path: subPath,\n            value_old: _.cloneDeep(valOld),\n            value_new: _.cloneDeep(cleaned),\n        });\n        // c. 更新楼内状态 Map，以便同一消息内的后续操作能正确追溯到这个新值。\n        intraMessageState.set(subPath, _.cloneDeep(cleaned));\n    }\n}\n/**\n * 处理所有 `<VariableEdit>` 指令块。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n */\nasync function processEditBlocks(allEdits, editLog, messageId) {\n    if (allEdits.length > 0) {\n        const intraMessageState = new Map(); // 用于跟踪在**本消息内部**对变量的连续修改。\n        // N.B. 同样，编辑操作也需要独立调用以确保能读取到同一消息中、此前已完成的插入或编辑操作的结果。\n        for (const editRoot of allEdits) {\n            if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot))\n                continue;\n            try {\n                await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n                    logger.debug('processEditBlocks', `处理 editRoot: ${JSON.stringify(editRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n                    await applyEditAtLevel(stat, '', editRoot, editLog, messageId, intraMessageState);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processEditBlocks', '所有 VariableEdit 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC91cGRhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFDVTtBQUVvQztBQUNRO0FBQ1A7QUFDVDtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUU5Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSSxLQUFLLFVBQVUsZ0JBQWdCLENBQ3BDLFFBQWEsRUFDYixRQUFnQixFQUNoQixRQUFhLEVBQ2IsT0FBYyxFQUNkLFNBQWlCLEVBQ2pCLGlCQUFtQztJQUVuQyxzQkFBc0I7SUFDdEIsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7SUFDMUUsSUFBSSxpQkFBaUIsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLDRCQUE0QixRQUFRLElBQUksUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNwRixPQUFPO0lBQ1QsQ0FBQztJQUVELGdDQUFnQztJQUNoQywwQ0FBMEM7SUFDMUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUUzRSxzREFBc0Q7SUFDdEQsTUFBTSxxQkFBcUIsR0FDekIsV0FBVyxLQUFLLEtBQUssSUFBSSxVQUFVO1FBQ25DLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMscUJBQXFCO0lBRXpFLDRCQUE0QjtJQUM1QixJQUFJLFdBQVcsS0FBSyxLQUFLLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFD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MEI7UUFDNUUsb0RBQW9EO1FBQ3BELEtBQUssTUFBTSxRQUFRLElBQUksUUFBUSxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7Z0JBQUUsU0FBUztZQUNoRSxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxrRUFBaUIsQ0FBQyxLQUFLLEVBQUMsSUFBSSxFQUFDLEVBQUU7b0JBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUM5RSw0QkFBNEI7b0JBQzVCLE1BQU0sZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO29CQUNsRixPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO2dCQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdFLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFELENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9jcnVkL3VwZGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/nvJbovpHmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5L+u5pS577yM5bm255Sf5oiQ55So5LqO5Zue5rua55qE57K+56GuIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq6IGM6LSj5Y2V5LiAKio6IOaooeWdl+WPquWFs+W/g+WmguS9leagueaNruaMh+S7pOS/ruaUueWPmOmHj+eKtuaAgeW5tueUn+aIkOaXpeW/l++8jOS4jeWFs+W/g+aMh+S7pOS7juS9leiAjOadpeOAglxuICogLSAqKueyvuehruaXpeW/lyoqOiBgRWRpdExvZ2Ag55qE5YeG56Gu5oCn5piv5Zue5rua5Yqf6IO955qE5Z+656GA44CCYGFwcGx5RWRpdEF0TGV2ZWxgIOmAmui/h+eyvuW3p+eahOmAu+i+ke+8jFxuICogICDnibnliKvmmK/lr7nigJzml6flgLzigJ3nmoTljoblj7Lov73muq/vvIznoa7kv53kuobml6Xlv5fnmoTnu53lr7nlj6/pnaDjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V57yW6L6R5LiN5a2Y5Zyo55qE6Lev5b6E77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IGZpbmRMYXRlc3ROZXdWYWx1ZSB9IGZyb20gJy4uL3JvbGxiYWNrJztcbmltcG9ydCB7IHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXJhX2RhdGEnO1xuaW1wb3J0IHsgc2FuaXRpemVBcnJheXMgfSBmcm9tICcuLi8uLi91dGlscy9kYXRhJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL3V0aWxzL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2NvcmUtY3J1ZC11cGRhdGUnKTtcblxuLyoqXG4gKiAqKuOAkOmAkuW9kue8lui+keOAkSoqXG4gKiDlrp7njrDkuoYgYDxWYXJpYWJsZUVkaXQ+YCDnmoTmoLjlv4PpgLvovpHvvJoqKuWPquS/ruaUueW3suWtmOWcqOeahOi3r+W+hCoq44CCXG4gKlxuICogKirmoLjlv4Pop4TliJkqKjpcbiAqIDEuICoq6Lev5b6E5b+F6aG75a2Y5ZyoKirjgILlpoLmnpzmjIfku6TkuK3mjIflrprnmoTot6/lvoTlnKjlvZPliY3lj5jph4/nirbmgIHkuK3kuI3lrZjlnKjvvIzliJnot7Pov4for6Xmk43kvZzjgIJcbiAqIDIuICoq5Y+25a2Q6IqC54K55pON5L2cKirjgILlj6rlnKjpgYfliLDmjIfku6Tlr7nosaHkuK3nmoTlj7blrZDoioLngrnvvIjpnZ7lr7nosaHlgLzvvInml7bmiY3miafooYzlrp7pmYXnmoTkv67mlLnlkozml6Xlv5forrDlvZXjgIJcbiAqIDMuICoq57K+56Gu55qE5pen5YC85p+l5om+KirjgILkuLrkuobnlJ/miJDlj6/kvpvlm57mu5rnmoQgYEVkaXRMb2dg77yM5a6D6ZyA6KaB5om+5Yiw5Y+Y6YeP5Zyo5pys5qyh5L+u5pS55Y+R55SfKirkuYvliY0qKueahOKAnOaXp+WAvOKAneOAglxuICogICAg5p+l5om+6aG65bqP5Li677ya6aaW5YWI6YCa6L+HIGBmaW5kTGF0ZXN0TmV3VmFsdWVgIOWcqOWOhuWPsiBgRWRpdExvZ2Ag5Lit5Zue5rqv77yb5aaC5p6c5om+5LiN5Yiw77yMXG4gKiAgICDliJnku47lvZPliY3mtojmga/lpITnkIblvIDlp4vml7bnmoTlj5jph4/lv6vnhafkuK3ojrflj5bjgILov5nmmK/noa7kv53ml6Xlv5flh4bnoa7mgKfnmoTlhbPplK7jgIJcbiAqXG4gKiBAcGFyYW0ge2FueX0gc3RhdERhdGEgLSDnirbmgIHmlbDmja7lr7nosaEgKOWNsyBgc3RhdF9kYXRhYCnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlUGF0aCAtIOW9k+WJjemAkuW9kuWxgue6p+eahOWfuuehgOi3r+W+hOOAglxuICogQHBhcmFtIHthbnl9IHBhdGNoT2JqIC0g6KaB5bqU55So55qE6KGl5LiB5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE44CCXG4gKiBAcGFyYW0ge251bWJlcn0gbWVzc2FnZUlkIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE5raI5oGv55qEIElE77yM55So5LqO5Y6G5Y+y6L+95rqv44CCXG4gKiBAcGFyYW0ge01hcDxzdHJpbmcsIGFueT59IGludHJhTWVzc2FnZVN0YXRlIC0g55So5LqO6Lef6Liq5ZyoKirlkIzkuIDmnaHmtojmga/lhoXpg6gqKuWvueWQjOS4gOWPmOmHj+eahOi/nue7reS/ruaUueOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlFZGl0QXRMZXZlbChcbiAgc3RhdERhdGE6IGFueSxcbiAgYmFzZVBhdGg6IHN0cmluZyxcbiAgcGF0Y2hPYmo6IGFueSxcbiAgZWRpdExvZzogYW55W10sXG4gIG1lc3NhZ2VJZDogbnVtYmVyLFxuICBpbnRyYU1lc3NhZ2VTdGF0ZTogTWFwPHN0cmluZywgYW55Pixcbikge1xuICAvLyAtLS0gMS4g6Lev5b6E5ZKM5a2Y5Zyo5oCn5qOA5p+lIC0tLVxuICBjb25zdCBjdXJyZW50Tm9kZUluVmFycyA9IGJhc2VQYXRoID8gXy5nZXQoc3RhdERhdGEsIGJhc2VQYXRoKSA6IHN0YXREYXRhO1xuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseUVkaXRBdExldmVsJywgYFZhcmlhYmxlRWRpdCDot7Pov4fvvJrot6/lvoTkuI3lrZjlnKggLT4gJHtiYXNlUGF0aCB8fCAnKHJvb3QpJ31gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAtLS0gMi4g5p2D6ZmQ5qOA5p+lIChgdXBkYXRhYmxlYCkgLS0tXG4gIC8vIOivu+WPliB1cGRhdGFibGUg5qCH5b+X77yM5aaC5p6c5pyq5a6a5LmJ77yM5YiZ6buY6K6k5Li6IHRydWUgKOWFgeiuuOabtOaWsCnjgIJcbiAgY29uc3QgaXNVcGRhdGFibGUgPSBfLmdldChjdXJyZW50Tm9kZUluVmFycywgWyckbWV0YScsICd1cGRhdGFibGUnXSwgdHJ1ZSk7XG5cbiAgLy8g5a6a5LmJ6LGB5YWN5p2h5Lu277ya5Y+q5pyJ5b2T5oyH5Luk5piO56Gu6KaB5bCGIHVwZGF0YWJsZSDku44gZmFsc2Ug5pS55Li6IHRydWUg5pe277yM5omN5YWB6K645pON5L2c44CCXG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgaXNVcGRhdGFibGUgPT09IGZhbHNlICYmIC8vIOW9k+WJjeaYr+WPl+S/neaKpOeahFxuICAgIF8uZ2V0KHBhdGNoT2JqLCBbJyRtZXRhJywgJ3VwZGF0YWJsZSddKSA9PT0gdHJ1ZTsgLy8g5LiU5oyH5Luk5oSP5Zu+5piv5piO56Gu5Zyw5bCG5YW25pS55Li6IHRydWVcblxuICAvLyDlpoLmnpzlj5fkv53miqTkuJTkuI3mu6HotrPosYHlhY3mnaHku7bvvIzliJnpmLvmraLmlbTkuKrlrZDmoJHnmoTmm7TmlrDjgIJcbiAgaWYgKGlzVXBkYXRhYmxlID09PSBmYWxzZSAmJiAhaXNCeXBhc3NpbmdQcm90ZWN0aW9uKSB7XG4gICAgbG9nZ2VyLndhcm4oXG4gICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hCA8JHtiYXNlUGF0aH0+IOWPlyBcIiRtZXRhLnVwZGF0YWJsZTogZmFsc2VcIiDkv53miqTvvIzml6Dms5Xooqvkv67mlLnjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuOyAvLyDnu4jmraLmraTliIbmlK/nmoTpgJLlvZLjgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDpgJLlvZLmiJbmiafooYwgLS0tXG4gIC8vIOmBjeWOhuaMh+S7pOeahOmUru+8jOS7pempseWKqOmAkuW9kuOAglxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICBjb25zdCBzdWJQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICBjb25zdCB2YWxOZXcgPSBwYXRjaE9ialtrZXldO1xuXG4gICAgLy8gKirnrZbnlaXkuIDvvJrpgJLlvZLmt7HlhaUqKlxuICAgIC8vIOWmguaenOaMh+S7pOeahOWAvOaYr+Wvueixoe+8jOWImee7p+e7reWQkeWGhemAkuW9kuOAglxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QodmFsTmV3KSkge1xuICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0RGF0YSwgc3ViUGF0aCwgdmFsTmV3LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDnu6fnu63lpITnkIbkuIvkuIDkuKrplK7jgIJcbiAgICB9XG5cbiAgICAvLyAqKuetlueVpeS6jO+8muaJp+ihjOabtOaWsCAo5Y+25a2Q6IqC54K5KSoqXG4gICAgLy8g5Y+q5pyJ5b2T5oyH5Luk55qE5YC85LiN5piv5a+56LGh5pe277yM5omN5omn6KGM5pu05paw5pON5L2c44CCXG5cbiAgICAvLyDot6/lvoTlkIjms5XmgKfmo4Dmn6XvvJrnoa7kv53opoHlhpnlhaXnmoTlrozmlbTot6/lvoTmmK/lrZjlnKjnmoTjgIJcbiAgICBpZiAoIV8uaGFzKHN0YXREYXRhLCBzdWJQYXRoKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgVmFyaWFibGVFZGl0IOWksei0pe+8mui3r+W+hOmdnuazle+8jOaXoOazleWGmeWFpSAtPiAke3N1YlBhdGh9YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBhLiDmn6Xmib7ml6flgLwgKGB2YWxPbGRgKVxuICAgIC8vIOi/meaYr+ehruS/neWbnua7muWHhuehruaAp+eahOaguOW/g+OAglxuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDlh4blpIfkuLrot6/lvoQgPCR7c3ViUGF0aH0+IOS7jua2iOaBryBJRCA8JHttZXNzYWdlSWR9PiDlkJHkuIrov73muq8uLi5gKTtcbiAgICBsZXQgdmFsT2xkID0gYXdhaXQgZmluZExhdGVzdE5ld1ZhbHVlKHN1YlBhdGgsIG1lc3NhZ2VJZCwgbG9nZ2VyKTtcbiAgICBpZiAodmFsT2xkID09PSBudWxsKSB7XG4gICAgICB2YWxPbGQgPSBfLmdldChzdGF0RGF0YSwgc3ViUGF0aCk7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdhcHBseUVkaXRBdExldmVsJyxcbiAgICAgICAgYFvml6flgLzmn6Xmib5dIOi/vea6r+acquaJvuWIsOWOhuWPsuWAvO+8jOS7juW9k+WJjSBzdGF0X2RhdGEg5Lit6I635Y+W5Yiw5pen5YC8OiAke0pTT04uc3RyaW5naWZ5KHZhbE9sZCl9YCxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlFZGl0QXRMZXZlbCcsIGBb5pen5YC85p+l5om+XSDov73muq/miJDlip/vvIzmib7liLDljoblj7Lml6flgLw6ICR7SlNPTi5zdHJpbmdpZnkodmFsT2xkKX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGVhbmVkID0gc2FuaXRpemVBcnJheXModmFsTmV3KTsgLy8g5riF55CG5paw5YC8XG5cbiAgICAvLyBiLiDorrDlvZXnvJbovpHmhI/lm75cbiAgICAvLyDljbPkvb/mlrDml6flgLznm7jlkIzvvIzkuZ/orrDlvZUgRWRpdExvZ++8jOS7peWujOaVtOWPjeaYoOS9nOiAheeahOe8lui+keaEj+WbvuOAglxuICAgIC8vIOi/meWvueS6juiwg+ivleWSjOWOhuWPsui/vea6r+mdnuW4uOacieeUqOOAglxuICAgIF8uc2V0KHN0YXREYXRhLCBzdWJQYXRoLCBjbGVhbmVkKTtcbiAgICBlZGl0TG9nLnB1c2goe1xuICAgICAgb3A6ICd1cGRhdGUnLFxuICAgICAgcGF0aDogc3ViUGF0aCxcbiAgICAgIHZhbHVlX29sZDogXy5jbG9uZURlZXAodmFsT2xkKSxcbiAgICAgIHZhbHVlX25ldzogXy5jbG9uZURlZXAoY2xlYW5lZCksXG4gICAgfSk7XG4gICAgLy8gYy4g5pu05paw5qW85YaF54q25oCBIE1hcO+8jOS7peS+v+WQjOS4gOa2iOaBr+WGheeahOWQjue7reaTjeS9nOiDveato+ehrui/vea6r+WIsOi/meS4quaWsOWAvOOAglxuICAgIGludHJhTWVzc2FnZVN0YXRlLnNldChzdWJQYXRoLCBfLmNsb25lRGVlcChjbGVhbmVkKSk7XG4gIH1cbn1cblxuLyoqXG4gKiDlpITnkIbmiYDmnIkgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxFZGl0cyAtIOS7jua2iOaBr+S4reino+aekOWHuueahOaJgOaciSBlZGl0IOaMh+S7pOWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IG1lc3NhZ2VJZCAtIOW9k+WJjeato+WcqOWkhOeQhueahOa2iOaBr+eahCBJROOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHM6IGFueVtdLCBlZGl0TG9nOiBhbnlbXSwgbWVzc2FnZUlkOiBudW1iZXIpIHtcbiAgaWYgKGFsbEVkaXRzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBpbnRyYU1lc3NhZ2VTdGF0ZSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7IC8vIOeUqOS6jui3n+i4quWcqCoq5pys5raI5oGv5YaF6YOoKirlr7nlj5jph4/nmoTov57nu63kv67mlLnjgIJcbiAgICAvLyBOLkIuIOWQjOagt++8jOe8lui+keaTjeS9nOS5n+mcgOimgeeLrOeri+iwg+eUqOS7peehruS/neiDveivu+WPluWIsOWQjOS4gOa2iOaBr+S4reOAgeatpOWJjeW3suWujOaIkOeahOaPkuWFpeaIlue8lui+keaTjeS9nOeahOe7k+aenOOAglxuICAgIGZvciAoY29uc3QgZWRpdFJvb3Qgb2YgYWxsRWRpdHMpIHtcbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KGVkaXRSb290KSB8fCBfLmlzRW1wdHkoZWRpdFJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKGFzeW5jIHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0VkaXRCbG9ja3MnLCBg5aSE55CGIGVkaXRSb290OiAke0pTT04uc3RyaW5naWZ5KGVkaXRSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoQgJycg5byA5aeL57uf5LiA6YCS5b2S5YWl5Y+j77yM5L+d5oyB6YC76L6R5LiA6Ie05oCn44CCXG4gICAgICAgICAgYXdhaXQgYXBwbHlFZGl0QXRMZXZlbChzdGF0LCAnJywgZWRpdFJvb3QsIGVkaXRMb2csIG1lc3NhZ2VJZCwgaW50cmFNZXNzYWdlU3RhdGUpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NFZGl0QmxvY2tzJywgYOWkhOeQhiBlZGl0Um9vdCDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXIubG9nKCdwcm9jZXNzRWRpdEJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVFZGl0IOaTjeS9nOWujOaIkCcpO1xuICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/crud/update.ts\n\n}");
  },
  "./src/ERA变量框架/core/key/mk.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/core/key/mk.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureMessageKey: () => (/* binding */ ensureMessageKey),\n/* harmony export */   ensureMkForLatestMessage: () => (/* binding */ ensureMkForLatestMessage),\n/* harmony export */   readMessageKey: () => (/* binding */ readMessageKey),\n/* harmony export */   updateLatestSelectedMk: () => (/* binding */ updateLatestSelectedMk)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_string__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/string */ \"./src/ERA变量框架/utils/string.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `\x3c!-- --\x3e`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('core-key-mk');\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            return {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n        }\n        return null;\n    }\n    catch {\n        return null;\n    }\n}\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nfunction readMessageKey(msg) {\n    if (!msg)\n        return '';\n    // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n    const content = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg);\n    const mk = parseEraData(content)?.['era-message-key'] || '';\n    // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n    // 以强制 ensureMessageKey 生成新的 MK。\n    return mk;\n    /*\n     * ==================================================================\n     * 【已废弃的兼容逻辑】 - 2025/10/02\n     *\n     * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n     * 因此 MK 可能存在于任何一个 swipe 中。\n     *\n     * **废弃原因**:\n     * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n     * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n     * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n     * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n     *\n     * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n     * ==================================================================\n     */\n    // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n    // if (mkFromCurrent) {\n    //   return mkFromCurrent;\n    // }\n    // if (Array.isArray(msg.swipes)) {\n    //   for (const swipeContent of msg.swipes) {\n    //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n    //     if (mkFromSwipe) {\n    //       return mkFromSwipe;\n    //     }\n    //   }\n    // }\n    // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n    // if (mkFromMessage) {\n    //   return mkFromMessage;\n    // }\n    // return '';\n}\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nasync function ensureMessageKey(msg) {\n    if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n        logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。msg=${JSON.stringify(msg)}`);\n        return { mk: '', isNew: false };\n    }\n    // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n    const existingMk = readMessageKey(msg);\n    if (existingMk) {\n        return { mk: existingMk, isNew: false }; // 已存在，直接返回\n    }\n    // 2. 生成新的 MK 和元数据块\n    const newMk = `era_mk_${Date.now()}_${(0,_utils_string__WEBPACK_IMPORTED_MODULE_4__.rnd)()}`;\n    const messageType = msg.role === 'user' ? 'user' : 'assistant';\n    const dataString = `<${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_DATA_TAG}>`;\n    logger.log('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n    // 3. 构造新的消息内容并统一调用更新函数\n    const currentContent = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(msg) ?? '';\n    const newContent = dataString + '\\n' + currentContent;\n    // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n    await (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.updateMessageContent)(msg, newContent);\n    return { mk: newMk, isNew: true };\n}\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nconst ensureMkForLatestMessage = async () => {\n    try {\n        const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n        // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n        logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg): ${JSON.stringify(msg)}`);\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出');\n            return { mk: '', message_id: null, isNewKey: false };\n        }\n        // ensureMessageKey 会返回最终的 MK 和一个布尔值\n        const { mk, isNew } = await ensureMessageKey(msg);\n        logger.log('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n        return { mk, message_id: msg.message_id, isNewKey: isNew };\n    }\n    catch (err) {\n        logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, err);\n        return { mk: '', message_id: null, isNewKey: false };\n    }\n};\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nconst updateLatestSelectedMk = async () => {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    if (!msg || typeof msg.message_id !== 'number')\n        return;\n    // 确保 MK 存在并获取它\n    const { mk: MK } = await ensureMessageKey(msg);\n    if (!MK)\n        return;\n    // 更新 ERAMetaData 中的 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.updateEraMetaData)(meta => {\n        const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, []);\n        // 只有在记录不一致时才执行写操作，以优化性能\n        if (selectedMks[msg.message_id] !== MK) {\n            selectedMks[msg.message_id] = MK;\n            lodash__WEBPACK_IMPORTED_MODULE_0___default().set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_1__.SEL_PATH, selectedMks);\n        }\n        return meta;\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RTtJQUMvQyxNQUFNLEdBQUcsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsVUFBVSxLQUFLLFFBQVE7UUFBRSxPQUFPO0lBRXZELGVBQWU7SUFDZixNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0MsSUFBSSxDQUFDLEVBQUU7UUFBRSxPQUFPO0lBRWhCLG1DQUFtQztJQUNuQyxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzdCLE1BQU0sV0FBVyxHQUFHLGlEQUFLLENBQUMsSUFBSSxFQUFFLHNEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUMsd0JBQXdCO1FBQ3hCLElBQUksV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUN2QyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNqQyxpREFBSyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvY29yZS9rZXkvbWsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5raI5oGv5a+G6ZKlIChNSykg566h55CG5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOi/meS4quaooeWdl+aYryBFUkEg5qGG5p6255qE5Z+655+z77yM6LSf6LSj566h55CG4oCc5raI5oGv5a+G6ZKl4oCd77yITWVzc2FnZSBLZXksIE1L77yJ44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIEVSQSDnmoTmoLjlv4PkvJjlir/lnKjkuo7lhbbpsoHmo5LmgKfvvIzlroPpgJrov4flsIblj5jph4/nirbmgIHkuI4gU2lsbHlUYXZlcm4g5LiN56iz5a6a55qE5raI5oGv5Y+Y6YeP77yIbWVzc2FnZSB2YXJpYWJsZXPvvIlcbiAqIOino+iApuadpeWunueOsOi/meS4gOeCueOAgk1LIOato+aYr+WunueOsOino+iApueahOWFs+mUruOAglxuICpcbiAqIE1LIOaYr+S4gOS4queUsSAqKkVSQSDmoYbmnrboh6rouqsqKiDliqjmgIHnlJ/miJDlubYqKuazqOWFpeWIsOa2iOaBr+WGheWuueWtl+espuS4sumhtumDqCoq55qE5ZSv5LiA5qCH6K+G56ym44CCXG4gKiDlroPlsLHlg4/kuIDkuKrkuI3lj6/lj5jnmoTigJzplJrngrnigJ3vvIzpmo/mtojmga/lhoXlrrnmnKzouqvkuIDotbflrZjlnKjjgIJFUkEg55qE5omA5pyJ5qC45b+D6YC76L6R77yM5YyF5ous5Y+Y6YeP6L+96Liq44CBXG4gKiDlm57mu5rlkozlkIzmraXvvIzpg73lm7Tnu5XnnYDor4bliKvlkozmk43kvZzov5nkupvplJrngrnmnaXov5vooYzvvIzogIzkuI3mmK/kvp3otZbkuo7lj6/og73lj5HnlJ/plJnkvY3miJbooqvplJnor6/nu6fmib/nmoTmtojmga/lj5jph4/jgIJcbiAqXG4gKiAqKk1LIOagvOW8jyoqOlxuICogTUsg6KKr5YyF6KO55Zyo5LiA5Liq54us54m555qE44CB57G75Ly8IFhNTCDnmoQgYDxlcmFfZGF0YT5gIOagh+etvuS4re+8jOWFtuWGhemDqOaYr+S4gOenjSoq6Z2e5qCH5YeGKirnmoTnsbsgSlNPTiDmoLzlvI/vvIxcbiAqIOS9v+eUqCBgPWAg5L2c5Li65YiG6ZqU56ym77yM5Lul6YG/5YWN5LiOIEFJIOWPr+iDveeUn+aIkOeahOagh+WHhiBKU09OIOa3t+a3huOAglxuICogZS5nLiwgYDxlcmFfZGF0YT57XCJlcmEtbWVzc2FnZS1rZXlcIj1cImVyYV9ta18uLi5cIixcImVyYS1tZXNzYWdlLXR5cGVcIj1cInVzZXJcIn08L2VyYV9kYXRhPmBcbiAqIOi/meenjeiuvuiuoe+8iOiAjOS4jeaYr+eUqCBIVE1MIOazqOmHiiBgPCEtLSAtLT5g77yJ5piv5Li65LqG6Ziy5q2iIE1LIOiiq+WFtuS7luWPr+iDveenu+mZpOazqOmHiueahOiEmuacrOaXoOaEj+S4reegtOWdj+OAglxuICpcbiAqICoq5qC45b+D5Yqf6IO9Kio6XG4gKiAxLiAqKueUn+aIkOS4juazqOWFpSoqOiBgZW5zdXJlTWVzc2FnZUtleWAg5Ye95pWw56Gu5L+d5Lu75L2V6ZyA6KaB6L+96Liq55qE5raI5oGv6YO95oul5pyJ5LiA5LiqIE1L44CC5aaC5p6c5LiN5a2Y5Zyo77yMXG4gKiAgICDlroPkvJrnlJ/miJDkuIDkuKrmlrDnmoQgTUsg5bm25rOo5YWl5Yiw5raI5oGv5YaF5a6555qE5byA5aS044CCXG4gKiAyLiAqKuino+aekOS4juivu+WPlioqOiBgcmVhZE1lc3NhZ2VLZXlgIOWHveaVsOaPkOS+m+S6huS4gOS4quWPquivu+eahOaOpeWPo++8jOeUqOS6juS7jua2iOaBr+WGheWuueS4reino+aekOWHuiBNS+OAglxuICogMy4gKirlkIzmraXkv53pmpwqKjogYHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWtgIOetieWHveaVsOehruS/neaguOW/g+aVsOaNrue7k+aehCBgU2VsZWN0ZWRNa3NgIOS4juacgOaWsOeahFxuICogICAg5raI5oGv54q25oCB5L+d5oyB5LiA6Ie077yM5piv5qGG5p626Ieq5oSI6IO95Yqb55qE6YeN6KaB57uE5oiQ6YOo5YiG44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRVJBX0RBVEFfUkVHRVgsIEVSQV9EQVRBX1RBRywgU0VMX1BBVEggfSBmcm9tICcuLi8uLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TWVzc2FnZUNvbnRlbnQsIHVwZGF0ZU1lc3NhZ2VDb250ZW50IH0gZnJvbSAnLi4vLi4vdXRpbHMvbWVzc2FnZSc7XG5pbXBvcnQgeyB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uLy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHJuZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2cnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdjb3JlLWtleS1taycpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5YaF6YOo6L6F5Yqp5Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3op6PmnpDlh7ogYEVyYURhdGFgIOWvueixoeOAgui/meaYr+S4gOS4quWPquivu+aTjeS9nOOAglxuICogQHBhcmFtIHtzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkfSBtZXNzYWdlQ29udGVudCAtIOa2iOaBr+eahOWGheWuueWtl+espuS4suOAglxuICogQHJldHVybnMge0VyYURhdGEgfCBudWxsfSDop6PmnpDmiJDlip/liJnov5Tlm54gYEVyYURhdGFgIOWvueixoe+8jOWQpuWImei/lOWbniBudWxs44CCXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRXJhRGF0YShtZXNzYWdlQ29udGVudDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IEVyYURhdGEgfCBudWxsIHtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlQ29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKEVSQV9EQVRBX1JFR0VYKTtcbiAgaWYgKCFtYXRjaCB8fCAhbWF0Y2hbMV0pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICB0cnkge1xuICAgIC8vIOeUseS6jiBNSyDlnZflhoXpg6jmmK/oh6rlrprkuYnnmoQgYHtcImtleVwiPVwidmFsdWVcIn1gIOagvOW8j++8jOS4jeiDveS9v+eUqCBKU09OLnBhcnNl44CCXG4gICAgLy8g5b+F6aG75L2/55So5q2j5YiZ6KGo6L6+5byP6L+b6KGM5a695p2+5Yy56YWN5p2l5o+Q5Y+W6ZSu5YC844CCXG4gICAgY29uc3QgY3VzdG9tRm9ybWF0QmxvY2sgPSBtYXRjaFsxXTtcbiAgICBjb25zdCBrZXlNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLWtleVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG4gICAgY29uc3QgdHlwZU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2UtdHlwZVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG5cbiAgICBpZiAoa2V5TWF0Y2g/LlsxXSAmJiB0eXBlTWF0Y2g/LlsxXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ2VyYS1tZXNzYWdlLWtleSc6IGtleU1hdGNoWzFdLFxuICAgICAgICAnZXJhLW1lc3NhZ2UtdHlwZSc6IHR5cGVNYXRjaFsxXSBhcyAndXNlcicgfCAnYXNzaXN0YW50JyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWvvOWHuueahOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDor7vlj5YgTUvjgJEqKiDku47kuIDkuKrmtojmga/lr7nosaHkuK3lj6ror7vlnLDmj5Dlj5blhbbmtojmga/lr4bpkqXvvIhNS++8ieOAglxuICog6L+Z5Liq5Ye95pWw57uP6L+H54m55Yir5LyY5YyW77yM5Lul5bqU5a+55ruR5Yqo77yIc3dpcGXvvInnrYnlnLrmma/kuIvmtojmga/lr7nosaHnu5PmnoTkuI3kuIDoh7TnmoTpl67popjjgIJcbiAqIOWug+S8muWFqOmdouajgOafpea2iOaBr+eahCBgbWVzYOOAgWBtZXNzYWdlYCDku6Xlj4ogYHN3aXBlc2Ag5pWw57uE5Lit55qE5q+P5LiA5Liq5YWD57Sg77yM55u05Yiw5om+5Yiw56ys5LiA5Liq5pyJ5pWI55qEIE1LIOS4uuatouOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOaJvuWIsOeahCBNS++8m+WmguaenOS4jeWtmOWcqO+8jOWImei/lOWbnuepuuWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZE1lc3NhZ2VLZXkobXNnOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoIW1zZykgcmV0dXJuICcnO1xuXG4gIC8vIOaguOW/g+mAu+i+ke+8muWni+e7iOS4lOS7heagueaNriBnZXRNZXNzYWdlQ29udGVudCDnmoTnu5PmnpzmnaXop6PmnpAgTUvjgIJcbiAgY29uc3QgY29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KG1zZyk7XG5cbiAgY29uc3QgbWsgPSBwYXJzZUVyYURhdGEoY29udGVudCk/LlsnZXJhLW1lc3NhZ2Uta2V5J10gfHwgJyc7XG5cbiAgLy8g56e76Zmk6YGN5Y6G5YW25LuWIHN3aXBlcyDnmoTplJnor6/pgLvovpHjgILlpoLmnpzlvZPliY3mv4DmtLvnmoTlhoXlrrnmsqHmnIkgTUvvvIzlsLHlv4Xpobvov5Tlm57nqbrlrZfnrKbkuLLvvIxcbiAgLy8g5Lul5by65Yi2IGVuc3VyZU1lc3NhZ2VLZXkg55Sf5oiQ5paw55qEIE1L44CCXG4gIHJldHVybiBtaztcblxuICAvKlxuICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICog44CQ5bey5bqf5byD55qE5YW85a656YC76L6R44CRIC0gMjAyNS8xMC8wMlxuICAgKlxuICAgKiDku6XkuIvku6PnoIHlnZfmmK/kuLrkuoblhbzlrrnml6fniYjphZLppobnmoTkuIDkuKrnibnmgKfvvJrkuIDkuKrmtojmga/nmoTlpJrkuKogc3dpcGUg5Y+v6IO95YWx5Lqr5ZCM5LiA5Liq5bqV5bGC5raI5oGv5Y+Y6YeP77yMXG4gICAqIOWboOatpCBNSyDlj6/og73lrZjlnKjkuo7ku7vkvZXkuIDkuKogc3dpcGUg5Lit44CCXG4gICAqXG4gICAqICoq5bqf5byD5Y6f5ZugKio6XG4gICAqIOWcqOW9k+WJjeeahCBFUkEg5p625p6E5Lit77yM5q+P5LiqIHN3aXBlIOmDveiiq+inhuS4uueLrOeri+eahOWGheWuueOAguWmguaenOW9k+WJjea/gOa0u+eahCBzd2lwZSDlhoXlrrnkuK3msqHmnIkgTUvvvIxcbiAgICog5bCx5oSP5ZGz552A5a6D5piv5LiA5Liq5YWo5paw55qE44CB6ZyA6KaB6KKr6LWL5LqI5pawIE1LIOeahOa2iOaBr+OAguatpOaXtuiLpee7p+e7reafpeaJvuW5tui/lOWbnuWFtuS7liBzd2lwZSDnmoTml6cgTUvvvIxcbiAgICog5bCG5Lya5a+86Ie0IGBlbnN1cmVNZXNzYWdlS2V5YCDplJnor6/lnLDorqTkuLrmlrDmtojmga/lt7LmnIkgTUvvvIzku47ogIzot7Pov4flv4XopoHnmoTigJznlJ/miJDmlrAgTUvigJ3mtYHnqIvjgIJcbiAgICog6L+Z5q2j5piv5a+86Ie0IHN3aXBlIOaWsOa2iOaBr+aXtuaXoOazleato+ehruWGmeWFpeWPmOmHj+eahOagueacrOWOn+WboOOAglxuICAgKlxuICAgKiDlm6DmraTvvIzor6XlhbzlrrnpgLvovpHlt7Looqvms6jph4rmjonvvIzku6Xnoa7kv50gYHJlYWRNZXNzYWdlS2V5YCDnmoTooYzkuLrkuI7lvZPliY3mnrbmnoTnmoTorr7orqHmhI/lm77kv53mjIHkuIDoh7TjgIJcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAqL1xuICAvLyBjb25zdCBta0Zyb21DdXJyZW50ID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tQ3VycmVudCkge1xuICAvLyAgIHJldHVybiBta0Zyb21DdXJyZW50O1xuICAvLyB9XG4gIC8vIGlmIChBcnJheS5pc0FycmF5KG1zZy5zd2lwZXMpKSB7XG4gIC8vICAgZm9yIChjb25zdCBzd2lwZUNvbnRlbnQgb2YgbXNnLnN3aXBlcykge1xuICAvLyAgICAgY29uc3QgbWtGcm9tU3dpcGUgPSBwYXJzZUVyYURhdGEoc3dpcGVDb250ZW50KT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gICAgIGlmIChta0Zyb21Td2lwZSkge1xuICAvLyAgICAgICByZXR1cm4gbWtGcm9tU3dpcGU7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG1rRnJvbU1lc3NhZ2UgPSBwYXJzZUVyYURhdGEobXNnLm1lc3NhZ2UpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tTWVzc2FnZSkge1xuICAvLyAgIHJldHVybiBta0Zyb21NZXNzYWdlO1xuICAvLyB9XG4gIC8vIHJldHVybiAnJztcbn1cblxuLyoqXG4gKiAqKuOAkOehruS/nSBNSyDlrZjlnKjjgJEqKlxuICog6L+Z5piv5pys5qih5Z2X5pyA5qC45b+D55qE5Ye95pWw44CC5a6D5qOA5p+l5LiA5Liq5raI5oGv5piv5ZCm5bey5oul5pyJIE1L77yM5aaC5p6c5bCa5pyq5oul5pyJ77yM5YiZ5Li65YW255Sf5oiQ5LiA5Liq5paw55qEIE1LIOW5tuazqOWFpeWIsOa2iOaBr+WGheWuueS4reOAglxuICog6L+Z5piv6Kej5Yaz4oCc6bih55Sf6JuLL+ibi+eUn+m4oeKAnemXrumimOeahOWFs+mUru+8muWcqOWvueWPmOmHj+i/m+ihjOS7u+S9leaTjeS9nOS5i+WJje+8jOW/hemhu+WFiOehruS/neacieS4gOS4quWPr+S+m+S+nemZhOeahOmUmueCue+8iE1L77yJ44CCXG4gKlxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDnm67moIfmtojmga/lr7nosaEgKOW/hemhu+WMheWQqyBgbWVzc2FnZV9pZGAsIGByb2xlYCwg5Lul5Y+KIGBtZXNzYWdlYCDmiJYgYHN3aXBlc2Ap44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bWs6IHN0cmluZywgaXNOZXc6IGJvb2xlYW59Pn0g6L+U5Zue5YyF5ZCrIE1LIOWSjOS4gOS4quW4g+WwlOWAvOeahOWvueixoe+8jOivpeW4g+WwlOWAvOaMh+ekuuaYr+WQpuWIm+W7uuS6huaWsOeahCBNS+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlTWVzc2FnZUtleShtc2c6IGFueSk6IFByb21pc2U8eyBtazogc3RyaW5nOyBpc05ldzogYm9vbGVhbiB9PiB7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicgfHwgIW1zZy5yb2xlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5peg5pWI55qE5raI5oGv5a+56LGh57uT5p6E77yM5peg5rOV56Gu5L+dS2V544CCbXNnPSR7SlNPTi5zdHJpbmdpZnkobXNnKX1gKTtcbiAgICByZXR1cm4geyBtazogJycsIGlzTmV3OiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gMS4g5L2/55So5aKe5by655qEIHJlYWRNZXNzYWdlS2V5IOajgOafpeaYr+WQpuW3suWtmOWcqCBNS1xuICBjb25zdCBleGlzdGluZ01rID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKGV4aXN0aW5nTWspIHtcbiAgICByZXR1cm4geyBtazogZXhpc3RpbmdNaywgaXNOZXc6IGZhbHNlIH07IC8vIOW3suWtmOWcqO+8jOebtOaOpei/lOWbnlxuICB9XG5cbiAgLy8gMi4g55Sf5oiQ5paw55qEIE1LIOWSjOWFg+aVsOaNruWdl1xuICBjb25zdCBuZXdNayA9IGBlcmFfbWtfJHtEYXRlLm5vdygpfV8ke3JuZCgpfWA7XG4gIGNvbnN0IG1lc3NhZ2VUeXBlID0gbXNnLnJvbGUgPT09ICd1c2VyJyA/ICd1c2VyJyA6ICdhc3Npc3RhbnQnO1xuICBjb25zdCBkYXRhU3RyaW5nID0gYDwke0VSQV9EQVRBX1RBR30+e1wiZXJhLW1lc3NhZ2Uta2V5XCI9XCIke25ld01rfVwiLFwiZXJhLW1lc3NhZ2UtdHlwZVwiPVwiJHttZXNzYWdlVHlwZX1cIn08LyR7RVJBX0RBVEFfVEFHfT5gO1xuXG4gIGxvZ2dlci5sb2coJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5Li65raI5oGvIChJRDogJHttc2cubWVzc2FnZV9pZH0pIOazqOWFpeaWsOeahEtleTogJHtuZXdNa31gKTtcblxuICAvLyAzLiDmnoTpgKDmlrDnmoTmtojmga/lhoXlrrnlubbnu5/kuIDosIPnlKjmm7TmlrDlh73mlbBcbiAgY29uc3QgY3VycmVudENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gZGF0YVN0cmluZyArICdcXG4nICsgY3VycmVudENvbnRlbnQ7XG5cbiAgLy8g5L2/55So5LuOIHV0aWxzLnRzIOWvvOWFpeeahOmAmueUqOWHveaVsOadpeabtOaWsOa2iOaBr++8jOivpeWHveaVsOW3suWwgeijheS6huWkhOeQhiBzd2lwZXMg55qE6YC76L6R44CCXG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1zZywgbmV3Q29udGVudCk7XG5cbiAgcmV0dXJuIHsgbWs6IG5ld01rLCBpc05ldzogdHJ1ZSB9O1xufVxuXG4vKipcbiAqICoq44CQ56Gu5L+d5pyA5paw5raI5oGv55qEIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quS+v+aNt+WHveaVsO+8jOS4k+mXqOeUqOS6juehruS/neW9k+WJjeiBiuWkqeiusOW9leS4reeahOacgOWQjuS4gOadoea2iOaBr+aLpeaciSBNS+OAglxuICog5a6D6YCa5bi45Zyo55uR5ZCs5Yiw5paw5raI5oGv55Sf5oiQ562J5LqL5Lu25pe26KKr6LCD55So77yM5Lul56Gu5L+d5paw5raI5oGv6IO96KKrIEVSQSDns7vnu5/mraPnoa7ov73ouKrjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHttazogc3RyaW5nLCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsLCBpc05ld0tleTogYm9vbGVhbn0+fSDov5Tlm57ljIXlkKsgTUvjgIHmtojmga8gSUQg5ZKM5LiA5Liq5biD5bCU5YC855qE5a+56LGh77yM6K+l5biD5bCU5YC85oyH56S65piv5ZCm5Yib5bu65LqG5paw55qEIE1L44CCXG4gKi9cbmV4cG9ydCBjb25zdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UgPSBhc3luYyAoKTogUHJvbWlzZTx7XG4gIG1rOiBzdHJpbmc7XG4gIG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGw7XG4gIGlzTmV3S2V5OiBib29sZWFuO1xufT4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICAgIC8vIOS/neeVmeatpOaXpeW/l++8jOWboOS4uuWug+WvueS6juiwg+ivleS6i+S7tuinpuWPkeaXtueahOa2iOaBr+eKtuaAgeiHs+WFs+mHjeimgeOAglxuICAgIGxvZ2dlci5kZWJ1ZygnZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOiOt+WPluWIsOeahOacgOaWsOa2iOaBr+WvueixoSAobXNnKTogJHtKU09OLnN0cmluZ2lmeShtc2cpfWApO1xuXG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsICfml6Dms5Xor7vlj5bmnIDmlrDmtojmga/miJblhbZJRO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIHsgbWs6ICcnLCBtZXNzYWdlX2lkOiBudWxsLCBpc05ld0tleTogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvLyBlbnN1cmVNZXNzYWdlS2V5IOS8mui/lOWbnuacgOe7iOeahCBNSyDlkozkuIDkuKrluIPlsJTlgLxcbiAgICBjb25zdCB7IG1rLCBpc05ldyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICAgIGxvZ2dlci5sb2coJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDlt7LkuLrmnIDmlrDmtojmga8gJHttc2cubWVzc2FnZV9pZH0g56Gu5L+dIE1LIOWtmOWcqOOAgiAo5piv5ZCm5paw5bu6OiAke2lzTmV3fSlgKTtcbiAgICByZXR1cm4geyBtaywgbWVzc2FnZV9pZDogbXNnLm1lc3NhZ2VfaWQsIGlzTmV3S2V5OiBpc05ldyB9O1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGxvZ2dlci5lcnJvcignZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOehruS/nU1L5pe25byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4geyBtazogJycsIG1lc3NhZ2VfaWQ6IG51bGwsIGlzTmV3S2V5OiBmYWxzZSB9O1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5pu05paw5pyA5paw5bey6YCJIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quKAnOS/nemZqeKAneWHveaVsO+8jOeUqOS6juWcqOavj+asoeS6i+S7tuWkhOeQhueahOacgOWQju+8jOW8uuWItuagoeWHhiBgU2VsZWN0ZWRNa3NgIOaVsOe7hOS4reWFs+S6jioq5pyA5paw5raI5oGvKirnmoTorrDlvZXjgIJcbiAqIOWug+ehruS/neWNs+S9v+WcqOWkjeadgueahOW8guatpea1geeoi+S4re+8jGBTZWxlY3RlZE1rc2Ag55qE5bC+6YOo5Lmf5aeL57uI5LiO5a6e6ZmF55qE5pyA5paw5raI5oGv5L+d5oyB5Lil5qC85ZCM5q2l44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGNvbnN0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSByZXR1cm47XG5cbiAgLy8g56Gu5L+dIE1LIOWtmOWcqOW5tuiOt+WPluWug1xuICBjb25zdCB7IG1rOiBNSyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICBpZiAoIU1LKSByZXR1cm47XG5cbiAgLy8g5pu05pawIEVSQU1ldGFEYXRhIOS4reeahCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgIC8vIOWPquacieWcqOiusOW9leS4jeS4gOiHtOaXtuaJjeaJp+ihjOWGmeaTjeS9nO+8jOS7peS8mOWMluaAp+iDvVxuICAgIGlmIChzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gIT09IE1LKSB7XG4gICAgICBzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgfVxuICAgIHJldHVybiBtZXRhO1xuICB9KTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/key/mk.ts\n\n}");
  },
  "./src/ERA变量框架/core/rollback.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/core/rollback.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLatestNewValue: () => (/* binding */ findLatestNewValue),\n/* harmony export */   rollbackByMk: () => (/* binding */ rollbackByMk)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 回滚与历史追溯模块\n * @description\n * 该模块提供了 ERA 框架“时间旅行”能力的核心实现。它负责根据 `EditLog` 精确地撤销变量修改，\n * 以及在需要时向上追溯历史以查找变量的旧值。\n *\n * **设计理念**:\n * - **可逆操作**: 所有的变量写入操作都必须是可逆的。`rollbackByMk` 函数通过读取 `EditLog`\n *   并执行反向操作（`insert` -> `unset`, `update` -> `set to value_old`）来保证这一点。\n * - **历史的权威性**: `EditLog` 是变量状态变迁的唯一真实记录。`findLatestNewValue` 函数\n *   体现了这一原则，它不信任任何临时的变量快照，而是通过回溯 `EditLog` 链来查找一个变量\n *   在特定时间点之前的真实值。\n */\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_5__.Logger('core-rollback');\n/**\n * **【回滚】**\n * 根据一个给定的消息密钥（MK），精确地撤销该消息所引入的所有变量变更。\n *\n * @param {string} MK - 要回滚的目标消息的密钥。\n * @param {boolean} [silent=false] - 是否为静默模式。在静默模式下，函数不会自己触发日志刷新，\n *   这在 `resyncStateOnHistoryChange` 等批量操作中非常有用，可以避免产生大量冗余日志。\n */\nasync function rollbackByMk(MK, silent = false) {\n    try {\n        logger.log('rollbackByMk', `开始回滚, MK=${MK}`);\n        await updateVariablesWith(v => {\n            const meta = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.META_DATA_PATH, {});\n            const stat = _.get(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, {});\n            const raw = _.get(meta, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK]);\n            const arr = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(raw);\n            if (!arr || !arr.length) {\n                logger.debug('rollbackByMk', `EditLog 为空或无效，跳过回滚。`);\n                return v;\n            }\n            // 关键：必须逆序遍历 EditLog 来执行回滚。\n            // 这确保了对同一变量的多次修改能够被正确地、按相反的顺序撤销。\n            for (let i = arr.length - 1; i >= 0; i--) {\n                const e = arr[i];\n                const op = String(e?.op || '').toLowerCase();\n                const path = String(e?.path || '');\n                if (!path)\n                    continue;\n                if (op === 'insert') {\n                    // 对于“插入”操作，回滚即为“删除”。\n                    _.unset(stat, path);\n                    continue;\n                }\n                if (op === 'update' || op === 'delete') {\n                    // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n                    if (typeof e?.value_old === 'undefined') {\n                        // 如果日志中没有记录旧值，最安全的回滚方式是直接删除该路径。\n                        _.unset(stat, path);\n                    }\n                    else {\n                        _.set(stat, path, _.cloneDeep(e.value_old));\n                    }\n                }\n            }\n            _.set(v, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, stat);\n            return v;\n        }, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.CHAT_SCOPE);\n        logger.log('rollbackByMk', `回滚完成：MK=${MK}`);\n    }\n    catch (e) {\n        logger.error('rollbackByMk', `回滚异常：MK=${MK} → ${e?.message || e}`, e);\n    }\n}\n/**\n * **【历史追溯】**\n * 向上追溯聊天历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是为 `applyEditAtLevel` 函数提供支持的关键辅助函数，用于在生成 `update` 日志时，\n * 准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID 的**前一条**消息开始向上查找。\n * @param {Logger} [logger] - 可选的 Logger 实例，用于记录详细的追溯过程。\n * @returns {Promise<any>} 返回找到的 `value_new`。如果追溯到聊天记录的开头都未找到，则返回 `null`。\n */\nasync function findLatestNewValue(path, startMessageId, logger) {\n    logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息ID <${startMessageId}> 向上追溯历史值...`);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    if (!messages || messages.length < 1) {\n        logger?.debug('findLatestNewValue', `消息历史为空，无法追溯。`);\n        return null;\n    }\n    const startIndex = messages.findIndex(m => m.message_id === startMessageId);\n    if (startIndex === -1) {\n        logger?.warn('findLatestNewValue', `错误：在消息列表中未找到起始消息ID: ${startMessageId}`);\n        return null;\n    }\n    // 从起始消息的前一条开始，向上（向旧）遍历历史消息。\n    for (let i = startIndex - 1; i >= 0; i--) {\n        const message = messages[i];\n        const msgId = message?.message_id;\n        logger?.debug('findLatestNewValue', `[进度] 正在检查消息 (ID: ${msgId})，内容: \"${((0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message) || '').substring(0, 100)}...\"`);\n        // 使用 isUserMessage 辅助函数，并检查 message_id\n        if ((0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.isUserMessage)(message) || typeof msgId !== 'number') {\n            continue;\n        }\n        const mk = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(message);\n        if (!mk) {\n            logger?.debug('findLatestNewValue', `[进度] 消息 (ID: ${msgId}) 无 MK，跳过。`);\n            continue; // 跳过没有 MK 的 AI 消息。\n        }\n        const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_3__.getEraData)();\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(editLogRaw);\n        if (!editLog || editLog.length === 0) {\n            logger?.debug('findLatestNewValue', `[进度] MK ${mk} 的 EditLog 为空，跳过。`);\n            continue; // 跳过 EditLog 为空的。\n        }\n        logger?.debug('findLatestNewValue', `[进度] 正在检查 MK ${mk} 的 EditLog...\\n${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(editLog)}`);\n        // 关键：从后向前遍历该消息的 EditLog，这样找到的第一个匹配项就是最新的。\n        for (let j = editLog.length - 1; j >= 0; j--) {\n            const logEntry = editLog[j];\n            if (!logEntry || !logEntry.path)\n                continue;\n            // Case 1: 精确路径匹配。\n            if (logEntry.path === path) {\n                // 如果在历史追溯中找到了 delete 记录，这意味着状态可能不一致。\n                // 因为 applyEditAtLevel 的前置检查应阻止对已删除变量的更新。\n                // 记录一个错误以供调试，并返回 null，因为该变量在逻辑上是不存在的。\n                if (logEntry.op === 'delete') {\n                    logger?.error('findLatestNewValue', `>> 状态异常! 在消息(ID:${message.message_id}, MK:${mk})中为路径 <${path}> 找到了 'delete' 记录。这表明 update 操作可能正在尝试修改一个已被删除的变量。`);\n                    return null;\n                }\n                logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到精确路径 <${path}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(logEntry.value_new)}`);\n                return _.cloneDeep(logEntry.value_new);\n            }\n            // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n            // 例如, 查找 \"a.b.c\", 而日志中有对 \"a.b\" 的修改。\n            if (path.startsWith(logEntry.path + '.')) {\n                const subPath = path.substring(logEntry.path.length + 1);\n                const parentNewVal = logEntry.value_new;\n                if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n                    const foundVal = _.get(parentNewVal, subPath);\n                    logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为: ${(0,_utils_data__WEBPACK_IMPORTED_MODULE_4__.J)(foundVal)}`);\n                    return _.cloneDeep(foundVal);\n                }\n            }\n        }\n    }\n    // 如果追溯到聊天记录的开头都未找到，说明这是该变量的首次出现。\n    logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvcm9sbGJhY2sudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUU4RTtBQUNqRDtBQUMwQjtBQUNyQjtBQUNDO0FBQ1Y7QUFFdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNDOzs7Ozs7O0dBT0c7QUFDSSxLQUFLLFVBQVUsWUFBWSxDQUFDLEVBQVUsRUFBRSxNQUFNLEdBQUcsS0FBSztJQUMzRCxJQUFJLENBQUM7UUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0MsTUFBTSxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUM1QixNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSw0REFBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDREQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFMUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyx1REFBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDekMsTUFBTSxHQUFHLEdBQUcseURBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN4QixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNwRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUM7WUFFRCwyQkFBMkI7WUFDM0IsaUNBQWlDO1lBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENB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RyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN4QyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDbEUsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzlDLE1BQU0sRUFBRSxLQUFLLENBQ1gsb0JBQW9CLEVBQ3BCLGlCQUFpQixPQUFPLENBQUMsVUFBVSxRQUFRLEVBQUUsYUFBYSxRQUFRLENBQUMsSUFBSSxnQkFBZ0IsT0FBTyxVQUFVLDhDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDdEgsQ0FBQztvQkFDRixPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLElBQUksdUJBQXVCLENBQUMsQ0FBQztJQUM5RSxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9jb3JlL3JvbGxiYWNrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWbnua7muS4juWOhuWPsui/vea6r+aooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmj5DkvpvkuoYgRVJBIOahhuaetuKAnOaXtumXtOaXheihjOKAneiDveWKm+eahOaguOW/g+WunueOsOOAguWug+i0n+i0o+agueaNriBgRWRpdExvZ2Ag57K+56Gu5Zyw5pKk6ZSA5Y+Y6YeP5L+u5pS577yMXG4gKiDku6Xlj4rlnKjpnIDopoHml7blkJHkuIrov73muq/ljoblj7Lku6Xmn6Xmib7lj5jph4/nmoTml6flgLzjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuWPr+mAhuaTjeS9nCoqOiDmiYDmnInnmoTlj5jph4/lhpnlhaXmk43kvZzpg73lv4XpobvmmK/lj6/pgIbnmoTjgIJgcm9sbGJhY2tCeU1rYCDlh73mlbDpgJrov4for7vlj5YgYEVkaXRMb2dgXG4gKiAgIOW5tuaJp+ihjOWPjeWQkeaTjeS9nO+8iGBpbnNlcnRgIC0+IGB1bnNldGAsIGB1cGRhdGVgIC0+IGBzZXQgdG8gdmFsdWVfb2xkYO+8ieadpeS/neivgei/meS4gOeCueOAglxuICogLSAqKuWOhuWPsueahOadg+WogeaApyoqOiBgRWRpdExvZ2Ag5piv5Y+Y6YeP54q25oCB5Y+Y6L+B55qE5ZSv5LiA55yf5a6e6K6w5b2V44CCYGZpbmRMYXRlc3ROZXdWYWx1ZWAg5Ye95pWwXG4gKiAgIOS9k+eOsOS6hui/meS4gOWOn+WIme+8jOWug+S4jeS/oeS7u+S7u+S9leS4tOaXtueahOWPmOmHj+W/q+eFp++8jOiAjOaYr+mAmui/h+Wbnua6ryBgRWRpdExvZ2Ag6ZO+5p2l5p+l5om+5LiA5Liq5Y+Y6YePXG4gKiAgIOWcqOeJueWumuaXtumXtOeCueS5i+WJjeeahOecn+WunuWAvOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgQ0hBVF9TQ09QRSwgTE9HU19QQVRILCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tayc7XG5pbXBvcnQgeyBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IEosIHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1yb2xsYmFjaycpO1xuXG4vKipcbiAqICoq44CQ5Zue5rua44CRKipcbiAqIOagueaNruS4gOS4que7meWumueahOa2iOaBr+WvhumSpe+8iE1L77yJ77yM57K+56Gu5Zyw5pKk6ZSA6K+l5raI5oGv5omA5byV5YWl55qE5omA5pyJ5Y+Y6YeP5Y+Y5pu044CCXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IE1LIC0g6KaB5Zue5rua55qE55uu5qCH5raI5oGv55qE5a+G6ZKl44CCXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtzaWxlbnQ9ZmFsc2VdIC0g5piv5ZCm5Li66Z2Z6buY5qih5byP44CC5Zyo6Z2Z6buY5qih5byP5LiL77yM5Ye95pWw5LiN5Lya6Ieq5bex6Kem5Y+R5pel5b+X5Yi35paw77yMXG4gKiAgIOi/meWcqCBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOetieaJuemHj+aTjeS9nOS4remdnuW4uOacieeUqO+8jOWPr+S7pemBv+WFjeS6p+eUn+Wkp+mHj+WGl+S9meaXpeW/l+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcm9sbGJhY2tCeU1rKE1LOiBzdHJpbmcsIHNpbGVudCA9IGZhbHNlKSB7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmxvZygncm9sbGJhY2tCeU1rJywgYOW8gOWni+Wbnua7miwgTUs9JHtNS31gKTtcbiAgICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKHYgPT4ge1xuICAgICAgY29uc3QgbWV0YSA9IF8uZ2V0KHYsIE1FVEFfREFUQV9QQVRILCB7fSk7XG4gICAgICBjb25zdCBzdGF0ID0gXy5nZXQodiwgU1RBVF9EQVRBX1BBVEgsIHt9KTtcblxuICAgICAgY29uc3QgcmF3ID0gXy5nZXQobWV0YSwgW0xPR1NfUEFUSCwgTUtdKTtcbiAgICAgIGNvbnN0IGFyciA9IHBhcnNlRWRpdExvZyhyYXcpO1xuICAgICAgaWYgKCFhcnIgfHwgIWFyci5sZW5ndGgpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdyb2xsYmFja0J5TWsnLCBgRWRpdExvZyDkuLrnqbrmiJbml6DmlYjvvIzot7Pov4flm57mu5rjgIJgKTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgICB9XG5cbiAgICAgIC8vIOWFs+mUru+8muW/hemhu+mAhuW6j+mBjeWOhiBFZGl0TG9nIOadpeaJp+ihjOWbnua7muOAglxuICAgICAgLy8g6L+Z56Gu5L+d5LqG5a+55ZCM5LiA5Y+Y6YeP55qE5aSa5qyh5L+u5pS56IO95aSf6KKr5q2j56Gu5Zyw44CB5oyJ55u45Y+N55qE6aG65bqP5pKk6ZSA44CCXG4gICAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhcnJbaV07XG4gICAgICAgIGNvbnN0IG9wID0gU3RyaW5nKGU/Lm9wIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBwYXRoID0gU3RyaW5nKGU/LnBhdGggfHwgJycpO1xuICAgICAgICBpZiAoIXBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAgIGlmIChvcCA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAvLyDlr7nkuo7igJzmj5LlhaXigJ3mk43kvZzvvIzlm57mu5rljbPkuLrigJzliKDpmaTigJ3jgIJcbiAgICAgICAgICBfLnVuc2V0KHN0YXQsIHBhdGgpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcCA9PT0gJ3VwZGF0ZScgfHwgb3AgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgLy8g5a+55LqO4oCc5pu05paw4oCd5oiW4oCc5Yig6Zmk4oCd5pON5L2c77yM5Zue5rua5Y2z5Li65oGi5aSN5Yiw4oCc5pen5YC84oCd44CCXG4gICAgICAgICAgaWYgKHR5cGVvZiBlPy52YWx1ZV9vbGQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzml6Xlv5fkuK3msqHmnInorrDlvZXml6flgLzvvIzmnIDlronlhajnmoTlm57mu5rmlrnlvI/mmK/nm7TmjqXliKDpmaTor6Xot6/lvoTjgIJcbiAgICAgICAgICAgIF8udW5zZXQoc3RhdCwgcGF0aCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF8uc2V0KHN0YXQsIHBhdGgsIF8uY2xvbmVEZWVwKGUudmFsdWVfb2xkKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIF8uc2V0KHYsIFNUQVRfREFUQV9QQVRILCBzdGF0KTtcbiAgICAgIHJldHVybiB2O1xuICAgIH0sIENIQVRfU0NPUEUpO1xuICAgIGxvZ2dlci5sb2coJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlrozmiJDvvJpNSz0ke01LfWApO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ3JvbGxiYWNrQnlNaycsIGDlm57mu5rlvILluLjvvJpNSz0ke01LfSDihpIgJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gIH1cbn1cblxuLyoqXG4gKiAqKuOAkOWOhuWPsui/vea6r+OAkSoqXG4gKiDlkJHkuIrov73muq/ogYrlpKnljoblj7LvvIzmn6Xmib7mn5DkuKrlj5jph4/ot6/lvoTlnKjmjIflrprmtojmga/kuYvliY3nmoTmnIDlkI7kuIDkuKrlgLwgKGB2YWx1ZV9uZXdgKeOAglxuICog6L+Z5piv5Li6IGBhcHBseUVkaXRBdExldmVsYCDlh73mlbDmj5DkvpvmlK/mjIHnmoTlhbPplK7ovoXliqnlh73mlbDvvIznlKjkuo7lnKjnlJ/miJAgYHVwZGF0ZWAg5pel5b+X5pe277yMXG4gKiDlh4bnoa7lnLDorrDlvZXkuIsgYHZhbHVlX29sZGDjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIOimgeafpeaJvueahOWPmOmHj+eahOWujOaVtOi3r+W+hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0TWVzc2FnZUlkIC0g5LuO5q2k5raI5oGvIElEIOeahCoq5YmN5LiA5p2hKirmtojmga/lvIDlp4vlkJHkuIrmn6Xmib7jgIJcbiAqIEBwYXJhbSB7TG9nZ2VyfSBbbG9nZ2VyXSAtIOWPr+mAieeahCBMb2dnZXIg5a6e5L6L77yM55So5LqO6K6w5b2V6K+m57uG55qE6L+95rqv6L+H56iL44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fSDov5Tlm57mib7liLDnmoQgYHZhbHVlX25ld2DjgILlpoLmnpzov73muq/liLDogYrlpKnorrDlvZXnmoTlvIDlpLTpg73mnKrmib7liLDvvIzliJnov5Tlm54gYG51bGxg44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kTGF0ZXN0TmV3VmFsdWUocGF0aDogc3RyaW5nLCBzdGFydE1lc3NhZ2VJZDogbnVtYmVyLCBsb2dnZXI/OiBMb2dnZXIpOiBQcm9taXNlPGFueT4ge1xuICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5byA5aeL5Li66Lev5b6EIDwke3BhdGh9PiDku47mtojmga9JRCA8JHtzdGFydE1lc3NhZ2VJZH0+IOWQkeS4iui/vea6r+WOhuWPsuWAvC4uLmApO1xuICBjb25zdCBtZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IGZhbHNlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA8IDEpIHtcbiAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5raI5oGv5Y6G5Y+y5Li656m677yM5peg5rOV6L+95rqv44CCYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBzdGFydEluZGV4ID0gbWVzc2FnZXMuZmluZEluZGV4KG0gPT4gbS5tZXNzYWdlX2lkID09PSBzdGFydE1lc3NhZ2VJZCk7XG4gIGlmIChzdGFydEluZGV4ID09PSAtMSkge1xuICAgIGxvZ2dlcj8ud2FybignZmluZExhdGVzdE5ld1ZhbHVlJywgYOmUmeivr++8muWcqOa2iOaBr+WIl+ihqOS4reacquaJvuWIsOi1t+Wni+a2iOaBr0lEOiAke3N0YXJ0TWVzc2FnZUlkfWApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8g5LuO6LW35aeL5raI5oGv55qE5YmN5LiA5p2h5byA5aeL77yM5ZCR5LiK77yI5ZCR5pen77yJ6YGN5Y6G5Y6G5Y+y5raI5oGv44CCXG4gIGZvciAobGV0IGkgPSBzdGFydEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZXNbaV07XG4gICAgY29uc3QgbXNnSWQgPSBtZXNzYWdlPy5tZXNzYWdlX2lkO1xuICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgIGBb6L+b5bqmXSDmraPlnKjmo4Dmn6Xmtojmga8gKElEOiAke21zZ0lkfSnvvIzlhoXlrrk6IFwiJHsoZ2V0TWVzc2FnZUNvbnRlbnQobWVzc2FnZSkgfHwgJycpLnN1YnN0cmluZygwLCAxMDApfS4uLlwiYCxcbiAgICApO1xuXG4gICAgLy8g5L2/55SoIGlzVXNlck1lc3NhZ2Ug6L6F5Yqp5Ye95pWw77yM5bm25qOA5p+lIG1lc3NhZ2VfaWRcbiAgICBpZiAoaXNVc2VyTWVzc2FnZShtZXNzYWdlKSB8fCB0eXBlb2YgbXNnSWQgIT09ICdudW1iZXInKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtayA9IHJlYWRNZXNzYWdlS2V5KG1lc3NhZ2UpO1xuICAgIGlmICghbWspIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSDmtojmga8gKElEOiAke21zZ0lkfSkg5pegIE1L77yM6Lez6L+H44CCYCk7XG4gICAgICBjb250aW51ZTsgLy8g6Lez6L+H5rKh5pyJIE1LIOeahCBBSSDmtojmga/jgIJcbiAgICB9XG5cbiAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gICAgY29uc3QgZWRpdExvZ1JhdyA9IF8uZ2V0KG1ldGFEYXRhLCBbTE9HU19QQVRILCBta10pO1xuICAgIGNvbnN0IGVkaXRMb2cgPSBwYXJzZUVkaXRMb2coZWRpdExvZ1Jhdyk7XG5cbiAgICBpZiAoIWVkaXRMb2cgfHwgZWRpdExvZy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGBb6L+b5bqmXSBNSyAke21rfSDnmoQgRWRpdExvZyDkuLrnqbrvvIzot7Pov4fjgIJgKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDot7Pov4cgRWRpdExvZyDkuLrnqbrnmoTjgIJcbiAgICB9XG4gICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYFvov5vluqZdIOato+WcqOajgOafpSBNSyAke21rfSDnmoQgRWRpdExvZy4uLlxcbiR7SihlZGl0TG9nKX1gKTtcblxuICAgIC8vIOWFs+mUru+8muS7juWQjuWQkeWJjemBjeWOhuivpea2iOaBr+eahCBFZGl0TG9n77yM6L+Z5qC35om+5Yiw55qE56ys5LiA5Liq5Yy56YWN6aG55bCx5piv5pyA5paw55qE44CCXG4gICAgZm9yIChsZXQgaiA9IGVkaXRMb2cubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgIGNvbnN0IGxvZ0VudHJ5ID0gZWRpdExvZ1tqXTtcbiAgICAgIGlmICghbG9nRW50cnkgfHwgIWxvZ0VudHJ5LnBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICAvLyBDYXNlIDE6IOeyvuehrui3r+W+hOWMuemFjeOAglxuICAgICAgaWYgKGxvZ0VudHJ5LnBhdGggPT09IHBhdGgpIHtcbiAgICAgICAgLy8g5aaC5p6c5Zyo5Y6G5Y+y6L+95rqv5Lit5om+5Yiw5LqGIGRlbGV0ZSDorrDlvZXvvIzov5nmhI/lkbPnnYDnirbmgIHlj6/og73kuI3kuIDoh7TjgIJcbiAgICAgICAgLy8g5Zug5Li6IGFwcGx5RWRpdEF0TGV2ZWwg55qE5YmN572u5qOA5p+l5bqU6Zi75q2i5a+55bey5Yig6Zmk5Y+Y6YeP55qE5pu05paw44CCXG4gICAgICAgIC8vIOiusOW9leS4gOS4qumUmeivr+S7peS+m+iwg+ivle+8jOW5tui/lOWbniBudWxs77yM5Zug5Li66K+l5Y+Y6YeP5Zyo6YC76L6R5LiK5piv5LiN5a2Y5Zyo55qE44CCXG4gICAgICAgIGlmIChsb2dFbnRyeS5vcCA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICBsb2dnZXI/LmVycm9yKFxuICAgICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgICBgPj4g54q25oCB5byC5bi4ISDlnKjmtojmga8oSUQ6JHttZXNzYWdlLm1lc3NhZ2VfaWR9LCBNSzoke21rfSnkuK3kuLrot6/lvoQgPCR7cGF0aH0+IOaJvuWIsOS6hiAnZGVsZXRlJyDorrDlvZXjgILov5nooajmmI4gdXBkYXRlIOaTjeS9nOWPr+iDveato+WcqOWwneivleS/ruaUueS4gOS4quW3suiiq+WIoOmZpOeahOWPmOmHj+OAgmAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlcj8uZGVidWcoXG4gICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw57K+56Gu6Lev5b6EIDwke3BhdGh9PiDnmoTlgLzkuLo6ICR7Sihsb2dFbnRyeS52YWx1ZV9uZXcpfWAsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBfLmNsb25lRGVlcChsb2dFbnRyeS52YWx1ZV9uZXcpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYXNlIDI6IOafpeaJvueahOi3r+W+hOaYr+aXpeW/l+adoeebrui3r+W+hOeahOWtkOi3r+W+hCAo5Y2zIGxvZ0VudHJ5LnBhdGgg5piv54i257qnKeOAglxuICAgICAgLy8g5L6L5aaCLCDmn6Xmib4gXCJhLmIuY1wiLCDogIzml6Xlv5fkuK3mnInlr7kgXCJhLmJcIiDnmoTkv67mlLnjgIJcbiAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgobG9nRW50cnkucGF0aCArICcuJykpIHtcbiAgICAgICAgY29uc3Qgc3ViUGF0aCA9IHBhdGguc3Vic3RyaW5nKGxvZ0VudHJ5LnBhdGgubGVuZ3RoICsgMSk7XG4gICAgICAgIGNvbnN0IHBhcmVudE5ld1ZhbCA9IGxvZ0VudHJ5LnZhbHVlX25ldztcbiAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXJlbnROZXdWYWwpICYmIF8uaGFzKHBhcmVudE5ld1ZhbCwgc3ViUGF0aCkpIHtcbiAgICAgICAgICBjb25zdCBmb3VuZFZhbCA9IF8uZ2V0KHBhcmVudE5ld1ZhbCwgc3ViUGF0aCk7XG4gICAgICAgICAgbG9nZ2VyPy5kZWJ1ZyhcbiAgICAgICAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgICAgICAgYD4+IOaIkOWKnyEg5Zyo5raI5oGvKElEOiR7bWVzc2FnZS5tZXNzYWdlX2lkfSwgTUs6JHtta30p5Lit5om+5Yiw54i257qn6Lev5b6EIDwke2xvZ0VudHJ5LnBhdGh9Piwg5bm25LuO5Lit5o+Q5Y+W5a2Q6Lev5b6EIDwke3N1YlBhdGh9PiDnmoTlgLzkuLo6ICR7Sihmb3VuZFZhbCl9YCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBfLmNsb25lRGVlcChmb3VuZFZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyDlpoLmnpzov73muq/liLDogYrlpKnorrDlvZXnmoTlvIDlpLTpg73mnKrmib7liLDvvIzor7TmmI7ov5nmmK/or6Xlj5jph4/nmoTpppbmrKHlh7rnjrDjgIJcbiAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYOWQkeS4iui/vea6r+acquaJvuWIsOi3r+W+hCAke3BhdGh9IOeahOS7u+S9leWOhuWPsuWAvO+8jOWwhuS9v+eUqCBudWxsIOS9nOS4uuaXp+WAvGApO1xuICByZXR1cm4gbnVsbDtcbn1cblxuLypcbiAqIOaXp+eahCBjYWxpYnJhdGUg5Ye95pWw77yM5YW25qC45b+D5oCd5oOz5bey6KKr5ZC45pS26L+bIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg55qE5L+d6Zmp5py65Yi25Lit44CCXG4gKiDmraTlpITnmoTms6jph4rooqvkv53nlZnvvIzlm6DkuLrlroPmnoHlpb3lnLDop6Pph4rkuoYgRVJBIOahhuaetuWmguS9leW3p+WmmeWcsOW6lOWvuSBTaWxseVRhdmVybiDnmoTkuIDkuKrmoLjlv4PigJzmgKrnmZbigJ3jgIJcbiAqXG4gKiAjIyMg5qCh5YeG5Li75rWB56iL77ya5q+U6L6D4oCc5b2T5YmN5raI5oGv4oCd5LiO4oCc5LiK5qyh6YCJ5Lit55qE5raI5oGv4oCd5bm25Yip55So6YWS6aaG55qE54m55oCn5ben5aaZ5Zyw5L+u5aSN5Y+Y6YeP54q25oCB44CCXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiDov5nmmK8gRVJBIOWPmOmHj+ahhuaetuacgOaguOW/g+eahOWHveaVsOS5i+S4gO+8jOWug+ino+WGs+S6huS4gOS4qumdnuW4uOajmOaJi+eahOmXrumimO+8mioq5Yig6ZmkIHN3aXBlIOaXtueahOWPmOmHj+eKtuaAgeiHquWKqOS/ruWkjSoq44CCXG4gKlxuICogKirphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1Zyk6KipcbiAqIOW9k+WIoOmZpOS4gOadoSBzd2lwZSAo5L6L5aaC77yM5bim5pyJ5Y+Y6YePIGlkPTIg55qE5raI5oGvKSDml7bvvJpcbiAqIDEuICoq5YaF5a655LiO5Y+Y6YeP6ZSZ5L2NKio6IOWQjuS4gOadoSBzd2lwZSAoaWQ9Mykg55qEKirlhoXlrrkqKuS8muKAnOmhtuKAneWIsOiiq+WIoOmZpOeahCBzd2lwZSAoaWQ9Mikg55qE5L2N572u5LiK77yM5L2GKirlj5jph48qKuWNtOS/neeVmeS6hiBpZD0yIOeahOWPmOmHj+OAglxuICogMi4gKirlraTlhL/lj5jph4/mrovnlZkqKjog5Y6f5pys55qEIHN3aXBlIDMg5raI5oGv6Jm954S25Zyo55WM6Z2i5LiK5raI5aSx5LqG77yM5L2G5a6D5a+55bqU55qEKirmtojmga/lj5jph48qKiAoaWQ9Mykg5LuN54S25q6L55WZ5Zyo6IGK5aSp5pWw5o2u5Lit77yM5oiQ5Li64oCc5a2k5YS/5Y+Y6YeP4oCd44CCXG4gKiAzLiAqKuWtpOWEv+WPmOmHj+e7p+aJvyoqOiDlpoLmnpznlKjmiLfmraTml7blho0gc3dpcGUg5LiA5qyh77yM5paw55Sf5oiQ55qEIHN3aXBlIDMg5bCG5LyaKirnu6fmib8qKui/meS4quaui+eVmeeahOWtpOWEv+WPmOmHjyAoaWQ9MynvvIzlr7zoh7TmlrDlhoXlrrnphY3ml6flj5jph4/vvIzov5vkuIDmraXliqDliafnirbmgIHmt7fkubHjgIJcbiAqIDQuICoq57uT5p6cKio6IOaIkeS7rOW+l+WIsOS6huS4gOS4quWGheWuueaYryBpZD0z44CB5Y+Y6YeP5pivIGlkPTIg55qE4oCc5re35ZCI4oCd5raI5oGv77yM5bm25LiU6L+Y5pyJ5LiA5LiqIGlkPTMg55qE5a2k5YS/5Y+Y6YeP6ZqP5pe25Y+v6IO96KKr5paw5raI5oGv57un5om/77yM6YCg5oiQ5Lil6YeN55qE54q25oCB5LiN5LiA6Ie044CCXG4gKiA1LiAqKuaXoOeJueWumuS6i+S7tioqOiDmraTlpJbvvIzov5nkuKrmk43kvZzkuI3kvJrop6blj5Hku7vkvZXni6znibnnmoTkuovku7bvvIzlj6rkvJrop6blj5EgYGNoYXRfaWRfY2hhbmdlZGAg562J6YCa55So5LqL5Lu244CCXG4gKlxuICogKirmnKzlh73mlbDnmoTmoKHlh4blt6forqE6KipcbiAqIOacrOWHveaVsOeyvuehruWcsOWIqeeUqOS6huS4iui/sOKAnOeKtuaAgemUmeS9jeKAneadpeWujOaIkOiHquWKqOS/ruWkje+8mlxuICogMS4gYGNhbGlicmF0ZWAg6KKrIGBjaGF0X2lkX2NoYW5nZWRgIOS6i+S7tuinpuWPkeOAglxuICogMi4g5a6D5qOA5rWL5YiwIGBvbGRNS2Ag5a2Y5ZyoICjlroPorrDlvZXkuobooqvliKDpmaTmtojmga/nmoQgTUvvvIzljbMgaWQ9MiDnmoQgTUsp44CCXG4gKiAzLiAqKuaJp+ihjOWbnua7mioqOiBgYXBwbHlSb2xsYmFja0J5TUsob2xkTUspYCDooqvosIPnlKjvvIzlsIYgaWQ9MiDlvJXlhaXnmoTlj5jph4/kv67mlLnlhajpg6jmkqTplIDjgIJcbiAqIDQuICoq6Kem5Y+R6YeN5YaZKio6IGBldmVudEVtaXQoJ3JvbGxiYWNrX2RvbmVfcmVhcHBseV92YXJfc3RhcnQnKWAg6KKr6Kem5Y+R44CCXG4gKiA1LiBgQXBwbHlWYXJDaGFuZ2VgIOWHveaVsOWTjeW6lOmHjeWGmeS6i+S7tu+8jOivu+WPlioq5b2T5YmNKirmtojmga/nmoQqKuWGheWuuSoqICjnjrDlnKjmmK8gaWQ9MyDnmoTlhoXlrrkp77yM5bm25qC55o2u5a6D6YeN5paw5YaZ5YWl5Y+Y6YeP44CCXG4gKlxuICogKirmnIDnu4jmlYjmnpwqKjog4oCc5Zue5rua5LqG5pen55qEKGlkPTIp77yM6YeN5YaZ5LqG5paw55qEKGlkPTMp4oCd77yM5Y+Y6YeP54q25oCB6KKr5a6M576O5Zyw6Ieq5Yqo5L+u5aSN44CCXG4gKi9cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/rollback.ts\n\n}");
  },
  "./src/ERA变量框架/core/sync.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/core/sync.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceSyncLastAiMessage: () => (/* binding */ forceSyncLastAiMessage),\n/* harmony export */   resyncStateOnHistoryChange: () => (/* binding */ resyncStateOnHistoryChange)\n/* harmony export */ });\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _key_mk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _utils_message__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/message */ \"./src/ERA变量框架/utils/message.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/data */ \"./src/ERA变量框架/utils/data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _crud_patcher__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./crud/patcher */ \"./src/ERA变量框架/core/crud/patcher.ts\");\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_6__.Logger('core-sync');\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg) => {\n    const key = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!key)\n        return null;\n    return key;\n};\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks) => {\n    const { meta: metaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    for (const mk of mks) {\n        if (!mk)\n            continue; // 跳过 null (用户消息)\n        const editLogRaw = _.get(metaData, [_utils_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils_data__WEBPACK_IMPORTED_MODULE_5__.parseEditLog)(editLogRaw);\n        if (editLog.length > 0) {\n            return false; // 发现一个非空 log，直接返回 false\n        }\n    }\n    return true; // 所有 log 都为空\n};\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nconst resyncStateOnHistoryChange = async (forceFullResync = false) => {\n    if (forceFullResync) {\n        logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    }\n    else {\n        logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n    const { meta: oldMetaData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    const oldSelectedMks = _.cloneDeep(_.get(oldMetaData, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []));\n    logger.debug('resyncStateOnHistoryChange', `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`);\n    if (!allMessages || allMessages.length === 0) {\n        logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n        return;\n    }\n    let firstRecalcId = -1;\n    if (forceFullResync) {\n        firstRecalcId = 0;\n        logger.log('resyncStateOnHistoryChange', '强制模式：设置重算起点为 0。');\n    }\n    // Case 1: 消息被删除 (新列表比旧列表短)\n    else if (allMessages.length < oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息删除。');\n        // 从后往前，寻找第一个 \"currentMk === oldMk_at_same_index\" 的对齐点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[删除-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk === recordedMk) {\n                firstRecalcId = i + 1;\n                logger.log('resyncStateOnHistoryChange', `找到对齐点于 message_id=${i} (MK=${currentMk})。将从 ID ${firstRecalcId} 开始检查。`);\n                break;\n            }\n        }\n        if (firstRecalcId === -1) {\n            firstRecalcId = 0;\n            logger.log('resyncStateOnHistoryChange', '未找到任何对齐点，将从头开始检查。');\n        }\n        // 【优化】检查被删除的 MK 是否影响变量\n        // 稳健地找出被删除的 MK：对比新旧 MK 序列的差异\n        const currentMkSequence = allMessages.map(getMkFromMsg).filter(mk => mk);\n        const oldMkSequence = oldSelectedMks.filter(mk => mk);\n        const deletedMks = _.difference(oldMkSequence, currentMkSequence);\n        logger.debug('resyncStateOnHistoryChange', `旧MK序列: [${oldMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `新MK序列: [${currentMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `计算出的被删除MK: [${deletedMks.join(', ')}]`);\n        if (deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks)) {\n            logger.log('resyncStateOnHistoryChange', `检测到被删除的 ${deletedMks.length} 条消息均不含变量修改，执行快速同步。`);\n            const newSelectedMks = [];\n            for (let i = 0; i < allMessages.length; i++) {\n                newSelectedMks[i] = getMkFromMsg(allMessages[i]);\n            }\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n                return meta;\n            });\n            logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n            return;\n        }\n    }\n    // Case 2: 消息被修改/切换 (长度不变)\n    else if (allMessages.length === oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息长度不变，可能为修改或切换。');\n        // 从后往前，寻找第一个不匹配的点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[切换-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk !== recordedMk) {\n                firstRecalcId = i;\n            }\n        }\n        if (firstRecalcId === -1) {\n            logger.log('resyncStateOnHistoryChange', '所有MK均匹配，无需重算。');\n            // N.B. 在当前架构下，MK 已被直接写入消息内容，与内容强绑定。\n            // 因此，任何导致内容变化的操作（如 swipe）也必然会导致 MK 的变化。\n            // 这意味着，如果 MK 序列完全匹配，那么内容也必然完全匹配，无需进行任何重算或保险性检查。\n            return; // 直接返回，终止同步。\n        }\n        else {\n            logger.log('resyncStateOnHistoryChange', `找到最早的不匹配点于 message_id=${firstRecalcId}。将从该点开始重算。`);\n        }\n    }\n    // Case 3: 消息被添加 (新列表比旧列表长)\n    else {\n        logger.log('resyncStateOnHistoryChange', '检测到消息添加。');\n        // 将重算起点设置为新消息的起始索引，让同步流程统一处理\n        firstRecalcId = oldSelectedMks.length;\n        logger.log('resyncStateOnHistoryChange', `新增消息的写入逻辑已由同步流程接管。将从新增消息 (ID: ${firstRecalcId}) 开始处理。`);\n    }\n    // 3. 收集需要回滚的 MK 列表，并执行逆序回滚\n    if (firstRecalcId > -1) {\n        const mksToRollback = oldSelectedMks.slice(firstRecalcId).filter(mk => mk);\n        if (mksToRollback.length > 0) {\n            logger.log('resyncStateOnHistoryChange', `准备回滚 ${mksToRollback.length} 个MK: [${mksToRollback.join(', ')}]`);\n            for (const mk of mksToRollback.reverse()) {\n                logger.debug('resyncStateOnHistoryChange', `[回滚] 正在回滚 MK: ${mk}`);\n                await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(mk, true); // true 表示只回滚，不重写\n            }\n            logger.log('resyncStateOnHistoryChange', '逆序回滚完成。');\n        }\n    }\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n        const msg = allMessages[i];\n        logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}`);\n        const newMk = await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        newSelectedMks[i] = newMk; // 使用重算后的新 message_id (即 i) 作为索引\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n    // 5. 更新 SelectedMks 数组\n    await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n        _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n        return meta;\n    });\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n    // ==================================================================\n    // 【保险机制】 - 已于 2025/10/02 移除\n    //\n    // **历史原因**:\n    // 该机制最初是为了解决一个旧架构下的“内容-变量错位”问题。在旧架构中，当删除一条 swipe 时，\n    // 后一条 swipe 的内容会“顶替”上来，但其底层的消息变量（及其 MK）却保持不变。\n    // 这导致主同步逻辑的 MK 比对失效，无法发现状态变化。\n    // 为此，保险机制被设计为：通过 `oldSelectedMks`（状态变更前的快照）找到被删除的旧 MK，\n    // 强制回滚它，然后根据当前可见的新内容重新写入变量，从而修复错位。\n    //\n    // **当前架构下的情况与移除原因**:\n    // 在当前架构中，MK 已被直接写入消息内容，与内容强绑定。当 swipe 导致内容变化时，MK 也会随之变化。\n    // 这使得主同步逻辑（逆序回滚、顺序重算）已经能够完全、正确地处理 swipe 等场景，不再需要此保险机制。\n    //\n    // 继续保留该机制不仅是冗余的，而且会主动引发 Bug：\n    // 它依然按照旧逻辑，使用 `oldSelectedMks` 回滚一个过时的、不相关的 MK，这会破坏主逻辑刚刚同步好的正确状态。\n    // 随后，在被破坏的状态上进行的重写操作会失败或产生错误结果（例如，生成一个空的 EditLog），\n    // 并覆盖掉之前由主逻辑正确生成的 EditLog，导致数据丢失。\n    //\n    // 综上，该机制已从“保险”变为“风险”，因此被完全注释掉。\n    // ==================================================================\n    // logger.log('resyncStateOnHistoryChange', '执行【保险机制】：无条件回滚并重写最后一楼...');\n    // const lastWrittenMk = [...oldSelectedMks].reverse().find(mk => mk);\n    // if (lastWrittenMk) {\n    //   logger.log('resyncStateOnHistoryChange', `找到最后一个写入的MK: ${lastWrittenMk}，执行回滚...`);\n    //   await rollbackByMk(lastWrittenMk, true);\n    //   logger.log('resyncStateOnHistoryChange', '回滚完成，准备根据当前最后一楼内容重写...');\n    //   await ApplyVarChange(); // ApplyVarChange 默认处理最后一楼\n    //   logger.log('resyncStateOnHistoryChange', '保险性重写完成。');\n    // } else {\n    //   logger.log('resyncStateOnHistoryChange', '未找到任何可供回滚的旧MK，跳过保险机制。');\n    // }\n};\n/**\n * **【强制同步最后一条AI消息】**\n * 这是一个用于特定场景的函数，例如由外部 API 触发，需要强制重算最后一条 AI 消息的变量。\n * 它解决了在消息内容被外部修改（但 MK 未变）时，状态无法自动更新的问题。\n *\n * **执行逻辑**:\n * 1. **定位**: 找到最后一条 AI 消息。\n * 2. **回滚**: 如果该消息存在且有 MK，则无条件回滚此 MK 引入的所有变量修改。\n * 3. **重算**: 立即根据该消息的**当前内容**重新计算变量，并生成新的 `EditLog`。\n * 4. **更新**: 将新的 MK 更新到 `SelectedMks` 数组的正确位置。\n *\n * **安全性**:\n * 此函数操作目标明确（最后一条 AI 消息），且回滚和重算在同一调用链中完成，\n * 避免了旧“保险机制”中因目标不明确而破坏 `resync` 状态的风险。\n */\nconst forceSyncLastAiMessage = async () => {\n    logger.log('forceSyncLastAiMessage', '启动强制同步最后一条 AI 消息...');\n    // 1. 定位\n    const msg = (0,_utils_message__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.warn('forceSyncLastAiMessage', '未找到可供强制同步的 AI 消息。');\n        return;\n    }\n    const messageId = msg.message_id;\n    const MK = (0,_key_mk__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!MK) {\n        logger.warn('forceSyncLastAiMessage', `消息 (ID: ${messageId}) 不含 MK，无法执行强制同步。将转为执行常规写入...`);\n        // 如果没有 MK，说明是新消息，直接走标准写入流程即可\n        await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n        return;\n    }\n    logger.log('forceSyncLastAiMessage', `目标消息 (ID: ${messageId}, MK: ${MK})。`);\n    // 2. 回滚\n    logger.debug('forceSyncLastAiMessage', `正在回滚 MK: ${MK}...`);\n    await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(MK, true); // silent=true，避免不必要的日志刷新\n    // 3. 重算\n    logger.debug('forceSyncLastAiMessage', `回滚完成，正在根据当前内容重算 MK: ${MK}...`);\n    const newMK = await (0,_crud_patcher__WEBPACK_IMPORTED_MODULE_7__.ApplyVarChangeForMessage)(msg);\n    // 4. 更新 SelectedMks\n    if (newMK) {\n        try {\n            await (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                const selectedMks = _.get(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n                selectedMks[messageId] = newMK;\n                _.set(meta, _utils_constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n                return meta;\n            });\n            logger.log('forceSyncLastAiMessage', `强制同步完成，已更新 SelectedMks[${messageId}] = ${newMK}`);\n        }\n        catch (e) {\n            logger.error('forceSyncLastAiMessage', `强制同步后更新 SelectedMks 失败: ${e?.message || e}`, e);\n        }\n    }\n    else {\n        logger.error('forceSyncLastAiMessage', `重算后未能获取新的 MK，SelectedMks 可能未更新。`);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvc3luYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWE7QUFFYjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFFc0Q7QUFDZjtBQUNXO0FBQ1g7QUFDd0I7QUFDckI7QUFDUDtBQUNvQjtBQUUxRCxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFdkM7Ozs7R0FJRztBQUNILE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBUSxFQUFpQixFQUFFO0lBQy9DLE1BQU0sR0FBRyxHQUFHLHVEQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEMsSUFBSSxDQUFDLEdBQUc7UUFBRSxPQUFPLElBQUksQ0FBQztJQUV0QixPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSCxNQUFNLHFCQUFxQixHQUFHLENBQUMsR0FBc0IsRUFBVyxFQUFFO0lBQ2hFLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsMkRBQVUsRUFBRSxDQUFDO0lBQ3hDLEtBQUssTUFBTSxFQUFFLElBQUksR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLEVBQUU7WUFBRSxTQUFTLENBQUMsaUJBQWlCO1FBQ3BDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsdURBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sT0FBTyxHQUFHLHlEQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE9BQU8sS0FBSyxDQUFDLENBQUMsd0JBQXdCO1FBQ3hDLENBQUM7SUFDSCxDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUMsQ0FBQyxhQUFhO0FBQzVCLENBQUMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSSxNQUFNLDBCQUEw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Q3ZFLE1BQU0sS0FBSyxHQUFHLE1BQU0sdUVBQXdCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFbEQsb0JBQW9CO0lBQ3BCLElBQUksS0FBSyxFQUFFLENBQUM7UUFDVixJQUFJLENBQUM7WUFDSCxNQUFNLGtFQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDO2dCQUMvQixDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxzREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUNuQyxPQUFPLElBQUksQ0FBQztZQUNkLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSwwQkFBMEIsU0FBUyxPQUFPLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDMUYsQ0FBQztRQUFDLE9BQU8sQ0FBTSxFQUFFLENBQUM7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSwyQkFBMkIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMxRixDQUFDO0lBQ0gsQ0FBQztTQUFNLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLGlDQUFpQyxDQUFDLENBQUM7SUFDNUUsQ0FBQztBQUNILENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvc3luYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGZpbGUg54q25oCB5ZCM5q2l5qC45b+DXG4gKiBAZGVzY3JpcHRpb24g5pys5paH5Lu25Lit55qEIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg5pivIEVSQSDlj5jph4/moYbmnrbmnIDmoLjlv4PnmoTlh73mlbDkuYvkuIDjgIJcbiAqIOWug+mAmui/h+WunueOsOKAnOmAhuW6j+Wbnua7mu+8jOmhuuW6j+mHjeeul+KAneeahOmAu+i+ke+8jOino+WGs+S6huWboOa2iOaBr+WIoOmZpOOAgeWIh+aNouWIhuaUryAoc3dpcGUpIOetieaTjeS9nOWvvOiHtOeahOWPmOmHj+eKtuaAgeS4jua2iOaBr+WOhuWPsuS4jeS4gOiHtOeahOajmOaJi+mXrumimOOAglxuICpcbiAqICMjIyDphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1ZylcbiAqXG4gKiDlvZPliKDpmaTkuIDmnaEgc3dpcGUgKOS+i+Wmgu+8jOW4puacieWPmOmHjyBpZD0yIOeahOa2iOaBrykg5pe277yaXG4gKiAxLiAqKuWGheWuueS4juWPmOmHj+mUmeS9jSoqOiDlkI7kuIDmnaEgc3dpcGUgKGlkPTMpIOeahCoq5YaF5a65KirkvJrigJzpobbigJ3liLDooqvliKDpmaTnmoQgc3dpcGUgKGlkPTIpIOeahOS9jee9ruS4iu+8jOS9hioq5Y+Y6YePKirljbTkv53nlZnkuoYgaWQ9MiDnmoTlj5jph4/jgIJcbiAqIDIuICoq5a2k5YS/5Y+Y6YeP5q6L55WZKio6IOWOn+acrOeahCBzd2lwZSAzIOa2iOaBr+iZveeEtuWcqOeVjOmdouS4iua2iOWkseS6hu+8jOS9huWug+WvueW6lOeahCoq5raI5oGv5Y+Y6YePKiogKGlkPTMpIOS7jeeEtuaui+eVmeWcqOiBiuWkqeaVsOaNruS4re+8jOaIkOS4uuKAnOWtpOWEv+WPmOmHj+KAneOAglxuICogMy4gKirlraTlhL/lj5jph4/nu6fmib8qKjog5aaC5p6c55So5oi35q2k5pe25YaNIHN3aXBlIOS4gOasoe+8jOaWsOeUn+aIkOeahCBzd2lwZSAzIOWwhuS8mioq57un5om/Kirov5nkuKrmrovnlZnnmoTlraTlhL/lj5jph48gKGlkPTMp77yM5a+86Ie05paw5YaF5a656YWN5pen5Y+Y6YeP77yM6L+b5LiA5q2l5Yqg5Ymn54q25oCB5re35Lmx44CCXG4gKiA0LiAqKue7k+aenCoqOiDmiJHku6zlvpfliLDkuobkuIDkuKrlhoXlrrnmmK8gaWQ9M+OAgeWPmOmHj+aYryBpZD0yIOeahOKAnOa3t+WQiOKAnea2iOaBr++8jOW5tuS4lOi/mOacieS4gOS4qiBpZD0zIOeahOWtpOWEv+WPmOmHj+maj+aXtuWPr+iDveiiq+aWsOa2iOaBr+e7p+aJv++8jOmAoOaIkOS4pemHjeeahOeKtuaAgeS4jeS4gOiHtOOAglxuICpcbiAqICMjIyDmnKzlh73mlbDnmoTop6PlhrPnrZbnlaVcbiAqXG4gKiBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOmAmui/h+WFqOmdoueahOeKtuaAgeavlOWvueadpeino+WGs+atpOmXrumimO+8mlxuICogMS4g5ZyoIGBtZXNzYWdlX2RlbGV0ZWRgLCBgbWVzc2FnZV9zd2lwZWRgIOetieS6i+S7tuinpuWPkeaXtuiiq+iwg+eUqOOAglxuICogMi4g5YWo6Z2i6I635Y+W5b2T5YmN5a6e6ZmF55qE5raI5oGv5YiX6KGo77yM5bm25LiO5LmL5YmN6K6w5b2V55qEIGBTZWxlY3RlZE1rc2Ag5bqP5YiX6L+b6KGM5q+U5a+544CCXG4gKiAzLiDnsr7noa7mib7liLDnrKzkuIDkuKrkuI3kuIDoh7TnmoTngrnvvIjml6DorrrmmK/liKDpmaTjgIHov5jmmK/kv67mlLnvvInjgIJcbiAqIDQuICoq6YCG5bqP5Zue5ruaKio6IOS7juWQjuW+gOWJje+8jOWwhuaJgOacieS4jeS4gOiHtOeahCBgTUtgIOaJgOW8leWFpeeahOWPmOmHj+S/ruaUueWFqOmDqOaSpOmUgOOAglxuICogNS4gKirpobrluo/ph43nrpcqKjog5LuO5LiN5LiA6Ie054K55byA5aeL77yM5qC55o2u5b2T5YmN5raI5oGv55qEKirlrp7pmYXlhoXlrrkqKu+8jOmHjeaWsOiuoeeul+W5tuWGmeWFpeWPmOmHj+OAglxuICpcbiAqICoq5pyA57uI5pWI5p6cKio6IOaXoOiuuuWOhuWPsuiusOW9leWPkeeUn+S9leenjeWPmOWMlu+8jOWPmOmHj+eKtuaAgemDveiDveiiq+WujOe+juWcsOiHquWKqOS/ruWkje+8jOehruS/neaVsOaNruS4gOiHtOaAp+OAglxuICovXG5cbmltcG9ydCB7IExPR1NfUEFUSCwgU0VMX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL2tleS9tayc7XG5pbXBvcnQgeyBmaW5kTGFzdEFpTWVzc2FnZSB9IGZyb20gJy4uL3V0aWxzL21lc3NhZ2UnO1xuaW1wb3J0IHsgcm9sbGJhY2tCeU1rIH0gZnJvbSAnLi9yb2xsYmFjayc7XG5pbXBvcnQgeyBnZXRFcmFEYXRhLCB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IHBhcnNlRWRpdExvZyB9IGZyb20gJy4uL3V0aWxzL2RhdGEnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcbmltcG9ydCB7IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZSB9IGZyb20gJy4vY3J1ZC9wYXRjaGVyJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignY29yZS1zeW5jJyk7XG5cbi8qKlxuICog6I635Y+W55So5LqO5Y+Y6YeP5pON5L2c55qETUvjgILlpoLmnpzmtojmga/mmK/nlKjmiLfmtojmga/vvIzliJnov5Tlm55udWxs5Lul6Lez6L+H5pON5L2c44CCXG4gKiBAcGFyYW0gbXNnIOa2iOaBr+WvueixoVxuICogQHJldHVybnMgTUsg5a2X56ym5Liy5oiWIG51bGxcbiAqL1xuY29uc3QgZ2V0TWtGcm9tTXNnID0gKG1zZzogYW55KTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGtleSA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG4gIGlmICgha2V5KSByZXR1cm4gbnVsbDtcblxuICByZXR1cm4ga2V5O1xufTtcblxuLyoqXG4gKiDmo4Dmn6XkuIDnu4QgTUsg5a+55bqU55qEIEVkaXRMb2cg5piv5ZCm6YO95Li656m6XG4gKiBAcGFyYW0gbWtzIE1LIOWIl+ihqFxuICogQHJldHVybnMg5aaC5p6c5omA5pyJIEVkaXRMb2cg6YO95Li656m65YiZ6L+U5ZueIHRydWVcbiAqL1xuY29uc3QgY2hlY2tFZGl0TG9nc0FyZUVtcHR5ID0gKG1rczogKHN0cmluZyB8IG51bGwpW10pOiBib29sZWFuID0+IHtcbiAgY29uc3QgeyBtZXRhOiBtZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICBmb3IgKGNvbnN0IG1rIG9mIG1rcykge1xuICAgIGlmICghbWspIGNvbnRpbnVlOyAvLyDot7Pov4cgbnVsbCAo55So5oi35raI5oGvKVxuICAgIGNvbnN0IGVkaXRMb2dSYXcgPSBfLmdldChtZXRhRGF0YSwgW0xPR1NfUEFUSCwgbWtdKTtcbiAgICBjb25zdCBlZGl0TG9nID0gcGFyc2VFZGl0TG9nKGVkaXRMb2dSYXcpO1xuICAgIGlmIChlZGl0TG9nLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTsgLy8g5Y+R546w5LiA5Liq6Z2e56m6IGxvZ++8jOebtOaOpei/lOWbniBmYWxzZVxuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTsgLy8g5omA5pyJIGxvZyDpg73kuLrnqbpcbn07XG5cbi8qKlxuICog5b2T6IGK5aSp6K6w5b2V5Y+R55Sf5Y+Y5YyW77yI5Yig6Zmk44CB5YiH5o2i5YiG5pSv77yJ5pe277yM6YeN5paw5ZCM5q2l54q25oCB55qE5qC45b+D5Ye95pWwXG4gKiDlrp7njrDkuobigJzpgIbluo/lm57mu5rvvIzpobrluo/ph43nrpfigJ3nmoTpgLvovpFcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlRnVsbFJlc3luYz1mYWxzZV0gLSDlpoLmnpzkuLogdHJ1Ze+8jOWImeW8uuWItuS7juWktOW8gOWni+WujOWFqOmHjeeul++8jOW/veeVpeW3ruW8guajgOa1i+OAglxuICovXG5leHBvcnQgY29uc3QgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgPSBhc3luYyAoZm9yY2VGdWxsUmVzeW5jID0gZmFsc2UpID0+IHtcbiAgaWYgKGZvcmNlRnVsbFJlc3luYykge1xuICAgIGxvZ2dlci53YXJuKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLblrozlhajph43nrpfmqKHlvI/lt7LlkK/liqjvvIEnKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfogYrlpKnorrDlvZXlj5jmm7TvvIzlkK/liqjnirbmgIHlkIzmraUuLi4nKTtcbiAgfVxuXG4gIC8vIOaguOW/g+WBh+iuvu+8mmdldENoYXRNZXNzYWdlcyDkvJrph43mlrDnlJ/miJAgbWVzc2FnZV9pZO+8jOS9v+WFtuS/neaMgeS7jiAwIOW8gOWni+eahOi/nue7reW6j+WIl+OAglxuICBjb25zdCBhbGxNZXNzYWdlcyA9IGdldENoYXRNZXNzYWdlcygnMC17e2xhc3RNZXNzYWdlSWR9fScsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk7XG4gIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn6I635Y+W5Yiw55qEIGFsbE1lc3NhZ2VzOicsIGFsbE1lc3NhZ2VzKTtcbiAgY29uc3QgeyBtZXRhOiBvbGRNZXRhRGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICBjb25zdCBvbGRTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBfLmNsb25lRGVlcChfLmdldChvbGRNZXRhRGF0YSwgU0VMX1BBVEgsIFtdKSk7XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgYOeKtuaAgeW/q+eFpzogb2xkU2VsZWN0ZWRNa3MubGVuZ3RoPSR7b2xkU2VsZWN0ZWRNa3MubGVuZ3RofSwgYWxsTWVzc2FnZXMubGVuZ3RoPSR7YWxsTWVzc2FnZXM/Lmxlbmd0aCA/PyAwfWAsXG4gICk7XG5cbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvZPliY3ogYrlpKnorrDlvZXkuLrnqbrvvIzkuI3miafooYzku7vkvZXmk43kvZzvvIzlkIzmraXnu4jmraLjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgZmlyc3RSZWNhbGNJZCA9IC0xO1xuXG4gIGlmIChmb3JjZUZ1bGxSZXN5bmMpIHtcbiAgICBmaXJzdFJlY2FsY0lkID0gMDtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflvLrliLbmqKHlvI/vvJrorr7nva7ph43nrpfotbfngrnkuLogMOOAgicpO1xuICB9XG4gIC8vIENhc2UgMTog5raI5oGv6KKr5Yig6ZmkICjmlrDliJfooajmr5Tml6fliJfooajnn60pXG4gIGVsc2UgaWYgKGFsbE1lc3NhZ2VzLmxlbmd0aCA8IG9sZFNlbGVjdGVkTWtzLmxlbmd0aCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+WIoOmZpOOAgicpO1xuICAgIC8vIOS7juWQjuW+gOWJje+8jOWvu+aJvuesrOS4gOS4qiBcImN1cnJlbnRNayA9PT0gb2xkTWtfYXRfc2FtZV9pbmRleFwiIOeahOWvuem9kOeCuVxuICAgIGZvciAobGV0IGkgPSBhbGxNZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgY3VycmVudE1rID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIGNvbnN0IHJlY29yZGVkTWsgPSBvbGRTZWxlY3RlZE1rc1tpXTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgICAgYFvliKDpmaQt5a+56b2Q5qOA5p+lXSBpPSR7aX0sIGN1cnJlbnRNaz0ke2N1cnJlbnRNa30sIHJlY29yZGVkTWs9JHtyZWNvcmRlZE1rfWAsXG4gICAgICApO1xuXG4gICAgICBpZiAoY3VycmVudE1rID09PSByZWNvcmRlZE1rKSB7XG4gICAgICAgIGZpcnN0UmVjYWxjSWQgPSBpICsgMTtcbiAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICAgIGDmib7liLDlr7npvZDngrnkuo4gbWVzc2FnZV9pZD0ke2l9IChNSz0ke2N1cnJlbnRNa30p44CC5bCG5LuOIElEICR7Zmlyc3RSZWNhbGNJZH0g5byA5aeL5qOA5p+l44CCYCxcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgZmlyc3RSZWNhbGNJZCA9IDA7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlr7npvZDngrnvvIzlsIbku47lpLTlvIDlp4vmo4Dmn6XjgIInKTtcbiAgICB9XG5cbiAgICAvLyDjgJDkvJjljJbjgJHmo4Dmn6XooqvliKDpmaTnmoQgTUsg5piv5ZCm5b2x5ZON5Y+Y6YePXG4gICAgLy8g56iz5YGl5Zyw5om+5Ye66KKr5Yig6Zmk55qEIE1L77ya5a+55q+U5paw5penIE1LIOW6j+WIl+eahOW3ruW8glxuICAgIGNvbnN0IGN1cnJlbnRNa1NlcXVlbmNlID0gYWxsTWVzc2FnZXMubWFwKGdldE1rRnJvbU1zZykuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBvbGRNa1NlcXVlbmNlID0gb2xkU2VsZWN0ZWRNa3MuZmlsdGVyKG1rID0+IG1rKTtcbiAgICBjb25zdCBkZWxldGVkTWtzID0gXy5kaWZmZXJlbmNlKG9sZE1rU2VxdWVuY2UsIGN1cnJlbnRNa1NlcXVlbmNlKTtcblxuICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5penTUvluo/liJc6IFske29sZE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmlrBNS+W6j+WIlzogWyR7Y3VycmVudE1rU2VxdWVuY2Uuam9pbignLCAnKX1dYCk7XG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDorqHnrpflh7rnmoTooqvliKDpmaRNSzogWyR7ZGVsZXRlZE1rcy5qb2luKCcsICcpfV1gKTtcblxuICAgIGlmIChkZWxldGVkTWtzLmxlbmd0aCA+IDAgJiYgY2hlY2tFZGl0TG9nc0FyZUVtcHR5KGRlbGV0ZWRNa3MpKSB7XG4gICAgICBsb2dnZXIubG9nKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBg5qOA5rWL5Yiw6KKr5Yig6Zmk55qEICR7ZGVsZXRlZE1rcy5sZW5ndGh9IOadoea2iOaBr+Wdh+S4jeWQq+WPmOmHj+S/ruaUue+8jOaJp+ihjOW/q+mAn+WQjOatpeOAgmAsXG4gICAgICApO1xuICAgICAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbE1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG5ld1NlbGVjdGVkTWtzW2ldID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgbmV3U2VsZWN0ZWRNa3MpO1xuICAgICAgICByZXR1cm4gbWV0YTtcbiAgICAgIH0pO1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5b+r6YCf5ZCM5q2l5a6M5oiQ77yM5LuF5L+u5q2jIFNlbGVjdGVkTWtzIOaVsOe7hOOAgicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICAvLyBDYXNlIDI6IOa2iOaBr+iiq+S/ruaUuS/liIfmjaIgKOmVv+W6puS4jeWPmClcbiAgZWxzZSBpZiAoYWxsTWVzc2FnZXMubGVuZ3RoID09PSBvbGRTZWxlY3RlZE1rcy5sZW5ndGgpIHtcbiAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmo4DmtYvliLDmtojmga/plb/luqbkuI3lj5jvvIzlj6/og73kuLrkv67mlLnmiJbliIfmjaLjgIInKTtcbiAgICAvLyDku47lkI7lvoDliY3vvIzlr7vmib7nrKzkuIDkuKrkuI3ljLnphY3nmoTngrlcbiAgICBmb3IgKGxldCBpID0gYWxsTWVzc2FnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRNayA9IGdldE1rRnJvbU1zZyhhbGxNZXNzYWdlc1tpXSk7XG4gICAgICBjb25zdCByZWNvcmRlZE1rID0gb2xkU2VsZWN0ZWRNa3NbaV07XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgIGBb5YiH5o2iLeWvuem9kOajgOafpV0gaT0ke2l9LCBjdXJyZW50TWs9JHtjdXJyZW50TWt9LCByZWNvcmRlZE1rPSR7cmVjb3JkZWRNa31gLFxuICAgICAgKTtcbiAgICAgIGlmIChjdXJyZW50TWsgIT09IHJlY29yZGVkTWspIHtcbiAgICAgICAgZmlyc3RSZWNhbGNJZCA9IGk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChmaXJzdFJlY2FsY0lkID09PSAtMSkge1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5omA5pyJTUvlnYfljLnphY3vvIzml6DpnIDph43nrpfjgIInKTtcbiAgICAgIC8vIE4uQi4g5Zyo5b2T5YmN5p625p6E5LiL77yMTUsg5bey6KKr55u05o6l5YaZ5YWl5raI5oGv5YaF5a6577yM5LiO5YaF5a655by657uR5a6a44CCXG4gICAgICAvLyDlm6DmraTvvIzku7vkvZXlr7zoh7TlhoXlrrnlj5jljJbnmoTmk43kvZzvvIjlpoIgc3dpcGXvvInkuZ/lv4XnhLbkvJrlr7zoh7QgTUsg55qE5Y+Y5YyW44CCXG4gICAgICAvLyDov5nmhI/lkbPnnYDvvIzlpoLmnpwgTUsg5bqP5YiX5a6M5YWo5Yy56YWN77yM6YKj5LmI5YaF5a655Lmf5b+F54S25a6M5YWo5Yy56YWN77yM5peg6ZyA6L+b6KGM5Lu75L2V6YeN566X5oiW5L+d6Zmp5oCn5qOA5p+l44CCXG4gICAgICByZXR1cm47IC8vIOebtOaOpei/lOWbnu+8jOe7iOatouWQjOatpeOAglxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDml6nnmoTkuI3ljLnphY3ngrnkuo4gbWVzc2FnZV9pZD0ke2ZpcnN0UmVjYWxjSWR944CC5bCG5LuO6K+l54K55byA5aeL6YeN566X44CCYCk7XG4gICAgfVxuICB9XG4gIC8vIENhc2UgMzog5raI5oGv6KKr5re75YqgICjmlrDliJfooajmr5Tml6fliJfooajplb8pXG4gIGVsc2Uge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+a3u+WKoOOAgicpO1xuICAgIC8vIOWwhumHjeeul+i1t+eCueiuvue9ruS4uuaWsOa2iOaBr+eahOi1t+Wni+e0ouW8le+8jOiuqeWQjOatpea1geeoi+e7n+S4gOWkhOeQhlxuICAgIGZpcnN0UmVjYWxjSWQgPSBvbGRTZWxlY3RlZE1rcy5sZW5ndGg7XG4gICAgbG9nZ2VyLmxvZyhcbiAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICBg5paw5aKe5raI5oGv55qE5YaZ5YWl6YC76L6R5bey55Sx5ZCM5q2l5rWB56iL5o6l566h44CC5bCG5LuO5paw5aKe5raI5oGvIChJRDogJHtmaXJzdFJlY2FsY0lkfSkg5byA5aeL5aSE55CG44CCYCxcbiAgICApO1xuICB9XG5cbiAgLy8gMy4g5pS26ZuG6ZyA6KaB5Zue5rua55qEIE1LIOWIl+ihqO+8jOW5tuaJp+ihjOmAhuW6j+Wbnua7mlxuICBpZiAoZmlyc3RSZWNhbGNJZCA+IC0xKSB7XG4gICAgY29uc3QgbWtzVG9Sb2xsYmFjayA9IG9sZFNlbGVjdGVkTWtzLnNsaWNlKGZpcnN0UmVjYWxjSWQpLmZpbHRlcihtayA9PiBtaykgYXMgc3RyaW5nW107XG4gICAgaWYgKG1rc1RvUm9sbGJhY2subGVuZ3RoID4gMCkge1xuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBg5YeG5aSH5Zue5ruaICR7bWtzVG9Sb2xsYmFjay5sZW5ndGh9IOS4qk1LOiBbJHtta3NUb1JvbGxiYWNrLmpvaW4oJywgJyl9XWApO1xuICAgICAgZm9yIChjb25zdCBtayBvZiBta3NUb1JvbGxiYWNrLnJldmVyc2UoKSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvlm57mu5pdIOato+WcqOWbnua7miBNSzogJHtta31gKTtcbiAgICAgICAgYXdhaXQgcm9sbGJhY2tCeU1rKG1rLCB0cnVlKTsgLy8gdHJ1ZSDooajnpLrlj6rlm57mu5rvvIzkuI3ph43lhplcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+mAhuW6j+Wbnua7muWujOaIkOOAgicpO1xuICAgIH1cbiAgfVxuXG4gIC8vIDQuIOS7juS4jeWMuemFjeeCueW8gOWni++8jOmhuuW6j+mHjeaWsOW6lOeUqOWPmOmHj+S/ruaUue+8jOW5tuaehOW7uuaWsOeahCBzZWxlY3RlZE1rc1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDku44gSUQgJHtmaXJzdFJlY2FsY0lkfSDlvIDlp4vpobrluo/ph43nrpcuLi5gKTtcbiAgY29uc3QgbmV3U2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdID0gb2xkU2VsZWN0ZWRNa3Muc2xpY2UoMCwgZmlyc3RSZWNhbGNJZCk7IC8vIOe7p+aJv+WMuemFjemDqOWIhlxuXG4gIGZvciAobGV0IGkgPSBmaXJzdFJlY2FsY0lkOyBpIDwgYWxsTWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBtc2cgPSBhbGxNZXNzYWdlc1tpXTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYFvph43nrpddIOato+WcqOWkhOeQhua2iOaBr+e0ouW8lTogJHtpfWApO1xuICAgIGNvbnN0IG5ld01rID0gYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4gICAgbmV3U2VsZWN0ZWRNa3NbaV0gPSBuZXdNazsgLy8g5L2/55So6YeN566X5ZCO55qE5pawIG1lc3NhZ2VfaWQgKOWNsyBpKSDkvZzkuLrntKLlvJVcbiAgfVxuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfpobrluo/ph43nrpflrozmiJDjgIInKTtcblxuICAvLyA1LiDmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uEXG4gIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBuZXdTZWxlY3RlZE1rcyk7XG4gICAgcmV0dXJuIG1ldGE7XG4gIH0pO1xuICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfnirbmgIHlkIzmraXlrozmiJDjgIInKTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g44CQ5L+d6Zmp5py65Yi244CRIC0g5bey5LqOIDIwMjUvMTAvMDIg56e76ZmkXG4gIC8vXG4gIC8vICoq5Y6G5Y+y5Y6f5ZugKio6XG4gIC8vIOivpeacuuWItuacgOWIneaYr+S4uuS6huino+WGs+S4gOS4quaXp+aetuaehOS4i+eahOKAnOWGheWuuS3lj5jph4/plJnkvY3igJ3pl67popjjgILlnKjml6fmnrbmnoTkuK3vvIzlvZPliKDpmaTkuIDmnaEgc3dpcGUg5pe277yMXG4gIC8vIOWQjuS4gOadoSBzd2lwZSDnmoTlhoXlrrnkvJrigJzpobbmm7/igJ3kuIrmnaXvvIzkvYblhbblupXlsYLnmoTmtojmga/lj5jph4/vvIjlj4rlhbYgTUvvvInljbTkv53mjIHkuI3lj5jjgIJcbiAgLy8g6L+Z5a+86Ie05Li75ZCM5q2l6YC76L6R55qEIE1LIOavlOWvueWkseaViO+8jOaXoOazleWPkeeOsOeKtuaAgeWPmOWMluOAglxuICAvLyDkuLrmraTvvIzkv53pmanmnLrliLbooqvorr7orqHkuLrvvJrpgJrov4cgYG9sZFNlbGVjdGVkTWtzYO+8iOeKtuaAgeWPmOabtOWJjeeahOW/q+eFp++8ieaJvuWIsOiiq+WIoOmZpOeahOaXpyBNS++8jFxuICAvLyDlvLrliLblm57mu5rlroPvvIznhLblkI7moLnmja7lvZPliY3lj6/op4HnmoTmlrDlhoXlrrnph43mlrDlhpnlhaXlj5jph4/vvIzku47ogIzkv67lpI3plJnkvY3jgIJcbiAgLy9cbiAgLy8gKirlvZPliY3mnrbmnoTkuIvnmoTmg4XlhrXkuI7np7vpmaTljp/lm6AqKjpcbiAgLy8g5Zyo5b2T5YmN5p625p6E5Lit77yMTUsg5bey6KKr55u05o6l5YaZ5YWl5raI5oGv5YaF5a6577yM5LiO5YaF5a655by657uR5a6a44CC5b2TIHN3aXBlIOWvvOiHtOWGheWuueWPmOWMluaXtu+8jE1LIOS5n+S8mumaj+S5i+WPmOWMluOAglxuICAvLyDov5nkvb/lvpfkuLvlkIzmraXpgLvovpHvvIjpgIbluo/lm57mu5rjgIHpobrluo/ph43nrpfvvInlt7Lnu4/og73lpJ/lrozlhajjgIHmraPnoa7lnLDlpITnkIYgc3dpcGUg562J5Zy65pmv77yM5LiN5YaN6ZyA6KaB5q2k5L+d6Zmp5py65Yi244CCXG4gIC8vXG4gIC8vIOe7p+e7reS/neeVmeivpeacuuWItuS4jeS7heaYr+WGl+S9meeahO+8jOiAjOS4lOS8muS4u+WKqOW8leWPkSBCdWfvvJpcbiAgLy8g5a6D5L6d54S25oyJ54Wn5pen6YC76L6R77yM5L2/55SoIGBvbGRTZWxlY3RlZE1rc2Ag5Zue5rua5LiA5Liq6L+H5pe255qE44CB5LiN55u45YWz55qEIE1L77yM6L+Z5Lya56C05Z2P5Li76YC76L6R5Yia5Yia5ZCM5q2l5aW955qE5q2j56Gu54q25oCB44CCXG4gIC8vIOmaj+WQju+8jOWcqOiiq+egtOWdj+eahOeKtuaAgeS4iui/m+ihjOeahOmHjeWGmeaTjeS9nOS8muWksei0peaIluS6p+eUn+mUmeivr+e7k+aenO+8iOS+i+Wmgu+8jOeUn+aIkOS4gOS4quepuueahCBFZGl0TG9n77yJ77yMXG4gIC8vIOW5tuimhuebluaOieS5i+WJjeeUseS4u+mAu+i+keato+ehrueUn+aIkOeahCBFZGl0TG9n77yM5a+86Ie05pWw5o2u5Lii5aSx44CCXG4gIC8vXG4gIC8vIOe7vOS4iu+8jOivpeacuuWItuW3suS7juKAnOS/nemZqeKAneWPmOS4uuKAnOmjjumZqeKAne+8jOWboOatpOiiq+WujOWFqOazqOmHiuaOieOAglxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5omn6KGM44CQ5L+d6Zmp5py65Yi244CR77ya5peg5p2h5Lu25Zue5rua5bm26YeN5YaZ5pyA5ZCO5LiA5qW8Li4uJyk7XG4gIC8vIGNvbnN0IGxhc3RXcml0dGVuTWsgPSBbLi4ub2xkU2VsZWN0ZWRNa3NdLnJldmVyc2UoKS5maW5kKG1rID0+IG1rKTtcbiAgLy8gaWYgKGxhc3RXcml0dGVuTWspIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDmib7liLDmnIDlkI7kuIDkuKrlhpnlhaXnmoRNSzogJHtsYXN0V3JpdHRlbk1rfe+8jOaJp+ihjOWbnua7mi4uLmApO1xuICAvLyAgIGF3YWl0IHJvbGxiYWNrQnlNayhsYXN0V3JpdHRlbk1rLCB0cnVlKTtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflm57mu5rlrozmiJDvvIzlh4blpIfmoLnmja7lvZPliY3mnIDlkI7kuIDmpbzlhoXlrrnph43lhpkuLi4nKTtcbiAgLy8gICBhd2FpdCBBcHBseVZhckNoYW5nZSgpOyAvLyBBcHBseVZhckNoYW5nZSDpu5jorqTlpITnkIbmnIDlkI7kuIDmpbxcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfkv53pmanmgKfph43lhpnlrozmiJDjgIInKTtcbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmnKrmib7liLDku7vkvZXlj6/kvpvlm57mu5rnmoTml6dNS++8jOi3s+i/h+S/nemZqeacuuWItuOAgicpO1xuICAvLyB9XG59O1xuXG4vKipcbiAqICoq44CQ5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hQUnmtojmga/jgJEqKlxuICog6L+Z5piv5LiA5Liq55So5LqO54m55a6a5Zy65pmv55qE5Ye95pWw77yM5L6L5aaC55Sx5aSW6YOoIEFQSSDop6blj5HvvIzpnIDopoHlvLrliLbph43nrpfmnIDlkI7kuIDmnaEgQUkg5raI5oGv55qE5Y+Y6YeP44CCXG4gKiDlroPop6PlhrPkuoblnKjmtojmga/lhoXlrrnooqvlpJbpg6jkv67mlLnvvIjkvYYgTUsg5pyq5Y+Y77yJ5pe277yM54q25oCB5peg5rOV6Ieq5Yqo5pu05paw55qE6Zeu6aKY44CCXG4gKlxuICogKirmiafooYzpgLvovpEqKjpcbiAqIDEuICoq5a6a5L2NKio6IOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIDIuICoq5Zue5ruaKio6IOWmguaenOivpea2iOaBr+WtmOWcqOS4lOaciSBNS++8jOWImeaXoOadoeS7tuWbnua7muatpCBNSyDlvJXlhaXnmoTmiYDmnInlj5jph4/kv67mlLnjgIJcbiAqIDMuICoq6YeN566XKio6IOeri+WNs+agueaNruivpea2iOaBr+eahCoq5b2T5YmN5YaF5a65Kirph43mlrDorqHnrpflj5jph4/vvIzlubbnlJ/miJDmlrDnmoQgYEVkaXRMb2dg44CCXG4gKiA0LiAqKuabtOaWsCoqOiDlsIbmlrDnmoQgTUsg5pu05paw5YiwIGBTZWxlY3RlZE1rc2Ag5pWw57uE55qE5q2j56Gu5L2N572u44CCXG4gKlxuICogKirlronlhajmgKcqKjpcbiAqIOatpOWHveaVsOaTjeS9nOebruagh+aYjuehru+8iOacgOWQjuS4gOadoSBBSSDmtojmga/vvInvvIzkuJTlm57mu5rlkozph43nrpflnKjlkIzkuIDosIPnlKjpk77kuK3lrozmiJDvvIxcbiAqIOmBv+WFjeS6huaXp+KAnOS/nemZqeacuuWItuKAneS4reWboOebruagh+S4jeaYjuehruiAjOegtOWdjyBgcmVzeW5jYCDnirbmgIHnmoTpo47pmanjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IGZvcmNlU3luY0xhc3RBaU1lc3NhZ2UgPSBhc3luYyAoKSA9PiB7XG4gIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5ZCv5Yqo5by65Yi25ZCM5q2l5pyA5ZCO5LiA5p2hIEFJIOa2iOaBry4uLicpO1xuXG4gIC8vIDEuIOWumuS9jVxuICBjb25zdCBtc2cgPSBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCAn5pyq5om+5Yiw5Y+v5L6b5by65Yi25ZCM5q2l55qEIEFJIOa2iOaBr+OAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1lc3NhZ2VJZCA9IG1zZy5tZXNzYWdlX2lkO1xuICBjb25zdCBNSyA9IHJlYWRNZXNzYWdlS2V5KG1zZyk7XG5cbiAgaWYgKCFNSykge1xuICAgIGxvZ2dlci53YXJuKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5LiN5ZCrIE1L77yM5peg5rOV5omn6KGM5by65Yi25ZCM5q2l44CC5bCG6L2s5Li65omn6KGM5bi46KeE5YaZ5YWlLi4uYCk7XG4gICAgLy8g5aaC5p6c5rKh5pyJIE1L77yM6K+05piO5piv5paw5raI5oGv77yM55u05o6l6LWw5qCH5YeG5YaZ5YWl5rWB56iL5Y2z5Y+vXG4gICAgYXdhaXQgQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlKG1zZyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDnm67moIfmtojmga8gKElEOiAke21lc3NhZ2VJZH0sIE1LOiAke01LfSnjgIJgKTtcblxuICAvLyAyLiDlm57mu5pcbiAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOato+WcqOWbnua7miBNSzogJHtNS30uLi5gKTtcbiAgYXdhaXQgcm9sbGJhY2tCeU1rKE1LLCB0cnVlKTsgLy8gc2lsZW50PXRydWXvvIzpgb/lhY3kuI3lv4XopoHnmoTml6Xlv5fliLfmlrBcblxuICAvLyAzLiDph43nrpdcbiAgbG9nZ2VyLmRlYnVnKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOWbnua7muWujOaIkO+8jOato+WcqOagueaNruW9k+WJjeWGheWuuemHjeeulyBNSzogJHtNS30uLi5gKTtcbiAgY29uc3QgbmV3TUsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcblxuICAvLyA0LiDmm7TmlrAgU2VsZWN0ZWRNa3NcbiAgaWYgKG5ld01LKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1rcyA9IF8uZ2V0KG1ldGEsIFNFTF9QQVRILCBbXSk7XG4gICAgICAgIHNlbGVjdGVkTWtzW21lc3NhZ2VJZF0gPSBuZXdNSztcbiAgICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbiAgICAgICAgcmV0dXJuIG1ldGE7XG4gICAgICB9KTtcbiAgICAgIGxvZ2dlci5sb2coJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5by65Yi25ZCM5q2l5a6M5oiQ77yM5bey5pu05pawIFNlbGVjdGVkTWtzWyR7bWVzc2FnZUlkfV0gPSAke25ld01LfWApO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOW8uuWItuWQjOatpeWQjuabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg6YeN566X5ZCO5pyq6IO96I635Y+W5paw55qEIE1L77yMU2VsZWN0ZWRNa3Mg5Y+v6IO95pyq5pu05paw44CCYCk7XG4gIH1cbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/core/sync.ts\n\n}");
  },
  "./src/ERA变量框架/events/dispatcher.ts": 
  /*!******************************************!*\
  !*** ./src/ERA变量框架/events/dispatcher.ts ***!
  \******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dispatchAndExecuteTask: () => (/* binding */ dispatchAndExecuteTask)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _api_command__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/command */ \"./src/ERA变量框架/api/command.ts\");\n/* harmony import */ var _core_crud_patcher__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../core/crud/patcher */ \"./src/ERA变量框架/core/crud/patcher.ts\");\n/* harmony import */ var _core_key_mk__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../core/key/mk */ \"./src/ERA变量框架/core/key/mk.ts\");\n/* harmony import */ var _core_rollback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../core/rollback */ \"./src/ERA变量框架/core/rollback.ts\");\n/* harmony import */ var _core_sync__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../core/sync */ \"./src/ERA变量框架/core/sync.ts\");\n/* harmony import */ var _ui_patch__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../ui/patch */ \"./src/ERA变量框架/ui/patch.ts\");\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_era_data__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../utils/era_data */ \"./src/ERA变量框架/utils/era_data.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_9__.Logger('events-dispatcher');\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n/**\n * @var {ConsecutiveMkState | null} consecutiveMkState\n * @description 追踪同一个 MK 被连续处理次数的状态。\n * **作用域**: 跨批次持久化。在整个脚本生命周期内，记录字面意义上的“上一次”执行的 MK。\n */\nlet consecutiveMkState = null;\n/**\n * **【辅助函数】处理由 MK 注入触发的冗余渲染事件**\n * @param eventType - 当前事件的类型。\n * @param currentMk - 当前消息的 MK。\n * @param mkToIgnore - 当前的忽略规则。\n * @returns {{ shouldSkip: boolean; newIgnoreRule: IgnoreRule | null }} - 返回是否应跳过此事件，以及更新后的忽略规则。\n */\nfunction handleRedundantRenderEvent(eventType, currentMk, mkToIgnore) {\n    if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && currentMk === mkToIgnore.mk) {\n        logger.log('handleRedundantRenderEvent', `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`);\n        mkToIgnore.ignoreCount--;\n        if (mkToIgnore.ignoreCount <= 0) {\n            mkToIgnore = null; // 忽略次数用完，重置\n            logger.log('handleRedundantRenderEvent', `忽略次数用完`);\n        }\n        return { shouldSkip: true, newIgnoreRule: mkToIgnore };\n    }\n    return { shouldSkip: false, newIgnoreRule: mkToIgnore };\n}\n/**\n * **【任务执行器】**\n * 负责执行单个事件任务，包含所有前置、后置处理和错误捕获。\n * @param {EventJob} job - 要执行的事件任务。\n * @param {IgnoreRule | null} mkToIgnore - 当前的忽略规则。**作用域**: 仅在单次批处理 (event queue processing loop) 中生效。\n * @returns {Promise<IgnoreRule | null>} - 返回更新后的忽略规则。\n */\nasync function dispatchAndExecuteTask(job, mkToIgnore) {\n    const { type: eventType, detail } = job;\n    const eventGroup = (0,_merger__WEBPACK_IMPORTED_MODULE_10__.getEventGroup)(eventType);\n    let message_id = null;\n    let currentConsecutiveCount = 1;\n    // 在每轮任务开始时，初始化操作记录器\n    const actionsTaken = { rollback: false, apply: false, resync: false, api: false, apiWrite: false };\n    try {\n        // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n        const { mk, message_id: msgId, isNewKey } = await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_3__.ensureMkForLatestMessage)();\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = mk;\n        message_id = msgId;\n        // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就创建或更新忽略规则。\n        if (isNewKey && mk) {\n            mkToIgnore = {\n                mk: mk,\n                ignoreCount: RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n            };\n        }\n        // **核心优化**: 检查并处理由 MK 注入触发的冗余渲染事件。\n        const { shouldSkip, newIgnoreRule } = handleRedundantRenderEvent(eventType, mk, mkToIgnore);\n        mkToIgnore = newIgnoreRule; // 更新忽略规则的状态\n        if (shouldSkip) {\n            // 如果事件被忽略，则直接返回，不更新连续处理计数\n            return mkToIgnore;\n        }\n        logger.log('dispatchAndExecuteTask', `执行任务: ${eventType} (分组: ${eventGroup})`);\n        // **任务分发**\n        logger.debug('dispatchAndExecuteTask - task dispatch', `分发事件: ${eventType}`, { detail, eventGroup });\n        if (eventGroup === 'WRITE') {\n            // 关键：写入前先回滚，确保操作的幂等性。\n            // 即使事件被意外触发多次，也只会产生一次有效写入。\n            const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n            if (msg) {\n                const MK = (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_3__.readMessageKey)(msg);\n                if (MK) {\n                    await (0,_core_rollback__WEBPACK_IMPORTED_MODULE_4__.rollbackByMk)(MK, true);\n                    actionsTaken.rollback = true;\n                }\n            }\n            await (0,_core_crud_patcher__WEBPACK_IMPORTED_MODULE_2__.ApplyVarChange)();\n            actionsTaken.apply = true;\n            // 如果是 API 触发的写入，则标记\n            if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_EVENT_EMITTER.API_WRITE) {\n                actionsTaken.apiWrite = true;\n            }\n            // 在变量写入完成后，强制重新渲染消息以触发宏\n            (0,_ui_patch__WEBPACK_IMPORTED_MODULE_6__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'SYNC') {\n            logger.debug('dispatchAndExecuteTask - task dispatch', `事件 ${eventType} 触发状态同步流程...`);\n            const isFullSync = eventType === 'manual_full_sync';\n            await (0,_core_sync__WEBPACK_IMPORTED_MODULE_5__.resyncStateOnHistoryChange)(isFullSync);\n            actionsTaken.resync = true;\n            // 在同步完成后，强制重新渲染消息以触发宏\n            if (eventType != 'combo_sync')\n                (0,_ui_patch__WEBPACK_IMPORTED_MODULE_6__.forceRenderRecentMessages)();\n        }\n        else if (eventGroup === 'API') {\n            actionsTaken.api = true;\n            // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n            if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.INSERT_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.UPDATE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.INSERT_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.insertByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.UPDATE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.updateByPath)(detail.path, detail.value);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.DELETE_BY_OBJECT)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByObject)(detail);\n            else if (eventType === _utils_constants__WEBPACK_IMPORTED_MODULE_7__.ERA_API_EVENTS.DELETE_BY_PATH)\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.deleteByPath)(detail.path);\n        }\n        else if (eventGroup === 'UPDATE_MK_ONLY') {\n            // 监听此事件仅用于为用户消息创建 MK。\n            await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_3__.updateLatestSelectedMk)();\n        }\n    }\n    catch (error) {\n        logger.error('dispatchAndExecuteTask', `事件 ${eventType} 处理异常: ${error}`, error);\n    }\n    finally {\n        // 仅当本轮处理中实际执行了 ERA 核心操作时，才校准并广播事件\n        // --- 3. 触发写入完成事件 ---\n        if (actionsTaken.rollback || actionsTaken.apply || actionsTaken.resync) {\n            // **后置保障**: 强制校准 `SelectedMks` 的最新记录。\n            await (0,_core_key_mk__WEBPACK_IMPORTED_MODULE_3__.updateLatestSelectedMk)();\n            // **只有在事件实际执行了写入/同步操作时，才更新连续处理计数**\n            const mk = _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk;\n            if (mk && consecutiveMkState && consecutiveMkState.mk === mk) {\n                logger.debug('dispatchAndExecuteTask', `连续处理写入/同步操作的 MK: ${mk}。旧计数: ${consecutiveMkState.count}，新计数: ${consecutiveMkState.count + 1}`);\n                consecutiveMkState.count++;\n            }\n            else {\n                logger.debug('dispatchAndExecuteTask', `新的写入/同步操作的 MK: ${mk}。重置计数为 1。前一个 MK 是: ${consecutiveMkState?.mk}`);\n                consecutiveMkState = { mk: mk, count: 1 };\n            }\n            currentConsecutiveCount = consecutiveMkState.count;\n            // 在所有操作（包括校准）完成后，获取最新状态并广播事件\n            if (_utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk && message_id !== null) {\n                const { meta: metaData, stat: statData } = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.getEraData)();\n                const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_7__.SEL_PATH, []);\n                const editLogs = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _utils_constants__WEBPACK_IMPORTED_MODULE_7__.LOGS_PATH, {});\n                const statWithoutMeta = (0,_utils_era_data__WEBPACK_IMPORTED_MODULE_8__.removeMetaFields)(statData);\n                const payload = {\n                    mk: _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk,\n                    message_id: message_id,\n                    actions: actionsTaken,\n                    selectedMks: selectedMks,\n                    editLogs: editLogs,\n                    stat: statData,\n                    statWithoutMeta: statWithoutMeta,\n                    consecutiveProcessingCount: currentConsecutiveCount,\n                };\n                logger.debug('dispatchAndExecuteTask', `准备发送 writeDone 事件。触发事件: ${eventType}, 条件: 核心操作已执行 (rollback/apply/resync)。`, {\n                    triggeringEvent: eventType,\n                    conditions: {\n                        actionsTaken,\n                        mk: _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk,\n                        message_id,\n                    },\n                    payload,\n                });\n                (0,_api_command__WEBPACK_IMPORTED_MODULE_1__.emitWriteDoneEvent)(payload);\n            }\n        }\n        // 清理日志上下文，为下一个事件做准备\n        _utils_log__WEBPACK_IMPORTED_MODULE_9__.logContext.mk = '';\n        // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n        //暂时取消等待逻辑，提高即时性。\n        //await new Promise(resolve => setTimeout(resolve, 50));\n    }\n    return mkToIgnore;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9kaXNwYXRjaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBYTtBQUVVO0FBU0M7QUFDOEI7QUFDNEM7QUFDbEQ7QUFDVTtBQUNGO0FBQ29DO0FBQzNCO0FBQ2Y7QUFDQztBQUVuRCxNQUFNLE1BQU0sR0FBRyxJQUFJLDhDQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUUvQzs7OztHQUlHO0FBQ0gsTUFBTSwwQ0FBMEMsR0FBRyxDQUFDLENBQUM7QUFvQnJEOzs7O0dBSUc7QUFDSCxJQUFJLGtCQUFrQixHQUE4QixJQUFJLENBQUM7QUFFekQ7Ozs7OztHQU1HO0FBQ0gsU0FBUywwQkFBMEIsQ0FDakMsU0FBaUIsRUFDakIsU0FBd0IsRUFDeEIsVUFBNkI7SUFFN0IsSUFBSSxVQUFVLElBQUksU0FBUyxLQUFLLGFBQWEsQ0FBQywwQkFBMEIsSUFBSSxTQUFTLEtBQUssVUFBVSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ3hHLE1BQU0sQ0FBQyxHQUFHLENBQ1IsNEJBQTRCLEVBQzVCLFdBQVcsVUFBVSxDQUFDLEVBQUUseUJBQXlCLFVBQVUsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxFQUFFLENBQzlFLENBQUM7UUFDRixVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDekIsSUFBSSxVQUFVLENBQUMsV0FBVyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2hDLFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQyxZQUFZO1lBQy9CLE1BQU0sQ0FBQyxHQUFHLENBQUMsNEJBQTRCLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDckQsQ0FBQztRQUNELE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxDQUFDO0FBQzFELENBQUM7QUFFRDs7Ozs7O0dB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QUFDLENBQUM7Z0JBQ2xELE1BQU0sUUFBUSxHQUFHLGlEQUFLLENBQUMsUUFBUSxFQUFFLHVEQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sZUFBZSxHQUFHLGlFQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUVuRCxNQUFNLE9BQU8sR0FBRztvQkFDZCxFQUFFLEVBQUUsa0RBQVUsQ0FBQyxFQUFFO29CQUNqQixVQUFVLEVBQUUsVUFBVTtvQkFDdEIsT0FBTyxFQUFFLFlBQVk7b0JBQ3JCLFdBQVcsRUFBRSxXQUFXO29CQUN4QixRQUFRLEVBQUUsUUFBUTtvQkFDbEIsSUFBSSxFQUFFLFFBQVE7b0JBQ2QsZUFBZSxFQUFFLGVBQWU7b0JBQ2hDLDBCQUEwQixFQUFFLHVCQUF1QjtpQkFDcEQsQ0FBQztnQkFFRixNQUFNLENBQUMsS0FBSyxDQUNWLHdCQUF3QixFQUN4QiwyQkFBMkIsU0FBUyx3Q0FBd0MsRUFDNUU7b0JBQ0UsZUFBZSxFQUFFLFNBQVM7b0JBQzFCLFVBQVUsRUFBRTt3QkFDVixZQUFZO3dCQUNaLEVBQUUsRUFBRSxrREFBVSxDQUFDLEVBQUU7d0JBQ2pCLFVBQVU7cUJBQ1g7b0JBQ0QsT0FBTztpQkFDUixDQUNGLENBQUM7Z0JBRUYsZ0VBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDOUIsQ0FBQztRQUNILENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsa0RBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBRW5CLDRDQUE0QztRQUM1QyxpQkFBaUI7UUFDakIsd0RBQXdEO0lBQzFELENBQUM7SUFFRCxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL2Rpc3BhdGNoZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgZGVsZXRlQnlPYmplY3QsXG4gIGRlbGV0ZUJ5UGF0aCxcbiAgZW1pdFdyaXRlRG9uZUV2ZW50LFxuICBpbnNlcnRCeU9iamVjdCxcbiAgaW5zZXJ0QnlQYXRoLFxuICB1cGRhdGVCeU9iamVjdCxcbiAgdXBkYXRlQnlQYXRoLFxufSBmcm9tICcuLi9hcGkvY29tbWFuZCc7XG5pbXBvcnQgeyBBcHBseVZhckNoYW5nZSB9IGZyb20gJy4uL2NvcmUvY3J1ZC9wYXRjaGVyJztcbmltcG9ydCB7IGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZSwgcmVhZE1lc3NhZ2VLZXksIHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgfSBmcm9tICcuLi9jb3JlL2tleS9tayc7XG5pbXBvcnQgeyByb2xsYmFja0J5TWsgfSBmcm9tICcuLi9jb3JlL3JvbGxiYWNrJztcbmltcG9ydCB7IHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlIH0gZnJvbSAnLi4vY29yZS9zeW5jJztcbmltcG9ydCB7IGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMgfSBmcm9tICcuLi91aS9wYXRjaCc7XG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgRVJBX0VWRU5UX0VNSVRURVIsIExPR1NfUEFUSCwgU0VMX1BBVEggfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgcmVtb3ZlTWV0YUZpZWxkcyB9IGZyb20gJy4uL3V0aWxzL2VyYV9kYXRhJztcbmltcG9ydCB7IGxvZ0NvbnRleHQsIExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBFdmVudEpvYiwgZ2V0RXZlbnRHcm91cCB9IGZyb20gJy4vbWVyZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLWRpc3BhdGNoZXInKTtcblxuLyoqXG4gKiBAY29uc3RhbnQge251bWJlcn0gUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OXG4gKiBAZGVzY3JpcHRpb24g5b2TIGBlbnN1cmVNZXNzYWdlS2V5YCDms6jlhaXkuIDkuKrmlrDnmoQgTUsg5ZCO77yM6ZyA6KaB5b+955Wl55qE55Sx6K+l5pON5L2c6Kem5Y+R55qEIGBjaGFyYWN0ZXJfbWVzc2FnZV9yZW5kZXJlZGAg5LqL5Lu255qE5pWw6YeP44CCXG4gKiDpgJrluLjorr7nva7kuLogMe+8jOWboOS4uuS4gOasoea2iOaBr+WGheWuueabtOaWsOmAmuW4uOWPquS8muinpuWPkeS4gOasoea4suafk+S6i+S7tuOAglxuICovXG5jb25zdCBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT04gPSAxO1xuXG4vKipcbiAqIEBpbnRlcmZhY2UgSWdub3JlUnVsZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huWboCBNSyDms6jlhaXogIzpnIDopoHlv73nlaXlkI7nu63muLLmn5Pkuovku7bnmoTop4TliJnjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJZ25vcmVSdWxlIHtcbiAgbWs6IHN0cmluZztcbiAgaWdub3JlQ291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIENvbnNlY3V0aXZlTWtTdGF0ZVxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6hueUqOS6jui/vei4quWQjOS4gOS4qiBNSyDooqvov57nu63lpITnkIbmrKHmlbDnmoTnirbmgIHjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb25zZWN1dGl2ZU1rU3RhdGUge1xuICBtazogc3RyaW5nIHwgbnVsbDtcbiAgY291bnQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBAdmFyIHtDb25zZWN1dGl2ZU1rU3RhdGUgfCBudWxsfSBjb25zZWN1dGl2ZU1rU3RhdGVcbiAqIEBkZXNjcmlwdGlvbiDov73ouKrlkIzkuIDkuKogTUsg6KKr6L+e57ut5aSE55CG5qyh5pWw55qE54q25oCB44CCXG4gKiAqKuS9nOeUqOWfnyoqOiDot6jmibnmrKHmjIHkuYXljJbjgILlnKjmlbTkuKrohJrmnKznlJ/lkb3lkajmnJ/lhoXvvIzorrDlvZXlrZfpnaLmhI/kuYnkuIrnmoTigJzkuIrkuIDmrKHigJ3miafooYznmoQgTUvjgIJcbiAqL1xubGV0IGNvbnNlY3V0aXZlTWtTdGF0ZTogQ29uc2VjdXRpdmVNa1N0YXRlIHwgbnVsbCA9IG51bGw7XG5cbi8qKlxuICogKirjgJDovoXliqnlh73mlbDjgJHlpITnkIbnlLEgTUsg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu2KipcbiAqIEBwYXJhbSBldmVudFR5cGUgLSDlvZPliY3kuovku7bnmoTnsbvlnovjgIJcbiAqIEBwYXJhbSBjdXJyZW50TWsgLSDlvZPliY3mtojmga/nmoQgTUvjgIJcbiAqIEBwYXJhbSBta1RvSWdub3JlIC0g5b2T5YmN55qE5b+955Wl6KeE5YiZ44CCXG4gKiBAcmV0dXJucyB7eyBzaG91bGRTa2lwOiBib29sZWFuOyBuZXdJZ25vcmVSdWxlOiBJZ25vcmVSdWxlIHwgbnVsbCB9fSAtIOi/lOWbnuaYr+WQpuW6lOi3s+i/h+atpOS6i+S7tu+8jOS7peWPiuabtOaWsOWQjueahOW/veeVpeinhOWImeOAglxuICovXG5mdW5jdGlvbiBoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudChcbiAgZXZlbnRUeXBlOiBzdHJpbmcsXG4gIGN1cnJlbnRNazogc3RyaW5nIHwgbnVsbCxcbiAgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwsXG4pOiB7IHNob3VsZFNraXA6IGJvb2xlYW47IG5ld0lnbm9yZVJ1bGU6IElnbm9yZVJ1bGUgfCBudWxsIH0ge1xuICBpZiAobWtUb0lnbm9yZSAmJiBldmVudFR5cGUgPT09IHRhdmVybl9ldmVudHMuQ0hBUkFDVEVSX01FU1NBR0VfUkVOREVSRUQgJiYgY3VycmVudE1rID09PSBta1RvSWdub3JlLm1rKSB7XG4gICAgbG9nZ2VyLmxvZyhcbiAgICAgICdoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudCcsXG4gICAgICBg5b+955Wl55SxIE1LICgke21rVG9JZ25vcmUubWt9KSDms6jlhaXop6blj5HnmoTlhpfkvZnmuLLmn5Pkuovku7bjgILliankvZnlv73nlaXmrKHmlbA6ICR7bWtUb0lnbm9yZS5pZ25vcmVDb3VudCAtIDF9YCxcbiAgICApO1xuICAgIG1rVG9JZ25vcmUuaWdub3JlQ291bnQtLTtcbiAgICBpZiAobWtUb0lnbm9yZS5pZ25vcmVDb3VudCA8PSAwKSB7XG4gICAgICBta1RvSWdub3JlID0gbnVsbDsgLy8g5b+955Wl5qyh5pWw55So5a6M77yM6YeN572uXG4gICAgICBsb2dnZXIubG9nKCdoYW5kbGVSZWR1bmRhbnRSZW5kZXJFdmVudCcsIGDlv73nlaXmrKHmlbDnlKjlroxgKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc2hvdWxkU2tpcDogdHJ1ZSwgbmV3SWdub3JlUnVsZTogbWtUb0lnbm9yZSB9O1xuICB9XG4gIHJldHVybiB7IHNob3VsZFNraXA6IGZhbHNlLCBuZXdJZ25vcmVSdWxlOiBta1RvSWdub3JlIH07XG59XG5cbi8qKlxuICogKirjgJDku7vliqHmiafooYzlmajjgJEqKlxuICog6LSf6LSj5omn6KGM5Y2V5Liq5LqL5Lu25Lu75Yqh77yM5YyF5ZCr5omA5pyJ5YmN572u44CB5ZCO572u5aSE55CG5ZKM6ZSZ6K+v5o2V6I6344CCXG4gKiBAcGFyYW0ge0V2ZW50Sm9ifSBqb2IgLSDopoHmiafooYznmoTkuovku7bku7vliqHjgIJcbiAqIEBwYXJhbSB7SWdub3JlUnVsZSB8IG51bGx9IG1rVG9JZ25vcmUgLSDlvZPliY3nmoTlv73nlaXop4TliJnjgIIqKuS9nOeUqOWfnyoqOiDku4XlnKjljZXmrKHmibnlpITnkIYgKGV2ZW50IHF1ZXVlIHByb2Nlc3NpbmcgbG9vcCkg5Lit55Sf5pWI44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxJZ25vcmVSdWxlIHwgbnVsbD59IC0g6L+U5Zue5pu05paw5ZCO55qE5b+955Wl6KeE5YiZ44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrKGpvYjogRXZlbnRKb2IsIG1rVG9JZ25vcmU6IElnbm9yZVJ1bGUgfCBudWxsKTogUHJvbWlzZTxJZ25vcmVSdWxlIHwgbnVsbD4ge1xuICBjb25zdCB7IHR5cGU6IGV2ZW50VHlwZSwgZGV0YWlsIH0gPSBqb2I7XG4gIGNvbnN0IGV2ZW50R3JvdXAgPSBnZXRFdmVudEdyb3VwKGV2ZW50VHlwZSk7XG4gIGxldCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgbGV0IGN1cnJlbnRDb25zZWN1dGl2ZUNvdW50ID0gMTtcblxuICAvLyDlnKjmr4/ova7ku7vliqHlvIDlp4vml7bvvIzliJ3lp4vljJbmk43kvZzorrDlvZXlmahcbiAgY29uc3QgYWN0aW9uc1Rha2VuID0geyByb2xsYmFjazogZmFsc2UsIGFwcGx5OiBmYWxzZSwgcmVzeW5jOiBmYWxzZSwgYXBpOiBmYWxzZSwgYXBpV3JpdGU6IGZhbHNlIH07XG5cbiAgdHJ5IHtcbiAgICAvLyAqKuWJjee9ruS/nemanCoqOiDnoa7kv53mnIDmlrDmtojmga/mnIkgTUsg5bm26K6+572u5pel5b+X5LiK5LiL5paH44CCXG4gICAgY29uc3QgeyBtaywgbWVzc2FnZV9pZDogbXNnSWQsIGlzTmV3S2V5IH0gPSBhd2FpdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UoKTtcbiAgICBsb2dDb250ZXh0Lm1rID0gbWs7XG4gICAgbWVzc2FnZV9pZCA9IG1zZ0lkO1xuXG4gICAgLy8g5aaC5p6cIGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZSDliJrliJrms6jlhaXkuobkuIDkuKrmlrDnmoQgTUvvvIzlsLHliJvlu7rmiJbmm7TmlrDlv73nlaXop4TliJnjgIJcbiAgICBpZiAoaXNOZXdLZXkgJiYgbWspIHtcbiAgICAgIG1rVG9JZ25vcmUgPSB7XG4gICAgICAgIG1rOiBtayxcbiAgICAgICAgaWdub3JlQ291bnQ6IFJFTkRFUl9FVkVOVFNfVE9fSUdOT1JFX0FGVEVSX01LX0lOSkVDVElPTixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gKirmoLjlv4PkvJjljJYqKjog5qOA5p+l5bm25aSE55CG55SxIE1LIOazqOWFpeinpuWPkeeahOWGl+S9mea4suafk+S6i+S7tuOAglxuICAgIGNvbnN0IHsgc2hvdWxkU2tpcCwgbmV3SWdub3JlUnVsZSB9ID0gaGFuZGxlUmVkdW5kYW50UmVuZGVyRXZlbnQoZXZlbnRUeXBlLCBtaywgbWtUb0lnbm9yZSk7XG4gICAgbWtUb0lnbm9yZSA9IG5ld0lnbm9yZVJ1bGU7IC8vIOabtOaWsOW/veeVpeinhOWImeeahOeKtuaAgVxuICAgIGlmIChzaG91bGRTa2lwKSB7XG4gICAgICAvLyDlpoLmnpzkuovku7booqvlv73nlaXvvIzliJnnm7TmjqXov5Tlm57vvIzkuI3mm7TmlrDov57nu63lpITnkIborqHmlbBcbiAgICAgIHJldHVybiBta1RvSWdub3JlO1xuICAgIH1cblxuICAgIGxvZ2dlci5sb2coJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLCBg5omn6KGM5Lu75YqhOiAke2V2ZW50VHlwZX0gKOWIhue7hDogJHtldmVudEdyb3VwfSlgKTtcblxuICAgIC8vICoq5Lu75Yqh5YiG5Y+RKipcbiAgICBsb2dnZXIuZGVidWcoJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2sgLSB0YXNrIGRpc3BhdGNoJywgYOWIhuWPkeS6i+S7tjogJHtldmVudFR5cGV9YCwgeyBkZXRhaWwsIGV2ZW50R3JvdXAgfSk7XG4gICAgaWYgKGV2ZW50R3JvdXAgPT09ICdXUklURScpIHtcbiAgICAgIC8vIOWFs+mUru+8muWGmeWFpeWJjeWFiOWbnua7mu+8jOehruS/neaTjeS9nOeahOW5guetieaAp+OAglxuICAgICAgLy8g5Y2z5L2/5LqL5Lu26KKr5oSP5aSW6Kem5Y+R5aSa5qyh77yM5Lmf5Y+q5Lya5Lqn55Sf5LiA5qyh5pyJ5pWI5YaZ5YWl44CCXG4gICAgICBjb25zdCBtc2cgPSBnZXRDaGF0TWVzc2FnZXMoLTEsIHsgaW5jbHVkZV9zd2lwZXM6IHRydWUgfSk/LlswXTtcbiAgICAgIGlmIChtc2cpIHtcbiAgICAgICAgY29uc3QgTUsgPSByZWFkTWVzc2FnZUtleShtc2cpO1xuICAgICAgICBpZiAoTUspIHtcbiAgICAgICAgICBhd2FpdCByb2xsYmFja0J5TWsoTUssIHRydWUpO1xuICAgICAgICAgIGFjdGlvbnNUYWtlbi5yb2xsYmFjayA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IEFwcGx5VmFyQ2hhbmdlKCk7XG4gICAgICBhY3Rpb25zVGFrZW4uYXBwbHkgPSB0cnVlO1xuXG4gICAgICAvLyDlpoLmnpzmmK8gQVBJIOinpuWPkeeahOWGmeWFpe+8jOWImeagh+iusFxuICAgICAgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0VWRU5UX0VNSVRURVIuQVBJX1dSSVRFKSB7XG4gICAgICAgIGFjdGlvbnNUYWtlbi5hcGlXcml0ZSA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIOWcqOWPmOmHj+WGmeWFpeWujOaIkOWQju+8jOW8uuWItumHjeaWsOa4suafk+a2iOaBr+S7peinpuWPkeWuj1xuICAgICAgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcygpO1xuICAgIH0gZWxzZSBpZiAoZXZlbnRHcm91cCA9PT0gJ1NZTkMnKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2sgLSB0YXNrIGRpc3BhdGNoJywgYOS6i+S7tiAke2V2ZW50VHlwZX0g6Kem5Y+R54q25oCB5ZCM5q2l5rWB56iLLi4uYCk7XG4gICAgICBjb25zdCBpc0Z1bGxTeW5jID0gZXZlbnRUeXBlID09PSAnbWFudWFsX2Z1bGxfc3luYyc7XG4gICAgICBhd2FpdCByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZShpc0Z1bGxTeW5jKTtcbiAgICAgIGFjdGlvbnNUYWtlbi5yZXN5bmMgPSB0cnVlO1xuICAgICAgLy8g5Zyo5ZCM5q2l5a6M5oiQ5ZCO77yM5by65Yi26YeN5paw5riy5p+T5raI5oGv5Lul6Kem5Y+R5a6PXG4gICAgICBpZiAoZXZlbnRUeXBlICE9ICdjb21ib19zeW5jJykgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcygpO1xuICAgIH0gZWxzZSBpZiAoZXZlbnRHcm91cCA9PT0gJ0FQSScpIHtcbiAgICAgIGFjdGlvbnNUYWtlbi5hcGkgPSB0cnVlO1xuICAgICAgLy8gQVBJIOS6i+S7tuaYr+KAnOWNs+WPkeWNs+W/mOKAneeahO+8jOWQjOatpeiwg+eUqOWkhOeQhuWZqOWwhuS7u+WKoeaOqOWFpSBhcGkudHMg55qE6Zif5YiX5ZCO56uL5Y2z6L+U5Zue77yM5LiN6Zi75aGe5LqL5Lu26Zif5YiX44CCXG4gICAgICBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5JTlNFUlRfQllfT0JKRUNUKSBpbnNlcnRCeU9iamVjdChkZXRhaWwpO1xuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5VUERBVEVfQllfT0JKRUNUKSB1cGRhdGVCeU9iamVjdChkZXRhaWwpO1xuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5JTlNFUlRfQllfUEFUSCkgaW5zZXJ0QnlQYXRoKGRldGFpbC5wYXRoLCBkZXRhaWwudmFsdWUpO1xuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5VUERBVEVfQllfUEFUSCkgdXBkYXRlQnlQYXRoKGRldGFpbC5wYXRoLCBkZXRhaWwudmFsdWUpO1xuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5ERUxFVEVfQllfT0JKRUNUKSBkZWxldGVCeU9iamVjdChkZXRhaWwpO1xuICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5ERUxFVEVfQllfUEFUSCkgZGVsZXRlQnlQYXRoKGRldGFpbC5wYXRoKTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50R3JvdXAgPT09ICdVUERBVEVfTUtfT05MWScpIHtcbiAgICAgIC8vIOebkeWQrOatpOS6i+S7tuS7heeUqOS6juS4uueUqOaIt+a2iOaBr+WIm+W7uiBNS+OAglxuICAgICAgYXdhaXQgdXBkYXRlTGF0ZXN0U2VsZWN0ZWRNaygpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLCBg5LqL5Lu2ICR7ZXZlbnRUeXBlfSDlpITnkIblvILluLg6ICR7ZXJyb3J9YCwgZXJyb3IpO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIOS7heW9k+acrOi9ruWkhOeQhuS4reWunumZheaJp+ihjOS6hiBFUkEg5qC45b+D5pON5L2c5pe277yM5omN5qCh5YeG5bm25bm/5pKt5LqL5Lu2XG4gICAgLy8gLS0tIDMuIOinpuWPkeWGmeWFpeWujOaIkOS6i+S7tiAtLS1cbiAgICBpZiAoYWN0aW9uc1Rha2VuLnJvbGxiYWNrIHx8IGFjdGlvbnNUYWtlbi5hcHBseSB8fCBhY3Rpb25zVGFrZW4ucmVzeW5jKSB7XG4gICAgICAvLyAqKuWQjue9ruS/nemanCoqOiDlvLrliLbmoKHlh4YgYFNlbGVjdGVkTWtzYCDnmoTmnIDmlrDorrDlvZXjgIJcbiAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcblxuICAgICAgLy8gKirlj6rmnInlnKjkuovku7blrp7pmYXmiafooYzkuoblhpnlhaUv5ZCM5q2l5pON5L2c5pe277yM5omN5pu05paw6L+e57ut5aSE55CG6K6h5pWwKipcbiAgICAgIGNvbnN0IG1rID0gbG9nQ29udGV4dC5taztcbiAgICAgIGlmIChtayAmJiBjb25zZWN1dGl2ZU1rU3RhdGUgJiYgY29uc2VjdXRpdmVNa1N0YXRlLm1rID09PSBtaykge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLFxuICAgICAgICAgIGDov57nu63lpITnkIblhpnlhaUv5ZCM5q2l5pON5L2c55qEIE1LOiAke21rfeOAguaXp+iuoeaVsDogJHtjb25zZWN1dGl2ZU1rU3RhdGUuY291bnR977yM5paw6K6h5pWwOiAke2NvbnNlY3V0aXZlTWtTdGF0ZS5jb3VudCArIDF9YCxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc2VjdXRpdmVNa1N0YXRlLmNvdW50Kys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLFxuICAgICAgICAgIGDmlrDnmoTlhpnlhaUv5ZCM5q2l5pON5L2c55qEIE1LOiAke21rfeOAgumHjee9ruiuoeaVsOS4uiAx44CC5YmN5LiA5LiqIE1LIOaYrzogJHtjb25zZWN1dGl2ZU1rU3RhdGU/Lm1rfWAsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNlY3V0aXZlTWtTdGF0ZSA9IHsgbWs6IG1rLCBjb3VudDogMSB9O1xuICAgICAgfVxuICAgICAgY3VycmVudENvbnNlY3V0aXZlQ291bnQgPSBjb25zZWN1dGl2ZU1rU3RhdGUuY291bnQ7XG5cbiAgICAgIC8vIOWcqOaJgOacieaTjeS9nO+8iOWMheaLrOagoeWHhu+8ieWujOaIkOWQju+8jOiOt+WPluacgOaWsOeKtuaAgeW5tuW5v+aSreS6i+S7tlxuICAgICAgaWYgKGxvZ0NvbnRleHQubWsgJiYgbWVzc2FnZV9pZCAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhLCBzdGF0OiBzdGF0RGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1rcyA9IF8uZ2V0KG1ldGFEYXRhLCBTRUxfUEFUSCwgW10pO1xuICAgICAgICBjb25zdCBlZGl0TG9ncyA9IF8uZ2V0KG1ldGFEYXRhLCBMT0dTX1BBVEgsIHt9KTtcbiAgICAgICAgY29uc3Qgc3RhdFdpdGhvdXRNZXRhID0gcmVtb3ZlTWV0YUZpZWxkcyhzdGF0RGF0YSk7XG5cbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICBtazogbG9nQ29udGV4dC5tayxcbiAgICAgICAgICBtZXNzYWdlX2lkOiBtZXNzYWdlX2lkLFxuICAgICAgICAgIGFjdGlvbnM6IGFjdGlvbnNUYWtlbixcbiAgICAgICAgICBzZWxlY3RlZE1rczogc2VsZWN0ZWRNa3MsXG4gICAgICAgICAgZWRpdExvZ3M6IGVkaXRMb2dzLFxuICAgICAgICAgIHN0YXQ6IHN0YXREYXRhLFxuICAgICAgICAgIHN0YXRXaXRob3V0TWV0YTogc3RhdFdpdGhvdXRNZXRhLFxuICAgICAgICAgIGNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50OiBjdXJyZW50Q29uc2VjdXRpdmVDb3VudCxcbiAgICAgICAgfTtcblxuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ2Rpc3BhdGNoQW5kRXhlY3V0ZVRhc2snLFxuICAgICAgICAgIGDlh4blpIflj5HpgIEgd3JpdGVEb25lIOS6i+S7tuOAguinpuWPkeS6i+S7tjogJHtldmVudFR5cGV9LCDmnaHku7Y6IOaguOW/g+aTjeS9nOW3suaJp+ihjCAocm9sbGJhY2svYXBwbHkvcmVzeW5jKeOAgmAsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHJpZ2dlcmluZ0V2ZW50OiBldmVudFR5cGUsXG4gICAgICAgICAgICBjb25kaXRpb25zOiB7XG4gICAgICAgICAgICAgIGFjdGlvbnNUYWtlbixcbiAgICAgICAgICAgICAgbWs6IGxvZ0NvbnRleHQubWssXG4gICAgICAgICAgICAgIG1lc3NhZ2VfaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIGVtaXRXcml0ZURvbmVFdmVudChwYXlsb2FkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmuIXnkIbml6Xlv5fkuIrkuIvmlofvvIzkuLrkuIvkuIDkuKrkuovku7blgZrlh4blpIdcbiAgICBsb2dDb250ZXh0Lm1rID0gJyc7XG5cbiAgICAvLyAqKuiKgua1gSoqOiDlnKjmr4/kuKrni6znq4vku7vliqHlkI7pg73ov5vooYznn63mmoLnrYnlvoXvvIznoa7kv53phZLppoblupXlsYLmnInml7bpl7TlrozmiJDlhbblvILmraXmk43kvZzjgIJcbiAgICAvL+aaguaXtuWPlua2iOetieW+hemAu+i+ke+8jOaPkOmrmOWNs+aXtuaAp+OAglxuICAgIC8vYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwKSk7XG4gIH1cblxuICByZXR1cm4gbWtUb0lnbm9yZTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/dispatcher.ts\n\n}");
  },
  "./src/ERA变量框架/events/merger.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/events/merger.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EVENT_COLLISION_MAP: () => (/* binding */ EVENT_COLLISION_MAP),\n/* harmony export */   EVENT_COMBO_MAP: () => (/* binding */ EVENT_COMBO_MAP),\n/* harmony export */   EVENT_DEBOUNCE_MAP: () => (/* binding */ EVENT_DEBOUNCE_MAP),\n/* harmony export */   EVENT_GROUPS: () => (/* binding */ EVENT_GROUPS),\n/* harmony export */   getEventGroup: () => (/* binding */ getEventGroup),\n/* harmony export */   mergeEventBatch: () => (/* binding */ mergeEventBatch)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_2__.Logger('events-merger');\n/**\n * @description 定义需要监听的事件的分组\n */\nconst EVENT_GROUPS = {\n    WRITE: [\n        //tavern_events.CHARACTER_MESSAGE_RENDERED,\n        tavern_events.APP_READY,\n        'manual_write',\n        _utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE,\n        //tavern_events.MESSAGE_RECEIVED,\n    ],\n    SYNC: [\n        tavern_events.MESSAGE_RECEIVED,\n        tavern_events.MESSAGE_DELETED,\n        tavern_events.MESSAGE_SWIPED,\n        tavern_events.CHAT_CHANGED,\n        'manual_sync',\n        'manual_full_sync',\n        /** 由 message_updated 和 generation_started 组合而成的同步事件 */\n        'combo_sync',\n    ],\n    API: Object.values(_utils_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_API_EVENTS),\n    /** 仅更新MK的事件 */\n    UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n    /** 仅用于对冲检测的事件，本身不触发逻辑 */\n    COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n    /** 用于组合事件的起始事件 */\n    COMBO_STARTERS: [tavern_events.MESSAGE_UPDATED],\n};\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 500 }]\n * ])\n */\nconst EVENT_COLLISION_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 600 }],\n]);\n/**\n * @constant {Map<string, { next: string; resultType: string; maxInterval: number }>} EVENT_COMBO_MAP\n * @description\n * 定义了事件组合规则。\n * 如果在事件队列的同一次批处理中，一个 key 事件紧跟着一个 `next` 事件，\n * 它们将被合并成一个新的 `resultType` 事件。\n *\n * @example\n * // 当用户消息被AI编辑后立刻开始生成下一条消息时，会依次触发 `MESSAGE_UPDATED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并将它们合并为一个 `combo_sync` 事件，以确保数据一致性。\n * new Map([\n *   [tavern_events.MESSAGE_UPDATED, { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 2100 }]\n * ])\n */\nconst EVENT_COMBO_MAP = new Map([\n    [\n        tavern_events.MESSAGE_UPDATED,\n        { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 1600 },\n    ],\n]);\n/**\n * @constant {Map<string, number>} EVENT_DEBOUNCE_MAP\n * @description\n * 为特定事件定义自定义的防抖时间（毫秒）。\n * 在事件队列处理器中，如果一个事件在此映射中定义了时间，\n * 将使用该时间代替默认的防抖时间。\n * 这对于那些需要更长窗口来捕获后续事件的“前置事件”特别有用。\n *\n * @example\n * // 为 MESSAGE_SWIPED 设置更长的等待时间，以确保能捕获到后续的 GENERATION_STARTED\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, 500]\n * ])\n */\nconst EVENT_DEBOUNCE_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, 500], // 对冲事件的前置事件\n    [tavern_events.MESSAGE_UPDATED, 1500], // 组合事件的前置事件\n]);\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('WRITE', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nfunction getEventGroup(eventType) {\n    // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n    if (EVENT_GROUPS.WRITE.includes(eventType))\n        return 'WRITE';\n    if (EVENT_GROUPS.SYNC.includes(eventType))\n        return 'SYNC';\n    if (EVENT_GROUPS.API.includes(eventType))\n        return 'API';\n    if (EVENT_GROUPS.UPDATE_MK_ONLY.includes(eventType))\n        return 'UPDATE_MK_ONLY';\n    if (EVENT_GROUPS.COLLISION_DETECTORS.includes(eventType))\n        return 'COLLISION_DETECTORS';\n    if (EVENT_GROUPS.COMBO_STARTERS.includes(eventType))\n        return 'COMBO_STARTERS';\n    return 'UNKNOWN';\n}\n/**\n * **【事件合并器】**\n * 对一批事件进行智能合并，包括处理事件对冲和合并同组可覆盖事件。\n * @param {EventJob[]} batchToProcess - 从队列中取出的一批原始事件。\n * @returns {EventJob[]} - 经过合并优化后的事件数组。\n */\nfunction mergeEventBatch(batchToProcess) {\n    const originalEvents = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(batchToProcess);\n    const finalJobs = [];\n    // 使用 for...of 循环，让逻辑更清晰\n    for (const currentJob of batchToProcess) {\n        // 如果是第一个事件，直接放入结果中\n        if (finalJobs.length === 0) {\n            finalJobs.push(currentJob);\n            continue; // 继续处理下一个事件\n        }\n        const prevJob = finalJobs[finalJobs.length - 1];\n        const timeDifference = currentJob.timestamp - prevJob.timestamp;\n        // 1. 检查事件组合\n        const comboRule = EVENT_COMBO_MAP.get(prevJob.type);\n        if (comboRule && currentJob.type === comboRule.next) {\n            if (timeDifference <= comboRule.maxInterval) {\n                logger.debug('mergeEventBatch', `检测到事件组合: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${comboRule.maxInterval}ms)。将合并为 ${comboRule.resultType} 事件。`);\n                finalJobs.pop(); // 移除前一个事件\n                finalJobs.push({ type: comboRule.resultType, timestamp: currentJob.timestamp, detail: currentJob.detail });\n                continue;\n            }\n            else {\n                logger.debug('mergeEventBatch', `检测到潜在的事件组合，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${comboRule.maxInterval}ms)。`);\n            }\n        }\n        // 2. 检查事件对冲\n        const collisionRule = EVENT_COLLISION_MAP.get(prevJob.type);\n        if (collisionRule && currentJob.type === collisionRule.next) {\n            if (timeDifference <= collisionRule.maxInterval) {\n                logger.debug('mergeEventBatch', `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${collisionRule.maxInterval}ms)。将忽略这两个事件。`);\n                finalJobs.pop(); // 移除前一个事件\n                continue; // 跳过当前事件，从而忽略两者\n            }\n            else {\n                logger.debug('mergeEventBatch', `检测到潜在的事件对冲，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${collisionRule.maxInterval}ms)。`);\n            }\n        }\n        // 3. 如果不冲突或组合，则检查同组事件合并\n        const prevGroup = getEventGroup(prevJob.type);\n        const currentGroup = getEventGroup(currentJob.type);\n        // 定义合并条件，让 if 判断的意图更清晰\n        const areInSameGroup = prevGroup === currentGroup;\n        const isMergeableGroup = prevGroup === 'WRITE' || prevGroup === 'SYNC';\n        // 如果满足合并条件\n        if (areInSameGroup && isMergeableGroup) {\n            // 用当前事件覆盖掉结果数组中的最后一个事件\n            finalJobs[finalJobs.length - 1] = currentJob;\n        }\n        else {\n            // 否则，将当前事件追加到结果数组\n            finalJobs.push(currentJob);\n        }\n    }\n    // 最后，清理掉所有未配对的检测器和组合起始事件\n    const filteredJobs = finalJobs.filter(job => {\n        const group = getEventGroup(job.type);\n        const isOrphanedDetector = group === 'COLLISION_DETECTORS';\n        const isOrphanedComboStarter = group === 'COMBO_STARTERS';\n        if (isOrphanedDetector || isOrphanedComboStarter) {\n            logger.debug('mergeEventBatch', `清理未配对的事件: ${job.type}`);\n        }\n        return !isOrphanedDetector && !isOrphanedComboStarter;\n    });\n    // 打印合并日志\n    logger.debug('mergeEventBatch', `事件合并: ${originalEvents.length} -> ${filteredJobs.length}`, {\n        before: originalEvents.map(e => e.type),\n        after: filteredJobs.map(e => e.type),\n    });\n    return filteredJobs;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9tZXJnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFhO0FBRVU7QUFDZ0Q7QUFDakM7QUFFdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNDOztHQUVHO0FBQ0ksTUFBTSxZQUFZLEdBQUc7SUFDMUIsS0FBSyxFQUFFO1FBQ0wsMkNBQTJDO1FBQzNDLGFBQWEsQ0FBQyxTQUFTO1FBQ3ZCLGNBQWM7UUFDZCwrREFBaUIsQ0FBQyxTQUFTO1FBQzNCLGlDQUFpQztLQUNsQztJQUNELElBQUksRUFBRTtRQUNKLGFBQWEsQ0FBQyxnQkFBZ0I7UUFDOUIsYUFBYSxDQUFDLGVBQWU7UUFDN0IsYUFBYSxDQUFDLGNBQWM7UUFDNUIsYUFBYSxDQUFDLFlBQVk7UUFDMUIsYUFBYTtRQUNiLGtCQUFrQjtRQUNsQix1REFBdUQ7UUFDdkQsWUFBWTtLQUNiO0lBQ0QsR0FBRyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsNERBQWMsQ0FBQztJQUNsQyxlQUFlO0lBQ2YsY0FBYyxFQUFFLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQztJQUM1Qyx5QkFBeUI7SUFDekIsbUJBQW1CLEVBQUUsQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUM7SUFDdkQsa0JBQWtCO0lBQ2xCLGNBQWMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUM7Q0FDaEQsQ0FBQztBQUVGOzs7Ozs7Ozs7Ozs7O0dBYUc7QUFDSSxNQUFNLG1CQUFtQixHQUFHLElBQUksR0FBRyxDQUFnRDtJQUN4RixDQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLGtCQUFrQixFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsQ0FBQztDQUM3RixDQUFDLENBQUM7QUFFSDs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxlQUFlLEdBQUcsSUFBSSxHQUFHLENBQW9FO0lBQ3hHO1FB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QUNyQyxDQUFDLENBQUM7SUFFSCxPQUFPLFlBQVksQ0FBQztBQUN0QixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZXZlbnRzL21lcmdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBFUkFfQVBJX0VWRU5UUywgRVJBX0VWRU5UX0VNSVRURVIgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLW1lcmdlcicpO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnpnIDopoHnm5HlkKznmoTkuovku7bnmoTliIbnu4RcbiAqL1xuZXhwb3J0IGNvbnN0IEVWRU5UX0dST1VQUyA9IHtcbiAgV1JJVEU6IFtcbiAgICAvL3RhdmVybl9ldmVudHMuQ0hBUkFDVEVSX01FU1NBR0VfUkVOREVSRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5BUFBfUkVBRFksXG4gICAgJ21hbnVhbF93cml0ZScsXG4gICAgRVJBX0VWRU5UX0VNSVRURVIuQVBJX1dSSVRFLFxuICAgIC8vdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICBdLFxuICBTWU5DOiBbXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9ERUxFVEVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5DSEFUX0NIQU5HRUQsXG4gICAgJ21hbnVhbF9zeW5jJyxcbiAgICAnbWFudWFsX2Z1bGxfc3luYycsXG4gICAgLyoqIOeUsSBtZXNzYWdlX3VwZGF0ZWQg5ZKMIGdlbmVyYXRpb25fc3RhcnRlZCDnu4TlkIjogIzmiJDnmoTlkIzmraXkuovku7YgKi9cbiAgICAnY29tYm9fc3luYycsXG4gIF0sXG4gIEFQSTogT2JqZWN0LnZhbHVlcyhFUkFfQVBJX0VWRU5UUyksXG4gIC8qKiDku4Xmm7TmlrBNS+eahOS6i+S7tiAqL1xuICBVUERBVEVfTUtfT05MWTogW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TRU5UXSxcbiAgLyoqIOS7heeUqOS6juWvueWGsuajgOa1i+eahOS6i+S7tu+8jOacrOi6q+S4jeinpuWPkemAu+i+kSAqL1xuICBDT0xMSVNJT05fREVURUNUT1JTOiBbdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURURdLFxuICAvKiog55So5LqO57uE5ZCI5LqL5Lu255qE6LW35aeL5LqL5Lu2ICovXG4gIENPTUJPX1NUQVJURVJTOiBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1VQREFURURdLFxufTtcblxuLyoqXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIHN0cmluZz59IEVWRU5UX0NPTExJU0lPTl9NQVBcbiAqIEBkZXNjcmlwdGlvblxuICog5a6a5LmJ5LqG5LqL5Lu25a+55Yay6KeE5YiZ44CCXG4gKiDlpoLmnpzlnKjkuovku7bpmJ/liJfnmoTlkIzkuIDmrKHmibnlpITnkIbkuK3vvIzlkIzml7blh7rnjrDkuoYga2V5IOS6i+S7tuWSjCB2YWx1ZSDkuovku7bvvIxcbiAqIOWImei/meS4pOS4quS6i+S7tumDveWwhuiiq+W/veeVpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDlvZPnlKjmiLflv6vpgJ/lt6bmu5HnhLblkI7ngrnlh7vnlJ/miJDml7bvvIzkvJrkvp3mrKHop6blj5EgYE1FU1NBR0VfU1dJUEVEYCDlkowgYEdFTkVSQVRJT05fU1RBUlRFRGDjgIJcbiAqIC8vIOi/meadoeinhOWImeS8muaNleiOt+i/meenjeaooeW8j+W5tuWQjOaXtuW/veeVpei/meS4pOS4quS6i+S7tu+8jOmBv+WFjeS4jeW/heimgeeahOWQjOatpeOAglxuICogbmV3IE1hcChbXG4gKiAgIFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELCB7IG5leHQ6IHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVELCBtYXhJbnRlcnZhbDogNTAwIH1dXG4gKiBdKVxuICovXG5leHBvcnQgY29uc3QgRVZFTlRfQ09MTElTSU9OX01BUCA9IG5ldyBNYXA8c3RyaW5nLCB7IG5leHQ6IHN0cmluZzsgbWF4SW50ZXJ2YWw6IG51bWJlciB9PihbXG4gIFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELCB7IG5leHQ6IHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVELCBtYXhJbnRlcnZhbDogNjAwIH1dLFxuXSk7XG5cbi8qKlxuICogQGNvbnN0YW50IHtNYXA8c3RyaW5nLCB7IG5leHQ6IHN0cmluZzsgcmVzdWx0VHlwZTogc3RyaW5nOyBtYXhJbnRlcnZhbDogbnVtYmVyIH0+fSBFVkVOVF9DT01CT19NQVBcbiAqIEBkZXNjcmlwdGlvblxuICog5a6a5LmJ5LqG5LqL5Lu257uE5ZCI6KeE5YiZ44CCXG4gKiDlpoLmnpzlnKjkuovku7bpmJ/liJfnmoTlkIzkuIDmrKHmibnlpITnkIbkuK3vvIzkuIDkuKoga2V5IOS6i+S7tue0p+i3n+edgOS4gOS4qiBgbmV4dGAg5LqL5Lu277yMXG4gKiDlroPku6zlsIbooqvlkIjlubbmiJDkuIDkuKrmlrDnmoQgYHJlc3VsdFR5cGVgIOS6i+S7tuOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDlvZPnlKjmiLfmtojmga/ooqtBSee8lui+keWQjueri+WIu+W8gOWni+eUn+aIkOS4i+S4gOadoea2iOaBr+aXtu+8jOS8muS+neasoeinpuWPkSBgTUVTU0FHRV9VUERBVEVEYCDlkowgYEdFTkVSQVRJT05fU1RBUlRFRGDjgIJcbiAqIC8vIOi/meadoeinhOWImeS8muaNleiOt+i/meenjeaooeW8j+W5tuWwhuWug+S7rOWQiOW5tuS4uuS4gOS4qiBgY29tYm9fc3luY2Ag5LqL5Lu277yM5Lul56Gu5L+d5pWw5o2u5LiA6Ie05oCn44CCXG4gKiBuZXcgTWFwKFtcbiAqICAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9VUERBVEVELCB7IG5leHQ6IHRhdmVybl9ldmVudHMuR0VORVJBVElPTl9TVEFSVEVELCByZXN1bHRUeXBlOiAnY29tYm9fc3luYycsIG1heEludGVydmFsOiAyMTAwIH1dXG4gKiBdKVxuICovXG5leHBvcnQgY29uc3QgRVZFTlRfQ09NQk9fTUFQID0gbmV3IE1hcDxzdHJpbmcsIHsgbmV4dDogc3RyaW5nOyByZXN1bHRUeXBlOiBzdHJpbmc7IG1heEludGVydmFsOiBudW1iZXIgfT4oW1xuICBbXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1VQREFURUQsXG4gICAgeyBuZXh0OiB0YXZlcm5fZXZlbnRzLkdFTkVSQVRJT05fU1RBUlRFRCwgcmVzdWx0VHlwZTogJ2NvbWJvX3N5bmMnLCBtYXhJbnRlcnZhbDogMTYwMCB9LFxuICBdLFxuXSk7XG5cbi8qKlxuICogQGNvbnN0YW50IHtNYXA8c3RyaW5nLCBudW1iZXI+fSBFVkVOVF9ERUJPVU5DRV9NQVBcbiAqIEBkZXNjcmlwdGlvblxuICog5Li654m55a6a5LqL5Lu25a6a5LmJ6Ieq5a6a5LmJ55qE6Ziy5oqW5pe26Ze077yI5q+r56eS77yJ44CCXG4gKiDlnKjkuovku7bpmJ/liJflpITnkIblmajkuK3vvIzlpoLmnpzkuIDkuKrkuovku7blnKjmraTmmKDlsITkuK3lrprkuYnkuobml7bpl7TvvIxcbiAqIOWwhuS9v+eUqOivpeaXtumXtOS7o+abv+m7mOiupOeahOmYsuaKluaXtumXtOOAglxuICog6L+Z5a+55LqO6YKj5Lqb6ZyA6KaB5pu06ZW/56qX5Y+j5p2l5o2V6I635ZCO57ut5LqL5Lu255qE4oCc5YmN572u5LqL5Lu24oCd54m55Yir5pyJ55So44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIOS4uiBNRVNTQUdFX1NXSVBFRCDorr7nva7mm7Tplb/nmoTnrYnlvoXml7bpl7TvvIzku6Xnoa7kv53og73mjZXojrfliLDlkI7nu63nmoQgR0VORVJBVElPTl9TVEFSVEVEXG4gKiBuZXcgTWFwKFtcbiAqICAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsIDUwMF1cbiAqIF0pXG4gKi9cbmV4cG9ydCBjb25zdCBFVkVOVF9ERUJPVU5DRV9NQVAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPihbXG4gIFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELCA1MDBdLCAvLyDlr7nlhrLkuovku7bnmoTliY3nva7kuovku7ZcbiAgW3RhdmVybl9ldmVudHMuTUVTU0FHRV9VUERBVEVELCAxNTAwXSwgLy8g57uE5ZCI5LqL5Lu255qE5YmN572u5LqL5Lu2XG5dKTtcblxuLyoqXG4gKiBAaW50ZXJmYWNlIEV2ZW50Sm9iXG4gKiBAZGVzY3JpcHRpb24g5a6a5LmJ5LqG5LqL5Lu26Zif5YiX5Lit5q+P5Liq5Lu75Yqh5a+56LGh55qE57uT5p6E44CCXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRKb2Ige1xuICB0eXBlOiBzdHJpbmc7XG4gIGRldGFpbD86IGFueTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbi8qKlxuICog5qC55o2u5LqL5Lu257G75Z6L77yM5p+l5om+5a6D5bGe5LqO5ZOq5Liq6aKE5a6a5LmJ55qE57uE44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0g6KaB5qOA5p+l55qE5LqL5Lu257G75Z6L44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDkuovku7bmiYDlsZ7nmoTnu4TlkI0gKCdXUklURScsICdTWU5DJywgJ0FQSScsICdVUERBVEVfTUtfT05MWScsICdVTktOT1dOJynjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEV2ZW50R3JvdXAoZXZlbnRUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyDkvb/nlKggYXMgc3RyaW5nW10g5p2l6Kej5YazIFR5cGVTY3JpcHQg5ZugICdhcyBjb25zdCcg5o6o5pat5Ye655qE6L+H5LqO5Lil5qC855qE57G75Z6L6Zeu6aKYXG4gIGlmICgoRVZFTlRfR1JPVVBTLldSSVRFIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1dSSVRFJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuU1lOQyBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdTWU5DJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuQVBJIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ0FQSSc7XG4gIGlmICgoRVZFTlRfR1JPVVBTLlVQREFURV9NS19PTkxZIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1VQREFURV9NS19PTkxZJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuQ09MTElTSU9OX0RFVEVDVE9SUyBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdDT0xMSVNJT05fREVURUNUT1JTJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuQ09NQk9fU1RBUlRFUlMgYXMgc3RyaW5nW10pLmluY2x1ZGVzKGV2ZW50VHlwZSkpIHJldHVybiAnQ09NQk9fU1RBUlRFUlMnO1xuICByZXR1cm4gJ1VOS05PV04nO1xufVxuXG4vKipcbiAqICoq44CQ5LqL5Lu25ZCI5bm25Zmo44CRKipcbiAqIOWvueS4gOaJueS6i+S7tui/m+ihjOaZuuiDveWQiOW5tu+8jOWMheaLrOWkhOeQhuS6i+S7tuWvueWGsuWSjOWQiOW5tuWQjOe7hOWPr+imhuebluS6i+S7tuOAglxuICogQHBhcmFtIHtFdmVudEpvYltdfSBiYXRjaFRvUHJvY2VzcyAtIOS7jumYn+WIl+S4reWPluWHuueahOS4gOaJueWOn+Wni+S6i+S7tuOAglxuICogQHJldHVybnMge0V2ZW50Sm9iW119IC0g57uP6L+H5ZCI5bm25LyY5YyW5ZCO55qE5LqL5Lu25pWw57uE44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZUV2ZW50QmF0Y2goYmF0Y2hUb1Byb2Nlc3M6IEV2ZW50Sm9iW10pOiBFdmVudEpvYltdIHtcbiAgY29uc3Qgb3JpZ2luYWxFdmVudHMgPSBfLmNsb25lRGVlcChiYXRjaFRvUHJvY2Vzcyk7XG4gIGNvbnN0IGZpbmFsSm9iczogRXZlbnRKb2JbXSA9IFtdO1xuXG4gIC8vIOS9v+eUqCBmb3IuLi5vZiDlvqrnjq/vvIzorqnpgLvovpHmm7TmuIXmmbBcbiAgZm9yIChjb25zdCBjdXJyZW50Sm9iIG9mIGJhdGNoVG9Qcm9jZXNzKSB7XG4gICAgLy8g5aaC5p6c5piv56ys5LiA5Liq5LqL5Lu277yM55u05o6l5pS+5YWl57uT5p6c5LitXG4gICAgaWYgKGZpbmFsSm9icy5sZW5ndGggPT09IDApIHtcbiAgICAgIGZpbmFsSm9icy5wdXNoKGN1cnJlbnRKb2IpO1xuICAgICAgY29udGludWU7IC8vIOe7p+e7reWkhOeQhuS4i+S4gOS4quS6i+S7tlxuICAgIH1cblxuICAgIGNvbnN0IHByZXZKb2IgPSBmaW5hbEpvYnNbZmluYWxKb2JzLmxlbmd0aCAtIDFdO1xuICAgIGNvbnN0IHRpbWVEaWZmZXJlbmNlID0gY3VycmVudEpvYi50aW1lc3RhbXAgLSBwcmV2Sm9iLnRpbWVzdGFtcDtcblxuICAgIC8vIDEuIOajgOafpeS6i+S7tue7hOWQiFxuICAgIGNvbnN0IGNvbWJvUnVsZSA9IEVWRU5UX0NPTUJPX01BUC5nZXQocHJldkpvYi50eXBlKTtcbiAgICBpZiAoY29tYm9SdWxlICYmIGN1cnJlbnRKb2IudHlwZSA9PT0gY29tYm9SdWxlLm5leHQpIHtcbiAgICAgIGlmICh0aW1lRGlmZmVyZW5jZSA8PSBjb21ib1J1bGUubWF4SW50ZXJ2YWwpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICdtZXJnZUV2ZW50QmF0Y2gnLFxuICAgICAgICAgIGDmo4DmtYvliLDkuovku7bnu4TlkIg6ICR7cHJldkpvYi50eXBlfSDlkowgJHtjdXJyZW50Sm9iLnR5cGV9ICjml7bpl7Tlt646ICR7dGltZURpZmZlcmVuY2V9bXMgPD0gJHtjb21ib1J1bGUubWF4SW50ZXJ2YWx9bXMp44CC5bCG5ZCI5bm25Li6ICR7Y29tYm9SdWxlLnJlc3VsdFR5cGV9IOS6i+S7tuOAgmAsXG4gICAgICAgICk7XG4gICAgICAgIGZpbmFsSm9icy5wb3AoKTsgLy8g56e76Zmk5YmN5LiA5Liq5LqL5Lu2XG4gICAgICAgIGZpbmFsSm9icy5wdXNoKHsgdHlwZTogY29tYm9SdWxlLnJlc3VsdFR5cGUsIHRpbWVzdGFtcDogY3VycmVudEpvYi50aW1lc3RhbXAsIGRldGFpbDogY3VycmVudEpvYi5kZXRhaWwgfSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICdtZXJnZUV2ZW50QmF0Y2gnLFxuICAgICAgICAgIGDmo4DmtYvliLDmvZzlnKjnmoTkuovku7bnu4TlkIjvvIzkvYblm6DotoXml7bogIzlpLHotKU6ICR7cHJldkpvYi50eXBlfSDlkowgJHtjdXJyZW50Sm9iLnR5cGV9ICjml7bpl7Tlt646ICR7dGltZURpZmZlcmVuY2V9bXMgPiAke2NvbWJvUnVsZS5tYXhJbnRlcnZhbH1tcynjgIJgLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDIuIOajgOafpeS6i+S7tuWvueWGslxuICAgIGNvbnN0IGNvbGxpc2lvblJ1bGUgPSBFVkVOVF9DT0xMSVNJT05fTUFQLmdldChwcmV2Sm9iLnR5cGUpO1xuICAgIGlmIChjb2xsaXNpb25SdWxlICYmIGN1cnJlbnRKb2IudHlwZSA9PT0gY29sbGlzaW9uUnVsZS5uZXh0KSB7XG4gICAgICBpZiAodGltZURpZmZlcmVuY2UgPD0gY29sbGlzaW9uUnVsZS5tYXhJbnRlcnZhbCkge1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgJ21lcmdlRXZlbnRCYXRjaCcsXG4gICAgICAgICAgYOajgOa1i+WIsOebuOmCu+S6i+S7tuWvueWGsjogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcyA8PSAke2NvbGxpc2lvblJ1bGUubWF4SW50ZXJ2YWx9bXMp44CC5bCG5b+955Wl6L+Z5Lik5Liq5LqL5Lu244CCYCxcbiAgICAgICAgKTtcbiAgICAgICAgZmluYWxKb2JzLnBvcCgpOyAvLyDnp7vpmaTliY3kuIDkuKrkuovku7ZcbiAgICAgICAgY29udGludWU7IC8vIOi3s+i/h+W9k+WJjeS6i+S7tu+8jOS7juiAjOW/veeVpeS4pOiAhVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICdtZXJnZUV2ZW50QmF0Y2gnLFxuICAgICAgICAgIGDmo4DmtYvliLDmvZzlnKjnmoTkuovku7blr7nlhrLvvIzkvYblm6DotoXml7bogIzlpLHotKU6ICR7cHJldkpvYi50eXBlfSDlkowgJHtjdXJyZW50Sm9iLnR5cGV9ICjml7bpl7Tlt646ICR7dGltZURpZmZlcmVuY2V9bXMgPiAke2NvbGxpc2lvblJ1bGUubWF4SW50ZXJ2YWx9bXMp44CCYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiDlpoLmnpzkuI3lhrLnqoHmiJbnu4TlkIjvvIzliJnmo4Dmn6XlkIznu4Tkuovku7blkIjlubZcbiAgICBjb25zdCBwcmV2R3JvdXAgPSBnZXRFdmVudEdyb3VwKHByZXZKb2IudHlwZSk7XG4gICAgY29uc3QgY3VycmVudEdyb3VwID0gZ2V0RXZlbnRHcm91cChjdXJyZW50Sm9iLnR5cGUpO1xuXG4gICAgLy8g5a6a5LmJ5ZCI5bm25p2h5Lu277yM6K6pIGlmIOWIpOaWreeahOaEj+WbvuabtOa4heaZsFxuICAgIGNvbnN0IGFyZUluU2FtZUdyb3VwID0gcHJldkdyb3VwID09PSBjdXJyZW50R3JvdXA7XG4gICAgY29uc3QgaXNNZXJnZWFibGVHcm91cCA9IHByZXZHcm91cCA9PT0gJ1dSSVRFJyB8fCBwcmV2R3JvdXAgPT09ICdTWU5DJztcblxuICAgIC8vIOWmguaenOa7oei2s+WQiOW5tuadoeS7tlxuICAgIGlmIChhcmVJblNhbWVHcm91cCAmJiBpc01lcmdlYWJsZUdyb3VwKSB7XG4gICAgICAvLyDnlKjlvZPliY3kuovku7bopobnm5bmjonnu5PmnpzmlbDnu4TkuK3nmoTmnIDlkI7kuIDkuKrkuovku7ZcbiAgICAgIGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV0gPSBjdXJyZW50Sm9iO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDlkKbliJnvvIzlsIblvZPliY3kuovku7bov73liqDliLDnu5PmnpzmlbDnu4RcbiAgICAgIGZpbmFsSm9icy5wdXNoKGN1cnJlbnRKb2IpO1xuICAgIH1cbiAgfVxuICAvLyDmnIDlkI7vvIzmuIXnkIbmjonmiYDmnInmnKrphY3lr7nnmoTmo4DmtYvlmajlkoznu4TlkIjotbflp4vkuovku7ZcbiAgY29uc3QgZmlsdGVyZWRKb2JzID0gZmluYWxKb2JzLmZpbHRlcihqb2IgPT4ge1xuICAgIGNvbnN0IGdyb3VwID0gZ2V0RXZlbnRHcm91cChqb2IudHlwZSk7XG4gICAgY29uc3QgaXNPcnBoYW5lZERldGVjdG9yID0gZ3JvdXAgPT09ICdDT0xMSVNJT05fREVURUNUT1JTJztcbiAgICBjb25zdCBpc09ycGhhbmVkQ29tYm9TdGFydGVyID0gZ3JvdXAgPT09ICdDT01CT19TVEFSVEVSUyc7XG4gICAgaWYgKGlzT3JwaGFuZWREZXRlY3RvciB8fCBpc09ycGhhbmVkQ29tYm9TdGFydGVyKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ21lcmdlRXZlbnRCYXRjaCcsIGDmuIXnkIbmnKrphY3lr7nnmoTkuovku7Y6ICR7am9iLnR5cGV9YCk7XG4gICAgfVxuICAgIHJldHVybiAhaXNPcnBoYW5lZERldGVjdG9yICYmICFpc09ycGhhbmVkQ29tYm9TdGFydGVyO1xuICB9KTtcblxuICAvLyDmiZPljbDlkIjlubbml6Xlv5dcbiAgbG9nZ2VyLmRlYnVnKCdtZXJnZUV2ZW50QmF0Y2gnLCBg5LqL5Lu25ZCI5bm2OiAke29yaWdpbmFsRXZlbnRzLmxlbmd0aH0gLT4gJHtmaWx0ZXJlZEpvYnMubGVuZ3RofWAsIHtcbiAgICBiZWZvcmU6IG9yaWdpbmFsRXZlbnRzLm1hcChlID0+IGUudHlwZSksXG4gICAgYWZ0ZXI6IGZpbHRlcmVkSm9icy5tYXAoZSA9PiBlLnR5cGUpLFxuICB9KTtcblxuICByZXR1cm4gZmlsdGVyZWRKb2JzO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/merger.ts\n\n}");
  },
  "./src/ERA变量框架/events/queue.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/events/queue.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pushToQueue: () => (/* binding */ pushToQueue)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _dispatcher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dispatcher */ \"./src/ERA变量框架/events/dispatcher.ts\");\n/* harmony import */ var _merger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./merger */ \"./src/ERA变量框架/events/merger.ts\");\n/**\n * @file ERA 变量框架 - 事件队列与总调度模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”。它通过一个事件队列机制，将所有事件的接收、\n * 合并、分发和执行流程化，从根本上解决了并发和状态竞争问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有事件（来自酒馆或 API）都被封装成 `EventJob` 对象，推入 `eventQueue`。\n * 2. **单线程处理**: `processQueue` 函数使用 `isProcessing` 锁确保同一时间只有一个处理循环在运行。\n * 3. **防抖与批处理**: 在处理前会进行短暂防抖，以收集短时间内连续触发的多个事件，形成一个“批次”。\n * 4. **委托合并**: 将整个批次交由 `event_merger.ts` 模块进行智能合并（对冲、覆盖）。\n * 5. **委托执行**: 循环遍历合并后的任务，将每个任务委托给 `task_dispatcher.ts` 模块进行独立、原子的执行。\n * 6. **状态传递**: 在不同任务的执行之间，传递和更新必要的上下文状态（如 `mkToIgnore` 和 `consecutiveMkState`）。\n */\n\n\n\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger('events-queue');\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue = [];\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\nlet isWaiting = false;\nlet unlockSignal = null;\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动或排队等待处理器。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nfunction pushToQueue(type, detail) {\n    logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n    eventQueue.push({ type, detail, timestamp: Date.now() });\n    processQueue();\n}\n/**\n * **【核心事件处理器】**\n * 采用“锁-等待-释放-通知”机制，确保事件处理的连续性。\n */\nasync function processQueue() {\n    // 如果已经有一个调用在“排队等待”，则本次调用直接返回，防止多个等待者。\n    if (isWaiting) {\n        logger.debug('processQueue', '已有处理函数在排队等待，本次调用忽略。');\n        return;\n    }\n    // 如果处理器正在忙碌，则进入“排队等待”状态。\n    if (isProcessing) {\n        logger.debug('processQueue', '处理器忙碌，进入排队等待状态...');\n        isWaiting = true;\n        // 等待当前处理器释放锁的信号\n        await new Promise(resolve => {\n            unlockSignal = resolve;\n        });\n        isWaiting = false;\n        logger.debug('processQueue', '等待结束，获取到处理权。');\n    }\n    // 获得处理权后，如果队列已经被前一个处理器清空，则无需做任何事。\n    if (eventQueue.length === 0) {\n        logger.debug('processQueue', '队列为空，无需处理。');\n        return;\n    }\n    // 【加锁】\n    // 正式开始处理，加锁以阻止其他调用进入。\n    isProcessing = true;\n    logger.log('processQueue', '处理器启动');\n    // 【防抖】\n    const firstJob = eventQueue[0];\n    const group = (0,_merger__WEBPACK_IMPORTED_MODULE_2__.getEventGroup)(firstJob.type);\n    if (group !== 'API') {\n        const debounceTime = _merger__WEBPACK_IMPORTED_MODULE_2__.EVENT_DEBOUNCE_MAP.get(firstJob.type) ?? 300;\n        logger.log('processQueue', `启动事件收集窗口，等待 ${debounceTime}ms...`);\n        await new Promise(resolve => setTimeout(resolve, debounceTime));\n    }\n    // 【调试日志】\n    logger.debug('processQueue', '事件收集窗口关闭，准备处理的队列内容:', JSON.stringify(eventQueue.map(e => e.type)));\n    // 【循环处理】\n    // 只要队列不为空，就持续处理。这能确保在防抖期间新到达的事件也被纳入处理范围。\n    let mkToIgnore = null;\n    while (eventQueue.length > 0) {\n        const batchToProcess = eventQueue.splice(0, eventQueue.length);\n        const finalJobs = (0,_merger__WEBPACK_IMPORTED_MODULE_2__.mergeEventBatch)(batchToProcess);\n        logger.debug('processQueue', `开始处理一个新批次，包含 ${batchToProcess.length} 个原始事件，合并后为 ${finalJobs.length} 个任务。`);\n        for (const job of finalJobs) {\n            const newIgnoreRule = await (0,_dispatcher__WEBPACK_IMPORTED_MODULE_1__.dispatchAndExecuteTask)(job, mkToIgnore);\n            mkToIgnore = newIgnoreRule;\n        }\n        logger.debug('processQueue', '本轮批次处理完毕。');\n    }\n    // 【解锁并通知】\n    isProcessing = false;\n    logger.log('processQueue', '处理器空闲，已释放锁。');\n    // 如果有等待者，则发送解锁信号，让它立即开始。\n    if (unlockSignal) {\n        logger.debug('processQueue', '通知排队的处理器开始工作。');\n        const signal = unlockSignal;\n        unlockSignal = null;\n        signal();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50cy9xdWV1ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUVVO0FBRXlCO0FBQzRCO0FBQ3NCO0FBRXhGLE1BQU0sTUFBTSxHQUFHLElBQUksOENBQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUUxQzs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsR0FBZSxFQUFFLENBQUM7QUFFbEM7OztHQUdHO0FBQ0gsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO0FBQ3pCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztBQUN0QixJQUFJLFlBQVksR0FBd0IsSUFBSSxDQUFDO0FBRTdDOzs7OztHQUtHO0FBQ0ksU0FBUyxXQUFXLENBQUMsSUFBWSxFQUFFLE1BQVk7SUFDcEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsVUFBVSxJQUFJLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDakUsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDekQsWUFBWSxFQUFFLENBQUM7QUFDakIsQ0FBQztBQUVEOzs7R0FHRztBQUNILEtBQUssVUFBVSxZQUFZO0lBQ3pCLHNDQUFzQztJQUN0QyxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBQ2QsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUscUJBQXFCLENBQUMsQ0FBQztRQUNwRCxPQUFPO0lBQ1QsQ0FBQztJQUVELHlCQUF5QjtJQUN6QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLG1CQUFtQixDQUFDLENBQUM7UUFDbEQsU0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixnQkFBZ0I7UUFDaEIsTUFBTSxJQUFJLE9BQU8sQ0FBTyxPQUFPLENBQUMsRUFBRTtZQUNoQyxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsa0NBQWtDO0lBQ2xDLElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUM1QixNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUMzQyxPQUFPO0lBQ1QsQ0FBQztJQUVELE9BQU87SUFDUCxzQkFBc0I7SUFDdEIsWUFBWSxHQUFHLElBQUksQ0FBQztJQUNwQixNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUVwQyxPQUFPO0lBQ1AsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sS0FBSyxHQUFHLHNEQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNDLElBQUksS0FBSyxLQUFLLEtBQUssRUFBRSxDQUFDO1FBQ3BCLE1BQU0sWUFBWSxHQUFHLHVEQUFrQixDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDO1FBQ2xFLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLGVBQWUsWUFBWSxPQUFPLENBQUMsQ0FBQztRQUMvRCxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFFRCxTQUFTO0lBQ1QsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVqRyxTQUFTO0lBQ1QseUNBQXlDO0lBQ3pDLElBQUksVUFBVSxHQUFzQixJQUFJLENBQUM7SUFDekMsT0FBTyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQzdCLE1BQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvRCxNQUFNLFNBQVMsR0FBRyx3REFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRWxELE1BQU0sQ0FBQyxLQUFLLENBQ1YsY0FBYyxFQUNkLGdCQUFnQixjQUFjLENBQUMsTUFBTSxlQUFlLFNBQVMsQ0FBQyxNQUFNLE9BQU8sQ0FDNUUsQ0FBQztRQUVGLEtBQUssTUFBTSxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7WUFDNUIsTUFBTSxhQUFhLEdBQUcsTUFBTSxtRUFBc0IsQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDcEUsVUFBVSxHQUFHLGFBQWEsQ0FBQztRQUM3QixDQUFDO1FBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELFVBQVU7SUFDVixZQUFZLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBRTFDLHlCQUF5QjtJQUN6QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQztRQUM1QixZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLE1BQU0sRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9ldmVudHMvcXVldWUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5LqL5Lu26Zif5YiX5LiO5oC76LCD5bqm5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaooeWdl+aYryBFUkEg5qGG5p6255qE4oCc56We57uP5Lit5p6i4oCd44CC5a6D6YCa6L+H5LiA5Liq5LqL5Lu26Zif5YiX5py65Yi277yM5bCG5omA5pyJ5LqL5Lu255qE5o6l5pS244CBXG4gKiDlkIjlubbjgIHliIblj5HlkozmiafooYzmtYHnqIvljJbvvIzku47moLnmnKzkuIrop6PlhrPkuoblubblj5HlkoznirbmgIHnq57kuonpl67popjjgIJcbiAqXG4gKiAqKuW3peS9nOWOn+eQhioqOlxuICogMS4gKirkuovku7blhaXpmJ8qKjog5omA5pyJ5LqL5Lu277yI5p2l6Ieq6YWS6aaG5oiWIEFQSe+8iemDveiiq+WwgeijheaIkCBgRXZlbnRKb2JgIOWvueixoe+8jOaOqOWFpSBgZXZlbnRRdWV1ZWDjgIJcbiAqIDIuICoq5Y2V57q/56iL5aSE55CGKio6IGBwcm9jZXNzUXVldWVgIOWHveaVsOS9v+eUqCBgaXNQcm9jZXNzaW5nYCDplIHnoa7kv53lkIzkuIDml7bpl7Tlj6rmnInkuIDkuKrlpITnkIblvqrnjq/lnKjov5DooYzjgIJcbiAqIDMuICoq6Ziy5oqW5LiO5om55aSE55CGKio6IOWcqOWkhOeQhuWJjeS8mui/m+ihjOefreaagumYsuaKlu+8jOS7peaUtumbhuefreaXtumXtOWGhei/nue7reinpuWPkeeahOWkmuS4quS6i+S7tu+8jOW9ouaIkOS4gOS4quKAnOaJueasoeKAneOAglxuICogNC4gKirlp5TmiZjlkIjlubYqKjog5bCG5pW05Liq5om55qyh5Lqk55SxIGBldmVudF9tZXJnZXIudHNgIOaooeWdl+i/m+ihjOaZuuiDveWQiOW5tu+8iOWvueWGsuOAgeimhueblu+8ieOAglxuICogNS4gKirlp5TmiZjmiafooYwqKjog5b6q546v6YGN5Y6G5ZCI5bm25ZCO55qE5Lu75Yqh77yM5bCG5q+P5Liq5Lu75Yqh5aeU5omY57uZIGB0YXNrX2Rpc3BhdGNoZXIudHNgIOaooeWdl+i/m+ihjOeLrOeri+OAgeWOn+WtkOeahOaJp+ihjOOAglxuICogNi4gKirnirbmgIHkvKDpgJIqKjog5Zyo5LiN5ZCM5Lu75Yqh55qE5omn6KGM5LmL6Ze077yM5Lyg6YCS5ZKM5pu05paw5b+F6KaB55qE5LiK5LiL5paH54q25oCB77yI5aaCIGBta1RvSWdub3JlYCDlkowgYGNvbnNlY3V0aXZlTWtTdGF0ZWDvvInjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZyc7XG5pbXBvcnQgeyBkaXNwYXRjaEFuZEV4ZWN1dGVUYXNrLCBJZ25vcmVSdWxlIH0gZnJvbSAnLi9kaXNwYXRjaGVyJztcbmltcG9ydCB7IEVWRU5UX0RFQk9VTkNFX01BUCwgRXZlbnRKb2IsIGdldEV2ZW50R3JvdXAsIG1lcmdlRXZlbnRCYXRjaCB9IGZyb20gJy4vbWVyZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignZXZlbnRzLXF1ZXVlJyk7XG5cbi8qKlxuICogQGNvbnN0IHtFdmVudEpvYltdfSBldmVudFF1ZXVlXG4gKiBAZGVzY3JpcHRpb24g5LqL5Lu26Zif5YiX77yM5a2Y5YKo5omA5pyJ5b6F5aSE55CG55qE5LqL5Lu25Lu75Yqh44CCXG4gKi9cbmNvbnN0IGV2ZW50UXVldWU6IEV2ZW50Sm9iW10gPSBbXTtcblxuLyoqXG4gKiBAbGV0IHtib29sZWFufSBpc1Byb2Nlc3NpbmdcbiAqIEBkZXNjcmlwdGlvbiDlpITnkIblmajplIHjgILkuLogdHJ1ZSDml7booajnpLogYHByb2Nlc3NRdWV1ZWAg5q2j5Zyo6L+Q6KGM77yM6Ziy5q2i6YeN5YWl44CCXG4gKi9cbmxldCBpc1Byb2Nlc3NpbmcgPSBmYWxzZTtcbmxldCBpc1dhaXRpbmcgPSBmYWxzZTtcbmxldCB1bmxvY2tTaWduYWw6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuXG4vKipcbiAqICoq44CQ5LqL5Lu25YWl5Y+j44CRKipcbiAqIOWwhuS4gOS4quS6i+S7tuaOqOWFpemYn+WIl++8jOW5tuWwneivleWQr+WKqOaIluaOkumYn+etieW+heWkhOeQhuWZqOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSDkuovku7bnsbvlnosgKGUuZy4sIGB0YXZlcm5fZXZlbnRzLk1FU1NBR0VfREVMRVRFRGAp44CCXG4gKiBAcGFyYW0ge2FueX0gW2RldGFpbF0gLSDkuovku7bpmYTluKbnmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHB1c2hUb1F1ZXVlKHR5cGU6IHN0cmluZywgZGV0YWlsPzogYW55KSB7XG4gIGxvZ2dlci5kZWJ1ZygncHVzaFRvUXVldWUnLCBg5o6l5pS25Yiw5LqL5Lu2OiAke3R5cGV977yM5bey5o6o5YWl6Zif5YiX44CCYCwgeyBkZXRhaWwgfSk7XG4gIGV2ZW50UXVldWUucHVzaCh7IHR5cGUsIGRldGFpbCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICBwcm9jZXNzUXVldWUoKTtcbn1cblxuLyoqXG4gKiAqKuOAkOaguOW/g+S6i+S7tuWkhOeQhuWZqOOAkSoqXG4gKiDph4fnlKjigJzplIEt562J5b6FLemHiuaUvi3pgJrnn6XigJ3mnLrliLbvvIznoa7kv53kuovku7blpITnkIbnmoTov57nu63mgKfjgIJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkge1xuICAvLyDlpoLmnpzlt7Lnu4/mnInkuIDkuKrosIPnlKjlnKjigJzmjpLpmJ/nrYnlvoXigJ3vvIzliJnmnKzmrKHosIPnlKjnm7TmjqXov5Tlm57vvIzpmLLmraLlpJrkuKrnrYnlvoXogIXjgIJcbiAgaWYgKGlzV2FpdGluZykge1xuICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc1F1ZXVlJywgJ+W3suacieWkhOeQhuWHveaVsOWcqOaOkumYn+etieW+he+8jOacrOasoeiwg+eUqOW/veeVpeOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOWmguaenOWkhOeQhuWZqOato+WcqOW/meeijO+8jOWImei/m+WFpeKAnOaOkumYn+etieW+heKAneeKtuaAgeOAglxuICBpZiAoaXNQcm9jZXNzaW5nKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo5b+Z56KM77yM6L+b5YWl5o6S6Zif562J5b6F54q25oCBLi4uJyk7XG4gICAgaXNXYWl0aW5nID0gdHJ1ZTtcbiAgICAvLyDnrYnlvoXlvZPliY3lpITnkIblmajph4rmlL7plIHnmoTkv6Hlj7dcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcbiAgICAgIHVubG9ja1NpZ25hbCA9IHJlc29sdmU7XG4gICAgfSk7XG4gICAgaXNXYWl0aW5nID0gZmFsc2U7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn562J5b6F57uT5p2f77yM6I635Y+W5Yiw5aSE55CG5p2D44CCJyk7XG4gIH1cblxuICAvLyDojrflvpflpITnkIbmnYPlkI7vvIzlpoLmnpzpmJ/liJflt7Lnu4/ooqvliY3kuIDkuKrlpITnkIblmajmuIXnqbrvvIzliJnml6DpnIDlgZrku7vkvZXkuovjgIJcbiAgaWYgKGV2ZW50UXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn6Zif5YiX5Li656m677yM5peg6ZyA5aSE55CG44CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g44CQ5Yqg6ZSB44CRXG4gIC8vIOato+W8j+W8gOWni+WkhOeQhu+8jOWKoOmUgeS7pemYu+atouWFtuS7luiwg+eUqOi/m+WFpeOAglxuICBpc1Byb2Nlc3NpbmcgPSB0cnVlO1xuICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo5ZCv5YqoJyk7XG5cbiAgLy8g44CQ6Ziy5oqW44CRXG4gIGNvbnN0IGZpcnN0Sm9iID0gZXZlbnRRdWV1ZVswXTtcbiAgY29uc3QgZ3JvdXAgPSBnZXRFdmVudEdyb3VwKGZpcnN0Sm9iLnR5cGUpO1xuICBpZiAoZ3JvdXAgIT09ICdBUEknKSB7XG4gICAgY29uc3QgZGVib3VuY2VUaW1lID0gRVZFTlRfREVCT1VOQ0VfTUFQLmdldChmaXJzdEpvYi50eXBlKSA/PyAzMDA7XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc1F1ZXVlJywgYOWQr+WKqOS6i+S7tuaUtumbhueql+WPo++8jOetieW+hSAke2RlYm91bmNlVGltZX1tcy4uLmApO1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWJvdW5jZVRpbWUpKTtcbiAgfVxuXG4gIC8vIOOAkOiwg+ivleaXpeW/l+OAkVxuICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NRdWV1ZScsICfkuovku7bmlLbpm4bnqpflj6PlhbPpl63vvIzlh4blpIflpITnkIbnmoTpmJ/liJflhoXlrrk6JywgSlNPTi5zdHJpbmdpZnkoZXZlbnRRdWV1ZS5tYXAoZSA9PiBlLnR5cGUpKSk7XG5cbiAgLy8g44CQ5b6q546v5aSE55CG44CRXG4gIC8vIOWPquimgemYn+WIl+S4jeS4uuepuu+8jOWwseaMgee7reWkhOeQhuOAgui/meiDveehruS/neWcqOmYsuaKluacn+mXtOaWsOWIsOi+vueahOS6i+S7tuS5n+iiq+e6s+WFpeWkhOeQhuiMg+WbtOOAglxuICBsZXQgbWtUb0lnbm9yZTogSWdub3JlUnVsZSB8IG51bGwgPSBudWxsO1xuICB3aGlsZSAoZXZlbnRRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgYmF0Y2hUb1Byb2Nlc3MgPSBldmVudFF1ZXVlLnNwbGljZSgwLCBldmVudFF1ZXVlLmxlbmd0aCk7XG4gICAgY29uc3QgZmluYWxKb2JzID0gbWVyZ2VFdmVudEJhdGNoKGJhdGNoVG9Qcm9jZXNzKTtcblxuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdwcm9jZXNzUXVldWUnLFxuICAgICAgYOW8gOWni+WkhOeQhuS4gOS4quaWsOaJueasoe+8jOWMheWQqyAke2JhdGNoVG9Qcm9jZXNzLmxlbmd0aH0g5Liq5Y6f5aeL5LqL5Lu277yM5ZCI5bm25ZCO5Li6ICR7ZmluYWxKb2JzLmxlbmd0aH0g5Liq5Lu75Yqh44CCYCxcbiAgICApO1xuXG4gICAgZm9yIChjb25zdCBqb2Igb2YgZmluYWxKb2JzKSB7XG4gICAgICBjb25zdCBuZXdJZ25vcmVSdWxlID0gYXdhaXQgZGlzcGF0Y2hBbmRFeGVjdXRlVGFzayhqb2IsIG1rVG9JZ25vcmUpO1xuICAgICAgbWtUb0lnbm9yZSA9IG5ld0lnbm9yZVJ1bGU7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc1F1ZXVlJywgJ+acrOi9ruaJueasoeWkhOeQhuWujOavleOAgicpO1xuICB9XG5cbiAgLy8g44CQ6Kej6ZSB5bm26YCa55+l44CRXG4gIGlzUHJvY2Vzc2luZyA9IGZhbHNlO1xuICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCAn5aSE55CG5Zmo56m66Zey77yM5bey6YeK5pS+6ZSB44CCJyk7XG5cbiAgLy8g5aaC5p6c5pyJ562J5b6F6ICF77yM5YiZ5Y+R6YCB6Kej6ZSB5L+h5Y+377yM6K6p5a6D56uL5Y2z5byA5aeL44CCXG4gIGlmICh1bmxvY2tTaWduYWwpIHtcbiAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NRdWV1ZScsICfpgJrnn6XmjpLpmJ/nmoTlpITnkIblmajlvIDlp4vlt6XkvZzjgIInKTtcbiAgICBjb25zdCBzaWduYWwgPSB1bmxvY2tTaWduYWw7XG4gICAgdW5sb2NrU2lnbmFsID0gbnVsbDtcbiAgICBzaWduYWwoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/events/queue.ts\n\n}");
  },
  "./src/ERA变量框架/index.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/index.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _events_merger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./events/merger */ \"./src/ERA变量框架/events/merger.ts\");\n/* harmony import */ var _events_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./events/queue */ \"./src/ERA变量框架/events/queue.ts\");\n/* harmony import */ var _api_macro_parser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./api/macro/parser */ \"./src/ERA变量框架/api/macro/parser.ts\");\n/* harmony import */ var _ui__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ui */ \"./src/ERA变量框架/ui/index.ts\");\n/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\n\n// 导入 UI 模块\n\n// ===============================\n// 事件监听器注册\n// ===============================\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.WRITE,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.SYNC,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.API,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.UPDATE_MK_ONLY,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COLLISION_DETECTORS,\n    ..._events_merger__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COMBO_STARTERS,\n];\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n    // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n    // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n    eventOn(ev, (detail) => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)(ev, detail));\n});\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => (0,_events_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_full_sync'));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7OztHQVlHO0FBRVU7QUFFa0M7QUFDRjtBQUU3Qyw0QkFBNEI7QUFDQTtBQUU1QixXQUFXO0FBQ0c7QUFFZCxrQ0FBa0M7QUFDbEMsVUFBVTtBQUNWLGtDQUFrQztBQUVsQzs7O0dBR0c7QUFDSCxNQUFNLGNBQWMsR0FBRztJQUNyQixHQUFHLHdEQUFZLENBQUMsS0FBSztJQUNyQixHQUFHLHdEQUFZLENBQUMsSUFBSTtJQUNwQixHQUFHLHdEQUFZLENBQUMsR0FBRztJQUNuQixHQUFHLHdEQUFZLENBQUMsY0FBYztJQUM5QixHQUFHLHdEQUFZLENBQUMsbUJBQW1CO0lBQ25DLEdBQUcsd0RBQVksQ0FBQyxjQUFjO0NBQy9CLENBQUM7QUFFRix3QkFBd0I7QUFDeEIsb0JBQW9CO0FBQ3BCLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7SUFDMUIsbUNBQW1DO0lBQ25DLHdEQUF3RDtJQUN4RCxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsTUFBVyxFQUFFLEVBQUUsQ0FBQywwREFBVyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ3hELENBQUMsQ0FBQyxDQUFDO0FBRUgsd0JBQXdCO0FBQ3hCLDRCQUE0QjtBQUM1QixPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztBQUNyRSxPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztBQUNwRSxPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLDBEQUFXLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5Li75YWl5Y+j5LiO5LqL5Lu255uR5ZCs5qih5Z2XXG4gKiBAZGVzY3JpcHRpb25cbiAqIOivpeaWh+S7tuaYr+aVtOS4qiBFUkEg5Y+Y6YeP5qGG5p6255qE6LW354K544CC5a6D55qE6IGM6LSj6Z2e5bi45riF5pmw5ZKM5LiT5LiA77yaXG4gKiAxLiAqKuWumuS5ieebkeWQrOiMg+WbtCoqOiDlo7DmmI7moYbmnrbmiYDlhbPlv4PnmoTmiYDmnInkuovku7bnsbvlnovjgIJcbiAqIDIuICoq5rOo5YaM55uR5ZCs5ZmoKio6IOS4uuS4iui/sOaJgOacieS6i+S7tuazqOWGjOebkeWQrOWZqOOAglxuICogMy4gKirnu5/kuIDmtL7lj5EqKjog5b2T5Lu75L2V5LiA5Liq6KKr55uR5ZCs55qE5LqL5Lu26Kem5Y+R5pe277yM5a6D5LiN6L+b6KGM5Lu75L2V6YC76L6R5aSE55CG77yMXG4gKiAgICDogIzmmK/nq4vljbPlsIbor6Xkuovku7bvvIjljIXmi6zkuovku7bnsbvlnovlkozpmYTluKbmlbDmja7vvInljp/lsIHkuI3liqjlnLDmjqjlhaXliLAgYGV2ZW50X3F1ZXVlLnRzYFxuICogICAg5Lit55qE5LqL5Lu25aSE55CG6Zif5YiX5Lit44CCXG4gKlxuICog6L+Z56eN6K6+6K6h5L2T546w5LqG6Imv5aW955qEKirlhbPms6jngrnliIbnprsqKuWOn+WIme+8mmBpbmRleC50c2Ag5Y+q6LSf6LSj4oCc5ZCs4oCd77yM6ICMIGBldmVudF9xdWV1ZS50c2BcbiAqIOi0n+i0o+KAnOaAneiAg+KAneWSjOKAnOihjOWKqOKAneOAgui/meS9v+W+l+S6i+S7tueahOadpea6kOWSjOWkhOeQhumAu+i+keWujOWFqOino+iApu+8jOmdnuW4uOa4heaZsOS4lOaYk+S6jue7tOaKpOOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgRVZFTlRfR1JPVVBTIH0gZnJvbSAnLi9ldmVudHMvbWVyZ2VyJztcbmltcG9ydCB7IHB1c2hUb1F1ZXVlIH0gZnJvbSAnLi9ldmVudHMvcXVldWUnO1xuXG4vLyDlr7zlhaXmn6Xor6LmqKHlnZcsIOS7peazqOWGjCB7e0VSQTouLi59fSDlro9cbmltcG9ydCAnLi9hcGkvbWFjcm8vcGFyc2VyJztcblxuLy8g5a+85YWlIFVJIOaooeWdl1xuaW1wb3J0ICcuL3VpJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5LqL5Lu255uR5ZCs5Zmo5rOo5YaMXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQGNvbnN0IHtzdHJpbmdbXX0gZXZlbnRzVG9MaXN0ZW5cbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnkuobmiYDmnInpnIDopoHooqsgRVJBIOahhuaetuebkeWQrOeahOS6i+S7tuOAglxuICovXG5jb25zdCBldmVudHNUb0xpc3RlbiA9IFtcbiAgLi4uRVZFTlRfR1JPVVBTLldSSVRFLFxuICAuLi5FVkVOVF9HUk9VUFMuU1lOQyxcbiAgLi4uRVZFTlRfR1JPVVBTLkFQSSxcbiAgLi4uRVZFTlRfR1JPVVBTLlVQREFURV9NS19PTkxZLFxuICAuLi5FVkVOVF9HUk9VUFMuQ09MTElTSU9OX0RFVEVDVE9SUyxcbiAgLi4uRVZFTlRfR1JPVVBTLkNPTUJPX1NUQVJURVJTLFxuXTtcblxuLy8g6YGN5Y6G5LqL5Lu25YiX6KGo77yM5Li65q+P5Liq5LqL5Lu25rOo5YaM5LiA5Liq5Zue6LCD5Ye95pWw44CCXG4vLyDov5nkuKrlm57osIPlh73mlbDmmK/miYDmnInkuovku7bnmoTnu5/kuIDlhaXlj6PjgIJcbmV2ZW50c1RvTGlzdGVuLmZvckVhY2goZXYgPT4ge1xuICAvLyBgZXZlbnRPbmAg5piv6YWS6aaG5Yqp5omL5o+Q5L6b55qE5YWo5bGA5Ye95pWw77yM55So5LqO5rOo5YaM5LqL5Lu255uR5ZCs44CCXG4gIC8vIOW9k+S6i+S7tiBgZXZgIOinpuWPkeaXtu+8jOWbnuiwg+WHveaVsOiiq+iwg+eUqO+8jOW5tuWwhuS6i+S7tuexu+WeiyBgZXZgIOWSjOS6i+S7tuivpuaDhSBgZGV0YWlsYCDmjqjlhaXpmJ/liJfjgIJcbiAgZXZlbnRPbihldiwgKGRldGFpbDogYW55KSA9PiBwdXNoVG9RdWV1ZShldiwgZGV0YWlsKSk7XG59KTtcblxuLy8g5Li66YWS6aaG5Yqp5omL6ISa5pys55WM6Z2i5Lit55qE5omL5Yqo5oyJ6ZKu5rOo5YaM55uR5ZCs5Zmo44CCXG4vLyDngrnlh7vmjInpkq7ml7bvvIzlkIzmoLfmmK/lkJHpmJ/liJfkuK3mjqjlhaXkuIDkuKrnibnlrprnsbvlnovnmoTkuovku7bjgIJcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+WGmeWFpeWPmOmHj+S/ruaUuScpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX3dyaXRlJykpO1xuZXZlbnRPbihnZXRCdXR0b25FdmVudCgn5omL5Yqo5ZCM5q2l54q25oCBJyksICgpID0+IHB1c2hUb1F1ZXVlKCdtYW51YWxfc3luYycpKTtcbmV2ZW50T24oZ2V0QnV0dG9uRXZlbnQoJ+W8uuWItuWujOWFqOmHjeeulycpLCAoKSA9PiBwdXNoVG9RdWV1ZSgnbWFudWFsX2Z1bGxfc3luYycpKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/index.ts\n\n}");
  },
  "./src/ERA变量框架/ui/components/statusBar/index.ts": 
  /*!******************************************************!*\
  !*** ./src/ERA变量框架/ui/components/statusBar/index.ts ***!
  \******************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initStatusBar: () => (/* binding */ initStatusBar)\n/* harmony export */ });\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"jquery\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _statusBarContent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../statusBarContent */ \"./src/ERA变量框架/ui/components/statusBarContent/index.ts\");\n\n\nconst statusBarId = `era-status-bar-${getScriptId()}`;\nlet isExpanded = false; // 追踪展开/收缩状态\n// 定义不同状态下的样式\nconst collapsedStyle = {\n    width: '50px',\n    height: '50px',\n    'border-radius': '50%',\n    bottom: '20px',\n    left: '20px',\n    top: '',\n    right: '',\n    cursor: 'pointer',\n    'justify-content': 'center',\n    'align-items': 'center',\n    display: 'flex',\n    overflow: 'hidden',\n};\nconst expandedStyle = {\n    width: '300px',\n    height: '200px',\n    'border-radius': '10px',\n    cursor: 'default',\n    padding: '12px',\n    display: 'block',\n};\nfunction toggleExpand($statusBar, $content) {\n    isExpanded = !isExpanded;\n    if (isExpanded) {\n        // 展开\n        $statusBar.css(expandedStyle);\n        $statusBar.find('span').hide();\n        $content.show();\n        // 调用渲染函数，以确保显示的是最新的数据。\n        // 这是延迟渲染机制的一部分，用于解决在隐藏元素上更新 HTML 可能导致内容不全的问题。\n        (0,_statusBarContent__WEBPACK_IMPORTED_MODULE_1__.renderStatusBarContent)($content);\n    }\n    else {\n        // 收缩\n        $statusBar.css(collapsedStyle);\n        $statusBar.find('span').show();\n        $content.hide();\n    }\n}\nfunction createStatusBar() {\n    if (jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${statusBarId}`).length > 0) {\n        return;\n    }\n    const $statusBar = jquery__WEBPACK_IMPORTED_MODULE_0___default()('<div>')\n        .attr('id', statusBarId)\n        .css({\n        position: 'fixed',\n        'background-color': 'rgba(0, 0, 0, 0.7)',\n        color: 'white',\n        'font-size': '14px',\n        'z-index': '10000',\n        'border-top': '1px solid #444',\n        transition: 'all 0.3s ease-in-out',\n        ...collapsedStyle,\n    })\n        .html('<span>ERA</span>');\n    const $content = jquery__WEBPACK_IMPORTED_MODULE_0___default()('<div>').css({\n        display: 'none',\n        'overflow-y': 'auto',\n        height: '100%',\n    });\n    $statusBar.append($content);\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()('body').append($statusBar);\n    $statusBar.draggable({\n        handle: `#${statusBarId}`,\n        containment: 'window',\n    });\n    $statusBar.on('click', () => {\n        setTimeout(() => {\n            if ($statusBar.hasClass('ui-draggable-dragging')) {\n                return;\n            }\n            toggleExpand($statusBar, $content);\n        }, 50);\n    });\n    return $statusBar;\n}\nfunction removeStatusBar() {\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(`#${statusBarId}`).remove();\n}\n// 导出初始化函数，由 ui/index.ts 调用\nfunction initStatusBar() {\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(() => {\n        const $statusBar = createStatusBar();\n        if (!$statusBar)\n            return;\n        const $content = $statusBar.find('div');\n        (0,_statusBarContent__WEBPACK_IMPORTED_MODULE_1__.initStatusBarContent)($content);\n    });\n    jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on('pagehide', () => {\n        removeStatusBar();\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2NvbXBvbmVudHMvc3RhdHVzQmFyL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBdUI7QUFDNEQ7QUFTbkYsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLFdBQVcsRUFBRSxFQUFFLENBQUM7QUFDdEQsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsWUFBWTtBQUVwQyxhQUFhO0FBQ2IsTUFBTSxjQUFjLEdBQUc7SUFDckIsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsTUFBTTtJQUNkLGVBQWUsRUFBRSxLQUFLO0lBQ3RCLE1BQU0sRUFBRSxNQUFNO0lBQ2QsSUFBSSxFQUFFLE1BQU07SUFDWixHQUFHLEVBQUUsRUFBRTtJQUNQLEtBQUssRUFBRSxFQUFFO0lBQ1QsTUFBTSxFQUFFLFNBQVM7SUFDakIsaUJBQWlCLEVBQUUsUUFBUTtJQUMzQixhQUFhLEVBQUUsUUFBUTtJQUN2QixPQUFPLEVBQUUsTUFBTTtJQUNmLFFBQVEsRUFBRSxRQUFRO0NBQ25CLENBQUM7QUFFRixNQUFNLGFBQWEsR0FBRztJQUNwQixLQUFLLEVBQUUsT0FBTztJQUNkLE1BQU0sRUFBRSxPQUFPO0lBQ2YsZUFBZSxFQUFFLE1BQU07SUFDdkIsTUFBTSxFQUFFLFNBQVM7SUFDakIsT0FBTyxFQUFFLE1BQU07SUFDZixPQUFPLEVBQUUsT0FBTztDQUNqQixDQUFDO0FBRUYsU0FBUyxZQUFZLENBQUMsVUFBa0IsRUFBRSxRQUFnQjtJQUN4RCxVQUFVLEdBQUcsQ0FBQyxVQUFVLENBQUM7SUFDekIsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUNmLEtBQUs7UUFDTCxVQUFVLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzlCLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0IsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLHVCQUF1QjtRQUN2Qiw4Q0FBOEM7UUFDOUMseUVBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbkMsQ0FBQztTQUFNLENBQUM7UUFDTixLQUFLO1FBQ0wsVUFBVSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUMvQixVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQy9CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQixDQUFDO0FBQ0gsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0QixJQUFJLDZDQUFDLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUNwQyxPQUFPO0lBQ1QsQ0FBQztJQUVELE1BQU0sVUFBVSxHQUFHLDZDQUFDLENBQUMsT0FBTyxDQUFDO1NBQzFCLElBQUksQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDO1NBQ3ZCLEdBQUcsQ0FBQztRQUNILFFBQVEsRUFBRSxPQUFPO1FBQ2pCLGtCQUFrQixFQUFFLG9CQUFvQjtRQUN4QyxLQUFLLEVBQUUsT0FBTztRQUNkLFdBQVcsRUFBRSxNQUFNO1FBQ25CLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFlBQVksRUFBRSxnQkFBZ0I7UUFDOUIsVUFBVSxFQUFFLHNCQUFzQjtRQUNsQyxHQUFHLGNBQWM7S0FDbEIsQ0FBQztTQUNELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBRTVCLE1BQU0sUUFBUSxHQUFHLDZDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQzlCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsWUFBWSxFQUFFLE1BQU07UUFDcEIsTUFBTSxFQUFFLE1BQU07S0FDZixDQUFDLENBQUM7SUFFSCxVQUFVLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzVCLDZDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRTdCLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFDbkIsTUFBTSxFQUFFLElBQUksV0FBVyxFQUFFO1FBQ3pCLFdBQVcsRUFBRSxRQUFRO0tBQ3RCLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUMxQixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQztnQkFDakQsT0FBTztZQUNULENBQUM7WUFDRCxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0Qiw2Q0FBQyxDQUFDLElBQUksV0FBVyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNoQyxDQUFDO0FBRUQsMkJBQTJCO0FBQ3BCLFNBQVMsYUFBYTtJQUMzQiw2Q0FBQyxDQUFDLEdBQUcsRUFBRTtRQUNMLE1BQU0sVUFBVSxHQUFHLGVBQWUsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTztRQUV4QixNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLHVFQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBRUgsNkNBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUM1QixlQUFlLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91aS9jb21wb25lbnRzL3N0YXR1c0Jhci9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xyXG5pbXBvcnQgeyBpbml0U3RhdHVzQmFyQ29udGVudCwgcmVuZGVyU3RhdHVzQmFyQ29udGVudCB9IGZyb20gJy4uL3N0YXR1c0JhckNvbnRlbnQnO1xyXG5cclxuLy8g55Sx5LqOIGpxdWVyeS11aS1kaXN0IOS4jeWQqyB0eXBlcywg5oiR5Lus6ZyA6KaB5omL5Yqo5aOw5piOIGRyYWdnYWJsZVxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgaW50ZXJmYWNlIEpRdWVyeSB7XHJcbiAgICBkcmFnZ2FibGUob3B0aW9ucz86IGFueSk6IEpRdWVyeTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHN0YXR1c0JhcklkID0gYGVyYS1zdGF0dXMtYmFyLSR7Z2V0U2NyaXB0SWQoKX1gO1xyXG5sZXQgaXNFeHBhbmRlZCA9IGZhbHNlOyAvLyDov73ouKrlsZXlvIAv5pS257yp54q25oCBXHJcblxyXG4vLyDlrprkuYnkuI3lkIznirbmgIHkuIvnmoTmoLflvI9cclxuY29uc3QgY29sbGFwc2VkU3R5bGUgPSB7XHJcbiAgd2lkdGg6ICc1MHB4JyxcclxuICBoZWlnaHQ6ICc1MHB4JyxcclxuICAnYm9yZGVyLXJhZGl1cyc6ICc1MCUnLFxyXG4gIGJvdHRvbTogJzIwcHgnLFxyXG4gIGxlZnQ6ICcyMHB4JyxcclxuICB0b3A6ICcnLFxyXG4gIHJpZ2h0OiAnJyxcclxuICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAnanVzdGlmeS1jb250ZW50JzogJ2NlbnRlcicsXHJcbiAgJ2FsaWduLWl0ZW1zJzogJ2NlbnRlcicsXHJcbiAgZGlzcGxheTogJ2ZsZXgnLFxyXG4gIG92ZXJmbG93OiAnaGlkZGVuJyxcclxufTtcclxuXHJcbmNvbnN0IGV4cGFuZGVkU3R5bGUgPSB7XHJcbiAgd2lkdGg6ICczMDBweCcsXHJcbiAgaGVpZ2h0OiAnMjAwcHgnLFxyXG4gICdib3JkZXItcmFkaXVzJzogJzEwcHgnLFxyXG4gIGN1cnNvcjogJ2RlZmF1bHQnLFxyXG4gIHBhZGRpbmc6ICcxMnB4JyxcclxuICBkaXNwbGF5OiAnYmxvY2snLFxyXG59O1xyXG5cclxuZnVuY3Rpb24gdG9nZ2xlRXhwYW5kKCRzdGF0dXNCYXI6IEpRdWVyeSwgJGNvbnRlbnQ6IEpRdWVyeSkge1xyXG4gIGlzRXhwYW5kZWQgPSAhaXNFeHBhbmRlZDtcclxuICBpZiAoaXNFeHBhbmRlZCkge1xyXG4gICAgLy8g5bGV5byAXHJcbiAgICAkc3RhdHVzQmFyLmNzcyhleHBhbmRlZFN0eWxlKTtcclxuICAgICRzdGF0dXNCYXIuZmluZCgnc3BhbicpLmhpZGUoKTtcclxuICAgICRjb250ZW50LnNob3coKTtcclxuICAgIC8vIOiwg+eUqOa4suafk+WHveaVsO+8jOS7peehruS/neaYvuekuueahOaYr+acgOaWsOeahOaVsOaNruOAglxyXG4gICAgLy8g6L+Z5piv5bu26L+f5riy5p+T5py65Yi255qE5LiA6YOo5YiG77yM55So5LqO6Kej5Yaz5Zyo6ZqQ6JeP5YWD57Sg5LiK5pu05pawIEhUTUwg5Y+v6IO95a+86Ie05YaF5a655LiN5YWo55qE6Zeu6aKY44CCXHJcbiAgICByZW5kZXJTdGF0dXNCYXJDb250ZW50KCRjb250ZW50KTtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8g5pS257ypXHJcbiAgICAkc3RhdHVzQmFyLmNzcyhjb2xsYXBzZWRTdHlsZSk7XHJcbiAgICAkc3RhdHVzQmFyLmZpbmQoJ3NwYW4nKS5zaG93KCk7XHJcbiAgICAkY29udGVudC5oaWRlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVTdGF0dXNCYXIoKSB7XHJcbiAgaWYgKCQoYCMke3N0YXR1c0JhcklkfWApLmxlbmd0aCA+IDApIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0ICRzdGF0dXNCYXIgPSAkKCc8ZGl2PicpXHJcbiAgICAuYXR0cignaWQnLCBzdGF0dXNCYXJJZClcclxuICAgIC5jc3Moe1xyXG4gICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcclxuICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAncmdiYSgwLCAwLCAwLCAwLjcpJyxcclxuICAgICAgY29sb3I6ICd3aGl0ZScsXHJcbiAgICAgICdmb250LXNpemUnOiAnMTRweCcsXHJcbiAgICAgICd6LWluZGV4JzogJzEwMDAwJyxcclxuICAgICAgJ2JvcmRlci10b3AnOiAnMXB4IHNvbGlkICM0NDQnLFxyXG4gICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuM3MgZWFzZS1pbi1vdXQnLFxyXG4gICAgICAuLi5jb2xsYXBzZWRTdHlsZSxcclxuICAgIH0pXHJcbiAgICAuaHRtbCgnPHNwYW4+RVJBPC9zcGFuPicpO1xyXG5cclxuICBjb25zdCAkY29udGVudCA9ICQoJzxkaXY+JykuY3NzKHtcclxuICAgIGRpc3BsYXk6ICdub25lJyxcclxuICAgICdvdmVyZmxvdy15JzogJ2F1dG8nLFxyXG4gICAgaGVpZ2h0OiAnMTAwJScsXHJcbiAgfSk7XHJcblxyXG4gICRzdGF0dXNCYXIuYXBwZW5kKCRjb250ZW50KTtcclxuICAkKCdib2R5JykuYXBwZW5kKCRzdGF0dXNCYXIpO1xyXG5cclxuICAkc3RhdHVzQmFyLmRyYWdnYWJsZSh7XHJcbiAgICBoYW5kbGU6IGAjJHtzdGF0dXNCYXJJZH1gLFxyXG4gICAgY29udGFpbm1lbnQ6ICd3aW5kb3cnLFxyXG4gIH0pO1xyXG5cclxuICAkc3RhdHVzQmFyLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAoJHN0YXR1c0Jhci5oYXNDbGFzcygndWktZHJhZ2dhYmxlLWRyYWdnaW5nJykpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdG9nZ2xlRXhwYW5kKCRzdGF0dXNCYXIsICRjb250ZW50KTtcclxuICAgIH0sIDUwKTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuICRzdGF0dXNCYXI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbW92ZVN0YXR1c0JhcigpIHtcclxuICAkKGAjJHtzdGF0dXNCYXJJZH1gKS5yZW1vdmUoKTtcclxufVxyXG5cclxuLy8g5a+85Ye65Yid5aeL5YyW5Ye95pWw77yM55SxIHVpL2luZGV4LnRzIOiwg+eUqFxyXG5leHBvcnQgZnVuY3Rpb24gaW5pdFN0YXR1c0JhcigpIHtcclxuICAkKCgpID0+IHtcclxuICAgIGNvbnN0ICRzdGF0dXNCYXIgPSBjcmVhdGVTdGF0dXNCYXIoKTtcclxuICAgIGlmICghJHN0YXR1c0JhcikgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0ICRjb250ZW50ID0gJHN0YXR1c0Jhci5maW5kKCdkaXYnKTtcclxuICAgIGluaXRTdGF0dXNCYXJDb250ZW50KCRjb250ZW50KTtcclxuICB9KTtcclxuXHJcbiAgJCh3aW5kb3cpLm9uKCdwYWdlaGlkZScsICgpID0+IHtcclxuICAgIHJlbW92ZVN0YXR1c0JhcigpO1xyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/components/statusBar/index.ts\n\n}");
  },
  "./src/ERA变量框架/ui/components/statusBarContent/index.ts": 
  /*!*************************************************************!*\
  !*** ./src/ERA变量框架/ui/components/statusBarContent/index.ts ***!
  \*************************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initStatusBarContent: () => (/* binding */ initStatusBarContent),\n/* harmony export */   renderStatusBarContent: () => (/* binding */ renderStatusBarContent)\n/* harmony export */ });\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n\nconst logger = new _utils_log__WEBPACK_IMPORTED_MODULE_0__.Logger('ui-components-statusBarContent');\nlet latestStatData = null; // 用于缓存最新的数据\nfunction jsonToHtml(data) {\n    // 如果数据不是对象（是字符串、数字、布尔值等），直接返回值\n    if (typeof data !== 'object' || data === null) {\n        return `<span style=\"color: #98fb98;\">${String(data)}</span>`;\n    }\n    // 如果是对象，则创建一个列表来展示其键值对\n    let listHtml = '<ul style=\"list-style-type: none; padding-left: 20px; margin: 0;\">';\n    for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n            const value = data[key];\n            listHtml += '<li>';\n            // 显示键\n            listHtml += `<strong style=\"color: #87ceeb;\">${key}:</strong> `;\n            // 递归调用以处理值\n            listHtml += jsonToHtml(value);\n            listHtml += '</li>';\n        }\n    }\n    listHtml += '</ul>';\n    return listHtml;\n}\n/**\n * 使用缓存的最新数据渲染状态栏内容。\n * @param $contentContainer - 内容区的 JQuery 对象。\n */\nfunction renderStatusBarContent($contentContainer) {\n    if (latestStatData) {\n        const html = jsonToHtml(latestStatData);\n        $contentContainer.html(html);\n    }\n    else {\n        $contentContainer.html('数据加载中...');\n    }\n}\nfunction initStatusBarContent($contentContainer) {\n    renderStatusBarContent($contentContainer); // 初始渲染\n    // 监听事件，更新缓存，并仅在状态栏展开时渲染\n    eventOn('era:writeDone', detail => {\n        // 核心问题：直接在隐藏的 DOM 元素（display: none）上执行复杂的 .html() 更新，\n        // 可能会因浏览器的渲染优化或怪癖导致内容显示不全。\n        //\n        // 解决方案：采用延迟渲染机制。\n        // 1. 数据到达时，不直接渲染 DOM，而是先存入 `latestStatData` 缓存。\n        // 2. 仅当内容容器可见时（即状态栏是展开的），才立即从缓存渲染。\n        // 3. 当状态栏从折叠态展开时，由 statusBar 组件负责调用 renderStatusBarContent 来确保渲染。\n        logger.debug('initStatusBarContent', '接收到 era:writeDone 事件，缓存数据。', detail);\n        if (detail && detail.statWithoutMeta) {\n            latestStatData = detail.statWithoutMeta;\n            // 如果状态栏当前是展开的，则立即更新\n            if ($contentContainer.is(':visible')) {\n                renderStatusBarContent($contentContainer);\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2NvbXBvbmVudHMvc3RhdHVzQmFyQ29udGVudC9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEM7QUFFNUMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4Q0FBTSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDNUQsSUFBSSxjQUFjLEdBQVEsSUFBSSxDQUFDLENBQUMsWUFBWTtBQUU1QyxTQUFTLFVBQVUsQ0FBQyxJQUFTO0lBQzNCLCtCQUErQjtJQUMvQixJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDOUMsT0FBTyxpQ0FBaUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDaEUsQ0FBQztJQUVELHVCQUF1QjtJQUN2QixJQUFJLFFBQVEsR0FBRyxvRUFBb0UsQ0FBQztJQUNwRixLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN4QixRQUFRLElBQUksTUFBTSxDQUFDO1lBQ25CLE1BQU07WUFDTixRQUFRLElBQUksbUNBQW1DLEdBQUcsYUFBYSxDQUFDO1lBQ2hFLFdBQVc7WUFDWCxRQUFRLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLFFBQVEsSUFBSSxPQUFPLENBQUM7UUFDdEIsQ0FBQztJQUNILENBQUM7SUFDRCxRQUFRLElBQUksT0FBTyxDQUFDO0lBQ3BCLE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFFRDs7O0dBR0c7QUFDSSxTQUFTLHNCQUFzQixDQUFDLGlCQUF5QjtJQUM5RCxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ25CLE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN4QyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztTQUFNLENBQUM7UUFDTixpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDckMsQ0FBQztBQUNILENBQUM7QUFFTSxTQUFTLG9CQUFvQixDQUFDLGlCQUF5QjtJQUM1RCxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsT0FBTztJQUVsRCx3QkFBd0I7SUFDeEIsT0FBTyxDQUFDLGVBQWUsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNoQyxzREFBc0Q7UUFDdEQsMkJBQTJCO1FBQzNCLEVBQUU7UUFDRixpQkFBaUI7UUFDakIsZ0RBQWdEO1FBQ2hELG1DQUFtQztRQUNuQyxrRUFBa0U7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSw0QkFBNEIsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMzRSxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDckMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUM7WUFDeEMsb0JBQW9CO1lBQ3BCLElBQUksaUJBQWlCLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDNUMsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91aS9jb21wb25lbnRzL3N0YXR1c0JhckNvbnRlbnQvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbG9nJztcclxuXHJcbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3VpLWNvbXBvbmVudHMtc3RhdHVzQmFyQ29udGVudCcpO1xyXG5sZXQgbGF0ZXN0U3RhdERhdGE6IGFueSA9IG51bGw7IC8vIOeUqOS6jue8k+WtmOacgOaWsOeahOaVsOaNrlxyXG5cclxuZnVuY3Rpb24ganNvblRvSHRtbChkYXRhOiBhbnkpOiBzdHJpbmcge1xyXG4gIC8vIOWmguaenOaVsOaNruS4jeaYr+Wvueixoe+8iOaYr+Wtl+espuS4suOAgeaVsOWtl+OAgeW4g+WwlOWAvOetie+8ie+8jOebtOaOpei/lOWbnuWAvFxyXG4gIGlmICh0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcgfHwgZGF0YSA9PT0gbnVsbCkge1xyXG4gICAgcmV0dXJuIGA8c3BhbiBzdHlsZT1cImNvbG9yOiAjOThmYjk4O1wiPiR7U3RyaW5nKGRhdGEpfTwvc3Bhbj5gO1xyXG4gIH1cclxuXHJcbiAgLy8g5aaC5p6c5piv5a+56LGh77yM5YiZ5Yib5bu65LiA5Liq5YiX6KGo5p2l5bGV56S65YW26ZSu5YC85a+5XHJcbiAgbGV0IGxpc3RIdG1sID0gJzx1bCBzdHlsZT1cImxpc3Qtc3R5bGUtdHlwZTogbm9uZTsgcGFkZGluZy1sZWZ0OiAyMHB4OyBtYXJnaW46IDA7XCI+JztcclxuICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XHJcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2tleV07XHJcbiAgICAgIGxpc3RIdG1sICs9ICc8bGk+JztcclxuICAgICAgLy8g5pi+56S66ZSuXHJcbiAgICAgIGxpc3RIdG1sICs9IGA8c3Ryb25nIHN0eWxlPVwiY29sb3I6ICM4N2NlZWI7XCI+JHtrZXl9Ojwvc3Ryb25nPiBgO1xyXG4gICAgICAvLyDpgJLlvZLosIPnlKjku6XlpITnkIblgLxcclxuICAgICAgbGlzdEh0bWwgKz0ganNvblRvSHRtbCh2YWx1ZSk7XHJcbiAgICAgIGxpc3RIdG1sICs9ICc8L2xpPic7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGxpc3RIdG1sICs9ICc8L3VsPic7XHJcbiAgcmV0dXJuIGxpc3RIdG1sO1xyXG59XHJcblxyXG4vKipcclxuICog5L2/55So57yT5a2Y55qE5pyA5paw5pWw5o2u5riy5p+T54q25oCB5qCP5YaF5a6544CCXHJcbiAqIEBwYXJhbSAkY29udGVudENvbnRhaW5lciAtIOWGheWuueWMuueahCBKUXVlcnkg5a+56LGh44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyU3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcjogSlF1ZXJ5KSB7XHJcbiAgaWYgKGxhdGVzdFN0YXREYXRhKSB7XHJcbiAgICBjb25zdCBodG1sID0ganNvblRvSHRtbChsYXRlc3RTdGF0RGF0YSk7XHJcbiAgICAkY29udGVudENvbnRhaW5lci5odG1sKGh0bWwpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAkY29udGVudENvbnRhaW5lci5odG1sKCfmlbDmja7liqDovb3kuK0uLi4nKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0U3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcjogSlF1ZXJ5KSB7XHJcbiAgcmVuZGVyU3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcik7IC8vIOWIneWni+a4suafk1xyXG5cclxuICAvLyDnm5HlkKzkuovku7bvvIzmm7TmlrDnvJPlrZjvvIzlubbku4XlnKjnirbmgIHmoI/lsZXlvIDml7bmuLLmn5NcclxuICBldmVudE9uKCdlcmE6d3JpdGVEb25lJywgZGV0YWlsID0+IHtcclxuICAgIC8vIOaguOW/g+mXrumimO+8muebtOaOpeWcqOmakOiXj+eahCBET00g5YWD57Sg77yIZGlzcGxheTogbm9uZe+8ieS4iuaJp+ihjOWkjeadgueahCAuaHRtbCgpIOabtOaWsO+8jFxyXG4gICAgLy8g5Y+v6IO95Lya5Zug5rWP6KeI5Zmo55qE5riy5p+T5LyY5YyW5oiW5oCq55mW5a+86Ie05YaF5a655pi+56S65LiN5YWo44CCXHJcbiAgICAvL1xyXG4gICAgLy8g6Kej5Yaz5pa55qGI77ya6YeH55So5bu26L+f5riy5p+T5py65Yi244CCXHJcbiAgICAvLyAxLiDmlbDmja7liLDovr7ml7bvvIzkuI3nm7TmjqXmuLLmn5MgRE9N77yM6ICM5piv5YWI5a2Y5YWlIGBsYXRlc3RTdGF0RGF0YWAg57yT5a2Y44CCXHJcbiAgICAvLyAyLiDku4XlvZPlhoXlrrnlrrnlmajlj6/op4Hml7bvvIjljbPnirbmgIHmoI/mmK/lsZXlvIDnmoTvvInvvIzmiY3nq4vljbPku47nvJPlrZjmuLLmn5PjgIJcclxuICAgIC8vIDMuIOW9k+eKtuaAgeagj+S7juaKmOWPoOaAgeWxleW8gOaXtu+8jOeUsSBzdGF0dXNCYXIg57uE5Lu26LSf6LSj6LCD55SoIHJlbmRlclN0YXR1c0JhckNvbnRlbnQg5p2l56Gu5L+d5riy5p+T44CCXHJcbiAgICBsb2dnZXIuZGVidWcoJ2luaXRTdGF0dXNCYXJDb250ZW50JywgJ+aOpeaUtuWIsCBlcmE6d3JpdGVEb25lIOS6i+S7tu+8jOe8k+WtmOaVsOaNruOAgicsIGRldGFpbCk7XHJcbiAgICBpZiAoZGV0YWlsICYmIGRldGFpbC5zdGF0V2l0aG91dE1ldGEpIHtcclxuICAgICAgbGF0ZXN0U3RhdERhdGEgPSBkZXRhaWwuc3RhdFdpdGhvdXRNZXRhO1xyXG4gICAgICAvLyDlpoLmnpznirbmgIHmoI/lvZPliY3mmK/lsZXlvIDnmoTvvIzliJnnq4vljbPmm7TmlrBcclxuICAgICAgaWYgKCRjb250ZW50Q29udGFpbmVyLmlzKCc6dmlzaWJsZScpKSB7XHJcbiAgICAgICAgcmVuZGVyU3RhdHVzQmFyQ29udGVudCgkY29udGVudENvbnRhaW5lcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/components/statusBarContent/index.ts\n\n}");
  },
  "./src/ERA变量框架/ui/index.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/ui/index.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _components_statusBar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/statusBar */ "./src/ERA变量框架/ui/components/statusBar/index.ts");\n/**\n * @file UI 主入口\n * @description\n * 该文件负责统一加载和初始化所有 UI 组件。\n * 它导入各个组件的初始化函数，并依次执行。\n */\n\n// 在这里可以继续添加其他 UI 组件的初始化函数\nfunction initUI() {\n    (0,_components_statusBar__WEBPACK_IMPORTED_MODULE_0__.initStatusBar)();\n    // 以后可以添加例如 initControlPanel(), initCharacterSheet() 等\n}\n// 执行所有 UI 初始化\ninitUI();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7O0dBS0c7QUFFb0Q7QUFFdkQsMEJBQTBCO0FBQzFCLFNBQVMsTUFBTTtJQUNiLG9FQUFhLEVBQUUsQ0FBQztJQUNoQixzREFBc0Q7QUFDeEQsQ0FBQztBQUVELGNBQWM7QUFDZCxNQUFNLEVBQUUsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSBVSSDkuLvlhaXlj6NcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIOivpeaWh+S7tui0n+i0o+e7n+S4gOWKoOi9veWSjOWIneWni+WMluaJgOaciSBVSSDnu4Tku7bjgIJcclxuICog5a6D5a+85YWl5ZCE5Liq57uE5Lu255qE5Yid5aeL5YyW5Ye95pWw77yM5bm25L6d5qyh5omn6KGM44CCXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgaW5pdFN0YXR1c0JhciB9IGZyb20gJy4vY29tcG9uZW50cy9zdGF0dXNCYXInO1xyXG5cclxuLy8g5Zyo6L+Z6YeM5Y+v5Lul57un57ut5re75Yqg5YW25LuWIFVJIOe7hOS7tueahOWIneWni+WMluWHveaVsFxyXG5mdW5jdGlvbiBpbml0VUkoKSB7XHJcbiAgaW5pdFN0YXR1c0JhcigpO1xyXG4gIC8vIOS7peWQjuWPr+S7pea3u+WKoOS+i+WmgiBpbml0Q29udHJvbFBhbmVsKCksIGluaXRDaGFyYWN0ZXJTaGVldCgpIOetiVxyXG59XHJcblxyXG4vLyDmiafooYzmiYDmnIkgVUkg5Yid5aeL5YyWXHJcbmluaXRVSSgpO1xyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/index.ts\n\n}');
  },
  "./src/ERA变量框架/ui/parser/analyzer.ts": 
  /*!*******************************************!*\
  !*** ./src/ERA变量框架/ui/parser/analyzer.ts ***!
  \*******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyzeMessageUI: () => (/* binding */ analyzeMessageUI)\n/* harmony export */ });\n/**\n * 分析指定消息div的UI状态，并返回其状态和所有功能按钮。\n * @param messageDiv 消息的jQuery对象，例如 $(`div.mes[mesid=\"...\"]`)。\n * @returns 一个包含当前状态和按钮集合的对象。\n */\nfunction analyzeMessageUI(messageDiv) {\n    if (!messageDiv || messageDiv.length === 0) {\n        throw new Error('传入的消息div无效。');\n    }\n    const isEditing = messageDiv.find('.mes_edit_buttons').is(':visible');\n    const state = isEditing ? 'editing' : 'display';\n    const buttons = {\n        // 常规按钮\n        translate: messageDiv.find('.mes_button.mes_translate'),\n        generateImage: messageDiv.find('.mes_button.sd_message_gen'),\n        narrate: messageDiv.find('.mes_button.mes_narrate'),\n        prompt: messageDiv.find('.mes_button.mes_prompt'),\n        exclude: messageDiv.find('.mes_button.mes_hide'),\n        include: messageDiv.find('.mes_button.mes_unhide'),\n        embed: messageDiv.find('.mes_button.mes_embed'),\n        createCheckpoint: messageDiv.find('.mes_button.mes_create_bookmark'),\n        createBranch: messageDiv.find('.mes_button.mes_create_branch'),\n        copy: messageDiv.find('.mes_button.mes_copy'),\n        edit: messageDiv.find('.mes_button.mes_edit'),\n        // 编辑模式下的按钮\n        confirmEdit: messageDiv.find('.mes_edit_done'),\n        copyInEdit: messageDiv.find('.mes_edit_copy'),\n        delete: messageDiv.find('.mes_edit_delete'),\n        moveUp: messageDiv.find('.mes_edit_up'),\n        moveDown: messageDiv.find('.mes_edit_down'),\n        cancelEdit: messageDiv.find('.mes_edit_cancel'),\n    };\n    return {\n        state,\n        buttons,\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL3BhcnNlci9hbmFseXplci50cyIsIm1hcHBpbmdzIjoiOzs7O0FBaURBOzs7O0dBSUc7QUFDSSxTQUFTLGdCQUFnQixDQUFDLFVBQStCO0lBQzlELElBQUksQ0FBQyxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUMzQyxNQUFNLElBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3RFLE1BQU0sS0FBSyxHQUFtQixTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBRWhFLE1BQU0sT0FBTyxHQUFtQjtRQUM5QixPQUFPO1FBQ1AsU0FBUyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUM7UUFDdkQsYUFBYSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUM7UUFDNUQsT0FBTyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUM7UUFDbkQsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUM7UUFDakQsT0FBTyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUM7UUFDaEQsT0FBTyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUM7UUFDbEQsS0FBSyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUM7UUFDL0MsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQztRQUNwRSxZQUFZLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQztRQUM5RCxJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztRQUM3QyxJQUFJLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztRQUU3QyxXQUFXO1FBQ1gsV0FBVyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7UUFDOUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7UUFDN0MsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUM7UUFDM0MsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQ3ZDLFFBQVEsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1FBQzNDLFVBQVUsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDO0tBQ2hELENBQUM7SUFFRixPQUFPO1FBQ0wsS0FBSztRQUNMLE9BQU87S0FDUixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VpL3BhcnNlci9hbmFseXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGZpbGUgVUnop6PmnpDlmajvvIznlKjkuo7liIbmnpDlkozmk43kvZzphZLppoZVSeWFg+e0oOOAglxyXG4gKi9cclxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcclxuXHJcbi8qKlxyXG4gKiDooajnpLrmtojmga9VSeeahOW9k+WJjeeKtuaAgeOAglxyXG4gKiAtICdkaXNwbGF5Jzog5bi46KeE5pi+56S65qih5byPXHJcbiAqIC0gJ2VkaXRpbmcnOiDnvJbovpHmqKHlvI9cclxuICovXHJcbmV4cG9ydCB0eXBlIE1lc3NhZ2VVSVN0YXRlID0gJ2Rpc3BsYXknIHwgJ2VkaXRpbmcnO1xyXG5cclxuLyoqXHJcbiAqIOWMheWQq+S7jua2iOaBr1VJ5Lit5o+Q5Y+W55qE5ZCE56eN5Yqf6IO95oyJ6ZKu55qEalF1ZXJ55a+56LGh44CCXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VCdXR0b25zIHtcclxuICAvLyDluLjop4TmjInpkq5cclxuICB0cmFuc2xhdGU/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIGdlbmVyYXRlSW1hZ2U/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIG5hcnJhdGU/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIHByb21wdD86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgZXhjbHVkZT86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgaW5jbHVkZT86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgZW1iZWQ/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIGNyZWF0ZUNoZWNrcG9pbnQ/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIGNyZWF0ZUJyYW5jaD86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgY29weT86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgZWRpdD86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gIC8vIOe8lui+keaooeW8j+S4i+eahOaMiemSrlxyXG4gIGNvbmZpcm1FZGl0PzogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICBjb3B5SW5FZGl0PzogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICBkZWxldGU/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIG1vdmVVcD86IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgbW92ZURvd24/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gIGNhbmNlbEVkaXQ/OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAvLyDlhbbku5ZcclxuICBba2V5OiBzdHJpbmddOiBKUXVlcnk8SFRNTEVsZW1lbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vKipcclxuICog5YyF5ZCr5raI5oGvVUnnirbmgIHlkozmiYDmnInlj6/nlKjmjInpkq7nmoTlr7nosaHjgIJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZVVJQW5hbHlzaXMge1xyXG4gIHN0YXRlOiBNZXNzYWdlVUlTdGF0ZTtcclxuICBidXR0b25zOiBNZXNzYWdlQnV0dG9ucztcclxufVxyXG5cclxuLyoqXHJcbiAqIOWIhuaekOaMh+Wumua2iOaBr2RpdueahFVJ54q25oCB77yM5bm26L+U5Zue5YW254q25oCB5ZKM5omA5pyJ5Yqf6IO95oyJ6ZKu44CCXHJcbiAqIEBwYXJhbSBtZXNzYWdlRGl2IOa2iOaBr+eahGpRdWVyeeWvueixoe+8jOS+i+WmgiAkKGBkaXYubWVzW21lc2lkPVwiLi4uXCJdYCnjgIJcclxuICogQHJldHVybnMg5LiA5Liq5YyF5ZCr5b2T5YmN54q25oCB5ZKM5oyJ6ZKu6ZuG5ZCI55qE5a+56LGh44CCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZU1lc3NhZ2VVSShtZXNzYWdlRGl2OiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogTWVzc2FnZVVJQW5hbHlzaXMge1xyXG4gIGlmICghbWVzc2FnZURpdiB8fCBtZXNzYWdlRGl2Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCfkvKDlhaXnmoTmtojmga9kaXbml6DmlYjjgIInKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGlzRWRpdGluZyA9IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19lZGl0X2J1dHRvbnMnKS5pcygnOnZpc2libGUnKTtcclxuICBjb25zdCBzdGF0ZTogTWVzc2FnZVVJU3RhdGUgPSBpc0VkaXRpbmcgPyAnZWRpdGluZycgOiAnZGlzcGxheSc7XHJcblxyXG4gIGNvbnN0IGJ1dHRvbnM6IE1lc3NhZ2VCdXR0b25zID0ge1xyXG4gICAgLy8g5bi46KeE5oyJ6ZKuXHJcbiAgICB0cmFuc2xhdGU6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19idXR0b24ubWVzX3RyYW5zbGF0ZScpLFxyXG4gICAgZ2VuZXJhdGVJbWFnZTogbWVzc2FnZURpdi5maW5kKCcubWVzX2J1dHRvbi5zZF9tZXNzYWdlX2dlbicpLFxyXG4gICAgbmFycmF0ZTogbWVzc2FnZURpdi5maW5kKCcubWVzX2J1dHRvbi5tZXNfbmFycmF0ZScpLFxyXG4gICAgcHJvbXB0OiBtZXNzYWdlRGl2LmZpbmQoJy5tZXNfYnV0dG9uLm1lc19wcm9tcHQnKSxcclxuICAgIGV4Y2x1ZGU6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19idXR0b24ubWVzX2hpZGUnKSxcclxuICAgIGluY2x1ZGU6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19idXR0b24ubWVzX3VuaGlkZScpLFxyXG4gICAgZW1iZWQ6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19idXR0b24ubWVzX2VtYmVkJyksXHJcbiAgICBjcmVhdGVDaGVja3BvaW50OiBtZXNzYWdlRGl2LmZpbmQoJy5tZXNfYnV0dG9uLm1lc19jcmVhdGVfYm9va21hcmsnKSxcclxuICAgIGNyZWF0ZUJyYW5jaDogbWVzc2FnZURpdi5maW5kKCcubWVzX2J1dHRvbi5tZXNfY3JlYXRlX2JyYW5jaCcpLFxyXG4gICAgY29weTogbWVzc2FnZURpdi5maW5kKCcubWVzX2J1dHRvbi5tZXNfY29weScpLFxyXG4gICAgZWRpdDogbWVzc2FnZURpdi5maW5kKCcubWVzX2J1dHRvbi5tZXNfZWRpdCcpLFxyXG5cclxuICAgIC8vIOe8lui+keaooeW8j+S4i+eahOaMiemSrlxyXG4gICAgY29uZmlybUVkaXQ6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19lZGl0X2RvbmUnKSxcclxuICAgIGNvcHlJbkVkaXQ6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19lZGl0X2NvcHknKSxcclxuICAgIGRlbGV0ZTogbWVzc2FnZURpdi5maW5kKCcubWVzX2VkaXRfZGVsZXRlJyksXHJcbiAgICBtb3ZlVXA6IG1lc3NhZ2VEaXYuZmluZCgnLm1lc19lZGl0X3VwJyksXHJcbiAgICBtb3ZlRG93bjogbWVzc2FnZURpdi5maW5kKCcubWVzX2VkaXRfZG93bicpLFxyXG4gICAgY2FuY2VsRWRpdDogbWVzc2FnZURpdi5maW5kKCcubWVzX2VkaXRfY2FuY2VsJyksXHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXRlLFxyXG4gICAgYnV0dG9ucyxcclxuICB9O1xyXG59XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/parser/analyzer.ts\n\n}");
  },
  "./src/ERA变量框架/ui/patch.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/ui/patch.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceRenderRecentMessages: () => (/* binding */ forceRenderRecentMessages)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _parser_analyzer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./parser/analyzer */ \"./src/ERA变量框架/ui/parser/analyzer.ts\");\n/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换。\n */\n\n\n\nconst log = new _utils_log__WEBPACK_IMPORTED_MODULE_1__.Logger('ui-patch');\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\nfunction forceRenderMessage(messageId) {\n    return new Promise(resolve => {\n        const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n        const $message = $(messageSelector);\n        if ($message.length === 0) {\n            log.warn('forceRenderMessage', `找不到消息ID为 ${messageId} 的div。`);\n            return resolve();\n        }\n        const { state, buttons } = (0,_parser_analyzer__WEBPACK_IMPORTED_MODULE_2__.analyzeMessageUI)($message);\n        if (state === 'editing') {\n            // 如果已经是编辑状态，直接点击取消\n            buttons.cancelEdit?.trigger('click');\n            log.debug('forceRenderMessage', `消息 ${messageId} 处于编辑状态，已点击取消。`);\n            setTimeout(resolve, 50);\n        }\n        else {\n            // 如果是常规状态，先点击编辑，再点击取消\n            buttons.edit?.trigger('click');\n            log.debug('forceRenderMessage', `消息 ${messageId} 处于常规状态，已点击编辑。`);\n            setTimeout(() => {\n                // 重新分析以获取新状态下的按钮\n                const { buttons: updatedButtons } = (0,_parser_analyzer__WEBPACK_IMPORTED_MODULE_2__.analyzeMessageUI)($message);\n                updatedButtons.cancelEdit?.trigger('click');\n                log.debug('forceRenderMessage', `消息 ${messageId} 已点击取消。`);\n                resolve();\n            }, 50);\n        }\n    });\n}\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nasync function forceRenderRecentMessages() {\n    const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n    // 检查是否启用了强制重载功能\n    const forceReload = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载功能', false);\n    if (!forceReload) {\n        log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n        return; // 如果未启用，则不执行任何操作\n    }\n    // 获取要重载的消息数量，默认为1\n    const messageCount = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载消息数', 1);\n    log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n    // 等待一小段时间, 确保变量更新已经完成\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const allMessages = getChatMessages('0-{{lastMessageId}}');\n    if (!allMessages || allMessages.length === 0) {\n        log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n        return;\n    }\n    // 根据脚本变量设置的数量来截取最近的消息\n    const recentMessages = allMessages.slice(-messageCount);\n    for (const message of recentMessages) {\n        log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n        await forceRenderMessage(message.message_id);\n        // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMzRCxJQUFJLENBQUMsV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDN0MsR0FBRyxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQzFELE9BQU87SUFDVCxDQUFDO0lBRUQsc0JBQXNCO0lBQ3RCLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUV4RCxLQUFLLE1BQU0sT0FBTyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsYUFBYSxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM3Qyw2QkFBNkI7UUFDN0IsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsR0FBRyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsRCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdWkvcGF0Y2gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBmaWxlIOW8uuWItuWuj+a4suafk+aooeWdl1xyXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5qih5ouf55So5oi3VUnmk43kvZwsIOW8uuWItumFkummhumHjeaWsOa4suafk+a2iOaBrywg5Lul6Kem5Y+R5a6M5pW055qE5a6P5pu/5o2i44CCXHJcbiAqL1xyXG5cclxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcclxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nJztcclxuaW1wb3J0IHsgYW5hbHl6ZU1lc3NhZ2VVSSB9IGZyb20gJy4vcGFyc2VyL2FuYWx5emVyJztcclxuXHJcbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ3VpLXBhdGNoJyk7XHJcblxyXG4vKipcclxuICog5by65Yi26YeN5paw5riy5p+T5Y2V5p2h5raI5oGv44CCXHJcbiAqIEBwYXJhbSBtZXNzYWdlSWQg6KaB5by65Yi25riy5p+T55qE5raI5oGvSUTjgIJcclxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaooeaLn+eCueWHu+WujOaIkOWQjiByZXNvbHZl44CCXHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JjZVJlbmRlck1lc3NhZ2UobWVzc2FnZUlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcclxuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICBjb25zdCBtZXNzYWdlU2VsZWN0b3IgPSBgZGl2Lm1lc1ttZXNpZD1cIiR7bWVzc2FnZUlkfVwiXWA7XHJcbiAgICBjb25zdCAkbWVzc2FnZSA9ICQobWVzc2FnZVNlbGVjdG9yKTtcclxuXHJcbiAgICBpZiAoJG1lc3NhZ2UubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGxvZy53YXJuKCdmb3JjZVJlbmRlck1lc3NhZ2UnLCBg5om+5LiN5Yiw5raI5oGvSUTkuLogJHttZXNzYWdlSWR9IOeahGRpduOAgmApO1xyXG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgc3RhdGUsIGJ1dHRvbnMgfSA9IGFuYWx5emVNZXNzYWdlVUkoJG1lc3NhZ2UpO1xyXG5cclxuICAgIGlmIChzdGF0ZSA9PT0gJ2VkaXRpbmcnKSB7XHJcbiAgICAgIC8vIOWmguaenOW3sue7j+aYr+e8lui+keeKtuaAge+8jOebtOaOpeeCueWHu+WPlua2iFxyXG4gICAgICBidXR0b25zLmNhbmNlbEVkaXQ/LnRyaWdnZXIoJ2NsaWNrJyk7XHJcbiAgICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJNZXNzYWdlJywgYOa2iOaBryAke21lc3NhZ2VJZH0g5aSE5LqO57yW6L6R54q25oCB77yM5bey54K55Ye75Y+W5raI44CCYCk7XHJcbiAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgNTApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5aaC5p6c5piv5bi46KeE54q25oCB77yM5YWI54K55Ye757yW6L6R77yM5YaN54K55Ye75Y+W5raIXHJcbiAgICAgIGJ1dHRvbnMuZWRpdD8udHJpZ2dlcignY2xpY2snKTtcclxuICAgICAgbG9nLmRlYnVnKCdmb3JjZVJlbmRlck1lc3NhZ2UnLCBg5raI5oGvICR7bWVzc2FnZUlkfSDlpITkuo7luLjop4TnirbmgIHvvIzlt7Lngrnlh7vnvJbovpHjgIJgKTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgLy8g6YeN5paw5YiG5p6Q5Lul6I635Y+W5paw54q25oCB5LiL55qE5oyJ6ZKuXHJcbiAgICAgICAgY29uc3QgeyBidXR0b25zOiB1cGRhdGVkQnV0dG9ucyB9ID0gYW5hbHl6ZU1lc3NhZ2VVSSgkbWVzc2FnZSk7XHJcbiAgICAgICAgdXBkYXRlZEJ1dHRvbnMuY2FuY2VsRWRpdD8udHJpZ2dlcignY2xpY2snKTtcclxuICAgICAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyTWVzc2FnZScsIGDmtojmga8gJHttZXNzYWdlSWR9IOW3sueCueWHu+WPlua2iOOAgmApO1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSwgNTApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICog5by65Yi26YeN5paw5riy5p+T5pyA6L+R55qETuadoea2iOaBrywg5Lul56Gu5L+d5a6P6KKr5q2j56Gu5pu/5o2i44CCXHJcbiAqIOaYr+WQpuaJp+ihjOS7peWPiua4suafk+eahOaVsOmHj+eUseiEmuacrOWPmOmHj+aOp+WItuOAglxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKSB7XHJcbiAgY29uc3Qgc2NyaXB0VmFycyA9IGdldFZhcmlhYmxlcyh7IHR5cGU6ICdzY3JpcHQnLCBzY3JpcHRfaWQ6IGdldFNjcmlwdElkKCkgfSk7XHJcblxyXG4gIC8vIOajgOafpeaYr+WQpuWQr+eUqOS6huW8uuWItumHjei9veWKn+iDvVxyXG4gIGNvbnN0IGZvcmNlUmVsb2FkID0gXy5nZXQoc2NyaXB0VmFycywgJ+W8uuWItumHjei9veWKn+iDvScsIGZhbHNlKTtcclxuICBpZiAoIWZvcmNlUmVsb2FkKSB7XHJcbiAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295Yqf6IO95pyq5ZCv55SoLCDot7Pov4fjgIInKTtcclxuICAgIHJldHVybjsgLy8g5aaC5p6c5pyq5ZCv55So77yM5YiZ5LiN5omn6KGM5Lu75L2V5pON5L2cXHJcbiAgfVxyXG5cclxuICAvLyDojrflj5bopoHph43ovb3nmoTmtojmga/mlbDph4/vvIzpu5jorqTkuLoxXHJcbiAgY29uc3QgbWVzc2FnZUNvdW50ID0gXy5nZXQoc2NyaXB0VmFycywgJ+W8uuWItumHjei9vea2iOaBr+aVsCcsIDEpO1xyXG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCBg5byA5aeL5by65Yi26YeN6L29LCDmlbDph486ICR7bWVzc2FnZUNvdW50fWApO1xyXG5cclxuICAvLyDnrYnlvoXkuIDlsI/mrrXml7bpl7QsIOehruS/neWPmOmHj+abtOaWsOW3sue7j+WujOaIkFxyXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XHJcblxyXG4gIGNvbnN0IGFsbE1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19Jyk7XHJcbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcclxuICAgIGxvZy53YXJuKCdmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzJywgJ+aXoOazleiOt+WPluWIsOS7u+S9lea2iOaBrywg57uI5q2i6YeN6L2944CCJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICAvLyDmoLnmja7ohJrmnKzlj5jph4/orr7nva7nmoTmlbDph4/mnaXmiKrlj5bmnIDov5HnmoTmtojmga9cclxuICBjb25zdCByZWNlbnRNZXNzYWdlcyA9IGFsbE1lc3NhZ2VzLnNsaWNlKC1tZXNzYWdlQ291bnQpO1xyXG5cclxuICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgcmVjZW50TWVzc2FnZXMpIHtcclxuICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsIGDmraPlnKjlvLrliLbmuLLmn5Pmtojmga86ICR7bWVzc2FnZS5tZXNzYWdlX2lkfWApO1xyXG4gICAgYXdhaXQgZm9yY2VSZW5kZXJNZXNzYWdlKG1lc3NhZ2UubWVzc2FnZV9pZCk7XHJcbiAgICAvLyDlnKjmr4/mrKHmk43kvZzkuYvpl7Tnn63mmoLmmoLlgZwsIOmBv+WFjeaTjeS9nOi/h+W/q+WvvOiHtFVJ6Zeu6aKY44CCXHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XHJcbiAgfVxyXG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295a6M5oiQ44CCJyk7XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/ui/patch.ts\n\n}");
  },
  "./src/ERA变量框架/utils/constants.ts": 
  /*!****************************************!*\
  !*** ./src/ERA变量框架/utils/constants.ts ***!
  \****************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_SCOPE: () => (/* binding */ CHAT_SCOPE),\n/* harmony export */   ERA_API_EVENTS: () => (/* binding */ ERA_API_EVENTS),\n/* harmony export */   ERA_DATA_REGEX: () => (/* binding */ ERA_DATA_REGEX),\n/* harmony export */   ERA_DATA_TAG: () => (/* binding */ ERA_DATA_TAG),\n/* harmony export */   ERA_EVENT_EMITTER: () => (/* binding */ ERA_EVENT_EMITTER),\n/* harmony export */   LOGS_PATH: () => (/* binding */ LOGS_PATH),\n/* harmony export */   META_DATA_PATH: () => (/* binding */ META_DATA_PATH),\n/* harmony export */   SEL_PATH: () => (/* binding */ SEL_PATH),\n/* harmony export */   STAT_DATA_PATH: () => (/* binding */ STAT_DATA_PATH)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   "ERAMetaData": {\n *     "EditLogs": { ... },\n *     "SelectedMks": [ ... ]\n *   },\n *   "stat_data": {\n *     "player": { "hp": 100, "gold": 50 },\n *     "world_state": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nconst CHAT_SCOPE = { type: \'chat\' };\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nconst META_DATA_PATH = \'ERAMetaData\';\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nconst STAT_DATA_PATH = \'stat_data\';\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `"EditLogs"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * "era_mk_1759246942209_jipmrj": [\n *   { "op": "insert", "path": "testData.inventory", "value_new": { "gold": 100, "slots": ["sword", "shield"] } },\n *   { "op": "update", "path": "player.hp", "value_old": 90, "value_new": 100 }\n * ]\n */\nconst LOGS_PATH = \'EditLogs\';\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `"SelectedMks"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , "era_mk_greeting", "era_mk_abc123", , "era_mk_xyz789"]\n */\nconst SEL_PATH = \'SelectedMks\';\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nconst ERA_DATA_TAG = \'era_data\';\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nconst ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nconst ERA_API_EVENTS = {\n    INSERT_BY_OBJECT: \'era:insertByObject\',\n    UPDATE_BY_OBJECT: \'era:updateByObject\',\n    INSERT_BY_PATH: \'era:insertByPath\',\n    UPDATE_BY_PATH: \'era:updateByPath\',\n    DELETE_BY_OBJECT: \'era:deleteByObject\',\n    DELETE_BY_PATH: \'era:deleteByPath\',\n};\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nconst ERA_EVENT_EMITTER = {\n    /** 当变量写入完成时触发 */\n    WRITE_DONE: \'era:writeDone\',\n    /** 当API执行写入时触发 */\n    API_WRITE: \'era:apiWrite\',\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRCRztBQUVVO0FBRWI7Ozs7OztHQU1HO0FBQ0ksTUFBTSxVQUFVLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBZSxFQUFFLENBQUM7QUFFcEQ7OztHQUdHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDOzs7R0FHRztBQUNJLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQztBQUUxQzs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDO0FBRXBDOzs7Ozs7Ozs7OztHQVdHO0FBQ0ksTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDO0FBRXRDOzs7OztHQUtHO0FBQ0ksTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDO0FBRXZDOzs7OztHQUtHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxZQUFZLGVBQWUsWUFBWSxHQUFHLENBQUMsQ0FBQztBQUV6Rjs7Ozs7R0FLRztBQUNJLE1BQU0sY0FBYyxHQUFHO0lBQzVCLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyxjQUFjLEVBQUUsa0JBQWtCO0lBQ2xDLGdCQUFnQixFQUFFLG9CQUFvQjtJQUN0QyxjQUFjLEVBQUUsa0JBQWtCO0NBQzFCLENBQUM7QUFFWDs7O0dBR0c7QUFDSSxNQUFNLGlCQUFpQixHQUFHO0lBQy9CLGlCQUFpQjtJQUNqQixVQUFVLEVBQUUsZUFBZTtJQUMzQixrQkFBa0I7SUFDbEIsU0FBUyxFQUFFLGNBQWM7Q0FDakIsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmoLjlv4PluLjph4/mqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu26ZuG5Lit5a6a5LmJ5LqG5pW05LiqIEVSQSDmoYbmnrbmiYDkvb/nlKjnmoTlhbPplK7luLjph4/jgIJcbiAqIOi/meS6m+W4uOmHj+S4u+imgeeUqOS9nOWcqOmFkummhiBgY2hhdGAg5Y+Y6YeP5Lit5a2Y5YKo5ZKM5qOA57SiIEVSQSDmoLjlv4PmlbDmja7nmoTot6/lvoTvvIjplK7lkI3vvInjgIJcbiAqXG4gKiAqKuaguOW/g+aVsOaNrue7k+aehCoqOlxuICogRVJBIOeahOaVsOaNruiiq+WIhuS4uuS4pOmDqOWIhu+8jOWtmOWCqOWcqCBgY2hhdGAg5Y+Y6YeP5LiL77yaXG4gKiAxLiAqKuWFg+aVsOaNriAoRVJBTWV0YURhdGEpKio6IOWMheWQq+ahhuaetuiHqui6q+i/kOihjOaJgOmcgOeahOaguOW/g+aVsOaNru+8jOWmgiBgRWRpdExvZ3NgIOWSjCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAyLiAqKueKtuaAgeaVsOaNriAoc3RhdF9kYXRhKSoqOiDljIXlkKvmiYDmnInnlLHnlKjmiLflkowgQUkg566h55CG55qE5ri45oiPL+aVheS6i+WPmOmHj++8jOWmgiBgcGxheWVyYOOAgWB3b3JsZF9zdGF0ZWAg562J44CCXG4gKlxuICog5YW257uT5p6E5aSn6Ie05aaC5LiL77yaXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgIFwiRVJBTWV0YURhdGFcIjoge1xuICogICAgIFwiRWRpdExvZ3NcIjogeyAuLi4gfSxcbiAqICAgICBcIlNlbGVjdGVkTWtzXCI6IFsgLi4uIF1cbiAqICAgfSxcbiAqICAgXCJzdGF0X2RhdGFcIjoge1xuICogICAgIFwicGxheWVyXCI6IHsgXCJocFwiOiAxMDAsIFwiZ29sZFwiOiA1MCB9LFxuICogICAgIFwid29ybGRfc3RhdGVcIjogeyAuLi4gfVxuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqIOWwhui/meS6m+i3r+W+hOWumuS5ieS4uuW4uOmHj++8jOacieWKqeS6ju+8mlxuICogMS4gKirpgb/lhY3noaznvJbnoIEqKu+8muWHj+WwkeWboOaLvOWGmemUmeivr+WvvOiHtOeahCBidWfjgIJcbiAqIDIuICoq5o+Q6auY5Y+v57u05oqk5oCnKirvvJrlpoLmnpzmnKrmnaXpnIDopoHosIPmlbTmlbDmja7nu5PmnoTvvIzlj6rpnIDkv67mlLnmraTmlofku7bljbPlj6/jgIJcbiAqIDMuICoq5aKe5by65Luj56CB5Y+v6K+75oCnKirvvJrluLjph4/nmoTlkI3np7DmuIXmmbDlnLDooajovr7kuoblhbbmiYDmjIflkJHnmoTmlbDmja7nmoTlkKvkuYnjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IENIQVRfU0NPUEVcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO6YWS6aaG5Yqp5omLIGBnZXRWYXJpYWJsZXNgIOWSjCBgcmVwbGFjZVZhcmlhYmxlc2Ag57O75YiX5Ye95pWw55qEIGBzY29wZWAg5Y+C5pWw44CCXG4gKiDlroPmjIflrprkuobmk43kvZznmoTnm67moIfmmK/lvZPliY0qKuiBiuWkqe+8iENoYXTvvIkqKue6p+WIq+eahOWPmOmHj+OAglxuICogRVJBIOahhuaetueahOaJgOacieaguOW/g+aVsOaNruWSjOeUqOaIt+WPmOmHj+mDveWtmOWCqOWcqOatpOS9nOeUqOWfn+S4i+OAglxuICovXG5leHBvcnQgY29uc3QgQ0hBVF9TQ09QRSA9IHsgdHlwZTogJ2NoYXQnIGFzIGNvbnN0IH07XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IE1FVEFfREFUQV9QQVRIXG4gKiBAZGVzY3JpcHRpb24g5ZyoIGBjaGF0YCDlj5jph4/kuK3vvIzlrZjlgqggRVJBIOahhuaetioq5YWD5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IE1FVEFfREFUQV9QQVRIID0gJ0VSQU1ldGFEYXRhJztcblxuLyoqXG4gKiBAY29uc3RhbnQge3N0cmluZ30gU1RBVF9EQVRBX1BBVEhcbiAqIEBkZXNjcmlwdGlvbiDlnKggYGNoYXRgIOWPmOmHj+S4re+8jOWtmOWCqOeUqOaItyoq54q25oCB5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IFNUQVRfREFUQV9QQVRIID0gJ3N0YXRfZGF0YSc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IExPR1NfUEFUSFxuICogQGRlc2NyaXB0aW9uXG4gKiDlnKggYEVSQU1ldGFEYXRhYCDlr7nosaHkuK3vvIzlrZjlgqgqKue8lui+keaXpeW/l++8iEVkaXQgTG9nc++8iSoq55qE5a+56LGh55qE6ZSu5ZCN77yM5Y2zIGBcIkVkaXRMb2dzXCJg44CCXG4gKiBgRWRpdExvZ3NgIOaYr+S4gOS4quS7pSoq5raI5oGv5a+G6ZKl77yITUvvvIkqKuS4uumUru+8jOS7peivpea2iOaBr+W8leWPkeeahOWPmOmHj+WPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICog6L+Z5piv5a6e546w4oCc6YCG5bqP5Zue5rua4oCd5Yqf6IO955qE5Z+656GA5pWw5o2u44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIGNoYXQuRVJBTWV0YURhdGEuRWRpdExvZ3Mg55qE5LiA5Liq5p2h55uuXG4gKiBcImVyYV9ta18xNzU5MjQ2OTQyMjA5X2ppcG1yalwiOiBbXG4gKiAgIHsgXCJvcFwiOiBcImluc2VydFwiLCBcInBhdGhcIjogXCJ0ZXN0RGF0YS5pbnZlbnRvcnlcIiwgXCJ2YWx1ZV9uZXdcIjogeyBcImdvbGRcIjogMTAwLCBcInNsb3RzXCI6IFtcInN3b3JkXCIsIFwic2hpZWxkXCJdIH0gfSxcbiAqICAgeyBcIm9wXCI6IFwidXBkYXRlXCIsIFwicGF0aFwiOiBcInBsYXllci5ocFwiLCBcInZhbHVlX29sZFwiOiA5MCwgXCJ2YWx1ZV9uZXdcIjogMTAwIH1cbiAqIF1cbiAqL1xuZXhwb3J0IGNvbnN0IExPR1NfUEFUSCA9ICdFZGl0TG9ncyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IFNFTF9QQVRIXG4gKiBAZGVzY3JpcHRpb25cbiAqIOWcqCBgRVJBTWV0YURhdGFgIOWvueixoeS4re+8jOWtmOWCqCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+77yIU2VsZWN0ZWQgTWVzc2FnZSBLZXlz77yJKirnmoTmlbDnu4TnmoTplK7lkI3vvIzljbMgYFwiU2VsZWN0ZWRNa3NcImDjgIJcbiAqIGBTZWxlY3RlZE1rc2Ag5piv5LiA5Liq56iA55aP5pWw57uE77yM5YW2KirntKLlvJXnuqbnrYnkuo7mtojmga8gSUQqKu+8jOWAvOaYr+ivpealvOWxgua2iOaBr+eahCBNS+OAglxuICog6L+Z5Liq5pWw57uE5pivIEVSQSDmoYbmnrbnmoTigJzohIrmooHigJ3vvIzmmK/ov57mjqXmir3osaHlj5jph4/nirbmgIHkuI7lhbfkvZPogYrlpKnljoblj7LnmoTmoaXmooHjgIJcbiAqIOahhuaetumAmui/h+avlOWvuSBgU2VsZWN0ZWRNa3NgIOS4juWunumZhea2iOaBr+a1geS4reeahCBNS++8jOadpeWIpOaWreaVsOaNruaYr+WQpumcgOimgeWQjOatpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBjaGF0LkVSQU1ldGFEYXRhLlNlbGVjdGVkTWtzXG4gKiBbICwgXCJlcmFfbWtfZ3JlZXRpbmdcIiwgXCJlcmFfbWtfYWJjMTIzXCIsICwgXCJlcmFfbWtfeHl6Nzg5XCJdXG4gKi9cbmV4cG9ydCBjb25zdCBTRUxfUEFUSCA9ICdTZWxlY3RlZE1rcyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IEVSQV9EQVRBX1RBR1xuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7lnKjmtojmga/lhoXlrrnkuK3ljIXoo7kgRVJBIOWFg+aVsOaNru+8iOWmgua2iOaBr+WvhumSpSBNS++8ieeahCBYTUwg6aOO5qC85qCH562+5ZCN44CCXG4gKiBlLmcuLCBgPGVyYV9kYXRhPnsuLi59PC9lcmFfZGF0YT5gXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfREFUQV9UQUcgPSAnZXJhX2RhdGEnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7UmVnRXhwfSBFUkFfREFUQV9SRUdFWFxuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7ku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3ljLnphY3lkozmj5Dlj5YgYDxlcmFfZGF0YT5gIOWdl+eahOato+WImeihqOi+vuW8j+OAglxuICog6L+Z5Liq5bi46YeP6KKr5a6a5LmJ5Zyo6L+Z6YeM77yM5Lul6YG/5YWNIGBtZXNzYWdlX2tleS50c2Ag5ZKMIGBtZXNzYWdlX3V0aWxzLnRzYCDkuYvpl7TnmoTlvqrnjq/kvp3otZbjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEVSQV9EQVRBX1JFR0VYID0gbmV3IFJlZ0V4cChgPCR7RVJBX0RBVEFfVEFHfT4oey4qP30pPFxcXFwvJHtFUkFfREFUQV9UQUd9PmApO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfQVBJX0VWRU5UU1xuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobmiYDmnInkvpvlpJbpg6johJrmnKzpgJrov4cgYGV2ZW50RW1pdGAg6LCD55So55qE6Ieq5a6a5LmJIEFQSSDkuovku7blkI3np7DjgIJcbiAqIOS9v+eUqOi/meS6m+W4uOmHj+WPr+S7pemBv+WFjeWcqOS7o+eggeS4reS9v+eUqOehrOe8lueggeeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0FQSV9FVkVOVFMgPSB7XG4gIElOU0VSVF9CWV9PQkpFQ1Q6ICdlcmE6aW5zZXJ0QnlPYmplY3QnLFxuICBVUERBVEVfQllfT0JKRUNUOiAnZXJhOnVwZGF0ZUJ5T2JqZWN0JyxcbiAgSU5TRVJUX0JZX1BBVEg6ICdlcmE6aW5zZXJ0QnlQYXRoJyxcbiAgVVBEQVRFX0JZX1BBVEg6ICdlcmE6dXBkYXRlQnlQYXRoJyxcbiAgREVMRVRFX0JZX09CSkVDVDogJ2VyYTpkZWxldGVCeU9iamVjdCcsXG4gIERFTEVURV9CWV9QQVRIOiAnZXJhOmRlbGV0ZUJ5UGF0aCcsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfRVZFTlRfRU1JVFRFUlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOacieeUsSBFUkEg5qGG5p62KirlkJHlpJblj5Hlh7oqKueahOS6i+S7tuOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0VWRU5UX0VNSVRURVIgPSB7XG4gIC8qKiDlvZPlj5jph4/lhpnlhaXlrozmiJDml7bop6blj5EgKi9cbiAgV1JJVEVfRE9ORTogJ2VyYTp3cml0ZURvbmUnLFxuICAvKiog5b2TQVBJ5omn6KGM5YaZ5YWl5pe26Kem5Y+RICovXG4gIEFQSV9XUklURTogJ2VyYTphcGlXcml0ZScsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIGBlcmE6d3JpdGVEb25lYCDkuovku7bnmoTotJ/ovb3lr7nosaHnu5PmnoTjgILlroPmj5DkvpvkuoblhbPkuo7kuIDmrKHmiJDlip/lhpnlhaXmk43kvZznmoTlrozmlbTkuIrkuIvmlofjgIJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXcml0ZURvbmVQYXlsb2FkIHtcbiAgLyoqXG4gICAqIOacrOi9ruS6i+S7tuWkhOeQhuW+queOr+S4re+8jOacgOWQjuaTjeS9nOeahOa2iOaBr+eahCoq5raI5oGv5a+G6ZKlIChNZXNzYWdlIEtleSkqKuOAglxuICAgKiDpgJrluLjnlLEgYGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZWAg5Zyo5b6q546v5byA5aeL5pe256Gu5a6a44CCXG4gICAqL1xuICBtazogc3RyaW5nO1xuICAvKipcbiAgICog5pys6L2u5LqL5Lu25aSE55CG5b6q546v5Lit77yM5pyA5ZCO5pON5L2c55qE5raI5oGv55qEKirmtojmga8gSUQqKuOAglxuICAgKi9cbiAgbWVzc2FnZV9pZDogbnVtYmVyO1xuICAvKipcbiAgICog5o+P6L+w5Zyo5pys6L2u5LqL5Lu25aSE55CG5Lit77yM5omn6KGM5LqG5ZOq5Lqb5qC45b+D5pON5L2c44CCXG4gICAqIOi/meWvueS6juWklumDqOiEmuacrOeQhuino+eKtuaAgeWPmOabtOeahOWOn+WboOiHs+WFs+mHjeimgeOAglxuICAgKi9cbiAgYWN0aW9uczoge1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJvbGxiYWNrQnlNa2Ag5pON5L2cICovXG4gICAgcm9sbGJhY2s6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBgQXBwbHlWYXJDaGFuZ2VgIOaTjeS9nCAqL1xuICAgIGFwcGx5OiBib29sZWFuO1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDmk43kvZwgKi9cbiAgICByZXN5bmM6IGJvb2xlYW47XG4gICAgLyoqIOaYr+WQpuaJp+ihjOS6hiBBUEkg6LCD55SoICovXG4gICAgYXBpOiBib29sZWFuO1xuICAgIC8qKiDmmK/lkKbmmK/nlLFBUEnosIPnlKjop6blj5HnmoTlkI7nu63pgLvovpEgKi9cbiAgICBhcGlXcml0ZTogYm9vbGVhbjtcbiAgfTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzmlbTkuKrogYrlpKnkvJror53nmoQqKuW3sumAieaLqea2iOaBr+WvhumSpemTviAoU2VsZWN0ZWQgTWVzc2FnZSBLZXlzKSoqIOeahOacgOaWsOeKtuaAgeOAglxuICAgKiDov5nmmK/kuIDkuKrnqIDnlo/mlbDnu4TvvIzlhbbntKLlvJXnuqbnrYnkuo7mtojmga8gSUTvvIzlgLzmmK/lr7nlupTmpbzlsYLmtojmga/nmoQgTUvjgIJcbiAgICog5a6D5Luj6KGo5LqG5b2T5YmN6IGK5aSp6K6w5b2V55qE4oCc5Li75bmy4oCd77yM5pivIEVSQSDliKTmlq3lkIzmraXnirbmgIHnmoTmoLjlv4PmlbDmja7nu5PmnoTjgIJcbiAgICovXG4gIHNlbGVjdGVkTWtzOiAoc3RyaW5nIHwgbnVsbClbXTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIxgY2hhdGAg5Y+Y6YeP5Lit5a2Y5YKo55qEKirlrozmlbTnmoTnvJbovpHml6Xlv5flr7nosaEgKEVkaXRMb2dzKSoq44CCXG4gICAqIOi/meaYr+S4gOS4quS7pSBNSyDkuLrplK7vvIzku6Xlj5jmm7TorrDlvZXmlbDnu4TkuLrlgLznmoTlr7nosaHjgIJcbiAgICovXG4gIGVkaXRMb2dzOiB7IFtrZXk6IHN0cmluZ106IGFueVtdIH07XG4gIC8qKlxuICAgKiDkuovku7blpITnkIblrozmiJAqKuS5i+WQjioq77yM5pW05Liq6IGK5aSp5Lya6K+d55qEKirnirbmgIHmlbDmja4gKGBzdGF0X2RhdGFgKSoqIOeahOacgOaWsOeKtuaAgeOAglxuICAgKiDov5nkuKrniYjmnKwqKuWMheWQqyoq5omA5pyJ5YaF6YOo5L2/55So55qEIGAkbWV0YWAg5a2X5q6144CCXG4gICAqL1xuICBzdGF0OiBhbnk7XG4gIC8qKlxuICAgKiDkuovku7blpITnkIblrozmiJAqKuS5i+WQjioq77yM5LiA5LiqKirkuI3ljIXlkKsqKuS7u+S9lSBgJG1ldGFgIOWtl+auteeahCBgc3RhdF9kYXRhYCDnmoTmt7Hmi7fotJ3niYjmnKzjgIJcbiAgICog6YCC55So5LqO6ZyA6KaB57qv5YeA5pWw5o2u6L+b6KGM5bGV56S65oiW6L+b5LiA5q2l5aSE55CG55qE5Zy65pmv44CCXG4gICAqL1xuICBzdGF0V2l0aG91dE1ldGE6IGFueTtcbiAgLyoqXG4gICAqIOihqOekuui/meaYr+WvueW9k+WJjSBgbWtgIOeahOesrOWHoOasoei/nue7reWkhOeQhuOAglxuICAgKiDlpoLmnpzkuIDkuKrmlrDnmoQgYG1rYCDooqvlpITnkIbvvIzov5nkuKrorqHmlbDkvJrph43nva7kuLogMeOAglxuICAgKiDov5nlr7nkuo7pnIDopoHmhJ/nn6XnirbmgIHmmK/lkKblnKjlkIzkuIDmtojmga/kuIrov57nu63mm7TmlrDnmoTlpJbpg6johJrmnKzlvojmnInnlKjjgIJcbiAgICovXG4gIGNvbnNlY3V0aXZlUHJvY2Vzc2luZ0NvdW50OiBudW1iZXI7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/constants.ts\n\n}');
  },
  "./src/ERA变量框架/utils/data.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/data.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   J: () => (/* binding */ J),\n/* harmony export */   escapeEraData: () => (/* binding */ escapeEraData),\n/* harmony export */   isPO: () => (/* binding */ isPO),\n/* harmony export */   mergeReplaceArray: () => (/* binding */ mergeReplaceArray),\n/* harmony export */   parseEditLog: () => (/* binding */ parseEditLog),\n/* harmony export */   parseJsonl: () => (/* binding */ parseJsonl),\n/* harmony export */   sanitizeArrays: () => (/* binding */ sanitizeArrays),\n/* harmony export */   unescapeEraData: () => (/* binding */ unescapeEraData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/**\n * @file ERA 变量框架 - 通用数据处理模块\n */\n\n\n\nconst logger = new _log__WEBPACK_IMPORTED_MODULE_1__.Logger('utils-data');\nconst ESCAPE_MAP = {\n    '.': '__DOT__',\n    '\"': '__DQUOTE__',\n    \"'\": '__SQUOTE__',\n};\nconst UNESCAPE_MAP = lodash__WEBPACK_IMPORTED_MODULE_0___default().invert(ESCAPE_MAP);\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nfunction escapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => escapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n                newObj[escapedKey] = escapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(escapeRegex, match => ESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nfunction unescapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => unescapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n                newObj[unescapedKey] = unescapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nconst isPO = (v) => lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v);\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nfunction sanitizeArrays(v) {\n    if (Array.isArray(v)) {\n        // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n        return v.map(e => (Array.isArray(e) || lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(e) ? JSON.stringify(e) : e));\n    }\n    else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v)) {\n        // 如果是对象，则递归地对其每个属性值进行净化。\n        const o = {};\n        for (const k in v)\n            o[k] = sanitizeArrays(v[k]);\n        return o;\n    }\n    else {\n        // 其他类型的值直接返回。\n        return v;\n    }\n}\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nconst J = (o) => {\n    try {\n        return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n    }\n    catch (e) {\n        return `<<stringify失败: ${e?.message || e}>>`;\n    }\n};\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nfunction mergeReplaceArray(base, patch) {\n    // 使用 _.cloneDeep 确保不修改原始对象。\n    return lodash__WEBPACK_IMPORTED_MODULE_0___default().mergeWith(lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(base), lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(patch), (a, b) => {\n        // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n        if (Array.isArray(a) || Array.isArray(b))\n            return b;\n        // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n        return undefined;\n    });\n}\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nfunction parseEditLog(raw) {\n    if (Array.isArray(raw))\n        return raw;\n    if (raw && typeof raw === 'object')\n        return [raw]; // 单个对象也视为有效日志\n    if (typeof raw === 'string') {\n        const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n        try {\n            const arr = JSON.parse(s);\n            return Array.isArray(arr) ? arr : [];\n        }\n        catch {\n            return [];\n        }\n    }\n    return [];\n}\n/**\n * 智能地从字符串中移除各种风格的注释，同时保留字符串字面量中的内容。\n *\n * **工作原理**:\n * 该函数通过一个小型状态机来逐字解析输入字符串。它维护一个 `inString` 状态，\n * 用于判断当前字符是否位于一个双引号包裹的字符串内部。\n *\n * 1. 当检测到进入或退出一个字符串时（通过非转义的双引号 `\"`），`inString` 状态会翻转。\n * 2. 如果 `inString` 为 `true`，则所有字符都会被无条件地保留。这确保了字符串值（如 URL）中的 `//` 或 `/*` 不会被当作注释处理。\n * 3. 如果 `inString` 为 `false`，函数会检查是否存在注释标记（`//`, `/*`, `\x3c!--`）。\n * 4. 如果找到注释标记，函数会向前扫描直到注释结束，并跳过这部分内容。\n * 5. 如果没有找到注释，则将当前字符追加到结果中。\n *\n * @param str - 待处理的字符串。\n * @returns 移除了注释的字符串。\n */\nfunction stripComments(str) {\n    if (!str)\n        return '';\n    let result = '';\n    let inString = false; // 状态：是否在字符串内部\n    for (let i = 0; i < str.length; i++) {\n        const char = str[i];\n        // 检查是否进入或退出字符串。忽略转义的双引号 `\\\"`。\n        if (char === '\"' && (i === 0 || str[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，直接追加字符，不进行任何注释检查。\n        if (inString) {\n            result += char;\n            continue;\n        }\n        // --- 只有在字符串外部时，才进行注释检查 ---\n        const nextChar = str[i + 1];\n        // 检查行注释 `//`\n        if (char === '/' && nextChar === '/') {\n            const endOfLine = str.indexOf('\\n', i + 2);\n            if (endOfLine === -1) {\n                // 如果没有换行符，说明注释直到字符串末尾，直接结束循环。\n                break;\n            }\n            // 保留换行符，并将索引 `i` 快进到行尾。\n            result += '\\n';\n            i = endOfLine;\n            continue;\n        }\n        // 检查块注释 `/* ... */`\n        if (char === '/' && nextChar === '*') {\n            const endOfComment = str.indexOf('*/', i + 2);\n            if (endOfComment === -1) {\n                // 未闭合的注释，忽略剩余所有内容。\n                break;\n            }\n            // 将索引 `i` 快进到注释结尾。\n            i = endOfComment + 1;\n            continue;\n        }\n        // 检查 HTML 注释 `\x3c!-- ... --\x3e`\n        if (char === '<' && str.substring(i, i + 4) === '\x3c!--') {\n            const endOfComment = str.indexOf('--\x3e', i + 4);\n            if (endOfComment === -1) {\n                // 未闭合的注释。\n                break;\n            }\n            i = endOfComment + 2;\n            continue;\n        }\n        // 如果不是注释，则保留该字符。\n        result += char;\n    }\n    return result;\n}\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @returns {any[]} 解析出的对象数组。\n */\nfunction parseJsonl(str) {\n    const objects = [];\n    if (!str || typeof str !== 'string') {\n        return objects;\n    }\n    // 在解析 JSON 之前，必须先安全地移除所有注释。\n    // 不能使用简单的正则表达式（如 `/\\/\\/.*/g`），因为它无法区分代码中的注释和字符串值（如 URL \"https://...\"）中的 `//`，\n    // 会错误地破坏 JSON 字符串的结构。`stripComments` 函数通过状态管理解决了这个问题。\n    const strWithoutComments = stripComments(str);\n    const trimmedStr = strWithoutComments.trim();\n    let braceCount = 0; // 花括号平衡计数器\n    let startIndex = -1; // 当前 JSON 对象的起始索引\n    let inString = false; // 标记是否处于双引号字符串内部\n    for (let i = 0; i < trimmedStr.length; i++) {\n        const char = trimmedStr[i];\n        // 切换 inString 状态，忽略转义的双引号\n        if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，则跳过所有花括号的逻辑判断\n        if (inString)\n            continue;\n        if (char === '{') {\n            if (braceCount === 0) {\n                // 发现一个新 JSON 对象的开始\n                startIndex = i;\n            }\n            braceCount++;\n        }\n        else if (char === '}') {\n            if (braceCount > 0) {\n                braceCount--;\n                if (braceCount === 0 && startIndex !== -1) {\n                    // 花括号平衡，一个完整的 JSON 对象被找到\n                    const jsonString = trimmedStr.substring(startIndex, i + 1);\n                    try {\n                        const obj = JSON.parse(jsonString);\n                        objects.push(obj);\n                    }\n                    catch (e) {\n                        // 如果解析失败，记录错误并继续，不中断整个过程\n                        logger.error(`JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n                    }\n                    // 重置状态，准备寻找下一个对象\n                    startIndex = -1;\n                }\n            }\n        }\n    }\n    return objects;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSSxRQUFRO1lBQUUsU0FBUztRQUV2QixJQUFJLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNqQixJQUFJLFVBQVUsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDckIsbUJBQW1CO2dCQUNuQixVQUFVLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLENBQUM7WUFDRCxVQUFVLEVBQUUsQ0FBQztRQUNmLENBQUM7YUFBTSxJQUFJLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUN4QixJQUFJLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDbkIsVUFBVSxFQUFFLENBQUM7Z0JBQ2IsSUFBSSxVQUFVLEtBQUssQ0FBQyxJQUFJLFVBQVUsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUMxQyx5QkFBeUI7b0JBQ3pCLE1BQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDM0QsSUFBSSxDQUFDO3dCQUNILE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7d0JBQ25DLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3BCLENBQUM7b0JBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQzt3QkFDaEIseUJBQXlCO3dCQUN6QixNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLFlBQVksVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzFFLENBQUM7b0JBQ0QsaUJBQWlCO29CQUNqQixVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxPQUFPLE9BQU8sQ0FBQztBQUNqQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvZGF0YS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDpgJrnlKjmlbDmja7lpITnkIbmqKHlnZdcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuL2xvZyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3V0aWxzLWRhdGEnKTtcblxuY29uc3QgRVNDQVBFX01BUDogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgJy4nOiAnX19ET1RfXycsXG4gICdcIic6ICdfX0RRVU9URV9fJyxcbiAgXCInXCI6ICdfX1NRVU9URV9fJyxcbn07XG5cbmNvbnN0IFVORVNDQVBFX01BUDogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IF8uaW52ZXJ0KEVTQ0FQRV9NQVApO1xuXG5jb25zdCBlc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoT2JqZWN0LmtleXMoRVNDQVBFX01BUCkubWFwKF8uZXNjYXBlUmVnRXhwKS5qb2luKCd8JyksICdnJyk7XG5jb25zdCB1bmVzY2FwZVJlZ2V4ID0gbmV3IFJlZ0V4cChPYmplY3QudmFsdWVzKEVTQ0FQRV9NQVApLm1hcChfLmVzY2FwZVJlZ0V4cCkuam9pbignfCcpLCAnZycpO1xuXG4vKipcbiAqIOmAkuW9kuWcsOi9rOS5ieWvueixoeaIluaVsOe7hOS4reaJgOacieWtl+espuS4suWAvOWSjOmUrueahOeJueauiuWtl+espuOAglxuICogQHBhcmFtIGRhdGEgLSDopoHlpITnkIbnmoTmlbDmja7jgIJcbiAqIEByZXR1cm5zIC0g6L2s5LmJ5ZCO55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGVFcmFEYXRhPFQ+KGRhdGE6IFQpOiBUIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICByZXR1cm4gZGF0YS5tYXAoaXRlbSA9PiBlc2NhcGVFcmFEYXRhKGl0ZW0pKSBhcyBhbnk7XG4gIH1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChkYXRhKSkge1xuICAgIGNvbnN0IG5ld09iajogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSkge1xuICAgICAgICBjb25zdCBlc2NhcGVkS2V5ID0ga2V5LnJlcGxhY2UoZXNjYXBlUmVnZXgsIG1hdGNoID0+IEVTQ0FQRV9NQVBbbWF0Y2hdKTtcbiAgICAgICAgbmV3T2JqW2VzY2FwZWRLZXldID0gZXNjYXBlRXJhRGF0YSgoZGF0YSBhcyBhbnkpW2tleV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3T2JqIGFzIGFueTtcbiAgfVxuICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGRhdGEucmVwbGFjZShlc2NhcGVSZWdleCwgbWF0Y2ggPT4gRVNDQVBFX01BUFttYXRjaF0pIGFzIGFueTtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiDpgJLlvZLlnLDlj43ovazkuYnlr7nosaHmiJbmlbDnu4TkuK3miYDmnInlrZfnrKbkuLLlgLzlkozplK7nmoTnibnmrorlrZfnrKbjgIJcbiAqIEBwYXJhbSBkYXRhIC0g6KaB5aSE55CG55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyAtIOWPjei9rOS5ieWQjueahOaVsOaNruOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5lc2NhcGVFcmFEYXRhPFQ+KGRhdGE6IFQpOiBUIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICByZXR1cm4gZGF0YS5tYXAoaXRlbSA9PiB1bmVzY2FwZUVyYURhdGEoaXRlbSkpIGFzIGFueTtcbiAgfVxuICBpZiAoXy5pc1BsYWluT2JqZWN0KGRhdGEpKSB7XG4gICAgY29uc3QgbmV3T2JqOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpKSB7XG4gICAgICAgIGNvbnN0IHVuZXNjYXBlZEtleSA9IGtleS5yZXBsYWNlKHVuZXNjYXBlUmVnZXgsIG1hdGNoID0+IFVORVNDQVBFX01BUFttYXRjaF0pO1xuICAgICAgICBuZXdPYmpbdW5lc2NhcGVkS2V5XSA9IHVuZXNjYXBlRXJhRGF0YSgoZGF0YSBhcyBhbnkpW2tleV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3T2JqIGFzIGFueTtcbiAgfVxuICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGRhdGEucmVwbGFjZSh1bmVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBVTkVTQ0FQRV9NQVBbbWF0Y2hdKSBhcyBhbnk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICog5Yik5pat5LiA5Liq5YC85piv5ZCm5Li64oCc57qv57K555qE5a+56LGh4oCd77yIUGxhaW4gT2JqZWN077yJ44CCXG4gKiDmlbDnu4TjgIFudWxs44CB5Ye95pWw44CBRGF0ZSDlr7nosaHnrYnpg73kvJrov5Tlm54gZmFsc2XjgIJcbiAqIEBwYXJhbSB7Kn0gdiAtIOW+heajgOafpeeahOWAvOOAglxuICogQHJldHVybnMge2Jvb2xlYW59IOWmguaenOaYr+e6r+eyueeahOWvueixoeWImei/lOWbniB0cnVl77yM5ZCm5YiZ6L+U5ZueIGZhbHNl44CCXG4gKi9cbmV4cG9ydCBjb25zdCBpc1BPID0gKHY6IGFueSk6IHYgaXMgUmVjb3JkPHN0cmluZywgYW55PiA9PiBfLmlzUGxhaW5PYmplY3Qodik7XG5cbi8qKlxuICog6YCS5b2S5Zyw4oCc5YeA5YyW4oCd5LiA5Liq5a+56LGh77yM5bCG5YW25Lit55qE5pWw57uE5oiW5a+56LGh5YC86L2s5o2i5Li65a2X56ym5Liy44CCXG4gKiDkuLvopoHnlKjkuo7lh4blpIfmlbDmja7ku6Xkvr/lnKjmn5DkupvnibnlrprlnLrmma/kuIvlsZXnpLrmiJblrZjlgqjjgIJcbiAqIEBwYXJhbSB7Kn0gdiAtIOW+heWHgOWMlueahOWAvOOAglxuICogQHJldHVybnMgeyp9IOWHgOWMluWQjueahOWAvOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVBcnJheXModjogYW55KTogYW55IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkodikpIHtcbiAgICAvLyDlpoLmnpzmmK/mlbDnu4TvvIzliJnpgY3ljoblhbblhYPntKDjgILlpoLmnpzlhYPntKDmmK/mlbDnu4TmiJblr7nosaHvvIzliJnlrZfnrKbkuLLljJblroPjgIJcbiAgICByZXR1cm4gdi5tYXAoZSA9PiAoQXJyYXkuaXNBcnJheShlKSB8fCBfLmlzUGxhaW5PYmplY3QoZSkgPyBKU09OLnN0cmluZ2lmeShlKSA6IGUpKTtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QodikpIHtcbiAgICAvLyDlpoLmnpzmmK/lr7nosaHvvIzliJnpgJLlvZLlnLDlr7nlhbbmr4/kuKrlsZ7mgKflgLzov5vooYzlh4DljJbjgIJcbiAgICBjb25zdCBvOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgZm9yIChjb25zdCBrIGluIHYpIG9ba10gPSBzYW5pdGl6ZUFycmF5cyh2W2tdKTtcbiAgICByZXR1cm4gbztcbiAgfSBlbHNlIHtcbiAgICAvLyDlhbbku5bnsbvlnovnmoTlgLznm7TmjqXov5Tlm57jgIJcbiAgICByZXR1cm4gdjtcbiAgfVxufVxuXG4vKipcbiAqIOWuieWFqOWcsOWwhuS4gOS4quWvueixoeW6j+WIl+WMluS4uuagvOW8j+WMlueahCBKU09OIOWtl+espuS4suOAglxuICog5aaC5p6c5bqP5YiX5YyW5aSx6LSl77yM5LiN5Lya5oqb5Ye65byC5bi477yM6ICM5piv6L+U5Zue5LiA5Liq5YyF5ZCr6ZSZ6K+v5L+h5oGv55qE5a2X56ym5Liy44CCXG4gKiBAcGFyYW0geyp9IG8gLSDlvoXluo/liJfljJbnmoTlr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOaIkOWKn+WImei/lOWbniBKU09OIOWtl+espuS4su+8jOWksei0peWImei/lOWbnumUmeivr+aPkOekuuOAglxuICovXG5leHBvcnQgY29uc3QgSiA9IChvOiBhbnkpOiBzdHJpbmcgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvLCBudWxsLCAyKTsgLy8g5L2/55SoIDIg5Liq56m65qC86L+b6KGM57yp6L+b77yM5o+Q6auY5Y+v6K+75oCn44CCXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiBgPDxzdHJpbmdpZnnlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfT4+YDtcbiAgfVxufTtcblxuLyoqXG4gKiDkvb/nlKjigJzmlrDmlbDnu4Topobnm5bml6fmlbDnu4TigJ3nmoTnrZbnlaXmnaXmt7HluqblkIjlubbkuKTkuKrlr7nosaHjgIJcbiAqIOi/meaYryBgXy5tZXJnZWAg55qE5LiA5Liq5Y+Y5L2T77yM5LiT6Zeo55So5LqO5aSE55CG5qih5p2/5ZCI5bm2562J5Zy65pmv77yMXG4gKiDlnKjov5nkupvlnLrmma/kuK3vvIzmiJHku6zluIzmnJvooaXkuIHlr7nosaHkuK3nmoTmlbDnu4Tog73lpJ/lrozlhajmm7/mjaLln7rnoYDlr7nosaHkuK3nmoTmlbDnu4TvvIzogIzkuI3mmK/lkIjlubblroPku6zjgIJcbiAqIEBwYXJhbSB7Kn0gYmFzZSAtIOWfuuehgOWvueixoeOAglxuICogQHBhcmFtIHsqfSBwYXRjaCAtIOihpeS4geWvueixoeOAglxuICogQHJldHVybnMgeyp9IOWQiOW5tuWQjueahOaWsOWvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VSZXBsYWNlQXJyYXkoYmFzZTogYW55LCBwYXRjaDogYW55KTogYW55IHtcbiAgLy8g5L2/55SoIF8uY2xvbmVEZWVwIOehruS/neS4jeS/ruaUueWOn+Wni+WvueixoeOAglxuICByZXR1cm4gXy5tZXJnZVdpdGgoXy5jbG9uZURlZXAoYmFzZSksIF8uY2xvbmVEZWVwKHBhdGNoKSwgKGE6IGFueSwgYjogYW55KSA9PiB7XG4gICAgLy8g6Ieq5a6a5LmJ5ZCI5bm26YC76L6R77ya5aaC5p6c5Lu75LiA5YC85Li65pWw57uE77yM5YiZ55u05o6l6L+U5Zue6KGl5LiB5YC877yIYu+8ie+8jOS7juiAjOWunueOsOimhuebluOAglxuICAgIGlmIChBcnJheS5pc0FycmF5KGEpIHx8IEFycmF5LmlzQXJyYXkoYikpIHJldHVybiBiO1xuICAgIC8vIOWvueS6jumdnuaVsOe7hOexu+Wei++8jOi/lOWbniB1bmRlZmluZWQg5Lul5L2/55SoIF8ubWVyZ2Ug55qE6buY6K6k5ZCI5bm26KGM5Li644CCXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSk7XG59XG5cbi8qKlxuICog5YGl5aOu5Zyw6Kej5p6QIGBFZGl0TG9nYCDnmoTljp/lp4vmlbDmja7jgIJcbiAqIGBFZGl0TG9nYCDlj6/og73ku6XlpJrnp43moLzlvI/lrZjlnKjvvIjlr7nosaHjgIHmlbDnu4TjgIFKU09O5a2X56ym5Liy77yJ77yM5q2k5Ye95pWw5peo5Zyo57uf5LiA5aSE55CG5a6D5Lus44CCXG4gKiBAcGFyYW0geyp9IHJhdyAtIOS7juWPmOmHj+S4reivu+WPlueahOWOn+WniyBgRWRpdExvZ2Ag5pWw5o2u44CCXG4gKiBAcmV0dXJucyB7YW55W119IOino+aekOWQjueahCBgRWRpdExvZ2Ag5pWw57uE44CC5aaC5p6c6Kej5p6Q5aSx6LSl5oiW6L6T5YWl5peg5pWI77yM5YiZ6L+U5Zue5LiA5Liq56m65pWw57uE44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUVkaXRMb2cocmF3OiBhbnkpOiBhbnlbXSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHJhdykpIHJldHVybiByYXc7XG4gIGlmIChyYXcgJiYgdHlwZW9mIHJhdyA9PT0gJ29iamVjdCcpIHJldHVybiBbcmF3XTsgLy8g5Y2V5Liq5a+56LGh5Lmf6KeG5Li65pyJ5pWI5pel5b+XXG4gIGlmICh0eXBlb2YgcmF3ID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHMgPSByYXcucmVwbGFjZSgvXlxccypgYGAoPzpqc29uKT9cXHMqfFxccypgYGBcXHMqJC9nLCAnJyk7IC8vIOenu+mZpOS7o+eggeWbtOagj1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcnIgPSBKU09OLnBhcnNlKHMpO1xuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYXJyKSA/IGFyciA6IFtdO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICByZXR1cm4gW107XG59XG5cbi8qKlxuICog5pm66IO95Zyw5LuO5a2X56ym5Liy5Lit56e76Zmk5ZCE56eN6aOO5qC855qE5rOo6YeK77yM5ZCM5pe25L+d55WZ5a2X56ym5Liy5a2X6Z2i6YeP5Lit55qE5YaF5a6544CCXG4gKlxuICogKirlt6XkvZzljp/nkIYqKjpcbiAqIOivpeWHveaVsOmAmui/h+S4gOS4quWwj+Wei+eKtuaAgeacuuadpemAkOWtl+ino+aekOi+k+WFpeWtl+espuS4suOAguWug+e7tOaKpOS4gOS4qiBgaW5TdHJpbmdgIOeKtuaAge+8jFxuICog55So5LqO5Yik5pat5b2T5YmN5a2X56ym5piv5ZCm5L2N5LqO5LiA5Liq5Y+M5byV5Y+35YyF6KO555qE5a2X56ym5Liy5YaF6YOo44CCXG4gKlxuICogMS4g5b2T5qOA5rWL5Yiw6L+b5YWl5oiW6YCA5Ye65LiA5Liq5a2X56ym5Liy5pe277yI6YCa6L+H6Z2e6L2s5LmJ55qE5Y+M5byV5Y+3IGBcImDvvInvvIxgaW5TdHJpbmdgIOeKtuaAgeS8mue/u+i9rOOAglxuICogMi4g5aaC5p6cIGBpblN0cmluZ2Ag5Li6IGB0cnVlYO+8jOWImeaJgOacieWtl+espumDveS8muiiq+aXoOadoeS7tuWcsOS/neeVmeOAgui/meehruS/neS6huWtl+espuS4suWAvO+8iOWmgiBVUkzvvInkuK3nmoQgYC8vYCDmiJYgYC8qYCDkuI3kvJrooqvlvZPkvZzms6jph4rlpITnkIbjgIJcbiAqIDMuIOWmguaenCBgaW5TdHJpbmdgIOS4uiBgZmFsc2Vg77yM5Ye95pWw5Lya5qOA5p+l5piv5ZCm5a2Y5Zyo5rOo6YeK5qCH6K6w77yIYC8vYCwgYC8qYCwgYDwhLS1g77yJ44CCXG4gKiA0LiDlpoLmnpzmib7liLDms6jph4rmoIforrDvvIzlh73mlbDkvJrlkJHliY3miavmj4/nm7TliLDms6jph4rnu5PmnZ/vvIzlubbot7Pov4fov5npg6jliIblhoXlrrnjgIJcbiAqIDUuIOWmguaenOayoeacieaJvuWIsOazqOmHiu+8jOWImeWwhuW9k+WJjeWtl+espui/veWKoOWIsOe7k+aenOS4reOAglxuICpcbiAqIEBwYXJhbSBzdHIgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIOenu+mZpOS6huazqOmHiueahOWtl+espuS4suOAglxuICovXG5mdW5jdGlvbiBzdHJpcENvbW1lbnRzKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzdHIpIHJldHVybiAnJztcblxuICBsZXQgcmVzdWx0ID0gJyc7XG4gIGxldCBpblN0cmluZyA9IGZhbHNlOyAvLyDnirbmgIHvvJrmmK/lkKblnKjlrZfnrKbkuLLlhoXpg6hcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNoYXIgPSBzdHJbaV07XG5cbiAgICAvLyDmo4Dmn6XmmK/lkKbov5vlhaXmiJbpgIDlh7rlrZfnrKbkuLLjgILlv73nlaXovazkuYnnmoTlj4zlvJXlj7cgYFxcXCJg44CCXG4gICAgaWYgKGNoYXIgPT09ICdcIicgJiYgKGkgPT09IDAgfHwgc3RyW2kgLSAxXSAhPT0gJ1xcXFwnKSkge1xuICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5Zyo5a2X56ym5Liy5YaF6YOo77yM55u05o6l6L+95Yqg5a2X56ym77yM5LiN6L+b6KGM5Lu75L2V5rOo6YeK5qOA5p+l44CCXG4gICAgaWYgKGluU3RyaW5nKSB7XG4gICAgICByZXN1bHQgKz0gY2hhcjtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIC0tLSDlj6rmnInlnKjlrZfnrKbkuLLlpJbpg6jml7bvvIzmiY3ov5vooYzms6jph4rmo4Dmn6UgLS0tXG4gICAgY29uc3QgbmV4dENoYXIgPSBzdHJbaSArIDFdO1xuXG4gICAgLy8g5qOA5p+l6KGM5rOo6YeKIGAvL2BcbiAgICBpZiAoY2hhciA9PT0gJy8nICYmIG5leHRDaGFyID09PSAnLycpIHtcbiAgICAgIGNvbnN0IGVuZE9mTGluZSA9IHN0ci5pbmRleE9mKCdcXG4nLCBpICsgMik7XG4gICAgICBpZiAoZW5kT2ZMaW5lID09PSAtMSkge1xuICAgICAgICAvLyDlpoLmnpzmsqHmnInmjaLooYznrKbvvIzor7TmmI7ms6jph4rnm7TliLDlrZfnrKbkuLLmnKvlsL7vvIznm7TmjqXnu5PmnZ/lvqrnjq/jgIJcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyDkv53nlZnmjaLooYznrKbvvIzlubblsIbntKLlvJUgYGlgIOW/q+i/m+WIsOihjOWwvuOAglxuICAgICAgcmVzdWx0ICs9ICdcXG4nO1xuICAgICAgaSA9IGVuZE9mTGluZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIC8vIOajgOafpeWdl+azqOmHiiBgLyogLi4uICovYFxuICAgIGlmIChjaGFyID09PSAnLycgJiYgbmV4dENoYXIgPT09ICcqJykge1xuICAgICAgY29uc3QgZW5kT2ZDb21tZW50ID0gc3RyLmluZGV4T2YoJyovJywgaSArIDIpO1xuICAgICAgaWYgKGVuZE9mQ29tbWVudCA9PT0gLTEpIHtcbiAgICAgICAgLy8g5pyq6Zet5ZCI55qE5rOo6YeK77yM5b+955Wl5Ymp5L2Z5omA5pyJ5YaF5a6544CCXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8g5bCG57Si5byVIGBpYCDlv6vov5vliLDms6jph4rnu5PlsL7jgIJcbiAgICAgIGkgPSBlbmRPZkNvbW1lbnQgKyAxO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8g5qOA5p+lIEhUTUwg5rOo6YeKIGA8IS0tIC4uLiAtLT5gXG4gICAgaWYgKGNoYXIgPT09ICc8JyAmJiBzdHIuc3Vic3RyaW5nKGksIGkgKyA0KSA9PT0gJzwhLS0nKSB7XG4gICAgICBjb25zdCBlbmRPZkNvbW1lbnQgPSBzdHIuaW5kZXhPZignLS0+JywgaSArIDQpO1xuICAgICAgaWYgKGVuZE9mQ29tbWVudCA9PT0gLTEpIHtcbiAgICAgICAgLy8g5pyq6Zet5ZCI55qE5rOo6YeK44CCXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaSA9IGVuZE9mQ29tbWVudCArIDI7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyDlpoLmnpzkuI3mmK/ms6jph4rvvIzliJnkv53nlZnor6XlrZfnrKbjgIJcbiAgICByZXN1bHQgKz0gY2hhcjtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIOino+aekOS4gOS4quWMheWQq+WkmuS4quS4suiBlCBKU09OIOWvueixoeeahOWtl+espuS4su+8iOexu+S8vOS6jiBKU09OTCDmoLzlvI/vvInjgIJcbiAqIOi/meenjeagvOW8j+acieaXtuS8mueUsSBBSSDnlJ/miJDjgILmraTlh73mlbDog73lpJ/pgJDkuKrmj5Dlj5blubbop6PmnpDlroPku6zjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIC0g5b6F6Kej5p6Q55qE5a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyB7YW55W119IOino+aekOWHuueahOWvueixoeaVsOe7hOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VKc29ubChzdHI6IHN0cmluZyk6IGFueVtdIHtcbiAgY29uc3Qgb2JqZWN0czogYW55W10gPSBbXTtcbiAgaWYgKCFzdHIgfHwgdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gb2JqZWN0cztcbiAgfVxuXG4gIC8vIOWcqOino+aekCBKU09OIOS5i+WJje+8jOW/hemhu+WFiOWuieWFqOWcsOenu+mZpOaJgOacieazqOmHiuOAglxuICAvLyDkuI3og73kvb/nlKjnroDljZXnmoTmraPliJnooajovr7lvI/vvIjlpoIgYC9cXC9cXC8uKi9nYO+8ie+8jOWboOS4uuWug+aXoOazleWMuuWIhuS7o+eggeS4reeahOazqOmHiuWSjOWtl+espuS4suWAvO+8iOWmgiBVUkwgXCJodHRwczovLy4uLlwi77yJ5Lit55qEIGAvL2DvvIxcbiAgLy8g5Lya6ZSZ6K+v5Zyw56C05Z2PIEpTT04g5a2X56ym5Liy55qE57uT5p6E44CCYHN0cmlwQ29tbWVudHNgIOWHveaVsOmAmui/h+eKtuaAgeeuoeeQhuino+WGs+S6hui/meS4qumXrumimOOAglxuICBjb25zdCBzdHJXaXRob3V0Q29tbWVudHMgPSBzdHJpcENvbW1lbnRzKHN0cik7XG4gIGNvbnN0IHRyaW1tZWRTdHIgPSBzdHJXaXRob3V0Q29tbWVudHMudHJpbSgpO1xuXG4gIGxldCBicmFjZUNvdW50ID0gMDsgLy8g6Iqx5ous5Y+35bmz6KGh6K6h5pWw5ZmoXG4gIGxldCBzdGFydEluZGV4ID0gLTE7IC8vIOW9k+WJjSBKU09OIOWvueixoeeahOi1t+Wni+e0ouW8lVxuICBsZXQgaW5TdHJpbmcgPSBmYWxzZTsgLy8g5qCH6K6w5piv5ZCm5aSE5LqO5Y+M5byV5Y+35a2X56ym5Liy5YaF6YOoXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltbWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hhciA9IHRyaW1tZWRTdHJbaV07XG5cbiAgICAvLyDliIfmjaIgaW5TdHJpbmcg54q25oCB77yM5b+955Wl6L2s5LmJ55qE5Y+M5byV5Y+3XG4gICAgaWYgKGNoYXIgPT09ICdcIicgJiYgKGkgPT09IDAgfHwgdHJpbW1lZFN0cltpIC0gMV0gIT09ICdcXFxcJykpIHtcbiAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nO1xuICAgIH1cblxuICAgIC8vIOWmguaenOWcqOWtl+espuS4suWGhemDqO+8jOWImei3s+i/h+aJgOacieiKseaLrOWPt+eahOmAu+i+keWIpOaWrVxuICAgIGlmIChpblN0cmluZykgY29udGludWU7XG5cbiAgICBpZiAoY2hhciA9PT0gJ3snKSB7XG4gICAgICBpZiAoYnJhY2VDb3VudCA9PT0gMCkge1xuICAgICAgICAvLyDlj5HnjrDkuIDkuKrmlrAgSlNPTiDlr7nosaHnmoTlvIDlp4tcbiAgICAgICAgc3RhcnRJbmRleCA9IGk7XG4gICAgICB9XG4gICAgICBicmFjZUNvdW50Kys7XG4gICAgfSBlbHNlIGlmIChjaGFyID09PSAnfScpIHtcbiAgICAgIGlmIChicmFjZUNvdW50ID4gMCkge1xuICAgICAgICBicmFjZUNvdW50LS07XG4gICAgICAgIGlmIChicmFjZUNvdW50ID09PSAwICYmIHN0YXJ0SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgLy8g6Iqx5ous5Y+35bmz6KGh77yM5LiA5Liq5a6M5pW055qEIEpTT04g5a+56LGh6KKr5om+5YiwXG4gICAgICAgICAgY29uc3QganNvblN0cmluZyA9IHRyaW1tZWRTdHIuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGkgKyAxKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShqc29uU3RyaW5nKTtcbiAgICAgICAgICAgIG9iamVjdHMucHVzaChvYmopO1xuICAgICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgICAgLy8g5aaC5p6c6Kej5p6Q5aSx6LSl77yM6K6w5b2V6ZSZ6K+v5bm257un57ut77yM5LiN5Lit5pat5pW05Liq6L+H56iLXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYEpTT05MIOino+aekOWksei0pTogJHtlPy5tZXNzYWdlIHx8IGV9LiDlpLHotKXnmoTniYfmrrU6ICR7anNvblN0cmluZ31gLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8g6YeN572u54q25oCB77yM5YeG5aSH5a+75om+5LiL5LiA5Liq5a+56LGhXG4gICAgICAgICAgc3RhcnRJbmRleCA9IC0xO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBvYmplY3RzO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/era_data.ts": 
  /*!***************************************!*\
  !*** ./src/ERA变量框架/utils/era_data.ts ***!
  \***************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getEraData: () => (/* binding */ getEraData),\n/* harmony export */   removeMetaFields: () => (/* binding */ removeMetaFields),\n/* harmony export */   updateEraMetaData: () => (/* binding */ updateEraMetaData),\n/* harmony export */   updateEraStatData: () => (/* binding */ updateEraStatData)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/**\n * @file ERA 变量框架 - ERA 核心变量读写模块\n */\n\n\n\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nfunction removeMetaFields(obj) {\n    // 对于非对象类型，直接返回原始值\n    if (!lodash__WEBPACK_IMPORTED_MODULE_0___default().isObject(obj)) {\n        return obj;\n    }\n    // 创建深拷贝以避免修改原始对象\n    const newObj = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(obj);\n    function recurse(current) {\n        if (Array.isArray(current)) {\n            // 如果是数组，则递归处理数组中的每个元素\n            current.forEach(item => recurse(item));\n        }\n        else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(current)) {\n            // 如果是纯粹的对象，遍历其所有键\n            for (const key in current) {\n                // 如果键以 '$' 开头，则删除该属性\n                if (key.startsWith('$')) {\n                    delete current[key];\n                }\n                else {\n                    // 否则，递归处理该属性的值\n                    recurse(current[key]);\n                }\n            }\n        }\n    }\n    recurse(newObj);\n    return newObj;\n}\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nfunction getEraData() {\n    const chatVars = getVariables(_constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE) || {};\n    const meta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n    const stat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n    return { meta, stat };\n}\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nasync function updateEraStatData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentStat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n        const newStat = await updater(currentStat);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, newStat);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nasync function updateEraMetaData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentMeta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n        const newMeta = await updater(currentMeta);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, newMeta);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Olsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL2VyYV9kYXRhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIEVSQSDmoLjlv4Plj5jph4/or7vlhpnmqKHlnZdcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBDSEFUX1NDT1BFLCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbi8qKlxuICog6YCS5b2S5Zyw5LuO5a+56LGh5Lit56e76Zmk5omA5pyJ5LulIGAkYCDlvIDlpLTnmoTlrZfmrrXvvIjlpoIgYCRtZXRhYCwgYCR0ZW1wbGF0ZWDvvInjgIJcbiAqIOatpOWHveaVsOS8muWIm+W7uuS4gOS4quWvueixoeeahOa3seaLt+i0ne+8jOWboOatpOS4jeS8muS/ruaUueWOn+Wni+WvueixoeOAglxuICogQHBhcmFtIHthbnl9IG9iaiAtIOW+heWkhOeQhueahOWvueixoeaIluWAvOOAglxuICogQHJldHVybnMge2FueX0g5LiA5Liq5LiN5YyF5ZCrIGAkYCDliY3nvIDlrZfmrrXnmoTmlrDlr7nosaHmiJbljp/lp4vlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU1ldGFGaWVsZHMob2JqOiBhbnkpOiBhbnkge1xuICAvLyDlr7nkuo7pnZ7lr7nosaHnsbvlnovvvIznm7TmjqXov5Tlm57ljp/lp4vlgLxcbiAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgLy8g5Yib5bu65rex5ou36LSd5Lul6YG/5YWN5L+u5pS55Y6f5aeL5a+56LGhXG4gIGNvbnN0IG5ld09iaiA9IF8uY2xvbmVEZWVwKG9iaik7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50OiBhbnkpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YCS5b2S5aSE55CG5pWw57uE5Lit55qE5q+P5Liq5YWD57SgXG4gICAgICBjdXJyZW50LmZvckVhY2goaXRlbSA9PiByZWN1cnNlKGl0ZW0pKTtcbiAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv57qv57K555qE5a+56LGh77yM6YGN5Y6G5YW25omA5pyJ6ZSuXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBjdXJyZW50KSB7XG4gICAgICAgIC8vIOWmguaenOmUruS7pSAnJCcg5byA5aS077yM5YiZ5Yig6Zmk6K+l5bGe5oCnXG4gICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnJCcpKSB7XG4gICAgICAgICAgZGVsZXRlIGN1cnJlbnRba2V5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyDlkKbliJnvvIzpgJLlvZLlpITnkIbor6XlsZ7mgKfnmoTlgLxcbiAgICAgICAgICByZWN1cnNlKGN1cnJlbnRba2V5XSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZWN1cnNlKG5ld09iaik7XG4gIHJldHVybiBuZXdPYmo7XG59XG5cbi8qKlxuICog6I635Y+W5bm256Gu5L+dIEVSQSDnmoTlhYPmlbDmja7lkoznirbmgIHmlbDmja7lr7nosaHnmoTlrZjlnKjjgIJcbiAqIEByZXR1cm5zIHt7bWV0YTogb2JqZWN0LCBzdGF0OiBvYmplY3R9fSDljIXlkKvlhYPmlbDmja7lkoznirbmgIHmlbDmja7nmoTlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVyYURhdGEoKTogeyBtZXRhOiBhbnk7IHN0YXQ6IGFueSB9IHtcbiAgY29uc3QgY2hhdFZhcnMgPSBnZXRWYXJpYWJsZXMoQ0hBVF9TQ09QRSkgfHwge307XG4gIGNvbnN0IG1ldGEgPSBfLmdldChjaGF0VmFycywgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgY29uc3Qgc3RhdCA9IF8uZ2V0KGNoYXRWYXJzLCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICByZXR1cm4geyBtZXRhLCBzdGF0IH07XG59XG5cbi8qKlxuICog5Y6f5a2Q5oCn5Zyw5pu05pawIEVSQSDnmoTnirbmgIHmlbDmja4gKHN0YXRfZGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRTdGF0RGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBzdGF0X2RhdGEg5bm26L+U5Zue5L+u5pS55ZCOIHN0YXRfZGF0YSDnmoTlh73mlbAgKOWPr+S7peaYryBhc3luYynjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUVyYVN0YXREYXRhKHVwZGF0ZXI6IChjdXJyZW50U3RhdERhdGE6IGFueSkgPT4gYW55IHwgUHJvbWlzZTxhbnk+KSB7XG4gIGF3YWl0IHVwZGF0ZVZhcmlhYmxlc1dpdGgoYXN5bmMgdiA9PiB7XG4gICAgY29uc3QgY3VycmVudFN0YXQgPSBfLmdldCh2LCBTVEFUX0RBVEFfUEFUSCwge30pO1xuICAgIGNvbnN0IG5ld1N0YXQgPSBhd2FpdCB1cGRhdGVyKGN1cnJlbnRTdGF0KTtcbiAgICBfLnNldCh2LCBTVEFUX0RBVEFfUEFUSCwgbmV3U3RhdCk7XG4gICAgcmV0dXJuIHY7XG4gIH0sIENIQVRfU0NPUEUpO1xufVxuXG4vKipcbiAqIOWOn+WtkOaAp+WcsOabtOaWsCBFUkEg55qE5YWD5pWw5o2uIChFUkFNZXRhRGF0YSnjgIJcbiAqIEBwYXJhbSB7KGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiAoYW55IHwgUHJvbWlzZTxhbnk+KX0gdXBkYXRlciAtIOS4gOS4quaOpeaUtuW9k+WJjSBFUkFNZXRhRGF0YSDlubbov5Tlm57kv67mlLnlkI4gRVJBTWV0YURhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVFcmFNZXRhRGF0YSh1cGRhdGVyOiAoY3VycmVudE1ldGFEYXRhOiBhbnkpID0+IGFueSB8IFByb21pc2U8YW55Pikge1xuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZXRhID0gXy5nZXQodiwgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgICBjb25zdCBuZXdNZXRhID0gYXdhaXQgdXBkYXRlcihjdXJyZW50TWV0YSk7XG4gICAgXy5zZXQodiwgTUVUQV9EQVRBX1BBVEgsIG5ld01ldGEpO1xuICAgIHJldHVybiB2O1xuICB9LCBDSEFUX1NDT1BFKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/era_data.ts\n\n}");
  },
  "./src/ERA变量框架/utils/log.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/utils/log.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LOG_CONFIG: () => (/* binding */ LOG_CONFIG),\n/* harmony export */   Logger: () => (/* binding */ Logger),\n/* harmony export */   logContext: () => (/* binding */ logContext)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 日志记录模块\n */\n\n/**\n * @constant {object} LOG_CONFIG\n * @description\n * 用于控制日志输出的配置对象。\n */\nconst LOG_CONFIG = {\n    // 定义所有可用的日志级别及其权重。数字越小，级别越低。\n    levels: {\n        debug: 0,\n        log: 1,\n        warn: 2,\n        error: 3,\n    },\n    // 设置当前全局日志级别。只有权重等于或高于此级别的日志才会被输出。\n    currentLevel: 0, // 默认为 'debug'\n    // 'debug' 级别的白名单。只有当 currentLevel 为 debug 时，此列表才生效。\n    // 只有在此列表中的模块才会输出 debug 日志。\n    debugWhitelist: [\n        'api-command',\n        'api-macro-parser',\n        'api-macro-patch',\n        'core-rollback',\n        'core-sync',\n        //'core-crud-delete',\n        //'core-crud-update',\n        'core-crud-patcher',\n        'core-crud-insert-insert',\n        //'core-crud-insert-template',\n        //'core-key-mk',\n        'events-dispatcher',\n        'events-queue',\n        'events-merger',\n        'utils-message',\n        'ui-components-statusBarContent',\n    ],\n};\n// 初始化时将 currentLevel 设置为 debug 级别\nLOG_CONFIG.currentLevel = LOG_CONFIG.levels.debug;\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持日志分级的记录器。\n *\n * **核心功能**:\n * 1. **日志分级**: 提供 `debug`, `log`, `warn`, `error` 四个级别，方便过滤和定位问题。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式，清晰明了。\n * 3. **控制台输出**: 日志会根据级别使用不同颜色和样式的 `console` 方法输出，便于在浏览器中实时调试。\n * 4. **纯粹的控制台日志**: 日志系统不再向酒馆聊天变量中写入任何数据，避免了性能问题和数据污染。\n */\n/**\n * @type {{mk: string}}\n * @description 一个用于在事件处理期间临时存储日志上下文（如 Message Key）的对象。\n */\nconst logContext = {\n    mk: '',\n};\nclass Logger {\n    /**\n     * @private\n     * @property {string} moduleName - 该 Logger 实例绑定的模块名称。\n     * @description\n     * 命名规则:\n     * 为了方便在日志中快速定位来源，模块名应遵循 `目录-子目录-...-文件名` 的格式。\n     * 例如，位于 `src/ERA变量框架/core/crud/insert/insert.ts` 的文件，\n     * 其模块名应为 `core-crud-insert-insert`。\n     */\n    moduleName;\n    /**\n     * 创建一个新的 Logger 实例。\n     * @param {string} moduleName - 该 Logger 实例绑定的模块名称。\n     */\n    constructor(moduleName) {\n        this.moduleName = moduleName;\n    }\n    /**\n     * 格式化日志消息。\n     * @param {string} funcName - 调用日志的函数名。\n     * @param {any} message - 日志内容。\n     * @returns {string} 格式化后的日志字符串。\n     */\n    formatMessage(funcName, message) {\n        const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n        return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n    }\n    /**\n     * 记录一条 debug 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    debug(funcName, message, obj) {\n        // 1. 全局级别检查\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.debug)\n            return;\n        // 2. 白名单检查 (仅对 debug 生效)\n        if (LOG_CONFIG.currentLevel === LOG_CONFIG.levels.debug && !LOG_CONFIG.debugWhitelist.includes(this.moduleName)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.debug(formattedMessage, obj);\n        }\n        else {\n            console.debug(formattedMessage);\n        }\n    }\n    /**\n     * 记录一条 log 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    log(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.log)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n        }\n        else {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;');\n        }\n    }\n    /**\n     * 记录一条 warn 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    warn(funcName, message, obj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.warn)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n        }\n        else {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n        }\n    }\n    /**\n     * 记录一条 error 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [errorObj] - 可选的、附加到日志中的错误对象。\n     */\n    error(funcName, message, errorObj) {\n        if (LOG_CONFIG.currentLevel > LOG_CONFIG.levels.error)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (errorObj) {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n        }\n        else {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixFQUFFLEVBQUUsb0NBQW9DLENBQUMsQ0FBQztRQUMvRSxDQUFDO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvbG9nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOaXpeW/l+iusOW9leaooeWdl1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBAY29uc3RhbnQge29iamVjdH0gTE9HX0NPTkZJR1xuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7mjqfliLbml6Xlv5fovpPlh7rnmoTphY3nva7lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IExPR19DT05GSUcgPSB7XG4gIC8vIOWumuS5ieaJgOacieWPr+eUqOeahOaXpeW/l+e6p+WIq+WPiuWFtuadg+mHjeOAguaVsOWtl+i2iuWwj++8jOe6p+WIq+i2iuS9juOAglxuICBsZXZlbHM6IHtcbiAgICBkZWJ1ZzogMCxcbiAgICBsb2c6IDEsXG4gICAgd2FybjogMixcbiAgICBlcnJvcjogMyxcbiAgfSxcblxuICAvLyDorr7nva7lvZPliY3lhajlsYDml6Xlv5fnuqfliKvjgILlj6rmnInmnYPph43nrYnkuo7miJbpq5jkuo7mraTnuqfliKvnmoTml6Xlv5fmiY3kvJrooqvovpPlh7rjgIJcbiAgY3VycmVudExldmVsOiAwLCAvLyDpu5jorqTkuLogJ2RlYnVnJ1xuXG4gIC8vICdkZWJ1Zycg57qn5Yir55qE55m95ZCN5Y2V44CC5Y+q5pyJ5b2TIGN1cnJlbnRMZXZlbCDkuLogZGVidWcg5pe277yM5q2k5YiX6KGo5omN55Sf5pWI44CCXG4gIC8vIOWPquacieWcqOatpOWIl+ihqOS4reeahOaooeWdl+aJjeS8mui+k+WHuiBkZWJ1ZyDml6Xlv5fjgIJcbiAgZGVidWdXaGl0ZWxpc3Q6IFtcbiAgICAnYXBpLWNvbW1hbmQnLFxuICAgICdhcGktbWFjcm8tcGFyc2VyJyxcbiAgICAnYXBpLW1hY3JvLXBhdGNoJyxcbiAgICAnY29yZS1yb2xsYmFjaycsXG4gICAgJ2NvcmUtc3luYycsXG4gICAgLy8nY29yZS1jcnVkLWRlbGV0ZScsXG4gICAgLy8nY29yZS1jcnVkLXVwZGF0ZScsXG4gICAgJ2NvcmUtY3J1ZC1wYXRjaGVyJyxcbiAgICAnY29yZS1jcnVkLWluc2VydC1pbnNlcnQnLFxuICAgIC8vJ2NvcmUtY3J1ZC1pbnNlcnQtdGVtcGxhdGUnLFxuICAgIC8vJ2NvcmUta2V5LW1rJyxcbiAgICAnZXZlbnRzLWRpc3BhdGNoZXInLFxuICAgICdldmVudHMtcXVldWUnLFxuICAgICdldmVudHMtbWVyZ2VyJyxcbiAgICAndXRpbHMtbWVzc2FnZScsXG4gICAgJ3VpLWNvbXBvbmVudHMtc3RhdHVzQmFyQ29udGVudCcsXG4gIF0gYXMgc3RyaW5nW10sXG59O1xuLy8g5Yid5aeL5YyW5pe25bCGIGN1cnJlbnRMZXZlbCDorr7nva7kuLogZGVidWcg57qn5YirXG5MT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA9IExPR19DT05GSUcubGV2ZWxzLmRlYnVnO1xuXG4vKipcbiAqIEBjbGFzcyBMb2dnZXJcbiAqIEBkZXNjcmlwdGlvbiDkuIDkuKrkuLogRVJBIOahhuaetuiuvuiuoeeahOOAgeaUr+aMgeaXpeW/l+WIhue6p+eahOiusOW9leWZqOOAglxuICpcbiAqICoq5qC45b+D5Yqf6IO9Kio6XG4gKiAxLiAqKuaXpeW/l+WIhue6pyoqOiDmj5DkvpsgYGRlYnVnYCwgYGxvZ2AsIGB3YXJuYCwgYGVycm9yYCDlm5vkuKrnuqfliKvvvIzmlrnkvr/ov4fmu6TlkozlrprkvY3pl67popjjgIJcbiAqIDIuICoq57uf5LiA5qC85byPKio6IOaJgOacieaXpeW/l+mDvemBteW+qiBg44CKRVJB44CL44CM5qih5Z2X5ZCN44CN44CQ5Ye95pWw5ZCN44CR5pel5b+X5YaF5a65YCDnmoTmoLzlvI/vvIzmuIXmmbDmmI7kuobjgIJcbiAqIDMuICoq5o6n5Yi25Y+w6L6T5Ye6Kio6IOaXpeW/l+S8muagueaNrue6p+WIq+S9v+eUqOS4jeWQjOminOiJsuWSjOagt+W8j+eahCBgY29uc29sZWAg5pa55rOV6L6T5Ye677yM5L6/5LqO5Zyo5rWP6KeI5Zmo5Lit5a6e5pe26LCD6K+V44CCXG4gKiA0LiAqKue6r+eyueeahOaOp+WItuWPsOaXpeW/lyoqOiDml6Xlv5fns7vnu5/kuI3lho3lkJHphZLppobogYrlpKnlj5jph4/kuK3lhpnlhaXku7vkvZXmlbDmja7vvIzpgb/lhY3kuobmgKfog73pl67popjlkozmlbDmja7msaHmn5PjgIJcbiAqL1xuLyoqXG4gKiBAdHlwZSB7e21rOiBzdHJpbmd9fVxuICogQGRlc2NyaXB0aW9uIOS4gOS4queUqOS6juWcqOS6i+S7tuWkhOeQhuacn+mXtOS4tOaXtuWtmOWCqOaXpeW/l+S4iuS4i+aWh++8iOWmgiBNZXNzYWdlIEtlee+8ieeahOWvueixoeOAglxuICovXG5leHBvcnQgY29uc3QgbG9nQ29udGV4dCA9IHtcbiAgbWs6ICcnLFxufTtcblxuZXhwb3J0IGNsYXNzIExvZ2dlciB7XG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbW9kdWxlTmFtZSAtIOivpSBMb2dnZXIg5a6e5L6L57uR5a6a55qE5qih5Z2X5ZCN56ew44CCXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiDlkb3lkI3op4TliJk6XG4gICAqIOS4uuS6huaWueS+v+WcqOaXpeW/l+S4reW/q+mAn+WumuS9jeadpea6kO+8jOaooeWdl+WQjeW6lOmBteW+qiBg55uu5b2VLeWtkOebruW9lS0uLi4t5paH5Lu25ZCNYCDnmoTmoLzlvI/jgIJcbiAgICog5L6L5aaC77yM5L2N5LqOIGBzcmMvRVJB5Y+Y6YeP5qGG5p62L2NvcmUvY3J1ZC9pbnNlcnQvaW5zZXJ0LnRzYCDnmoTmlofku7bvvIxcbiAgICog5YW25qih5Z2X5ZCN5bqU5Li6IGBjb3JlLWNydWQtaW5zZXJ0LWluc2VydGDjgIJcbiAgICovXG4gIHByaXZhdGUgbW9kdWxlTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiDliJvlu7rkuIDkuKrmlrDnmoQgTG9nZ2VyIOWunuS+i+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kdWxlTmFtZSAtIOivpSBMb2dnZXIg5a6e5L6L57uR5a6a55qE5qih5Z2X5ZCN56ew44CCXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihtb2R1bGVOYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLm1vZHVsZU5hbWUgPSBtb2R1bGVOYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIOagvOW8j+WMluaXpeW/l+a2iOaBr+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDosIPnlKjml6Xlv5fnmoTlh73mlbDlkI3jgIJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcbiAgICogQHJldHVybnMge3N0cmluZ30g5qC85byP5YyW5ZCO55qE5pel5b+X5a2X56ym5Liy44CCXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdE1lc3NhZ2UoZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCBta1N0cmluZyA9IGxvZ0NvbnRleHQubWsgPyBg77yIJHtsb2dDb250ZXh0Lm1rfe+8iWAgOiAnJztcbiAgICByZXR1cm4gYOOAikVSQeOAiyR7bWtTdHJpbmd944CMJHt0aGlzLm1vZHVsZU5hbWV944CN44CQJHtmdW5jTmFtZX3jgJEke1N0cmluZyhtZXNzYWdlKX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIOiusOW9leS4gOadoSBkZWJ1ZyDnuqfliKvnmoTml6Xlv5fjgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g5Ye95pWw5ZCN44CCXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXG4gICAqIEBwYXJhbSB7YW55fSBbb2JqXSAtIOWPr+mAieeahOOAgemZhOWKoOWIsOaXpeW/l+S4reeahOWvueixoeOAglxuICAgKi9cbiAgZGVidWcoZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBvYmo/OiBhbnkpIHtcbiAgICAvLyAxLiDlhajlsYDnuqfliKvmo4Dmn6VcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPiBMT0dfQ09ORklHLmxldmVscy5kZWJ1ZykgcmV0dXJuO1xuICAgIC8vIDIuIOeZveWQjeWNleajgOafpSAo5LuF5a+5IGRlYnVnIOeUn+aViClcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPT09IExPR19DT05GSUcubGV2ZWxzLmRlYnVnICYmICFMT0dfQ09ORklHLmRlYnVnV2hpdGVsaXN0LmluY2x1ZGVzKHRoaXMubW9kdWxlTmFtZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAob2JqKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGZvcm1hdHRlZE1lc3NhZ2UsIG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiusOW9leS4gOadoSBsb2cg57qn5Yir55qE5pel5b+X44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxuICAgKiBAcGFyYW0ge2FueX0gW29ial0gLSDlj6/pgInnmoTjgIHpmYTliqDliLDml6Xlv5fkuK3nmoTlr7nosaHjgIJcbiAgICovXG4gIGxvZyhmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA+IExPR19DT05GSUcubGV2ZWxzLmxvZykgcmV0dXJuO1xuXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XG4gICAgaWYgKG9iaikge1xuICAgICAgY29uc29sZS5sb2coYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogIzM0OThkYjsnLCBvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjMzQ5OGRiOycpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDorrDlvZXkuIDmnaEgd2FybiDnuqfliKvnmoTml6Xlv5fjgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g5Ye95pWw5ZCN44CCXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXG4gICAqIEBwYXJhbSB7YW55fSBbb2JqXSAtIOWPr+mAieeahOOAgemZhOWKoOWIsOaXpeW/l+S4reeahOWvueixoeOAglxuICAgKi9cbiAgd2FybihmdW5jTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBhbnksIG9iaj86IGFueSkge1xuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA+IExPR19DT05GSUcubGV2ZWxzLndhcm4pIHJldHVybjtcblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChvYmopIHtcbiAgICAgIGNvbnNvbGUud2FybihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZjM5YzEyOycsIG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZjM5YzEyOycpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDorrDlvZXkuIDmnaEgZXJyb3Ig57qn5Yir55qE5pel5b+X44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxuICAgKiBAcGFyYW0ge2FueX0gW2Vycm9yT2JqXSAtIOWPr+mAieeahOOAgemZhOWKoOWIsOaXpeW/l+S4reeahOmUmeivr+WvueixoeOAglxuICAgKi9cbiAgZXJyb3IoZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBlcnJvck9iaj86IGFueSkge1xuICAgIGlmIChMT0dfQ09ORklHLmN1cnJlbnRMZXZlbCA+IExPR19DT05GSUcubGV2ZWxzLmVycm9yKSByZXR1cm47XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAoZXJyb3JPYmopIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2U3NGMzYzsgZm9udC13ZWlnaHQ6IGJvbGQ7JywgZXJyb3JPYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNlNzRjM2M7IGZvbnQtd2VpZ2h0OiBib2xkOycpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/log.ts\n\n}");
  },
  "./src/ERA变量框架/utils/message.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/utils/message.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastAiMessage: () => (/* binding */ findLastAiMessage),\n/* harmony export */   getMessageContent: () => (/* binding */ getMessageContent),\n/* harmony export */   isUserMessage: () => (/* binding */ isUserMessage),\n/* harmony export */   updateMessageContent: () => (/* binding */ updateMessageContent)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/utils/constants.ts\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./log */ \"./src/ERA变量框架/utils/log.ts\");\n/* harmony import */ var _text__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./text */ \"./src/ERA变量框架/utils/text.ts\");\n/**\n * @file ERA 变量框架 - 消息处理模块\n * @description\n * 该文件提供了一系列用于处理、查询和更新酒馆消息对象的通用辅助函数。\n */\n\n\n\n\nconst log = new _log__WEBPACK_IMPORTED_MODULE_1__.Logger('utils-message');\n// ==================================================================\n// 消息读取与解析\n// ==================================================================\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nfunction getMessageContent(msg) {\n    if (!msg)\n        return null;\n    let content = null;\n    // 优先检查 .mes 属性，这是新版酒馆的规范\n    if (typeof msg.mes === 'string') {\n        content = msg.mes;\n    }\n    // 如果没有 .mes，则处理 swipes\n    else if (Array.isArray(msg.swipes)) {\n        const sid = Number(msg.swipe_id ?? 0);\n        content = msg.swipes[sid] || null;\n    }\n    // 最后，作为兼容，检查旧版的 .message 属性\n    else if (typeof msg.message === 'string') {\n        content = msg.message;\n    }\n    if (content === null) {\n        return null;\n    }\n    // 在返回内容前进行宏替换。\n    // 这样做是因为酒馆自身的宏替换行为不一致：有时（如消息流式生成后）会替换，\n    // 但有时（如聊天记录刚加载时）则不会，这会导致读取到的内容状态混乱。\n    // 因此，我们统一在获取消息时手动执行一次宏替换，以确保数据的一致性。\n    return (0,_text__WEBPACK_IMPORTED_MODULE_2__.parseCharacterMacros)(content);\n}\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            const eraData = {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n            log.debug('parseEraData', '成功解析 EraData', eraData);\n            return eraData;\n        }\n        log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n        return null;\n    }\n    catch (e) {\n        log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n        return null;\n    }\n}\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nfunction isUserMessage(msg) {\n    const content = getMessageContent(msg);\n    const data = parseEraData(content);\n    if (data) {\n        return data['era-message-type'] === 'user';\n    }\n    // 回退到检查 role 属性\n    return msg?.role === 'user';\n}\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nfunction findLastAiMessage() {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    if (!messages || messages.length === 0) {\n        log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n        return null;\n    }\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const msg = messages[i];\n        if (!isUserMessage(msg)) {\n            log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n            return msg;\n        }\n    }\n    log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n    return null;\n}\n// ==================================================================\n// 消息写入\n// ==================================================================\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n */\nasync function updateMessageContent(message, newContent) {\n    const oldContent = getMessageContent(message);\n    log.debug('updateMessageContent', '更新前的消息内容:', oldContent);\n    log.debug('updateMessageContent', '更新后的消息内容:', newContent);\n    const updatePayload = {\n        message_id: message.message_id,\n    };\n    if (Array.isArray(message.swipes)) {\n        const sid = Number(message.swipe_id ?? 0);\n        const newSwipes = [...message.swipes];\n        newSwipes[sid] = newContent;\n        updatePayload.swipes = newSwipes;\n    }\n    else {\n        updatePayload.message = newContent;\n    }\n    await setChatMessages([updatePayload], { refresh: 'none' });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvbWVzc2FnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lpITnkIbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25o+Q5L6b5LqG5LiA57O75YiX55So5LqO5aSE55CG44CB5p+l6K+i5ZKM5pu05paw6YWS6aaG5raI5oGv5a+56LGh55qE6YCa55So6L6F5Yqp5Ye95pWw44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfREFUQV9SRUdFWCB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vbG9nJztcbmltcG9ydCB7IHBhcnNlQ2hhcmFjdGVyTWFjcm9zIH0gZnJvbSAnLi90ZXh0JztcblxuY29uc3QgbG9nID0gbmV3IExvZ2dlcigndXRpbHMtbWVzc2FnZScpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5raI5oGv6K+75Y+W5LiO6Kej5p6QXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiAqKuOAkOiOt+WPlua2iOaBr+WGheWuueOAkSoqIOS7jumFkummhueahOa2iOaBr+WvueixoeS4reWuieWFqOWcsOaPkOWPluW9k+WJjea/gOa0u++8iOiiq+mAieS4re+8ieeahOa2iOaBr+WGheWuueWtl+espuS4suOAglxuICog6L+Z5Liq5Ye95pWw5pivIEVSQSDkuK3miYDmnInmtojmga/lhoXlrrnor7vlj5bnmoTllK/kuIDlhaXlj6PvvIzku6Xnoa7kv53pgLvovpHnu5/kuIDlkozlgaXlo67mgKfjgIJcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nIHwgbnVsbH0g5b2T5YmN5r+A5rS755qE5raI5oGv5YaF5a6577yb5aaC5p6c5peg5rOV6I635Y+W77yM5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1lc3NhZ2VDb250ZW50KG1zZzogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghbXNnKSByZXR1cm4gbnVsbDtcblxuICBsZXQgY29udGVudDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgLy8g5LyY5YWI5qOA5p+lIC5tZXMg5bGe5oCn77yM6L+Z5piv5paw54mI6YWS6aaG55qE6KeE6IyDXG4gIGlmICh0eXBlb2YgbXNnLm1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICBjb250ZW50ID0gbXNnLm1lcztcbiAgfVxuICAvLyDlpoLmnpzmsqHmnIkgLm1lc++8jOWImeWkhOeQhiBzd2lwZXNcbiAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtc2cuc3dpcGVzKSkge1xuICAgIGNvbnN0IHNpZCA9IE51bWJlcihtc2cuc3dpcGVfaWQgPz8gMCk7XG4gICAgY29udGVudCA9IG1zZy5zd2lwZXNbc2lkXSB8fCBudWxsO1xuICB9XG4gIC8vIOacgOWQju+8jOS9nOS4uuWFvOWuue+8jOajgOafpeaXp+eJiOeahCAubWVzc2FnZSDlsZ7mgKdcbiAgZWxzZSBpZiAodHlwZW9mIG1zZy5tZXNzYWdlID09PSAnc3RyaW5nJykge1xuICAgIGNvbnRlbnQgPSBtc2cubWVzc2FnZTtcbiAgfVxuXG4gIGlmIChjb250ZW50ID09PSBudWxsKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyDlnKjov5Tlm57lhoXlrrnliY3ov5vooYzlro/mm7/mjaLjgIJcbiAgLy8g6L+Z5qC35YGa5piv5Zug5Li66YWS6aaG6Ieq6Lqr55qE5a6P5pu/5o2i6KGM5Li65LiN5LiA6Ie077ya5pyJ5pe277yI5aaC5raI5oGv5rWB5byP55Sf5oiQ5ZCO77yJ5Lya5pu/5o2i77yMXG4gIC8vIOS9huacieaXtu+8iOWmguiBiuWkqeiusOW9leWImuWKoOi9veaXtu+8ieWImeS4jeS8mu+8jOi/meS8muWvvOiHtOivu+WPluWIsOeahOWGheWuueeKtuaAgea3t+S5seOAglxuICAvLyDlm6DmraTvvIzmiJHku6znu5/kuIDlnKjojrflj5bmtojmga/ml7bmiYvliqjmiafooYzkuIDmrKHlro/mm7/mjaLvvIzku6Xnoa7kv53mlbDmja7nmoTkuIDoh7TmgKfjgIJcbiAgcmV0dXJuIHBhcnNlQ2hhcmFjdGVyTWFjcm9zKGNvbnRlbnQpO1xufVxuXG4vKipcbiAqIOS7jua2iOaBr+WGheWuueWtl+espuS4suS4reino+aekOWHuiBgRXJhRGF0YWAg5a+56LGh44CC6L+Z5piv5LiA5Liq5Y+q6K+75pON5L2c44CCXG4gKiBAcGFyYW0ge3N0cmluZyB8IG51bGwgfCB1bmRlZmluZWR9IG1lc3NhZ2VDb250ZW50IC0g5raI5oGv55qE5YaF5a655a2X56ym5Liy44CCXG4gKiBAcmV0dXJucyB7RXJhRGF0YSB8IG51bGx9IOino+aekOaIkOWKn+WImei/lOWbniBgRXJhRGF0YWAg5a+56LGh77yM5ZCm5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuZnVuY3Rpb24gcGFyc2VFcmFEYXRhKG1lc3NhZ2VDb250ZW50OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogRXJhRGF0YSB8IG51bGwge1xuICBpZiAodHlwZW9mIG1lc3NhZ2VDb250ZW50ICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gbWVzc2FnZUNvbnRlbnQubWF0Y2goRVJBX0RBVEFfUkVHRVgpO1xuICBpZiAoIW1hdGNoIHx8ICFtYXRjaFsxXSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHRyeSB7XG4gICAgLy8g55Sx5LqOIE1LIOWdl+WGhemDqOaYr+iHquWumuS5ieeahCBge1wia2V5XCI9XCJ2YWx1ZVwifWAg5qC85byP77yM5LiN6IO95L2/55SoIEpTT04ucGFyc2XjgIJcbiAgICAvLyDlv4Xpobvkvb/nlKjmraPliJnooajovr7lvI/ov5vooYzlrr3mnb7ljLnphY3mnaXmj5Dlj5bplK7lgLzjgIJcbiAgICBjb25zdCBjdXN0b21Gb3JtYXRCbG9jayA9IG1hdGNoWzFdO1xuICAgIGNvbnN0IGtleU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2Uta2V5XCJcXHMqPVxccypcIiguKj8pXCIvKTtcbiAgICBjb25zdCB0eXBlTWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS10eXBlXCJcXHMqPVxccypcIiguKj8pXCIvKTtcblxuICAgIGlmIChrZXlNYXRjaD8uWzFdICYmIHR5cGVNYXRjaD8uWzFdKSB7XG4gICAgICBjb25zdCBlcmFEYXRhID0ge1xuICAgICAgICAnZXJhLW1lc3NhZ2Uta2V5Jzoga2V5TWF0Y2hbMV0sXG4gICAgICAgICdlcmEtbWVzc2FnZS10eXBlJzogdHlwZU1hdGNoWzFdIGFzICd1c2VyJyB8ICdhc3Npc3RhbnQnLFxuICAgICAgfTtcbiAgICAgIGxvZy5kZWJ1ZygncGFyc2VFcmFEYXRhJywgJ+aIkOWKn+ino+aekCBFcmFEYXRhJywgZXJhRGF0YSk7XG4gICAgICByZXR1cm4gZXJhRGF0YTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKCdwYXJzZUVyYURhdGEnLCAn5pyq6IO95ZyoIEVyYURhdGEg5Z2X5Lit5om+5Yiw5a6M5pW055qE6ZSu5YC85a+5JywgeyBjdXN0b21Gb3JtYXRCbG9jayB9KTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy53YXJuKCdwYXJzZUVyYURhdGEnLCAn6Kej5p6QIEVyYURhdGEg5Z2X5pe25Y+R55Sf5byC5bi4JywgZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiAqKuOAkOWIpOaWrea2iOaBr+exu+Wei+OAkSoqIOagueaNrua2iOaBr+WGheWuueS4reeahCBgZXJhLW1lc3NhZ2UtdHlwZWAg5YWD5pWw5o2u5oiWIGByb2xlYCDlsZ7mgKfliKTmlq3mmK/lkKbkuLrnlKjmiLfmtojmga/jgIJcbiAqIOS8mOWFiOS/oeS7u+azqOWFpeeahOWFg+aVsOaNruOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtib29sZWFufSDlpoLmnpzmmK/nlKjmiLfmtojmga/vvIzliJnov5Tlm54gdHJ1ZeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNVc2VyTWVzc2FnZShtc2c6IGFueSk6IGJvb2xlYW4ge1xuICBjb25zdCBjb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobXNnKTtcbiAgY29uc3QgZGF0YSA9IHBhcnNlRXJhRGF0YShjb250ZW50KTtcbiAgaWYgKGRhdGEpIHtcbiAgICByZXR1cm4gZGF0YVsnZXJhLW1lc3NhZ2UtdHlwZSddID09PSAndXNlcic7XG4gIH1cbiAgLy8g5Zue6YCA5Yiw5qOA5p+lIHJvbGUg5bGe5oCnXG4gIHJldHVybiBtc2c/LnJvbGUgPT09ICd1c2VyJztcbn1cblxuLyoqXG4gKiDku47lkI7lkJHliY3mn6Xmib7lubbov5Tlm57mnIDlkI7kuIDmnaEgQUkg5raI5oGv44CCXG4gKiBAcmV0dXJucyB7VGF2ZXJuTWVzc2FnZSB8IG51bGx9IOaJvuWIsOeahCBBSSDmtojmga/lr7nosaHvvIzlpoLmnpzmib7kuI3liLDliJnov5Tlm54gbnVsbOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZmluZExhc3RBaU1lc3NhZ2UoKTogYW55IHwgbnVsbCB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19JywgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KTtcbiAgaWYgKCFtZXNzYWdlcyB8fCBtZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgJ+iBiuWkqeiusOW9leS4uuepuiwg5pyq5om+5Yiw5Lu75L2V5raI5oGv44CCJyk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmb3IgKGxldCBpID0gbWVzc2FnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBtc2cgPSBtZXNzYWdlc1tpXTtcbiAgICBpZiAoIWlzVXNlck1lc3NhZ2UobXNnKSkge1xuICAgICAgbG9nLmRlYnVnKCdmaW5kTGFzdEFpTWVzc2FnZScsIGDmib7liLDmnIDlkI7kuIDmnaEgQUkg5raI5oGvLCBJRDogJHttc2cubWVzc2FnZV9pZH1gKTtcbiAgICAgIHJldHVybiBtc2c7XG4gICAgfVxuICB9XG5cbiAgbG9nLmRlYnVnKCdmaW5kTGFzdEFpTWVzc2FnZScsICfmnKrlnKjogYrlpKnorrDlvZXkuK3mib7liLDku7vkvZUgQUkg5raI5oGv44CCJyk7XG4gIHJldHVybiBudWxsO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOa2iOaBr+WGmeWFpVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDpgJrnlKjjgJEqKiDmm7TmlrDmjIflrprmtojmga/nmoTlhoXlrrnjgIJcbiAqIOi/meS4qui+heWKqeWHveaVsOWwgeijheS6huWkhOeQhiBgc3dpcGVzYCDlkozmma7pgJogYG1lc3NhZ2VgIOeahOmAu+i+ke+8jOaPkOS+m+S4gOS4que7n+S4gOeahOWGmeWFpeaOpeWPo+OAglxuICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDopoHmm7TmlrDnmoTmtojmga/lr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdDb250ZW50IC0g5YWo5paw55qE5raI5oGv5YaF5a6544CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVNZXNzYWdlQ29udGVudChtZXNzYWdlOiBhbnksIG5ld0NvbnRlbnQ6IHN0cmluZykge1xuICBjb25zdCBvbGRDb250ZW50ID0gZ2V0TWVzc2FnZUNvbnRlbnQobWVzc2FnZSk7XG4gIGxvZy5kZWJ1ZygndXBkYXRlTWVzc2FnZUNvbnRlbnQnLCAn5pu05paw5YmN55qE5raI5oGv5YaF5a65OicsIG9sZENvbnRlbnQpO1xuICBsb2cuZGVidWcoJ3VwZGF0ZU1lc3NhZ2VDb250ZW50JywgJ+abtOaWsOWQjueahOa2iOaBr+WGheWuuTonLCBuZXdDb250ZW50KTtcblxuICBjb25zdCB1cGRhdGVQYXlsb2FkOiB7IG1lc3NhZ2VfaWQ6IG51bWJlcjsgbWVzc2FnZT86IHN0cmluZzsgc3dpcGVzPzogc3RyaW5nW10gfSA9IHtcbiAgICBtZXNzYWdlX2lkOiBtZXNzYWdlLm1lc3NhZ2VfaWQsXG4gIH07XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkobWVzc2FnZS5zd2lwZXMpKSB7XG4gICAgY29uc3Qgc2lkID0gTnVtYmVyKG1lc3NhZ2Uuc3dpcGVfaWQgPz8gMCk7XG4gICAgY29uc3QgbmV3U3dpcGVzID0gWy4uLm1lc3NhZ2Uuc3dpcGVzXTtcbiAgICBuZXdTd2lwZXNbc2lkXSA9IG5ld0NvbnRlbnQ7XG4gICAgdXBkYXRlUGF5bG9hZC5zd2lwZXMgPSBuZXdTd2lwZXM7XG4gIH0gZWxzZSB7XG4gICAgdXBkYXRlUGF5bG9hZC5tZXNzYWdlID0gbmV3Q29udGVudDtcbiAgfVxuXG4gIGF3YWl0IHNldENoYXRNZXNzYWdlcyhbdXBkYXRlUGF5bG9hZF0sIHsgcmVmcmVzaDogJ25vbmUnIH0pO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/message.ts\n\n}");
  },
  "./src/ERA变量框架/utils/string.ts": 
  /*!*************************************!*\
  !*** ./src/ERA变量框架/utils/string.ts ***!
  \*************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractBlocks: () => (/* binding */ extractBlocks),\n/* harmony export */   rnd: () => (/* binding */ rnd),\n/* harmony export */   stripCodeFence: () => (/* binding */ stripCodeFence)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 字符串处理模块\n */\n\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * 基于 `Math.random()`，在同一毫秒内也能保证极高的唯一性。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nfunction rnd() {\n    return Math.random().toString(36).slice(2, 8);\n}\n/**\n * 从文本中提取所有被特定 XML 风格标签包裹的内容块。\n * 使用非贪婪模式的正则表达式，但不处理嵌套标签。\n * @param {string} text - 包含标签的原始文本。\n * @param {string} tag - 要提取的标签名称（例如 'VariableEdit'）。\n * @returns {string[]} 包含所有提取并清理后（去除代码围栏和首尾空格）的内容块的数组。\n */\nfunction extractBlocks(text, tag) {\n    const blocks = [];\n    // 正则表达式: /<tag>([\\s\\S]*?)<\\/tag>/g\n    // - <${tag}>: 匹配开标签。\n    // - ([\\s\\S]*?): 非贪婪地捕获开闭标签之间的所有字符（包括换行符）。\n    // - <\\/${tag}>: 匹配闭标签。\n    // - g: 全局匹配，以找到所有匹配项。\n    const re = new RegExp(`<${tag}>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'g');\n    let m;\n    while ((m = re.exec(text))) {\n        const rawBody = (m[1] || '').trim();\n        // 在存入前，先剥离AI可能生成的多余代码围栏。\n        const body = stripCodeFence(rawBody);\n        if (body)\n            blocks.push(body);\n    }\n    return blocks;\n}\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nfunction stripCodeFence(s) {\n    if (!s)\n        return s;\n    let t = String(s).trim();\n    // 移除起始围栏，例如 ```json, ```, ~~~\n    t = t.replace(/^\\s*(?:```|~~~)\\[a-zA-Z0-9_-\\]*\\s*\\r?\\n/, '');\n    // 移除结束围栏\n    t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n    return t.trim();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3N0cmluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7R0FFRztBQUVVO0FBRWI7Ozs7R0FJRztBQUNJLFNBQVMsR0FBRztJQUNqQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0ksU0FBUyxhQUFhLENBQUMsSUFBWSxFQUFFLEdBQVc7SUFDckQsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBQzVCLG1DQUFtQztJQUNuQyxxQkFBcUI7SUFDckIsMENBQTBDO0lBQzFDLHVCQUF1QjtJQUN2QixzQkFBc0I7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxHQUFHLG9CQUFvQixHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5RCxJQUFJLENBQUMsQ0FBQztJQUNOLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDM0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDcEMseUJBQXlCO1FBQ3pCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLElBQUk7WUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNJLFNBQVMsY0FBYyxDQUFDLENBQVM7SUFDdEMsSUFBSSxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsOEJBQThCO0lBQzlCLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLHlDQUF5QyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELFNBQVM7SUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQixDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvdXRpbHMvc3RyaW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWtl+espuS4suWkhOeQhuaooeWdl1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiDnlJ/miJDkuIDkuKrmjIflrprplb/luqbnmoTpmo/mnLrlrZfnrKbkuLLvvIznlKjkvZzllK/kuIDmoIfor4bnrKbjgIJcbiAqIOWfuuS6jiBgTWF0aC5yYW5kb20oKWDvvIzlnKjlkIzkuIDmr6vnp5LlhoXkuZ/og73kv53or4HmnoHpq5jnmoTllK/kuIDmgKfjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS4gOS4qumaj+acuueahOOAgeeUseaVsOWtl+WSjOWwj+WGmeWtl+avjee7hOaIkOeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcm5kKCk6IHN0cmluZyB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KTtcbn1cblxuLyoqXG4gKiDku47mlofmnKzkuK3mj5Dlj5bmiYDmnInooqvnibnlrpogWE1MIOmjjuagvOagh+etvuWMheijueeahOWGheWuueWdl+OAglxuICog5L2/55So6Z2e6LSq5amq5qih5byP55qE5q2j5YiZ6KGo6L6+5byP77yM5L2G5LiN5aSE55CG5bWM5aWX5qCH562+44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIOWMheWQq+agh+etvueahOWOn+Wni+aWh+acrOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHRhZyAtIOimgeaPkOWPlueahOagh+etvuWQjeensO+8iOS+i+WmgiAnVmFyaWFibGVFZGl0J++8ieOAglxuICogQHJldHVybnMge3N0cmluZ1tdfSDljIXlkKvmiYDmnInmj5Dlj5blubbmuIXnkIblkI7vvIjljrvpmaTku6PnoIHlm7TmoI/lkozpppblsL7nqbrmoLzvvInnmoTlhoXlrrnlnZfnmoTmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RCbG9ja3ModGV4dDogc3RyaW5nLCB0YWc6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmxvY2tzOiBzdHJpbmdbXSA9IFtdO1xuICAvLyDmraPliJnooajovr7lvI86IC88dGFnPihbXFxzXFxTXSo/KTxcXC90YWc+L2dcbiAgLy8gLSA8JHt0YWd9Pjog5Yy56YWN5byA5qCH562+44CCXG4gIC8vIC0gKFtcXHNcXFNdKj8pOiDpnZ7otKrlqarlnLDmjZXojrflvIDpl63moIfnrb7kuYvpl7TnmoTmiYDmnInlrZfnrKbvvIjljIXmi6zmjaLooYznrKbvvInjgIJcbiAgLy8gLSA8XFwvJHt0YWd9Pjog5Yy56YWN6Zet5qCH562+44CCXG4gIC8vIC0gZzog5YWo5bGA5Yy56YWN77yM5Lul5om+5Yiw5omA5pyJ5Yy56YWN6aG544CCXG4gIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChgPCR7dGFnfT4oW1xcXFxzXFxcXFNdKj8pPFxcXFwvJHt0YWd9PmAsICdnJyk7XG4gIGxldCBtO1xuICB3aGlsZSAoKG0gPSByZS5leGVjKHRleHQpKSkge1xuICAgIGNvbnN0IHJhd0JvZHkgPSAobVsxXSB8fCAnJykudHJpbSgpO1xuICAgIC8vIOWcqOWtmOWFpeWJje+8jOWFiOWJpeemu0FJ5Y+v6IO955Sf5oiQ55qE5aSa5L2Z5Luj56CB5Zu05qCP44CCXG4gICAgY29uc3QgYm9keSA9IHN0cmlwQ29kZUZlbmNlKHJhd0JvZHkpO1xuICAgIGlmIChib2R5KSBibG9ja3MucHVzaChib2R5KTtcbiAgfVxuICByZXR1cm4gYmxvY2tzO1xufVxuXG4vKipcbiAqIOS7juWtl+espuS4suS4reenu+mZpCBBSSDnlJ/miJDnmoQgTWFya2Rvd24g5Luj56CB5Z2X5Zu05qCP77yI5aaCIGBgYGpzb24gLi4uIGBgYO+8ieOAglxuICogQHBhcmFtIHtzdHJpbmd9IHMgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOenu+mZpOWbtOagj+W5tuS/ruWJqummluWwvuepuuagvOWQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBDb2RlRmVuY2Uoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzKSByZXR1cm4gcztcbiAgbGV0IHQgPSBTdHJpbmcocykudHJpbSgpO1xuICAvLyDnp7vpmaTotbflp4vlm7TmoI/vvIzkvovlpoIgYGBganNvbiwgYGBgLCB+fn5cbiAgdCA9IHQucmVwbGFjZSgvXlxccyooPzpgYGB8fn5+KVxcW2EtekEtWjAtOV8tXFxdKlxccypcXHI/XFxuLywgJycpO1xuICAvLyDnp7vpmaTnu5PmnZ/lm7TmoI9cbiAgdCA9IHQucmVwbGFjZSgvXFxyP1xcbig/OmBgYHx+fn4pXFxzKiQvLCAnJyk7XG4gIHJldHVybiB0LnRyaW0oKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/string.ts\n\n}");
  },
  "./src/ERA变量框架/utils/text.ts": 
  /*!***********************************!*\
  !*** ./src/ERA变量框架/utils/text.ts ***!
  \***********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deepParseCharacterMacros: () => (/* binding */ deepParseCharacterMacros),\n/* harmony export */   parseCharacterMacros: () => (/* binding */ parseCharacterMacros)\n/* harmony export */ });\n/**\n * 解析字符串中的角色和用户宏, 并将其替换为对应的名称。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseCharacterMacros(text) {\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{')) {\n        return text;\n    }\n    let result = text;\n    // 使用全局不区分大小写的替换\n    if (result.includes('{{user}}')) {\n        result = result.replace(/{{user}}/gi, SillyTavern.name1);\n    }\n    if (result.includes('{{char}}')) {\n        result = result.replace(/{{char}}/gi, SillyTavern.name2);\n    }\n    return result;\n}\n/**\n * 深度遍历数据, 对所有字符串类型的值应用 parseCharacterMacros 宏替换。\n * @param data - 任何类型的数据。\n * @returns - 经过宏替换后的数据。\n */\nconst deepParseCharacterMacros = (data) => {\n    if (typeof data === 'string') {\n        return parseCharacterMacros(data);\n    }\n    if (Array.isArray(data)) {\n        return data.map(item => deepParseCharacterMacros(item));\n    }\n    if (typeof data === 'object' && data !== null) {\n        return Object.entries(data).reduce((acc, [key, value]) => {\n            acc[key] = deepParseCharacterMacros(value);\n            return acc;\n        }, {});\n    }\n    return data;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzL3RleHQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7R0FLRztBQUNJLFNBQVMsb0JBQW9CLENBQUMsSUFBWTtJQUMvQyw0QkFBNEI7SUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUN6QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDbEIsZ0JBQWdCO0lBQ2hCLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQ2hDLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUNELElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQ2hDLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRDs7OztHQUlHO0FBQ0ksTUFBTSx3QkFBd0IsR0FBRyxDQUFDLElBQVMsRUFBTyxFQUFFO0lBQ3pELElBQUksT0FBTyxJQUFJLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDN0IsT0FBTyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQ0QsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDeEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBQ0QsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLElBQUksSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDO1FBQzlDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQ2hDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUU7WUFDcEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLHdCQUF3QixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNDLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQyxFQUNELEVBQXlCLENBQzFCLENBQUM7SUFDSixDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti91dGlscy90ZXh0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog6Kej5p6Q5a2X56ym5Liy5Lit55qE6KeS6Imy5ZKM55So5oi35a6PLCDlubblsIblhbbmm7/mjaLkuLrlr7nlupTnmoTlkI3np7DjgIJcbiAqIOi/meaYr+aPkOS+m+e7meWFtuS7luaooeWdl+iwg+eUqOeahOWFrOWFseaOpeWPo+OAglxuICogQHBhcmFtIHRleHQgLSDljIXlkKvlro/nmoTovpPlhaXlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIC0g5pu/5o2i5a6P5ZCO55qE5a2X56ym5Liy44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNoYXJhY3Rlck1hY3Jvcyh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyDlpoLmnpzmlofmnKzkuK3kuI3ljIXlkKvlro/nibnlvoHlrZfnrKbkuLIsIOebtOaOpei/lOWbnuS7peS8mOWMluaAp+iDvVxuICBpZiAoIXRleHQuaW5jbHVkZXMoJ3t7JykpIHtcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIGxldCByZXN1bHQgPSB0ZXh0O1xuICAvLyDkvb/nlKjlhajlsYDkuI3ljLrliIblpKflsI/lhpnnmoTmm7/mjaJcbiAgaWYgKHJlc3VsdC5pbmNsdWRlcygne3t1c2VyfX0nKSkge1xuICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC97e3VzZXJ9fS9naSwgU2lsbHlUYXZlcm4ubmFtZTEpO1xuICB9XG4gIGlmIChyZXN1bHQuaW5jbHVkZXMoJ3t7Y2hhcn19JykpIHtcbiAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgve3tjaGFyfX0vZ2ksIFNpbGx5VGF2ZXJuLm5hbWUyKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIOa3seW6pumBjeWOhuaVsOaNriwg5a+55omA5pyJ5a2X56ym5Liy57G75Z6L55qE5YC85bqU55SoIHBhcnNlQ2hhcmFjdGVyTWFjcm9zIOWuj+abv+aNouOAglxuICogQHBhcmFtIGRhdGEgLSDku7vkvZXnsbvlnovnmoTmlbDmja7jgIJcbiAqIEByZXR1cm5zIC0g57uP6L+H5a6P5pu/5o2i5ZCO55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBjb25zdCBkZWVwUGFyc2VDaGFyYWN0ZXJNYWNyb3MgPSAoZGF0YTogYW55KTogYW55ID0+IHtcbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBwYXJzZUNoYXJhY3Rlck1hY3JvcyhkYXRhKTtcbiAgfVxuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xuICAgIHJldHVybiBkYXRhLm1hcChpdGVtID0+IGRlZXBQYXJzZUNoYXJhY3Rlck1hY3JvcyhpdGVtKSk7XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiBkYXRhICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZShcbiAgICAgIChhY2MsIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBhY2Nba2V5XSA9IGRlZXBQYXJzZUNoYXJhY3Rlck1hY3Jvcyh2YWx1ZSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LFxuICAgICAge30gYXMgUmVjb3JkPHN0cmluZywgYW55PixcbiAgICApO1xuICB9XG4gIHJldHVybiBkYXRhO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils/text.ts\n\n}");
  },
  jquery: 
  /*!********************!*\
  !*** external "$" ***!
  \********************/ module => {
    module.exports = $;
  },
  lodash: 
  /*!********************!*\
  !*** external "_" ***!
  \********************/ module => {
    module.exports = _;
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/ERA变量框架/index.ts");