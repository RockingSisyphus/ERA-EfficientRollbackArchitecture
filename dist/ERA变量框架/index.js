var __webpack_modules__ = {
  "./src/ERA变量框架/api.ts": 
  /*!****************************!*\
  !*** ./src/ERA变量框架/api.ts ***!
  \****************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteByObject: () => (/* binding */ deleteByObject),\n/* harmony export */   deleteByPath: () => (/* binding */ deleteByPath),\n/* harmony export */   emitWriteDoneEvent: () => (/* binding */ emitWriteDoneEvent),\n/* harmony export */   insertByObject: () => (/* binding */ insertByObject),\n/* harmony export */   insertByPath: () => (/* binding */ insertByPath),\n/* harmony export */   updateByObject: () => (/* binding */ updateByObject),\n/* harmony export */   updateByPath: () => (/* binding */ updateByPath)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_utils */ \"./src/ERA变量框架/message_utils.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_3__.Logger('api');\n// 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件\nconst debouncedEmitApiWrite = lodash__WEBPACK_IMPORTED_MODULE_0___default().debounce(() => {\n    eventEmit(_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n}, 700, { leading: false, trailing: true });\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job) {\n    // 1. 生成指令块\n    const contentString = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.J)(job.blockContent);\n    const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n    // 2. 查找目标消息并追加内容\n    const lastAiMessage = await (0,_message_utils__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!lastAiMessage) {\n        logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n        return;\n    }\n    const originalContent = (0,_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(lastAiMessage) ?? '';\n    const newContent = originalContent + block;\n    logger.log('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n    // 3. 实时更新消息内容\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_3__.updateMessageContent)(lastAiMessage, newContent);\n    // 4. 调用防抖函数来调度写入事件的发送\n    debouncedEmitApiWrite();\n}\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction insertByObject(data) {\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nfunction updateByObject(data) {\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction insertByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nfunction updateByPath(path, value) {\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, value);\n    performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nfunction deleteByObject(data) {\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nfunction deleteByPath(path) {\n    // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n    const block = lodash__WEBPACK_IMPORTED_MODULE_0___default().set({}, path, {});\n    performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）在 `variable_change_processor.ts` 中成功完成后，\n * 应调用此函数。它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {WriteDonePayload} payload - 包含写入操作关键信息的事件负载。\n * @example\n * // 这是一个在外部脚本中监听此事件的示例：\n * eventOn('era:writeDone', (detail) => {\n *   const { mk, message_id, actions, selectedMks, editLogs, stat, statWithoutMeta } = detail;\n *   console.log(`ERA 变量已更新！消息 ID: ${message_id}, MK: ${mk}`);\n *   console.log('执行的操作:', actions);\n *\n *   // 你可以根据需要使用 stat (带 meta) 或 statWithoutMeta (不带 meta)\n *   console.log('最新的纯净状态数据:', statWithoutMeta);\n *\n *   // 此时可以根据最新的状态数据更新你自己的 UI 或执行其他逻辑\n * });\n */\nfunction emitWriteDoneEvent(payload) {\n    // 在广播前，对需要暴露给外部的数据进行反转义\n    const unescapedPayload = {\n        ...payload,\n        stat: (0,_utils__WEBPACK_IMPORTED_MODULE_3__.unescapeEraData)(payload.stat),\n        statWithoutMeta: (0,_utils__WEBPACK_IMPORTED_MODULE_3__.unescapeEraData)(payload.statWithoutMeta),\n    };\n    logger.debug('emitWriteDoneEvent', 'writeDone事件广播数据反转义', {\n        before: { stat: payload.stat, statWithoutMeta: payload.statWithoutMeta },\n        after: { stat: unescapedPayload.stat, statWithoutMeta: unescapedPayload.statWithoutMeta },\n    });\n    eventEmit(_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE, unescapedPayload);\n    logger.log('emitWriteDoneEvent', `已触发 ${_constants__WEBPACK_IMPORTED_MODULE_1__.ERA_EVENT_EMITTER.WRITE_DONE} 事件。操作: ${JSON.stringify(payload.actions)}, MK: ${payload.mk}, MsgID: ${payload.message_id}`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFFLGdCQUFnQixDQUFDLGVBQWUsRUFBRTtLQUMxRixDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMseURBQWlCLENBQUMsVUFBVSxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDMUQsTUFBTSxDQUFDLEdBQUcsQ0FDUixvQkFBb0IsRUFDcEIsT0FBTyx5REFBaUIsQ0FBQyxVQUFVLFdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FDMUQsT0FBTyxDQUFDLE9BQU8sQ0FDaEIsU0FBUyxPQUFPLENBQUMsRUFBRSxZQUFZLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FDckQsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9hcGkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBFUkEg5Y+Y6YeP5qGG5p62IC0g5aSW6YOo5LqL5Lu2IEFQSSDlrp7njrDmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5pivIEVSQSDmoYbmnrbkuI7lpJbpg6johJrmnKzkuqTkupLnmoTmjqXlj6PlsYLjgILlroPlrp7njrDkuobkuIDns7vliJfoh6rlrprkuYnkuovku7bnmoTlpITnkIblmajjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogRVJBIOahhuaetuS4jeebtOaOpeWQkeWkluaatOmcsuWHveaVsOiwg+eUqOaOpeWPo+OAguWklumDqOiEmuacrOS4jiBFUkEg5Lqk5LqS55qEKirllK/kuIAqKuaWueW8j+aYr+mAmui/h+mFkummhueahFxuICogYGV2ZW50RW1pdChldmVudE5hbWUsIGV2ZW50RGF0YSlgIOWHveaVsO+8jOWPkemAgeeJueWumuagvOW8j+eahOS6i+S7tuOAglxuICpcbiAqIGBpbmRleC50c2Ag5qih5Z2X5Lya55uR5ZCs6L+Z5LqbIGBlcmE6KmAg5YmN57yA55qE5LqL5Lu277yM5bm25bCG5YW25o6o5YWlIGBldmVudF9xdWV1ZS50c2Ag5Lit6L+b6KGM5aSE55CG44CCXG4gKiDkuovku7bpmJ/liJfmnIDnu4jkvJrosIPnlKjmnKzmlofku7bkuK3lr7nlupTnmoTlpITnkIblmajlh73mlbDvvIjlpoIgYGluc2VydEJ5T2JqZWN0YO+8ieOAglxuICpcbiAqIOacrOaooeWdl+S4reeahOWHveaVsOmAmui/h+S4gOenjeW3p+WmmeOAgeino+iApueahOaWueW8j+W3peS9nO+8muWug+S7rOWcqOacgOaWsOeahCBBSSDmtojmga/mnKvlsL7liqjmgIHms6jlhaVcbiAqIGA8VmFyaWFibGVJbnNlcnQ+YCDmiJYgYDxWYXJpYWJsZUVkaXQ+YCDmjIfku6TlnZfvvIznhLblkI7osIPnlKjphZLppobnmoQgYHNldENoYXRNZXNzYWdlc2Ag5pu05paw5raI5oGv44CCXG4gKiDov5nmrKHkv67mlLnkvJrop6blj5EgYGNoYXJhY3Rlcl9tZXNzYWdlX3JlbmRlcmVkYCDnrYnkuovku7bvvIzooqsgRVJBIOeahOS4u+ebkeWQrOWZqOaNleiOt++8jFxuICog5LuO6ICM5bCGIEFQSSDosIPnlKjml6DnvJ3lnLDmlbTlkIjliLAgRVJBIOeahOWOn+eUn+ino+aekOWSjOWQjOatpea1geeoi+S4reOAglxuICovXG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBFUkFfRVZFTlRfRU1JVFRFUiB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCB9IGZyb20gJy4vbWVzc2FnZV91dGlscyc7XG5pbXBvcnQgeyBKLCBMb2dnZXIsIHVuZXNjYXBlRXJhRGF0YSwgdXBkYXRlTWVzc2FnZUNvbnRlbnQgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcignYXBpJyk7XG5cbi8vIEFQSSDlhpnlhaXku7vliqHnmoTmjqXlj6PlrprkuYlcbmludGVyZmFjZSBBcGlXcml0ZUpvYiB7XG4gIGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnIHwgJ1ZhcmlhYmxlRWRpdCcgfCAnVmFyaWFibGVEZWxldGUnO1xuICBibG9ja0NvbnRlbnQ6IG9iamVjdDtcbn1cblxuLy8g5L2/55SoIGxvZGFzaC5kZWJvdW5jZSDliJvlu7rkuIDkuKrpmLLmipblh73mlbDmnaXlj5HpgIEgQVBJIOWGmeWFpeS6i+S7tlxuY29uc3QgZGVib3VuY2VkRW1pdEFwaVdyaXRlID0gXy5kZWJvdW5jZShcbiAgKCkgPT4ge1xuICAgIGV2ZW50RW1pdChFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEUpO1xuICAgIGxvZ2dlci5sb2coJ2RlYm91bmNlZEVtaXRBcGlXcml0ZScsIGDlt7Lop6blj5HlkIjlubblkI7nmoQgJHtFUkFfRVZFTlRfRU1JVFRFUi5BUElfV1JJVEV9IOS6i+S7tuOAgmApO1xuICB9LFxuICA3MDAsXG4gIHsgbGVhZGluZzogZmFsc2UsIHRyYWlsaW5nOiB0cnVlIH0sXG4pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFQSSDkuovku7blj4LogINcbi8vICjkuovku7blkI3np7DnmoTluLjph4/lrprkuYnop4Hkuo4gYGNvbnN0YW50cy50c2Ag5Lit55qEIGBFUkFfQVBJX0VWRU5UU2Ag5a+56LGhKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmluc2VydEJ5T2JqZWN0J1xuICogQGRlc2NyaXB0aW9uIOmAmui/h+S4gOS4quWvueixoe+8jOmdnuegtOWdj+aAp+WcsOaPkuWFpeaWsOWPmOmHj+OAguWPquS8muWGmeWFpeS4jeWtmOWcqOeahOi3r+W+hOOAglxuICogQHBhcmFtIHtvYmplY3R9IGRldGFpbCAtIOimgeaPkuWFpeeahOWPmOmHj+WvueixoeOAglxuICogQGV4YW1wbGVcbiAqIGV2ZW50RW1pdCgnZXJhOmluc2VydEJ5T2JqZWN0Jywge1xuICogICBwbGF5ZXI6IHsgbmFtZTogXCLli4fogIVcIiwgaHA6IDEwMCwgaW52ZW50b3J5OiBbXSB9XG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTp1cGRhdGVCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzkv67mlLnlt7LlrZjlnKjnmoTlj5jph4/jgILlpoLmnpzot6/lvoTkuI3lrZjlnKjvvIzliJnlv73nlaXjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDopoHmm7TmlrDnmoTlj5jph4/lr7nosaHjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTp1cGRhdGVCeU9iamVjdCcsIHtcbiAqICAgcGxheWVyOiB7IGhwOiAxMjAsIHN0YXR1czogJ2JsZXNzZWQnIH1cbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOmluc2VydEJ5UGF0aCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmjIflrprot6/lvoTlkozlgLzvvIzpnZ7noLTlnY/mgKflnLDmj5LlhaXkuIDkuKrmlrDlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDljIXlkKvot6/lvoTlkozlgLznmoTlr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXRhaWwucGF0aCAtIOWPmOmHj+eahOi3r+W+hO+8jOS9v+eUqOeCueaIluaWueaLrOWPt+ihqOekuuazleOAglxuICogQHBhcmFtIHsqfSBkZXRhaWwudmFsdWUgLSDopoHmj5LlhaXnmoTlgLzjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTppbnNlcnRCeVBhdGgnLCB7XG4gKiAgIHBhdGg6ICdwbGF5ZXIuaW52ZW50b3J5WzBdJyxcbiAqICAgdmFsdWU6IHsgbmFtZTogJ+eUn+WRveiNr+awtCcsIGNvdW50OiAzIH1cbiAqIH0pO1xuICovXG5cbi8qKlxuICogQHNlY3Rpb24gQVBJIEV2ZW50OiAnZXJhOnVwZGF0ZUJ5UGF0aCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmjIflrprot6/lvoTlkozlgLzvvIzkv67mlLnkuIDkuKrlt7LlrZjlnKjnmoTlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDljIXlkKvot6/lvoTlkozlgLznmoTlr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXRhaWwucGF0aCAtIOWPmOmHj+eahOi3r+W+hOOAglxuICogQHBhcmFtIHsqfSBkZXRhaWwudmFsdWUgLSDopoHorr7nva7nmoTmlrDlgLzjgILlj6/ku6XmmK/nm7TmjqXnmoTlgLzvvIzkuZ/lj6/ku6XmmK/ov5Dnrpfooajovr7lvI/jgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTp1cGRhdGVCeVBhdGgnLCB7XG4gKiAgIHBhdGg6ICdwbGF5ZXIuaHAnLFxuICogICB2YWx1ZTogJys9MTAnXG4gKiB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTpkZWxldGVCeU9iamVjdCdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fkuIDkuKrlr7nosaHvvIzliKDpmaTlt7LlrZjlnKjnmoTlj5jph4/jgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkZXRhaWwgLSDmj4/ov7DopoHliKDpmaTot6/lvoTnmoTnu5PmnoTjgILlgLznmoTnu5PmnoTlhrPlrprkuobliKDpmaTooYzkuLrjgIJcbiAqIEBleGFtcGxlXG4gKiAvLyDlh4blpIfliKDpmaQgcGxheWVyLmdvbGTjgILmjIfku6TkuK0gZ29sZCDnmoTlgLzlv4XpobvmmK/nqbrlr7nosaEge31cbiAqIGV2ZW50RW1pdCgnZXJhOmRlbGV0ZUJ5T2JqZWN0JywgeyBwbGF5ZXI6IHsgZ29sZDoge30gfSB9KTtcbiAqXG4gKiAvLyDlh4blpIfliKDpmaTmlbTkuKogcGxheWVyIOWvueixoeOAglxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjoge30gfSk7XG4gKlxuICogLy8gKirph43opoEqKjog5aaC5p6cIHBsYXllciDlr7nosaHljIXlkKsgZ29sZCDlkowgbWFuYSDkuKTkuKrlsZ7mgKfvvIxcbiAqIC8vIOS7peS4i+aMh+S7pOWPquS8muWIoOmZpCBnb2xkIOWSjCBtYW5h77yM6ICMIHBsYXllciDlr7nosaHmnKzouqvkvJrooqvkv53nlZnvvIjlj5jkuLrnqbrlr7nosaHvvInjgIJcbiAqIC8vIOi/meS4jiBgZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjoge30gfSlgIOeahOaViOaenOaYr+S4jeWQjOeahOOAglxuICogZXZlbnRFbWl0KCdlcmE6ZGVsZXRlQnlPYmplY3QnLCB7IHBsYXllcjogeyBnb2xkOiB7fSwgbWFuYToge30gfSB9KTtcbiAqL1xuXG4vKipcbiAqIEBzZWN0aW9uIEFQSSBFdmVudDogJ2VyYTpkZWxldGVCeVBhdGgnXG4gKiBAZGVzY3JpcHRpb24g6YCa6L+H5oyH5a6a6Lev5b6E77yM5Yig6Zmk5LiA5Liq5bey5a2Y5Zyo55qE5Y+Y6YeP44CCXG4gKiBAcGFyYW0ge29iamVjdH0gZGV0YWlsIC0g5YyF5ZCr6Lev5b6E55qE5a+56LGh44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV0YWlsLnBhdGggLSDopoHliKDpmaTnmoTlj5jph4/nmoTot6/lvoTjgIJcbiAqIEBleGFtcGxlXG4gKiBldmVudEVtaXQoJ2VyYTpkZWxldGVCeVBhdGgnLCB7IHBhdGg6ICdwbGF5ZXIuaW52ZW50b3J5WzBdJyB9KTtcbiAqL1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWGhemDqOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICog5Zyo6IGK5aSp6K6w5b2V5Lit5p+l5om+5bm26L+U5Zue5pyA5ZCO5LiA5p2h55SxIEFJIOWPkemAgeeahOa2iOaBr+OAglxuICog6L+Z5piv5rOo5YWl5Y+Y6YeP5L+u5pS55oyH5Luk55qE55uu5qCH5raI5oGv44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnkgfCBudWxsPn0g6L+U5Zue5om+5Yiw55qE5raI5oGv5a+56LGh77yM5aaC5p6c5LiN5a2Y5ZyoIEFJIOa2iOaBr+WImei/lOWbniBudWxs44CCXG4gKi9cblxuLyoqXG4gKiDmiafooYzkuIDmrKEgQVBJIOWGmeWFpeaTjeS9nOOAglxuICog5a6D5bCG5oyH5a6a55qE5Y+Y6YeP5L+u5pS55Z2X6L+95Yqg5Yiw5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr+eahOacq+Wwvu+8jOeEtuWQjuiwg+W6puS4gOS4qiAnZXJhOmFwaVdyaXRlJyDkuovku7bjgIJcbiAqIEBwYXJhbSB7QXBpV3JpdGVKb2J9IGpvYiAtIOimgeaJp+ihjOeahOWGmeWFpeS7u+WKoeOAglxuICovXG5hc3luYyBmdW5jdGlvbiBwZXJmb3JtQXBpV3JpdGUoam9iOiBBcGlXcml0ZUpvYikge1xuICAvLyAxLiDnlJ/miJDmjIfku6TlnZdcbiAgY29uc3QgY29udGVudFN0cmluZyA9IEooam9iLmJsb2NrQ29udGVudCk7XG4gIGNvbnN0IGJsb2NrID0gYFxcbjwke2pvYi5ibG9ja1RhZ30+XFxuJHtjb250ZW50U3RyaW5nfVxcbjwvJHtqb2IuYmxvY2tUYWd9PmA7XG5cbiAgLy8gMi4g5p+l5om+55uu5qCH5raI5oGv5bm26L+95Yqg5YaF5a65XG4gIGNvbnN0IGxhc3RBaU1lc3NhZ2UgPSBhd2FpdCBmaW5kTGFzdEFpTWVzc2FnZSgpO1xuICBpZiAoIWxhc3RBaU1lc3NhZ2UpIHtcbiAgICBsb2dnZXIud2FybigncGVyZm9ybUFwaVdyaXRlJywgJ+aJvuS4jeWIsOS7u+S9lSBBSSDmtojmga/vvIzml6Dms5XmiafooYwgQVBJIOWGmeWFpeOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KGxhc3RBaU1lc3NhZ2UpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gb3JpZ2luYWxDb250ZW50ICsgYmxvY2s7XG5cbiAgbG9nZ2VyLmxvZygncGVyZm9ybUFwaVdyaXRlJywgYOWunuaXtuWGmeWFpSBBUEkg5Lu75YqhICgke2pvYi5ibG9ja1RhZ30pIOWIsOa2iOaBryBJRCAke2xhc3RBaU1lc3NhZ2UubWVzc2FnZV9pZH0uLi5gKTtcblxuICAvLyAzLiDlrp7ml7bmm7TmlrDmtojmga/lhoXlrrlcbiAgYXdhaXQgdXBkYXRlTWVzc2FnZUNvbnRlbnQobGFzdEFpTWVzc2FnZSwgbmV3Q29udGVudCk7XG5cbiAgLy8gNC4g6LCD55So6Ziy5oqW5Ye95pWw5p2l6LCD5bqm5YaZ5YWl5LqL5Lu255qE5Y+R6YCBXG4gIGRlYm91bmNlZEVtaXRBcGlXcml0ZSgpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOS6i+S7tuWkhOeQhuWZqOWunueOsCAo55SxIGV2ZW50X3F1ZXVlLnRzIOiwg+eUqClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6aW5zZXJ0QnlPYmplY3RgIOS6i+S7tuOAglxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSDku47kuovku7bnmoQgYGRldGFpbGAg5Lit6I635Y+W55qE5Y+Y6YeP5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRCeU9iamVjdChkYXRhOiBvYmplY3QpIHtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZUluc2VydCcsIGJsb2NrQ29udGVudDogZGF0YSB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOnVwZGF0ZUJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+WvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVFZGl0JywgYmxvY2tDb250ZW50OiBkYXRhIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6aW5zZXJ0QnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKiBAcGFyYW0geyp9IHZhbHVlIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgdmFsdWVgIOWxnuaAp+iOt+WPluOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0QnlQYXRoKHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB2YWx1ZSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVJbnNlcnQnLCBibG9ja0NvbnRlbnQ6IGJsb2NrIH0pO1xufVxuXG4vKipcbiAqICoq44CQ5aSE55CG5Zmo44CRKiog5aSE55CGIGBlcmE6dXBkYXRlQnlQYXRoYCDkuovku7bjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgcGF0aGAg5bGe5oCn6I635Y+W44CCXG4gKiBAcGFyYW0geyp9IHZhbHVlIC0g5LuO5LqL5Lu2IGBkZXRhaWxgIOeahCBgdmFsdWVgIOWxnuaAp+iOt+WPluOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnlQYXRoKHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICBjb25zdCBibG9jayA9IF8uc2V0KHt9LCBwYXRoLCB2YWx1ZSk7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVFZGl0JywgYmxvY2tDb250ZW50OiBibG9jayB9KTtcbn1cblxuLyoqXG4gKiAqKuOAkOWkhOeQhuWZqOOAkSoqIOWkhOeQhiBgZXJhOmRlbGV0ZUJ5T2JqZWN0YCDkuovku7bjgIJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0g5LuO5LqL5Lu255qEIGBkZXRhaWxgIOS4reiOt+WPlueahOWPmOmHj+e7k+aehOOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQnlPYmplY3QoZGF0YTogb2JqZWN0KSB7XG4gIHBlcmZvcm1BcGlXcml0ZSh7IGJsb2NrVGFnOiAnVmFyaWFibGVEZWxldGUnLCBibG9ja0NvbnRlbnQ6IGRhdGEgfSk7XG59XG5cbi8qKlxuICogKirjgJDlpITnkIblmajjgJEqKiDlpITnkIYgYGVyYTpkZWxldGVCeVBhdGhgIOS6i+S7tuOAglxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSDku47kuovku7YgYGRldGFpbGAg55qEIGBwYXRoYCDlsZ7mgKfojrflj5bjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUJ5UGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgLy8g5a+55LqO5Yig6Zmk5pON5L2c77yM5oiR5Lus55So5LiA5Liq56m65a+56LGh5L2c5Li65YC85p2l6KGo56S65Yig6Zmk6K+l6Lev5b6E55qE5oSP5Zu+XG4gIGNvbnN0IGJsb2NrID0gXy5zZXQoe30sIHBhdGgsIHt9KTtcbiAgcGVyZm9ybUFwaVdyaXRlKHsgYmxvY2tUYWc6ICdWYXJpYWJsZURlbGV0ZScsIGJsb2NrQ29udGVudDogYmxvY2sgfSk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5LqL5Lu25bm/5pKt5Zmo5a6e546wICjnlLEgdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvci50cyDnrYnlhoXpg6jmqKHlnZfosIPnlKgpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBgZXJhOndyaXRlRG9uZWAg5LqL5Lu255qE6LSf6L295a+56LGh57uT5p6E44CC5a6D5o+Q5L6b5LqG5YWz5LqO5LiA5qyh5oiQ5Yqf5YaZ5YWl5pON5L2c55qE5a6M5pW05LiK5LiL5paH44CCXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgV3JpdGVEb25lUGF5bG9hZCB7XG4gIC8qKlxuICAgKiDmnKzova7kuovku7blpITnkIblvqrnjq/kuK3vvIzmnIDlkI7mk43kvZznmoTmtojmga/nmoQqKua2iOaBr+WvhumSpSAoTWVzc2FnZSBLZXkpKirjgIJcbiAgICog6YCa5bi455SxIGBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2VgIOWcqOW+queOr+W8gOWni+aXtuehruWumuOAglxuICAgKi9cbiAgbWs6IHN0cmluZztcbiAgLyoqXG4gICAqIOacrOi9ruS6i+S7tuWkhOeQhuW+queOr+S4re+8jOacgOWQjuaTjeS9nOeahOa2iOaBr+eahCoq5raI5oGvIElEKirjgIJcbiAgICovXG4gIG1lc3NhZ2VfaWQ6IG51bWJlcjtcbiAgLyoqXG4gICAqIOaPj+i/sOWcqOacrOi9ruS6i+S7tuWkhOeQhuS4re+8jOaJp+ihjOS6huWTquS6m+aguOW/g+aTjeS9nOOAglxuICAgKiDov5nlr7nkuo7lpJbpg6johJrmnKznkIbop6PnirbmgIHlj5jmm7TnmoTljp/lm6Doh7PlhbPph43opoHjgIJcbiAgICovXG4gIGFjdGlvbnM6IHtcbiAgICAvKiog5piv5ZCm5omn6KGM5LqGIGByb2xsYmFja0J5TWtgIOaTjeS9nCAqL1xuICAgIHJvbGxiYWNrOiBib29sZWFuO1xuICAgIC8qKiDmmK/lkKbmiafooYzkuoYgYEFwcGx5VmFyQ2hhbmdlYCDmk43kvZwgKi9cbiAgICBhcHBseTogYm9vbGVhbjtcbiAgICAvKiog5piv5ZCm5omn6KGM5LqGIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg5pON5L2cICovXG4gICAgcmVzeW5jOiBib29sZWFuO1xuICB9O1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jOaVtOS4quiBiuWkqeS8muivneeahCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+IChTZWxlY3RlZCBNZXNzYWdlIEtleXMpKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meaYr+S4gOS4queogOeWj+aVsOe7hO+8jOWFtue0ouW8lee6puetieS6jua2iOaBryBJRO+8jOWAvOaYr+WvueW6lOalvOWxgua2iOaBr+eahCBNS+OAglxuICAgKiDlroPku6PooajkuoblvZPliY3ogYrlpKnorrDlvZXnmoTigJzkuLvlubLigJ3vvIzmmK8gRVJBIOWIpOaWreWQjOatpeeKtuaAgeeahOaguOW/g+aVsOaNrue7k+aehOOAglxuICAgKi9cbiAgc2VsZWN0ZWRNa3M6IChzdHJpbmcgfCBudWxsKVtdO1xuICAvKipcbiAgICog5LqL5Lu25aSE55CG5a6M5oiQKirkuYvlkI4qKu+8jGBjaGF0YCDlj5jph4/kuK3lrZjlgqjnmoQqKuWujOaVtOeahOe8lui+keaXpeW/l+WvueixoSAoRWRpdExvZ3MpKirjgIJcbiAgICog6L+Z5piv5LiA5Liq5LulIE1LIOS4uumUru+8jOS7peWPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICAgKi9cbiAgZWRpdExvZ3M6IHsgW2tleTogc3RyaW5nXTogYW55W10gfTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzmlbTkuKrogYrlpKnkvJror53nmoQqKueKtuaAgeaVsOaNriAoYHN0YXRfZGF0YWApKiog55qE5pyA5paw54q25oCB44CCXG4gICAqIOi/meS4queJiOacrCoq5YyF5ZCrKirmiYDmnInlhoXpg6jkvb/nlKjnmoQgYCRtZXRhYCDlrZfmrrXjgIJcbiAgICovXG4gIHN0YXQ6IGFueTtcbiAgLyoqXG4gICAqIOS6i+S7tuWkhOeQhuWujOaIkCoq5LmL5ZCOKirvvIzkuIDkuKoqKuS4jeWMheWQqyoq5Lu75L2VIGAkbWV0YWAg5a2X5q6155qEIGBzdGF0X2RhdGFgIOeahOa3seaLt+i0neeJiOacrOOAglxuICAgKiDpgILnlKjkuo7pnIDopoHnuq/lh4DmlbDmja7ov5vooYzlsZXnpLrmiJbov5vkuIDmraXlpITnkIbnmoTlnLrmma/jgIJcbiAgICovXG4gIHN0YXRXaXRob3V0TWV0YTogYW55O1xufVxuXG4vKipcbiAqICoq44CQ5bm/5pKt5Zmo44CRKiog6Kem5Y+RIGBlcmE6d3JpdGVEb25lYCDkuovku7bjgIJcbiAqIOW9k+S4gOasoeWujOaVtOeahOWPmOmHj+WGmeWFpeaTjeS9nO+8iOWMheaLrOWinuOAgeWIoOOAgeaUue+8ieWcqCBgdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvci50c2Ag5Lit5oiQ5Yqf5a6M5oiQ5ZCO77yMXG4gKiDlupTosIPnlKjmraTlh73mlbDjgILlroPlkJHlpJbpg6johJrmnKzlub/mkq3kuIDkuKrkuovku7bvvIzpgJrnn6XlroPku6zlj5jph4/nirbmgIHlt7Llj5HnlJ/mlLnlj5jvvIzlubbmj5Dkvpvor6bnu4bnmoTkuIrkuIvmlofjgIJcbiAqXG4gKiBAcGFyYW0ge1dyaXRlRG9uZVBheWxvYWR9IHBheWxvYWQgLSDljIXlkKvlhpnlhaXmk43kvZzlhbPplK7kv6Hmga/nmoTkuovku7botJ/ovb3jgIJcbiAqIEBleGFtcGxlXG4gKiAvLyDov5nmmK/kuIDkuKrlnKjlpJbpg6johJrmnKzkuK3nm5HlkKzmraTkuovku7bnmoTnpLrkvovvvJpcbiAqIGV2ZW50T24oJ2VyYTp3cml0ZURvbmUnLCAoZGV0YWlsKSA9PiB7XG4gKiAgIGNvbnN0IHsgbWssIG1lc3NhZ2VfaWQsIGFjdGlvbnMsIHNlbGVjdGVkTWtzLCBlZGl0TG9ncywgc3RhdCwgc3RhdFdpdGhvdXRNZXRhIH0gPSBkZXRhaWw7XG4gKiAgIGNvbnNvbGUubG9nKGBFUkEg5Y+Y6YeP5bey5pu05paw77yB5raI5oGvIElEOiAke21lc3NhZ2VfaWR9LCBNSzogJHtta31gKTtcbiAqICAgY29uc29sZS5sb2coJ+aJp+ihjOeahOaTjeS9nDonLCBhY3Rpb25zKTtcbiAqXG4gKiAgIC8vIOS9oOWPr+S7peagueaNrumcgOimgeS9v+eUqCBzdGF0ICjluKYgbWV0YSkg5oiWIHN0YXRXaXRob3V0TWV0YSAo5LiN5bimIG1ldGEpXG4gKiAgIGNvbnNvbGUubG9nKCfmnIDmlrDnmoTnuq/lh4DnirbmgIHmlbDmja46Jywgc3RhdFdpdGhvdXRNZXRhKTtcbiAqXG4gKiAgIC8vIOatpOaXtuWPr+S7peagueaNruacgOaWsOeahOeKtuaAgeaVsOaNruabtOaWsOS9oOiHquW3seeahCBVSSDmiJbmiafooYzlhbbku5bpgLvovpFcbiAqIH0pO1xuICovXG5leHBvcnQgZnVuY3Rpb24gZW1pdFdyaXRlRG9uZUV2ZW50KHBheWxvYWQ6IFdyaXRlRG9uZVBheWxvYWQpIHtcbiAgLy8g5Zyo5bm/5pKt5YmN77yM5a+56ZyA6KaB5pq06Zyy57uZ5aSW6YOo55qE5pWw5o2u6L+b6KGM5Y+N6L2s5LmJXG4gIGNvbnN0IHVuZXNjYXBlZFBheWxvYWQgPSB7XG4gICAgLi4ucGF5bG9hZCxcbiAgICBzdGF0OiB1bmVzY2FwZUVyYURhdGEocGF5bG9hZC5zdGF0KSxcbiAgICBzdGF0V2l0aG91dE1ldGE6IHVuZXNjYXBlRXJhRGF0YShwYXlsb2FkLnN0YXRXaXRob3V0TWV0YSksXG4gIH07XG5cbiAgbG9nZ2VyLmRlYnVnKCdlbWl0V3JpdGVEb25lRXZlbnQnLCAnd3JpdGVEb25l5LqL5Lu25bm/5pKt5pWw5o2u5Y+N6L2s5LmJJywge1xuICAgIGJlZm9yZTogeyBzdGF0OiBwYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogcGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgICBhZnRlcjogeyBzdGF0OiB1bmVzY2FwZWRQYXlsb2FkLnN0YXQsIHN0YXRXaXRob3V0TWV0YTogdW5lc2NhcGVkUGF5bG9hZC5zdGF0V2l0aG91dE1ldGEgfSxcbiAgfSk7XG5cbiAgZXZlbnRFbWl0KEVSQV9FVkVOVF9FTUlUVEVSLldSSVRFX0RPTkUsIHVuZXNjYXBlZFBheWxvYWQpO1xuICBsb2dnZXIubG9nKFxuICAgICdlbWl0V3JpdGVEb25lRXZlbnQnLFxuICAgIGDlt7Lop6blj5EgJHtFUkFfRVZFTlRfRU1JVFRFUi5XUklURV9ET05FfSDkuovku7bjgILmk43kvZw6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICBwYXlsb2FkLmFjdGlvbnMsXG4gICAgKX0sIE1LOiAke3BheWxvYWQubWt9LCBNc2dJRDogJHtwYXlsb2FkLm1lc3NhZ2VfaWR9YCxcbiAgKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/api.ts\n\n}");
  },
  "./src/ERA变量框架/constants.ts": 
  /*!**********************************!*\
  !*** ./src/ERA变量框架/constants.ts ***!
  \**********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CHAT_SCOPE: () => (/* binding */ CHAT_SCOPE),\n/* harmony export */   ERA_API_EVENTS: () => (/* binding */ ERA_API_EVENTS),\n/* harmony export */   ERA_DATA_REGEX: () => (/* binding */ ERA_DATA_REGEX),\n/* harmony export */   ERA_DATA_TAG: () => (/* binding */ ERA_DATA_TAG),\n/* harmony export */   ERA_EVENT_EMITTER: () => (/* binding */ ERA_EVENT_EMITTER),\n/* harmony export */   EVENT_COLLISION_MAP: () => (/* binding */ EVENT_COLLISION_MAP),\n/* harmony export */   EVENT_GROUPS: () => (/* binding */ EVENT_GROUPS),\n/* harmony export */   LOGS_PATH: () => (/* binding */ LOGS_PATH),\n/* harmony export */   LOG_CONFIG: () => (/* binding */ LOG_CONFIG),\n/* harmony export */   META_DATA_PATH: () => (/* binding */ META_DATA_PATH),\n/* harmony export */   RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION: () => (/* binding */ RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION),\n/* harmony export */   SEL_PATH: () => (/* binding */ SEL_PATH),\n/* harmony export */   STAT_DATA_PATH: () => (/* binding */ STAT_DATA_PATH)\n/* harmony export */ });\n/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   \"ERAMetaData\": {\n *     \"EditLogs\": { ... },\n *     \"SelectedMks\": [ ... ]\n *   },\n *   \"stat_data\": {\n *     \"player\": { \"hp\": 100, \"gold\": 50 },\n *     \"world_state\": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nconst CHAT_SCOPE = { type: 'chat' };\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nconst META_DATA_PATH = 'ERAMetaData';\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nconst STAT_DATA_PATH = 'stat_data';\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `\"EditLogs\"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * \"era_mk_1759246942209_jipmrj\": [\n *   { \"op\": \"insert\", \"path\": \"testData.inventory\", \"value_new\": { \"gold\": 100, \"slots\": [\"sword\", \"shield\"] } },\n *   { \"op\": \"update\", \"path\": \"player.hp\", \"value_old\": 90, \"value_new\": 100 }\n * ]\n */\nconst LOGS_PATH = 'EditLogs';\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `\"SelectedMks\"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , \"era_mk_greeting\", \"era_mk_abc123\", , \"era_mk_xyz789\"]\n */\nconst SEL_PATH = 'SelectedMks';\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nconst ERA_DATA_TAG = 'era_data';\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nconst ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nconst ERA_API_EVENTS = {\n    INSERT_BY_OBJECT: 'era:insertByObject',\n    UPDATE_BY_OBJECT: 'era:updateByObject',\n    INSERT_BY_PATH: 'era:insertByPath',\n    UPDATE_BY_PATH: 'era:updateByPath',\n    DELETE_BY_OBJECT: 'era:deleteByObject',\n    DELETE_BY_PATH: 'era:deleteByPath',\n};\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nconst ERA_EVENT_EMITTER = {\n    /** 当变量写入完成时触发 */\n    WRITE_DONE: 'era:writeDone',\n    /** 当API执行写入时触发 */\n    API_WRITE: 'era:apiWrite',\n};\n/**\n * @description 定义需要监听的事件的分组\n */\nconst EVENT_GROUPS = {\n    WRITE: [\n        //tavern_events.CHARACTER_MESSAGE_RENDERED,\n        tavern_events.APP_READY,\n        'manual_write',\n        ERA_EVENT_EMITTER.API_WRITE,\n        //tavern_events.MESSAGE_RECEIVED,\n    ],\n    SYNC: [\n        tavern_events.MESSAGE_RECEIVED,\n        tavern_events.MESSAGE_DELETED,\n        tavern_events.MESSAGE_SWIPED,\n        tavern_events.CHAT_CHANGED,\n        'manual_sync',\n        'manual_full_sync',\n    ],\n    API: Object.values(ERA_API_EVENTS),\n    /** 仅更新MK的事件 */\n    UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n    /** 仅用于对冲检测的事件，本身不触发逻辑 */\n    COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n};\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED]\n * ])\n */\nconst EVENT_COLLISION_MAP = new Map([\n    [tavern_events.MESSAGE_SWIPED, tavern_events.GENERATION_STARTED],\n]);\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n/**\n * @constant {object} LOG_CONFIG\n * @description\n * 用于控制日志输出的配置对象。\n */\nconst LOG_CONFIG = {\n    // 定义所有可用的日志级别及其权重。数字越小，级别越低。\n    levels: {\n        debug: 0,\n        log: 1,\n        warn: 2,\n        error: 3,\n    },\n    // 设置当前全局日志级别。只有权重等于或高于此级别的日志才会被输出。\n    currentLevel: 0, // 默认为 'debug'\n    // 'debug' 级别的白名单。只有当 currentLevel 为 debug 时，此列表才生效。\n    // 只有在此列表中的模块才会输出 debug 日志。\n    debugWhitelist: [\n        'api',\n        'delete',\n        'event_queue',\n        'force_macro_render',\n        'insert',\n        'message_key',\n        'message_utils',\n        'query',\n        'rollback',\n        'sync',\n        'template',\n        'update',\n        'variable_change_processor',\n    ],\n};\n// 初始化时将 currentLevel 设置为 debug 级别\nLOG_CONFIG.currentLevel = LOG_CONFIG.levels.debug;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvbnN0YW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E0Qkc7QUFFVTtBQUViOzs7Ozs7R0FNRztBQUNJLE1BQU0sVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQWUsRUFBRSxDQUFDO0FBRXBEOzs7R0FHRztBQUNJLE1BQU0sY0FBYyxHQUFHLGFBQWEsQ0FBQztBQUU1Qzs7O0dBR0c7QUFDSSxNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUM7QUFFMUM7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUNJLE1BQU0sU0FBUyxHQUFHLFVBQVUsQ0FBQztBQUVwQzs7Ozs7Ozs7Ozs7R0FXRztBQUNJLE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQztBQUV0Qzs7Ozs7R0FLRztBQUNJLE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQztBQUV2Qzs7Ozs7R0FLRztBQUNJLE1BQU0sY0FBYyxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksWUFBWSxlQUFlLFlBQVksR0FBRyxDQUFDLENBQUM7QUFFekY7Ozs7O0dBS0c7QUFDSSxNQUFNLGNBQWMsR0FBRztJQUM1QixnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsZ0JBQWdCLEVBQUUsb0JBQW9CO0lBQ3RDLGNBQWMsRUFBRSxrQkFBa0I7SUFDbEMsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyxnQkFBZ0IsRUFBRSxvQkFBb0I7SUFDdEMsY0FBYyxFQUFFLGtCQUFrQjtDQUMxQixDQUFDO0FBRVg7OztHQUdHO0FBQ0ksTUFBTSxpQkFBaUIsR0FBRztJQUMvQixpQkFBaUI7SUFDakIsVUFBVSxFQUFFLGVBQWU7SUFDM0Isa0JBQWtCO0lBQ2xCLFNBQVMsRUFBRSxjQUFjO0NBQ2pCLENBQUM7QUFFWDs7R0FFRztBQUNJLE1BQU0sWUFBWSxHQUFHO0lBQzFCLEtBQUssRUFBRTtRQUNMLDJDQUEyQztRQUMzQyxhQUFhLENBQUMsU0FBUztRQUN2QixjQUFjO1FBQ2QsaUJBQWlCLENBQUMsU0FBUztRQUMzQixpQ0FBaUM7S0FDbEM7SUFDRCxJQUFJLEVBQUU7UUFDSixhQUFhLENBQUMsZ0JBQWdCO1FBQzlCLGFBQWEsQ0FBQyxlQUFlO1FBQzdCLGFBQWEsQ0FBQyxjQUFjO1FBQzVCLGFBQWEsQ0FBQyxZQUFZO1FBQzFCLGFBQWE7UUFDYixrQkFBa0I7S0FDbkI7SUFDRCxHQUFHLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUM7SUFDbEMsZUFBZTtJQUNmLGNBQWMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUM7SUFDNUMseUJBQXlCO0lBQ3pCLG1CQUFtQixFQUFFLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDO0NBQ3hELENBQUM7QUFFRjs7Ozs7Ozs7Ozs7OztHQWFHO0FBQ0ksTUFBTSxtQkFBbUIsR0FBRyxJQUFJLEdBQUcsQ0FBaUI7SUFDekQsQ0FBQyxhQUFhLENBQUMsY0FBYyxFQUFFLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztDQUNqRSxDQUFDLENBQUM7QUFFSDs7OztHQUlHO0FBQ0ksTUFBTSwwQ0FBMEMsR0FBRyxDQUFDLENBQUM7QUFFNUQ7Ozs7R0FJRztBQUNJLE1BQU0sVUFBVSxHQUFHO0lBQ3hCLDZCQUE2QjtJQUM3QixNQUFNLEVBQUU7UUFDTixLQUFLLEVBQUUsQ0FBQztRQUNSLEdBQUcsRUFBRSxDQUFDO1FBQ04sSUFBSSxFQUFFLENBQUM7UUFDUCxLQUFLLEVBQUUsQ0FBQztLQUNUO0lBRUQsbUNBQW1DO0lBQ25DLFlBQVksRUFBRSxDQUFDLEVBQUUsY0FBYztJQUUvQixvREFBb0Q7SUFDcEQsMkJBQTJCO0lBQzNCLGNBQWMsRUFBRTtRQUNkLEtBQUs7UUFDTCxRQUFRO1FBQ1IsYUFBYTtRQUNiLG9CQUFvQjtRQUNwQixRQUFRO1FBQ1IsYUFBYTtRQUNiLGVBQWU7UUFDZixPQUFPO1FBQ1AsVUFBVTtRQUNWLE1BQU07UUFDTixVQUFVO1FBQ1YsUUFBUTtRQUNSLDJCQUEyQjtLQUNoQjtDQUNkLENBQUM7QUFDRixrQ0FBa0M7QUFDbEMsVUFBVSxDQUFDLFlBQVksR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2NvbnN0YW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmoLjlv4PluLjph4/mqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu26ZuG5Lit5a6a5LmJ5LqG5pW05LiqIEVSQSDmoYbmnrbmiYDkvb/nlKjnmoTlhbPplK7luLjph4/jgIJcbiAqIOi/meS6m+W4uOmHj+S4u+imgeeUqOS9nOWcqOmFkummhiBgY2hhdGAg5Y+Y6YeP5Lit5a2Y5YKo5ZKM5qOA57SiIEVSQSDmoLjlv4PmlbDmja7nmoTot6/lvoTvvIjplK7lkI3vvInjgIJcbiAqXG4gKiAqKuaguOW/g+aVsOaNrue7k+aehCoqOlxuICogRVJBIOeahOaVsOaNruiiq+WIhuS4uuS4pOmDqOWIhu+8jOWtmOWCqOWcqCBgY2hhdGAg5Y+Y6YeP5LiL77yaXG4gKiAxLiAqKuWFg+aVsOaNriAoRVJBTWV0YURhdGEpKio6IOWMheWQq+ahhuaetuiHqui6q+i/kOihjOaJgOmcgOeahOaguOW/g+aVsOaNru+8jOWmgiBgRWRpdExvZ3NgIOWSjCBgU2VsZWN0ZWRNa3Ng44CCXG4gKiAyLiAqKueKtuaAgeaVsOaNriAoc3RhdF9kYXRhKSoqOiDljIXlkKvmiYDmnInnlLHnlKjmiLflkowgQUkg566h55CG55qE5ri45oiPL+aVheS6i+WPmOmHj++8jOWmgiBgcGxheWVyYOOAgWB3b3JsZF9zdGF0ZWAg562J44CCXG4gKlxuICog5YW257uT5p6E5aSn6Ie05aaC5LiL77yaXG4gKiBgYGBqc29uXG4gKiB7XG4gKiAgIFwiRVJBTWV0YURhdGFcIjoge1xuICogICAgIFwiRWRpdExvZ3NcIjogeyAuLi4gfSxcbiAqICAgICBcIlNlbGVjdGVkTWtzXCI6IFsgLi4uIF1cbiAqICAgfSxcbiAqICAgXCJzdGF0X2RhdGFcIjoge1xuICogICAgIFwicGxheWVyXCI6IHsgXCJocFwiOiAxMDAsIFwiZ29sZFwiOiA1MCB9LFxuICogICAgIFwid29ybGRfc3RhdGVcIjogeyAuLi4gfVxuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqIOWwhui/meS6m+i3r+W+hOWumuS5ieS4uuW4uOmHj++8jOacieWKqeS6ju+8mlxuICogMS4gKirpgb/lhY3noaznvJbnoIEqKu+8muWHj+WwkeWboOaLvOWGmemUmeivr+WvvOiHtOeahCBidWfjgIJcbiAqIDIuICoq5o+Q6auY5Y+v57u05oqk5oCnKirvvJrlpoLmnpzmnKrmnaXpnIDopoHosIPmlbTmlbDmja7nu5PmnoTvvIzlj6rpnIDkv67mlLnmraTmlofku7bljbPlj6/jgIJcbiAqIDMuICoq5aKe5by65Luj56CB5Y+v6K+75oCnKirvvJrluLjph4/nmoTlkI3np7DmuIXmmbDlnLDooajovr7kuoblhbbmiYDmjIflkJHnmoTmlbDmja7nmoTlkKvkuYnjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IENIQVRfU0NPUEVcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO6YWS6aaG5Yqp5omLIGBnZXRWYXJpYWJsZXNgIOWSjCBgcmVwbGFjZVZhcmlhYmxlc2Ag57O75YiX5Ye95pWw55qEIGBzY29wZWAg5Y+C5pWw44CCXG4gKiDlroPmjIflrprkuobmk43kvZznmoTnm67moIfmmK/lvZPliY0qKuiBiuWkqe+8iENoYXTvvIkqKue6p+WIq+eahOWPmOmHj+OAglxuICogRVJBIOahhuaetueahOaJgOacieaguOW/g+aVsOaNruWSjOeUqOaIt+WPmOmHj+mDveWtmOWCqOWcqOatpOS9nOeUqOWfn+S4i+OAglxuICovXG5leHBvcnQgY29uc3QgQ0hBVF9TQ09QRSA9IHsgdHlwZTogJ2NoYXQnIGFzIGNvbnN0IH07XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IE1FVEFfREFUQV9QQVRIXG4gKiBAZGVzY3JpcHRpb24g5ZyoIGBjaGF0YCDlj5jph4/kuK3vvIzlrZjlgqggRVJBIOahhuaetioq5YWD5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IE1FVEFfREFUQV9QQVRIID0gJ0VSQU1ldGFEYXRhJztcblxuLyoqXG4gKiBAY29uc3RhbnQge3N0cmluZ30gU1RBVF9EQVRBX1BBVEhcbiAqIEBkZXNjcmlwdGlvbiDlnKggYGNoYXRgIOWPmOmHj+S4re+8jOWtmOWCqOeUqOaItyoq54q25oCB5pWw5o2uKirnmoTmoLnlr7nosaHnmoTplK7lkI3jgIJcbiAqL1xuZXhwb3J0IGNvbnN0IFNUQVRfREFUQV9QQVRIID0gJ3N0YXRfZGF0YSc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IExPR1NfUEFUSFxuICogQGRlc2NyaXB0aW9uXG4gKiDlnKggYEVSQU1ldGFEYXRhYCDlr7nosaHkuK3vvIzlrZjlgqgqKue8lui+keaXpeW/l++8iEVkaXQgTG9nc++8iSoq55qE5a+56LGh55qE6ZSu5ZCN77yM5Y2zIGBcIkVkaXRMb2dzXCJg44CCXG4gKiBgRWRpdExvZ3NgIOaYr+S4gOS4quS7pSoq5raI5oGv5a+G6ZKl77yITUvvvIkqKuS4uumUru+8jOS7peivpea2iOaBr+W8leWPkeeahOWPmOmHj+WPmOabtOiusOW9leaVsOe7hOS4uuWAvOeahOWvueixoeOAglxuICog6L+Z5piv5a6e546w4oCc6YCG5bqP5Zue5rua4oCd5Yqf6IO955qE5Z+656GA5pWw5o2u44CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIGNoYXQuRVJBTWV0YURhdGEuRWRpdExvZ3Mg55qE5LiA5Liq5p2h55uuXG4gKiBcImVyYV9ta18xNzU5MjQ2OTQyMjA5X2ppcG1yalwiOiBbXG4gKiAgIHsgXCJvcFwiOiBcImluc2VydFwiLCBcInBhdGhcIjogXCJ0ZXN0RGF0YS5pbnZlbnRvcnlcIiwgXCJ2YWx1ZV9uZXdcIjogeyBcImdvbGRcIjogMTAwLCBcInNsb3RzXCI6IFtcInN3b3JkXCIsIFwic2hpZWxkXCJdIH0gfSxcbiAqICAgeyBcIm9wXCI6IFwidXBkYXRlXCIsIFwicGF0aFwiOiBcInBsYXllci5ocFwiLCBcInZhbHVlX29sZFwiOiA5MCwgXCJ2YWx1ZV9uZXdcIjogMTAwIH1cbiAqIF1cbiAqL1xuZXhwb3J0IGNvbnN0IExPR1NfUEFUSCA9ICdFZGl0TG9ncyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IFNFTF9QQVRIXG4gKiBAZGVzY3JpcHRpb25cbiAqIOWcqCBgRVJBTWV0YURhdGFgIOWvueixoeS4re+8jOWtmOWCqCoq5bey6YCJ5oup5raI5oGv5a+G6ZKl6ZO+77yIU2VsZWN0ZWQgTWVzc2FnZSBLZXlz77yJKirnmoTmlbDnu4TnmoTplK7lkI3vvIzljbMgYFwiU2VsZWN0ZWRNa3NcImDjgIJcbiAqIGBTZWxlY3RlZE1rc2Ag5piv5LiA5Liq56iA55aP5pWw57uE77yM5YW2KirntKLlvJXnuqbnrYnkuo7mtojmga8gSUQqKu+8jOWAvOaYr+ivpealvOWxgua2iOaBr+eahCBNS+OAglxuICog6L+Z5Liq5pWw57uE5pivIEVSQSDmoYbmnrbnmoTigJzohIrmooHigJ3vvIzmmK/ov57mjqXmir3osaHlj5jph4/nirbmgIHkuI7lhbfkvZPogYrlpKnljoblj7LnmoTmoaXmooHjgIJcbiAqIOahhuaetumAmui/h+avlOWvuSBgU2VsZWN0ZWRNa3NgIOS4juWunumZhea2iOaBr+a1geS4reeahCBNS++8jOadpeWIpOaWreaVsOaNruaYr+WQpumcgOimgeWQjOatpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBjaGF0LkVSQU1ldGFEYXRhLlNlbGVjdGVkTWtzXG4gKiBbICwgXCJlcmFfbWtfZ3JlZXRpbmdcIiwgXCJlcmFfbWtfYWJjMTIzXCIsICwgXCJlcmFfbWtfeHl6Nzg5XCJdXG4gKi9cbmV4cG9ydCBjb25zdCBTRUxfUEFUSCA9ICdTZWxlY3RlZE1rcyc7XG5cbi8qKlxuICogQGNvbnN0YW50IHtzdHJpbmd9IEVSQV9EQVRBX1RBR1xuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7lnKjmtojmga/lhoXlrrnkuK3ljIXoo7kgRVJBIOWFg+aVsOaNru+8iOWmgua2iOaBr+WvhumSpSBNS++8ieeahCBYTUwg6aOO5qC85qCH562+5ZCN44CCXG4gKiBlLmcuLCBgPGVyYV9kYXRhPnsuLi59PC9lcmFfZGF0YT5gXG4gKi9cbmV4cG9ydCBjb25zdCBFUkFfREFUQV9UQUcgPSAnZXJhX2RhdGEnO1xuXG4vKipcbiAqIEBjb25zdGFudCB7UmVnRXhwfSBFUkFfREFUQV9SRUdFWFxuICogQGRlc2NyaXB0aW9uXG4gKiDnlKjkuo7ku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3ljLnphY3lkozmj5Dlj5YgYDxlcmFfZGF0YT5gIOWdl+eahOato+WImeihqOi+vuW8j+OAglxuICog6L+Z5Liq5bi46YeP6KKr5a6a5LmJ5Zyo6L+Z6YeM77yM5Lul6YG/5YWNIGBtZXNzYWdlX2tleS50c2Ag5ZKMIGBtZXNzYWdlX3V0aWxzLnRzYCDkuYvpl7TnmoTlvqrnjq/kvp3otZbjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEVSQV9EQVRBX1JFR0VYID0gbmV3IFJlZ0V4cChgPCR7RVJBX0RBVEFfVEFHfT4oey4qP30pPFxcXFwvJHtFUkFfREFUQV9UQUd9PmApO1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfQVBJX0VWRU5UU1xuICogQGRlc2NyaXB0aW9uXG4gKiDlrprkuYnkuobmiYDmnInkvpvlpJbpg6johJrmnKzpgJrov4cgYGV2ZW50RW1pdGAg6LCD55So55qE6Ieq5a6a5LmJIEFQSSDkuovku7blkI3np7DjgIJcbiAqIOS9v+eUqOi/meS6m+W4uOmHj+WPr+S7pemBv+WFjeWcqOS7o+eggeS4reS9v+eUqOehrOe8lueggeeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0FQSV9FVkVOVFMgPSB7XG4gIElOU0VSVF9CWV9PQkpFQ1Q6ICdlcmE6aW5zZXJ0QnlPYmplY3QnLFxuICBVUERBVEVfQllfT0JKRUNUOiAnZXJhOnVwZGF0ZUJ5T2JqZWN0JyxcbiAgSU5TRVJUX0JZX1BBVEg6ICdlcmE6aW5zZXJ0QnlQYXRoJyxcbiAgVVBEQVRFX0JZX1BBVEg6ICdlcmE6dXBkYXRlQnlQYXRoJyxcbiAgREVMRVRFX0JZX09CSkVDVDogJ2VyYTpkZWxldGVCeU9iamVjdCcsXG4gIERFTEVURV9CWV9QQVRIOiAnZXJhOmRlbGV0ZUJ5UGF0aCcsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEBjb25zdGFudCB7b2JqZWN0fSBFUkFfRVZFTlRfRU1JVFRFUlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huaJgOacieeUsSBFUkEg5qGG5p62KirlkJHlpJblj5Hlh7oqKueahOS6i+S7tuOAglxuICovXG5leHBvcnQgY29uc3QgRVJBX0VWRU5UX0VNSVRURVIgPSB7XG4gIC8qKiDlvZPlj5jph4/lhpnlhaXlrozmiJDml7bop6blj5EgKi9cbiAgV1JJVEVfRE9ORTogJ2VyYTp3cml0ZURvbmUnLFxuICAvKiog5b2TQVBJ5omn6KGM5YaZ5YWl5pe26Kem5Y+RICovXG4gIEFQSV9XUklURTogJ2VyYTphcGlXcml0ZScsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiDlrprkuYnpnIDopoHnm5HlkKznmoTkuovku7bnmoTliIbnu4RcbiAqL1xuZXhwb3J0IGNvbnN0IEVWRU5UX0dST1VQUyA9IHtcbiAgV1JJVEU6IFtcbiAgICAvL3RhdmVybl9ldmVudHMuQ0hBUkFDVEVSX01FU1NBR0VfUkVOREVSRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5BUFBfUkVBRFksXG4gICAgJ21hbnVhbF93cml0ZScsXG4gICAgRVJBX0VWRU5UX0VNSVRURVIuQVBJX1dSSVRFLFxuICAgIC8vdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICBdLFxuICBTWU5DOiBbXG4gICAgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9ERUxFVEVELFxuICAgIHRhdmVybl9ldmVudHMuTUVTU0FHRV9TV0lQRUQsXG4gICAgdGF2ZXJuX2V2ZW50cy5DSEFUX0NIQU5HRUQsXG4gICAgJ21hbnVhbF9zeW5jJyxcbiAgICAnbWFudWFsX2Z1bGxfc3luYycsXG4gIF0sXG4gIEFQSTogT2JqZWN0LnZhbHVlcyhFUkFfQVBJX0VWRU5UUyksXG4gIC8qKiDku4Xmm7TmlrBNS+eahOS6i+S7tiAqL1xuICBVUERBVEVfTUtfT05MWTogW3RhdmVybl9ldmVudHMuTUVTU0FHRV9TRU5UXSxcbiAgLyoqIOS7heeUqOS6juWvueWGsuajgOa1i+eahOS6i+S7tu+8jOacrOi6q+S4jeinpuWPkemAu+i+kSAqL1xuICBDT0xMSVNJT05fREVURUNUT1JTOiBbdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURURdLFxufTtcblxuLyoqXG4gKiBAY29uc3RhbnQge01hcDxzdHJpbmcsIHN0cmluZz59IEVWRU5UX0NPTExJU0lPTl9NQVBcbiAqIEBkZXNjcmlwdGlvblxuICog5a6a5LmJ5LqG5LqL5Lu25a+55Yay6KeE5YiZ44CCXG4gKiDlpoLmnpzlnKjkuovku7bpmJ/liJfnmoTlkIzkuIDmrKHmibnlpITnkIbkuK3vvIzlkIzml7blh7rnjrDkuoYga2V5IOS6i+S7tuWSjCB2YWx1ZSDkuovku7bvvIxcbiAqIOWImei/meS4pOS4quS6i+S7tumDveWwhuiiq+W/veeVpeOAglxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyDlvZPnlKjmiLflv6vpgJ/lt6bmu5HnhLblkI7ngrnlh7vnlJ/miJDml7bvvIzkvJrkvp3mrKHop6blj5EgYE1FU1NBR0VfU1dJUEVEYCDlkowgYEdFTkVSQVRJT05fU1RBUlRFRGDjgIJcbiAqIC8vIOi/meadoeinhOWImeS8muaNleiOt+i/meenjeaooeW8j+W5tuWQjOaXtuW/veeVpei/meS4pOS4quS6i+S7tu+8jOmBv+WFjeS4jeW/heimgeeahOWQjOatpeOAglxuICogbmV3IE1hcChbXG4gKiAgIFt0YXZlcm5fZXZlbnRzLk1FU1NBR0VfU1dJUEVELCB0YXZlcm5fZXZlbnRzLkdFTkVSQVRJT05fU1RBUlRFRF1cbiAqIF0pXG4gKi9cbmV4cG9ydCBjb25zdCBFVkVOVF9DT0xMSVNJT05fTUFQID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oW1xuICBbdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1NXSVBFRCwgdGF2ZXJuX2V2ZW50cy5HRU5FUkFUSU9OX1NUQVJURURdLFxuXSk7XG5cbi8qKlxuICogQGNvbnN0YW50IHtudW1iZXJ9IFJFTkRFUl9FVkVOVFNfVE9fSUdOT1JFX0FGVEVSX01LX0lOSkVDVElPTlxuICogQGRlc2NyaXB0aW9uIOW9kyBgZW5zdXJlTWVzc2FnZUtleWAg5rOo5YWl5LiA5Liq5paw55qEIE1LIOWQju+8jOmcgOimgeW/veeVpeeahOeUseivpeaTjeS9nOinpuWPkeeahCBgY2hhcmFjdGVyX21lc3NhZ2VfcmVuZGVyZWRgIOS6i+S7tueahOaVsOmHj+OAglxuICog6YCa5bi46K6+572u5Li6IDHvvIzlm6DkuLrkuIDmrKHmtojmga/lhoXlrrnmm7TmlrDpgJrluLjlj6rkvJrop6blj5HkuIDmrKHmuLLmn5Pkuovku7bjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IFJFTkRFUl9FVkVOVFNfVE9fSUdOT1JFX0FGVEVSX01LX0lOSkVDVElPTiA9IDE7XG5cbi8qKlxuICogQGNvbnN0YW50IHtvYmplY3R9IExPR19DT05GSUdcbiAqIEBkZXNjcmlwdGlvblxuICog55So5LqO5o6n5Yi25pel5b+X6L6T5Ye655qE6YWN572u5a+56LGh44CCXG4gKi9cbmV4cG9ydCBjb25zdCBMT0dfQ09ORklHID0ge1xuICAvLyDlrprkuYnmiYDmnInlj6/nlKjnmoTml6Xlv5fnuqfliKvlj4rlhbbmnYPph43jgILmlbDlrZfotorlsI/vvIznuqfliKvotorkvY7jgIJcbiAgbGV2ZWxzOiB7XG4gICAgZGVidWc6IDAsXG4gICAgbG9nOiAxLFxuICAgIHdhcm46IDIsXG4gICAgZXJyb3I6IDMsXG4gIH0sXG5cbiAgLy8g6K6+572u5b2T5YmN5YWo5bGA5pel5b+X57qn5Yir44CC5Y+q5pyJ5p2D6YeN562J5LqO5oiW6auY5LqO5q2k57qn5Yir55qE5pel5b+X5omN5Lya6KKr6L6T5Ye644CCXG4gIGN1cnJlbnRMZXZlbDogMCwgLy8g6buY6K6k5Li6ICdkZWJ1ZydcblxuICAvLyAnZGVidWcnIOe6p+WIq+eahOeZveWQjeWNleOAguWPquacieW9kyBjdXJyZW50TGV2ZWwg5Li6IGRlYnVnIOaXtu+8jOatpOWIl+ihqOaJjeeUn+aViOOAglxuICAvLyDlj6rmnInlnKjmraTliJfooajkuK3nmoTmqKHlnZfmiY3kvJrovpPlh7ogZGVidWcg5pel5b+X44CCXG4gIGRlYnVnV2hpdGVsaXN0OiBbXG4gICAgJ2FwaScsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2V2ZW50X3F1ZXVlJyxcbiAgICAnZm9yY2VfbWFjcm9fcmVuZGVyJyxcbiAgICAnaW5zZXJ0JyxcbiAgICAnbWVzc2FnZV9rZXknLFxuICAgICdtZXNzYWdlX3V0aWxzJyxcbiAgICAncXVlcnknLFxuICAgICdyb2xsYmFjaycsXG4gICAgJ3N5bmMnLFxuICAgICd0ZW1wbGF0ZScsXG4gICAgJ3VwZGF0ZScsXG4gICAgJ3ZhcmlhYmxlX2NoYW5nZV9wcm9jZXNzb3InLFxuICBdIGFzIHN0cmluZ1tdLFxufTtcbi8vIOWIneWni+WMluaXtuWwhiBjdXJyZW50TGV2ZWwg6K6+572u5Li6IGRlYnVnIOe6p+WIq1xuTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPSBMT0dfQ09ORklHLmxldmVscy5kZWJ1ZztcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/constants.ts\n\n}");
  },
  "./src/ERA变量框架/delete.ts": 
  /*!*******************************!*\
  !*** ./src/ERA变量框架/delete.ts ***!
  \*******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processDeleteBlocks: () => (/* binding */ processDeleteBlocks)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_0__.Logger('delete');\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData, basePath, patchObj, editLog) {\n    // --- 1. 入口守卫和状态获取 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n    // 精确判断豁免条件\n    const metaPatch = _.get(patchObj, '$meta');\n    const isBypassingProtection = \n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n        // 场景2: 指令明确要删除 $meta.necessary 键\n        _.has(patchObj, ['$meta', 'necessary']);\n    // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n    if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n        // **意图：递归删除子节点**\n        // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n        if (necessary === 'all' && !isBypassingProtection) {\n            logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`);\n            return;\n        }\n        // 权限通过，或存在豁免，继续向内递归。\n        for (const key of Object.keys(patchObj)) {\n            const fullPath = basePath ? `${basePath}.${key}` : key;\n            const subPatchObj = patchObj[key];\n            applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n        }\n        return; // 子节点处理完毕，返回。\n    }\n    // --- 3. 执行删除当前节点 ---\n    // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n    // **意图：删除当前节点 `basePath`**\n    // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n    // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n    if (necessary === 'self' || necessary === 'all') {\n        logger.warn('applyDeleteAtLevel', `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`);\n        return;\n    }\n    // 根节点（basePath 为 ''）不应被删除。\n    if (basePath === '') {\n        logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。');\n        return;\n    }\n    // 执行原子性删除\n    const valOld = _.cloneDeep(currentNodeInVars);\n    _.unset(statData, basePath);\n    editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n    logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n/**\n * 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processDeleteBlocks(allDeletes, editLog) {\n    if (allDeletes.length > 0) {\n        for (const deleteRoot of allDeletes) {\n            if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot))\n                continue;\n            try {\n                await (0,_utils__WEBPACK_IMPORTED_MODULE_0__.updateEraStatData)(stat => {\n                    logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n                    // 从根路径开始递归\n                    applyDeleteAtLevel(stat, '', deleteRoot, editLog);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processDeleteBlocks', '所有 VariableDelete 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBQ2pGLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDO0lBQzlELENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvZGVsZXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+WIoOmZpOaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfotJ/otKPlpITnkIYgYDxWYXJpYWJsZURlbGV0ZT5gIOaMh+S7pO+8jOWunueOsOWvueW3suWtmOWcqOWPmOmHj+eahOWIoOmZpO+8jOW5tueUn+aIkOebuOW6lOeahCBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuaMh+S7pOmpseWKqCoqOiDpgJLlvZLooYzkuLrnlLHmjIfku6Tlr7nosaHnmoTnu5PmnoTpqbHliqjjgILnqbrlr7nosaEgYHt9YCDooajnpLrliKDpmaTlvZPliY3oioLngrnvvIzpnZ7nqbrlr7nosaHooajnpLrpgJLlvZLliKDpmaTlrZDoioLngrnjgIJcbiAqIC0gKirlronlhajnrKzkuIAqKjog5Yig6Zmk5piv56C05Z2P5oCn5pON5L2c77yM5Zug5q2k5byV5YWl5LqGIGAkbWV0YS5uZWNlc3NhcnlgIOadg+mZkOacuuWItuadpemYsuatouivr+WIoOOAglxuICogLSAqKueyvuehruixgeWFjSoqOiBgbmVjZXNzYXJ5YCDnmoTkv53miqTlj6rmnInlnKjliKDpmaTmjIfku6TmmI7noa7mjIflkJEgYG5lY2Vzc2FyeWAg5bGe5oCn6Ieq6Lqr5pe25omN5Lya6KKr57uV6L+H44CCXG4gKiAtICoq5Y6f5a2Q5oCn5pel5b+XKio6IOS4uuavj+S4gOasoeWIoOmZpOeUn+aIkOWNleS4gOOAgeeyvuehrueahCBgRWRpdExvZ2DvvIznoa7kv53mk43kvZzlj6/lrozlhajlm57mu5rjgIJcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBMb2dnZXIsIHVwZGF0ZUVyYVN0YXREYXRhIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2RlbGV0ZScpO1xuXG4vKipcbiAqICoq44CQ6YCS5b2S5Yig6Zmk44CRKipcbiAqIOWunueOsOS6hiBgPFZhcmlhYmxlRGVsZXRlPmAg55qE5qC45b+D6YC76L6R77yM5YW26KGM5Li655Sx5oyH5LukIGBwYXRjaE9iamAg55qE57uT5p6E6amx5Yqo44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeS4jiBgYmFzZVBhdGhgIOWvueW6lOeahOmDqOWIhuOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICovXG5mdW5jdGlvbiBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdERhdGE6IGFueSwgYmFzZVBhdGg6IHN0cmluZywgcGF0Y2hPYmo6IGFueSwgZWRpdExvZzogYW55W10pIHtcbiAgLy8gLS0tIDEuIOWFpeWPo+WuiOWNq+WSjOeKtuaAgeiOt+WPliAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcblxuICBpZiAoY3VycmVudE5vZGVJblZhcnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGxvZ2dlci53YXJuKCdhcHBseURlbGV0ZUF0TGV2ZWwnLCBgVmFyaWFibGVEZWxldGUg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbmVjZXNzYXJ5ID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAnbmVjZXNzYXJ5J10pO1xuXG4gIC8vIOeyvuehruWIpOaWreixgeWFjeadoeS7tlxuICBjb25zdCBtZXRhUGF0Y2ggPSBfLmdldChwYXRjaE9iaiwgJyRtZXRhJyk7XG4gIGNvbnN0IGlzQnlwYXNzaW5nUHJvdGVjdGlvbiA9XG4gICAgLy8g5Zy65pmvMTog5oyH5Luk6KaB5Yig6Zmk5pW05LiqICRtZXRhIOWvueixoVxuICAgIChfLmlzUGxhaW5PYmplY3QobWV0YVBhdGNoKSAmJiBfLmlzRW1wdHkobWV0YVBhdGNoKSkgfHxcbiAgICAvLyDlnLrmma8yOiDmjIfku6TmmI7noa7opoHliKDpmaQgJG1ldGEubmVjZXNzYXJ5IOmUrlxuICAgIF8uaGFzKHBhdGNoT2JqLCBbJyRtZXRhJywgJ25lY2Vzc2FyeSddKTtcblxuICAvLyAtLS0gMi4g5Yik5pat5oSP5Zu+77ya6YCS5b2S5Yig6Zmk5a2Q6IqC54K5IHZzIOWIoOmZpOW9k+WJjeiKgueCuSAtLS1cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikgJiYgIV8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICAvLyAqKuaEj+Wbvu+8mumAkuW9kuWIoOmZpOWtkOiKgueCuSoqXG5cbiAgICAvLyDmnYPpmZDmo4Dmn6XvvJrlpoLmnpzoioLngrnlj5cgJ2FsbCcg5L+d5oqk77yM5LiU5oyH5Luk5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ56aB5q2i5rex5YWl44CCXG4gICAgaWYgKG5lY2Vzc2FyeSA9PT0gJ2FsbCcgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICdhcHBseURlbGV0ZUF0TGV2ZWwnLFxuICAgICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiBhbGxcIiDkv53miqTvvIzlhbblrZDoioLngrnml6Dms5XooqvliKDpmaTjgIJgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyDmnYPpmZDpgJrov4fvvIzmiJblrZjlnKjosYHlhY3vvIznu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gYmFzZVBhdGggPyBgJHtiYXNlUGF0aH0uJHtrZXl9YCA6IGtleTtcbiAgICAgIGNvbnN0IHN1YlBhdGNoT2JqID0gcGF0Y2hPYmpba2V5XTtcbiAgICAgIGFwcGx5RGVsZXRlQXRMZXZlbChzdGF0RGF0YSwgZnVsbFBhdGgsIHN1YlBhdGNoT2JqLCBlZGl0TG9nKTtcbiAgICB9XG4gICAgcmV0dXJuOyAvLyDlrZDoioLngrnlpITnkIblrozmr5XvvIzov5Tlm57jgIJcbiAgfVxuXG4gIC8vIC0tLSAzLiDmiafooYzliKDpmaTlvZPliY3oioLngrkgLS0tXG4gIC8vICjog73otbDliLDov5nph4zvvIzor7TmmI4gcGF0Y2hPYmog5piv56m65a+56LGh44CB6Z2e5a+56LGh5oiWIG51bGwpXG4gIC8vICoq5oSP5Zu+77ya5Yig6Zmk5b2T5YmN6IqC54K5IGBiYXNlUGF0aGAqKlxuXG4gIC8vIOadg+mZkOajgOafpe+8midzZWxmJyDmiJYgJ2FsbCcg6YO95Lya6Zi75q2i5b2T5YmN6IqC54K555qE55u05o6l5Yig6Zmk44CCXG4gIC8vIOebtOaOpeWIoOmZpOiKgueCueeahOaEj+WbvuaXoOazleixgeWFjeS/neaKpO+8jOW/hemhu+mAmui/h+mAkuW9kuaEj+WbvuWIoOmZpCAnJG1ldGEnIOadpeino+mZpOS/neaKpOOAglxuICBpZiAobmVjZXNzYXJ5ID09PSAnc2VsZicgfHwgbmVjZXNzYXJ5ID09PSAnYWxsJykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RGVsZXRlQXRMZXZlbCcsXG4gICAgICBgVmFyaWFibGVEZWxldGUg5aSx6LSl77ya6Lev5b6EIDwke2Jhc2VQYXRofT4g5Y+XIFwibmVjZXNzYXJ5OiAke25lY2Vzc2FyeX1cIiDkv53miqTvvIzml6Dms5Xooqvnm7TmjqXliKDpmaTjgIJgLFxuICAgICk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8g5qC56IqC54K577yIYmFzZVBhdGgg5Li6ICcn77yJ5LiN5bqU6KKr5Yig6Zmk44CCXG4gIGlmIChiYXNlUGF0aCA9PT0gJycpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsICdWYXJpYWJsZURlbGV0ZSDlpLHotKXvvJrkuI3lhYHorrjliKDpmaTmoLnlr7nosaHjgIInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDmiafooYzljp/lrZDmgKfliKDpmaRcbiAgY29uc3QgdmFsT2xkID0gXy5jbG9uZURlZXAoY3VycmVudE5vZGVJblZhcnMpO1xuICBfLnVuc2V0KHN0YXREYXRhLCBiYXNlUGF0aCk7XG4gIGVkaXRMb2cucHVzaCh7IG9wOiAnZGVsZXRlJywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX29sZDogdmFsT2xkIH0pO1xuICBsb2dnZXIuZGVidWcoJ2FwcGx5RGVsZXRlQXRMZXZlbCcsIGDmiJDlip/liKDpmaToioLngrk6ICR7YmFzZVBhdGh9YCk7XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVEZWxldGU+YCDmjIfku6TlnZfjgIJcbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBhbGxEZWxldGVzIC0g5LuO5raI5oGv5Lit6Kej5p6Q5Ye655qE5omA5pyJIGRlbGV0ZSDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlczogYW55W10sIGVkaXRMb2c6IGFueVtdKSB7XG4gIGlmIChhbGxEZWxldGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IGRlbGV0ZVJvb3Qgb2YgYWxsRGVsZXRlcykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZGVsZXRlUm9vdCkgfHwgXy5pc0VtcHR5KGRlbGV0ZVJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsIGDlpITnkIYgZGVsZXRlUm9vdDogJHtKU09OLnN0cmluZ2lmeShkZWxldGVSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoTlvIDlp4vpgJLlvZJcbiAgICAgICAgICBhcHBseURlbGV0ZUF0TGV2ZWwoc3RhdCwgJycsIGRlbGV0ZVJvb3QsIGVkaXRMb2cpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NEZWxldGVCbG9ja3MnLCBg5aSE55CGIGRlbGV0ZVJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0RlbGV0ZUJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVEZWxldGUg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/delete.ts\n\n}");
  },
  "./src/ERA变量框架/event_queue.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/event_queue.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pushToQueue: () => (/* binding */ pushToQueue)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _api__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api */ \"./src/ERA变量框架/api.ts\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _force_macro_render__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./force_macro_render */ \"./src/ERA变量框架/force_macro_render.ts\");\n/* harmony import */ var _message_key__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_key */ \"./src/ERA变量框架/message_key.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/rollback.ts\");\n/* harmony import */ var _sync__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./sync */ \"./src/ERA变量框架/sync.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/* harmony import */ var _variable_change_processor__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./variable_change_processor */ \"./src/ERA变量框架/variable_change_processor.ts\");\n/**\n * @file ERA 变量框架 - 事件队列与处理器模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”，它通过一个事件队列机制，优雅地解决了因酒馆（SillyTavern）\n * 高频、并发事件（特别是 `character_message_rendered`）可能导致的状态竞争和逻辑错乱问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有来自酒馆的、与 ERA 相关的事件以及来自 API 的调用，都不会立即执行，\n *    而是被封装成一个 `EventJob` 对象，推入一个先进先出的 `eventQueue` 队列中。\n * 2. **单线程处理**: 一个独立的、异步的 `processQueue` 函数作为唯一的处理器。它使用一个\n *    `isProcessing` 锁来确保在任何时刻，只有一个事件处理循环在运行，从而从根本上避免了并发问题。\n * 3. **智能批处理与合并**: 在每个处理循环的开始，处理器会一次性取出队列中的所有事件形成一个“批次”。\n *    然后对这个批次进行“智能合并”，例如，多个连续的、效果可覆盖的写入事件（如 `MESSAGE_RECEIVED`）\n *    可以被合并为一次，只保留最后一个，这极大地减少了不必要的重复计算。\n * 4. **顺序执行与任务分发**: 合并后的任务会按照严格的顺序被逐一执行。`switch` 语句根据事件类型，\n *    将任务分发给相应的核心处理函数（如 `ApplyVarChange`, `resyncStateOnHistoryChange` 等）。\n * 5. **保障与节流**:\n *    - 在处理每个任务**之前**，都会调用 `ensureMkForLatestMessage`，确保即将操作的消息有 MK。\n *    - 在处理每个任务**之后**，都会调用 `updateLatestSelectedMk`，校准 `SelectedMks` 的最新记录。\n *    - 每个任务处理后都有一个短暂的 `setTimeout` 节流，给予酒馆底层异步操作完成的时间。\n */\n\n\n\n\n\n\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_7__.Logger('event_queue');\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue = [];\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动处理器。这是所有事件监听器的统一入口点。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nfunction pushToQueue(type, detail) {\n    logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n    eventQueue.push({ type, detail, timestamp: Date.now() });\n    processQueue(); // 尝试启动处理器\n}\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('WRITE', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nfunction getEventGroup(eventType) {\n    // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n    if (_constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_GROUPS.WRITE.includes(eventType))\n        return 'WRITE';\n    if (_constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_GROUPS.SYNC.includes(eventType))\n        return 'SYNC';\n    if (_constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_GROUPS.API.includes(eventType))\n        return 'API';\n    if (_constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_GROUPS.UPDATE_MK_ONLY.includes(eventType))\n        return 'UPDATE_MK_ONLY';\n    if (_constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_GROUPS.COLLISION_DETECTORS.includes(eventType))\n        return 'COLLISION_DETECTORS';\n    return 'UNKNOWN';\n}\n/**\n * **【核心事件处理器】**\n * 持续从队列中取出事件、合并、并按顺序执行。\n * 这是一个自驱动的异步函数，只要队列不为空就会一直运行，直到处理完所有任务。\n */\nasync function processQueue() {\n    if (isProcessing)\n        return; // 如果已在处理中，则直接返回，等待当前循环完成。\n    isProcessing = true;\n    logger.log('processQueue', '处理器启动...');\n    // 用于存储由 ensureMkForLatestMessage 新注入的 MK，以忽略其触发的渲染事件。\n    // 它定义在 while 循环外部，以在不同批次的事件处理之间保持状态。\n    let mkToIgnore = null;\n    while (eventQueue.length > 0) {\n        // 【事件收集窗口】\n        // 查看队列中的下一个事件，以决定是否需要防抖。\n        const nextJob = eventQueue[0];\n        const nextGroup = getEventGroup(nextJob.type);\n        // 如果下一个事件不是需要立即响应的 API 事件，则进行防抖等待。\n        // 这允许在第一个事件触发后、处理器实际开始工作前的瞬间，让任何紧随其后的、\n        // 快速连续的事件（如多次 swipe）有机会进入队列，从而被纳入同一个批次进行合并。\n        if (nextGroup !== 'API') {\n            logger.log('processQueue', `下一个事件 (${nextJob.type}) 需要防抖，等待300毫秒...`);\n            await new Promise(resolve => setTimeout(resolve, 300));\n        }\n        // --- 1. 事件批处理与合并 ---\n        // 等待结束后，一次性取出队列中的所有事件进行批处理。\n        const batchToProcess = eventQueue.splice(0, eventQueue.length);\n        const originalEvents = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(batchToProcess);\n        // a. 合并相邻的同组事件\n        const finalJobs = [];\n        // 使用 for...of 循环，让逻辑更清晰\n        for (const currentJob of batchToProcess) {\n            // 如果是第一个事件，直接放入结果中\n            if (finalJobs.length === 0) {\n                finalJobs.push(currentJob);\n                continue; // 继续处理下一个事件\n            }\n            const prevJob = finalJobs[finalJobs.length - 1];\n            // 1. 检查事件对冲\n            const expectedNextEvent = _constants__WEBPACK_IMPORTED_MODULE_2__.EVENT_COLLISION_MAP.get(prevJob.type);\n            const timeDifference = currentJob.timestamp - prevJob.timestamp;\n            if (expectedNextEvent && currentJob.type === expectedNextEvent && timeDifference <= 300) {\n                logger.log('processQueue', `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms)。将忽略这两个事件。`);\n                finalJobs.pop(); // 移除前一个事件\n                continue; // 跳过当前事件，从而忽略两者\n            }\n            // 2. 如果不对冲，则检查同组事件合并\n            const prevGroup = getEventGroup(prevJob.type);\n            const currentGroup = getEventGroup(currentJob.type);\n            // 定义合并条件，让 if 判断的意图更清晰\n            const areInSameGroup = prevGroup === currentGroup;\n            const isMergeableGroup = prevGroup === 'WRITE' || prevGroup === 'SYNC';\n            // 如果满足合并条件\n            if (areInSameGroup && isMergeableGroup) {\n                // 用当前事件覆盖掉结果数组中的最后一个事件\n                finalJobs[finalJobs.length - 1] = currentJob;\n            }\n            else {\n                // 否则，将当前事件追加到结果数组\n                finalJobs.push(currentJob);\n            }\n        }\n        // b. 打印合并日志\n        console.groupCollapsed(`[ERA] 事件队列处理: ${originalEvents.length} -> ${finalJobs.length}`);\n        logger.log('合并前', originalEvents.map(e => e.type));\n        logger.log('合并后', finalJobs.map(e => e.type));\n        console.groupEnd();\n        // --- 2. 严格按顺序执行合并后的任务 ---\n        for (const job of finalJobs) {\n            const { type: eventType, detail } = job;\n            const eventGroup = getEventGroup(eventType);\n            let message_id = null;\n            // 在每轮任务开始时，初始化操作记录器\n            const actionsTaken = { rollback: false, apply: false, resync: false };\n            try {\n                // **前置过滤**: 忽略单独存在的对冲检测器事件\n                if (eventGroup === 'COLLISION_DETECTORS') {\n                    // 此类事件仅用于对冲，如果它单独存在（未被对冲掉），则不执行任何操作。\n                    logger.log('processQueue', `事件 ${eventType} 是一个对冲检测器，无独立操作，已忽略。`);\n                    continue;\n                }\n                // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n                const { mk, message_id: msgId, isNewKey } = await (0,_message_key__WEBPACK_IMPORTED_MODULE_4__.ensureMkForLatestMessage)();\n                _utils__WEBPACK_IMPORTED_MODULE_7__.logContext.mk = mk;\n                message_id = msgId;\n                // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就设置忽略规则。\n                if (isNewKey && mk) {\n                    mkToIgnore = {\n                        mk: mk,\n                        ignoreCount: _constants__WEBPACK_IMPORTED_MODULE_2__.RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n                    };\n                }\n                // **核心优化**: 忽略由 MK 注入自身触发的渲染事件\n                if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && mk === mkToIgnore.mk) {\n                    logger.log('processQueue', `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`);\n                    mkToIgnore.ignoreCount--;\n                    if (mkToIgnore.ignoreCount <= 0) {\n                        mkToIgnore = null; // 忽略次数用完，重置\n                        logger.log('processQueue', `忽略次数用完`);\n                    }\n                    continue; // 跳过此事件的处理\n                }\n                logger.log('processQueue', `执行任务: ${eventType} (分组: ${eventGroup})`);\n                // **任务分发**\n                logger.debug('processQueue - task dispatch', `分发事件: ${eventType}`, { detail, eventGroup });\n                if (eventGroup === 'WRITE') {\n                    // 关键：写入前先回滚，确保操作的幂等性。\n                    // 即使事件被意外触发多次，也只会产生一次有效写入。\n                    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n                    if (msg) {\n                        const MK = (0,_message_key__WEBPACK_IMPORTED_MODULE_4__.readMessageKey)(msg);\n                        if (MK) {\n                            await (0,_rollback__WEBPACK_IMPORTED_MODULE_5__.rollbackByMk)(MK, true);\n                            actionsTaken.rollback = true;\n                        }\n                    }\n                    await (0,_variable_change_processor__WEBPACK_IMPORTED_MODULE_8__.ApplyVarChange)();\n                    actionsTaken.apply = true;\n                    // 在变量写入完成后，强制重新渲染消息以触发宏\n                    (0,_force_macro_render__WEBPACK_IMPORTED_MODULE_3__.forceRenderRecentMessages)();\n                }\n                else if (eventGroup === 'SYNC') {\n                    logger.debug('processQueue - task dispatch', `事件 ${eventType} 触发状态同步流程...`);\n                    const isFullSync = eventType === 'manual_full_sync';\n                    await (0,_sync__WEBPACK_IMPORTED_MODULE_6__.resyncStateOnHistoryChange)(isFullSync);\n                    actionsTaken.resync = true;\n                    // 在同步完成后，强制重新渲染消息以触发宏\n                    (0,_force_macro_render__WEBPACK_IMPORTED_MODULE_3__.forceRenderRecentMessages)();\n                }\n                else if (eventGroup === 'API') {\n                    // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n                    if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.INSERT_BY_OBJECT)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.insertByObject)(detail);\n                    else if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.UPDATE_BY_OBJECT)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.updateByObject)(detail);\n                    else if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.INSERT_BY_PATH)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.insertByPath)(detail.path, detail.value);\n                    else if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.UPDATE_BY_PATH)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.updateByPath)(detail.path, detail.value);\n                    else if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.DELETE_BY_OBJECT)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.deleteByObject)(detail);\n                    else if (eventType === _constants__WEBPACK_IMPORTED_MODULE_2__.ERA_API_EVENTS.DELETE_BY_PATH)\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.deleteByPath)(detail.path);\n                }\n                else if (eventGroup === 'UPDATE_MK_ONLY') {\n                    // 监听此事件仅用于为用户消息创建 MK。\n                    await (0,_message_key__WEBPACK_IMPORTED_MODULE_4__.updateLatestSelectedMk)();\n                }\n            }\n            catch (error) {\n                logger.error('processQueue', `事件 ${eventType} 处理异常: ${error}`, error);\n            }\n            finally {\n                // 仅当本轮处理中实际执行了 ERA 核心操作时，才校准并广播事件\n                // --- 3. 触发写入完成事件 ---\n                if (actionsTaken.rollback || actionsTaken.apply || actionsTaken.resync) {\n                    // **后置保障**: 强制校准 `SelectedMks` 的最新记录。\n                    await (0,_message_key__WEBPACK_IMPORTED_MODULE_4__.updateLatestSelectedMk)();\n                    // 在所有操作（包括校准）完成后，获取最新状态并广播事件\n                    if (_utils__WEBPACK_IMPORTED_MODULE_7__.logContext.mk && message_id !== null) {\n                        const { meta: metaData, stat: statData } = (0,_utils__WEBPACK_IMPORTED_MODULE_7__.getEraData)();\n                        const selectedMks = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _constants__WEBPACK_IMPORTED_MODULE_2__.SEL_PATH, []);\n                        const editLogs = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(metaData, _constants__WEBPACK_IMPORTED_MODULE_2__.LOGS_PATH, {});\n                        const statWithoutMeta = (0,_utils__WEBPACK_IMPORTED_MODULE_7__.removeMetaFields)(statData);\n                        (0,_api__WEBPACK_IMPORTED_MODULE_1__.emitWriteDoneEvent)({\n                            mk: _utils__WEBPACK_IMPORTED_MODULE_7__.logContext.mk,\n                            message_id: message_id,\n                            actions: actionsTaken,\n                            selectedMks: selectedMks,\n                            editLogs: editLogs,\n                            stat: statData,\n                            statWithoutMeta: statWithoutMeta,\n                        });\n                    }\n                }\n                // 清理日志上下文，为下一个事件做准备\n                _utils__WEBPACK_IMPORTED_MODULE_7__.logContext.mk = '';\n                // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n                await new Promise(resolve => setTimeout(resolve, 50));\n            }\n        }\n        logger.debug('processQueue', '本轮批次处理完毕。');\n    }\n    // 队列处理完毕，释放锁，等待下一次事件入队。\n    isProcessing = false;\n    logger.log('processQueue', '处理器空闲，已释放锁。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxjQUFjLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDNUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L2V2ZW50X3F1ZXVlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOS6i+S7tumYn+WIl+S4juWkhOeQhuWZqOaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmmK8gRVJBIOahhuaetueahOKAnOelnue7j+S4reaeouKAne+8jOWug+mAmui/h+S4gOS4quS6i+S7tumYn+WIl+acuuWItu+8jOS8mOmbheWcsOino+WGs+S6huWboOmFkummhu+8iFNpbGx5VGF2ZXJu77yJXG4gKiDpq5jpopHjgIHlubblj5Hkuovku7bvvIjnibnliKvmmK8gYGNoYXJhY3Rlcl9tZXNzYWdlX3JlbmRlcmVkYO+8ieWPr+iDveWvvOiHtOeahOeKtuaAgeernuS6ieWSjOmAu+i+kemUmeS5semXrumimOOAglxuICpcbiAqICoq5bel5L2c5Y6f55CGKio6XG4gKiAxLiAqKuS6i+S7tuWFpemYnyoqOiDmiYDmnInmnaXoh6rphZLppobnmoTjgIHkuI4gRVJBIOebuOWFs+eahOS6i+S7tuS7peWPiuadpeiHqiBBUEkg55qE6LCD55So77yM6YO95LiN5Lya56uL5Y2z5omn6KGM77yMXG4gKiAgICDogIzmmK/ooqvlsIHoo4XmiJDkuIDkuKogYEV2ZW50Sm9iYCDlr7nosaHvvIzmjqjlhaXkuIDkuKrlhYjov5vlhYjlh7rnmoQgYGV2ZW50UXVldWVgIOmYn+WIl+S4reOAglxuICogMi4gKirljZXnur/nqIvlpITnkIYqKjog5LiA5Liq54us56uL55qE44CB5byC5q2l55qEIGBwcm9jZXNzUXVldWVgIOWHveaVsOS9nOS4uuWUr+S4gOeahOWkhOeQhuWZqOOAguWug+S9v+eUqOS4gOS4qlxuICogICAgYGlzUHJvY2Vzc2luZ2Ag6ZSB5p2l56Gu5L+d5Zyo5Lu75L2V5pe25Yi777yM5Y+q5pyJ5LiA5Liq5LqL5Lu25aSE55CG5b6q546v5Zyo6L+Q6KGM77yM5LuO6ICM5LuO5qC55pys5LiK6YG/5YWN5LqG5bm25Y+R6Zeu6aKY44CCXG4gKiAzLiAqKuaZuuiDveaJueWkhOeQhuS4juWQiOW5tioqOiDlnKjmr4/kuKrlpITnkIblvqrnjq/nmoTlvIDlp4vvvIzlpITnkIblmajkvJrkuIDmrKHmgKflj5blh7rpmJ/liJfkuK3nmoTmiYDmnInkuovku7blvaLmiJDkuIDkuKrigJzmibnmrKHigJ3jgIJcbiAqICAgIOeEtuWQjuWvuei/meS4quaJueasoei/m+ihjOKAnOaZuuiDveWQiOW5tuKAne+8jOS+i+Wmgu+8jOWkmuS4qui/nue7reeahOOAgeaViOaenOWPr+imhueblueahOWGmeWFpeS6i+S7tu+8iOWmgiBgTUVTU0FHRV9SRUNFSVZFRGDvvIlcbiAqICAgIOWPr+S7peiiq+WQiOW5tuS4uuS4gOasoe+8jOWPquS/neeVmeacgOWQjuS4gOS4qu+8jOi/meaegeWkp+WcsOWHj+WwkeS6huS4jeW/heimgeeahOmHjeWkjeiuoeeul+OAglxuICogNC4gKirpobrluo/miafooYzkuI7ku7vliqHliIblj5EqKjog5ZCI5bm25ZCO55qE5Lu75Yqh5Lya5oyJ54Wn5Lil5qC855qE6aG65bqP6KKr6YCQ5LiA5omn6KGM44CCYHN3aXRjaGAg6K+t5Y+l5qC55o2u5LqL5Lu257G75Z6L77yMXG4gKiAgICDlsIbku7vliqHliIblj5Hnu5nnm7jlupTnmoTmoLjlv4PlpITnkIblh73mlbDvvIjlpoIgYEFwcGx5VmFyQ2hhbmdlYCwgYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDnrYnvvInjgIJcbiAqIDUuICoq5L+d6Zqc5LiO6IqC5rWBKio6XG4gKiAgICAtIOWcqOWkhOeQhuavj+S4quS7u+WKoSoq5LmL5YmNKirvvIzpg73kvJrosIPnlKggYGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZWDvvIznoa7kv53ljbPlsIbmk43kvZznmoTmtojmga/mnIkgTUvjgIJcbiAqICAgIC0g5Zyo5aSE55CG5q+P5Liq5Lu75YqhKirkuYvlkI4qKu+8jOmDveS8muiwg+eUqCBgdXBkYXRlTGF0ZXN0U2VsZWN0ZWRNa2DvvIzmoKHlh4YgYFNlbGVjdGVkTWtzYCDnmoTmnIDmlrDorrDlvZXjgIJcbiAqICAgIC0g5q+P5Liq5Lu75Yqh5aSE55CG5ZCO6YO95pyJ5LiA5Liq55+t5pqC55qEIGBzZXRUaW1lb3V0YCDoioLmtYHvvIznu5nkuojphZLppoblupXlsYLlvILmraXmk43kvZzlrozmiJDnmoTml7bpl7TjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQge1xuICBkZWxldGVCeU9iamVjdCxcbiAgZGVsZXRlQnlQYXRoLFxuICBlbWl0V3JpdGVEb25lRXZlbnQsXG4gIGluc2VydEJ5T2JqZWN0LFxuICBpbnNlcnRCeVBhdGgsXG4gIHVwZGF0ZUJ5T2JqZWN0LFxuICB1cGRhdGVCeVBhdGgsXG59IGZyb20gJy4vYXBpJztcbmltcG9ydCB7XG4gIEVSQV9BUElfRVZFTlRTLFxuICBFVkVOVF9DT0xMSVNJT05fTUFQLFxuICBFVkVOVF9HUk9VUFMsXG4gIExPR1NfUEFUSCxcbiAgUkVOREVSX0VWRU5UU19UT19JR05PUkVfQUZURVJfTUtfSU5KRUNUSU9OLFxuICBTRUxfUEFUSCxcbn0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcyB9IGZyb20gJy4vZm9yY2VfbWFjcm9fcmVuZGVyJztcbmltcG9ydCB7IGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZSwgcmVhZE1lc3NhZ2VLZXksIHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgfSBmcm9tICcuL21lc3NhZ2Vfa2V5JztcbmltcG9ydCB7IHJvbGxiYWNrQnlNayB9IGZyb20gJy4vcm9sbGJhY2snO1xuaW1wb3J0IHsgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UgfSBmcm9tICcuL3N5bmMnO1xuaW1wb3J0IHsgZ2V0RXJhRGF0YSwgbG9nQ29udGV4dCwgTG9nZ2VyLCByZW1vdmVNZXRhRmllbGRzIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBBcHBseVZhckNoYW5nZSB9IGZyb20gJy4vdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvcic7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ2V2ZW50X3F1ZXVlJyk7XG5cbi8qKlxuICogQGludGVyZmFjZSBFdmVudEpvYlxuICogQGRlc2NyaXB0aW9uIOWumuS5ieS6huS6i+S7tumYn+WIl+S4reavj+S4quS7u+WKoeWvueixoeeahOe7k+aehOOAglxuICovXG5pbnRlcmZhY2UgRXZlbnRKb2Ige1xuICB0eXBlOiBzdHJpbmc7XG4gIGRldGFpbD86IGFueTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbi8qKlxuICogQGNvbnN0IHtFdmVudEpvYltdfSBldmVudFF1ZXVlXG4gKiBAZGVzY3JpcHRpb24g5LqL5Lu26Zif5YiX77yM5a2Y5YKo5omA5pyJ5b6F5aSE55CG55qE5LqL5Lu25Lu75Yqh44CCXG4gKi9cbmNvbnN0IGV2ZW50UXVldWU6IEV2ZW50Sm9iW10gPSBbXTtcblxuLyoqXG4gKiBAbGV0IHtib29sZWFufSBpc1Byb2Nlc3NpbmdcbiAqIEBkZXNjcmlwdGlvbiDlpITnkIblmajplIHjgILkuLogdHJ1ZSDml7booajnpLogYHByb2Nlc3NRdWV1ZWAg5q2j5Zyo6L+Q6KGM77yM6Ziy5q2i6YeN5YWl44CCXG4gKi9cbmxldCBpc1Byb2Nlc3NpbmcgPSBmYWxzZTtcblxuLyoqXG4gKiAqKuOAkOS6i+S7tuWFpeWPo+OAkSoqXG4gKiDlsIbkuIDkuKrkuovku7bmjqjlhaXpmJ/liJfvvIzlubblsJ3or5XlkK/liqjlpITnkIblmajjgILov5nmmK/miYDmnInkuovku7bnm5HlkKzlmajnmoTnu5/kuIDlhaXlj6PngrnjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0g5LqL5Lu257G75Z6LIChlLmcuLCBgdGF2ZXJuX2V2ZW50cy5NRVNTQUdFX0RFTEVURURgKeOAglxuICogQHBhcmFtIHthbnl9IFtkZXRhaWxdIC0g5LqL5Lu26ZmE5bim55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwdXNoVG9RdWV1ZSh0eXBlOiBzdHJpbmcsIGRldGFpbD86IGFueSkge1xuICBsb2dnZXIuZGVidWcoJ3B1c2hUb1F1ZXVlJywgYOaOpeaUtuWIsOS6i+S7tjogJHt0eXBlfe+8jOW3suaOqOWFpemYn+WIl+OAgmAsIHsgZGV0YWlsIH0pO1xuICBldmVudFF1ZXVlLnB1c2goeyB0eXBlLCBkZXRhaWwsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTtcbiAgcHJvY2Vzc1F1ZXVlKCk7IC8vIOWwneivleWQr+WKqOWkhOeQhuWZqFxufVxuXG4vKipcbiAqIOagueaNruS6i+S7tuexu+Wei++8jOafpeaJvuWug+WxnuS6juWTquS4qumihOWumuS5ieeahOe7hOOAglxuICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIOimgeajgOafpeeahOS6i+S7tuexu+Wei+OAglxuICogQHJldHVybnMge3N0cmluZ30g5LqL5Lu25omA5bGe55qE57uE5ZCNICgnV1JJVEUnLCAnU1lOQycsICdBUEknLCAnVVBEQVRFX01LX09OTFknLCAnVU5LTk9XTicp44CCXG4gKi9cbmZ1bmN0aW9uIGdldEV2ZW50R3JvdXAoZXZlbnRUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyDkvb/nlKggYXMgc3RyaW5nW10g5p2l6Kej5YazIFR5cGVTY3JpcHQg5ZugICdhcyBjb25zdCcg5o6o5pat5Ye655qE6L+H5LqO5Lil5qC855qE57G75Z6L6Zeu6aKYXG4gIGlmICgoRVZFTlRfR1JPVVBTLldSSVRFIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1dSSVRFJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuU1lOQyBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdTWU5DJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuQVBJIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ0FQSSc7XG4gIGlmICgoRVZFTlRfR1JPVVBTLlVQREFURV9NS19PTkxZIGFzIHN0cmluZ1tdKS5pbmNsdWRlcyhldmVudFR5cGUpKSByZXR1cm4gJ1VQREFURV9NS19PTkxZJztcbiAgaWYgKChFVkVOVF9HUk9VUFMuQ09MTElTSU9OX0RFVEVDVE9SUyBhcyBzdHJpbmdbXSkuaW5jbHVkZXMoZXZlbnRUeXBlKSkgcmV0dXJuICdDT0xMSVNJT05fREVURUNUT1JTJztcbiAgcmV0dXJuICdVTktOT1dOJztcbn1cblxuLyoqXG4gKiAqKuOAkOaguOW/g+S6i+S7tuWkhOeQhuWZqOOAkSoqXG4gKiDmjIHnu63ku47pmJ/liJfkuK3lj5blh7rkuovku7bjgIHlkIjlubbjgIHlubbmjInpobrluo/miafooYzjgIJcbiAqIOi/meaYr+S4gOS4quiHqumpseWKqOeahOW8guatpeWHveaVsO+8jOWPquimgemYn+WIl+S4jeS4uuepuuWwseS8muS4gOebtOi/kOihjO+8jOebtOWIsOWkhOeQhuWujOaJgOacieS7u+WKoeOAglxuICovXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzUXVldWUoKSB7XG4gIGlmIChpc1Byb2Nlc3NpbmcpIHJldHVybjsgLy8g5aaC5p6c5bey5Zyo5aSE55CG5Lit77yM5YiZ55u05o6l6L+U5Zue77yM562J5b6F5b2T5YmN5b6q546v5a6M5oiQ44CCXG4gIGlzUHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgbG9nZ2VyLmxvZygncHJvY2Vzc1F1ZXVlJywgJ+WkhOeQhuWZqOWQr+WKqC4uLicpO1xuXG4gIC8vIOeUqOS6juWtmOWCqOeUsSBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2Ug5paw5rOo5YWl55qEIE1L77yM5Lul5b+955Wl5YW26Kem5Y+R55qE5riy5p+T5LqL5Lu244CCXG4gIC8vIOWug+WumuS5ieWcqCB3aGlsZSDlvqrnjq/lpJbpg6jvvIzku6XlnKjkuI3lkIzmibnmrKHnmoTkuovku7blpITnkIbkuYvpl7Tkv53mjIHnirbmgIHjgIJcbiAgbGV0IG1rVG9JZ25vcmU6IHsgbWs6IHN0cmluZzsgaWdub3JlQ291bnQ6IG51bWJlciB9IHwgbnVsbCA9IG51bGw7XG5cbiAgd2hpbGUgKGV2ZW50UXVldWUubGVuZ3RoID4gMCkge1xuICAgIC8vIOOAkOS6i+S7tuaUtumbhueql+WPo+OAkVxuICAgIC8vIOafpeeci+mYn+WIl+S4reeahOS4i+S4gOS4quS6i+S7tu+8jOS7peWGs+WumuaYr+WQpumcgOimgemYsuaKluOAglxuICAgIGNvbnN0IG5leHRKb2IgPSBldmVudFF1ZXVlWzBdO1xuICAgIGNvbnN0IG5leHRHcm91cCA9IGdldEV2ZW50R3JvdXAobmV4dEpvYi50eXBlKTtcblxuICAgIC8vIOWmguaenOS4i+S4gOS4quS6i+S7tuS4jeaYr+mcgOimgeeri+WNs+WTjeW6lOeahCBBUEkg5LqL5Lu277yM5YiZ6L+b6KGM6Ziy5oqW562J5b6F44CCXG4gICAgLy8g6L+Z5YWB6K645Zyo56ys5LiA5Liq5LqL5Lu26Kem5Y+R5ZCO44CB5aSE55CG5Zmo5a6e6ZmF5byA5aeL5bel5L2c5YmN55qE556s6Ze077yM6K6p5Lu75L2V57Sn6ZqP5YW25ZCO55qE44CBXG4gICAgLy8g5b+r6YCf6L+e57ut55qE5LqL5Lu277yI5aaC5aSa5qyhIHN3aXBl77yJ5pyJ5py65Lya6L+b5YWl6Zif5YiX77yM5LuO6ICM6KKr57qz5YWl5ZCM5LiA5Liq5om55qyh6L+b6KGM5ZCI5bm244CCXG4gICAgaWYgKG5leHRHcm91cCAhPT0gJ0FQSScpIHtcbiAgICAgIGxvZ2dlci5sb2coJ3Byb2Nlc3NRdWV1ZScsIGDkuIvkuIDkuKrkuovku7YgKCR7bmV4dEpvYi50eXBlfSkg6ZyA6KaB6Ziy5oqW77yM562J5b6FMzAw5q+r56eSLi4uYCk7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMzAwKSk7XG4gICAgfVxuXG4gICAgLy8gLS0tIDEuIOS6i+S7tuaJueWkhOeQhuS4juWQiOW5tiAtLS1cbiAgICAvLyDnrYnlvoXnu5PmnZ/lkI7vvIzkuIDmrKHmgKflj5blh7rpmJ/liJfkuK3nmoTmiYDmnInkuovku7bov5vooYzmibnlpITnkIbjgIJcbiAgICBjb25zdCBiYXRjaFRvUHJvY2VzcyA9IGV2ZW50UXVldWUuc3BsaWNlKDAsIGV2ZW50UXVldWUubGVuZ3RoKTtcbiAgICBjb25zdCBvcmlnaW5hbEV2ZW50cyA9IF8uY2xvbmVEZWVwKGJhdGNoVG9Qcm9jZXNzKTtcblxuICAgIC8vIGEuIOWQiOW5tuebuOmCu+eahOWQjOe7hOS6i+S7tlxuICAgIGNvbnN0IGZpbmFsSm9iczogRXZlbnRKb2JbXSA9IFtdO1xuICAgIC8vIOS9v+eUqCBmb3IuLi5vZiDlvqrnjq/vvIzorqnpgLvovpHmm7TmuIXmmbBcbiAgICBmb3IgKGNvbnN0IGN1cnJlbnRKb2Igb2YgYmF0Y2hUb1Byb2Nlc3MpIHtcbiAgICAgIC8vIOWmguaenOaYr+esrOS4gOS4quS6i+S7tu+8jOebtOaOpeaUvuWFpee7k+aenOS4rVxuICAgICAgaWYgKGZpbmFsSm9icy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZmluYWxKb2JzLnB1c2goY3VycmVudEpvYik7XG4gICAgICAgIGNvbnRpbnVlOyAvLyDnu6fnu63lpITnkIbkuIvkuIDkuKrkuovku7ZcbiAgICAgIH1cblxuICAgICAgY29uc3QgcHJldkpvYiA9IGZpbmFsSm9ic1tmaW5hbEpvYnMubGVuZ3RoIC0gMV07XG5cbiAgICAgIC8vIDEuIOajgOafpeS6i+S7tuWvueWGslxuICAgICAgY29uc3QgZXhwZWN0ZWROZXh0RXZlbnQgPSBFVkVOVF9DT0xMSVNJT05fTUFQLmdldChwcmV2Sm9iLnR5cGUpO1xuICAgICAgY29uc3QgdGltZURpZmZlcmVuY2UgPSBjdXJyZW50Sm9iLnRpbWVzdGFtcCAtIHByZXZKb2IudGltZXN0YW1wO1xuICAgICAgaWYgKGV4cGVjdGVkTmV4dEV2ZW50ICYmIGN1cnJlbnRKb2IudHlwZSA9PT0gZXhwZWN0ZWROZXh0RXZlbnQgJiYgdGltZURpZmZlcmVuY2UgPD0gMzAwKSB7XG4gICAgICAgIGxvZ2dlci5sb2coXG4gICAgICAgICAgJ3Byb2Nlc3NRdWV1ZScsXG4gICAgICAgICAgYOajgOa1i+WIsOebuOmCu+S6i+S7tuWvueWGsjogJHtwcmV2Sm9iLnR5cGV9IOWSjCAke2N1cnJlbnRKb2IudHlwZX0gKOaXtumXtOW3rjogJHt0aW1lRGlmZmVyZW5jZX1tcynjgILlsIblv73nlaXov5nkuKTkuKrkuovku7bjgIJgLFxuICAgICAgICApO1xuICAgICAgICBmaW5hbEpvYnMucG9wKCk7IC8vIOenu+mZpOWJjeS4gOS4quS6i+S7tlxuICAgICAgICBjb250aW51ZTsgLy8g6Lez6L+H5b2T5YmN5LqL5Lu277yM5LuO6ICM5b+955Wl5Lik6ICFXG4gICAgICB9XG5cbiAgICAgIC8vIDIuIOWmguaenOS4jeWvueWGsu+8jOWImeajgOafpeWQjOe7hOS6i+S7tuWQiOW5tlxuICAgICAgY29uc3QgcHJldkdyb3VwID0gZ2V0RXZlbnRHcm91cChwcmV2Sm9iLnR5cGUpO1xuICAgICAgY29uc3QgY3VycmVudEdyb3VwID0gZ2V0RXZlbnRHcm91cChjdXJyZW50Sm9iLnR5cGUpO1xuXG4gICAgICAvLyDlrprkuYnlkIjlubbmnaHku7bvvIzorqkgaWYg5Yik5pat55qE5oSP5Zu+5pu05riF5pmwXG4gICAgICBjb25zdCBhcmVJblNhbWVHcm91cCA9IHByZXZHcm91cCA9PT0gY3VycmVudEdyb3VwO1xuICAgICAgY29uc3QgaXNNZXJnZWFibGVHcm91cCA9IHByZXZHcm91cCA9PT0gJ1dSSVRFJyB8fCBwcmV2R3JvdXAgPT09ICdTWU5DJztcblxuICAgICAgLy8g5aaC5p6c5ruh6Laz5ZCI5bm25p2h5Lu2XG4gICAgICBpZiAoYXJlSW5TYW1lR3JvdXAgJiYgaXNNZXJnZWFibGVHcm91cCkge1xuICAgICAgICAvLyDnlKjlvZPliY3kuovku7bopobnm5bmjonnu5PmnpzmlbDnu4TkuK3nmoTmnIDlkI7kuIDkuKrkuovku7ZcbiAgICAgICAgZmluYWxKb2JzW2ZpbmFsSm9icy5sZW5ndGggLSAxXSA9IGN1cnJlbnRKb2I7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDlkKbliJnvvIzlsIblvZPliY3kuovku7bov73liqDliLDnu5PmnpzmlbDnu4RcbiAgICAgICAgZmluYWxKb2JzLnB1c2goY3VycmVudEpvYik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gYi4g5omT5Y2w5ZCI5bm25pel5b+XXG4gICAgY29uc29sZS5ncm91cENvbGxhcHNlZChgW0VSQV0g5LqL5Lu26Zif5YiX5aSE55CGOiAke29yaWdpbmFsRXZlbnRzLmxlbmd0aH0gLT4gJHtmaW5hbEpvYnMubGVuZ3RofWApO1xuICAgIGxvZ2dlci5sb2coXG4gICAgICAn5ZCI5bm25YmNJyxcbiAgICAgIG9yaWdpbmFsRXZlbnRzLm1hcChlID0+IGUudHlwZSksXG4gICAgKTtcbiAgICBsb2dnZXIubG9nKFxuICAgICAgJ+WQiOW5tuWQjicsXG4gICAgICBmaW5hbEpvYnMubWFwKGUgPT4gZS50eXBlKSxcbiAgICApO1xuICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcblxuICAgIC8vIC0tLSAyLiDkuKXmoLzmjInpobrluo/miafooYzlkIjlubblkI7nmoTku7vliqEgLS0tXG4gICAgZm9yIChjb25zdCBqb2Igb2YgZmluYWxKb2JzKSB7XG4gICAgICBjb25zdCB7IHR5cGU6IGV2ZW50VHlwZSwgZGV0YWlsIH0gPSBqb2I7XG4gICAgICBjb25zdCBldmVudEdyb3VwID0gZ2V0RXZlbnRHcm91cChldmVudFR5cGUpO1xuICAgICAgbGV0IG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXG4gICAgICAvLyDlnKjmr4/ova7ku7vliqHlvIDlp4vml7bvvIzliJ3lp4vljJbmk43kvZzorrDlvZXlmahcbiAgICAgIGNvbnN0IGFjdGlvbnNUYWtlbiA9IHsgcm9sbGJhY2s6IGZhbHNlLCBhcHBseTogZmFsc2UsIHJlc3luYzogZmFsc2UgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gKirliY3nva7ov4fmu6QqKjog5b+955Wl5Y2V54us5a2Y5Zyo55qE5a+55Yay5qOA5rWL5Zmo5LqL5Lu2XG4gICAgICAgIGlmIChldmVudEdyb3VwID09PSAnQ09MTElTSU9OX0RFVEVDVE9SUycpIHtcbiAgICAgICAgICAvLyDmraTnsbvkuovku7bku4XnlKjkuo7lr7nlhrLvvIzlpoLmnpzlroPljZXni6zlrZjlnKjvvIjmnKrooqvlr7nlhrLmjonvvInvvIzliJnkuI3miafooYzku7vkvZXmk43kvZzjgIJcbiAgICAgICAgICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCBg5LqL5Lu2ICR7ZXZlbnRUeXBlfSDmmK/kuIDkuKrlr7nlhrLmo4DmtYvlmajvvIzml6Dni6znq4vmk43kvZzvvIzlt7Llv73nlaXjgIJgKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vICoq5YmN572u5L+d6ZqcKio6IOehruS/neacgOaWsOa2iOaBr+aciSBNSyDlubborr7nva7ml6Xlv5fkuIrkuIvmlofjgIJcbiAgICAgICAgY29uc3QgeyBtaywgbWVzc2FnZV9pZDogbXNnSWQsIGlzTmV3S2V5IH0gPSBhd2FpdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UoKTtcbiAgICAgICAgbG9nQ29udGV4dC5tayA9IG1rO1xuICAgICAgICBtZXNzYWdlX2lkID0gbXNnSWQ7XG5cbiAgICAgICAgLy8g5aaC5p6cIGVuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZSDliJrliJrms6jlhaXkuobkuIDkuKrmlrDnmoQgTUvvvIzlsLHorr7nva7lv73nlaXop4TliJnjgIJcbiAgICAgICAgaWYgKGlzTmV3S2V5ICYmIG1rKSB7XG4gICAgICAgICAgbWtUb0lnbm9yZSA9IHtcbiAgICAgICAgICAgIG1rOiBtayxcbiAgICAgICAgICAgIGlnbm9yZUNvdW50OiBSRU5ERVJfRVZFTlRTX1RPX0lHTk9SRV9BRlRFUl9NS19JTkpFQ1RJT04sXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vICoq5qC45b+D5LyY5YyWKio6IOW/veeVpeeUsSBNSyDms6jlhaXoh6rouqvop6blj5HnmoTmuLLmn5Pkuovku7ZcbiAgICAgICAgaWYgKG1rVG9JZ25vcmUgJiYgZXZlbnRUeXBlID09PSB0YXZlcm5fZXZlbnRzLkNIQVJBQ1RFUl9NRVNTQUdFX1JFTkRFUkVEICYmIG1rID09PSBta1RvSWdub3JlLm1rKSB7XG4gICAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAgICdwcm9jZXNzUXVldWUnLFxuICAgICAgICAgICAgYOW/veeVpeeUsSBNSyAoJHtta1RvSWdub3JlLm1rfSkg5rOo5YWl6Kem5Y+R55qE5YaX5L2Z5riy5p+T5LqL5Lu244CC5Ymp5L2Z5b+955Wl5qyh5pWwOiAke21rVG9JZ25vcmUuaWdub3JlQ291bnQgLSAxfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBta1RvSWdub3JlLmlnbm9yZUNvdW50LS07XG4gICAgICAgICAgaWYgKG1rVG9JZ25vcmUuaWdub3JlQ291bnQgPD0gMCkge1xuICAgICAgICAgICAgbWtUb0lnbm9yZSA9IG51bGw7IC8vIOW/veeVpeasoeaVsOeUqOWujO+8jOmHjee9rlxuICAgICAgICAgICAgbG9nZ2VyLmxvZygncHJvY2Vzc1F1ZXVlJywgYOW/veeVpeasoeaVsOeUqOWujGApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb250aW51ZTsgLy8g6Lez6L+H5q2k5LqL5Lu255qE5aSE55CGXG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZXIubG9nKCdwcm9jZXNzUXVldWUnLCBg5omn6KGM5Lu75YqhOiAke2V2ZW50VHlwZX0gKOWIhue7hDogJHtldmVudEdyb3VwfSlgKTtcblxuICAgICAgICAvLyAqKuS7u+WKoeWIhuWPkSoqXG4gICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc1F1ZXVlIC0gdGFzayBkaXNwYXRjaCcsIGDliIblj5Hkuovku7Y6ICR7ZXZlbnRUeXBlfWAsIHsgZGV0YWlsLCBldmVudEdyb3VwIH0pO1xuICAgICAgICBpZiAoZXZlbnRHcm91cCA9PT0gJ1dSSVRFJykge1xuICAgICAgICAgIC8vIOWFs+mUru+8muWGmeWFpeWJjeWFiOWbnua7mu+8jOehruS/neaTjeS9nOeahOW5guetieaAp+OAglxuICAgICAgICAgIC8vIOWNs+S9v+S6i+S7tuiiq+aEj+WkluinpuWPkeWkmuasoe+8jOS5n+WPquS8muS6p+eUn+S4gOasoeacieaViOWGmeWFpeOAglxuICAgICAgICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICAgICAgICAgIGlmIChtc2cpIHtcbiAgICAgICAgICAgIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgICAgICAgICAgIGlmIChNSykge1xuICAgICAgICAgICAgICBhd2FpdCByb2xsYmFja0J5TWsoTUssIHRydWUpO1xuICAgICAgICAgICAgICBhY3Rpb25zVGFrZW4ucm9sbGJhY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBhd2FpdCBBcHBseVZhckNoYW5nZSgpO1xuICAgICAgICAgIGFjdGlvbnNUYWtlbi5hcHBseSA9IHRydWU7XG5cbiAgICAgICAgICAvLyDlnKjlj5jph4/lhpnlhaXlrozmiJDlkI7vvIzlvLrliLbph43mlrDmuLLmn5Pmtojmga/ku6Xop6blj5Hlro9cbiAgICAgICAgICBmb3JjZVJlbmRlclJlY2VudE1lc3NhZ2VzKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRHcm91cCA9PT0gJ1NZTkMnKSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUgLSB0YXNrIGRpc3BhdGNoJywgYOS6i+S7tiAke2V2ZW50VHlwZX0g6Kem5Y+R54q25oCB5ZCM5q2l5rWB56iLLi4uYCk7XG4gICAgICAgICAgY29uc3QgaXNGdWxsU3luYyA9IGV2ZW50VHlwZSA9PT0gJ21hbnVhbF9mdWxsX3N5bmMnO1xuICAgICAgICAgIGF3YWl0IHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlKGlzRnVsbFN5bmMpO1xuICAgICAgICAgIGFjdGlvbnNUYWtlbi5yZXN5bmMgPSB0cnVlO1xuICAgICAgICAgIC8vIOWcqOWQjOatpeWujOaIkOWQju+8jOW8uuWItumHjeaWsOa4suafk+a2iOaBr+S7peinpuWPkeWuj1xuICAgICAgICAgIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKTtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudEdyb3VwID09PSAnQVBJJykge1xuICAgICAgICAgIC8vIEFQSSDkuovku7bmmK/igJzljbPlj5HljbPlv5jigJ3nmoTvvIzlkIzmraXosIPnlKjlpITnkIblmajlsIbku7vliqHmjqjlhaUgYXBpLnRzIOeahOmYn+WIl+WQjueri+WNs+i/lOWbnu+8jOS4jemYu+WhnuS6i+S7tumYn+WIl+OAglxuICAgICAgICAgIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLklOU0VSVF9CWV9PQkpFQ1QpIGluc2VydEJ5T2JqZWN0KGRldGFpbCk7XG4gICAgICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5VUERBVEVfQllfT0JKRUNUKSB1cGRhdGVCeU9iamVjdChkZXRhaWwpO1xuICAgICAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuSU5TRVJUX0JZX1BBVEgpIGluc2VydEJ5UGF0aChkZXRhaWwucGF0aCwgZGV0YWlsLnZhbHVlKTtcbiAgICAgICAgICBlbHNlIGlmIChldmVudFR5cGUgPT09IEVSQV9BUElfRVZFTlRTLlVQREFURV9CWV9QQVRIKSB1cGRhdGVCeVBhdGgoZGV0YWlsLnBhdGgsIGRldGFpbC52YWx1ZSk7XG4gICAgICAgICAgZWxzZSBpZiAoZXZlbnRUeXBlID09PSBFUkFfQVBJX0VWRU5UUy5ERUxFVEVfQllfT0JKRUNUKSBkZWxldGVCeU9iamVjdChkZXRhaWwpO1xuICAgICAgICAgIGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gRVJBX0FQSV9FVkVOVFMuREVMRVRFX0JZX1BBVEgpIGRlbGV0ZUJ5UGF0aChkZXRhaWwucGF0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnRHcm91cCA9PT0gJ1VQREFURV9NS19PTkxZJykge1xuICAgICAgICAgIC8vIOebkeWQrOatpOS6i+S7tuS7heeUqOS6juS4uueUqOaIt+a2iOaBr+WIm+W7uiBNS+OAglxuICAgICAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdwcm9jZXNzUXVldWUnLCBg5LqL5Lu2ICR7ZXZlbnRUeXBlfSDlpITnkIblvILluLg6ICR7ZXJyb3J9YCwgZXJyb3IpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgLy8g5LuF5b2T5pys6L2u5aSE55CG5Lit5a6e6ZmF5omn6KGM5LqGIEVSQSDmoLjlv4Pmk43kvZzml7bvvIzmiY3moKHlh4blubblub/mkq3kuovku7ZcbiAgICAgICAgLy8gLS0tIDMuIOinpuWPkeWGmeWFpeWujOaIkOS6i+S7tiAtLS1cbiAgICAgICAgaWYgKGFjdGlvbnNUYWtlbi5yb2xsYmFjayB8fCBhY3Rpb25zVGFrZW4uYXBwbHkgfHwgYWN0aW9uc1Rha2VuLnJlc3luYykge1xuICAgICAgICAgIC8vICoq5ZCO572u5L+d6ZqcKio6IOW8uuWItuagoeWHhiBgU2VsZWN0ZWRNa3NgIOeahOacgOaWsOiusOW9leOAglxuICAgICAgICAgIGF3YWl0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsoKTtcbiAgICAgICAgICAvLyDlnKjmiYDmnInmk43kvZzvvIjljIXmi6zmoKHlh4bvvInlrozmiJDlkI7vvIzojrflj5bmnIDmlrDnirbmgIHlubblub/mkq3kuovku7ZcbiAgICAgICAgICBpZiAobG9nQ29udGV4dC5tayAmJiBtZXNzYWdlX2lkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhLCBzdGF0OiBzdGF0RGF0YSB9ID0gZ2V0RXJhRGF0YSgpO1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhRGF0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAgICAgICAgIGNvbnN0IGVkaXRMb2dzID0gXy5nZXQobWV0YURhdGEsIExPR1NfUEFUSCwge30pO1xuICAgICAgICAgICAgY29uc3Qgc3RhdFdpdGhvdXRNZXRhID0gcmVtb3ZlTWV0YUZpZWxkcyhzdGF0RGF0YSk7XG5cbiAgICAgICAgICAgIGVtaXRXcml0ZURvbmVFdmVudCh7XG4gICAgICAgICAgICAgIG1rOiBsb2dDb250ZXh0Lm1rLFxuICAgICAgICAgICAgICBtZXNzYWdlX2lkOiBtZXNzYWdlX2lkLFxuICAgICAgICAgICAgICBhY3Rpb25zOiBhY3Rpb25zVGFrZW4sXG4gICAgICAgICAgICAgIHNlbGVjdGVkTWtzOiBzZWxlY3RlZE1rcyxcbiAgICAgICAgICAgICAgZWRpdExvZ3M6IGVkaXRMb2dzLFxuICAgICAgICAgICAgICBzdGF0OiBzdGF0RGF0YSxcbiAgICAgICAgICAgICAgc3RhdFdpdGhvdXRNZXRhOiBzdGF0V2l0aG91dE1ldGEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmuIXnkIbml6Xlv5fkuIrkuIvmlofvvIzkuLrkuIvkuIDkuKrkuovku7blgZrlh4blpIdcbiAgICAgICAgbG9nQ29udGV4dC5tayA9ICcnO1xuXG4gICAgICAgIC8vICoq6IqC5rWBKio6IOWcqOavj+S4queLrOeri+S7u+WKoeWQjumDvei/m+ihjOefreaaguetieW+he+8jOehruS/nemFkummhuW6leWxguacieaXtumXtOWujOaIkOWFtuW8guatpeaTjeS9nOOAglxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKCdwcm9jZXNzUXVldWUnLCAn5pys6L2u5om55qyh5aSE55CG5a6M5q+V44CCJyk7XG4gIH1cblxuICAvLyDpmJ/liJflpITnkIblrozmr5XvvIzph4rmlL7plIHvvIznrYnlvoXkuIvkuIDmrKHkuovku7blhaXpmJ/jgIJcbiAgaXNQcm9jZXNzaW5nID0gZmFsc2U7XG4gIGxvZ2dlci5sb2coJ3Byb2Nlc3NRdWV1ZScsICflpITnkIblmajnqbrpl7LvvIzlt7Lph4rmlL7plIHjgIInKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/event_queue.ts\n\n}");
  },
  "./src/ERA变量框架/force_macro_render.ts": 
  /*!*******************************************!*\
  !*** ./src/ERA变量框架/force_macro_render.ts ***!
  \*******************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceRenderRecentMessages: () => (/* binding */ forceRenderRecentMessages)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换管线。\n */\n\n\nconst log = new _utils__WEBPACK_IMPORTED_MODULE_1__.Logger('force_macro_render');\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\nfunction forceRenderMessage(messageId) {\n    return new Promise(resolve => {\n        const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n        const $message = $(messageSelector);\n        // 模拟点击“编辑”\n        $message.find('.mes_button.mes_edit').trigger('click');\n        // 给予UI响应时间, 然后模拟点击“确认”\n        setTimeout(() => {\n            $message.find('.mes_edit_done.menu_button').trigger('click');\n            resolve();\n        }, 50);\n    });\n}\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nasync function forceRenderRecentMessages() {\n    const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n    // 检查是否启用了强制重载功能\n    const forceReload = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载功能', false);\n    if (!forceReload) {\n        log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n        return; // 如果未启用，则不执行任何操作\n    }\n    // 获取要重载的消息数量，默认为1\n    const messageCount = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(scriptVars, '强制重载消息数', 1);\n    log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n    // 等待一小段时间, 确保变量更新已经完成\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const allMessages = getChatMessages('0-{{lastMessageId}}');\n    if (!allMessages || allMessages.length === 0) {\n        log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n        return;\n    }\n    // 根据脚本变量设置的数量来截取最近的消息\n    const recentMessages = allMessages.slice(-messageCount);\n    for (const message of recentMessages) {\n        log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n        await forceRenderMessage(message.message_id);\n        // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n        await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2ZvcmNlX21hY3JvX3JlbmRlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7OztHQUdHO0FBRW9CO0FBQ1U7QUFFakMsTUFBTSxHQUFHLEdBQUcsSUFBSSwwQ0FBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFFN0M7Ozs7R0FJRztBQUNILFNBQVMsa0JBQWtCLENBQUMsU0FBaUI7SUFDM0MsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtRQUMzQixNQUFNLGVBQWUsR0FBRyxrQkFBa0IsU0FBUyxJQUFJLENBQUM7UUFDeEQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBRXBDLFdBQVc7UUFDWCxRQUFRLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXZELHVCQUF1QjtRQUN2QixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsUUFBUSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM3RCxPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVEOzs7R0FHRztBQUNJLEtBQUssVUFBVSx5QkFBeUI7SUFDN0MsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRTlFLGdCQUFnQjtJQUNoQixNQUFNLFdBQVcsR0FBRyxpREFBSyxDQUFDLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdkQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2pCLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUN6RCxPQUFPLENBQUMsaUJBQWlCO0lBQzNCLENBQUM7SUFFRCxrQkFBa0I7SUFDbEIsTUFBTSxZQUFZLEdBQUcsaURBQUssQ0FBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3JELEdBQUcsQ0FBQyxHQUFHLENBQUMsMkJBQTJCLEVBQUUsZUFBZSxZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBRXBFLHNCQUFzQjtJQUN0QixNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBRXhELE1BQU0sV0FBVyxHQUFHLGVBQWUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzNELElBQUksQ0FBQyxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUM3QyxHQUFHLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDMUQsT0FBTztJQUNULENBQUM7SUFFRCxzQkFBc0I7SUFDdEIsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRXhELEtBQUssTUFBTSxPQUFPLElBQUksY0FBYyxFQUFFLENBQUM7UUFDckMsR0FBRyxDQUFDLEtBQUssQ0FBQywyQkFBMkIsRUFBRSxhQUFhLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQzFFLE1BQU0sa0JBQWtCLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzdDLDZCQUE2QjtRQUM3QixNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFDRCxHQUFHLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ2xELENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9mb3JjZV9tYWNyb19yZW5kZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDlvLrliLblro/muLLmn5PmqKHlnZdcbiAqIEBkZXNjcmlwdGlvbiDpgJrov4fmqKHmi5/nlKjmiLdVSeaTjeS9nCwg5by65Yi26YWS6aaG6YeN5paw5riy5p+T5raI5oGvLCDku6Xop6blj5HlrozmlbTnmoTlro/mm7/mjaLnrqHnur/jgIJcbiAqL1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ2ZvcmNlX21hY3JvX3JlbmRlcicpO1xuXG4vKipcbiAqIOW8uuWItumHjeaWsOa4suafk+WNleadoea2iOaBr+OAglxuICogQHBhcmFtIG1lc3NhZ2VJZCDopoHlvLrliLbmuLLmn5PnmoTmtojmga9JROOAglxuICogQHJldHVybnMg5LiA5LiqIFByb21pc2UsIOWcqOaooeaLn+eCueWHu+WujOaIkOWQjiByZXNvbHZl44CCXG4gKi9cbmZ1bmN0aW9uIGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlSWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZVNlbGVjdG9yID0gYGRpdi5tZXNbbWVzaWQ9XCIke21lc3NhZ2VJZH1cIl1gO1xuICAgIGNvbnN0ICRtZXNzYWdlID0gJChtZXNzYWdlU2VsZWN0b3IpO1xuXG4gICAgLy8g5qih5ouf54K55Ye74oCc57yW6L6R4oCdXG4gICAgJG1lc3NhZ2UuZmluZCgnLm1lc19idXR0b24ubWVzX2VkaXQnKS50cmlnZ2VyKCdjbGljaycpO1xuXG4gICAgLy8g57uZ5LqIVUnlk43lupTml7bpl7QsIOeEtuWQjuaooeaLn+eCueWHu+KAnOehruiupOKAnVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgJG1lc3NhZ2UuZmluZCgnLm1lc19lZGl0X2RvbmUubWVudV9idXR0b24nKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0sIDUwKTtcbiAgfSk7XG59XG5cbi8qKlxuICog5by65Yi26YeN5paw5riy5p+T5pyA6L+R55qETuadoea2iOaBrywg5Lul56Gu5L+d5a6P6KKr5q2j56Gu5pu/5o2i44CCXG4gKiDmmK/lkKbmiafooYzku6Xlj4rmuLLmn5PnmoTmlbDph4/nlLHohJrmnKzlj5jph4/mjqfliLbjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMoKSB7XG4gIGNvbnN0IHNjcmlwdFZhcnMgPSBnZXRWYXJpYWJsZXMoeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0pO1xuXG4gIC8vIOajgOafpeaYr+WQpuWQr+eUqOS6huW8uuWItumHjei9veWKn+iDvVxuICBjb25zdCBmb3JjZVJlbG9hZCA9IF8uZ2V0KHNjcmlwdFZhcnMsICflvLrliLbph43ovb3lip/og70nLCBmYWxzZSk7XG4gIGlmICghZm9yY2VSZWxvYWQpIHtcbiAgICBsb2cuZGVidWcoJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCAn5by65Yi26YeN6L295Yqf6IO95pyq5ZCv55SoLCDot7Pov4fjgIInKTtcbiAgICByZXR1cm47IC8vIOWmguaenOacquWQr+eUqO+8jOWImeS4jeaJp+ihjOS7u+S9leaTjeS9nFxuICB9XG5cbiAgLy8g6I635Y+W6KaB6YeN6L2955qE5raI5oGv5pWw6YeP77yM6buY6K6k5Li6MVxuICBjb25zdCBtZXNzYWdlQ291bnQgPSBfLmdldChzY3JpcHRWYXJzLCAn5by65Yi26YeN6L295raI5oGv5pWwJywgMSk7XG4gIGxvZy5sb2coJ2ZvcmNlUmVuZGVyUmVjZW50TWVzc2FnZXMnLCBg5byA5aeL5by65Yi26YeN6L29LCDmlbDph486ICR7bWVzc2FnZUNvdW50fWApO1xuXG4gIC8vIOetieW+heS4gOWwj+auteaXtumXtCwg56Gu5L+d5Y+Y6YeP5pu05paw5bey57uP5a6M5oiQXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG5cbiAgY29uc3QgYWxsTWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nKTtcbiAgaWYgKCFhbGxNZXNzYWdlcyB8fCBhbGxNZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2cud2FybignZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICfml6Dms5Xojrflj5bliLDku7vkvZXmtojmga8sIOe7iOatoumHjei9veOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOagueaNruiEmuacrOWPmOmHj+iuvue9rueahOaVsOmHj+adpeaIquWPluacgOi/keeahOa2iOaBr1xuICBjb25zdCByZWNlbnRNZXNzYWdlcyA9IGFsbE1lc3NhZ2VzLnNsaWNlKC1tZXNzYWdlQ291bnQpO1xuXG4gIGZvciAoY29uc3QgbWVzc2FnZSBvZiByZWNlbnRNZXNzYWdlcykge1xuICAgIGxvZy5kZWJ1ZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsIGDmraPlnKjlvLrliLbmuLLmn5Pmtojmga86ICR7bWVzc2FnZS5tZXNzYWdlX2lkfWApO1xuICAgIGF3YWl0IGZvcmNlUmVuZGVyTWVzc2FnZShtZXNzYWdlLm1lc3NhZ2VfaWQpO1xuICAgIC8vIOWcqOavj+asoeaTjeS9nOS5i+mXtOefreaaguaaguWBnCwg6YG/5YWN5pON5L2c6L+H5b+r5a+86Ie0VUnpl67popjjgIJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gIH1cbiAgbG9nLmxvZygnZm9yY2VSZW5kZXJSZWNlbnRNZXNzYWdlcycsICflvLrliLbph43ovb3lrozmiJDjgIInKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/force_macro_render.ts\n\n}");
  },
  "./src/ERA变量框架/index.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/index.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _event_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./event_queue */ \"./src/ERA变量框架/event_queue.ts\");\n/* harmony import */ var _query__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./query */ \"./src/ERA变量框架/query.ts\");\n/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\n\n// ===============================\n// 事件监听器注册\n// ===============================\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n    ..._constants__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.WRITE,\n    ..._constants__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.SYNC,\n    ..._constants__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.API,\n    ..._constants__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.UPDATE_MK_ONLY,\n    ..._constants__WEBPACK_IMPORTED_MODULE_0__.EVENT_GROUPS.COLLISION_DETECTORS,\n];\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n    // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n    // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n    eventOn(ev, (detail) => (0,_event_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)(ev, detail));\n});\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => (0,_event_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => (0,_event_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => (0,_event_queue__WEBPACK_IMPORTED_MODULE_1__.pushToQueue)('manual_full_sync'));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7QUFFVTtBQUU4QjtBQUNDO0FBRTVDLDRCQUE0QjtBQUNYO0FBRWpCLGtDQUFrQztBQUNsQyxVQUFVO0FBQ1Ysa0NBQWtDO0FBRWxDOzs7R0FHRztBQUNILE1BQU0sY0FBYyxHQUFHO0lBQ3JCLEdBQUcsb0RBQVksQ0FBQyxLQUFLO0lBQ3JCLEdBQUcsb0RBQVksQ0FBQyxJQUFJO0lBQ3BCLEdBQUcsb0RBQVksQ0FBQyxHQUFHO0lBQ25CLEdBQUcsb0RBQVksQ0FBQyxjQUFjO0lBQzlCLEdBQUcsb0RBQVksQ0FBQyxtQkFBbUI7Q0FDcEMsQ0FBQztBQUVGLHdCQUF3QjtBQUN4QixvQkFBb0I7QUFDcEIsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtJQUMxQixtQ0FBbUM7SUFDbkMsd0RBQXdEO0lBQ3hELE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFXLEVBQUUsRUFBRSxDQUFDLHlEQUFXLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFDLENBQUM7QUFFSCx3QkFBd0I7QUFDeEIsNEJBQTRCO0FBQzVCLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMseURBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO0FBQ3JFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMseURBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO0FBQ3BFLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMseURBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDkuLvlhaXlj6PkuI7kuovku7bnm5HlkKzmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25piv5pW05LiqIEVSQSDlj5jph4/moYbmnrbnmoTotbfngrnjgILlroPnmoTogYzotKPpnZ7luLjmuIXmmbDlkozkuJPkuIDvvJpcbiAqIDEuICoq5a6a5LmJ55uR5ZCs6IyD5Zu0Kio6IOWjsOaYjuahhuaetuaJgOWFs+W/g+eahOaJgOacieS6i+S7tuexu+Wei+OAglxuICogMi4gKirms6jlhoznm5HlkKzlmagqKjog5Li65LiK6L+w5omA5pyJ5LqL5Lu25rOo5YaM55uR5ZCs5Zmo44CCXG4gKiAzLiAqKue7n+S4gOa0vuWPkSoqOiDlvZPku7vkvZXkuIDkuKrooqvnm5HlkKznmoTkuovku7bop6blj5Hml7bvvIzlroPkuI3ov5vooYzku7vkvZXpgLvovpHlpITnkIbvvIxcbiAqICAgIOiAjOaYr+eri+WNs+WwhuivpeS6i+S7tu+8iOWMheaLrOS6i+S7tuexu+Wei+WSjOmZhOW4puaVsOaNru+8ieWOn+WwgeS4jeWKqOWcsOaOqOWFpeWIsCBgZXZlbnRfcXVldWUudHNgXG4gKiAgICDkuK3nmoTkuovku7blpITnkIbpmJ/liJfkuK3jgIJcbiAqXG4gKiDov5nnp43orr7orqHkvZPnjrDkuoboia/lpb3nmoQqKuWFs+azqOeCueWIhuemuyoq5Y6f5YiZ77yaYGluZGV4LnRzYCDlj6rotJ/otKPigJzlkKzigJ3vvIzogIwgYGV2ZW50X3F1ZXVlLnRzYFxuICog6LSf6LSj4oCc5oCd6ICD4oCd5ZKM4oCc6KGM5Yqo4oCd44CC6L+Z5L2/5b6X5LqL5Lu255qE5p2l5rqQ5ZKM5aSE55CG6YC76L6R5a6M5YWo6Kej6ICm77yM6Z2e5bi45riF5pmw5LiU5piT5LqO57u05oqk44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFVkVOVF9HUk9VUFMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBwdXNoVG9RdWV1ZSB9IGZyb20gJy4vZXZlbnRfcXVldWUnO1xuXG4vLyDlr7zlhaXmn6Xor6LmqKHlnZcsIOS7peazqOWGjCB7e0VSQTouLi59fSDlro9cbmltcG9ydCAnLi9xdWVyeSc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOS6i+S7tuebkeWQrOWZqOazqOWGjFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEBjb25zdCB7c3RyaW5nW119IGV2ZW50c1RvTGlzdGVuXG4gKiBAZGVzY3JpcHRpb24g5a6a5LmJ5LqG5omA5pyJ6ZyA6KaB6KKrIEVSQSDmoYbmnrbnm5HlkKznmoTkuovku7bjgIJcbiAqL1xuY29uc3QgZXZlbnRzVG9MaXN0ZW4gPSBbXG4gIC4uLkVWRU5UX0dST1VQUy5XUklURSxcbiAgLi4uRVZFTlRfR1JPVVBTLlNZTkMsXG4gIC4uLkVWRU5UX0dST1VQUy5BUEksXG4gIC4uLkVWRU5UX0dST1VQUy5VUERBVEVfTUtfT05MWSxcbiAgLi4uRVZFTlRfR1JPVVBTLkNPTExJU0lPTl9ERVRFQ1RPUlMsXG5dO1xuXG4vLyDpgY3ljobkuovku7bliJfooajvvIzkuLrmr4/kuKrkuovku7bms6jlhozkuIDkuKrlm57osIPlh73mlbDjgIJcbi8vIOi/meS4quWbnuiwg+WHveaVsOaYr+aJgOacieS6i+S7tueahOe7n+S4gOWFpeWPo+OAglxuZXZlbnRzVG9MaXN0ZW4uZm9yRWFjaChldiA9PiB7XG4gIC8vIGBldmVudE9uYCDmmK/phZLppobliqnmiYvmj5DkvpvnmoTlhajlsYDlh73mlbDvvIznlKjkuo7ms6jlhozkuovku7bnm5HlkKzjgIJcbiAgLy8g5b2T5LqL5Lu2IGBldmAg6Kem5Y+R5pe277yM5Zue6LCD5Ye95pWw6KKr6LCD55So77yM5bm25bCG5LqL5Lu257G75Z6LIGBldmAg5ZKM5LqL5Lu26K+m5oOFIGBkZXRhaWxgIOaOqOWFpemYn+WIl+OAglxuICBldmVudE9uKGV2LCAoZGV0YWlsOiBhbnkpID0+IHB1c2hUb1F1ZXVlKGV2LCBkZXRhaWwpKTtcbn0pO1xuXG4vLyDkuLrphZLppobliqnmiYvohJrmnKznlYzpnaLkuK3nmoTmiYvliqjmjInpkq7ms6jlhoznm5HlkKzlmajjgIJcbi8vIOeCueWHu+aMiemSruaXtu+8jOWQjOagt+aYr+WQkemYn+WIl+S4reaOqOWFpeS4gOS4queJueWumuexu+Wei+eahOS6i+S7tuOAglxuZXZlbnRPbihnZXRCdXR0b25FdmVudCgn5YaZ5YWl5Y+Y6YeP5L+u5pS5JyksICgpID0+IHB1c2hUb1F1ZXVlKCdtYW51YWxfd3JpdGUnKSk7XG5ldmVudE9uKGdldEJ1dHRvbkV2ZW50KCfmiYvliqjlkIzmraXnirbmgIEnKSwgKCkgPT4gcHVzaFRvUXVldWUoJ21hbnVhbF9zeW5jJykpO1xuZXZlbnRPbihnZXRCdXR0b25FdmVudCgn5by65Yi25a6M5YWo6YeN566XJyksICgpID0+IHB1c2hUb1F1ZXVlKCdtYW51YWxfZnVsbF9zeW5jJykpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/index.ts\n\n}");
  },
  "./src/ERA变量框架/insert.ts": 
  /*!*******************************!*\
  !*** ./src/ERA变量框架/insert.ts ***!
  \*******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyInsertAtLevel: () => (/* binding */ applyInsertAtLevel),\n/* harmony export */   processInsertBlocks: () => (/* binding */ processInsertBlocks)\n/* harmony export */ });\n/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./template */ \"./src/ERA变量框架/template.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_1__.Logger('insert');\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nfunction applyInsertAtLevel(statData, basePath, patchObj, editLog, inheritedContent, parentData) {\n    // --- 1. 确定当前层级的模板内容 ---\n    // 调用 resolveTemplate，它现在直接使用传入的 parentData\n    const localTplContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.resolveTemplate)(inheritedContent, parentData);\n    logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n        statData: _.cloneDeep(statData),\n    });\n    // --- 2. 检查路径存在性，决定执行策略 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    logger.debug('applyInsertAtLevel', `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`, currentNodeInVars);\n    // **策略一：原子性插入 (Atomic Insert)**\n    // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n    if (basePath && currentNodeInVars === undefined) {\n        // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n        const composed = (0,_template__WEBPACK_IMPORTED_MODULE_0__.applyTemplateToPatch)(localTplContent, patchObj);\n        const finalValue = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.sanitizeArrays)(composed); // 清理数组中的 null 等无效值。\n        logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n        _.set(statData, basePath, finalValue); // 执行插入。\n        editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n        logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n        return; // 插入完成，终止递归。\n    }\n    // **策略二：递归补充 (Recursive Supplement)**\n    // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n    if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n        logger.debug('applyInsertAtLevel', `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`);\n        for (const key of Object.keys(patchObj)) {\n            const subPath = basePath ? `${basePath}.${key}` : key;\n            const subPatch = patchObj[key];\n            // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n            const subInheritedContent = (0,_template__WEBPACK_IMPORTED_MODULE_0__.getInheritedTemplateContent)(localTplContent, key);\n            logger.debug('applyInsertAtLevel', `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`);\n            // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n            applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n        }\n    }\n    else if (basePath) {\n        // **插入失败**\n        // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n        // 则记录警告。insert 不会覆盖已存在的值。\n        logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`);\n    }\n    // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n/**\n * 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nasync function processInsertBlocks(allInserts, editLog) {\n    if (allInserts.length > 0) {\n        await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n            logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(stat));\n            return stat;\n        });\n        /*\n         * N.B. 必须对每个 insertRoot 单独调用 updateVariablesWith，而不是将所有操作合并到一次调用中。\n         * 这是为了确保在同一条消息内，前一个 <VariableInsert> 块中插入的模板或数据，\n         * 可以被后一个 <VariableInsert> 或 <VariableEdit> 块访问和使用。\n         * 每次 await updateVariablesWith 完成后，变量状态都会被刷新，从而使后续操作能看到最新的结果。\n         */\n        for (const insertRoot of allInserts) {\n            if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot))\n                continue;\n            try {\n                await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(stat => {\n                    logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n                    applyInsertAtLevel(stat, '', insertRoot, editLog, null, null);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processInsertBlocks', '所有 VariableInsert 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBSyxDQUFDLHFCQUFxQixFQUFFLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDcEYsbUNBQW1DO29CQUNuQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUM5RCxPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO2dCQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFxQixFQUFFLHFCQUFxQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pGLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDO0lBQzlELENBQUM7QUFDSCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvaW5zZXJ0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+aPkuWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfotJ/otKPlpITnkIYgYDxWYXJpYWJsZUluc2VydD5gIOaMh+S7pO+8jOWunueOsOWPmOmHj+eahOmdnuegtOWdj+aAp+aPkuWFpe+8jOW5tueUn+aIkOebuOW6lOeahCBgRWRpdExvZ2DjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogLSAqKuiBjOi0o+WNleS4gCoqOiDmqKHlnZflj6rlhbPlv4PlpoLkvZXmoLnmja7mjIfku6Tkv67mlLnlj5jph4/nirbmgIHlubbnlJ/miJDml6Xlv5fvvIzkuI3lhbPlv4PmjIfku6Tku47kvZXogIzmnaXjgIJcbiAqIC0gKirljp/lrZDmgKfmk43kvZwqKjogYGFwcGx5SW5zZXJ0QXRMZXZlbGAg5a6e546w5LqG5Y6f5a2Q5oCn55qE5o+S5YWl77yM56Gu5L+d5LqG5pWw5o2u57uT5p6E55qE5a6M5pW05oCn44CCXG4gKiAgIOWmguaenOS4gOS4quWfuuehgOi3r+W+hOS4jeWtmOWcqO+8jOWug+S8muWwhuaVtOS4quWvueixoeS9nOS4uuS4gOaVtOS4quWNleWFg+S4gOasoeaAp+aPkuWFpeOAglxuICogLSAqKuWuuemUmeaApyoqOiDlvZPpgYfliLDml6DmlYjot6/lvoTvvIjlpoLlsJ3or5XlkJHlt7LlrZjlnKjnmoTot6/lvoTmj5LlhaXvvInml7bvvIzkvJrot7Pov4for6XmnaHmjIfku6Tlubbnu6fnu63lpITnkIblhbbku5bmnInmlYjmjIfku6TvvIxcbiAqICAg6ICM5LiN5piv5Lit5pat5pW05Liq5YaZ5YWl6L+H56iL44CCXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgYXBwbHlUZW1wbGF0ZVRvUGF0Y2gsIGdldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCwgcmVzb2x2ZVRlbXBsYXRlIH0gZnJvbSAnLi90ZW1wbGF0ZSc7XG5pbXBvcnQgeyBMb2dnZXIsIHNhbml0aXplQXJyYXlzLCB1cGRhdGVFcmFTdGF0RGF0YSB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdpbnNlcnQnKTtcblxuLyoqXG4gKiAqKuOAkOmAkuW9kuaPkuWFpeOAkSoqXG4gKiDlrp7njrDkuoYgYDxWYXJpYWJsZUluc2VydD5gIOeahOaguOW/g+mAu+i+ke+8mioq6Z2e56C05Z2P5oCn5ZywKirpgJLlvZLmj5LlhaXlgLzjgIJcbiAqXG4gKiAqKuaguOW/g+inhOWImSoqOlxuICogMS4gKirlj6rlnKjot6/lvoTkuI3lrZjlnKjml7blhpnlhaUqKuOAguWmguaenOi3r+W+hOW3suWtmOWcqO+8jOWImei3s+i/h+ivpei3r+W+hOeahOWGmeWFpeOAglxuICogMi4gKirljp/lrZDmgKfmj5LlhaUqKuOAguWmguaenOS4gOS4quWfuuehgOi3r+W+hO+8iOWmgiBgcGxheWVyLmludmVudG9yeWDvvInkuI3lrZjlnKjvvIzlroPkvJrlsIbmlbTkuKogYGludmVudG9yeWBcbiAqICAgIOWvueixoeS9nOS4uuS4gOaVtOS4quWNleWFg+S4gOasoeaAp+aPkuWFpe+8jOW5tuWPquiusOW9leS4gOadoSBgaW5zZXJ0YCDml6Xlv5fjgIJcbiAqIDMuICoq6YCS5b2S6KGl5YWFKirjgILlpoLmnpzln7rnoYDot6/lvoTlt7LlrZjlnKjvvIzlroPkvJrpgJLlvZLlnLDmt7HlhaXvvIzlsJ3or5XlnKjlhbbkuIvooaXlhYXmj5LlhaXmlrDnmoTlrZDot6/lvoTjgIJcbiAqIDQuICoq5qih5p2/5pSv5oyBKirjgILmlK/mjIHku44gYCR0ZW1wbGF0ZWAg5Lit57un5om/5qih5p2/77yM5a6e546w5pWw5o2u57uT5p6E55qE5aSN55So44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOS7juaMh+S7pOS4reino+aekOWHuueahOOAgeimgeW6lOeUqOS6juW9k+WJjeWxgue6p+eahOihpeS4geWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hO+8iOW8leeUqOS8oOmAku+8ieOAglxuICogQHBhcmFtIHthbnl9IGluaGVyaXRlZENvbnRlbnQgLSDku47kuIrlsYLnu6fmib/nmoTjgIHnuq/nsrnnmoTmqKHmnb/igJzlhoXlrrnigJ3lr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXJlbnREYXRhIC0g5b2T5YmN6IqC54K555qE54i26IqC54K55ZyoIGBzdGF0RGF0YWAg5Lit55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBseUluc2VydEF0TGV2ZWwoXG4gIHN0YXREYXRhOiBhbnksXG4gIGJhc2VQYXRoOiBzdHJpbmcsXG4gIHBhdGNoT2JqOiBhbnksXG4gIGVkaXRMb2c6IGFueVtdLFxuICBpbmhlcml0ZWRDb250ZW50OiBhbnksXG4gIHBhcmVudERhdGE6IGFueSwgLy8g5paw5aKe5Y+C5pWw77yM55u05o6l5Lyg6YCS54i26IqC54K55pWw5o2uXG4pIHtcbiAgLy8gLS0tIDEuIOehruWumuW9k+WJjeWxgue6p+eahOaooeadv+WGheWuuSAtLS1cbiAgLy8g6LCD55SoIHJlc29sdmVUZW1wbGF0Ze+8jOWug+eOsOWcqOebtOaOpeS9v+eUqOS8oOWFpeeahCBwYXJlbnREYXRhXG4gIGNvbnN0IGxvY2FsVHBsQ29udGVudCA9IHJlc29sdmVUZW1wbGF0ZShpbmhlcml0ZWRDb250ZW50LCBwYXJlbnREYXRhKTtcbiAgbG9nZ2VyLmRlYnVnKCdhcHBseUluc2VydEF0TGV2ZWwnLCBgW+WFpeWPo10gYmFzZVBhdGg6IFwiJHtiYXNlUGF0aCB8fCAncm9vdCd9XCJgLCB7XG4gICAgc3RhdERhdGE6IF8uY2xvbmVEZWVwKHN0YXREYXRhKSxcbiAgfSk7XG5cbiAgLy8gLS0tIDIuIOajgOafpei3r+W+hOWtmOWcqOaAp++8jOWGs+WumuaJp+ihjOetlueVpSAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcbiAgbG9nZ2VyLmRlYnVnKFxuICAgICdhcHBseUluc2VydEF0TGV2ZWwnLFxuICAgIGBb6Lev5b6E5qOA5p+lXSBhdCBwYXRoOiBcIiR7YmFzZVBhdGggfHwgJ3Jvb3QnfVwiLiBjdXJyZW50Tm9kZUluVmFycyDnmoTlgLw6YCxcbiAgICBjdXJyZW50Tm9kZUluVmFycyxcbiAgKTtcblxuICAvLyAqKuetlueVpeS4gO+8muWOn+WtkOaAp+aPkuWFpSAoQXRvbWljIEluc2VydCkqKlxuICAvLyDlpoLmnpzlvZPliY3ot6/lvoTlnKjlj5jph4/kuK3kuI3lrZjlnKjvvIzliJnlsIbmlbTkuKrooaXkuIHlr7nosaHkvZzkuLrmlrDlgLzkuIDmrKHmgKfmj5LlhaXjgIJcbiAgaWYgKGJhc2VQYXRoICYmIGN1cnJlbnROb2RlSW5WYXJzID09PSB1bmRlZmluZWQpIHtcbiAgICAvLyDosIPnlKggYXBwbHlUZW1wbGF0ZVRvUGF0Y2gg5Ye95pWw77yM5bCG5ZCI5bm25ZCO55qE5qih5p2/5YaF5a655bqU55So5Yiw6KGl5LiB5LiKXG4gICAgY29uc3QgY29tcG9zZWQgPSBhcHBseVRlbXBsYXRlVG9QYXRjaChsb2NhbFRwbENvbnRlbnQsIHBhdGNoT2JqKTtcblxuICAgIGNvbnN0IGZpbmFsVmFsdWUgPSBzYW5pdGl6ZUFycmF5cyhjb21wb3NlZCk7IC8vIOa4heeQhuaVsOe7hOS4reeahCBudWxsIOetieaXoOaViOWAvOOAglxuICAgIGxvZ2dlci5kZWJ1ZygnYXBwbHlJbnNlcnRBdExldmVsJywgYOacgOe7iOaPkuWFpeaVsOaNriBhdCAke2Jhc2VQYXRofTpcXG4ke0pTT04uc3RyaW5naWZ5KGZpbmFsVmFsdWUsIG51bGwsIDIpfWApO1xuICAgIF8uc2V0KHN0YXREYXRhLCBiYXNlUGF0aCwgZmluYWxWYWx1ZSk7IC8vIOaJp+ihjOaPkuWFpeOAglxuICAgIGVkaXRMb2cucHVzaCh7IG9wOiAnaW5zZXJ0JywgcGF0aDogYmFzZVBhdGgsIHZhbHVlX25ldzogXy5jbG9uZURlZXAoZmluYWxWYWx1ZSkgfSk7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseUluc2VydEF0TGV2ZWwnLCBg5Y6f5a2Q5oCn5o+S5YWl5Yiw5paw6Lev5b6EOiAke2Jhc2VQYXRofWApO1xuICAgIHJldHVybjsgLy8g5o+S5YWl5a6M5oiQ77yM57uI5q2i6YCS5b2S44CCXG4gIH1cblxuICAvLyAqKuetlueVpeS6jO+8mumAkuW9kuihpeWFhSAoUmVjdXJzaXZlIFN1cHBsZW1lbnQpKipcbiAgLy8g5aaC5p6c5b2T5YmN6Lev5b6E5bey5a2Y5Zyo77yM5bm25LiU6KGl5LiB5ZKM5b2T5YmN5YC86YO95piv5a+56LGh77yM5YiZ5rex5YWl6YCS5b2S44CCXG4gIGlmIChfLmlzUGxhaW5PYmplY3QoY3VycmVudE5vZGVJblZhcnMpICYmIF8uaXNQbGFpbk9iamVjdChwYXRjaE9iaikpIHtcbiAgICBsb2dnZXIuZGVidWcoXG4gICAgICAnYXBwbHlJbnNlcnRBdExldmVsJyxcbiAgICAgIGBb6YCS5b2S6KGl5YWFXSBhdCBwYXRoOiBcIiR7YmFzZVBhdGggfHwgJ3Jvb3QnfVwiXG4gICAgICAtIOW9k+WJjeWxgue6p+aooeadvyAobG9jYWxUcGxDb250ZW50KTogJHtKU09OLnN0cmluZ2lmeShsb2NhbFRwbENvbnRlbnQpfWAsXG4gICAgKTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXRjaE9iaikpIHtcbiAgICAgIGNvbnN0IHN1YlBhdGggPSBiYXNlUGF0aCA/IGAke2Jhc2VQYXRofS4ke2tleX1gIDoga2V5O1xuICAgICAgY29uc3Qgc3ViUGF0Y2ggPSBwYXRjaE9ialtrZXldO1xuICAgICAgLy8g6LCD55SoIGdldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudO+8jOS7juW9k+WJjeaooeadv+WGheWuueS4reS4uuWtkOiKgueCueafpeaJvuWFtuW6lOe7p+aJv+eahOWGheWuuVxuICAgICAgY29uc3Qgc3ViSW5oZXJpdGVkQ29udGVudCA9IGdldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudChsb2NhbFRwbENvbnRlbnQsIGtleSk7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICdhcHBseUluc2VydEF0TGV2ZWwnLFxuICAgICAgICBgICAtIOWHhuWkh+mAkuW9kuWtkOiKgueCuTogXCIke2tleX1cIlxuICAgICAgLSDlsIbkvKDpgJLnu5nlrZDoioLngrnnmoTmqKHmnb8gKHN1YkluaGVyaXRlZENvbnRlbnQpOiAke0pTT04uc3RyaW5naWZ5KHN1YkluaGVyaXRlZENvbnRlbnQpfWAsXG4gICAgICApO1xuICAgICAgLy8g5bCG5b2T5YmN6IqC54K55pWw5o2uIGN1cnJlbnROb2RlSW5WYXJzIOS9nOS4uuS4i+S4gOWxgueahCBwYXJlbnREYXRhIOS8oOmAkuS4i+WOu1xuICAgICAgYXBwbHlJbnNlcnRBdExldmVsKHN0YXREYXRhLCBzdWJQYXRoLCBzdWJQYXRjaCwgZWRpdExvZywgc3ViSW5oZXJpdGVkQ29udGVudCwgY3VycmVudE5vZGVJblZhcnMpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChiYXNlUGF0aCkge1xuICAgIC8vICoq5o+S5YWl5aSx6LSlKipcbiAgICAvLyDlpoLmnpzot6/lvoTlt7LlrZjlnKjvvIzkvYbkuI3mmK/lj6/pgJLlvZLooaXlhYXnmoTlr7nosaHnu5PmnoTvvIjkvovlpoLvvIzkuIDkuKrmmK/lr7nosaHvvIzlj6bkuIDkuKrmmK/lrZfnrKbkuLLvvInvvIxcbiAgICAvLyDliJnorrDlvZXorablkYrjgIJpbnNlcnQg5LiN5Lya6KaG55uW5bey5a2Y5Zyo55qE5YC844CCXG4gICAgbG9nZ2VyLndhcm4oJ2FwcGx5SW5zZXJ0QXRMZXZlbCcsIGBWYXJpYWJsZUluc2VydCDlpLHotKXvvJrot6/lvoTlt7LlrZjlnKjkuJTml6Dms5XpgJLlvZLooaXlhYUgLT4gJHtiYXNlUGF0aH1gKTtcbiAgfVxuICAvLyDlpoLmnpwgYmFzZVBhdGgg5Li656m677yI5Zyo5qC557qn5Yir77yJ5LiUIHBhdGNoIOS4jeaYr+Wvueixoe+8jOWImeS4jeaJp+ihjOS7u+S9leaTjeS9nO+8jOWboOS4uuagueS4jeiDveiiq+mdnuWvueixoeabv+aNouOAglxufVxuXG4vKipcbiAqIOWkhOeQhuaJgOaciSBgPFZhcmlhYmxlSW5zZXJ0PmAg5oyH5Luk5Z2X44CCXG4gKlxuICogQHBhcmFtIHthbnlbXX0gYWxsSW5zZXJ0cyAtIOS7jua2iOaBr+S4reino+aekOWHuueahOaJgOaciSBpbnNlcnQg5oyH5Luk5a+56LGh44CCXG4gKiBAcGFyYW0ge2FueVtdfSBlZGl0TG9nIC0g55So5LqO5pS26ZuG5Y+Y5pu06K6w5b2V55qE5pel5b+X5pWw57uE44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzSW5zZXJ0QmxvY2tzKGFsbEluc2VydHM6IGFueVtdLCBlZGl0TG9nOiBhbnlbXSkge1xuICBpZiAoYWxsSW5zZXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgYXdhaXQgdXBkYXRlRXJhU3RhdERhdGEoYXN5bmMgc3RhdCA9PiB7XG4gICAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NJbnNlcnRCbG9ja3MnLCAnW+WIneWni+eKtuaAgV0g6L+b5YWlIHByb2Nlc3NJbnNlcnRCbG9ja3Mg5pe255qEIHN0YXREYXRhOicsIF8uY2xvbmVEZWVwKHN0YXQpKTtcbiAgICAgIHJldHVybiBzdGF0O1xuICAgIH0pO1xuICAgIC8qXG4gICAgICogTi5CLiDlv4Xpobvlr7nmr4/kuKogaW5zZXJ0Um9vdCDljZXni6zosIPnlKggdXBkYXRlVmFyaWFibGVzV2l0aO+8jOiAjOS4jeaYr+WwhuaJgOacieaTjeS9nOWQiOW5tuWIsOS4gOasoeiwg+eUqOS4reOAglxuICAgICAqIOi/meaYr+S4uuS6huehruS/neWcqOWQjOS4gOadoea2iOaBr+WGhe+8jOWJjeS4gOS4qiA8VmFyaWFibGVJbnNlcnQ+IOWdl+S4reaPkuWFpeeahOaooeadv+aIluaVsOaNru+8jFxuICAgICAqIOWPr+S7peiiq+WQjuS4gOS4qiA8VmFyaWFibGVJbnNlcnQ+IOaIliA8VmFyaWFibGVFZGl0PiDlnZforr/pl67lkozkvb/nlKjjgIJcbiAgICAgKiDmr4/mrKEgYXdhaXQgdXBkYXRlVmFyaWFibGVzV2l0aCDlrozmiJDlkI7vvIzlj5jph4/nirbmgIHpg73kvJrooqvliLfmlrDvvIzku47ogIzkvb/lkI7nu63mk43kvZzog73nnIvliLDmnIDmlrDnmoTnu5PmnpzjgIJcbiAgICAgKi9cbiAgICBmb3IgKGNvbnN0IGluc2VydFJvb3Qgb2YgYWxsSW5zZXJ0cykge1xuICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoaW5zZXJ0Um9vdCkgfHwgXy5pc0VtcHR5KGluc2VydFJvb3QpKSBjb250aW51ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHVwZGF0ZUVyYVN0YXREYXRhKHN0YXQgPT4ge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygncHJvY2Vzc0luc2VydEJsb2NrcycsIGDlpITnkIYgaW5zZXJ0Um9vdDogJHtKU09OLnN0cmluZ2lmeShpbnNlcnRSb290KX1gKTtcbiAgICAgICAgICAvLyDku47moLnot6/lvoQgJycg5byA5aeL57uf5LiA6YCS5b2S5YWl5Y+j77yM6aG25bGC6LCD55So5pe277yM54i26IqC54K55Li6IG51bGxcbiAgICAgICAgICBhcHBseUluc2VydEF0TGV2ZWwoc3RhdCwgJycsIGluc2VydFJvb3QsIGVkaXRMb2csIG51bGwsIG51bGwpO1xuICAgICAgICAgIHJldHVybiBzdGF0O1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3Byb2Nlc3NJbnNlcnRCbG9ja3MnLCBg5aSE55CGIGluc2VydFJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0luc2VydEJsb2NrcycsICfmiYDmnIkgVmFyaWFibGVJbnNlcnQg5pON5L2c5a6M5oiQJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/insert.ts\n\n}");
  },
  "./src/ERA变量框架/message_key.ts": 
  /*!************************************!*\
  !*** ./src/ERA变量框架/message_key.ts ***!
  \************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureMessageKey: () => (/* binding */ ensureMessageKey),\n/* harmony export */   ensureMkForLatestMessage: () => (/* binding */ ensureMkForLatestMessage),\n/* harmony export */   readMessageKey: () => (/* binding */ readMessageKey),\n/* harmony export */   updateLatestSelectedMk: () => (/* binding */ updateLatestSelectedMk)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _message_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_utils */ \"./src/ERA变量框架/message_utils.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `\x3c!-- --\x3e`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_2__.Logger('message_key');\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            return {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n        }\n        return null;\n    }\n    catch {\n        return null;\n    }\n}\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nfunction readMessageKey(msg) {\n    if (!msg)\n        return '';\n    // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n    const content = (0,_message_utils__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(msg);\n    const mk = parseEraData(content)?.['era-message-key'] || '';\n    // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n    // 以强制 ensureMessageKey 生成新的 MK。\n    return mk;\n    /*\n     * ==================================================================\n     * 【已废弃的兼容逻辑】 - 2025/10/02\n     *\n     * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n     * 因此 MK 可能存在于任何一个 swipe 中。\n     *\n     * **废弃原因**:\n     * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n     * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n     * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n     * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n     *\n     * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n     * ==================================================================\n     */\n    // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n    // if (mkFromCurrent) {\n    //   return mkFromCurrent;\n    // }\n    // if (Array.isArray(msg.swipes)) {\n    //   for (const swipeContent of msg.swipes) {\n    //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n    //     if (mkFromSwipe) {\n    //       return mkFromSwipe;\n    //     }\n    //   }\n    // }\n    // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n    // if (mkFromMessage) {\n    //   return mkFromMessage;\n    // }\n    // return '';\n}\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nasync function ensureMessageKey(msg) {\n    if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n        logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。msg=${JSON.stringify(msg)}`);\n        return { mk: '', isNew: false };\n    }\n    // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n    const existingMk = readMessageKey(msg);\n    if (existingMk) {\n        return { mk: existingMk, isNew: false }; // 已存在，直接返回\n    }\n    // 2. 生成新的 MK 和元数据块\n    const newMk = `era_mk_${Date.now()}_${(0,_utils__WEBPACK_IMPORTED_MODULE_2__.rnd)()}`;\n    const messageType = msg.role === 'user' ? 'user' : 'assistant';\n    const dataString = `<${_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_TAG}>`;\n    logger.log('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n    // 3. 构造新的消息内容并统一调用更新函数\n    const currentContent = (0,_message_utils__WEBPACK_IMPORTED_MODULE_1__.getMessageContent)(msg) ?? '';\n    const newContent = dataString + '\\n' + currentContent;\n    // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_2__.updateMessageContent)(msg, newContent);\n    return { mk: newMk, isNew: true };\n}\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nconst ensureMkForLatestMessage = async () => {\n    try {\n        const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n        // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n        logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg): ${JSON.stringify(msg)}`);\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出');\n            return { mk: '', message_id: null, isNewKey: false };\n        }\n        // ensureMessageKey 会返回最终的 MK 和一个布尔值\n        const { mk, isNew } = await ensureMessageKey(msg);\n        logger.log('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n        return { mk, message_id: msg.message_id, isNewKey: isNew };\n    }\n    catch (err) {\n        logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, err);\n        return { mk: '', message_id: null, isNewKey: false };\n    }\n};\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nconst updateLatestSelectedMk = async () => {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    if (!msg || typeof msg.message_id !== 'number')\n        return;\n    // 确保 MK 存在并获取它\n    const { mk: MK } = await ensureMessageKey(msg);\n    if (!MK)\n        return;\n    // 更新 ERAMetaData 中的 SelectedMks 数组\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_2__.updateEraMetaData)(meta => {\n        const selectedMks = _.get(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n        // 只有在记录不一致时才执行写操作，以优化性能\n        if (selectedMks[msg.message_id] !== MK) {\n            selectedMks[msg.message_id] = MK;\n            _.set(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n        }\n        return meta;\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFHLGVBQWUsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0QsSUFBSSxDQUFDLEdBQUcsSUFBSSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEtBQUssUUFBUTtRQUFFLE9BQU87SUFFdkQsZUFBZTtJQUNmLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQyxJQUFJLENBQUMsRUFBRTtRQUFFLE9BQU87SUFFaEIsbUNBQW1DO0lBQ25DLE1BQU0seURBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDN0IsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsZ0RBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM5Qyx3QkFBd0I7UUFDeEIsSUFBSSxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQ3ZDLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGdEQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDckMsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9tZXNzYWdlX2tleS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lr4bpkqUgKE1LKSDnrqHnkIbmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6L+Z5Liq5qih5Z2X5pivIEVSQSDmoYbmnrbnmoTln7rnn7PvvIzotJ/otKPnrqHnkIbigJzmtojmga/lr4bpkqXigJ3vvIhNZXNzYWdlIEtleSwgTUvvvInjgIJcbiAqXG4gKiAqKuiuvuiuoeeQhuW/tSoqOlxuICogRVJBIOeahOaguOW/g+S8mOWKv+WcqOS6juWFtumygeajkuaAp++8jOWug+mAmui/h+WwhuWPmOmHj+eKtuaAgeS4jiBTaWxseVRhdmVybiDkuI3nqLPlrprnmoTmtojmga/lj5jph4/vvIhtZXNzYWdlIHZhcmlhYmxlc++8iVxuICog6Kej6ICm5p2l5a6e546w6L+Z5LiA54K544CCTUsg5q2j5piv5a6e546w6Kej6ICm55qE5YWz6ZSu44CCXG4gKlxuICogTUsg5piv5LiA5Liq55SxICoqRVJBIOahhuaetuiHqui6qyoqIOWKqOaAgeeUn+aIkOW5tioq5rOo5YWl5Yiw5raI5oGv5YaF5a655a2X56ym5Liy6aG26YOoKirnmoTllK/kuIDmoIfor4bnrKbjgIJcbiAqIOWug+WwseWDj+S4gOS4quS4jeWPr+WPmOeahOKAnOmUmueCueKAne+8jOmaj+a2iOaBr+WGheWuueacrOi6q+S4gOi1t+WtmOWcqOOAgkVSQSDnmoTmiYDmnInmoLjlv4PpgLvovpHvvIzljIXmi6zlj5jph4/ov73ouKrjgIFcbiAqIOWbnua7muWSjOWQjOatpe+8jOmDveWbtOe7leedgOivhuWIq+WSjOaTjeS9nOi/meS6m+mUmueCueadpei/m+ihjO+8jOiAjOS4jeaYr+S+nei1luS6juWPr+iDveWPkeeUn+mUmeS9jeaIluiiq+mUmeivr+e7p+aJv+eahOa2iOaBr+WPmOmHj+OAglxuICpcbiAqICoqTUsg5qC85byPKio6XG4gKiBNSyDooqvljIXoo7nlnKjkuIDkuKrni6znibnnmoTjgIHnsbvkvLwgWE1MIOeahCBgPGVyYV9kYXRhPmAg5qCH562+5Lit77yM5YW25YaF6YOo5piv5LiA56eNKirpnZ7moIflh4YqKueahOexuyBKU09OIOagvOW8j++8jFxuICog5L2/55SoIGA9YCDkvZzkuLrliIbpmpTnrKbvvIzku6Xpgb/lhY3kuI4gQUkg5Y+v6IO955Sf5oiQ55qE5qCH5YeGIEpTT04g5re35reG44CCXG4gKiBlLmcuLCBgPGVyYV9kYXRhPntcImVyYS1tZXNzYWdlLWtleVwiPVwiZXJhX21rXy4uLlwiLFwiZXJhLW1lc3NhZ2UtdHlwZVwiPVwidXNlclwifTwvZXJhX2RhdGE+YFxuICog6L+Z56eN6K6+6K6h77yI6ICM5LiN5piv55SoIEhUTUwg5rOo6YeKIGA8IS0tIC0tPmDvvInmmK/kuLrkuobpmLLmraIgTUsg6KKr5YW25LuW5Y+v6IO956e76Zmk5rOo6YeK55qE6ISa5pys5peg5oSP5Lit56C05Z2P44CCXG4gKlxuICogKirmoLjlv4Plip/og70qKjpcbiAqIDEuICoq55Sf5oiQ5LiO5rOo5YWlKio6IGBlbnN1cmVNZXNzYWdlS2V5YCDlh73mlbDnoa7kv53ku7vkvZXpnIDopoHov73ouKrnmoTmtojmga/pg73mi6XmnInkuIDkuKogTUvjgILlpoLmnpzkuI3lrZjlnKjvvIxcbiAqICAgIOWug+S8mueUn+aIkOS4gOS4quaWsOeahCBNSyDlubbms6jlhaXliLDmtojmga/lhoXlrrnnmoTlvIDlpLTjgIJcbiAqIDIuICoq6Kej5p6Q5LiO6K+75Y+WKio6IGByZWFkTWVzc2FnZUtleWAg5Ye95pWw5o+Q5L6b5LqG5LiA5Liq5Y+q6K+755qE5o6l5Y+j77yM55So5LqO5LuO5raI5oGv5YaF5a655Lit6Kej5p6Q5Ye6IE1L44CCXG4gKiAzLiAqKuWQjOatpeS/nemanCoqOiBgdXBkYXRlTGF0ZXN0U2VsZWN0ZWRNa2Ag562J5Ye95pWw56Gu5L+d5qC45b+D5pWw5o2u57uT5p6EIGBTZWxlY3RlZE1rc2Ag5LiO5pyA5paw55qEXG4gKiAgICDmtojmga/nirbmgIHkv53mjIHkuIDoh7TvvIzmmK/moYbmnrboh6rmhIjog73lipvnmoTph43opoHnu4TmiJDpg6jliIbjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IEVSQV9EQVRBX1JFR0VYLCBFUkFfREFUQV9UQUcsIFNFTF9QQVRIIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TWVzc2FnZUNvbnRlbnQgfSBmcm9tICcuL21lc3NhZ2VfdXRpbHMnO1xuaW1wb3J0IHsgTG9nZ2VyLCBybmQsIHVwZGF0ZUVyYU1ldGFEYXRhLCB1cGRhdGVNZXNzYWdlQ29udGVudCB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdtZXNzYWdlX2tleScpO1xuXG4vKipcbiAqIEB0eXBlIHtFcmFEYXRhfSAtIOWumuS5ieS6huWtmOWCqOWcqCBgPGVyYV9kYXRhPmAg5Z2X5Lit55qE5YWD5pWw5o2u57uT5p6E44CCXG4gKi9cbnR5cGUgRXJhRGF0YSA9IHtcbiAgJ2VyYS1tZXNzYWdlLWtleSc6IHN0cmluZztcbiAgJ2VyYS1tZXNzYWdlLXR5cGUnOiAndXNlcicgfCAnYXNzaXN0YW50Jztcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5YaF6YOo6L6F5Yqp5Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDku47mtojmga/lhoXlrrnlrZfnrKbkuLLkuK3op6PmnpDlh7ogYEVyYURhdGFgIOWvueixoeOAgui/meaYr+S4gOS4quWPquivu+aTjeS9nOOAglxuICogQHBhcmFtIHtzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkfSBtZXNzYWdlQ29udGVudCAtIOa2iOaBr+eahOWGheWuueWtl+espuS4suOAglxuICogQHJldHVybnMge0VyYURhdGEgfCBudWxsfSDop6PmnpDmiJDlip/liJnov5Tlm54gYEVyYURhdGFgIOWvueixoe+8jOWQpuWImei/lOWbniBudWxs44CCXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRXJhRGF0YShtZXNzYWdlQ29udGVudDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IEVyYURhdGEgfCBudWxsIHtcbiAgaWYgKHR5cGVvZiBtZXNzYWdlQ29udGVudCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IG1lc3NhZ2VDb250ZW50Lm1hdGNoKEVSQV9EQVRBX1JFR0VYKTtcbiAgaWYgKCFtYXRjaCB8fCAhbWF0Y2hbMV0pIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICB0cnkge1xuICAgIC8vIOeUseS6jiBNSyDlnZflhoXpg6jmmK/oh6rlrprkuYnnmoQgYHtcImtleVwiPVwidmFsdWVcIn1gIOagvOW8j++8jOS4jeiDveS9v+eUqCBKU09OLnBhcnNl44CCXG4gICAgLy8g5b+F6aG75L2/55So5q2j5YiZ6KGo6L6+5byP6L+b6KGM5a695p2+5Yy56YWN5p2l5o+Q5Y+W6ZSu5YC844CCXG4gICAgY29uc3QgY3VzdG9tRm9ybWF0QmxvY2sgPSBtYXRjaFsxXTtcbiAgICBjb25zdCBrZXlNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLWtleVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG4gICAgY29uc3QgdHlwZU1hdGNoID0gY3VzdG9tRm9ybWF0QmxvY2subWF0Y2goL1wiZXJhLW1lc3NhZ2UtdHlwZVwiXFxzKj1cXHMqXCIoLio/KVwiLyk7XG5cbiAgICBpZiAoa2V5TWF0Y2g/LlsxXSAmJiB0eXBlTWF0Y2g/LlsxXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ2VyYS1tZXNzYWdlLWtleSc6IGtleU1hdGNoWzFdLFxuICAgICAgICAnZXJhLW1lc3NhZ2UtdHlwZSc6IHR5cGVNYXRjaFsxXSBhcyAndXNlcicgfCAnYXNzaXN0YW50JyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOWvvOWHuueahOaguOW/g+WHveaVsFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogKirjgJDor7vlj5YgTUvjgJEqKiDku47kuIDkuKrmtojmga/lr7nosaHkuK3lj6ror7vlnLDmj5Dlj5blhbbmtojmga/lr4bpkqXvvIhNS++8ieOAglxuICog6L+Z5Liq5Ye95pWw57uP6L+H54m55Yir5LyY5YyW77yM5Lul5bqU5a+55ruR5Yqo77yIc3dpcGXvvInnrYnlnLrmma/kuIvmtojmga/lr7nosaHnu5PmnoTkuI3kuIDoh7TnmoTpl67popjjgIJcbiAqIOWug+S8muWFqOmdouajgOafpea2iOaBr+eahCBgbWVzYOOAgWBtZXNzYWdlYCDku6Xlj4ogYHN3aXBlc2Ag5pWw57uE5Lit55qE5q+P5LiA5Liq5YWD57Sg77yM55u05Yiw5om+5Yiw56ys5LiA5Liq5pyJ5pWI55qEIE1LIOS4uuatouOAglxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDphZLppobmtojmga/lr7nosaHjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOaJvuWIsOeahCBNS++8m+WmguaenOS4jeWtmOWcqO+8jOWImei/lOWbnuepuuWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZE1lc3NhZ2VLZXkobXNnOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoIW1zZykgcmV0dXJuICcnO1xuXG4gIC8vIOaguOW/g+mAu+i+ke+8muWni+e7iOS4lOS7heagueaNriBnZXRNZXNzYWdlQ29udGVudCDnmoTnu5PmnpzmnaXop6PmnpAgTUvjgIJcbiAgY29uc3QgY29udGVudCA9IGdldE1lc3NhZ2VDb250ZW50KG1zZyk7XG5cbiAgY29uc3QgbWsgPSBwYXJzZUVyYURhdGEoY29udGVudCk/LlsnZXJhLW1lc3NhZ2Uta2V5J10gfHwgJyc7XG5cbiAgLy8g56e76Zmk6YGN5Y6G5YW25LuWIHN3aXBlcyDnmoTplJnor6/pgLvovpHjgILlpoLmnpzlvZPliY3mv4DmtLvnmoTlhoXlrrnmsqHmnIkgTUvvvIzlsLHlv4Xpobvov5Tlm57nqbrlrZfnrKbkuLLvvIxcbiAgLy8g5Lul5by65Yi2IGVuc3VyZU1lc3NhZ2VLZXkg55Sf5oiQ5paw55qEIE1L44CCXG4gIHJldHVybiBtaztcblxuICAvKlxuICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICog44CQ5bey5bqf5byD55qE5YW85a656YC76L6R44CRIC0gMjAyNS8xMC8wMlxuICAgKlxuICAgKiDku6XkuIvku6PnoIHlnZfmmK/kuLrkuoblhbzlrrnml6fniYjphZLppobnmoTkuIDkuKrnibnmgKfvvJrkuIDkuKrmtojmga/nmoTlpJrkuKogc3dpcGUg5Y+v6IO95YWx5Lqr5ZCM5LiA5Liq5bqV5bGC5raI5oGv5Y+Y6YeP77yMXG4gICAqIOWboOatpCBNSyDlj6/og73lrZjlnKjkuo7ku7vkvZXkuIDkuKogc3dpcGUg5Lit44CCXG4gICAqXG4gICAqICoq5bqf5byD5Y6f5ZugKio6XG4gICAqIOWcqOW9k+WJjeeahCBFUkEg5p625p6E5Lit77yM5q+P5LiqIHN3aXBlIOmDveiiq+inhuS4uueLrOeri+eahOWGheWuueOAguWmguaenOW9k+WJjea/gOa0u+eahCBzd2lwZSDlhoXlrrnkuK3msqHmnIkgTUvvvIxcbiAgICog5bCx5oSP5ZGz552A5a6D5piv5LiA5Liq5YWo5paw55qE44CB6ZyA6KaB6KKr6LWL5LqI5pawIE1LIOeahOa2iOaBr+OAguatpOaXtuiLpee7p+e7reafpeaJvuW5tui/lOWbnuWFtuS7liBzd2lwZSDnmoTml6cgTUvvvIxcbiAgICog5bCG5Lya5a+86Ie0IGBlbnN1cmVNZXNzYWdlS2V5YCDplJnor6/lnLDorqTkuLrmlrDmtojmga/lt7LmnIkgTUvvvIzku47ogIzot7Pov4flv4XopoHnmoTigJznlJ/miJDmlrAgTUvigJ3mtYHnqIvjgIJcbiAgICog6L+Z5q2j5piv5a+86Ie0IHN3aXBlIOaWsOa2iOaBr+aXtuaXoOazleato+ehruWGmeWFpeWPmOmHj+eahOagueacrOWOn+WboOOAglxuICAgKlxuICAgKiDlm6DmraTvvIzor6XlhbzlrrnpgLvovpHlt7Looqvms6jph4rmjonvvIzku6Xnoa7kv50gYHJlYWRNZXNzYWdlS2V5YCDnmoTooYzkuLrkuI7lvZPliY3mnrbmnoTnmoTorr7orqHmhI/lm77kv53mjIHkuIDoh7TjgIJcbiAgICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAqL1xuICAvLyBjb25zdCBta0Zyb21DdXJyZW50ID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tQ3VycmVudCkge1xuICAvLyAgIHJldHVybiBta0Zyb21DdXJyZW50O1xuICAvLyB9XG4gIC8vIGlmIChBcnJheS5pc0FycmF5KG1zZy5zd2lwZXMpKSB7XG4gIC8vICAgZm9yIChjb25zdCBzd2lwZUNvbnRlbnQgb2YgbXNnLnN3aXBlcykge1xuICAvLyAgICAgY29uc3QgbWtGcm9tU3dpcGUgPSBwYXJzZUVyYURhdGEoc3dpcGVDb250ZW50KT8uWydlcmEtbWVzc2FnZS1rZXknXTtcbiAgLy8gICAgIGlmIChta0Zyb21Td2lwZSkge1xuICAvLyAgICAgICByZXR1cm4gbWtGcm9tU3dpcGU7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG1rRnJvbU1lc3NhZ2UgPSBwYXJzZUVyYURhdGEobXNnLm1lc3NhZ2UpPy5bJ2VyYS1tZXNzYWdlLWtleSddO1xuICAvLyBpZiAobWtGcm9tTWVzc2FnZSkge1xuICAvLyAgIHJldHVybiBta0Zyb21NZXNzYWdlO1xuICAvLyB9XG4gIC8vIHJldHVybiAnJztcbn1cblxuLyoqXG4gKiAqKuOAkOehruS/nSBNSyDlrZjlnKjjgJEqKlxuICog6L+Z5piv5pys5qih5Z2X5pyA5qC45b+D55qE5Ye95pWw44CC5a6D5qOA5p+l5LiA5Liq5raI5oGv5piv5ZCm5bey5oul5pyJIE1L77yM5aaC5p6c5bCa5pyq5oul5pyJ77yM5YiZ5Li65YW255Sf5oiQ5LiA5Liq5paw55qEIE1LIOW5tuazqOWFpeWIsOa2iOaBr+WGheWuueS4reOAglxuICog6L+Z5piv6Kej5Yaz4oCc6bih55Sf6JuLL+ibi+eUn+m4oeKAnemXrumimOeahOWFs+mUru+8muWcqOWvueWPmOmHj+i/m+ihjOS7u+S9leaTjeS9nOS5i+WJje+8jOW/hemhu+WFiOehruS/neacieS4gOS4quWPr+S+m+S+nemZhOeahOmUmueCue+8iE1L77yJ44CCXG4gKlxuICogQHBhcmFtIHtUYXZlcm5NZXNzYWdlfSBtc2cgLSDnm67moIfmtojmga/lr7nosaEgKOW/hemhu+WMheWQqyBgbWVzc2FnZV9pZGAsIGByb2xlYCwg5Lul5Y+KIGBtZXNzYWdlYCDmiJYgYHN3aXBlc2Ap44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7bWs6IHN0cmluZywgaXNOZXc6IGJvb2xlYW59Pn0g6L+U5Zue5YyF5ZCrIE1LIOWSjOS4gOS4quW4g+WwlOWAvOeahOWvueixoe+8jOivpeW4g+WwlOWAvOaMh+ekuuaYr+WQpuWIm+W7uuS6huaWsOeahCBNS+OAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlTWVzc2FnZUtleShtc2c6IGFueSk6IFByb21pc2U8eyBtazogc3RyaW5nOyBpc05ldzogYm9vbGVhbiB9PiB7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicgfHwgIW1zZy5yb2xlKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5peg5pWI55qE5raI5oGv5a+56LGh57uT5p6E77yM5peg5rOV56Gu5L+dS2V544CCbXNnPSR7SlNPTi5zdHJpbmdpZnkobXNnKX1gKTtcbiAgICByZXR1cm4geyBtazogJycsIGlzTmV3OiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gMS4g5L2/55So5aKe5by655qEIHJlYWRNZXNzYWdlS2V5IOajgOafpeaYr+WQpuW3suWtmOWcqCBNS1xuICBjb25zdCBleGlzdGluZ01rID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKGV4aXN0aW5nTWspIHtcbiAgICByZXR1cm4geyBtazogZXhpc3RpbmdNaywgaXNOZXc6IGZhbHNlIH07IC8vIOW3suWtmOWcqO+8jOebtOaOpei/lOWbnlxuICB9XG5cbiAgLy8gMi4g55Sf5oiQ5paw55qEIE1LIOWSjOWFg+aVsOaNruWdl1xuICBjb25zdCBuZXdNayA9IGBlcmFfbWtfJHtEYXRlLm5vdygpfV8ke3JuZCgpfWA7XG4gIGNvbnN0IG1lc3NhZ2VUeXBlID0gbXNnLnJvbGUgPT09ICd1c2VyJyA/ICd1c2VyJyA6ICdhc3Npc3RhbnQnO1xuICBjb25zdCBkYXRhU3RyaW5nID0gYDwke0VSQV9EQVRBX1RBR30+e1wiZXJhLW1lc3NhZ2Uta2V5XCI9XCIke25ld01rfVwiLFwiZXJhLW1lc3NhZ2UtdHlwZVwiPVwiJHttZXNzYWdlVHlwZX1cIn08LyR7RVJBX0RBVEFfVEFHfT5gO1xuXG4gIGxvZ2dlci5sb2coJ2Vuc3VyZU1lc3NhZ2VLZXknLCBg5Li65raI5oGvIChJRDogJHttc2cubWVzc2FnZV9pZH0pIOazqOWFpeaWsOeahEtleTogJHtuZXdNa31gKTtcblxuICAvLyAzLiDmnoTpgKDmlrDnmoTmtojmga/lhoXlrrnlubbnu5/kuIDosIPnlKjmm7TmlrDlh73mlbBcbiAgY29uc3QgY3VycmVudENvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpID8/ICcnO1xuICBjb25zdCBuZXdDb250ZW50ID0gZGF0YVN0cmluZyArICdcXG4nICsgY3VycmVudENvbnRlbnQ7XG5cbiAgLy8g5L2/55So5LuOIHV0aWxzLnRzIOWvvOWFpeeahOmAmueUqOWHveaVsOadpeabtOaWsOa2iOaBr++8jOivpeWHveaVsOW3suWwgeijheS6huWkhOeQhiBzd2lwZXMg55qE6YC76L6R44CCXG4gIGF3YWl0IHVwZGF0ZU1lc3NhZ2VDb250ZW50KG1zZywgbmV3Q29udGVudCk7XG5cbiAgcmV0dXJuIHsgbWs6IG5ld01rLCBpc05ldzogdHJ1ZSB9O1xufVxuXG4vKipcbiAqICoq44CQ56Gu5L+d5pyA5paw5raI5oGv55qEIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quS+v+aNt+WHveaVsO+8jOS4k+mXqOeUqOS6juehruS/neW9k+WJjeiBiuWkqeiusOW9leS4reeahOacgOWQjuS4gOadoea2iOaBr+aLpeaciSBNS+OAglxuICog5a6D6YCa5bi45Zyo55uR5ZCs5Yiw5paw5raI5oGv55Sf5oiQ562J5LqL5Lu25pe26KKr6LCD55So77yM5Lul56Gu5L+d5paw5raI5oGv6IO96KKrIEVSQSDns7vnu5/mraPnoa7ov73ouKrjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHttazogc3RyaW5nLCBtZXNzYWdlX2lkOiBudW1iZXIgfCBudWxsLCBpc05ld0tleTogYm9vbGVhbn0+fSDov5Tlm57ljIXlkKsgTUvjgIHmtojmga8gSUQg5ZKM5LiA5Liq5biD5bCU5YC855qE5a+56LGh77yM6K+l5biD5bCU5YC85oyH56S65piv5ZCm5Yib5bu65LqG5paw55qEIE1L44CCXG4gKi9cbmV4cG9ydCBjb25zdCBlbnN1cmVNa0ZvckxhdGVzdE1lc3NhZ2UgPSBhc3luYyAoKTogUHJvbWlzZTx7XG4gIG1rOiBzdHJpbmc7XG4gIG1lc3NhZ2VfaWQ6IG51bWJlciB8IG51bGw7XG4gIGlzTmV3S2V5OiBib29sZWFuO1xufT4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICAgIC8vIOS/neeVmeatpOaXpeW/l++8jOWboOS4uuWug+WvueS6juiwg+ivleS6i+S7tuinpuWPkeaXtueahOa2iOaBr+eKtuaAgeiHs+WFs+mHjeimgeOAglxuICAgIGxvZ2dlci5kZWJ1ZygnZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOiOt+WPluWIsOeahOacgOaWsOa2iOaBr+WvueixoSAobXNnKTogJHtKU09OLnN0cmluZ2lmeShtc2cpfWApO1xuXG4gICAgaWYgKCFtc2cgfHwgdHlwZW9mIG1zZy5tZXNzYWdlX2lkICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsICfml6Dms5Xor7vlj5bmnIDmlrDmtojmga/miJblhbZJRO+8jOmAgOWHuicpO1xuICAgICAgcmV0dXJuIHsgbWs6ICcnLCBtZXNzYWdlX2lkOiBudWxsLCBpc05ld0tleTogZmFsc2UgfTtcbiAgICB9XG5cbiAgICAvLyBlbnN1cmVNZXNzYWdlS2V5IOS8mui/lOWbnuacgOe7iOeahCBNSyDlkozkuIDkuKrluIPlsJTlgLxcbiAgICBjb25zdCB7IG1rLCBpc05ldyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICAgIGxvZ2dlci5sb2coJ2Vuc3VyZU1rRm9yTGF0ZXN0TWVzc2FnZScsIGDlt7LkuLrmnIDmlrDmtojmga8gJHttc2cubWVzc2FnZV9pZH0g56Gu5L+dIE1LIOWtmOWcqOOAgiAo5piv5ZCm5paw5bu6OiAke2lzTmV3fSlgKTtcbiAgICByZXR1cm4geyBtaywgbWVzc2FnZV9pZDogbXNnLm1lc3NhZ2VfaWQsIGlzTmV3S2V5OiBpc05ldyB9O1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGxvZ2dlci5lcnJvcignZW5zdXJlTWtGb3JMYXRlc3RNZXNzYWdlJywgYOehruS/nU1L5pe25byC5bi4OiAke2Vycj8ubWVzc2FnZSB8fCBlcnJ9YCwgZXJyKTtcbiAgICByZXR1cm4geyBtazogJycsIG1lc3NhZ2VfaWQ6IG51bGwsIGlzTmV3S2V5OiBmYWxzZSB9O1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5pu05paw5pyA5paw5bey6YCJIE1L44CRKipcbiAqIOi/meaYr+S4gOS4quKAnOS/nemZqeKAneWHveaVsO+8jOeUqOS6juWcqOavj+asoeS6i+S7tuWkhOeQhueahOacgOWQju+8jOW8uuWItuagoeWHhiBgU2VsZWN0ZWRNa3NgIOaVsOe7hOS4reWFs+S6jioq5pyA5paw5raI5oGvKirnmoTorrDlvZXjgIJcbiAqIOWug+ehruS/neWNs+S9v+WcqOWkjeadgueahOW8guatpea1geeoi+S4re+8jGBTZWxlY3RlZE1rc2Ag55qE5bC+6YOo5Lmf5aeL57uI5LiO5a6e6ZmF55qE5pyA5paw5raI5oGv5L+d5oyB5Lil5qC85ZCM5q2l44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGNvbnN0IHVwZGF0ZUxhdGVzdFNlbGVjdGVkTWsgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IG1zZyA9IGdldENoYXRNZXNzYWdlcygtMSwgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KT8uWzBdO1xuICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSByZXR1cm47XG5cbiAgLy8g56Gu5L+dIE1LIOWtmOWcqOW5tuiOt+WPluWug1xuICBjb25zdCB7IG1rOiBNSyB9ID0gYXdhaXQgZW5zdXJlTWVzc2FnZUtleShtc2cpO1xuICBpZiAoIU1LKSByZXR1cm47XG5cbiAgLy8g5pu05pawIEVSQU1ldGFEYXRhIOS4reeahCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgIC8vIOWPquacieWcqOiusOW9leS4jeS4gOiHtOaXtuaJjeaJp+ihjOWGmeaTjeS9nO+8jOS7peS8mOWMluaAp+iDvVxuICAgIGlmIChzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gIT09IE1LKSB7XG4gICAgICBzZWxlY3RlZE1rc1ttc2cubWVzc2FnZV9pZF0gPSBNSztcbiAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBzZWxlY3RlZE1rcyk7XG4gICAgfVxuICAgIHJldHVybiBtZXRhO1xuICB9KTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/message_key.ts\n\n}");
  },
  "./src/ERA变量框架/message_utils.ts": 
  /*!**************************************!*\
  !*** ./src/ERA变量框架/message_utils.ts ***!
  \**************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLastAiMessage: () => (/* binding */ findLastAiMessage),\n/* harmony export */   getMessageContent: () => (/* binding */ getMessageContent),\n/* harmony export */   isUserMessage: () => (/* binding */ isUserMessage)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 消息处理工具模块\n * @description\n * 该文件提供了一系列用于处理和查询酒馆消息对象的通用辅助函数。\n */\n\n\n\nconst log = new _utils__WEBPACK_IMPORTED_MODULE_1__.Logger('message_utils');\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nfunction getMessageContent(msg) {\n    if (!msg)\n        return null;\n    // 优先检查 .mes 属性，这是新版酒馆的规范\n    if (typeof msg.mes === 'string') {\n        return msg.mes;\n    }\n    // 如果没有 .mes，则处理 swipes\n    if (Array.isArray(msg.swipes)) {\n        const sid = Number(msg.swipe_id ?? 0);\n        return msg.swipes[sid] || null;\n    }\n    // 最后，作为兼容，检查旧版的 .message 属性\n    if (typeof msg.message === 'string') {\n        return msg.message;\n    }\n    return null;\n}\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent) {\n    if (typeof messageContent !== 'string') {\n        return null;\n    }\n    const match = messageContent.match(_constants__WEBPACK_IMPORTED_MODULE_0__.ERA_DATA_REGEX);\n    if (!match || !match[1]) {\n        return null;\n    }\n    try {\n        // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n        // 必须使用正则表达式进行宽松匹配来提取键值。\n        const customFormatBlock = match[1];\n        const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n        const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n        if (keyMatch?.[1] && typeMatch?.[1]) {\n            const eraData = {\n                'era-message-key': keyMatch[1],\n                'era-message-type': typeMatch[1],\n            };\n            log.debug('parseEraData', '成功解析 EraData', eraData);\n            return eraData;\n        }\n        log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n        return null;\n    }\n    catch (e) {\n        log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n        return null;\n    }\n}\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nfunction isUserMessage(msg) {\n    const content = getMessageContent(msg);\n    const data = parseEraData(content);\n    if (data) {\n        return data['era-message-type'] === 'user';\n    }\n    // 回退到检查 role 属性\n    return msg?.role === 'user';\n}\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nfunction findLastAiMessage() {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    if (!messages || messages.length === 0) {\n        log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n        return null;\n    }\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const msg = messages[i];\n        if (!isUserMessage(msg)) {\n            log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n            return msg;\n        }\n    }\n    log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM7SUFDbkMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNULE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssTUFBTSxDQUFDO0lBQzdDLENBQUM7SUFDRCxnQkFBZ0I7SUFDaEIsT0FBTyxHQUFHLEVBQUUsSUFBSSxLQUFLLE1BQU0sQ0FBQztBQUM5QixDQUFDO0FBRUQ7OztHQUdHO0FBQ0ksU0FBUyxpQkFBaUI7SUFDL0IsTUFBTSxRQUFRLEdBQUcsZUFBZSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDbEYsSUFBSSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUNuRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUM5QyxNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3hCLEdBQUcsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUscUJBQXFCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztJQUNILENBQUM7SUFFRCxHQUFHLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLG9CQUFvQixDQUFDLENBQUM7SUFDckQsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvbWVzc2FnZV91dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDmtojmga/lpITnkIblt6XlhbfmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5paH5Lu25o+Q5L6b5LqG5LiA57O75YiX55So5LqO5aSE55CG5ZKM5p+l6K+i6YWS6aaG5raI5oGv5a+56LGh55qE6YCa55So6L6F5Yqp5Ye95pWw44CCXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBFUkFfREFUQV9SRUdFWCB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCdtZXNzYWdlX3V0aWxzJyk7XG5cbi8qKlxuICogQHR5cGUge0VyYURhdGF9IC0g5a6a5LmJ5LqG5a2Y5YKo5ZyoIGA8ZXJhX2RhdGE+YCDlnZfkuK3nmoTlhYPmlbDmja7nu5PmnoTjgIJcbiAqL1xudHlwZSBFcmFEYXRhID0ge1xuICAnZXJhLW1lc3NhZ2Uta2V5Jzogc3RyaW5nO1xuICAnZXJhLW1lc3NhZ2UtdHlwZSc6ICd1c2VyJyB8ICdhc3Npc3RhbnQnO1xufTtcblxuLyoqXG4gKiAqKuOAkOiOt+WPlua2iOaBr+WGheWuueOAkSoqIOS7jumFkummhueahOa2iOaBr+WvueixoeS4reWuieWFqOWcsOaPkOWPluW9k+WJjea/gOa0u++8iOiiq+mAieS4re+8ieeahOa2iOaBr+WGheWuueWtl+espuS4suOAglxuICog6L+Z5Liq5Ye95pWw5pivIEVSQSDkuK3miYDmnInmtojmga/lhoXlrrnor7vlj5bnmoTllK/kuIDlhaXlj6PvvIzku6Xnoa7kv53pgLvovpHnu5/kuIDlkozlgaXlo67mgKfjgIJcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nIHwgbnVsbH0g5b2T5YmN5r+A5rS755qE5raI5oGv5YaF5a6577yb5aaC5p6c5peg5rOV6I635Y+W77yM5YiZ6L+U5ZueIG51bGzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1lc3NhZ2VDb250ZW50KG1zZzogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghbXNnKSByZXR1cm4gbnVsbDtcblxuICAvLyDkvJjlhYjmo4Dmn6UgLm1lcyDlsZ7mgKfvvIzov5nmmK/mlrDniYjphZLppobnmoTop4TojINcbiAgaWYgKHR5cGVvZiBtc2cubWVzID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBtc2cubWVzO1xuICB9XG4gIC8vIOWmguaenOayoeaciSAubWVz77yM5YiZ5aSE55CGIHN3aXBlc1xuICBpZiAoQXJyYXkuaXNBcnJheShtc2cuc3dpcGVzKSkge1xuICAgIGNvbnN0IHNpZCA9IE51bWJlcihtc2cuc3dpcGVfaWQgPz8gMCk7XG4gICAgcmV0dXJuIG1zZy5zd2lwZXNbc2lkXSB8fCBudWxsO1xuICB9XG4gIC8vIOacgOWQju+8jOS9nOS4uuWFvOWuue+8jOajgOafpeaXp+eJiOeahCAubWVzc2FnZSDlsZ7mgKdcbiAgaWYgKHR5cGVvZiBtc2cubWVzc2FnZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbXNnLm1lc3NhZ2U7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICog5LuO5raI5oGv5YaF5a655a2X56ym5Liy5Lit6Kej5p6Q5Ye6IGBFcmFEYXRhYCDlr7nosaHjgILov5nmmK/kuIDkuKrlj6ror7vmk43kvZzjgIJcbiAqIEBwYXJhbSB7c3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZH0gbWVzc2FnZUNvbnRlbnQgLSDmtojmga/nmoTlhoXlrrnlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtFcmFEYXRhIHwgbnVsbH0g6Kej5p6Q5oiQ5Yqf5YiZ6L+U5ZueIGBFcmFEYXRhYCDlr7nosaHvvIzlkKbliJnov5Tlm54gbnVsbOOAglxuICovXG5mdW5jdGlvbiBwYXJzZUVyYURhdGEobWVzc2FnZUNvbnRlbnQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBFcmFEYXRhIHwgbnVsbCB7XG4gIGlmICh0eXBlb2YgbWVzc2FnZUNvbnRlbnQgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlQ29udGVudC5tYXRjaChFUkFfREFUQV9SRUdFWCk7XG4gIGlmICghbWF0Y2ggfHwgIW1hdGNoWzFdKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdHJ5IHtcbiAgICAvLyDnlLHkuo4gTUsg5Z2X5YaF6YOo5piv6Ieq5a6a5LmJ55qEIGB7XCJrZXlcIj1cInZhbHVlXCJ9YCDmoLzlvI/vvIzkuI3og73kvb/nlKggSlNPTi5wYXJzZeOAglxuICAgIC8vIOW/hemhu+S9v+eUqOato+WImeihqOi+vuW8j+i/m+ihjOWuveadvuWMuemFjeadpeaPkOWPlumUruWAvOOAglxuICAgIGNvbnN0IGN1c3RvbUZvcm1hdEJsb2NrID0gbWF0Y2hbMV07XG4gICAgY29uc3Qga2V5TWF0Y2ggPSBjdXN0b21Gb3JtYXRCbG9jay5tYXRjaCgvXCJlcmEtbWVzc2FnZS1rZXlcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuICAgIGNvbnN0IHR5cGVNYXRjaCA9IGN1c3RvbUZvcm1hdEJsb2NrLm1hdGNoKC9cImVyYS1tZXNzYWdlLXR5cGVcIlxccyo9XFxzKlwiKC4qPylcIi8pO1xuXG4gICAgaWYgKGtleU1hdGNoPy5bMV0gJiYgdHlwZU1hdGNoPy5bMV0pIHtcbiAgICAgIGNvbnN0IGVyYURhdGEgPSB7XG4gICAgICAgICdlcmEtbWVzc2FnZS1rZXknOiBrZXlNYXRjaFsxXSxcbiAgICAgICAgJ2VyYS1tZXNzYWdlLXR5cGUnOiB0eXBlTWF0Y2hbMV0gYXMgJ3VzZXInIHwgJ2Fzc2lzdGFudCcsXG4gICAgICB9O1xuICAgICAgbG9nLmRlYnVnKCdwYXJzZUVyYURhdGEnLCAn5oiQ5Yqf6Kej5p6QIEVyYURhdGEnLCBlcmFEYXRhKTtcbiAgICAgIHJldHVybiBlcmFEYXRhO1xuICAgIH1cbiAgICBsb2cuZGVidWcoJ3BhcnNlRXJhRGF0YScsICfmnKrog73lnKggRXJhRGF0YSDlnZfkuK3mib7liLDlrozmlbTnmoTplK7lgLzlr7knLCB7IGN1c3RvbUZvcm1hdEJsb2NrIH0pO1xuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLndhcm4oJ3BhcnNlRXJhRGF0YScsICfop6PmnpAgRXJhRGF0YSDlnZfml7blj5HnlJ/lvILluLgnLCBlKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqICoq44CQ5Yik5pat5raI5oGv57G75Z6L44CRKiog5qC55o2u5raI5oGv5YaF5a655Lit55qEIGBlcmEtbWVzc2FnZS10eXBlYCDlhYPmlbDmja7miJYgYHJvbGVgIOWxnuaAp+WIpOaWreaYr+WQpuS4uueUqOaIt+a2iOaBr+OAglxuICog5LyY5YWI5L+h5Lu75rOo5YWl55qE5YWD5pWw5o2u44CCXG4gKiBAcGFyYW0ge1RhdmVybk1lc3NhZ2V9IG1zZyAtIOmFkummhua2iOaBr+WvueixoeOAglxuICogQHJldHVybnMge2Jvb2xlYW59IOWmguaenOaYr+eUqOaIt+a2iOaBr++8jOWImei/lOWbniB0cnVl44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1VzZXJNZXNzYWdlKG1zZzogYW55KTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpO1xuICBjb25zdCBkYXRhID0gcGFyc2VFcmFEYXRhKGNvbnRlbnQpO1xuICBpZiAoZGF0YSkge1xuICAgIHJldHVybiBkYXRhWydlcmEtbWVzc2FnZS10eXBlJ10gPT09ICd1c2VyJztcbiAgfVxuICAvLyDlm57pgIDliLDmo4Dmn6Ugcm9sZSDlsZ7mgKdcbiAgcmV0dXJuIG1zZz8ucm9sZSA9PT0gJ3VzZXInO1xufVxuXG4vKipcbiAqIOS7juWQjuWQkeWJjeafpeaJvuW5tui/lOWbnuacgOWQjuS4gOadoSBBSSDmtojmga/jgIJcbiAqIEByZXR1cm5zIHtUYXZlcm5NZXNzYWdlIHwgbnVsbH0g5om+5Yiw55qEIEFJIOa2iOaBr+Wvueixoe+8jOWmguaenOaJvuS4jeWIsOWImei/lOWbniBudWxs44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kTGFzdEFpTWVzc2FnZSgpOiBhbnkgfCBudWxsIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBnZXRDaGF0TWVzc2FnZXMoJzAte3tsYXN0TWVzc2FnZUlkfX0nLCB7IGluY2x1ZGVfc3dpcGVzOiB0cnVlIH0pO1xuICBpZiAoIW1lc3NhZ2VzIHx8IG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZy5kZWJ1ZygnZmluZExhc3RBaU1lc3NhZ2UnLCAn6IGK5aSp6K6w5b2V5Li656m6LCDmnKrmib7liLDku7vkvZXmtojmga/jgIInKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZvciAobGV0IGkgPSBtZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IG1zZyA9IG1lc3NhZ2VzW2ldO1xuICAgIGlmICghaXNVc2VyTWVzc2FnZShtc2cpKSB7XG4gICAgICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgYOaJvuWIsOacgOWQjuS4gOadoSBBSSDmtojmga8sIElEOiAke21zZy5tZXNzYWdlX2lkfWApO1xuICAgICAgcmV0dXJuIG1zZztcbiAgICB9XG4gIH1cblxuICBsb2cuZGVidWcoJ2ZpbmRMYXN0QWlNZXNzYWdlJywgJ+acquWcqOiBiuWkqeiusOW9leS4reaJvuWIsOS7u+S9lSBBSSDmtojmga/jgIInKTtcbiAgcmV0dXJuIG51bGw7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/ERA变量框架/message_utils.ts\n\n}");
  },
  "./src/ERA变量框架/query.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/query.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseEraMacros: () => (/* binding */ parseEraMacros)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_0__.Logger('query');\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nfunction parseEraMacros(text) {\n    const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n    // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n    if (!text.includes('{{ERA')) {\n        return text;\n    }\n    // 获取 stat_data\n    const { stat } = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.getEraData)();\n    if (!stat) {\n        logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n        // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n        return text;\n    }\n    return text.replace(macroRegex, (substring, withMeta, path) => {\n        const funcName = 'parseEraMacros';\n        const trimmedPath = path.trim();\n        const includeMeta = !!withMeta;\n        let data;\n        if (trimmedPath === '$ALLDATA') {\n            data = stat;\n        }\n        else {\n            data = _.get(stat, trimmedPath);\n        }\n        if (data === undefined) {\n            logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n            return ''; // 路径未找到, 返回空字符串\n        }\n        // 根据 withMeta 标志决定是否移除 $meta 字段\n        const dataBeforeUnescape = includeMeta ? data : (0,_utils__WEBPACK_IMPORTED_MODULE_0__.removeMetaFields)(data);\n        // 在返回数据前进行反转义\n        const finalData = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.unescapeEraData)(dataBeforeUnescape);\n        logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n            before: dataBeforeUnescape,\n            after: finalData,\n        });\n        // 如果是对象或数组, 转换为 JSON 字符串\n        if (typeof finalData === 'object' && finalData !== null) {\n            return JSON.stringify(finalData);\n        }\n        // 如果是原始类型, 直接转换为字符串\n        return String(finalData);\n    });\n}\n$(() => {\n    /**\n     * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n     *\n     * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n     *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n     * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n     *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n     */\n    registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n        // 直接复用 parseEraMacros 函数的逻辑。\n        // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n        return parseEraMacros(substring);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3F1ZXJ5LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQWdGO0FBRWhGLE1BQU0sTUFBTSxHQUFHLElBQUksMENBQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUVuQzs7Ozs7R0FLRztBQUNJLFNBQVMsY0FBYyxDQUFDLElBQVk7SUFDekMsTUFBTSxVQUFVLEdBQUcsNENBQTRDLENBQUM7SUFFaEUsNEJBQTRCO0lBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDNUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsZUFBZTtJQUNmLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxrREFBVSxFQUFFLENBQUM7SUFDOUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1YsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3pELG9DQUFvQztRQUNwQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUM1RCxNQUFNLFFBQVEsR0FBRyxnQkFBZ0IsQ0FBQztRQUNsQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUUvQixJQUFJLElBQUksQ0FBQztRQUNULElBQUksV0FBVyxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQy9CLElBQUksR0FBRyxJQUFJLENBQUM7UUFDZCxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsdUJBQXVCLFdBQVcsZUFBZSxDQUFDLENBQUM7WUFDekUsT0FBTyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0I7UUFDN0IsQ0FBQztRQUVELGdDQUFnQztRQUNoQyxNQUFNLGtCQUFrQixHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx3REFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV2RSxjQUFjO1FBQ2QsTUFBTSxTQUFTLEdBQUcsdURBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRXRELE1BQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxXQUFXLEVBQUUsRUFBRTtZQUN6RCxNQUFNLEVBQUUsa0JBQWtCO1lBQzFCLEtBQUssRUFBRSxTQUFTO1NBQ2pCLENBQUMsQ0FBQztRQUVILHlCQUF5QjtRQUN6QixJQUFJLE9BQU8sU0FBUyxLQUFLLFFBQVEsSUFBSSxTQUFTLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDeEQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsQ0FBQyxDQUFDLEdBQUcsRUFBRTtJQUNMOzs7Ozs7O09BT0c7SUFDSCxpQkFBaUIsQ0FBQyw0Q0FBNEMsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ3JHLDZCQUE2QjtRQUM3QixvREFBb0Q7UUFDcEQsT0FBTyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3F1ZXJ5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEVyYURhdGEsIExvZ2dlciwgcmVtb3ZlTWV0YUZpZWxkcywgdW5lc2NhcGVFcmFEYXRhIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3F1ZXJ5Jyk7XG5cbi8qKlxuICog6Kej5p6Q5a2X56ym5Liy5Lit55qEIEVSQSDlro8sIOW5tuWwhuWFtuabv+aNouS4uuWvueW6lOeahOWPmOmHj+WAvOOAglxuICog6L+Z5piv5o+Q5L6b57uZ5YW25LuW5qih5Z2X6LCD55So55qE5YWs5YWx5o6l5Y+j44CCXG4gKiBAcGFyYW0gdGV4dCAtIOWMheWQq+Wuj+eahOi+k+WFpeWtl+espuS4suOAglxuICogQHJldHVybnMgLSDmm7/mjaLlro/lkI7nmoTlrZfnrKbkuLLjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRXJhTWFjcm9zKHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IG1hY3JvUmVnZXggPSAve3tcXHMqRVJBKC13aXRobWV0YSk/XFxzKjpcXHMqKFtefV0rPylcXHMqfX0vZ2k7XG5cbiAgLy8g5aaC5p6c5paH5pys5Lit5LiN5YyF5ZCr5a6P54m55b6B5a2X56ym5LiyLCDnm7TmjqXov5Tlm57ku6XkvJjljJbmgKfog71cbiAgaWYgKCF0ZXh0LmluY2x1ZGVzKCd7e0VSQScpKSB7XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICAvLyDojrflj5Ygc3RhdF9kYXRhXG4gIGNvbnN0IHsgc3RhdCB9ID0gZ2V0RXJhRGF0YSgpO1xuICBpZiAoIXN0YXQpIHtcbiAgICBsb2dnZXIud2FybigncGFyc2VFcmFNYWNyb3MnLCAn5peg5rOV6I635Y+W5YiwIHN0YXRfZGF0YSwg5a6P5pu/5o2i5aSx6LSlLicpO1xuICAgIC8vIOWmguaenOayoeaciSBzdGF0X2RhdGEsIOS7u+S9leWuj+mDveaXoOazleino+aekCwg55u05o6l6L+U5Zue5Y6f5paH5pysXG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICByZXR1cm4gdGV4dC5yZXBsYWNlKG1hY3JvUmVnZXgsIChzdWJzdHJpbmcsIHdpdGhNZXRhLCBwYXRoKSA9PiB7XG4gICAgY29uc3QgZnVuY05hbWUgPSAncGFyc2VFcmFNYWNyb3MnO1xuICAgIGNvbnN0IHRyaW1tZWRQYXRoID0gcGF0aC50cmltKCk7XG4gICAgY29uc3QgaW5jbHVkZU1ldGEgPSAhIXdpdGhNZXRhO1xuXG4gICAgbGV0IGRhdGE7XG4gICAgaWYgKHRyaW1tZWRQYXRoID09PSAnJEFMTERBVEEnKSB7XG4gICAgICBkYXRhID0gc3RhdDtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YSA9IF8uZ2V0KHN0YXQsIHRyaW1tZWRQYXRoKTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsb2dnZXIud2FybihmdW5jTmFtZSwgYOWcqCBzdGF0X2RhdGEg5Lit5pyq5om+5Yiw6Lev5b6EIFwiJHt0cmltbWVkUGF0aH1cIiwg5a6P5bCG5pu/5o2i5Li656m65a2X56ym5LiyLmApO1xuICAgICAgcmV0dXJuICcnOyAvLyDot6/lvoTmnKrmib7liLAsIOi/lOWbnuepuuWtl+espuS4slxuICAgIH1cblxuICAgIC8vIOagueaNriB3aXRoTWV0YSDmoIflv5flhrPlrprmmK/lkKbnp7vpmaQgJG1ldGEg5a2X5q61XG4gICAgY29uc3QgZGF0YUJlZm9yZVVuZXNjYXBlID0gaW5jbHVkZU1ldGEgPyBkYXRhIDogcmVtb3ZlTWV0YUZpZWxkcyhkYXRhKTtcblxuICAgIC8vIOWcqOi/lOWbnuaVsOaNruWJjei/m+ihjOWPjei9rOS5iVxuICAgIGNvbnN0IGZpbmFsRGF0YSA9IHVuZXNjYXBlRXJhRGF0YShkYXRhQmVmb3JlVW5lc2NhcGUpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdwYXJzZUVyYU1hY3JvcycsIGDlro/mm7/mjaLmlbDmja7lj43ovazkuYk6ICR7dHJpbW1lZFBhdGh9YCwge1xuICAgICAgYmVmb3JlOiBkYXRhQmVmb3JlVW5lc2NhcGUsXG4gICAgICBhZnRlcjogZmluYWxEYXRhLFxuICAgIH0pO1xuXG4gICAgLy8g5aaC5p6c5piv5a+56LGh5oiW5pWw57uELCDovazmjaLkuLogSlNPTiDlrZfnrKbkuLJcbiAgICBpZiAodHlwZW9mIGZpbmFsRGF0YSA9PT0gJ29iamVjdCcgJiYgZmluYWxEYXRhICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZmluYWxEYXRhKTtcbiAgICB9XG5cbiAgICAvLyDlpoLmnpzmmK/ljp/lp4vnsbvlnossIOebtOaOpei9rOaNouS4uuWtl+espuS4slxuICAgIHJldHVybiBTdHJpbmcoZmluYWxEYXRhKTtcbiAgfSk7XG59XG5cbiQoKCkgPT4ge1xuICAvKipcbiAgICog5rOo5YaMIEVSQSDlro8sIOeUqOS6juWcqOWPkemAgee7mSBBSSDnmoTmtojmga/kuK3mn6Xor6LlvZPliY3ogYrlpKnnmoTlj5jph4/mlbDmja5cbiAgICpcbiAgICogLSBge3tFUkE6cGF0aC50by5kYXRhfX1gOiDmn6Xor6Llubbmm7/mjaLkuLoqKuS4jeWQqyoqIGAkbWV0YWAg55qE57qv5YeA5pWw5o2u44CCXG4gICAqICAgLSBge3tFUkE6JEFMTERBVEF9fWAg5bCG6L+U5Zue5pW05Liq56e76ZmkIGAkbWV0YWAg5ZCO55qEIGBzdGF0X2RhdGFgIOWvueixoeOAglxuICAgKiAtIGB7e0VSQS13aXRobWV0YTpwYXRoLnRvLmRhdGF9fWA6IOafpeivouW5tuabv+aNouS4uioq5YyF5ZCrKiogYCRtZXRhYCDnmoTljp/lp4vmlbDmja7jgIJcbiAgICogICAtIGB7e0VSQS13aXRobWV0YTokQUxMREFUQX19YCDlsIbov5Tlm57lrozmlbTnmoQgYHN0YXRfZGF0YWAg5a+56LGh44CCXG4gICAqL1xuICByZWdpc3Rlck1hY3JvTGlrZSgve3tcXHMqRVJBKC13aXRobWV0YSk/XFxzKjpcXHMqKFtefV0rPylcXHMqfX0vZ2ksIChjb250ZXh0LCBzdWJzdHJpbmcsIHdpdGhNZXRhLCBwYXRoKSA9PiB7XG4gICAgLy8g55u05o6l5aSN55SoIHBhcnNlRXJhTWFjcm9zIOWHveaVsOeahOmAu+i+keOAglxuICAgIC8vIHN1YnN0cmluZyDlj4LmlbDmmK/ljLnphY3liLDnmoTlrozmlbTlro/lrZfnrKbkuLIsIOWmgiBcInt7RVJBOnBhdGgudG8uZGF0YX19XCJcbiAgICByZXR1cm4gcGFyc2VFcmFNYWNyb3Moc3Vic3RyaW5nKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/query.ts\n\n}");
  },
  "./src/ERA变量框架/rollback.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/rollback.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findLatestNewValue: () => (/* binding */ findLatestNewValue),\n/* harmony export */   rollbackByMk: () => (/* binding */ rollbackByMk)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _message_key__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_key */ \"./src/ERA变量框架/message_key.ts\");\n/* harmony import */ var _message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_utils */ \"./src/ERA变量框架/message_utils.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 回滚与历史追溯模块\n * @description\n * 该模块提供了 ERA 框架“时间旅行”能力的核心实现。它负责根据 `EditLog` 精确地撤销变量修改，\n * 以及在需要时向上追溯历史以查找变量的旧值。\n *\n * **设计理念**:\n * - **可逆操作**: 所有的变量写入操作都必须是可逆的。`rollbackByMk` 函数通过读取 `EditLog`\n *   并执行反向操作（`insert` -> `unset`, `update` -> `set to value_old`）来保证这一点。\n * - **历史的权威性**: `EditLog` 是变量状态变迁的唯一真实记录。`findLatestNewValue` 函数\n *   体现了这一原则，它不信任任何临时的变量快照，而是通过回溯 `EditLog` 链来查找一个变量\n *   在特定时间点之前的真实值。\n */\n\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_3__.Logger('rollback');\n/**\n * **【回滚】**\n * 根据一个给定的消息密钥（MK），精确地撤销该消息所引入的所有变量变更。\n *\n * @param {string} MK - 要回滚的目标消息的密钥。\n * @param {boolean} [silent=false] - 是否为静默模式。在静默模式下，函数不会自己触发日志刷新，\n *   这在 `resyncStateOnHistoryChange` 等批量操作中非常有用，可以避免产生大量冗余日志。\n */\nasync function rollbackByMk(MK, silent = false) {\n    try {\n        logger.log('rollbackByMk', `开始回滚, MK=${MK}`);\n        await updateVariablesWith(v => {\n            const meta = _.get(v, _constants__WEBPACK_IMPORTED_MODULE_0__.META_DATA_PATH, {});\n            const stat = _.get(v, _constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, {});\n            const raw = _.get(meta, [_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK]);\n            const arr = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.parseEditLog)(raw);\n            if (!arr || !arr.length) {\n                logger.debug('rollbackByMk', `EditLog 为空或无效，跳过回滚。`);\n                return v;\n            }\n            // 关键：必须逆序遍历 EditLog 来执行回滚。\n            // 这确保了对同一变量的多次修改能够被正确地、按相反的顺序撤销。\n            for (let i = arr.length - 1; i >= 0; i--) {\n                const e = arr[i];\n                const op = String(e?.op || '').toLowerCase();\n                const path = String(e?.path || '');\n                if (!path)\n                    continue;\n                if (op === 'insert') {\n                    // 对于“插入”操作，回滚即为“删除”。\n                    _.unset(stat, path);\n                    continue;\n                }\n                if (op === 'update' || op === 'delete') {\n                    // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n                    if (typeof e?.value_old === 'undefined') {\n                        // 如果日志中没有记录旧值，最安全的回滚方式是直接删除该路径。\n                        _.unset(stat, path);\n                    }\n                    else {\n                        _.set(stat, path, _.cloneDeep(e.value_old));\n                    }\n                }\n            }\n            _.set(v, _constants__WEBPACK_IMPORTED_MODULE_0__.STAT_DATA_PATH, stat);\n            return v;\n        }, _constants__WEBPACK_IMPORTED_MODULE_0__.CHAT_SCOPE);\n        logger.log('rollbackByMk', `回滚完成：MK=${MK}`);\n    }\n    catch (e) {\n        logger.error('rollbackByMk', `回滚异常：MK=${MK} → ${e?.message || e}`, e);\n    }\n}\n/**\n * **【历史追溯】**\n * 向上追溯聊天历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是为 `applyEditAtLevel` 函数提供支持的关键辅助函数，用于在生成 `update` 日志时，\n * 准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID 的**前一条**消息开始向上查找。\n * @param {Logger} [logger] - 可选的 Logger 实例，用于记录详细的追溯过程。\n * @returns {Promise<any>} 返回找到的 `value_new`。如果追溯到聊天记录的开头都未找到，则返回 `null`。\n */\nasync function findLatestNewValue(path, startMessageId, logger) {\n    logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息ID <${startMessageId}> 向上追溯历史值...`);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    if (!messages || messages.length < 1) {\n        logger?.debug('findLatestNewValue', `消息历史为空，无法追溯。`);\n        return null;\n    }\n    const startIndex = messages.findIndex(m => m.message_id === startMessageId);\n    if (startIndex === -1) {\n        logger?.warn('findLatestNewValue', `错误：在消息列表中未找到起始消息ID: ${startMessageId}`);\n        return null;\n    }\n    // 从起始消息的前一条开始，向上（向旧）遍历历史消息。\n    for (let i = startIndex - 1; i >= 0; i--) {\n        const message = messages[i];\n        const msgId = message?.message_id;\n        logger?.debug('findLatestNewValue', `[进度] 正在检查消息 (ID: ${msgId})，内容: \"${((0,_message_utils__WEBPACK_IMPORTED_MODULE_2__.getMessageContent)(message) || '').substring(0, 100)}...\"`);\n        // 使用 isUserMessage 辅助函数，并检查 message_id\n        if ((0,_message_utils__WEBPACK_IMPORTED_MODULE_2__.isUserMessage)(message) || typeof msgId !== 'number') {\n            continue;\n        }\n        const mk = (0,_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(message);\n        if (!mk) {\n            logger?.debug('findLatestNewValue', `[进度] 消息 (ID: ${msgId}) 无 MK，跳过。`);\n            continue; // 跳过没有 MK 的 AI 消息。\n        }\n        const { meta: metaData } = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.getEraData)();\n        const editLogRaw = _.get(metaData, [_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.parseEditLog)(editLogRaw);\n        if (!editLog || editLog.length === 0) {\n            logger?.debug('findLatestNewValue', `[进度] MK ${mk} 的 EditLog 为空，跳过。`);\n            continue; // 跳过 EditLog 为空的。\n        }\n        logger?.debug('findLatestNewValue', `[进度] 正在检查 MK ${mk} 的 EditLog...\\n${(0,_utils__WEBPACK_IMPORTED_MODULE_3__.J)(editLog)}`);\n        // 关键：从后向前遍历该消息的 EditLog，这样找到的第一个匹配项就是最新的。\n        for (let j = editLog.length - 1; j >= 0; j--) {\n            const logEntry = editLog[j];\n            if (!logEntry || !logEntry.path)\n                continue;\n            // Case 1: 精确路径匹配。\n            if (logEntry.path === path) {\n                // 如果在历史追溯中找到了 delete 记录，这意味着状态可能不一致。\n                // 因为 applyEditAtLevel 的前置检查应阻止对已删除变量的更新。\n                // 记录一个错误以供调试，并返回 null，因为该变量在逻辑上是不存在的。\n                if (logEntry.op === 'delete') {\n                    logger?.error('findLatestNewValue', `>> 状态异常! 在消息(ID:${message.message_id}, MK:${mk})中为路径 <${path}> 找到了 'delete' 记录。这表明 update 操作可能正在尝试修改一个已被删除的变量。`);\n                    return null;\n                }\n                logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到精确路径 <${path}> 的值为: ${(0,_utils__WEBPACK_IMPORTED_MODULE_3__.J)(logEntry.value_new)}`);\n                return _.cloneDeep(logEntry.value_new);\n            }\n            // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n            // 例如, 查找 \"a.b.c\", 而日志中有对 \"a.b\" 的修改。\n            if (path.startsWith(logEntry.path + '.')) {\n                const subPath = path.substring(logEntry.path.length + 1);\n                const parentNewVal = logEntry.value_new;\n                if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n                    const foundVal = _.get(parentNewVal, subPath);\n                    logger?.debug('findLatestNewValue', `>> 成功! 在消息(ID:${message.message_id}, MK:${mk})中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为: ${(0,_utils__WEBPACK_IMPORTED_MODULE_3__.J)(foundVal)}`);\n                    return _.cloneDeep(foundVal);\n                }\n            }\n        }\n    }\n    // 如果追溯到聊天记录的开头都未找到，说明这是该变量的首次出现。\n    logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDO2dCQUN4QyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDbEUsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzlDLE1BQU0sRUFBRSxLQUFLLENBQ1gsb0JBQW9CLEVBQ3BCLGlCQUFpQixPQUFPLENBQUMsVUFBVSxRQUFRLEVBQUUsYUFBYSxRQUFRLENBQUMsSUFBSSxnQkFBZ0IsT0FBTyxVQUFVLHlDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDdEgsQ0FBQztvQkFDRixPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLElBQUksdUJBQXVCLENBQUMsQ0FBQztJQUM5RSxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti9yb2xsYmFjay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlm57mu5rkuI7ljoblj7Lov73muq/mqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X5o+Q5L6b5LqGIEVSQSDmoYbmnrbigJzml7bpl7Tml4XooYzigJ3og73lipvnmoTmoLjlv4Plrp7njrDjgILlroPotJ/otKPmoLnmja4gYEVkaXRMb2dgIOeyvuehruWcsOaSpOmUgOWPmOmHj+S/ruaUue+8jFxuICog5Lul5Y+K5Zyo6ZyA6KaB5pe25ZCR5LiK6L+95rqv5Y6G5Y+y5Lul5p+l5om+5Y+Y6YeP55qE5pen5YC844CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIC0gKirlj6/pgIbmk43kvZwqKjog5omA5pyJ55qE5Y+Y6YeP5YaZ5YWl5pON5L2c6YO95b+F6aG75piv5Y+v6YCG55qE44CCYHJvbGxiYWNrQnlNa2Ag5Ye95pWw6YCa6L+H6K+75Y+WIGBFZGl0TG9nYFxuICogICDlubbmiafooYzlj43lkJHmk43kvZzvvIhgaW5zZXJ0YCAtPiBgdW5zZXRgLCBgdXBkYXRlYCAtPiBgc2V0IHRvIHZhbHVlX29sZGDvvInmnaXkv53or4Hov5nkuIDngrnjgIJcbiAqIC0gKirljoblj7LnmoTmnYPlqIHmgKcqKjogYEVkaXRMb2dgIOaYr+WPmOmHj+eKtuaAgeWPmOi/geeahOWUr+S4gOecn+WunuiusOW9leOAgmBmaW5kTGF0ZXN0TmV3VmFsdWVgIOWHveaVsFxuICogICDkvZPnjrDkuobov5nkuIDljp/liJnvvIzlroPkuI3kv6Hku7vku7vkvZXkuLTml7bnmoTlj5jph4/lv6vnhafvvIzogIzmmK/pgJrov4flm57muq8gYEVkaXRMb2dgIOmTvuadpeafpeaJvuS4gOS4quWPmOmHj1xuICogICDlnKjnibnlrprml7bpl7TngrnkuYvliY3nmoTnnJ/lrp7lgLzjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IENIQVRfU0NPUEUsIExPR1NfUEFUSCwgTUVUQV9EQVRBX1BBVEgsIFNUQVRfREFUQV9QQVRIIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL21lc3NhZ2Vfa2V5JztcbmltcG9ydCB7IGdldE1lc3NhZ2VDb250ZW50LCBpc1VzZXJNZXNzYWdlIH0gZnJvbSAnLi9tZXNzYWdlX3V0aWxzJztcbmltcG9ydCB7IGdldEVyYURhdGEsIEosIExvZ2dlciwgcGFyc2VFZGl0TG9nIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3JvbGxiYWNrJyk7XG5cbi8qKlxuICogKirjgJDlm57mu5rjgJEqKlxuICog5qC55o2u5LiA5Liq57uZ5a6a55qE5raI5oGv5a+G6ZKl77yITUvvvInvvIznsr7noa7lnLDmkqTplIDor6Xmtojmga/miYDlvJXlhaXnmoTmiYDmnInlj5jph4/lj5jmm7TjgIJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gTUsgLSDopoHlm57mu5rnmoTnm67moIfmtojmga/nmoTlr4bpkqXjgIJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW3NpbGVudD1mYWxzZV0gLSDmmK/lkKbkuLrpnZnpu5jmqKHlvI/jgILlnKjpnZnpu5jmqKHlvI/kuIvvvIzlh73mlbDkuI3kvJroh6rlt7Hop6blj5Hml6Xlv5fliLfmlrDvvIxcbiAqICAg6L+Z5ZyoIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg562J5om56YeP5pON5L2c5Lit6Z2e5bi45pyJ55So77yM5Y+v5Lul6YG/5YWN5Lqn55Sf5aSn6YeP5YaX5L2Z5pel5b+X44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByb2xsYmFja0J5TWsoTUs6IHN0cmluZywgc2lsZW50ID0gZmFsc2UpIHtcbiAgdHJ5IHtcbiAgICBsb2dnZXIubG9nKCdyb2xsYmFja0J5TWsnLCBg5byA5aeL5Zue5ruaLCBNSz0ke01LfWApO1xuICAgIGF3YWl0IHVwZGF0ZVZhcmlhYmxlc1dpdGgodiA9PiB7XG4gICAgICBjb25zdCBtZXRhID0gXy5nZXQodiwgTUVUQV9EQVRBX1BBVEgsIHt9KTtcbiAgICAgIGNvbnN0IHN0YXQgPSBfLmdldCh2LCBTVEFUX0RBVEFfUEFUSCwge30pO1xuXG4gICAgICBjb25zdCByYXcgPSBfLmdldChtZXRhLCBbTE9HU19QQVRILCBNS10pO1xuICAgICAgY29uc3QgYXJyID0gcGFyc2VFZGl0TG9nKHJhdyk7XG4gICAgICBpZiAoIWFyciB8fCAhYXJyLmxlbmd0aCkge1xuICAgICAgICBsb2dnZXIuZGVidWcoJ3JvbGxiYWNrQnlNaycsIGBFZGl0TG9nIOS4uuepuuaIluaXoOaViO+8jOi3s+i/h+Wbnua7muOAgmApO1xuICAgICAgICByZXR1cm4gdjtcbiAgICAgIH1cblxuICAgICAgLy8g5YWz6ZSu77ya5b+F6aG76YCG5bqP6YGN5Y6GIEVkaXRMb2cg5p2l5omn6KGM5Zue5rua44CCXG4gICAgICAvLyDov5nnoa7kv53kuoblr7nlkIzkuIDlj5jph4/nmoTlpJrmrKHkv67mlLnog73lpJ/ooqvmraPnoa7lnLDjgIHmjInnm7jlj43nmoTpobrluo/mkqTplIDjgIJcbiAgICAgIGZvciAobGV0IGkgPSBhcnIubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgZSA9IGFycltpXTtcbiAgICAgICAgY29uc3Qgb3AgPSBTdHJpbmcoZT8ub3AgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHBhdGggPSBTdHJpbmcoZT8ucGF0aCB8fCAnJyk7XG4gICAgICAgIGlmICghcGF0aCkgY29udGludWU7XG5cbiAgICAgICAgaWYgKG9wID09PSAnaW5zZXJ0Jykge1xuICAgICAgICAgIC8vIOWvueS6juKAnOaPkuWFpeKAneaTjeS9nO+8jOWbnua7muWNs+S4uuKAnOWIoOmZpOKAneOAglxuICAgICAgICAgIF8udW5zZXQoc3RhdCwgcGF0aCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wID09PSAndXBkYXRlJyB8fCBvcCA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICAvLyDlr7nkuo7igJzmm7TmlrDigJ3miJbigJzliKDpmaTigJ3mk43kvZzvvIzlm57mu5rljbPkuLrmgaLlpI3liLDigJzml6flgLzigJ3jgIJcbiAgICAgICAgICBpZiAodHlwZW9mIGU/LnZhbHVlX29sZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIC8vIOWmguaenOaXpeW/l+S4reayoeacieiusOW9leaXp+WAvO+8jOacgOWuieWFqOeahOWbnua7muaWueW8j+aYr+ebtOaOpeWIoOmZpOivpei3r+W+hOOAglxuICAgICAgICAgICAgXy51bnNldChzdGF0LCBwYXRoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy5zZXQoc3RhdCwgcGF0aCwgXy5jbG9uZURlZXAoZS52YWx1ZV9vbGQpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgXy5zZXQodiwgU1RBVF9EQVRBX1BBVEgsIHN0YXQpO1xuICAgICAgcmV0dXJuIHY7XG4gICAgfSwgQ0hBVF9TQ09QRSk7XG4gICAgbG9nZ2VyLmxvZygncm9sbGJhY2tCeU1rJywgYOWbnua7muWujOaIkO+8mk1LPSR7TUt9YCk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGxvZ2dlci5lcnJvcigncm9sbGJhY2tCeU1rJywgYOWbnua7muW8guW4uO+8mk1LPSR7TUt9IOKGkiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgfVxufVxuXG4vKipcbiAqICoq44CQ5Y6G5Y+y6L+95rqv44CRKipcbiAqIOWQkeS4iui/vea6r+iBiuWkqeWOhuWPsu+8jOafpeaJvuafkOS4quWPmOmHj+i3r+W+hOWcqOaMh+Wumua2iOaBr+S5i+WJjeeahOacgOWQjuS4gOS4quWAvCAoYHZhbHVlX25ld2Ap44CCXG4gKiDov5nmmK/kuLogYGFwcGx5RWRpdEF0TGV2ZWxgIOWHveaVsOaPkOS+m+aUr+aMgeeahOWFs+mUrui+heWKqeWHveaVsO+8jOeUqOS6juWcqOeUn+aIkCBgdXBkYXRlYCDml6Xlv5fml7bvvIxcbiAqIOWHhuehruWcsOiusOW9leS4iyBgdmFsdWVfb2xkYOOAglxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0g6KaB5p+l5om+55qE5Y+Y6YeP55qE5a6M5pW06Lev5b6E44CCXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhcnRNZXNzYWdlSWQgLSDku47mraTmtojmga8gSUQg55qEKirliY3kuIDmnaEqKua2iOaBr+W8gOWni+WQkeS4iuafpeaJvuOAglxuICogQHBhcmFtIHtMb2dnZXJ9IFtsb2dnZXJdIC0g5Y+v6YCJ55qEIExvZ2dlciDlrp7kvovvvIznlKjkuo7orrDlvZXor6bnu4bnmoTov73muq/ov4fnqIvjgIJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59IOi/lOWbnuaJvuWIsOeahCBgdmFsdWVfbmV3YOOAguWmguaenOi/vea6r+WIsOiBiuWkqeiusOW9leeahOW8gOWktOmDveacquaJvuWIsO+8jOWImei/lOWbniBgbnVsbGDjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRMYXRlc3ROZXdWYWx1ZShwYXRoOiBzdHJpbmcsIHN0YXJ0TWVzc2FnZUlkOiBudW1iZXIsIGxvZ2dlcj86IExvZ2dlcik6IFByb21pc2U8YW55PiB7XG4gIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGDlvIDlp4vkuLrot6/lvoQgPCR7cGF0aH0+IOS7jua2iOaBr0lEIDwke3N0YXJ0TWVzc2FnZUlkfT4g5ZCR5LiK6L+95rqv5Y6G5Y+y5YC8Li4uYCk7XG4gIGNvbnN0IG1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19JywgeyBpbmNsdWRlX3N3aXBlczogZmFsc2UgfSk7XG4gIGlmICghbWVzc2FnZXMgfHwgbWVzc2FnZXMubGVuZ3RoIDwgMSkge1xuICAgIGxvZ2dlcj8uZGVidWcoJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsIGDmtojmga/ljoblj7LkuLrnqbrvvIzml6Dms5Xov73muq/jgIJgKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHN0YXJ0SW5kZXggPSBtZXNzYWdlcy5maW5kSW5kZXgobSA9PiBtLm1lc3NhZ2VfaWQgPT09IHN0YXJ0TWVzc2FnZUlkKTtcbiAgaWYgKHN0YXJ0SW5kZXggPT09IC0xKSB7XG4gICAgbG9nZ2VyPy53YXJuKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg6ZSZ6K+v77ya5Zyo5raI5oGv5YiX6KGo5Lit5pyq5om+5Yiw6LW35aeL5raI5oGvSUQ6ICR7c3RhcnRNZXNzYWdlSWR9YCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyDku47otbflp4vmtojmga/nmoTliY3kuIDmnaHlvIDlp4vvvIzlkJHkuIrvvIjlkJHml6fvvInpgY3ljobljoblj7Lmtojmga/jgIJcbiAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlc1tpXTtcbiAgICBjb25zdCBtc2dJZCA9IG1lc3NhZ2U/Lm1lc3NhZ2VfaWQ7XG4gICAgbG9nZ2VyPy5kZWJ1ZyhcbiAgICAgICdmaW5kTGF0ZXN0TmV3VmFsdWUnLFxuICAgICAgYFvov5vluqZdIOato+WcqOajgOafpea2iOaBryAoSUQ6ICR7bXNnSWR9Ke+8jOWGheWuuTogXCIkeyhnZXRNZXNzYWdlQ29udGVudChtZXNzYWdlKSB8fCAnJykuc3Vic3RyaW5nKDAsIDEwMCl9Li4uXCJgLFxuICAgICk7XG5cbiAgICAvLyDkvb/nlKggaXNVc2VyTWVzc2FnZSDovoXliqnlh73mlbDvvIzlubbmo4Dmn6UgbWVzc2FnZV9pZFxuICAgIGlmIChpc1VzZXJNZXNzYWdlKG1lc3NhZ2UpIHx8IHR5cGVvZiBtc2dJZCAhPT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG1rID0gcmVhZE1lc3NhZ2VLZXkobWVzc2FnZSk7XG4gICAgaWYgKCFtaykge1xuICAgICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYFvov5vluqZdIOa2iOaBryAoSUQ6ICR7bXNnSWR9KSDml6AgTUvvvIzot7Pov4fjgIJgKTtcbiAgICAgIGNvbnRpbnVlOyAvLyDot7Pov4fmsqHmnIkgTUsg55qEIEFJIOa2iOaBr+OAglxuICAgIH1cblxuICAgIGNvbnN0IHsgbWV0YTogbWV0YURhdGEgfSA9IGdldEVyYURhdGEoKTtcbiAgICBjb25zdCBlZGl0TG9nUmF3ID0gXy5nZXQobWV0YURhdGEsIFtMT0dTX1BBVEgsIG1rXSk7XG4gICAgY29uc3QgZWRpdExvZyA9IHBhcnNlRWRpdExvZyhlZGl0TG9nUmF3KTtcblxuICAgIGlmICghZWRpdExvZyB8fCBlZGl0TG9nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9nZ2VyPy5kZWJ1ZygnZmluZExhdGVzdE5ld1ZhbHVlJywgYFvov5vluqZdIE1LICR7bWt9IOeahCBFZGl0TG9nIOS4uuepuu+8jOi3s+i/h+OAgmApO1xuICAgICAgY29udGludWU7IC8vIOi3s+i/hyBFZGl0TG9nIOS4uuepuueahOOAglxuICAgIH1cbiAgICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBgW+i/m+W6pl0g5q2j5Zyo5qOA5p+lIE1LICR7bWt9IOeahCBFZGl0TG9nLi4uXFxuJHtKKGVkaXRMb2cpfWApO1xuXG4gICAgLy8g5YWz6ZSu77ya5LuO5ZCO5ZCR5YmN6YGN5Y6G6K+l5raI5oGv55qEIEVkaXRMb2fvvIzov5nmoLfmib7liLDnmoTnrKzkuIDkuKrljLnphY3pobnlsLHmmK/mnIDmlrDnmoTjgIJcbiAgICBmb3IgKGxldCBqID0gZWRpdExvZy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xuICAgICAgY29uc3QgbG9nRW50cnkgPSBlZGl0TG9nW2pdO1xuICAgICAgaWYgKCFsb2dFbnRyeSB8fCAhbG9nRW50cnkucGF0aCkgY29udGludWU7XG5cbiAgICAgIC8vIENhc2UgMTog57K+56Gu6Lev5b6E5Yy56YWN44CCXG4gICAgICBpZiAobG9nRW50cnkucGF0aCA9PT0gcGF0aCkge1xuICAgICAgICAvLyDlpoLmnpzlnKjljoblj7Lov73muq/kuK3mib7liLDkuoYgZGVsZXRlIOiusOW9le+8jOi/meaEj+WRs+edgOeKtuaAgeWPr+iDveS4jeS4gOiHtOOAglxuICAgICAgICAvLyDlm6DkuLogYXBwbHlFZGl0QXRMZXZlbCDnmoTliY3nva7mo4Dmn6XlupTpmLvmraLlr7nlt7LliKDpmaTlj5jph4/nmoTmm7TmlrDjgIJcbiAgICAgICAgLy8g6K6w5b2V5LiA5Liq6ZSZ6K+v5Lul5L6b6LCD6K+V77yM5bm26L+U5ZueIG51bGzvvIzlm6DkuLror6Xlj5jph4/lnKjpgLvovpHkuIrmmK/kuI3lrZjlnKjnmoTjgIJcbiAgICAgICAgaWYgKGxvZ0VudHJ5Lm9wID09PSAnZGVsZXRlJykge1xuICAgICAgICAgIGxvZ2dlcj8uZXJyb3IoXG4gICAgICAgICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgICAgICAgIGA+PiDnirbmgIHlvILluLghIOWcqOa2iOaBryhJRDoke21lc3NhZ2UubWVzc2FnZV9pZH0sIE1LOiR7bWt9KeS4reS4uui3r+W+hCA8JHtwYXRofT4g5om+5Yiw5LqGICdkZWxldGUnIOiusOW9leOAgui/meihqOaYjiB1cGRhdGUg5pON5L2c5Y+v6IO95q2j5Zyo5bCd6K+V5L+u5pS55LiA5Liq5bey6KKr5Yig6Zmk55qE5Y+Y6YeP44CCYCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9nZ2VyPy5kZWJ1ZyhcbiAgICAgICAgICAnZmluZExhdGVzdE5ld1ZhbHVlJyxcbiAgICAgICAgICBgPj4g5oiQ5YqfISDlnKjmtojmga8oSUQ6JHttZXNzYWdlLm1lc3NhZ2VfaWR9LCBNSzoke21rfSnkuK3mib7liLDnsr7noa7ot6/lvoQgPCR7cGF0aH0+IOeahOWAvOS4ujogJHtKKGxvZ0VudHJ5LnZhbHVlX25ldyl9YCxcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIF8uY2xvbmVEZWVwKGxvZ0VudHJ5LnZhbHVlX25ldyk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhc2UgMjog5p+l5om+55qE6Lev5b6E5piv5pel5b+X5p2h55uu6Lev5b6E55qE5a2Q6Lev5b6EICjljbMgbG9nRW50cnkucGF0aCDmmK/niLbnuqcp44CCXG4gICAgICAvLyDkvovlpoIsIOafpeaJviBcImEuYi5jXCIsIOiAjOaXpeW/l+S4reacieWvuSBcImEuYlwiIOeahOS/ruaUueOAglxuICAgICAgaWYgKHBhdGguc3RhcnRzV2l0aChsb2dFbnRyeS5wYXRoICsgJy4nKSkge1xuICAgICAgICBjb25zdCBzdWJQYXRoID0gcGF0aC5zdWJzdHJpbmcobG9nRW50cnkucGF0aC5sZW5ndGggKyAxKTtcbiAgICAgICAgY29uc3QgcGFyZW50TmV3VmFsID0gbG9nRW50cnkudmFsdWVfbmV3O1xuICAgICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KHBhcmVudE5ld1ZhbCkgJiYgXy5oYXMocGFyZW50TmV3VmFsLCBzdWJQYXRoKSkge1xuICAgICAgICAgIGNvbnN0IGZvdW5kVmFsID0gXy5nZXQocGFyZW50TmV3VmFsLCBzdWJQYXRoKTtcbiAgICAgICAgICBsb2dnZXI/LmRlYnVnKFxuICAgICAgICAgICAgJ2ZpbmRMYXRlc3ROZXdWYWx1ZScsXG4gICAgICAgICAgICBgPj4g5oiQ5YqfISDlnKjmtojmga8oSUQ6JHttZXNzYWdlLm1lc3NhZ2VfaWR9LCBNSzoke21rfSnkuK3mib7liLDniLbnuqfot6/lvoQgPCR7bG9nRW50cnkucGF0aH0+LCDlubbku47kuK3mj5Dlj5blrZDot6/lvoQgPCR7c3ViUGF0aH0+IOeahOWAvOS4ujogJHtKKGZvdW5kVmFsKX1gLFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIF8uY2xvbmVEZWVwKGZvdW5kVmFsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIOWmguaenOi/vea6r+WIsOiBiuWkqeiusOW9leeahOW8gOWktOmDveacquaJvuWIsO+8jOivtOaYjui/meaYr+ivpeWPmOmHj+eahOmmluasoeWHuueOsOOAglxuICBsb2dnZXI/LmRlYnVnKCdmaW5kTGF0ZXN0TmV3VmFsdWUnLCBg5ZCR5LiK6L+95rqv5pyq5om+5Yiw6Lev5b6EICR7cGF0aH0g55qE5Lu75L2V5Y6G5Y+y5YC877yM5bCG5L2/55SoIG51bGwg5L2c5Li65pen5YC8YCk7XG4gIHJldHVybiBudWxsO1xufVxuXG4vKlxuICog5pen55qEIGNhbGlicmF0ZSDlh73mlbDvvIzlhbbmoLjlv4PmgJ3mg7Plt7LooqvlkLjmlLbov5sgYHJlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlYCDnmoTkv53pmanmnLrliLbkuK3jgIJcbiAqIOatpOWkhOeahOazqOmHiuiiq+S/neeVme+8jOWboOS4uuWug+aegeWlveWcsOino+mHiuS6hiBFUkEg5qGG5p625aaC5L2V5ben5aaZ5Zyw5bqU5a+5IFNpbGx5VGF2ZXJuIOeahOS4gOS4quaguOW/g+KAnOaAqueZluKAneOAglxuICpcbiAqICMjIyDmoKHlh4bkuLvmtYHnqIvvvJrmr5TovoPigJzlvZPliY3mtojmga/igJ3kuI7igJzkuIrmrKHpgInkuK3nmoTmtojmga/igJ3lubbliKnnlKjphZLppobnmoTnibnmgKflt6flppnlnLDkv67lpI3lj5jph4/nirbmgIHjgIJcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIOi/meaYryBFUkEg5Y+Y6YeP5qGG5p625pyA5qC45b+D55qE5Ye95pWw5LmL5LiA77yM5a6D6Kej5Yaz5LqG5LiA5Liq6Z2e5bi45qOY5omL55qE6Zeu6aKY77yaKirliKDpmaQgc3dpcGUg5pe255qE5Y+Y6YeP54q25oCB6Ieq5Yqo5L+u5aSNKirjgIJcbiAqXG4gKiAqKumFkummhueahOWlh+eJueihjOS4uiAoRmVhdHVyZSwgbm90IGEgYnVnKToqKlxuICog5b2T5Yig6Zmk5LiA5p2hIHN3aXBlICjkvovlpoLvvIzluKbmnInlj5jph48gaWQ9MiDnmoTmtojmga8pIOaXtu+8mlxuICogMS4gKirlhoXlrrnkuI7lj5jph4/plJnkvY0qKjog5ZCO5LiA5p2hIHN3aXBlIChpZD0zKSDnmoQqKuWGheWuuSoq5Lya4oCc6aG24oCd5Yiw6KKr5Yig6Zmk55qEIHN3aXBlIChpZD0yKSDnmoTkvY3nva7kuIrvvIzkvYYqKuWPmOmHjyoq5Y205L+d55WZ5LqGIGlkPTIg55qE5Y+Y6YeP44CCXG4gKiAyLiAqKuWtpOWEv+WPmOmHj+aui+eVmSoqOiDljp/mnKznmoQgc3dpcGUgMyDmtojmga/omb3nhLblnKjnlYzpnaLkuIrmtojlpLHkuobvvIzkvYblroPlr7nlupTnmoQqKua2iOaBr+WPmOmHjyoqIChpZD0zKSDku43nhLbmrovnlZnlnKjogYrlpKnmlbDmja7kuK3vvIzmiJDkuLrigJzlraTlhL/lj5jph4/igJ3jgIJcbiAqIDMuICoq5a2k5YS/5Y+Y6YeP57un5om/Kio6IOWmguaenOeUqOaIt+atpOaXtuWGjSBzd2lwZSDkuIDmrKHvvIzmlrDnlJ/miJDnmoQgc3dpcGUgMyDlsIbkvJoqKue7p+aJvyoq6L+Z5Liq5q6L55WZ55qE5a2k5YS/5Y+Y6YePIChpZD0zKe+8jOWvvOiHtOaWsOWGheWuuemFjeaXp+WPmOmHj++8jOi/m+S4gOatpeWKoOWJp+eKtuaAgea3t+S5seOAglxuICogNC4gKirnu5PmnpwqKjog5oiR5Lus5b6X5Yiw5LqG5LiA5Liq5YaF5a655pivIGlkPTPjgIHlj5jph4/mmK8gaWQ9MiDnmoTigJzmt7flkIjigJ3mtojmga/vvIzlubbkuJTov5jmnInkuIDkuKogaWQ9MyDnmoTlraTlhL/lj5jph4/pmo/ml7blj6/og73ooqvmlrDmtojmga/nu6fmib/vvIzpgKDmiJDkuKXph43nmoTnirbmgIHkuI3kuIDoh7TjgIJcbiAqIDUuICoq5peg54m55a6a5LqL5Lu2Kio6IOatpOWklu+8jOi/meS4quaTjeS9nOS4jeS8muinpuWPkeS7u+S9leeLrOeJueeahOS6i+S7tu+8jOWPquS8muinpuWPkSBgY2hhdF9pZF9jaGFuZ2VkYCDnrYnpgJrnlKjkuovku7bjgIJcbiAqXG4gKiAqKuacrOWHveaVsOeahOagoeWHhuW3p+iuoToqKlxuICog5pys5Ye95pWw57K+56Gu5Zyw5Yip55So5LqG5LiK6L+w4oCc54q25oCB6ZSZ5L2N4oCd5p2l5a6M5oiQ6Ieq5Yqo5L+u5aSN77yaXG4gKiAxLiBgY2FsaWJyYXRlYCDooqsgYGNoYXRfaWRfY2hhbmdlZGAg5LqL5Lu26Kem5Y+R44CCXG4gKiAyLiDlroPmo4DmtYvliLAgYG9sZE1LYCDlrZjlnKggKOWug+iusOW9leS6huiiq+WIoOmZpOa2iOaBr+eahCBNS++8jOWNsyBpZD0yIOeahCBNSynjgIJcbiAqIDMuICoq5omn6KGM5Zue5ruaKio6IGBhcHBseVJvbGxiYWNrQnlNSyhvbGRNSylgIOiiq+iwg+eUqO+8jOWwhiBpZD0yIOW8leWFpeeahOWPmOmHj+S/ruaUueWFqOmDqOaSpOmUgOOAglxuICogNC4gKirop6blj5Hph43lhpkqKjogYGV2ZW50RW1pdCgncm9sbGJhY2tfZG9uZV9yZWFwcGx5X3Zhcl9zdGFydCcpYCDooqvop6blj5HjgIJcbiAqIDUuIGBBcHBseVZhckNoYW5nZWAg5Ye95pWw5ZON5bqU6YeN5YaZ5LqL5Lu277yM6K+75Y+WKirlvZPliY0qKua2iOaBr+eahCoq5YaF5a65KiogKOeOsOWcqOaYryBpZD0zIOeahOWGheWuuSnvvIzlubbmoLnmja7lroPph43mlrDlhpnlhaXlj5jph4/jgIJcbiAqXG4gKiAqKuacgOe7iOaViOaenCoqOiDigJzlm57mu5rkuobml6fnmoQoaWQ9MinvvIzph43lhpnkuobmlrDnmoQoaWQ9MynigJ3vvIzlj5jph4/nirbmgIHooqvlroznvo7lnLDoh6rliqjkv67lpI3jgIJcbiAqL1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/rollback.ts\n\n}");
  },
  "./src/ERA变量框架/sync.ts": 
  /*!*****************************!*\
  !*** ./src/ERA变量框架/sync.ts ***!
  \*****************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   forceSyncLastAiMessage: () => (/* binding */ forceSyncLastAiMessage),\n/* harmony export */   resyncStateOnHistoryChange: () => (/* binding */ resyncStateOnHistoryChange)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _message_key__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./message_key */ \"./src/ERA变量框架/message_key.ts\");\n/* harmony import */ var _message_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./message_utils */ \"./src/ERA变量框架/message_utils.ts\");\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/rollback.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/* harmony import */ var _variable_change_processor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./variable_change_processor */ \"./src/ERA变量框架/variable_change_processor.ts\");\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\n\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_4__.Logger('sync');\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg) => {\n    const key = (0,_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!key)\n        return null;\n    return key;\n};\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks) => {\n    const { meta: metaData } = (0,_utils__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    for (const mk of mks) {\n        if (!mk)\n            continue; // 跳过 null (用户消息)\n        const editLogRaw = _.get(metaData, [_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, mk]);\n        const editLog = (0,_utils__WEBPACK_IMPORTED_MODULE_4__.parseEditLog)(editLogRaw);\n        if (editLog.length > 0) {\n            return false; // 发现一个非空 log，直接返回 false\n        }\n    }\n    return true; // 所有 log 都为空\n};\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nconst resyncStateOnHistoryChange = async (forceFullResync = false) => {\n    if (forceFullResync) {\n        logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    }\n    else {\n        logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n    const { meta: oldMetaData } = (0,_utils__WEBPACK_IMPORTED_MODULE_4__.getEraData)();\n    const oldSelectedMks = _.cloneDeep(_.get(oldMetaData, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []));\n    logger.debug('resyncStateOnHistoryChange', `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`);\n    if (!allMessages || allMessages.length === 0) {\n        logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n        return;\n    }\n    let firstRecalcId = -1;\n    if (forceFullResync) {\n        firstRecalcId = 0;\n        logger.log('resyncStateOnHistoryChange', '强制模式：设置重算起点为 0。');\n    }\n    // Case 1: 消息被删除 (新列表比旧列表短)\n    else if (allMessages.length < oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息删除。');\n        // 从后往前，寻找第一个 \"currentMk === oldMk_at_same_index\" 的对齐点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[删除-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk === recordedMk) {\n                firstRecalcId = i + 1;\n                logger.log('resyncStateOnHistoryChange', `找到对齐点于 message_id=${i} (MK=${currentMk})。将从 ID ${firstRecalcId} 开始检查。`);\n                break;\n            }\n        }\n        if (firstRecalcId === -1) {\n            firstRecalcId = 0;\n            logger.log('resyncStateOnHistoryChange', '未找到任何对齐点，将从头开始检查。');\n        }\n        // 【优化】检查被删除的 MK 是否影响变量\n        // 稳健地找出被删除的 MK：对比新旧 MK 序列的差异\n        const currentMkSequence = allMessages.map(getMkFromMsg).filter(mk => mk);\n        const oldMkSequence = oldSelectedMks.filter(mk => mk);\n        const deletedMks = _.difference(oldMkSequence, currentMkSequence);\n        logger.debug('resyncStateOnHistoryChange', `旧MK序列: [${oldMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `新MK序列: [${currentMkSequence.join(', ')}]`);\n        logger.debug('resyncStateOnHistoryChange', `计算出的被删除MK: [${deletedMks.join(', ')}]`);\n        if (deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks)) {\n            logger.log('resyncStateOnHistoryChange', `检测到被删除的 ${deletedMks.length} 条消息均不含变量修改，执行快速同步。`);\n            const newSelectedMks = [];\n            for (let i = 0; i < allMessages.length; i++) {\n                newSelectedMks[i] = getMkFromMsg(allMessages[i]);\n            }\n            await (0,_utils__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                _.set(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n                return meta;\n            });\n            logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n            return;\n        }\n    }\n    // Case 2: 消息被修改/切换 (长度不变)\n    else if (allMessages.length === oldSelectedMks.length) {\n        logger.log('resyncStateOnHistoryChange', '检测到消息长度不变，可能为修改或切换。');\n        // 从后往前，寻找第一个不匹配的点\n        for (let i = allMessages.length - 1; i >= 0; i--) {\n            const currentMk = getMkFromMsg(allMessages[i]);\n            const recordedMk = oldSelectedMks[i];\n            logger.debug('resyncStateOnHistoryChange', `[切换-对齐检查] i=${i}, currentMk=${currentMk}, recordedMk=${recordedMk}`);\n            if (currentMk !== recordedMk) {\n                firstRecalcId = i;\n            }\n        }\n        if (firstRecalcId === -1) {\n            logger.log('resyncStateOnHistoryChange', '所有MK均匹配，无需重算。');\n            // N.B. 在当前架构下，MK 已被直接写入消息内容，与内容强绑定。\n            // 因此，任何导致内容变化的操作（如 swipe）也必然会导致 MK 的变化。\n            // 这意味着，如果 MK 序列完全匹配，那么内容也必然完全匹配，无需进行任何重算或保险性检查。\n            return; // 直接返回，终止同步。\n        }\n        else {\n            logger.log('resyncStateOnHistoryChange', `找到最早的不匹配点于 message_id=${firstRecalcId}。将从该点开始重算。`);\n        }\n    }\n    // Case 3: 消息被添加 (新列表比旧列表长)\n    else {\n        logger.log('resyncStateOnHistoryChange', '检测到消息添加。');\n        // 将重算起点设置为新消息的起始索引，让同步流程统一处理\n        firstRecalcId = oldSelectedMks.length;\n        logger.log('resyncStateOnHistoryChange', `新增消息的写入逻辑已由同步流程接管。将从新增消息 (ID: ${firstRecalcId}) 开始处理。`);\n    }\n    // 3. 收集需要回滚的 MK 列表，并执行逆序回滚\n    if (firstRecalcId > -1) {\n        const mksToRollback = oldSelectedMks.slice(firstRecalcId).filter(mk => mk);\n        if (mksToRollback.length > 0) {\n            logger.log('resyncStateOnHistoryChange', `准备回滚 ${mksToRollback.length} 个MK: [${mksToRollback.join(', ')}]`);\n            for (const mk of mksToRollback.reverse()) {\n                logger.debug('resyncStateOnHistoryChange', `[回滚] 正在回滚 MK: ${mk}`);\n                await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(mk, true); // true 表示只回滚，不重写\n            }\n            logger.log('resyncStateOnHistoryChange', '逆序回滚完成。');\n        }\n    }\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n        const msg = allMessages[i];\n        logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}`);\n        const newMk = await (0,_variable_change_processor__WEBPACK_IMPORTED_MODULE_5__.ApplyVarChangeForMessage)(msg);\n        newSelectedMks[i] = newMk; // 使用重算后的新 message_id (即 i) 作为索引\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n    // 5. 更新 SelectedMks 数组\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n        _.set(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, newSelectedMks);\n        return meta;\n    });\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n    // ==================================================================\n    // 【保险机制】 - 已于 2025/10/02 移除\n    //\n    // **历史原因**:\n    // 该机制最初是为了解决一个旧架构下的“内容-变量错位”问题。在旧架构中，当删除一条 swipe 时，\n    // 后一条 swipe 的内容会“顶替”上来，但其底层的消息变量（及其 MK）却保持不变。\n    // 这导致主同步逻辑的 MK 比对失效，无法发现状态变化。\n    // 为此，保险机制被设计为：通过 `oldSelectedMks`（状态变更前的快照）找到被删除的旧 MK，\n    // 强制回滚它，然后根据当前可见的新内容重新写入变量，从而修复错位。\n    //\n    // **当前架构下的情况与移除原因**:\n    // 在当前架构中，MK 已被直接写入消息内容，与内容强绑定。当 swipe 导致内容变化时，MK 也会随之变化。\n    // 这使得主同步逻辑（逆序回滚、顺序重算）已经能够完全、正确地处理 swipe 等场景，不再需要此保险机制。\n    //\n    // 继续保留该机制不仅是冗余的，而且会主动引发 Bug：\n    // 它依然按照旧逻辑，使用 `oldSelectedMks` 回滚一个过时的、不相关的 MK，这会破坏主逻辑刚刚同步好的正确状态。\n    // 随后，在被破坏的状态上进行的重写操作会失败或产生错误结果（例如，生成一个空的 EditLog），\n    // 并覆盖掉之前由主逻辑正确生成的 EditLog，导致数据丢失。\n    //\n    // 综上，该机制已从“保险”变为“风险”，因此被完全注释掉。\n    // ==================================================================\n    // logger.log('resyncStateOnHistoryChange', '执行【保险机制】：无条件回滚并重写最后一楼...');\n    // const lastWrittenMk = [...oldSelectedMks].reverse().find(mk => mk);\n    // if (lastWrittenMk) {\n    //   logger.log('resyncStateOnHistoryChange', `找到最后一个写入的MK: ${lastWrittenMk}，执行回滚...`);\n    //   await rollbackByMk(lastWrittenMk, true);\n    //   logger.log('resyncStateOnHistoryChange', '回滚完成，准备根据当前最后一楼内容重写...');\n    //   await ApplyVarChange(); // ApplyVarChange 默认处理最后一楼\n    //   logger.log('resyncStateOnHistoryChange', '保险性重写完成。');\n    // } else {\n    //   logger.log('resyncStateOnHistoryChange', '未找到任何可供回滚的旧MK，跳过保险机制。');\n    // }\n};\n/**\n * **【强制同步最后一条AI消息】**\n * 这是一个用于特定场景的函数，例如由外部 API 触发，需要强制重算最后一条 AI 消息的变量。\n * 它解决了在消息内容被外部修改（但 MK 未变）时，状态无法自动更新的问题。\n *\n * **执行逻辑**:\n * 1. **定位**: 找到最后一条 AI 消息。\n * 2. **回滚**: 如果该消息存在且有 MK，则无条件回滚此 MK 引入的所有变量修改。\n * 3. **重算**: 立即根据该消息的**当前内容**重新计算变量，并生成新的 `EditLog`。\n * 4. **更新**: 将新的 MK 更新到 `SelectedMks` 数组的正确位置。\n *\n * **安全性**:\n * 此函数操作目标明确（最后一条 AI 消息），且回滚和重算在同一调用链中完成，\n * 避免了旧“保险机制”中因目标不明确而破坏 `resync` 状态的风险。\n */\nconst forceSyncLastAiMessage = async () => {\n    logger.log('forceSyncLastAiMessage', '启动强制同步最后一条 AI 消息...');\n    // 1. 定位\n    const msg = (0,_message_utils__WEBPACK_IMPORTED_MODULE_2__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.warn('forceSyncLastAiMessage', '未找到可供强制同步的 AI 消息。');\n        return;\n    }\n    const messageId = msg.message_id;\n    const MK = (0,_message_key__WEBPACK_IMPORTED_MODULE_1__.readMessageKey)(msg);\n    if (!MK) {\n        logger.warn('forceSyncLastAiMessage', `消息 (ID: ${messageId}) 不含 MK，无法执行强制同步。将转为执行常规写入...`);\n        // 如果没有 MK，说明是新消息，直接走标准写入流程即可\n        await (0,_variable_change_processor__WEBPACK_IMPORTED_MODULE_5__.ApplyVarChangeForMessage)(msg);\n        return;\n    }\n    logger.log('forceSyncLastAiMessage', `目标消息 (ID: ${messageId}, MK: ${MK})。`);\n    // 2. 回滚\n    logger.debug('forceSyncLastAiMessage', `正在回滚 MK: ${MK}...`);\n    await (0,_rollback__WEBPACK_IMPORTED_MODULE_3__.rollbackByMk)(MK, true); // silent=true，避免不必要的日志刷新\n    // 3. 重算\n    logger.debug('forceSyncLastAiMessage', `回滚完成，正在根据当前内容重算 MK: ${MK}...`);\n    const newMK = await (0,_variable_change_processor__WEBPACK_IMPORTED_MODULE_5__.ApplyVarChangeForMessage)(msg);\n    // 4. 更新 SelectedMks\n    if (newMK) {\n        try {\n            await (0,_utils__WEBPACK_IMPORTED_MODULE_4__.updateEraMetaData)(meta => {\n                const selectedMks = _.get(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n                selectedMks[messageId] = newMK;\n                _.set(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n                return meta;\n            });\n            logger.log('forceSyncLastAiMessage', `强制同步完成，已更新 SelectedMks[${messageId}] = ${newMK}`);\n        }\n        catch (e) {\n            logger.error('forceSyncLastAiMessage', `强制同步后更新 SelectedMks 失败: ${e?.message || e}`, e);\n        }\n    }\n    else {\n        logger.error('forceSyncLastAiMessage', `重算后未能获取新的 MK，SelectedMks 可能未更新。`);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTSxvRkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUVsRCxvQkFBb0I7SUFDcEIsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUNWLElBQUksQ0FBQztZQUNILE1BQU0seURBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGdEQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzlDLFdBQVcsQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQy9CLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGdEQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7Z0JBQ25DLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixFQUFFLDBCQUEwQixTQUFTLE9BQU8sS0FBSyxFQUFFLENBQUMsQ0FBQztRQUMxRixDQUFDO1FBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLDJCQUEyQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFGLENBQUM7SUFDSCxDQUFDO1NBQU0sQ0FBQztRQUNOLE1BQU0sQ0FBQyxLQUFLLENBQUMsd0JBQXdCLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztJQUM1RSxDQUFDO0FBQ0gsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy9FUkHlj5jph4/moYbmnrYvc3luYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogQGZpbGUg54q25oCB5ZCM5q2l5qC45b+DXG4gKiBAZGVzY3JpcHRpb24g5pys5paH5Lu25Lit55qEIGByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZWAg5pivIEVSQSDlj5jph4/moYbmnrbmnIDmoLjlv4PnmoTlh73mlbDkuYvkuIDjgIJcbiAqIOWug+mAmui/h+WunueOsOKAnOmAhuW6j+Wbnua7mu+8jOmhuuW6j+mHjeeul+KAneeahOmAu+i+ke+8jOino+WGs+S6huWboOa2iOaBr+WIoOmZpOOAgeWIh+aNouWIhuaUryAoc3dpcGUpIOetieaTjeS9nOWvvOiHtOeahOWPmOmHj+eKtuaAgeS4jua2iOaBr+WOhuWPsuS4jeS4gOiHtOeahOajmOaJi+mXrumimOOAglxuICpcbiAqICMjIyDphZLppobnmoTlpYfnibnooYzkuLogKEZlYXR1cmUsIG5vdCBhIGJ1ZylcbiAqXG4gKiDlvZPliKDpmaTkuIDmnaEgc3dpcGUgKOS+i+Wmgu+8jOW4puacieWPmOmHjyBpZD0yIOeahOa2iOaBrykg5pe277yaXG4gKiAxLiAqKuWGheWuueS4juWPmOmHj+mUmeS9jSoqOiDlkI7kuIDmnaEgc3dpcGUgKGlkPTMpIOeahCoq5YaF5a65KirkvJrigJzpobbigJ3liLDooqvliKDpmaTnmoQgc3dpcGUgKGlkPTIpIOeahOS9jee9ruS4iu+8jOS9hioq5Y+Y6YePKirljbTkv53nlZnkuoYgaWQ9MiDnmoTlj5jph4/jgIJcbiAqIDIuICoq5a2k5YS/5Y+Y6YeP5q6L55WZKio6IOWOn+acrOeahCBzd2lwZSAzIOa2iOaBr+iZveeEtuWcqOeVjOmdouS4iua2iOWkseS6hu+8jOS9huWug+WvueW6lOeahCoq5raI5oGv5Y+Y6YePKiogKGlkPTMpIOS7jeeEtuaui+eVmeWcqOiBiuWkqeaVsOaNruS4re+8jOaIkOS4uuKAnOWtpOWEv+WPmOmHj+KAneOAglxuICogMy4gKirlraTlhL/lj5jph4/nu6fmib8qKjog5aaC5p6c55So5oi35q2k5pe25YaNIHN3aXBlIOS4gOasoe+8jOaWsOeUn+aIkOeahCBzd2lwZSAzIOWwhuS8mioq57un5om/Kirov5nkuKrmrovnlZnnmoTlraTlhL/lj5jph48gKGlkPTMp77yM5a+86Ie05paw5YaF5a656YWN5pen5Y+Y6YeP77yM6L+b5LiA5q2l5Yqg5Ymn54q25oCB5re35Lmx44CCXG4gKiA0LiAqKue7k+aenCoqOiDmiJHku6zlvpfliLDkuobkuIDkuKrlhoXlrrnmmK8gaWQ9M+OAgeWPmOmHj+aYryBpZD0yIOeahOKAnOa3t+WQiOKAnea2iOaBr++8jOW5tuS4lOi/mOacieS4gOS4qiBpZD0zIOeahOWtpOWEv+WPmOmHj+maj+aXtuWPr+iDveiiq+aWsOa2iOaBr+e7p+aJv++8jOmAoOaIkOS4pemHjeeahOeKtuaAgeS4jeS4gOiHtOOAglxuICpcbiAqICMjIyDmnKzlh73mlbDnmoTop6PlhrPnrZbnlaVcbiAqXG4gKiBgcmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2VgIOmAmui/h+WFqOmdoueahOeKtuaAgeavlOWvueadpeino+WGs+atpOmXrumimO+8mlxuICogMS4g5ZyoIGBtZXNzYWdlX2RlbGV0ZWRgLCBgbWVzc2FnZV9zd2lwZWRgIOetieS6i+S7tuinpuWPkeaXtuiiq+iwg+eUqOOAglxuICogMi4g5YWo6Z2i6I635Y+W5b2T5YmN5a6e6ZmF55qE5raI5oGv5YiX6KGo77yM5bm25LiO5LmL5YmN6K6w5b2V55qEIGBTZWxlY3RlZE1rc2Ag5bqP5YiX6L+b6KGM5q+U5a+544CCXG4gKiAzLiDnsr7noa7mib7liLDnrKzkuIDkuKrkuI3kuIDoh7TnmoTngrnvvIjml6DorrrmmK/liKDpmaTjgIHov5jmmK/kv67mlLnvvInjgIJcbiAqIDQuICoq6YCG5bqP5Zue5ruaKio6IOS7juWQjuW+gOWJje+8jOWwhuaJgOacieS4jeS4gOiHtOeahCBgTUtgIOaJgOW8leWFpeeahOWPmOmHj+S/ruaUueWFqOmDqOaSpOmUgOOAglxuICogNS4gKirpobrluo/ph43nrpcqKjog5LuO5LiN5LiA6Ie054K55byA5aeL77yM5qC55o2u5b2T5YmN5raI5oGv55qEKirlrp7pmYXlhoXlrrkqKu+8jOmHjeaWsOiuoeeul+W5tuWGmeWFpeWPmOmHj+OAglxuICpcbiAqICoq5pyA57uI5pWI5p6cKio6IOaXoOiuuuWOhuWPsuiusOW9leWPkeeUn+S9leenjeWPmOWMlu+8jOWPmOmHj+eKtuaAgemDveiDveiiq+WujOe+juWcsOiHquWKqOS/ruWkje+8jOehruS/neaVsOaNruS4gOiHtOaAp+OAglxuICovXG5cbmltcG9ydCB7IExPR1NfUEFUSCwgU0VMX1BBVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyByZWFkTWVzc2FnZUtleSB9IGZyb20gJy4vbWVzc2FnZV9rZXknO1xuaW1wb3J0IHsgZmluZExhc3RBaU1lc3NhZ2UgfSBmcm9tICcuL21lc3NhZ2VfdXRpbHMnO1xuaW1wb3J0IHsgcm9sbGJhY2tCeU1rIH0gZnJvbSAnLi9yb2xsYmFjayc7XG5pbXBvcnQgeyBnZXRFcmFEYXRhLCBMb2dnZXIsIHBhcnNlRWRpdExvZywgdXBkYXRlRXJhTWV0YURhdGEgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZSB9IGZyb20gJy4vdmFyaWFibGVfY2hhbmdlX3Byb2Nlc3Nvcic7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ3N5bmMnKTtcblxuLyoqXG4gKiDojrflj5bnlKjkuo7lj5jph4/mk43kvZznmoRNS+OAguWmguaenOa2iOaBr+aYr+eUqOaIt+a2iOaBr++8jOWImei/lOWbnm51bGzku6Xot7Pov4fmk43kvZzjgIJcbiAqIEBwYXJhbSBtc2cg5raI5oGv5a+56LGhXG4gKiBAcmV0dXJucyBNSyDlrZfnrKbkuLLmiJYgbnVsbFxuICovXG5jb25zdCBnZXRNa0Zyb21Nc2cgPSAobXNnOiBhbnkpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgY29uc3Qga2V5ID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcbiAgaWYgKCFrZXkpIHJldHVybiBudWxsO1xuXG4gIHJldHVybiBrZXk7XG59O1xuXG4vKipcbiAqIOajgOafpeS4gOe7hCBNSyDlr7nlupTnmoQgRWRpdExvZyDmmK/lkKbpg73kuLrnqbpcbiAqIEBwYXJhbSBta3MgTUsg5YiX6KGoXG4gKiBAcmV0dXJucyDlpoLmnpzmiYDmnIkgRWRpdExvZyDpg73kuLrnqbrliJnov5Tlm54gdHJ1ZVxuICovXG5jb25zdCBjaGVja0VkaXRMb2dzQXJlRW1wdHkgPSAobWtzOiAoc3RyaW5nIHwgbnVsbClbXSk6IGJvb2xlYW4gPT4ge1xuICBjb25zdCB7IG1ldGE6IG1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gIGZvciAoY29uc3QgbWsgb2YgbWtzKSB7XG4gICAgaWYgKCFtaykgY29udGludWU7IC8vIOi3s+i/hyBudWxsICjnlKjmiLfmtojmga8pXG4gICAgY29uc3QgZWRpdExvZ1JhdyA9IF8uZ2V0KG1ldGFEYXRhLCBbTE9HU19QQVRILCBta10pO1xuICAgIGNvbnN0IGVkaXRMb2cgPSBwYXJzZUVkaXRMb2coZWRpdExvZ1Jhdyk7XG4gICAgaWYgKGVkaXRMb2cubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlOyAvLyDlj5HnjrDkuIDkuKrpnZ7nqbogbG9n77yM55u05o6l6L+U5ZueIGZhbHNlXG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlOyAvLyDmiYDmnIkgbG9nIOmDveS4uuepulxufTtcblxuLyoqXG4gKiDlvZPogYrlpKnorrDlvZXlj5HnlJ/lj5jljJbvvIjliKDpmaTjgIHliIfmjaLliIbmlK/vvInml7bvvIzph43mlrDlkIzmraXnirbmgIHnmoTmoLjlv4Plh73mlbBcbiAqIOWunueOsOS6huKAnOmAhuW6j+Wbnua7mu+8jOmhuuW6j+mHjeeul+KAneeahOmAu+i+kVxuICogQHBhcmFtIHtib29sZWFufSBbZm9yY2VGdWxsUmVzeW5jPWZhbHNlXSAtIOWmguaenOS4uiB0cnVl77yM5YiZ5by65Yi25LuO5aS05byA5aeL5a6M5YWo6YeN566X77yM5b+955Wl5beu5byC5qOA5rWL44CCXG4gKi9cbmV4cG9ydCBjb25zdCByZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSA9IGFzeW5jIChmb3JjZUZ1bGxSZXN5bmMgPSBmYWxzZSkgPT4ge1xuICBpZiAoZm9yY2VGdWxsUmVzeW5jKSB7XG4gICAgbG9nZ2VyLndhcm4oJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W8uuWItuWujOWFqOmHjeeul+aooeW8j+W3suWQr+WKqO+8gScpO1xuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+iBiuWkqeiusOW9leWPmOabtO+8jOWQr+WKqOeKtuaAgeWQjOatpS4uLicpO1xuICB9XG5cbiAgLy8g5qC45b+D5YGH6K6+77yaZ2V0Q2hhdE1lc3NhZ2VzIOS8mumHjeaWsOeUn+aIkCBtZXNzYWdlX2lk77yM5L2/5YW25L+d5oyB5LuOIDAg5byA5aeL55qE6L+e57ut5bqP5YiX44CCXG4gIGNvbnN0IGFsbE1lc3NhZ2VzID0gZ2V0Q2hhdE1lc3NhZ2VzKCcwLXt7bGFzdE1lc3NhZ2VJZH19JywgeyBpbmNsdWRlX3N3aXBlczogdHJ1ZSB9KTtcbiAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfojrflj5bliLDnmoQgYWxsTWVzc2FnZXM6JywgYWxsTWVzc2FnZXMpO1xuICBjb25zdCB7IG1ldGE6IG9sZE1ldGFEYXRhIH0gPSBnZXRFcmFEYXRhKCk7XG4gIGNvbnN0IG9sZFNlbGVjdGVkTWtzOiAoc3RyaW5nIHwgbnVsbClbXSA9IF8uY2xvbmVEZWVwKF8uZ2V0KG9sZE1ldGFEYXRhLCBTRUxfUEFUSCwgW10pKTtcblxuICBsb2dnZXIuZGVidWcoXG4gICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICBg54q25oCB5b+r54WnOiBvbGRTZWxlY3RlZE1rcy5sZW5ndGg9JHtvbGRTZWxlY3RlZE1rcy5sZW5ndGh9LCBhbGxNZXNzYWdlcy5sZW5ndGg9JHthbGxNZXNzYWdlcz8ubGVuZ3RoID8/IDB9YCxcbiAgKTtcblxuICBpZiAoIWFsbE1lc3NhZ2VzIHx8IGFsbE1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W9k+WJjeiBiuWkqeiusOW9leS4uuepuu+8jOS4jeaJp+ihjOS7u+S9leaTjeS9nO+8jOWQjOatpee7iOatouOAgicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBmaXJzdFJlY2FsY0lkID0gLTE7XG5cbiAgaWYgKGZvcmNlRnVsbFJlc3luYykge1xuICAgIGZpcnN0UmVjYWxjSWQgPSAwO1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+W8uuWItuaooeW8j++8muiuvue9rumHjeeul+i1t+eCueS4uiAw44CCJyk7XG4gIH1cbiAgLy8gQ2FzZSAxOiDmtojmga/ooqvliKDpmaQgKOaWsOWIl+ihqOavlOaXp+WIl+ihqOefrSlcbiAgZWxzZSBpZiAoYWxsTWVzc2FnZXMubGVuZ3RoIDwgb2xkU2VsZWN0ZWRNa3MubGVuZ3RoKSB7XG4gICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5qOA5rWL5Yiw5raI5oGv5Yig6Zmk44CCJyk7XG4gICAgLy8g5LuO5ZCO5b6A5YmN77yM5a+75om+56ys5LiA5LiqIFwiY3VycmVudE1rID09PSBvbGRNa19hdF9zYW1lX2luZGV4XCIg55qE5a+56b2Q54K5XG4gICAgZm9yIChsZXQgaSA9IGFsbE1lc3NhZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBjdXJyZW50TWsgPSBnZXRNa0Zyb21Nc2coYWxsTWVzc2FnZXNbaV0pO1xuICAgICAgY29uc3QgcmVjb3JkZWRNayA9IG9sZFNlbGVjdGVkTWtzW2ldO1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLFxuICAgICAgICBgW+WIoOmZpC3lr7npvZDmo4Dmn6VdIGk9JHtpfSwgY3VycmVudE1rPSR7Y3VycmVudE1rfSwgcmVjb3JkZWRNaz0ke3JlY29yZGVkTWt9YCxcbiAgICAgICk7XG5cbiAgICAgIGlmIChjdXJyZW50TWsgPT09IHJlY29yZGVkTWspIHtcbiAgICAgICAgZmlyc3RSZWNhbGNJZCA9IGkgKyAxO1xuICAgICAgICBsb2dnZXIubG9nKFxuICAgICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgICAgYOaJvuWIsOWvuem9kOeCueS6jiBtZXNzYWdlX2lkPSR7aX0gKE1LPSR7Y3VycmVudE1rfSnjgILlsIbku44gSUQgJHtmaXJzdFJlY2FsY0lkfSDlvIDlp4vmo4Dmn6XjgIJgLFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpcnN0UmVjYWxjSWQgPT09IC0xKSB7XG4gICAgICBmaXJzdFJlY2FsY0lkID0gMDtcbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+acquaJvuWIsOS7u+S9leWvuem9kOeCue+8jOWwhuS7juWktOW8gOWni+ajgOafpeOAgicpO1xuICAgIH1cblxuICAgIC8vIOOAkOS8mOWMluOAkeajgOafpeiiq+WIoOmZpOeahCBNSyDmmK/lkKblvbHlk43lj5jph49cbiAgICAvLyDnqLPlgaXlnLDmib7lh7rooqvliKDpmaTnmoQgTUvvvJrlr7nmr5TmlrDml6cgTUsg5bqP5YiX55qE5beu5byCXG4gICAgY29uc3QgY3VycmVudE1rU2VxdWVuY2UgPSBhbGxNZXNzYWdlcy5tYXAoZ2V0TWtGcm9tTXNnKS5maWx0ZXIobWsgPT4gbWspO1xuICAgIGNvbnN0IG9sZE1rU2VxdWVuY2UgPSBvbGRTZWxlY3RlZE1rcy5maWx0ZXIobWsgPT4gbWspO1xuICAgIGNvbnN0IGRlbGV0ZWRNa3MgPSBfLmRpZmZlcmVuY2Uob2xkTWtTZXF1ZW5jZSwgY3VycmVudE1rU2VxdWVuY2UpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDml6dNS+W6j+WIlzogWyR7b2xkTWtTZXF1ZW5jZS5qb2luKCcsICcpfV1gKTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaWsE1L5bqP5YiXOiBbJHtjdXJyZW50TWtTZXF1ZW5jZS5qb2luKCcsICcpfV1gKTtcbiAgICBsb2dnZXIuZGVidWcoJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOiuoeeul+WHuueahOiiq+WIoOmZpE1LOiBbJHtkZWxldGVkTWtzLmpvaW4oJywgJyl9XWApO1xuXG4gICAgaWYgKGRlbGV0ZWRNa3MubGVuZ3RoID4gMCAmJiBjaGVja0VkaXRMb2dzQXJlRW1wdHkoZGVsZXRlZE1rcykpIHtcbiAgICAgIGxvZ2dlci5sb2coXG4gICAgICAgICdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsXG4gICAgICAgIGDmo4DmtYvliLDooqvliKDpmaTnmoQgJHtkZWxldGVkTWtzLmxlbmd0aH0g5p2h5raI5oGv5Z2H5LiN5ZCr5Y+Y6YeP5L+u5pS577yM5omn6KGM5b+r6YCf5ZCM5q2l44CCYCxcbiAgICAgICk7XG4gICAgICBjb25zdCBuZXdTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsTWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbmV3U2VsZWN0ZWRNa3NbaV0gPSBnZXRNa0Zyb21Nc2coYWxsTWVzc2FnZXNbaV0pO1xuICAgICAgfVxuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIF8uc2V0KG1ldGEsIFNFTF9QQVRILCBuZXdTZWxlY3RlZE1rcyk7XG4gICAgICAgIHJldHVybiBtZXRhO1xuICAgICAgfSk7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICflv6vpgJ/lkIzmraXlrozmiJDvvIzku4Xkv67mraMgU2VsZWN0ZWRNa3Mg5pWw57uE44CCJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIC8vIENhc2UgMjog5raI5oGv6KKr5L+u5pS5L+WIh+aNoiAo6ZW/5bqm5LiN5Y+YKVxuICBlbHNlIGlmIChhbGxNZXNzYWdlcy5sZW5ndGggPT09IG9sZFNlbGVjdGVkTWtzLmxlbmd0aCkge1xuICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+ajgOa1i+WIsOa2iOaBr+mVv+W6puS4jeWPmO+8jOWPr+iDveS4uuS/ruaUueaIluWIh+aNouOAgicpO1xuICAgIC8vIOS7juWQjuW+gOWJje+8jOWvu+aJvuesrOS4gOS4quS4jeWMuemFjeeahOeCuVxuICAgIGZvciAobGV0IGkgPSBhbGxNZXNzYWdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgY3VycmVudE1rID0gZ2V0TWtGcm9tTXNnKGFsbE1lc3NhZ2VzW2ldKTtcbiAgICAgIGNvbnN0IHJlY29yZGVkTWsgPSBvbGRTZWxlY3RlZE1rc1tpXTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgICAgYFvliIfmjaIt5a+56b2Q5qOA5p+lXSBpPSR7aX0sIGN1cnJlbnRNaz0ke2N1cnJlbnRNa30sIHJlY29yZGVkTWs9JHtyZWNvcmRlZE1rfWAsXG4gICAgICApO1xuICAgICAgaWYgKGN1cnJlbnRNayAhPT0gcmVjb3JkZWRNaykge1xuICAgICAgICBmaXJzdFJlY2FsY0lkID0gaTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpcnN0UmVjYWxjSWQgPT09IC0xKSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmiYDmnIlNS+Wdh+WMuemFje+8jOaXoOmcgOmHjeeul+OAgicpO1xuICAgICAgLy8gTi5CLiDlnKjlvZPliY3mnrbmnoTkuIvvvIxNSyDlt7Looqvnm7TmjqXlhpnlhaXmtojmga/lhoXlrrnvvIzkuI7lhoXlrrnlvLrnu5HlrprjgIJcbiAgICAgIC8vIOWboOatpO+8jOS7u+S9leWvvOiHtOWGheWuueWPmOWMlueahOaTjeS9nO+8iOWmgiBzd2lwZe+8ieS5n+W/heeEtuS8muWvvOiHtCBNSyDnmoTlj5jljJbjgIJcbiAgICAgIC8vIOi/meaEj+WRs+edgO+8jOWmguaenCBNSyDluo/liJflrozlhajljLnphY3vvIzpgqPkuYjlhoXlrrnkuZ/lv4XnhLblrozlhajljLnphY3vvIzml6DpnIDov5vooYzku7vkvZXph43nrpfmiJbkv53pmanmgKfmo4Dmn6XjgIJcbiAgICAgIHJldHVybjsgLy8g55u05o6l6L+U5Zue77yM57uI5q2i5ZCM5q2l44CCXG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaJvuWIsOacgOaXqeeahOS4jeWMuemFjeeCueS6jiBtZXNzYWdlX2lkPSR7Zmlyc3RSZWNhbGNJZH3jgILlsIbku47or6XngrnlvIDlp4vph43nrpfjgIJgKTtcbiAgICB9XG4gIH1cbiAgLy8gQ2FzZSAzOiDmtojmga/ooqvmt7vliqAgKOaWsOWIl+ihqOavlOaXp+WIl+ihqOmVvylcbiAgZWxzZSB7XG4gICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn5qOA5rWL5Yiw5raI5oGv5re75Yqg44CCJyk7XG4gICAgLy8g5bCG6YeN566X6LW354K56K6+572u5Li65paw5raI5oGv55qE6LW35aeL57Si5byV77yM6K6p5ZCM5q2l5rWB56iL57uf5LiA5aSE55CGXG4gICAgZmlyc3RSZWNhbGNJZCA9IG9sZFNlbGVjdGVkTWtzLmxlbmd0aDtcbiAgICBsb2dnZXIubG9nKFxuICAgICAgJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJyxcbiAgICAgIGDmlrDlop7mtojmga/nmoTlhpnlhaXpgLvovpHlt7LnlLHlkIzmraXmtYHnqIvmjqXnrqHjgILlsIbku47mlrDlop7mtojmga8gKElEOiAke2ZpcnN0UmVjYWxjSWR9KSDlvIDlp4vlpITnkIbjgIJgLFxuICAgICk7XG4gIH1cblxuICAvLyAzLiDmlLbpm4bpnIDopoHlm57mu5rnmoQgTUsg5YiX6KGo77yM5bm25omn6KGM6YCG5bqP5Zue5ruaXG4gIGlmIChmaXJzdFJlY2FsY0lkID4gLTEpIHtcbiAgICBjb25zdCBta3NUb1JvbGxiYWNrID0gb2xkU2VsZWN0ZWRNa3Muc2xpY2UoZmlyc3RSZWNhbGNJZCkuZmlsdGVyKG1rID0+IG1rKSBhcyBzdHJpbmdbXTtcbiAgICBpZiAobWtzVG9Sb2xsYmFjay5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsIGDlh4blpIflm57mu5ogJHtta3NUb1JvbGxiYWNrLmxlbmd0aH0g5LiqTUs6IFske21rc1RvUm9sbGJhY2suam9pbignLCAnKX1dYCk7XG4gICAgICBmb3IgKGNvbnN0IG1rIG9mIG1rc1RvUm9sbGJhY2sucmV2ZXJzZSgpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBgW+Wbnua7ml0g5q2j5Zyo5Zue5ruaIE1LOiAke21rfWApO1xuICAgICAgICBhd2FpdCByb2xsYmFja0J5TWsobWssIHRydWUpOyAvLyB0cnVlIOihqOekuuWPquWbnua7mu+8jOS4jemHjeWGmVxuICAgICAgfVxuICAgICAgbG9nZ2VyLmxvZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCAn6YCG5bqP5Zue5rua5a6M5oiQ44CCJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gNC4g5LuO5LiN5Yy56YWN54K55byA5aeL77yM6aG65bqP6YeN5paw5bqU55So5Y+Y6YeP5L+u5pS577yM5bm25p6E5bu65paw55qEIHNlbGVjdGVkTWtzXG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOS7jiBJRCAke2ZpcnN0UmVjYWxjSWR9IOW8gOWni+mhuuW6j+mHjeeuly4uLmApO1xuICBjb25zdCBuZXdTZWxlY3RlZE1rczogKHN0cmluZyB8IG51bGwpW10gPSBvbGRTZWxlY3RlZE1rcy5zbGljZSgwLCBmaXJzdFJlY2FsY0lkKTsgLy8g57un5om/5Yy56YWN6YOo5YiGXG5cbiAgZm9yIChsZXQgaSA9IGZpcnN0UmVjYWxjSWQ7IGkgPCBhbGxNZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IG1zZyA9IGFsbE1lc3NhZ2VzW2ldO1xuICAgIGxvZ2dlci5kZWJ1ZygncmVzeW5jU3RhdGVPbkhpc3RvcnlDaGFuZ2UnLCBgW+mHjeeul10g5q2j5Zyo5aSE55CG5raI5oGv57Si5byVOiAke2l9YCk7XG4gICAgY29uc3QgbmV3TWsgPSBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcbiAgICBuZXdTZWxlY3RlZE1rc1tpXSA9IG5ld01rOyAvLyDkvb/nlKjph43nrpflkI7nmoTmlrAgbWVzc2FnZV9pZCAo5Y2zIGkpIOS9nOS4uue0ouW8lVxuICB9XG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+mhuuW6j+mHjeeul+WujOaIkOOAgicpO1xuXG4gIC8vIDUuIOabtOaWsCBTZWxlY3RlZE1rcyDmlbDnu4RcbiAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIG5ld1NlbGVjdGVkTWtzKTtcbiAgICByZXR1cm4gbWV0YTtcbiAgfSk7XG4gIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+eKtuaAgeWQjOatpeWujOaIkOOAgicpO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDjgJDkv53pmanmnLrliLbjgJEgLSDlt7Lkuo4gMjAyNS8xMC8wMiDnp7vpmaRcbiAgLy9cbiAgLy8gKirljoblj7Lljp/lm6AqKjpcbiAgLy8g6K+l5py65Yi25pyA5Yid5piv5Li65LqG6Kej5Yaz5LiA5Liq5pen5p625p6E5LiL55qE4oCc5YaF5a65LeWPmOmHj+mUmeS9jeKAnemXrumimOOAguWcqOaXp+aetuaehOS4re+8jOW9k+WIoOmZpOS4gOadoSBzd2lwZSDml7bvvIxcbiAgLy8g5ZCO5LiA5p2hIHN3aXBlIOeahOWGheWuueS8muKAnOmhtuabv+KAneS4iuadpe+8jOS9huWFtuW6leWxgueahOa2iOaBr+WPmOmHj++8iOWPiuWFtiBNS++8ieWNtOS/neaMgeS4jeWPmOOAglxuICAvLyDov5nlr7zoh7TkuLvlkIzmraXpgLvovpHnmoQgTUsg5q+U5a+55aSx5pWI77yM5peg5rOV5Y+R546w54q25oCB5Y+Y5YyW44CCXG4gIC8vIOS4uuatpO+8jOS/nemZqeacuuWItuiiq+iuvuiuoeS4uu+8mumAmui/hyBgb2xkU2VsZWN0ZWRNa3Ng77yI54q25oCB5Y+Y5pu05YmN55qE5b+r54Wn77yJ5om+5Yiw6KKr5Yig6Zmk55qE5penIE1L77yMXG4gIC8vIOW8uuWItuWbnua7muWug++8jOeEtuWQjuagueaNruW9k+WJjeWPr+ingeeahOaWsOWGheWuuemHjeaWsOWGmeWFpeWPmOmHj++8jOS7juiAjOS/ruWkjemUmeS9jeOAglxuICAvL1xuICAvLyAqKuW9k+WJjeaetuaehOS4i+eahOaDheWGteS4juenu+mZpOWOn+WboCoqOlxuICAvLyDlnKjlvZPliY3mnrbmnoTkuK3vvIxNSyDlt7Looqvnm7TmjqXlhpnlhaXmtojmga/lhoXlrrnvvIzkuI7lhoXlrrnlvLrnu5HlrprjgILlvZMgc3dpcGUg5a+86Ie05YaF5a655Y+Y5YyW5pe277yMTUsg5Lmf5Lya6ZqP5LmL5Y+Y5YyW44CCXG4gIC8vIOi/meS9v+W+l+S4u+WQjOatpemAu+i+ke+8iOmAhuW6j+Wbnua7muOAgemhuuW6j+mHjeeul++8ieW3sue7j+iDveWkn+WujOWFqOOAgeato+ehruWcsOWkhOeQhiBzd2lwZSDnrYnlnLrmma/vvIzkuI3lho3pnIDopoHmraTkv53pmanmnLrliLbjgIJcbiAgLy9cbiAgLy8g57un57ut5L+d55WZ6K+l5py65Yi25LiN5LuF5piv5YaX5L2Z55qE77yM6ICM5LiU5Lya5Li75Yqo5byV5Y+RIEJ1Z++8mlxuICAvLyDlroPkvp3nhLbmjInnhafml6fpgLvovpHvvIzkvb/nlKggYG9sZFNlbGVjdGVkTWtzYCDlm57mu5rkuIDkuKrov4fml7bnmoTjgIHkuI3nm7jlhbPnmoQgTUvvvIzov5nkvJrnoLTlnY/kuLvpgLvovpHliJrliJrlkIzmraXlpb3nmoTmraPnoa7nirbmgIHjgIJcbiAgLy8g6ZqP5ZCO77yM5Zyo6KKr56C05Z2P55qE54q25oCB5LiK6L+b6KGM55qE6YeN5YaZ5pON5L2c5Lya5aSx6LSl5oiW5Lqn55Sf6ZSZ6K+v57uT5p6c77yI5L6L5aaC77yM55Sf5oiQ5LiA5Liq56m655qEIEVkaXRMb2fvvInvvIxcbiAgLy8g5bm26KaG55uW5o6J5LmL5YmN55Sx5Li76YC76L6R5q2j56Gu55Sf5oiQ55qEIEVkaXRMb2fvvIzlr7zoh7TmlbDmja7kuKLlpLHjgIJcbiAgLy9cbiAgLy8g57u85LiK77yM6K+l5py65Yi25bey5LuO4oCc5L+d6Zmp4oCd5Y+Y5Li64oCc6aOO6Zmp4oCd77yM5Zug5q2k6KKr5a6M5YWo5rOo6YeK5o6J44CCXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBsb2dnZXIubG9nKCdyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZScsICfmiafooYzjgJDkv53pmanmnLrliLbjgJHvvJrml6DmnaHku7blm57mu5rlubbph43lhpnmnIDlkI7kuIDmpbwuLi4nKTtcbiAgLy8gY29uc3QgbGFzdFdyaXR0ZW5NayA9IFsuLi5vbGRTZWxlY3RlZE1rc10ucmV2ZXJzZSgpLmZpbmQobWsgPT4gbWspO1xuICAvLyBpZiAobGFzdFdyaXR0ZW5Naykge1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgYOaJvuWIsOacgOWQjuS4gOS4quWGmeWFpeeahE1LOiAke2xhc3RXcml0dGVuTWt977yM5omn6KGM5Zue5ruaLi4uYCk7XG4gIC8vICAgYXdhaXQgcm9sbGJhY2tCeU1rKGxhc3RXcml0dGVuTWssIHRydWUpO1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+Wbnua7muWujOaIkO+8jOWHhuWkh+agueaNruW9k+WJjeacgOWQjuS4gOalvOWGheWuuemHjeWGmS4uLicpO1xuICAvLyAgIGF3YWl0IEFwcGx5VmFyQ2hhbmdlKCk7IC8vIEFwcGx5VmFyQ2hhbmdlIOm7mOiupOWkhOeQhuacgOWQjuS4gOalvFxuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+S/nemZqeaAp+mHjeWGmeWujOaIkOOAgicpO1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGxvZ2dlci5sb2coJ3Jlc3luY1N0YXRlT25IaXN0b3J5Q2hhbmdlJywgJ+acquaJvuWIsOS7u+S9leWPr+S+m+Wbnua7mueahOaXp01L77yM6Lez6L+H5L+d6Zmp5py65Yi244CCJyk7XG4gIC8vIH1cbn07XG5cbi8qKlxuICogKirjgJDlvLrliLblkIzmraXmnIDlkI7kuIDmnaFBSea2iOaBr+OAkSoqXG4gKiDov5nmmK/kuIDkuKrnlKjkuo7nibnlrprlnLrmma/nmoTlh73mlbDvvIzkvovlpoLnlLHlpJbpg6ggQVBJIOinpuWPke+8jOmcgOimgeW8uuWItumHjeeul+acgOWQjuS4gOadoSBBSSDmtojmga/nmoTlj5jph4/jgIJcbiAqIOWug+ino+WGs+S6huWcqOa2iOaBr+WGheWuueiiq+WklumDqOS/ruaUue+8iOS9hiBNSyDmnKrlj5jvvInml7bvvIznirbmgIHml6Dms5Xoh6rliqjmm7TmlrDnmoTpl67popjjgIJcbiAqXG4gKiAqKuaJp+ihjOmAu+i+kSoqOlxuICogMS4gKirlrprkvY0qKjog5om+5Yiw5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr+OAglxuICogMi4gKirlm57mu5oqKjog5aaC5p6c6K+l5raI5oGv5a2Y5Zyo5LiU5pyJIE1L77yM5YiZ5peg5p2h5Lu25Zue5rua5q2kIE1LIOW8leWFpeeahOaJgOacieWPmOmHj+S/ruaUueOAglxuICogMy4gKirph43nrpcqKjog56uL5Y2z5qC55o2u6K+l5raI5oGv55qEKirlvZPliY3lhoXlrrkqKumHjeaWsOiuoeeul+WPmOmHj++8jOW5tueUn+aIkOaWsOeahCBgRWRpdExvZ2DjgIJcbiAqIDQuICoq5pu05pawKio6IOWwhuaWsOeahCBNSyDmm7TmlrDliLAgYFNlbGVjdGVkTWtzYCDmlbDnu4TnmoTmraPnoa7kvY3nva7jgIJcbiAqXG4gKiAqKuWuieWFqOaApyoqOlxuICog5q2k5Ye95pWw5pON5L2c55uu5qCH5piO56Gu77yI5pyA5ZCO5LiA5p2hIEFJIOa2iOaBr++8ie+8jOS4lOWbnua7muWSjOmHjeeul+WcqOWQjOS4gOiwg+eUqOmTvuS4reWujOaIkO+8jFxuICog6YG/5YWN5LqG5pen4oCc5L+d6Zmp5py65Yi24oCd5Lit5Zug55uu5qCH5LiN5piO56Gu6ICM56C05Z2PIGByZXN5bmNgIOeKtuaAgeeahOmjjumZqeOAglxuICovXG5leHBvcnQgY29uc3QgZm9yY2VTeW5jTGFzdEFpTWVzc2FnZSA9IGFzeW5jICgpID0+IHtcbiAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsICflkK/liqjlvLrliLblkIzmraXmnIDlkI7kuIDmnaEgQUkg5raI5oGvLi4uJyk7XG5cbiAgLy8gMS4g5a6a5L2NXG4gIGNvbnN0IG1zZyA9IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICBsb2dnZXIud2FybignZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsICfmnKrmib7liLDlj6/kvpvlvLrliLblkIzmraXnmoQgQUkg5raI5oGv44CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcblxuICBpZiAoIU1LKSB7XG4gICAgbG9nZ2VyLndhcm4oJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5raI5oGvIChJRDogJHttZXNzYWdlSWR9KSDkuI3lkKsgTUvvvIzml6Dms5XmiafooYzlvLrliLblkIzmraXjgILlsIbovazkuLrmiafooYzluLjop4TlhpnlhaUuLi5gKTtcbiAgICAvLyDlpoLmnpzmsqHmnIkgTUvvvIzor7TmmI7mmK/mlrDmtojmga/vvIznm7TmjqXotbDmoIflh4blhpnlhaXmtYHnqIvljbPlj69cbiAgICBhd2FpdCBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UobXNnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2dnZXIubG9nKCdmb3JjZVN5bmNMYXN0QWlNZXNzYWdlJywgYOebruagh+a2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSwgTUs6ICR7TUt9KeOAgmApO1xuXG4gIC8vIDIuIOWbnua7mlxuICBsb2dnZXIuZGVidWcoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5q2j5Zyo5Zue5ruaIE1LOiAke01LfS4uLmApO1xuICBhd2FpdCByb2xsYmFja0J5TWsoTUssIHRydWUpOyAvLyBzaWxlbnQ9dHJ1Ze+8jOmBv+WFjeS4jeW/heimgeeahOaXpeW/l+WIt+aWsFxuXG4gIC8vIDMuIOmHjeeul1xuICBsb2dnZXIuZGVidWcoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5Zue5rua5a6M5oiQ77yM5q2j5Zyo5qC55o2u5b2T5YmN5YaF5a656YeN566XIE1LOiAke01LfS4uLmApO1xuICBjb25zdCBuZXdNSyA9IGF3YWl0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZShtc2cpO1xuXG4gIC8vIDQuIOabtOaWsCBTZWxlY3RlZE1rc1xuICBpZiAobmV3TUspIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdXBkYXRlRXJhTWV0YURhdGEobWV0YSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTWtzID0gXy5nZXQobWV0YSwgU0VMX1BBVEgsIFtdKTtcbiAgICAgICAgc2VsZWN0ZWRNa3NbbWVzc2FnZUlkXSA9IG5ld01LO1xuICAgICAgICBfLnNldChtZXRhLCBTRUxfUEFUSCwgc2VsZWN0ZWRNa3MpO1xuICAgICAgICByZXR1cm4gbWV0YTtcbiAgICAgIH0pO1xuICAgICAgbG9nZ2VyLmxvZygnZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDlvLrliLblkIzmraXlrozmiJDvvIzlt7Lmm7TmlrAgU2VsZWN0ZWRNa3NbJHttZXNzYWdlSWR9XSA9ICR7bmV3TUt9YCk7XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ2ZvcmNlU3luY0xhc3RBaU1lc3NhZ2UnLCBg5by65Yi25ZCM5q2l5ZCO5pu05pawIFNlbGVjdGVkTWtzIOWksei0pTogJHtlPy5tZXNzYWdlIHx8IGV9YCwgZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5lcnJvcignZm9yY2VTeW5jTGFzdEFpTWVzc2FnZScsIGDph43nrpflkI7mnKrog73ojrflj5bmlrDnmoQgTUvvvIxTZWxlY3RlZE1rcyDlj6/og73mnKrmm7TmlrDjgIJgKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ERA变量框架/sync.ts\n\n}");
  },
  "./src/ERA变量框架/template.ts": 
  /*!*********************************!*\
  !*** ./src/ERA变量框架/template.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyTemplateToPatch: () => (/* binding */ applyTemplateToPatch),\n/* harmony export */   getInheritedTemplateContent: () => (/* binding */ getInheritedTemplateContent),\n/* harmony export */   resolveTemplate: () => (/* binding */ resolveTemplate)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ "./src/ERA变量框架/utils.ts");\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_0__.Logger(\'template\');\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nfunction resolveTemplate(inheritedContent, parentNodeData) {\n    // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n    const varsContent = _.get(parentNodeData, \'$template\');\n    logger.debug(\'resolveTemplate\', `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(varsContent)}`);\n    // 2. 按优先级合并 (父节点变量 > 继承)\n    let mergedContent = {};\n    mergedContent = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, inheritedContent);\n    mergedContent = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(mergedContent, varsContent);\n    logger.debug(\'resolveTemplate\', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n    if (_.isEmpty(mergedContent)) {\n        return null;\n    }\n    return mergedContent;\n}\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   "$template": { "hp": 10, "mana": 100, "a": { "d": 1 } },\n *   "lili": { "hp": 15, "class": "warrior", "a": { "c": 1 } }\n * };\n * const key = "lili";\n * // 输出 (合并后的内容):\n * // { "hp": 15, "mana": 100, "class": "warrior", "a": { "c": 1, "d": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nfunction getInheritedTemplateContent(parentTplContent, key) {\n    if (!parentTplContent)\n        return undefined;\n    // 步骤 1: 在父级模板内容中查找通用的原型规则\n    const prototypeContent = _.get(parentTplContent, \'$template\');\n    // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n    const specificContent = _.get(parentTplContent, key);\n    // 步骤 3: 根据查找结果决定最终模板内容\n    if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(prototypeContent)}\\n      - 特异性: ${JSON.stringify(specificContent)}`);\n        // 直接使用 mergeReplaceArray 进行合并\n        const merged = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(prototypeContent), specificContent);\n        logger.debug(\'getInheritedTemplateContent\', `  - 合并后: ${JSON.stringify(merged)}`);\n        return merged;\n    }\n    else if (_.isPlainObject(specificContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到特异性内容: ${JSON.stringify(specificContent)}`);\n        return specificContent;\n    }\n    else if (_.isPlainObject(prototypeContent)) {\n        logger.debug(\'getInheritedTemplateContent\', `为子节点 "${key}" 只找到原型内容: ${JSON.stringify(prototypeContent)}`);\n        return prototypeContent;\n    }\n    logger.debug(\'getInheritedTemplateContent\', `在父级模板内容中未为子节点 "${key}" 找到任何可继承的规则。`);\n    return undefined;\n}\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nfunction applyTemplateToPatch(tplContent, patchObj) {\n    logger.debug(\'applyTemplateToPatch\', `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`);\n    if (!_.isPlainObject(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 补丁不是一个普通对象，直接返回。`);\n        return patchObj;\n    }\n    if (!tplContent) {\n        logger.debug(\'applyTemplateToPatch\', `[退出] 模板内容无效，直接返回补丁。`);\n        return patchObj;\n    }\n    // 如果补丁是空对象，直接使用模板内容\n    if (_.isEmpty(patchObj)) {\n        logger.debug(\'applyTemplateToPatch\', `补丁为空对象，完全使用模板内容。`);\n        return _.cloneDeep(tplContent);\n    }\n    // 如果补丁非空，将模板内容作为默认值与补丁合并\n    const composed = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.mergeReplaceArray)(_.cloneDeep(tplContent), patchObj);\n    logger.debug(\'applyTemplateToPatch\', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n    return composed;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxnQkFBZ0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDakYsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3RlbXBsYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTG9nZ2VyLCBtZXJnZVJlcGxhY2VBcnJheSB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCd0ZW1wbGF0ZScpO1xuXG4vKipcbiAqICoq44CQ6Kej5p6Q5bm25ZCI5bm25qih5p2/5YaF5a6544CRKipcbiAqXG4gKiDku47nu6fmib/nmoTmqKHmnb/lhoXlrrnlkozniLboioLngrnlj5jph4/kuK3lrprkuYnnmoTmqKHmnb/lhoXlrrnkuK3vvIzlkIjlubblh7rlvZPliY3lsYLnuqflj6/nlKjnmoTmqKHmnb/jgIJcbiAqXG4gKiBAcGFyYW0gaW5oZXJpdGVkQ29udGVudCAtIOS7juS4iuS4iuWxgue7p+aJv+eahOaooeadv+WGheWuueOAglxuICogQHBhcmFtIHBhcmVudE5vZGVEYXRhIC0g5b2T5YmN5q2j5Zyo5aSE55CG55qE6IqC54K555qEICoq54i26IqC54K5Kiog5Zyo5Y+Y6YeP5Lit55qE5pWw5o2u44CCXG4gKiBAcmV0dXJucyB7YW55fSAtIOWQiOW5tuWQjueahOWNleS4gOWGheWuueWvueixoe+8jOWmguaenOaJgOacieadpea6kOmDveaXoOaViO+8jOWImei/lOWbniBgbnVsbGDjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVUZW1wbGF0ZShpbmhlcml0ZWRDb250ZW50OiBhbnksIHBhcmVudE5vZGVEYXRhOiBhbnkpOiBhbnkge1xuICAvLyAxLiDku47niLboioLngrnlj5jph4/kuK3vvIzmib7liLDkvZzkuLrlvZPliY3oioLngrnlhYTlvJ/nmoQgJHRlbXBsYXRlXG4gIGNvbnN0IHZhcnNDb250ZW50ID0gXy5nZXQocGFyZW50Tm9kZURhdGEsICckdGVtcGxhdGUnKTtcblxuICBsb2dnZXIuZGVidWcoXG4gICAgJ3Jlc29sdmVUZW1wbGF0ZScsXG4gICAgYOino+aekOWHuueahOaooeadv+WGheWuuTpcXG4gICAgLSDnu6fmib86ICR7SlNPTi5zdHJpbmdpZnkoaW5oZXJpdGVkQ29udGVudCl9XFxuICAgIC0g54i26IqC54K55Y+Y6YePOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgdmFyc0NvbnRlbnQsXG4gICAgKX1gLFxuICApO1xuXG4gIC8vIDIuIOaMieS8mOWFiOe6p+WQiOW5tiAo54i26IqC54K55Y+Y6YePID4g57un5om/KVxuICBsZXQgbWVyZ2VkQ29udGVudDogYW55ID0ge307XG4gIG1lcmdlZENvbnRlbnQgPSBtZXJnZVJlcGxhY2VBcnJheShtZXJnZWRDb250ZW50LCBpbmhlcml0ZWRDb250ZW50KTtcbiAgbWVyZ2VkQ29udGVudCA9IG1lcmdlUmVwbGFjZUFycmF5KG1lcmdlZENvbnRlbnQsIHZhcnNDb250ZW50KTtcblxuICBsb2dnZXIuZGVidWcoJ3Jlc29sdmVUZW1wbGF0ZScsIGDlkIjlubblkI7nmoTmnIDnu4jmqKHmnb/lhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkobWVyZ2VkQ29udGVudCl9YCk7XG5cbiAgaWYgKF8uaXNFbXB0eShtZXJnZWRDb250ZW50KSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIG1lcmdlZENvbnRlbnQ7XG59XG5cbi8qKlxuICogKirjgJDojrflj5blrZDoioLngrnopoHnu6fmib/nmoTmqKHmnb/lhoXlrrnjgJEqKlxuICpcbiAqIOWcqOS4gOS4que7meWumueahOKAnOeItue6p+aooeadv+WGheWuueKAneS4re+8jOafpeaJvuW5tuWQiOW5tuWFtuWGhemDqOWumuS5ieeahOKAnOWOn+Wei+inhOWImeKAnSAoYCR0ZW1wbGF0ZWApIOWSjOKAnOeJueW8guaAp+inhOWImeKAnSAoYGtleWAp77yMXG4gKiDku6XnlJ/miJDkvpvnibnlrprlrZDoioLngrkgYGtleWAg5L2/55So55qE5pyA57uI5qih5p2/5YaF5a6544CCXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIOi+k+WFpTpcbiAqIGNvbnN0IHBhcmVudFRwbENvbnRlbnQgPSB7XG4gKiAgIFwiJHRlbXBsYXRlXCI6IHsgXCJocFwiOiAxMCwgXCJtYW5hXCI6IDEwMCwgXCJhXCI6IHsgXCJkXCI6IDEgfSB9LFxuICogICBcImxpbGlcIjogeyBcImhwXCI6IDE1LCBcImNsYXNzXCI6IFwid2FycmlvclwiLCBcImFcIjogeyBcImNcIjogMSB9IH1cbiAqIH07XG4gKiBjb25zdCBrZXkgPSBcImxpbGlcIjtcbiAqIC8vIOi+k+WHuiAo5ZCI5bm25ZCO55qE5YaF5a65KTpcbiAqIC8vIHsgXCJocFwiOiAxNSwgXCJtYW5hXCI6IDEwMCwgXCJjbGFzc1wiOiBcIndhcnJpb3JcIiwgXCJhXCI6IHsgXCJjXCI6IDEsIFwiZFwiOiAxIH0gfVxuICpcbiAqIEBwYXJhbSBwYXJlbnRUcGxDb250ZW50IC0g54i257qn55qE5qih5p2/5YaF5a6577yM5a6D5pys6Lqr5Y+v6IO95YyF5ZCrIGAkdGVtcGxhdGVgIOWSjCBga2V5YCDkvZzkuLrlrZDplK7jgIJcbiAqIEBwYXJhbSBrZXkgLSDmraPlnKjlpITnkIbnmoTlrZDoioLngrnnmoTplK7lkI3jgIJcbiAqIEByZXR1cm5zIHthbnl9IC0g5a2Q6IqC54K55bqU6K+l57un5om/55qE44CB5bey5ZCI5bm255qE5qih5p2/5YaF5a6577yM5oiWIGB1bmRlZmluZWRg44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQocGFyZW50VHBsQ29udGVudDogYW55LCBrZXk6IHN0cmluZyk6IGFueSB7XG4gIGlmICghcGFyZW50VHBsQ29udGVudCkgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAvLyDmraXpqqQgMTog5Zyo54i257qn5qih5p2/5YaF5a655Lit5p+l5om+6YCa55So55qE5Y6f5Z6L6KeE5YiZXG4gIGNvbnN0IHByb3RvdHlwZUNvbnRlbnQgPSBfLmdldChwYXJlbnRUcGxDb250ZW50LCAnJHRlbXBsYXRlJyk7XG5cbiAgLy8g5q2l6aqkIDI6IOWcqOeItue6p+aooeadv+WGheWuueS4reafpeaJvue7mSBrZXkg55qE54m55byC5oCn6KeE5YiZXG4gIGNvbnN0IHNwZWNpZmljQ29udGVudCA9IF8uZ2V0KHBhcmVudFRwbENvbnRlbnQsIGtleSk7XG5cbiAgLy8g5q2l6aqkIDM6IOagueaNruafpeaJvue7k+aenOWGs+WumuacgOe7iOaooeadv+WGheWuuVxuICBpZiAoXy5pc1BsYWluT2JqZWN0KHByb3RvdHlwZUNvbnRlbnQpICYmIF8uaXNQbGFpbk9iamVjdChzcGVjaWZpY0NvbnRlbnQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsXG4gICAgICBg5Li65a2Q6IqC54K5IFwiJHtrZXl9XCIg5ZCM5pe25om+5Yiw5Y6f5Z6L5ZKM54m55byC5oCn5YaF5a6544CCXFxuICAgICAgLSDljp/lnos6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHByb3RvdHlwZUNvbnRlbnQsXG4gICAgICApfVxcbiAgICAgIC0g54m55byC5oCnOiAke0pTT04uc3RyaW5naWZ5KHNwZWNpZmljQ29udGVudCl9YCxcbiAgICApO1xuICAgIC8vIOebtOaOpeS9v+eUqCBtZXJnZVJlcGxhY2VBcnJheSDov5vooYzlkIjlubZcbiAgICBjb25zdCBtZXJnZWQgPSBtZXJnZVJlcGxhY2VBcnJheShfLmNsb25lRGVlcChwcm90b3R5cGVDb250ZW50KSwgc3BlY2lmaWNDb250ZW50KTtcbiAgICBsb2dnZXIuZGVidWcoJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsIGAgIC0g5ZCI5bm25ZCOOiAke0pTT04uc3RyaW5naWZ5KG1lcmdlZCl9YCk7XG4gICAgcmV0dXJuIG1lcmdlZDtcbiAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3Qoc3BlY2lmaWNDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWPquaJvuWIsOeJueW8guaAp+WGheWuuTogJHtKU09OLnN0cmluZ2lmeShzcGVjaWZpY0NvbnRlbnQpfWAsXG4gICAgKTtcbiAgICByZXR1cm4gc3BlY2lmaWNDb250ZW50O1xuICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChwcm90b3R5cGVDb250ZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICdnZXRJbmhlcml0ZWRUZW1wbGF0ZUNvbnRlbnQnLFxuICAgICAgYOS4uuWtkOiKgueCuSBcIiR7a2V5fVwiIOWPquaJvuWIsOWOn+Wei+WGheWuuTogJHtKU09OLnN0cmluZ2lmeShwcm90b3R5cGVDb250ZW50KX1gLFxuICAgICk7XG4gICAgcmV0dXJuIHByb3RvdHlwZUNvbnRlbnQ7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ2dldEluaGVyaXRlZFRlbXBsYXRlQ29udGVudCcsIGDlnKjniLbnuqfmqKHmnb/lhoXlrrnkuK3mnKrkuLrlrZDoioLngrkgXCIke2tleX1cIiDmib7liLDku7vkvZXlj6/nu6fmib/nmoTop4TliJnjgIJgKTtcbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiAqKuOAkOW6lOeUqOaooeadv+WGheWuueWIsOihpeS4geOAkSoqXG4gKlxuICog5bCG5LiA5Liq4oCc5qih5p2/5YaF5a654oCd5a+56LGh5bqU55So5Yiw5LiA5Liq4oCc6KGl5LiB4oCd5a+56LGh5LiK77yM5L2c5Li65YW26buY6K6k5YC844CCXG4gKlxuICogQHBhcmFtIHRwbENvbnRlbnQgLSDlvZPliY3lsYLnuqflkIjlubblkI7nmoTmqKHmnb/lhoXlrrnjgIJcbiAqIEBwYXJhbSBwYXRjaE9iaiAtIOimgeW6lOeUqOaooeadv+eahOihpeS4geaVsOaNruOAglxuICogQHJldHVybnMge2FueX0gLSDlupTnlKjkuobmqKHmnb/pu5jorqTlgLzkuYvlkI7vvIzmnIDnu4jlkIjmiJDnmoTmlbDmja7lr7nosaHjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5VGVtcGxhdGVUb1BhdGNoKHRwbENvbnRlbnQ6IGFueSwgcGF0Y2hPYmo6IGFueSk6IGFueSB7XG4gIGxvZ2dlci5kZWJ1ZyhcbiAgICAnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLFxuICAgIGBb6L+b5YWlXSDmqKHmnb/lhoXlrrk6ICR7SlNPTi5zdHJpbmdpZnkodHBsQ29udGVudCl9LCDooaXkuIE6ICR7SlNPTi5zdHJpbmdpZnkocGF0Y2hPYmopfWAsXG4gICk7XG5cbiAgaWYgKCFfLmlzUGxhaW5PYmplY3QocGF0Y2hPYmopKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGBb6YCA5Ye6XSDooaXkuIHkuI3mmK/kuIDkuKrmma7pgJrlr7nosaHvvIznm7TmjqXov5Tlm57jgIJgKTtcbiAgICByZXR1cm4gcGF0Y2hPYmo7XG4gIH1cbiAgaWYgKCF0cGxDb250ZW50KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdhcHBseVRlbXBsYXRlVG9QYXRjaCcsIGBb6YCA5Ye6XSDmqKHmnb/lhoXlrrnml6DmlYjvvIznm7TmjqXov5Tlm57ooaXkuIHjgIJgKTtcbiAgICByZXR1cm4gcGF0Y2hPYmo7XG4gIH1cblxuICAvLyDlpoLmnpzooaXkuIHmmK/nqbrlr7nosaHvvIznm7TmjqXkvb/nlKjmqKHmnb/lhoXlrrlcbiAgaWYgKF8uaXNFbXB0eShwYXRjaE9iaikpIHtcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5VGVtcGxhdGVUb1BhdGNoJywgYOihpeS4geS4uuepuuWvueixoe+8jOWujOWFqOS9v+eUqOaooeadv+WGheWuueOAgmApO1xuICAgIHJldHVybiBfLmNsb25lRGVlcCh0cGxDb250ZW50KTtcbiAgfVxuXG4gIC8vIOWmguaenOihpeS4gemdnuepuu+8jOWwhuaooeadv+WGheWuueS9nOS4uum7mOiupOWAvOS4juihpeS4geWQiOW5tlxuICBjb25zdCBjb21wb3NlZCA9IG1lcmdlUmVwbGFjZUFycmF5KF8uY2xvbmVEZWVwKHRwbENvbnRlbnQpLCBwYXRjaE9iaik7XG4gIGxvZ2dlci5kZWJ1ZygnYXBwbHlUZW1wbGF0ZVRvUGF0Y2gnLCBg5ZCI5bm25qih5p2/5LiO6KGl5LiB5ZCO55qE57uT5p6cOiAke0pTT04uc3RyaW5naWZ5KGNvbXBvc2VkKX1gKTtcbiAgcmV0dXJuIGNvbXBvc2VkO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/template.ts\n\n}');
  },
  "./src/ERA变量框架/update.ts": 
  /*!*******************************!*\
  !*** ./src/ERA变量框架/update.ts ***!
  \*******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyEditAtLevel: () => (/* binding */ applyEditAtLevel),\n/* harmony export */   processEditBlocks: () => (/* binding */ processEditBlocks)\n/* harmony export */ });\n/* harmony import */ var _rollback__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rollback */ \"./src/ERA变量框架/rollback.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_1__.Logger('update');\n/**\n * **【递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {Map<string, any>} intraMessageState - 用于跟踪在**同一条消息内部**对同一变量的连续修改。\n */\nasync function applyEditAtLevel(statData, basePath, patchObj, editLog, messageId, intraMessageState) {\n    // --- 1. 路径和存在性检查 ---\n    const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n    if (currentNodeInVars === undefined) {\n        logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`);\n        return;\n    }\n    // --- 2. 权限检查 (`updatable`) ---\n    // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n    const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n    // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n    const isBypassingProtection = isUpdatable === false && // 当前是受保护的\n        _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n    // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n    if (isUpdatable === false && !isBypassingProtection) {\n        logger.warn('applyEditAtLevel', `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`);\n        return; // 终止此分支的递归。\n    }\n    // --- 3. 递归或执行 ---\n    // 遍历指令的键，以驱动递归。\n    for (const key of Object.keys(patchObj)) {\n        const subPath = basePath ? `${basePath}.${key}` : key;\n        const valNew = patchObj[key];\n        // **策略一：递归深入**\n        // 如果指令的值是对象，则继续向内递归。\n        if (_.isPlainObject(valNew)) {\n            await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, intraMessageState);\n            continue; // 继续处理下一个键。\n        }\n        // **策略二：执行更新 (叶子节点)**\n        // 只有当指令的值不是对象时，才执行更新操作。\n        // 路径合法性检查：确保要写入的完整路径是存在的。\n        if (!_.has(statData, subPath)) {\n            logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`);\n            continue;\n        }\n        // a. 查找旧值 (`valOld`)\n        // 这是确保回滚准确性的核心。\n        logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n        let valOld = await (0,_rollback__WEBPACK_IMPORTED_MODULE_0__.findLatestNewValue)(subPath, messageId, logger);\n        if (valOld === null) {\n            valOld = _.get(statData, subPath);\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`);\n        }\n        else {\n            logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n        }\n        const cleaned = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.sanitizeArrays)(valNew); // 清理新值\n        // b. 记录编辑意图\n        // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n        // 这对于调试和历史追溯非常有用。\n        _.set(statData, subPath, cleaned);\n        editLog.push({\n            op: 'update',\n            path: subPath,\n            value_old: _.cloneDeep(valOld),\n            value_new: _.cloneDeep(cleaned),\n        });\n        // c. 更新楼内状态 Map，以便同一消息内的后续操作能正确追溯到这个新值。\n        intraMessageState.set(subPath, _.cloneDeep(cleaned));\n    }\n}\n/**\n * 处理所有 `<VariableEdit>` 指令块。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n */\nasync function processEditBlocks(allEdits, editLog, messageId) {\n    if (allEdits.length > 0) {\n        const intraMessageState = new Map(); // 用于跟踪在**本消息内部**对变量的连续修改。\n        // N.B. 同样，编辑操作也需要独立调用以确保能读取到同一消息中、此前已完成的插入或编辑操作的结果。\n        for (const editRoot of allEdits) {\n            if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot))\n                continue;\n            try {\n                await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.updateEraStatData)(async (stat) => {\n                    logger.debug('processEditBlocks', `处理 editRoot: ${JSON.stringify(editRoot)}`);\n                    // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n                    await applyEditAtLevel(stat, '', editRoot, editLog, messageId, intraMessageState);\n                    return stat;\n                });\n            }\n            catch (e) {\n                logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, e);\n            }\n        }\n        logger.log('processEditBlocks', '所有 VariableEdit 操作完成');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLLE1BQU0sUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ2hDLElBQUksQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO2dCQUFFLFNBQVM7WUFDaEUsSUFBSSxDQUFDO2dCQUNILE1BQU0seURBQWlCLENBQUMsS0FBSyxFQUFDLElBQUksRUFBQyxFQUFFO29CQUNuQyxNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixFQUFFLGdCQUFnQixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDOUUsNEJBQTRCO29CQUM1QixNQUFNLGdCQUFnQixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztvQkFDbEYsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQyxFQUFFLE9BQU8sSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3RSxDQUFDO1FBQ0gsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUMxRCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3VwZGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEVSQSDlj5jph4/moYbmnrYgLSDlj5jph4/nvJbovpHmqKHlnZdcbiAqIEBkZXNjcmlwdGlvblxuICog6K+l5qih5Z2X6LSf6LSj5aSE55CGIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk77yM5a6e546w5a+55bey5a2Y5Zyo5Y+Y6YeP55qE5L+u5pS577yM5bm255Sf5oiQ55So5LqO5Zue5rua55qE57K+56GuIGBFZGl0TG9nYOOAglxuICpcbiAqICoq6K6+6K6h55CG5b+1Kio6XG4gKiAtICoq6IGM6LSj5Y2V5LiAKio6IOaooeWdl+WPquWFs+W/g+WmguS9leagueaNruaMh+S7pOS/ruaUueWPmOmHj+eKtuaAgeW5tueUn+aIkOaXpeW/l++8jOS4jeWFs+W/g+aMh+S7pOS7juS9leiAjOadpeOAglxuICogLSAqKueyvuehruaXpeW/lyoqOiBgRWRpdExvZ2Ag55qE5YeG56Gu5oCn5piv5Zue5rua5Yqf6IO955qE5Z+656GA44CCYGFwcGx5RWRpdEF0TGV2ZWxgIOmAmui/h+eyvuW3p+eahOmAu+i+ke+8jFxuICogICDnibnliKvmmK/lr7nigJzml6flgLzigJ3nmoTljoblj7Lov73muq/vvIznoa7kv53kuobml6Xlv5fnmoTnu53lr7nlj6/pnaDjgIJcbiAqIC0gKirlrrnplJnmgKcqKjog5b2T6YGH5Yiw5peg5pWI6Lev5b6E77yI5aaC5bCd6K+V57yW6L6R5LiN5a2Y5Zyo55qE6Lev5b6E77yJ5pe277yM5Lya6Lez6L+H6K+l5p2h5oyH5Luk5bm257un57ut5aSE55CG5YW25LuW5pyJ5pWI5oyH5Luk77yMXG4gKiAgIOiAjOS4jeaYr+S4reaWreaVtOS4quWGmeWFpei/h+eoi+OAglxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IGZpbmRMYXRlc3ROZXdWYWx1ZSB9IGZyb20gJy4vcm9sbGJhY2snO1xuaW1wb3J0IHsgTG9nZ2VyLCBzYW5pdGl6ZUFycmF5cywgdXBkYXRlRXJhU3RhdERhdGEgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcigndXBkYXRlJyk7XG5cbi8qKlxuICogKirjgJDpgJLlvZLnvJbovpHjgJEqKlxuICog5a6e546w5LqGIGA8VmFyaWFibGVFZGl0PmAg55qE5qC45b+D6YC76L6R77yaKirlj6rkv67mlLnlt7LlrZjlnKjnmoTot6/lvoQqKuOAglxuICpcbiAqICoq5qC45b+D6KeE5YiZKio6XG4gKiAxLiAqKui3r+W+hOW/hemhu+WtmOWcqCoq44CC5aaC5p6c5oyH5Luk5Lit5oyH5a6a55qE6Lev5b6E5Zyo5b2T5YmN5Y+Y6YeP54q25oCB5Lit5LiN5a2Y5Zyo77yM5YiZ6Lez6L+H6K+l5pON5L2c44CCXG4gKiAyLiAqKuWPtuWtkOiKgueCueaTjeS9nCoq44CC5Y+q5Zyo6YGH5Yiw5oyH5Luk5a+56LGh5Lit55qE5Y+25a2Q6IqC54K577yI6Z2e5a+56LGh5YC877yJ5pe25omN5omn6KGM5a6e6ZmF55qE5L+u5pS55ZKM5pel5b+X6K6w5b2V44CCXG4gKiAzLiAqKueyvuehrueahOaXp+WAvOafpeaJvioq44CC5Li65LqG55Sf5oiQ5Y+v5L6b5Zue5rua55qEIGBFZGl0TG9nYO+8jOWug+mcgOimgeaJvuWIsOWPmOmHj+WcqOacrOasoeS/ruaUueWPkeeUnyoq5LmL5YmNKirnmoTigJzml6flgLzigJ3jgIJcbiAqICAgIOafpeaJvumhuuW6j+S4uu+8mummluWFiOmAmui/hyBgZmluZExhdGVzdE5ld1ZhbHVlYCDlnKjljoblj7IgYEVkaXRMb2dgIOS4reWbnua6r++8m+WmguaenOaJvuS4jeWIsO+8jFxuICogICAg5YiZ5LuO5b2T5YmN5raI5oGv5aSE55CG5byA5aeL5pe255qE5Y+Y6YeP5b+r54Wn5Lit6I635Y+W44CC6L+Z5piv56Gu5L+d5pel5b+X5YeG56Gu5oCn55qE5YWz6ZSu44CCXG4gKlxuICogQHBhcmFtIHthbnl9IHN0YXREYXRhIC0g54q25oCB5pWw5o2u5a+56LGhICjljbMgYHN0YXRfZGF0YWAp44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZVBhdGggLSDlvZPliY3pgJLlvZLlsYLnuqfnmoTln7rnoYDot6/lvoTjgIJcbiAqIEBwYXJhbSB7YW55fSBwYXRjaE9iaiAtIOimgeW6lOeUqOeahOihpeS4geWvueixoeOAglxuICogQHBhcmFtIHthbnlbXX0gZWRpdExvZyAtIOeUqOS6juaUtumbhuWPmOabtOiusOW9leeahOaXpeW/l+aVsOe7hOOAglxuICogQHBhcmFtIHtudW1iZXJ9IG1lc3NhZ2VJZCAtIOW9k+WJjeato+WcqOWkhOeQhueahOa2iOaBr+eahCBJRO+8jOeUqOS6juWOhuWPsui/vea6r+OAglxuICogQHBhcmFtIHtNYXA8c3RyaW5nLCBhbnk+fSBpbnRyYU1lc3NhZ2VTdGF0ZSAtIOeUqOS6jui3n+i4quWcqCoq5ZCM5LiA5p2h5raI5oGv5YaF6YOoKirlr7nlkIzkuIDlj5jph4/nmoTov57nu63kv67mlLnjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFwcGx5RWRpdEF0TGV2ZWwoXG4gIHN0YXREYXRhOiBhbnksXG4gIGJhc2VQYXRoOiBzdHJpbmcsXG4gIHBhdGNoT2JqOiBhbnksXG4gIGVkaXRMb2c6IGFueVtdLFxuICBtZXNzYWdlSWQ6IG51bWJlcixcbiAgaW50cmFNZXNzYWdlU3RhdGU6IE1hcDxzdHJpbmcsIGFueT4sXG4pIHtcbiAgLy8gLS0tIDEuIOi3r+W+hOWSjOWtmOWcqOaAp+ajgOafpSAtLS1cbiAgY29uc3QgY3VycmVudE5vZGVJblZhcnMgPSBiYXNlUGF0aCA/IF8uZ2V0KHN0YXREYXRhLCBiYXNlUGF0aCkgOiBzdGF0RGF0YTtcbiAgaWYgKGN1cnJlbnROb2RlSW5WYXJzID09PSB1bmRlZmluZWQpIHtcbiAgICBsb2dnZXIud2FybignYXBwbHlFZGl0QXRMZXZlbCcsIGBWYXJpYWJsZUVkaXQg6Lez6L+H77ya6Lev5b6E5LiN5a2Y5ZyoIC0+ICR7YmFzZVBhdGggfHwgJyhyb290KSd9YCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gLS0tIDIuIOadg+mZkOajgOafpSAoYHVwZGF0YWJsZWApIC0tLVxuICAvLyDor7vlj5YgdXBkYXRhYmxlIOagh+W/l++8jOWmguaenOacquWumuS5ie+8jOWImem7mOiupOS4uiB0cnVlICjlhYHorrjmm7TmlrAp44CCXG4gIGNvbnN0IGlzVXBkYXRhYmxlID0gXy5nZXQoY3VycmVudE5vZGVJblZhcnMsIFsnJG1ldGEnLCAndXBkYXRhYmxlJ10sIHRydWUpO1xuXG4gIC8vIOWumuS5ieixgeWFjeadoeS7tu+8muWPquacieW9k+aMh+S7pOaYjuehruimgeWwhiB1cGRhdGFibGUg5LuOIGZhbHNlIOaUueS4uiB0cnVlIOaXtu+8jOaJjeWFgeiuuOaTjeS9nOOAglxuICBjb25zdCBpc0J5cGFzc2luZ1Byb3RlY3Rpb24gPVxuICAgIGlzVXBkYXRhYmxlID09PSBmYWxzZSAmJiAvLyDlvZPliY3mmK/lj5fkv53miqTnmoRcbiAgICBfLmdldChwYXRjaE9iaiwgWyckbWV0YScsICd1cGRhdGFibGUnXSkgPT09IHRydWU7IC8vIOS4lOaMh+S7pOaEj+WbvuaYr+aYjuehruWcsOWwhuWFtuaUueS4uiB0cnVlXG5cbiAgLy8g5aaC5p6c5Y+X5L+d5oqk5LiU5LiN5ruh6Laz6LGB5YWN5p2h5Lu277yM5YiZ6Zi75q2i5pW05Liq5a2Q5qCR55qE5pu05paw44CCXG4gIGlmIChpc1VwZGF0YWJsZSA9PT0gZmFsc2UgJiYgIWlzQnlwYXNzaW5nUHJvdGVjdGlvbikge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgJ2FwcGx5RWRpdEF0TGV2ZWwnLFxuICAgICAgYFZhcmlhYmxlRWRpdCDlpLHotKXvvJrot6/lvoQgPCR7YmFzZVBhdGh9PiDlj5cgXCIkbWV0YS51cGRhdGFibGU6IGZhbHNlXCIg5L+d5oqk77yM5peg5rOV6KKr5L+u5pS544CCYCxcbiAgICApO1xuICAgIHJldHVybjsgLy8g57uI5q2i5q2k5YiG5pSv55qE6YCS5b2S44CCXG4gIH1cblxuICAvLyAtLS0gMy4g6YCS5b2S5oiW5omn6KGMIC0tLVxuICAvLyDpgY3ljobmjIfku6TnmoTplK7vvIzku6XpqbHliqjpgJLlvZLjgIJcbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMocGF0Y2hPYmopKSB7XG4gICAgY29uc3Qgc3ViUGF0aCA9IGJhc2VQYXRoID8gYCR7YmFzZVBhdGh9LiR7a2V5fWAgOiBrZXk7XG4gICAgY29uc3QgdmFsTmV3ID0gcGF0Y2hPYmpba2V5XTtcblxuICAgIC8vICoq562W55Wl5LiA77ya6YCS5b2S5rex5YWlKipcbiAgICAvLyDlpoLmnpzmjIfku6TnmoTlgLzmmK/lr7nosaHvvIzliJnnu6fnu63lkJHlhoXpgJLlvZLjgIJcbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KHZhbE5ldykpIHtcbiAgICAgIGF3YWl0IGFwcGx5RWRpdEF0TGV2ZWwoc3RhdERhdGEsIHN1YlBhdGgsIHZhbE5ldywgZWRpdExvZywgbWVzc2FnZUlkLCBpbnRyYU1lc3NhZ2VTdGF0ZSk7XG4gICAgICBjb250aW51ZTsgLy8g57un57ut5aSE55CG5LiL5LiA5Liq6ZSu44CCXG4gICAgfVxuXG4gICAgLy8gKirnrZbnlaXkuozvvJrmiafooYzmm7TmlrAgKOWPtuWtkOiKgueCuSkqKlxuICAgIC8vIOWPquacieW9k+aMh+S7pOeahOWAvOS4jeaYr+WvueixoeaXtu+8jOaJjeaJp+ihjOabtOaWsOaTjeS9nOOAglxuXG4gICAgLy8g6Lev5b6E5ZCI5rOV5oCn5qOA5p+l77ya56Gu5L+d6KaB5YaZ5YWl55qE5a6M5pW06Lev5b6E5piv5a2Y5Zyo55qE44CCXG4gICAgaWYgKCFfLmhhcyhzdGF0RGF0YSwgc3ViUGF0aCkpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdhcHBseUVkaXRBdExldmVsJywgYFZhcmlhYmxlRWRpdCDlpLHotKXvvJrot6/lvoTpnZ7ms5XvvIzml6Dms5XlhpnlhaUgLT4gJHtzdWJQYXRofWApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gYS4g5p+l5om+5pen5YC8IChgdmFsT2xkYClcbiAgICAvLyDov5nmmK/noa7kv53lm57mu5rlh4bnoa7mgKfnmoTmoLjlv4PjgIJcbiAgICBsb2dnZXIuZGVidWcoJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgW+aXp+WAvOafpeaJvl0g5YeG5aSH5Li66Lev5b6EIDwke3N1YlBhdGh9PiDku47mtojmga8gSUQgPCR7bWVzc2FnZUlkfT4g5ZCR5LiK6L+95rqvLi4uYCk7XG4gICAgbGV0IHZhbE9sZCA9IGF3YWl0IGZpbmRMYXRlc3ROZXdWYWx1ZShzdWJQYXRoLCBtZXNzYWdlSWQsIGxvZ2dlcik7XG4gICAgaWYgKHZhbE9sZCA9PT0gbnVsbCkge1xuICAgICAgdmFsT2xkID0gXy5nZXQoc3RhdERhdGEsIHN1YlBhdGgpO1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAnYXBwbHlFZGl0QXRMZXZlbCcsXG4gICAgICAgIGBb5pen5YC85p+l5om+XSDov73muq/mnKrmib7liLDljoblj7LlgLzvvIzku47lvZPliY0gc3RhdF9kYXRhIOS4reiOt+WPluWIsOaXp+WAvDogJHtKU09OLnN0cmluZ2lmeSh2YWxPbGQpfWAsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ2FwcGx5RWRpdEF0TGV2ZWwnLCBgW+aXp+WAvOafpeaJvl0g6L+95rqv5oiQ5Yqf77yM5om+5Yiw5Y6G5Y+y5pen5YC8OiAke0pTT04uc3RyaW5naWZ5KHZhbE9sZCl9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYW5lZCA9IHNhbml0aXplQXJyYXlzKHZhbE5ldyk7IC8vIOa4heeQhuaWsOWAvFxuXG4gICAgLy8gYi4g6K6w5b2V57yW6L6R5oSP5Zu+XG4gICAgLy8g5Y2z5L2/5paw5pen5YC855u45ZCM77yM5Lmf6K6w5b2VIEVkaXRMb2fvvIzku6XlrozmlbTlj43mmKDkvZzogIXnmoTnvJbovpHmhI/lm77jgIJcbiAgICAvLyDov5nlr7nkuo7osIPor5Xlkozljoblj7Lov73muq/pnZ7luLjmnInnlKjjgIJcbiAgICBfLnNldChzdGF0RGF0YSwgc3ViUGF0aCwgY2xlYW5lZCk7XG4gICAgZWRpdExvZy5wdXNoKHtcbiAgICAgIG9wOiAndXBkYXRlJyxcbiAgICAgIHBhdGg6IHN1YlBhdGgsXG4gICAgICB2YWx1ZV9vbGQ6IF8uY2xvbmVEZWVwKHZhbE9sZCksXG4gICAgICB2YWx1ZV9uZXc6IF8uY2xvbmVEZWVwKGNsZWFuZWQpLFxuICAgIH0pO1xuICAgIC8vIGMuIOabtOaWsOalvOWGheeKtuaAgSBNYXDvvIzku6Xkvr/lkIzkuIDmtojmga/lhoXnmoTlkI7nu63mk43kvZzog73mraPnoa7ov73muq/liLDov5nkuKrmlrDlgLzjgIJcbiAgICBpbnRyYU1lc3NhZ2VTdGF0ZS5zZXQoc3ViUGF0aCwgXy5jbG9uZURlZXAoY2xlYW5lZCkpO1xuICB9XG59XG5cbi8qKlxuICog5aSE55CG5omA5pyJIGA8VmFyaWFibGVFZGl0PmAg5oyH5Luk5Z2X44CCXG4gKlxuICogQHBhcmFtIHthbnlbXX0gYWxsRWRpdHMgLSDku47mtojmga/kuK3op6PmnpDlh7rnmoTmiYDmnIkgZWRpdCDmjIfku6Tlr7nosaHjgIJcbiAqIEBwYXJhbSB7YW55W119IGVkaXRMb2cgLSDnlKjkuo7mlLbpm4blj5jmm7TorrDlvZXnmoTml6Xlv5fmlbDnu4TjgIJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtZXNzYWdlSWQgLSDlvZPliY3mraPlnKjlpITnkIbnmoTmtojmga/nmoQgSUTjgIJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NFZGl0QmxvY2tzKGFsbEVkaXRzOiBhbnlbXSwgZWRpdExvZzogYW55W10sIG1lc3NhZ2VJZDogbnVtYmVyKSB7XG4gIGlmIChhbGxFZGl0cy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgaW50cmFNZXNzYWdlU3RhdGUgPSBuZXcgTWFwPHN0cmluZywgYW55PigpOyAvLyDnlKjkuo7ot5/ouKrlnKgqKuacrOa2iOaBr+WGhemDqCoq5a+55Y+Y6YeP55qE6L+e57ut5L+u5pS544CCXG4gICAgLy8gTi5CLiDlkIzmoLfvvIznvJbovpHmk43kvZzkuZ/pnIDopoHni6znq4vosIPnlKjku6Xnoa7kv53og73or7vlj5bliLDlkIzkuIDmtojmga/kuK3jgIHmraTliY3lt7LlrozmiJDnmoTmj5LlhaXmiJbnvJbovpHmk43kvZznmoTnu5PmnpzjgIJcbiAgICBmb3IgKGNvbnN0IGVkaXRSb290IG9mIGFsbEVkaXRzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChlZGl0Um9vdCkgfHwgXy5pc0VtcHR5KGVkaXRSb290KSkgY29udGludWU7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB1cGRhdGVFcmFTdGF0RGF0YShhc3luYyBzdGF0ID0+IHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoJ3Byb2Nlc3NFZGl0QmxvY2tzJywgYOWkhOeQhiBlZGl0Um9vdDogJHtKU09OLnN0cmluZ2lmeShlZGl0Um9vdCl9YCk7XG4gICAgICAgICAgLy8g5LuO5qC56Lev5b6EICcnIOW8gOWni+e7n+S4gOmAkuW9kuWFpeWPo++8jOS/neaMgemAu+i+keS4gOiHtOaAp+OAglxuICAgICAgICAgIGF3YWl0IGFwcGx5RWRpdEF0TGV2ZWwoc3RhdCwgJycsIGVkaXRSb290LCBlZGl0TG9nLCBtZXNzYWdlSWQsIGludHJhTWVzc2FnZVN0YXRlKTtcbiAgICAgICAgICByZXR1cm4gc3RhdDtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdwcm9jZXNzRWRpdEJsb2NrcycsIGDlpITnkIYgZWRpdFJvb3Qg5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX1gLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2VyLmxvZygncHJvY2Vzc0VkaXRCbG9ja3MnLCAn5omA5pyJIFZhcmlhYmxlRWRpdCDmk43kvZzlrozmiJAnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/update.ts\n\n}");
  },
  "./src/ERA变量框架/utils.ts": 
  /*!******************************!*\
  !*** ./src/ERA变量框架/utils.ts ***!
  \******************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   J: () => (/* binding */ J),\n/* harmony export */   Logger: () => (/* binding */ Logger),\n/* harmony export */   escapeEraData: () => (/* binding */ escapeEraData),\n/* harmony export */   extractBlocks: () => (/* binding */ extractBlocks),\n/* harmony export */   getEraData: () => (/* binding */ getEraData),\n/* harmony export */   isPO: () => (/* binding */ isPO),\n/* harmony export */   logContext: () => (/* binding */ logContext),\n/* harmony export */   mergeReplaceArray: () => (/* binding */ mergeReplaceArray),\n/* harmony export */   parseEditLog: () => (/* binding */ parseEditLog),\n/* harmony export */   parseJsonl: () => (/* binding */ parseJsonl),\n/* harmony export */   removeMetaFields: () => (/* binding */ removeMetaFields),\n/* harmony export */   rnd: () => (/* binding */ rnd),\n/* harmony export */   sanitizeArrays: () => (/* binding */ sanitizeArrays),\n/* harmony export */   stripCodeFence: () => (/* binding */ stripCodeFence),\n/* harmony export */   unescapeEraData: () => (/* binding */ unescapeEraData),\n/* harmony export */   updateEraMetaData: () => (/* binding */ updateEraMetaData),\n/* harmony export */   updateEraStatData: () => (/* binding */ updateEraStatData),\n/* harmony export */   updateMessageContent: () => (/* binding */ updateMessageContent)\n/* harmony export */ });\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash */ \"lodash\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/**\n * @file ERA 变量框架 - 通用工具模块\n * @description\n * 该文件提供了一系列与业务逻辑无关的、高度可复用的辅助函数和类。\n * 它们是构建整个 ERA 框架的基石，涵盖了日志记录、字符串处理、数据解析、对象操作等基础功能。\n * 将这些通用功能集中在此处，有助于保持其他模块代码的简洁和专注。\n */\n\n\n\n// ==================================================================\n// 日志记录\n// ==================================================================\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持日志分级的记录器。\n *\n * **核心功能**:\n * 1. **日志分级**: 提供 `debug`, `log`, `warn`, `error` 四个级别，方便过滤和定位问题。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式，清晰明了。\n * 3. **控制台输出**: 日志会根据级别使用不同颜色和样式的 `console` 方法输出，便于在浏览器中实时调试。\n * 4. **纯粹的控制台日志**: 日志系统不再向酒馆聊天变量中写入任何数据，避免了性能问题和数据污染。\n */\n/**\n * @type {{mk: string}}\n * @description 一个用于在事件处理期间临时存储日志上下文（如 Message Key）的对象。\n */\nconst logContext = {\n    mk: '',\n};\nclass Logger {\n    moduleName;\n    /**\n     * 创建一个新的 Logger 实例。\n     * @param {string} moduleName - 该 Logger 实例绑定的模块名称。\n     */\n    constructor(moduleName) {\n        this.moduleName = moduleName;\n    }\n    /**\n     * 格式化日志消息。\n     * @param {string} funcName - 调用日志的函数名。\n     * @param {any} message - 日志内容。\n     * @returns {string} 格式化后的日志字符串。\n     */\n    formatMessage(funcName, message) {\n        const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n        return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n    }\n    /**\n     * 记录一条 debug 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    debug(funcName, message, obj) {\n        // 1. 全局级别检查\n        if (_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.currentLevel > _constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.levels.debug)\n            return;\n        // 2. 白名单检查 (仅对 debug 生效)\n        if (_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.currentLevel === _constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.levels.debug && !_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.debugWhitelist.includes(this.moduleName)) {\n            return;\n        }\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.debug(formattedMessage, obj);\n        }\n        else {\n            console.debug(formattedMessage);\n        }\n    }\n    /**\n     * 记录一条 log 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    log(funcName, message, obj) {\n        if (_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.currentLevel > _constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.levels.log)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n        }\n        else {\n            console.log(`%c${formattedMessage}`, 'color: #3498db;');\n        }\n    }\n    /**\n     * 记录一条 warn 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [obj] - 可选的、附加到日志中的对象。\n     */\n    warn(funcName, message, obj) {\n        if (_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.currentLevel > _constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.levels.warn)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (obj) {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n        }\n        else {\n            console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n        }\n    }\n    /**\n     * 记录一条 error 级别的日志。\n     * @param {string} funcName - 函数名。\n     * @param {any} message - 日志内容。\n     * @param {any} [errorObj] - 可选的、附加到日志中的错误对象。\n     */\n    error(funcName, message, errorObj) {\n        if (_constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.currentLevel > _constants__WEBPACK_IMPORTED_MODULE_1__.LOG_CONFIG.levels.error)\n            return;\n        const formattedMessage = this.formatMessage(funcName, message);\n        if (errorObj) {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n        }\n        else {\n            console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n        }\n    }\n}\n// ==================================================================\n// 字符串与数据处理\n// ==================================================================\nconst ESCAPE_MAP = {\n    '.': '__DOT__',\n    '\"': '__DQUOTE__',\n    \"'\": '__SQUOTE__',\n};\nconst UNESCAPE_MAP = lodash__WEBPACK_IMPORTED_MODULE_0___default().invert(ESCAPE_MAP);\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map((lodash__WEBPACK_IMPORTED_MODULE_0___default().escapeRegExp)).join('|'), 'g');\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nfunction escapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => escapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n                newObj[escapedKey] = escapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(escapeRegex, match => ESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nfunction unescapeEraData(data) {\n    if (Array.isArray(data)) {\n        return data.map(item => unescapeEraData(item));\n    }\n    if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(data)) {\n        const newObj = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n                newObj[unescapedKey] = unescapeEraData(data[key]);\n            }\n        }\n        return newObj;\n    }\n    if (typeof data === 'string') {\n        return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n    }\n    return data;\n}\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * 基于 `Math.random()`，在同一毫秒内也能保证极高的唯一性。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nfunction rnd() {\n    return Math.random().toString(36).slice(2, 8);\n}\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nconst isPO = (v) => lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v);\n/**\n * 从文本中提取所有被特定 XML 风格标签包裹的内容块。\n * 使用非贪婪模式的正则表达式，但不处理嵌套标签。\n * @param {string} text - 包含标签的原始文本。\n * @param {string} tag - 要提取的标签名称（例如 'VariableEdit'）。\n * @returns {string[]} 包含所有提取并清理后（去除代码围栏和首尾空格）的内容块的数组。\n */\nfunction extractBlocks(text, tag) {\n    const blocks = [];\n    // 正则表达式: /<tag>([\\s\\S]*?)<\\/tag>/g\n    // - <${tag}>: 匹配开标签。\n    // - ([\\s\\S]*?): 非贪婪地捕获开闭标签之间的所有字符（包括换行符）。\n    // - <\\/${tag}>: 匹配闭标签。\n    // - g: 全局匹配，以找到所有匹配项。\n    const re = new RegExp(`<${tag}>([\\\\s\\\\S]*?)<\\\\/${tag}>`, 'g');\n    let m;\n    while ((m = re.exec(text))) {\n        const rawBody = (m[1] || '').trim();\n        // 在存入前，先剥离AI可能生成的多余代码围栏。\n        const body = stripCodeFence(rawBody);\n        if (body)\n            blocks.push(body);\n    }\n    return blocks;\n}\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nfunction stripCodeFence(s) {\n    if (!s)\n        return s;\n    let t = String(s).trim();\n    // 移除起始围栏，例如 ```json, ```, ~~~\n    t = t.replace(/^\\s*(?:```|~~~)[a-zA-Z0-9_-]*\\s*\\r?\\n/, '');\n    // 移除结束围栏\n    t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n    return t.trim();\n}\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nfunction sanitizeArrays(v) {\n    if (Array.isArray(v)) {\n        // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n        return v.map(e => (Array.isArray(e) || lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(e) ? JSON.stringify(e) : e));\n    }\n    else if (lodash__WEBPACK_IMPORTED_MODULE_0___default().isPlainObject(v)) {\n        // 如果是对象，则递归地对其每个属性值进行净化。\n        const o = {};\n        for (const k in v)\n            o[k] = sanitizeArrays(v[k]);\n        return o;\n    }\n    else {\n        // 其他类型的值直接返回。\n        return v;\n    }\n}\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nconst J = (o) => {\n    try {\n        return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n    }\n    catch (e) {\n        return `<<stringify失败: ${e?.message || e}>>`;\n    }\n};\n// ==================================================================\n// 对象与数据结构操作\n// ==================================================================\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nfunction mergeReplaceArray(base, patch) {\n    // 使用 _.cloneDeep 确保不修改原始对象。\n    return lodash__WEBPACK_IMPORTED_MODULE_0___default().mergeWith(lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(base), lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(patch), (a, b) => {\n        // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n        if (Array.isArray(a) || Array.isArray(b))\n            return b;\n        // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n        return undefined;\n    });\n}\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nfunction parseEditLog(raw) {\n    if (Array.isArray(raw))\n        return raw;\n    if (raw && typeof raw === 'object')\n        return [raw]; // 单个对象也视为有效日志\n    if (typeof raw === 'string') {\n        const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n        try {\n            const arr = JSON.parse(s);\n            return Array.isArray(arr) ? arr : [];\n        }\n        catch {\n            return [];\n        }\n    }\n    return [];\n}\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @param {Logger} [logger] - 可选的日志记录器实例，用于记录解析错误。\n * @returns {any[]} 解析出的对象数组。\n */\nfunction parseJsonl(str, logger) {\n    const objects = [];\n    if (!str || typeof str !== 'string') {\n        return objects;\n    }\n    // 在解析前，先移除所有类型的注释，以提高解析的鲁棒性。\n    const strWithoutComments = str\n        .replace(/\\/\\/.*/g, '') // 移除 // 风格的单行注释\n        .replace(/\\/\\*[\\s\\S]*?\\*\\//g, '') // 移除 /* ... */ 风格的多行注释\n        .replace(/\x3c!--[\\s\\S]*?--\x3e/g, ''); // 移除 \x3c!-- ... --\x3e 风格的 HTML/XML 注释\n    const trimmedStr = strWithoutComments.trim();\n    let braceCount = 0; // 花括号平衡计数器\n    let startIndex = -1; // 当前 JSON 对象的起始索引\n    let inString = false; // 标记是否处于双引号字符串内部\n    for (let i = 0; i < trimmedStr.length; i++) {\n        const char = trimmedStr[i];\n        // 切换 inString 状态，忽略转义的双引号\n        if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        // 如果在字符串内部，则跳过所有花括号的逻辑判断\n        if (inString)\n            continue;\n        if (char === '{') {\n            if (braceCount === 0) {\n                // 发现一个新 JSON 对象的开始\n                startIndex = i;\n            }\n            braceCount++;\n        }\n        else if (char === '}') {\n            if (braceCount > 0) {\n                braceCount--;\n                if (braceCount === 0 && startIndex !== -1) {\n                    // 花括号平衡，一个完整的 JSON 对象被找到\n                    const jsonString = trimmedStr.substring(startIndex, i + 1);\n                    try {\n                        const obj = JSON.parse(jsonString);\n                        objects.push(obj);\n                    }\n                    catch (e) {\n                        // 如果解析失败，记录错误并继续，不中断整个过程\n                        logger?.error('parseJsonl', `JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n                    }\n                    // 重置状态，准备寻找下一个对象\n                    startIndex = -1;\n                }\n            }\n        }\n    }\n    return objects;\n}\n// ==================================================================\n// ERA 变量读写\n// ==================================================================\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nfunction removeMetaFields(obj) {\n    // 对于非对象类型，直接返回原始值\n    if (!lodash__WEBPACK_IMPORTED_MODULE_0___default().isObject(obj)) {\n        return obj;\n    }\n    // 创建深拷贝以避免修改原始对象\n    const newObj = lodash__WEBPACK_IMPORTED_MODULE_0___default().cloneDeep(obj);\n    function recurse(current) {\n        if (Array.isArray(current)) {\n            // 如果是数组，则递归处理数组中的每个元素\n            current.forEach(item => recurse(item));\n        }\n        else if (isPO(current)) {\n            // 如果是纯粹的对象，遍历其所有键\n            for (const key in current) {\n                // 如果键以 '$' 开头，则删除该属性\n                if (key.startsWith('$')) {\n                    delete current[key];\n                }\n                else {\n                    // 否则，递归处理该属性的值\n                    recurse(current[key]);\n                }\n            }\n        }\n    }\n    recurse(newObj);\n    return newObj;\n}\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nfunction getEraData() {\n    const chatVars = getVariables(_constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE) || {};\n    const meta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n    const stat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(chatVars, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n    return { meta, stat };\n}\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nasync function updateEraStatData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentStat = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, {});\n        const newStat = await updater(currentStat);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.STAT_DATA_PATH, newStat);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nasync function updateEraMetaData(updater) {\n    await updateVariablesWith(async (v) => {\n        const currentMeta = lodash__WEBPACK_IMPORTED_MODULE_0___default().get(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, {});\n        const newMeta = await updater(currentMeta);\n        lodash__WEBPACK_IMPORTED_MODULE_0___default().set(v, _constants__WEBPACK_IMPORTED_MODULE_1__.META_DATA_PATH, newMeta);\n        return v;\n    }, _constants__WEBPACK_IMPORTED_MODULE_1__.CHAT_SCOPE);\n}\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n */\nasync function updateMessageContent(message, newContent) {\n    const updatePayload = {\n        message_id: message.message_id,\n    };\n    if (Array.isArray(message.swipes)) {\n        const sid = Number(message.swipe_id ?? 0);\n        const newSwipes = [...message.swipes];\n        newSwipes[sid] = newContent;\n        updatePayload.swipes = newSwipes;\n    }\n    else {\n        updatePayload.message = newContent;\n    }\n    await setChatMessages([updatePayload]);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sU0FBUyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQztRQUM1QixhQUFhLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztJQUNuQyxDQUFDO1NBQU0sQ0FBQztRQUNOLGFBQWEsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO0lBQ3JDLENBQUM7SUFFRCxNQUFNLGVBQWUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFDekMsQ0FBQyIsInNvdXJjZXMiOlsic3JjOi8vdGF2ZXJuX2hlbHBlcl90ZW1wbGF0ZS9zcmMvRVJB5Y+Y6YeP5qGG5p62L3V0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOmAmueUqOW3peWFt+aooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6Xmlofku7bmj5DkvpvkuobkuIDns7vliJfkuI7kuJrliqHpgLvovpHml6DlhbPnmoTjgIHpq5jluqblj6/lpI3nlKjnmoTovoXliqnlh73mlbDlkoznsbvjgIJcbiAqIOWug+S7rOaYr+aehOW7uuaVtOS4qiBFUkEg5qGG5p6255qE5Z+655+z77yM5ra155uW5LqG5pel5b+X6K6w5b2V44CB5a2X56ym5Liy5aSE55CG44CB5pWw5o2u6Kej5p6Q44CB5a+56LGh5pON5L2c562J5Z+656GA5Yqf6IO944CCXG4gKiDlsIbov5nkupvpgJrnlKjlip/og73pm4bkuK3lnKjmraTlpITvvIzmnInliqnkuo7kv53mjIHlhbbku5bmqKHlnZfku6PnoIHnmoTnroDmtIHlkozkuJPms6jjgIJcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBDSEFUX1NDT1BFLCBMT0dfQ09ORklHLCBNRVRBX0RBVEFfUEFUSCwgU1RBVF9EQVRBX1BBVEggfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5pel5b+X6K6w5b2VXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBAY2xhc3MgTG9nZ2VyXG4gKiBAZGVzY3JpcHRpb24g5LiA5Liq5Li6IEVSQSDmoYbmnrborr7orqHnmoTjgIHmlK/mjIHml6Xlv5fliIbnuqfnmoTorrDlvZXlmajjgIJcbiAqXG4gKiAqKuaguOW/g+WKn+iDvSoqOlxuICogMS4gKirml6Xlv5fliIbnuqcqKjog5o+Q5L6bIGBkZWJ1Z2AsIGBsb2dgLCBgd2FybmAsIGBlcnJvcmAg5Zub5Liq57qn5Yir77yM5pa55L6/6L+H5ruk5ZKM5a6a5L2N6Zeu6aKY44CCXG4gKiAyLiAqKue7n+S4gOagvOW8jyoqOiDmiYDmnInml6Xlv5fpg73pgbXlvqogYOOAikVSQeOAi+OAjOaooeWdl+WQjeOAjeOAkOWHveaVsOWQjeOAkeaXpeW/l+WGheWuuWAg55qE5qC85byP77yM5riF5pmw5piO5LqG44CCXG4gKiAzLiAqKuaOp+WItuWPsOi+k+WHuioqOiDml6Xlv5fkvJrmoLnmja7nuqfliKvkvb/nlKjkuI3lkIzpopzoibLlkozmoLflvI/nmoQgYGNvbnNvbGVgIOaWueazlei+k+WHuu+8jOS+v+S6juWcqOa1j+iniOWZqOS4reWunuaXtuiwg+ivleOAglxuICogNC4gKirnuq/nsrnnmoTmjqfliLblj7Dml6Xlv5cqKjog5pel5b+X57O757uf5LiN5YaN5ZCR6YWS6aaG6IGK5aSp5Y+Y6YeP5Lit5YaZ5YWl5Lu75L2V5pWw5o2u77yM6YG/5YWN5LqG5oCn6IO96Zeu6aKY5ZKM5pWw5o2u5rGh5p+T44CCXG4gKi9cbi8qKlxuICogQHR5cGUge3ttazogc3RyaW5nfX1cbiAqIEBkZXNjcmlwdGlvbiDkuIDkuKrnlKjkuo7lnKjkuovku7blpITnkIbmnJ/pl7TkuLTml7blrZjlgqjml6Xlv5fkuIrkuIvmlofvvIjlpoIgTWVzc2FnZSBLZXnvvInnmoTlr7nosaHjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IGxvZ0NvbnRleHQgPSB7XG4gIG1rOiAnJyxcbn07XG5cbmV4cG9ydCBjbGFzcyBMb2dnZXIge1xuICBwcml2YXRlIG1vZHVsZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICog5Yib5bu65LiA5Liq5paw55qEIExvZ2dlciDlrp7kvovjgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1vZHVsZU5hbWUgLSDor6UgTG9nZ2VyIOWunuS+i+e7keWumueahOaooeWdl+WQjeensOOAglxuICAgKi9cbiAgY29uc3RydWN0b3IobW9kdWxlTmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5tb2R1bGVOYW1lID0gbW9kdWxlTmFtZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmoLzlvI/ljJbml6Xlv5fmtojmga/jgIJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bmNOYW1lIC0g6LCD55So5pel5b+X55qE5Ye95pWw5ZCN44CCXG4gICAqIEBwYXJhbSB7YW55fSBtZXNzYWdlIC0g5pel5b+X5YaF5a6544CCXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IOagvOW8j+WMluWQjueahOaXpeW/l+Wtl+espuS4suOAglxuICAgKi9cbiAgcHJpdmF0ZSBmb3JtYXRNZXNzYWdlKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3QgbWtTdHJpbmcgPSBsb2dDb250ZXh0Lm1rID8gYO+8iCR7bG9nQ29udGV4dC5ta33vvIlgIDogJyc7XG4gICAgcmV0dXJuIGDjgIpFUkHjgIske21rU3RyaW5nfeOAjCR7dGhpcy5tb2R1bGVOYW1lfeOAjeOAkCR7ZnVuY05hbWV944CRJHtTdHJpbmcobWVzc2FnZSl9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiDorrDlvZXkuIDmnaEgZGVidWcg57qn5Yir55qE5pel5b+X44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxuICAgKiBAcGFyYW0ge2FueX0gW29ial0gLSDlj6/pgInnmoTjgIHpmYTliqDliLDml6Xlv5fkuK3nmoTlr7nosaHjgIJcbiAgICovXG4gIGRlYnVnKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgb2JqPzogYW55KSB7XG4gICAgLy8gMS4g5YWo5bGA57qn5Yir5qOA5p+lXG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID4gTE9HX0NPTkZJRy5sZXZlbHMuZGVidWcpIHJldHVybjtcbiAgICAvLyAyLiDnmb3lkI3ljZXmo4Dmn6UgKOS7heWvuSBkZWJ1ZyDnlJ/mlYgpXG4gICAgaWYgKExPR19DT05GSUcuY3VycmVudExldmVsID09PSBMT0dfQ09ORklHLmxldmVscy5kZWJ1ZyAmJiAhTE9HX0NPTkZJRy5kZWJ1Z1doaXRlbGlzdC5pbmNsdWRlcyh0aGlzLm1vZHVsZU5hbWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XG4gICAgaWYgKG9iaikge1xuICAgICAgY29uc29sZS5kZWJ1Zyhmb3JtYXR0ZWRNZXNzYWdlLCBvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGZvcm1hdHRlZE1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDorrDlvZXkuIDmnaEgbG9nIOe6p+WIq+eahOaXpeW/l+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDlh73mlbDlkI3jgIJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcbiAgICogQHBhcmFtIHthbnl9IFtvYmpdIC0g5Y+v6YCJ55qE44CB6ZmE5Yqg5Yiw5pel5b+X5Lit55qE5a+56LGh44CCXG4gICAqL1xuICBsb2coZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBvYmo/OiBhbnkpIHtcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPiBMT0dfQ09ORklHLmxldmVscy5sb2cpIHJldHVybjtcblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmZvcm1hdE1lc3NhZ2UoZnVuY05hbWUsIG1lc3NhZ2UpO1xuICAgIGlmIChvYmopIHtcbiAgICAgIGNvbnNvbGUubG9nKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICMzNDk4ZGI7Jywgb2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogIzM0OThkYjsnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5p2hIHdhcm4g57qn5Yir55qE5pel5b+X44CCXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmdW5jTmFtZSAtIOWHveaVsOWQjeOAglxuICAgKiBAcGFyYW0ge2FueX0gbWVzc2FnZSAtIOaXpeW/l+WGheWuueOAglxuICAgKiBAcGFyYW0ge2FueX0gW29ial0gLSDlj6/pgInnmoTjgIHpmYTliqDliLDml6Xlv5fkuK3nmoTlr7nosaHjgIJcbiAgICovXG4gIHdhcm4oZnVuY05hbWU6IHN0cmluZywgbWVzc2FnZTogYW55LCBvYmo/OiBhbnkpIHtcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPiBMT0dfQ09ORklHLmxldmVscy53YXJuKSByZXR1cm47XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXRNZXNzYWdlKGZ1bmNOYW1lLCBtZXNzYWdlKTtcbiAgICBpZiAob2JqKSB7XG4gICAgICBjb25zb2xlLndhcm4oYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2YzOWMxMjsnLCBvYmopO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oYCVjJHtmb3JtYXR0ZWRNZXNzYWdlfWAsICdjb2xvcjogI2YzOWMxMjsnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5LiA5p2hIGVycm9yIOe6p+WIq+eahOaXpeW/l+OAglxuICAgKiBAcGFyYW0ge3N0cmluZ30gZnVuY05hbWUgLSDlh73mlbDlkI3jgIJcbiAgICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDml6Xlv5flhoXlrrnjgIJcbiAgICogQHBhcmFtIHthbnl9IFtlcnJvck9ial0gLSDlj6/pgInnmoTjgIHpmYTliqDliLDml6Xlv5fkuK3nmoTplJnor6/lr7nosaHjgIJcbiAgICovXG4gIGVycm9yKGZ1bmNOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IGFueSwgZXJyb3JPYmo/OiBhbnkpIHtcbiAgICBpZiAoTE9HX0NPTkZJRy5jdXJyZW50TGV2ZWwgPiBMT0dfQ09ORklHLmxldmVscy5lcnJvcikgcmV0dXJuO1xuXG4gICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShmdW5jTmFtZSwgbWVzc2FnZSk7XG4gICAgaWYgKGVycm9yT2JqKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGAlYyR7Zm9ybWF0dGVkTWVzc2FnZX1gLCAnY29sb3I6ICNlNzRjM2M7IGZvbnQtd2VpZ2h0OiBib2xkOycsIGVycm9yT2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihgJWMke2Zvcm1hdHRlZE1lc3NhZ2V9YCwgJ2NvbG9yOiAjZTc0YzNjOyBmb250LXdlaWdodDogYm9sZDsnKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDlrZfnrKbkuLLkuI7mlbDmja7lpITnkIZcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBFU0NBUEVfTUFQOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAnLic6ICdfX0RPVF9fJyxcbiAgJ1wiJzogJ19fRFFVT1RFX18nLFxuICBcIidcIjogJ19fU1FVT1RFX18nLFxufTtcblxuY29uc3QgVU5FU0NBUEVfTUFQOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0gXy5pbnZlcnQoRVNDQVBFX01BUCk7XG5cbmNvbnN0IGVzY2FwZVJlZ2V4ID0gbmV3IFJlZ0V4cChPYmplY3Qua2V5cyhFU0NBUEVfTUFQKS5tYXAoXy5lc2NhcGVSZWdFeHApLmpvaW4oJ3wnKSwgJ2cnKTtcbmNvbnN0IHVuZXNjYXBlUmVnZXggPSBuZXcgUmVnRXhwKE9iamVjdC52YWx1ZXMoRVNDQVBFX01BUCkubWFwKF8uZXNjYXBlUmVnRXhwKS5qb2luKCd8JyksICdnJyk7XG5cbi8qKlxuICog6YCS5b2S5Zyw6L2s5LmJ5a+56LGh5oiW5pWw57uE5Lit5omA5pyJ5a2X56ym5Liy5YC85ZKM6ZSu55qE54m55q6K5a2X56ym44CCXG4gKiBAcGFyYW0gZGF0YSAtIOimgeWkhOeQhueahOaVsOaNruOAglxuICogQHJldHVybnMgLSDovazkuYnlkI7nmoTmlbDmja7jgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVzY2FwZUVyYURhdGE8VD4oZGF0YTogVCk6IFQge1xuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xuICAgIHJldHVybiBkYXRhLm1hcChpdGVtID0+IGVzY2FwZUVyYURhdGEoaXRlbSkpIGFzIGFueTtcbiAgfVxuICBpZiAoXy5pc1BsYWluT2JqZWN0KGRhdGEpKSB7XG4gICAgY29uc3QgbmV3T2JqOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpKSB7XG4gICAgICAgIGNvbnN0IGVzY2FwZWRLZXkgPSBrZXkucmVwbGFjZShlc2NhcGVSZWdleCwgbWF0Y2ggPT4gRVNDQVBFX01BUFttYXRjaF0pO1xuICAgICAgICBuZXdPYmpbZXNjYXBlZEtleV0gPSBlc2NhcGVFcmFEYXRhKChkYXRhIGFzIGFueSlba2V5XSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdPYmogYXMgYW55O1xuICB9XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZGF0YS5yZXBsYWNlKGVzY2FwZVJlZ2V4LCBtYXRjaCA9PiBFU0NBUEVfTUFQW21hdGNoXSkgYXMgYW55O1xuICB9XG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIOmAkuW9kuWcsOWPjei9rOS5ieWvueixoeaIluaVsOe7hOS4reaJgOacieWtl+espuS4suWAvOWSjOmUrueahOeJueauiuWtl+espuOAglxuICogQHBhcmFtIGRhdGEgLSDopoHlpITnkIbnmoTmlbDmja7jgIJcbiAqIEByZXR1cm5zIC0g5Y+N6L2s5LmJ5ZCO55qE5pWw5o2u44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bmVzY2FwZUVyYURhdGE8VD4oZGF0YTogVCk6IFQge1xuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xuICAgIHJldHVybiBkYXRhLm1hcChpdGVtID0+IHVuZXNjYXBlRXJhRGF0YShpdGVtKSkgYXMgYW55O1xuICB9XG4gIGlmIChfLmlzUGxhaW5PYmplY3QoZGF0YSkpIHtcbiAgICBjb25zdCBuZXdPYmo6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkpIHtcbiAgICAgICAgY29uc3QgdW5lc2NhcGVkS2V5ID0ga2V5LnJlcGxhY2UodW5lc2NhcGVSZWdleCwgbWF0Y2ggPT4gVU5FU0NBUEVfTUFQW21hdGNoXSk7XG4gICAgICAgIG5ld09ialt1bmVzY2FwZWRLZXldID0gdW5lc2NhcGVFcmFEYXRhKChkYXRhIGFzIGFueSlba2V5XSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdPYmogYXMgYW55O1xuICB9XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZGF0YS5yZXBsYWNlKHVuZXNjYXBlUmVnZXgsIG1hdGNoID0+IFVORVNDQVBFX01BUFttYXRjaF0pIGFzIGFueTtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiDnlJ/miJDkuIDkuKrmjIflrprplb/luqbnmoTpmo/mnLrlrZfnrKbkuLLvvIznlKjkvZzllK/kuIDmoIfor4bnrKbjgIJcbiAqIOWfuuS6jiBgTWF0aC5yYW5kb20oKWDvvIzlnKjlkIzkuIDmr6vnp5LlhoXkuZ/og73kv53or4HmnoHpq5jnmoTllK/kuIDmgKfjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOS4gOS4qumaj+acuueahOOAgeeUseaVsOWtl+WSjOWwj+WGmeWtl+avjee7hOaIkOeahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gcm5kKCk6IHN0cmluZyB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLCA4KTtcbn1cblxuLyoqXG4gKiDliKTmlq3kuIDkuKrlgLzmmK/lkKbkuLrigJznuq/nsrnnmoTlr7nosaHigJ3vvIhQbGFpbiBPYmplY3TvvInjgIJcbiAqIOaVsOe7hOOAgW51bGzjgIHlh73mlbDjgIFEYXRlIOWvueixoeetiemDveS8mui/lOWbniBmYWxzZeOAglxuICogQHBhcmFtIHsqfSB2IC0g5b6F5qOA5p+l55qE5YC844CCXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0g5aaC5p6c5piv57qv57K555qE5a+56LGh5YiZ6L+U5ZueIHRydWXvvIzlkKbliJnov5Tlm54gZmFsc2XjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IGlzUE8gPSAodjogYW55KTogdiBpcyBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0+IF8uaXNQbGFpbk9iamVjdCh2KTtcblxuLyoqXG4gKiDku47mlofmnKzkuK3mj5Dlj5bmiYDmnInooqvnibnlrpogWE1MIOmjjuagvOagh+etvuWMheijueeahOWGheWuueWdl+OAglxuICog5L2/55So6Z2e6LSq5amq5qih5byP55qE5q2j5YiZ6KGo6L6+5byP77yM5L2G5LiN5aSE55CG5bWM5aWX5qCH562+44CCXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIOWMheWQq+agh+etvueahOWOn+Wni+aWh+acrOOAglxuICogQHBhcmFtIHtzdHJpbmd9IHRhZyAtIOimgeaPkOWPlueahOagh+etvuWQjeensO+8iOS+i+WmgiAnVmFyaWFibGVFZGl0J++8ieOAglxuICogQHJldHVybnMge3N0cmluZ1tdfSDljIXlkKvmiYDmnInmj5Dlj5blubbmuIXnkIblkI7vvIjljrvpmaTku6PnoIHlm7TmoI/lkozpppblsL7nqbrmoLzvvInnmoTlhoXlrrnlnZfnmoTmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RCbG9ja3ModGV4dDogc3RyaW5nLCB0YWc6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgYmxvY2tzOiBzdHJpbmdbXSA9IFtdO1xuICAvLyDmraPliJnooajovr7lvI86IC88dGFnPihbXFxzXFxTXSo/KTxcXC90YWc+L2dcbiAgLy8gLSA8JHt0YWd9Pjog5Yy56YWN5byA5qCH562+44CCXG4gIC8vIC0gKFtcXHNcXFNdKj8pOiDpnZ7otKrlqarlnLDmjZXojrflvIDpl63moIfnrb7kuYvpl7TnmoTmiYDmnInlrZfnrKbvvIjljIXmi6zmjaLooYznrKbvvInjgIJcbiAgLy8gLSA8XFwvJHt0YWd9Pjog5Yy56YWN6Zet5qCH562+44CCXG4gIC8vIC0gZzog5YWo5bGA5Yy56YWN77yM5Lul5om+5Yiw5omA5pyJ5Yy56YWN6aG544CCXG4gIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChgPCR7dGFnfT4oW1xcXFxzXFxcXFNdKj8pPFxcXFwvJHt0YWd9PmAsICdnJyk7XG4gIGxldCBtO1xuICB3aGlsZSAoKG0gPSByZS5leGVjKHRleHQpKSkge1xuICAgIGNvbnN0IHJhd0JvZHkgPSAobVsxXSB8fCAnJykudHJpbSgpO1xuICAgIC8vIOWcqOWtmOWFpeWJje+8jOWFiOWJpeemu0FJ5Y+v6IO955Sf5oiQ55qE5aSa5L2Z5Luj56CB5Zu05qCP44CCXG4gICAgY29uc3QgYm9keSA9IHN0cmlwQ29kZUZlbmNlKHJhd0JvZHkpO1xuICAgIGlmIChib2R5KSBibG9ja3MucHVzaChib2R5KTtcbiAgfVxuICByZXR1cm4gYmxvY2tzO1xufVxuXG4vKipcbiAqIOS7juWtl+espuS4suS4reenu+mZpCBBSSDnlJ/miJDnmoQgTWFya2Rvd24g5Luj56CB5Z2X5Zu05qCP77yI5aaCIGBgYGpzb24gLi4uIGBgYO+8ieOAglxuICogQHBhcmFtIHtzdHJpbmd9IHMgLSDlvoXlpITnkIbnmoTlrZfnrKbkuLLjgIJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IOenu+mZpOWbtOagj+W5tuS/ruWJqummluWwvuepuuagvOWQjueahOWtl+espuS4suOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBDb2RlRmVuY2Uoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzKSByZXR1cm4gcztcbiAgbGV0IHQgPSBTdHJpbmcocykudHJpbSgpO1xuICAvLyDnp7vpmaTotbflp4vlm7TmoI/vvIzkvovlpoIgYGBganNvbiwgYGBgLCB+fn5cbiAgdCA9IHQucmVwbGFjZSgvXlxccyooPzpgYGB8fn5+KVthLXpBLVowLTlfLV0qXFxzKlxccj9cXG4vLCAnJyk7XG4gIC8vIOenu+mZpOe7k+adn+WbtOagj1xuICB0ID0gdC5yZXBsYWNlKC9cXHI/XFxuKD86YGBgfH5+filcXHMqJC8sICcnKTtcbiAgcmV0dXJuIHQudHJpbSgpO1xufVxuXG4vKipcbiAqIOmAkuW9kuWcsOKAnOWHgOWMluKAneS4gOS4quWvueixoe+8jOWwhuWFtuS4reeahOaVsOe7hOaIluWvueixoeWAvOi9rOaNouS4uuWtl+espuS4suOAglxuICog5Li76KaB55So5LqO5YeG5aSH5pWw5o2u5Lul5L6/5Zyo5p+Q5Lqb54m55a6a5Zy65pmv5LiL5bGV56S65oiW5a2Y5YKo44CCXG4gKiBAcGFyYW0geyp9IHYgLSDlvoXlh4DljJbnmoTlgLzjgIJcbiAqIEByZXR1cm5zIHsqfSDlh4DljJblkI7nmoTlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplQXJyYXlzKHY6IGFueSk6IGFueSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YGN5Y6G5YW25YWD57Sg44CC5aaC5p6c5YWD57Sg5piv5pWw57uE5oiW5a+56LGh77yM5YiZ5a2X56ym5Liy5YyW5a6D44CCXG4gICAgcmV0dXJuIHYubWFwKGUgPT4gKEFycmF5LmlzQXJyYXkoZSkgfHwgXy5pc1BsYWluT2JqZWN0KGUpID8gSlNPTi5zdHJpbmdpZnkoZSkgOiBlKSk7XG4gIH0gZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHYpKSB7XG4gICAgLy8g5aaC5p6c5piv5a+56LGh77yM5YiZ6YCS5b2S5Zyw5a+55YW25q+P5Liq5bGe5oCn5YC86L+b6KGM5YeA5YyW44CCXG4gICAgY29uc3QgbzogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGZvciAoY29uc3QgayBpbiB2KSBvW2tdID0gc2FuaXRpemVBcnJheXModltrXSk7XG4gICAgcmV0dXJuIG87XG4gIH0gZWxzZSB7XG4gICAgLy8g5YW25LuW57G75Z6L55qE5YC855u05o6l6L+U5Zue44CCXG4gICAgcmV0dXJuIHY7XG4gIH1cbn1cblxuLyoqXG4gKiDlronlhajlnLDlsIbkuIDkuKrlr7nosaHluo/liJfljJbkuLrmoLzlvI/ljJbnmoQgSlNPTiDlrZfnrKbkuLLjgIJcbiAqIOWmguaenOW6j+WIl+WMluWksei0pe+8jOS4jeS8muaKm+WHuuW8guW4uO+8jOiAjOaYr+i/lOWbnuS4gOS4quWMheWQq+mUmeivr+S/oeaBr+eahOWtl+espuS4suOAglxuICogQHBhcmFtIHsqfSBvIC0g5b6F5bqP5YiX5YyW55qE5a+56LGh44CCXG4gKiBAcmV0dXJucyB7c3RyaW5nfSDmiJDlip/liJnov5Tlm54gSlNPTiDlrZfnrKbkuLLvvIzlpLHotKXliJnov5Tlm57plJnor6/mj5DnpLrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEogPSAobzogYW55KTogc3RyaW5nID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobywgbnVsbCwgMik7IC8vIOS9v+eUqCAyIOS4quepuuagvOi/m+ihjOe8qei/m++8jOaPkOmrmOWPr+ivu+aAp+OAglxuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICByZXR1cm4gYDw8c3RyaW5naWZ55aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0+PmA7XG4gIH1cbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5a+56LGh5LiO5pWw5o2u57uT5p6E5pON5L2cXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiDkvb/nlKjigJzmlrDmlbDnu4Topobnm5bml6fmlbDnu4TigJ3nmoTnrZbnlaXmnaXmt7HluqblkIjlubbkuKTkuKrlr7nosaHjgIJcbiAqIOi/meaYryBgXy5tZXJnZWAg55qE5LiA5Liq5Y+Y5L2T77yM5LiT6Zeo55So5LqO5aSE55CG5qih5p2/5ZCI5bm2562J5Zy65pmv77yMXG4gKiDlnKjov5nkupvlnLrmma/kuK3vvIzmiJHku6zluIzmnJvooaXkuIHlr7nosaHkuK3nmoTmlbDnu4Tog73lpJ/lrozlhajmm7/mjaLln7rnoYDlr7nosaHkuK3nmoTmlbDnu4TvvIzogIzkuI3mmK/lkIjlubblroPku6zjgIJcbiAqIEBwYXJhbSB7Kn0gYmFzZSAtIOWfuuehgOWvueixoeOAglxuICogQHBhcmFtIHsqfSBwYXRjaCAtIOihpeS4geWvueixoeOAglxuICogQHJldHVybnMgeyp9IOWQiOW5tuWQjueahOaWsOWvueixoeOAglxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VSZXBsYWNlQXJyYXkoYmFzZTogYW55LCBwYXRjaDogYW55KTogYW55IHtcbiAgLy8g5L2/55SoIF8uY2xvbmVEZWVwIOehruS/neS4jeS/ruaUueWOn+Wni+WvueixoeOAglxuICByZXR1cm4gXy5tZXJnZVdpdGgoXy5jbG9uZURlZXAoYmFzZSksIF8uY2xvbmVEZWVwKHBhdGNoKSwgKGE6IGFueSwgYjogYW55KSA9PiB7XG4gICAgLy8g6Ieq5a6a5LmJ5ZCI5bm26YC76L6R77ya5aaC5p6c5Lu75LiA5YC85Li65pWw57uE77yM5YiZ55u05o6l6L+U5Zue6KGl5LiB5YC877yIYu+8ie+8jOS7juiAjOWunueOsOimhuebluOAglxuICAgIGlmIChBcnJheS5pc0FycmF5KGEpIHx8IEFycmF5LmlzQXJyYXkoYikpIHJldHVybiBiO1xuICAgIC8vIOWvueS6jumdnuaVsOe7hOexu+Wei++8jOi/lOWbniB1bmRlZmluZWQg5Lul5L2/55SoIF8ubWVyZ2Ug55qE6buY6K6k5ZCI5bm26KGM5Li644CCXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSk7XG59XG5cbi8qKlxuICog5YGl5aOu5Zyw6Kej5p6QIGBFZGl0TG9nYCDnmoTljp/lp4vmlbDmja7jgIJcbiAqIGBFZGl0TG9nYCDlj6/og73ku6XlpJrnp43moLzlvI/lrZjlnKjvvIjlr7nosaHjgIHmlbDnu4TjgIFKU09O5a2X56ym5Liy77yJ77yM5q2k5Ye95pWw5peo5Zyo57uf5LiA5aSE55CG5a6D5Lus44CCXG4gKiBAcGFyYW0geyp9IHJhdyAtIOS7juWPmOmHj+S4reivu+WPlueahOWOn+WniyBgRWRpdExvZ2Ag5pWw5o2u44CCXG4gKiBAcmV0dXJucyB7YW55W119IOino+aekOWQjueahCBgRWRpdExvZ2Ag5pWw57uE44CC5aaC5p6c6Kej5p6Q5aSx6LSl5oiW6L6T5YWl5peg5pWI77yM5YiZ6L+U5Zue5LiA5Liq56m65pWw57uE44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUVkaXRMb2cocmF3OiBhbnkpOiBhbnlbXSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHJhdykpIHJldHVybiByYXc7XG4gIGlmIChyYXcgJiYgdHlwZW9mIHJhdyA9PT0gJ29iamVjdCcpIHJldHVybiBbcmF3XTsgLy8g5Y2V5Liq5a+56LGh5Lmf6KeG5Li65pyJ5pWI5pel5b+XXG4gIGlmICh0eXBlb2YgcmF3ID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHMgPSByYXcucmVwbGFjZSgvXlxccypgYGAoPzpqc29uKT9cXHMqfFxccypgYGBcXHMqJC9nLCAnJyk7IC8vIOenu+mZpOS7o+eggeWbtOagj1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcnIgPSBKU09OLnBhcnNlKHMpO1xuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYXJyKSA/IGFyciA6IFtdO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICByZXR1cm4gW107XG59XG5cbi8qKlxuICog6Kej5p6Q5LiA5Liq5YyF5ZCr5aSa5Liq5Liy6IGUIEpTT04g5a+56LGh55qE5a2X56ym5Liy77yI57G75Ly85LqOIEpTT05MIOagvOW8j++8ieOAglxuICog6L+Z56eN5qC85byP5pyJ5pe25Lya55SxIEFJIOeUn+aIkOOAguatpOWHveaVsOiDveWkn+mAkOS4quaPkOWPluW5tuino+aekOWug+S7rOOAglxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgLSDlvoXop6PmnpDnmoTlrZfnrKbkuLLjgIJcbiAqIEBwYXJhbSB7TG9nZ2VyfSBbbG9nZ2VyXSAtIOWPr+mAieeahOaXpeW/l+iusOW9leWZqOWunuS+i++8jOeUqOS6juiusOW9leino+aekOmUmeivr+OAglxuICogQHJldHVybnMge2FueVtdfSDop6PmnpDlh7rnmoTlr7nosaHmlbDnu4TjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlSnNvbmwoc3RyOiBzdHJpbmcsIGxvZ2dlcj86IExvZ2dlcik6IGFueVtdIHtcbiAgY29uc3Qgb2JqZWN0czogYW55W10gPSBbXTtcbiAgaWYgKCFzdHIgfHwgdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gb2JqZWN0cztcbiAgfVxuXG4gIC8vIOWcqOino+aekOWJje+8jOWFiOenu+mZpOaJgOacieexu+Wei+eahOazqOmHiu+8jOS7peaPkOmrmOino+aekOeahOmygeajkuaAp+OAglxuICBjb25zdCBzdHJXaXRob3V0Q29tbWVudHMgPSBzdHJcbiAgICAucmVwbGFjZSgvXFwvXFwvLiovZywgJycpIC8vIOenu+mZpCAvLyDpo47moLznmoTljZXooYzms6jph4pcbiAgICAucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcLy9nLCAnJykgLy8g56e76ZmkIC8qIC4uLiAqLyDpo47moLznmoTlpJrooYzms6jph4pcbiAgICAucmVwbGFjZSgvPCEtLVtcXHNcXFNdKj8tLT4vZywgJycpOyAvLyDnp7vpmaQgPCEtLSAuLi4gLS0+IOmjjuagvOeahCBIVE1ML1hNTCDms6jph4pcbiAgY29uc3QgdHJpbW1lZFN0ciA9IHN0cldpdGhvdXRDb21tZW50cy50cmltKCk7XG5cbiAgbGV0IGJyYWNlQ291bnQgPSAwOyAvLyDoirHmi6zlj7flubPooaHorqHmlbDlmahcbiAgbGV0IHN0YXJ0SW5kZXggPSAtMTsgLy8g5b2T5YmNIEpTT04g5a+56LGh55qE6LW35aeL57Si5byVXG4gIGxldCBpblN0cmluZyA9IGZhbHNlOyAvLyDmoIforrDmmK/lkKblpITkuo7lj4zlvJXlj7flrZfnrKbkuLLlhoXpg6hcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaW1tZWRTdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaGFyID0gdHJpbW1lZFN0cltpXTtcblxuICAgIC8vIOWIh+aNoiBpblN0cmluZyDnirbmgIHvvIzlv73nlaXovazkuYnnmoTlj4zlvJXlj7dcbiAgICBpZiAoY2hhciA9PT0gJ1wiJyAmJiAoaSA9PT0gMCB8fCB0cmltbWVkU3RyW2kgLSAxXSAhPT0gJ1xcXFwnKSkge1xuICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XG4gICAgfVxuXG4gICAgLy8g5aaC5p6c5Zyo5a2X56ym5Liy5YaF6YOo77yM5YiZ6Lez6L+H5omA5pyJ6Iqx5ous5Y+355qE6YC76L6R5Yik5patXG4gICAgaWYgKGluU3RyaW5nKSBjb250aW51ZTtcblxuICAgIGlmIChjaGFyID09PSAneycpIHtcbiAgICAgIGlmIChicmFjZUNvdW50ID09PSAwKSB7XG4gICAgICAgIC8vIOWPkeeOsOS4gOS4quaWsCBKU09OIOWvueixoeeahOW8gOWni1xuICAgICAgICBzdGFydEluZGV4ID0gaTtcbiAgICAgIH1cbiAgICAgIGJyYWNlQ291bnQrKztcbiAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICd9Jykge1xuICAgICAgaWYgKGJyYWNlQ291bnQgPiAwKSB7XG4gICAgICAgIGJyYWNlQ291bnQtLTtcbiAgICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDAgJiYgc3RhcnRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAvLyDoirHmi6zlj7flubPooaHvvIzkuIDkuKrlrozmlbTnmoQgSlNPTiDlr7nosaHooqvmib7liLBcbiAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gdHJpbW1lZFN0ci5zdWJzdHJpbmcoc3RhcnRJbmRleCwgaSArIDEpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKGpzb25TdHJpbmcpO1xuICAgICAgICAgICAgb2JqZWN0cy5wdXNoKG9iaik7XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzop6PmnpDlpLHotKXvvIzorrDlvZXplJnor6/lubbnu6fnu63vvIzkuI3kuK3mlq3mlbTkuKrov4fnqItcbiAgICAgICAgICAgIGxvZ2dlcj8uZXJyb3IoJ3BhcnNlSnNvbmwnLCBgSlNPTkwg6Kej5p6Q5aSx6LSlOiAke2U/Lm1lc3NhZ2UgfHwgZX0uIOWksei0peeahOeJh+autTogJHtqc29uU3RyaW5nfWAsIGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyDph43nva7nirbmgIHvvIzlh4blpIflr7vmib7kuIvkuIDkuKrlr7nosaFcbiAgICAgICAgICBzdGFydEluZGV4ID0gLTE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9iamVjdHM7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRVJBIOWPmOmHj+ivu+WGmVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICog6YCS5b2S5Zyw5LuO5a+56LGh5Lit56e76Zmk5omA5pyJ5LulIGAkYCDlvIDlpLTnmoTlrZfmrrXvvIjlpoIgYCRtZXRhYCwgYCR0ZW1wbGF0ZWDvvInjgIJcbiAqIOatpOWHveaVsOS8muWIm+W7uuS4gOS4quWvueixoeeahOa3seaLt+i0ne+8jOWboOatpOS4jeS8muS/ruaUueWOn+Wni+WvueixoeOAglxuICogQHBhcmFtIHthbnl9IG9iaiAtIOW+heWkhOeQhueahOWvueixoeaIluWAvOOAglxuICogQHJldHVybnMge2FueX0g5LiA5Liq5LiN5YyF5ZCrIGAkYCDliY3nvIDlrZfmrrXnmoTmlrDlr7nosaHmiJbljp/lp4vlgLzjgIJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU1ldGFGaWVsZHMob2JqOiBhbnkpOiBhbnkge1xuICAvLyDlr7nkuo7pnZ7lr7nosaHnsbvlnovvvIznm7TmjqXov5Tlm57ljp/lp4vlgLxcbiAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgLy8g5Yib5bu65rex5ou36LSd5Lul6YG/5YWN5L+u5pS55Y6f5aeL5a+56LGhXG4gIGNvbnN0IG5ld09iaiA9IF8uY2xvbmVEZWVwKG9iaik7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50OiBhbnkpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50KSkge1xuICAgICAgLy8g5aaC5p6c5piv5pWw57uE77yM5YiZ6YCS5b2S5aSE55CG5pWw57uE5Lit55qE5q+P5Liq5YWD57SgXG4gICAgICBjdXJyZW50LmZvckVhY2goaXRlbSA9PiByZWN1cnNlKGl0ZW0pKTtcbiAgICB9IGVsc2UgaWYgKGlzUE8oY3VycmVudCkpIHtcbiAgICAgIC8vIOWmguaenOaYr+e6r+eyueeahOWvueixoe+8jOmBjeWOhuWFtuaJgOaciemUrlxuICAgICAgZm9yIChjb25zdCBrZXkgaW4gY3VycmVudCkge1xuICAgICAgICAvLyDlpoLmnpzplK7ku6UgJyQnIOW8gOWktO+8jOWImeWIoOmZpOivpeWxnuaAp1xuICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoJyQnKSkge1xuICAgICAgICAgIGRlbGV0ZSBjdXJyZW50W2tleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8g5ZCm5YiZ77yM6YCS5b2S5aSE55CG6K+l5bGe5oCn55qE5YC8XG4gICAgICAgICAgcmVjdXJzZShjdXJyZW50W2tleV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVjdXJzZShuZXdPYmopO1xuICByZXR1cm4gbmV3T2JqO1xufVxuXG4vKipcbiAqIOiOt+WPluW5tuehruS/nSBFUkEg55qE5YWD5pWw5o2u5ZKM54q25oCB5pWw5o2u5a+56LGh55qE5a2Y5Zyo44CCXG4gKiBAcmV0dXJucyB7e21ldGE6IG9iamVjdCwgc3RhdDogb2JqZWN0fX0g5YyF5ZCr5YWD5pWw5o2u5ZKM54q25oCB5pWw5o2u55qE5a+56LGh44CCXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFcmFEYXRhKCk6IHsgbWV0YTogYW55OyBzdGF0OiBhbnkgfSB7XG4gIGNvbnN0IGNoYXRWYXJzID0gZ2V0VmFyaWFibGVzKENIQVRfU0NPUEUpIHx8IHt9O1xuICBjb25zdCBtZXRhID0gXy5nZXQoY2hhdFZhcnMsIE1FVEFfREFUQV9QQVRILCB7fSk7XG4gIGNvbnN0IHN0YXQgPSBfLmdldChjaGF0VmFycywgU1RBVF9EQVRBX1BBVEgsIHt9KTtcbiAgcmV0dXJuIHsgbWV0YSwgc3RhdCB9O1xufVxuXG4vKipcbiAqIOWOn+WtkOaAp+WcsOabtOaWsCBFUkEg55qE54q25oCB5pWw5o2uIChzdGF0X2RhdGEp44CCXG4gKiBAcGFyYW0geyhjdXJyZW50U3RhdERhdGE6IGFueSkgPT4gKGFueSB8IFByb21pc2U8YW55Pil9IHVwZGF0ZXIgLSDkuIDkuKrmjqXmlLblvZPliY0gc3RhdF9kYXRhIOW5tui/lOWbnuS/ruaUueWQjiBzdGF0X2RhdGEg55qE5Ye95pWwICjlj6/ku6XmmK8gYXN5bmMp44CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVFcmFTdGF0RGF0YSh1cGRhdGVyOiAoY3VycmVudFN0YXREYXRhOiBhbnkpID0+IGFueSB8IFByb21pc2U8YW55Pikge1xuICBhd2FpdCB1cGRhdGVWYXJpYWJsZXNXaXRoKGFzeW5jIHYgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ID0gXy5nZXQodiwgU1RBVF9EQVRBX1BBVEgsIHt9KTtcbiAgICBjb25zdCBuZXdTdGF0ID0gYXdhaXQgdXBkYXRlcihjdXJyZW50U3RhdCk7XG4gICAgXy5zZXQodiwgU1RBVF9EQVRBX1BBVEgsIG5ld1N0YXQpO1xuICAgIHJldHVybiB2O1xuICB9LCBDSEFUX1NDT1BFKTtcbn1cblxuLyoqXG4gKiDljp/lrZDmgKflnLDmm7TmlrAgRVJBIOeahOWFg+aVsOaNriAoRVJBTWV0YURhdGEp44CCXG4gKiBAcGFyYW0geyhjdXJyZW50TWV0YURhdGE6IGFueSkgPT4gKGFueSB8IFByb21pc2U8YW55Pil9IHVwZGF0ZXIgLSDkuIDkuKrmjqXmlLblvZPliY0gRVJBTWV0YURhdGEg5bm26L+U5Zue5L+u5pS55ZCOIEVSQU1ldGFEYXRhIOeahOWHveaVsCAo5Y+v5Lul5pivIGFzeW5jKeOAglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRXJhTWV0YURhdGEodXBkYXRlcjogKGN1cnJlbnRNZXRhRGF0YTogYW55KSA9PiBhbnkgfCBQcm9taXNlPGFueT4pIHtcbiAgYXdhaXQgdXBkYXRlVmFyaWFibGVzV2l0aChhc3luYyB2ID0+IHtcbiAgICBjb25zdCBjdXJyZW50TWV0YSA9IF8uZ2V0KHYsIE1FVEFfREFUQV9QQVRILCB7fSk7XG4gICAgY29uc3QgbmV3TWV0YSA9IGF3YWl0IHVwZGF0ZXIoY3VycmVudE1ldGEpO1xuICAgIF8uc2V0KHYsIE1FVEFfREFUQV9QQVRILCBuZXdNZXRhKTtcbiAgICByZXR1cm4gdjtcbiAgfSwgQ0hBVF9TQ09QRSk7XG59XG5cbi8qKlxuICogKirjgJDpgJrnlKjjgJEqKiDmm7TmlrDmjIflrprmtojmga/nmoTlhoXlrrnjgIJcbiAqIOi/meS4qui+heWKqeWHveaVsOWwgeijheS6huWkhOeQhiBgc3dpcGVzYCDlkozmma7pgJogYG1lc3NhZ2VgIOeahOmAu+i+ke+8jOaPkOS+m+S4gOS4que7n+S4gOeahOWGmeWFpeaOpeWPo+OAglxuICogQHBhcmFtIHthbnl9IG1lc3NhZ2UgLSDopoHmm7TmlrDnmoTmtojmga/lr7nosaHjgIJcbiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdDb250ZW50IC0g5YWo5paw55qE5raI5oGv5YaF5a6544CCXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVNZXNzYWdlQ29udGVudChtZXNzYWdlOiBhbnksIG5ld0NvbnRlbnQ6IHN0cmluZykge1xuICBjb25zdCB1cGRhdGVQYXlsb2FkOiB7IG1lc3NhZ2VfaWQ6IG51bWJlcjsgbWVzc2FnZT86IHN0cmluZzsgc3dpcGVzPzogc3RyaW5nW10gfSA9IHtcbiAgICBtZXNzYWdlX2lkOiBtZXNzYWdlLm1lc3NhZ2VfaWQsXG4gIH07XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkobWVzc2FnZS5zd2lwZXMpKSB7XG4gICAgY29uc3Qgc2lkID0gTnVtYmVyKG1lc3NhZ2Uuc3dpcGVfaWQgPz8gMCk7XG4gICAgY29uc3QgbmV3U3dpcGVzID0gWy4uLm1lc3NhZ2Uuc3dpcGVzXTtcbiAgICBuZXdTd2lwZXNbc2lkXSA9IG5ld0NvbnRlbnQ7XG4gICAgdXBkYXRlUGF5bG9hZC5zd2lwZXMgPSBuZXdTd2lwZXM7XG4gIH0gZWxzZSB7XG4gICAgdXBkYXRlUGF5bG9hZC5tZXNzYWdlID0gbmV3Q29udGVudDtcbiAgfVxuXG4gIGF3YWl0IHNldENoYXRNZXNzYWdlcyhbdXBkYXRlUGF5bG9hZF0pO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/utils.ts\n\n}");
  },
  "./src/ERA变量框架/variable_change_processor.ts": 
  /*!**************************************************!*\
  !*** ./src/ERA变量框架/variable_change_processor.ts ***!
  \**************************************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ApplyVarChange: () => (/* binding */ ApplyVarChange),\n/* harmony export */   ApplyVarChangeForMessage: () => (/* binding */ ApplyVarChangeForMessage)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"./src/ERA变量框架/constants.ts\");\n/* harmony import */ var _delete__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./delete */ \"./src/ERA变量框架/delete.ts\");\n/* harmony import */ var _insert__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./insert */ \"./src/ERA变量框架/insert.ts\");\n/* harmony import */ var _message_key__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./message_key */ \"./src/ERA变量框架/message_key.ts\");\n/* harmony import */ var _message_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./message_utils */ \"./src/ERA变量框架/message_utils.ts\");\n/* harmony import */ var _update__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./update */ \"./src/ERA变量框架/update.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils */ \"./src/ERA变量框架/utils.ts\");\n/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n\n\n\n\n\n\n\nconst logger = new _utils__WEBPACK_IMPORTED_MODULE_6__.Logger('variable_change_processor');\n/**\n * **【核心实现】** 对指定的消息应用变量修改。\n * 这是变量写入流程的核心，处理单个消息。\n *\n * @param {TavernMessage} msg - 要处理的酒馆消息对象。\n * @returns {Promise<string | null>} 如果成功处理，返回该消息的 MK；如果消息无需处理或处理失败，返回 null。\n */\nconst ApplyVarChangeForMessage = async (msg) => {\n    logger.debug('ApplyVarChangeForMessage', `开始处理消息...`, { msg });\n    try {\n        if (!msg || typeof msg.message_id !== 'number') {\n            logger.warn('ApplyVarChangeForMessage', '无效消息对象或缺少 message_id，退出');\n            return null;\n        }\n        const messageId = msg.message_id;\n        // 写入函数只负责读取 MK，不负责创建。创建的职责由上游的 `ensureMessageKey` 承担。\n        const MK = (0,_message_key__WEBPACK_IMPORTED_MODULE_3__.readMessageKey)(msg);\n        // 如果消息没有 MK（可能是一个异常状态，如新消息还未被注入 MK），则跳过。\n        if (!MK) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 不含 MK，跳过变量写入。`);\n            return null;\n        }\n        // 根据设计，用户消息自身不应包含变量修改指令，因此跳过变量处理，但返回其已有的 MK。\n        if ((0,_message_utils__WEBPACK_IMPORTED_MODULE_4__.isUserMessage)(msg)) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 为用户消息，跳过变量写入，但保留其 MK。`);\n            return MK;\n        }\n        const rawContent = (0,_message_utils__WEBPACK_IMPORTED_MODULE_4__.getMessageContent)(msg) || '';\n        // 1. 从消息内容中解析出所有指令块。\n        const insertBlocks = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableInsert');\n        const editBlocks = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableEdit');\n        const deleteBlocks = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.extractBlocks)(rawContent, 'VariableDelete');\n        if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n            logger.debug('ApplyVarChangeForMessage', `消息 (ID: ${messageId}) 未检测到变量修改标签。`);\n        }\n        const rawInserts = insertBlocks.flatMap(s => (0,_utils__WEBPACK_IMPORTED_MODULE_6__.parseJsonl)(s, logger));\n        const rawEdits = editBlocks.flatMap(s => (0,_utils__WEBPACK_IMPORTED_MODULE_6__.parseJsonl)(s, logger));\n        const rawDeletes = deleteBlocks.flatMap(s => (0,_utils__WEBPACK_IMPORTED_MODULE_6__.parseJsonl)(s, logger));\n        // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n        const allInserts = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.escapeEraData)(rawInserts);\n        const allEdits = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.escapeEraData)(rawEdits);\n        const allDeletes = (0,_utils__WEBPACK_IMPORTED_MODULE_6__.escapeEraData)(rawDeletes);\n        logger.debug('ApplyVarChangeForMessage', '数据转义完成', {\n            before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n            after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n        });\n        const editLog = []; // 用于收集本轮操作产生的所有变更记录。\n        // 2. --- 处理所有插入操作 (`<VariableInsert>`) ---\n        await (0,_insert__WEBPACK_IMPORTED_MODULE_2__.processInsertBlocks)(allInserts, editLog);\n        // 3. --- 处理所有编辑操作 (`<VariableEdit>`) ---\n        await (0,_update__WEBPACK_IMPORTED_MODULE_5__.processEditBlocks)(allEdits, editLog, messageId);\n        // 4. --- 处理所有删除操作 (`<VariableDelete>`) ---\n        await (0,_delete__WEBPACK_IMPORTED_MODULE_1__.processDeleteBlocks)(allDeletes, editLog);\n        // 5. --- 覆盖式写入 EditLog ---\n        /*\n         * 核心逻辑：无论本轮是否产生了有效的变量修改，都必须用当前的 editLog (哪怕是空数组) 覆盖旧的 EditLog。\n         *\n         * 为什么必须覆盖而不是在没有修改时跳过？\n         *\n         * 根本原因在于，必须确保每个 MK 对应的 EditLog，严格且唯一地反映其所属消息**当前内容**所产生的变量修改。\n         *\n         * 考虑一个场景：\n         * 1. 消息A (MK_A) 的内容包含指令，生成了 EditLog_A。\n         * 2. 用户对消息A进行 swipe，生成了消息B (MK_B)，其内容完全没有变量修改标签。\n         *\n         * 如果在处理消息B时，因为没有检测到指令就“跳过写入”，那么与 MK_B 关联的 EditLog 就会是空的或不存在的。\n         * 这在当前是正确的。\n         *\n         * 但如果用户再次 swipe，从消息B切换回消息A。此时框架会重新处理消息A。\n         * 如果我们不执行覆盖式写入，那么与 MK_A 关联的 EditLog 仍然是之前生成的 EditLog_A，这没有问题。\n         *\n         * 真正的问题在于状态的明确性。覆盖式写入确保了任何一个 MK 的日志，在任何时间点，\n         * 都是其**当前可见内容**的直接产物，没有任何历史遗留。这使得整个系统的状态变迁变得清晰、可预测，\n         * 极大地降低了在复杂操作（如多次 `swipe`、删除、编辑）中出现状态不一致的风险。\n         *\n         * 因此，正确的做法是：用本次解析消息内容生成的 editLog (在无指令的场景下是 `[]`) 去覆盖，\n         * 从而斩断任何可能存在的历史关联，确保数据的一致性和纯粹性。\n         */\n        try {\n            await (0,_utils__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n                const newArr = Array.isArray(editLog) ? editLog : (0,_utils__WEBPACK_IMPORTED_MODULE_6__.parseEditLog)(editLog);\n                logger.debug('ApplyVarChangeForMessage', `准备为 MK=${MK} (MsgID=${messageId}) 写入 EditLog:\\n${JSON.stringify(newArr, null, 2)}`);\n                // 将本轮生成的日志数组，以当前消息的 MK 为键，存入 `EditLogs` 对象。\n                _.set(meta, [_constants__WEBPACK_IMPORTED_MODULE_0__.LOGS_PATH, MK], JSON.stringify(newArr));\n                /*\n                 * N.B. 此函数不再负责更新 SelectedMks 数组。\n                 * 更新 SelectedMks 的职责已移交至上层调用者 (resyncStateOnHistoryChange 或 ApplyVarChange)，\n                 * 以避免在 resync 循环中意外修改正在被读取的 oldSelectedMks 状态。\n                 */\n                return meta;\n            });\n            logger.debug('ApplyVarChangeForMessage', `成功为 MK=${MK} 写入 EditLog。`);\n        }\n        catch (e) {\n            logger.error('ApplyVarChangeForMessage', `为 MK=${MK} 写入 EditLogs 失败: ${e?.message || e}`, e);\n        }\n        return MK;\n    }\n    catch (err) {\n        logger.error('ApplyVarChangeForMessage', `变量写入器异常: ${err?.message || err}`, err);\n        return null;\n    }\n};\n/**\n * **【标准事件处理入口】**\n * 这是一个上层封装，用于处理最新 AI 消息的变量写入，并负责更新 `SelectedMks` 数组。\n * 它会自动寻找最后一条 AI 消息进行操作，通常被绑定到“新消息生成”等事件上。\n */\nconst ApplyVarChange = async () => {\n    logger.debug('ApplyVarChange', `函数被调用...`);\n    // 1. 智能查找最后一条 AI 消息\n    const msg = (0,_message_utils__WEBPACK_IMPORTED_MODULE_4__.findLastAiMessage)();\n    if (!msg || typeof msg.message_id !== 'number') {\n        logger.log('ApplyVarChange', '未找到可处理的 AI 消息，退出。');\n        return;\n    }\n    const messageId = msg.message_id;\n    logger.log('ApplyVarChange', `找到目标 AI 消息 (ID: ${messageId})，开始处理变量写入...`);\n    // 2. 调用核心实现来处理变量和 EditLog 的写入。\n    // EditLog 会被自动关联到从该消息中读取到的 MK 上。\n    const MK = await ApplyVarChangeForMessage(msg);\n    // 3. 在核心流程执行完毕后，在此处统一更新 SelectedMks，确保状态一致。\n    try {\n        await (0,_utils__WEBPACK_IMPORTED_MODULE_6__.updateEraMetaData)(meta => {\n            const selectedMks = _.get(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, []);\n            // 关键：必须使用我们正在处理的 AI 消息的 messageId 作为索引，\n            // 来更新 SelectedMks 数组中对应的 MK 记录。\n            selectedMks[messageId] = MK;\n            _.set(meta, _constants__WEBPACK_IMPORTED_MODULE_0__.SEL_PATH, selectedMks);\n            return meta;\n        });\n    }\n    catch (e) {\n        logger.error('ApplyVarChange', `更新 SelectedMks 失败: ${e?.message || e}`, e);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvRVJB5Y+Y6YeP5qGG5p62L3ZhcmlhYmxlX2NoYW5nZV9wcm9jZXNzb3IudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFFVTtBQUVxQztBQUNIO0FBQ0E7QUFDQTtBQUN1QztBQUN6QztBQUMrRDtBQUU1RyxNQUFNLE1BQU0sR0FBRyxJQUFJLDBDQUFNLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUV2RDs7Ozs7O0dBTUc7QUFDSSxNQUFNLHdCQUF3QixHQUFHLEtBQUssRUFBRSxHQUFRLEVBQTBCLEVBQUU7SUFDakYsTUFBTSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxXQUFXLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELElBQUksQ0FBQztRQUNILElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRSxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUseUJBQXlCLENBQUMsQ0FBQztZQUNuRSxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDO1FBQ2pDLHNEQUFzRDtRQUN0RCxNQUFNLEVBQUUsR0FBRyw0REFBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRS9CLHlDQUF5QztRQUN6QyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDUixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsU0FBUyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ2hGLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELDZDQUE2QztRQUM3QyxJQUFJLDZEQUFhLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN2QixNQUFNLENBQUMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLFdBQVcsU0FBUyx5QkFBeUIsQ0FBQyxDQUFDO1lBQ3hGLE9BQU8sRUFB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aUM7SUFDakMsTUFBTSxFQUFFLEdBQUcsTUFBTSx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUvQyw0Q0FBNEM7SUFDNUMsSUFBSSxDQUFDO1FBQ0gsTUFBTSx5REFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxnREFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlDLHdDQUF3QztZQUN4QyxnQ0FBZ0M7WUFDaEMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxnREFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ25DLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztRQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLHNCQUFzQixDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdFLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzIjpbInNyYzovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvc3JjL0VSQeWPmOmHj+ahhuaeti92YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgRVJBIOWPmOmHj+ahhuaetiAtIOWPmOmHj+WGmeWFpeaooeWdl1xuICogQGRlc2NyaXB0aW9uXG4gKiDor6XmqKHlnZfmmK8gRVJBIOahhuaetueahOKAnOaJp+ihjOW8leaTjuKAne+8jOi0n+i0o+Wwhua2iOaBr+WGheWuueS4reeahOWPmOmHj+S/ruaUueaMh+S7pOW6lOeUqOWIsOWunumZheeahCBgY2hhdGAg5Y+Y6YeP5Lit44CCXG4gKlxuICogKirorr7orqHnkIblv7UqKjpcbiAqIOWPmOmHj+eahOWGmeWFpeaYr+S4gOS4quS4peiwqOeahOi/h+eoi++8jOW/hemhu+ehruS/neaJgOacieWPmOabtOmDveiiq+ato+ehruiusOW9le+8jOS7peS+v+WQjue7reeahOWbnua7muWSjOWQjOatpeOAglxuICog5q2k5qih5Z2X55qE5qC45b+D6IGM6LSj5piv77yaXG4gKiAxLiAqKuino+aekOaMh+S7pCoqOiDku44gQUkg5raI5oGv5Lit5o+Q5Y+WIGA8VmFyaWFibGVJbnNlcnQ+YCDlkowgYDxWYXJpYWJsZUVkaXQ+YCDlnZfjgIJcbiAqIDIuICoq6aG65bqP5omn6KGMKio6IOehruS/neWQjOS4gOa2iOaBr+WGheeahOWkmuS4quaMh+S7pOWdl+aMiemhuuW6j+aJp+ihjO+8jOS4lOWQjue7reaMh+S7pOiDveaEn+efpeWIsOWJjemdouaMh+S7pOeahOe7k+aenOOAglxuICogMy4gKirnlJ/miJDml6Xlv5cqKjog5Zyo5bqU55So5Y+Y5pu055qE5ZCM5pe277yM6LCD55SoIGByZWN1cnNpdmUudHNgIOS4reeahOmAkuW9kuWHveaVsOadpeeUn+aIkOeyvuehrueahCBgRWRpdExvZ2DjgIJcbiAqIDQuICoq6KaG55uW5byP5pel5b+X5YaZ5YWlKio6IOehruS/neavj+S4qua2iOaBr+WvhumSpe+8iE1L77yJ5a+55bqU55qEIGBFZGl0TG9nYCDkuKXmoLzlj43mmKDlhbblvZPliY3lhoXlrrnvvIxcbiAqICAgIOWNs+S9v+WGheWuueS4reayoeacieS7u+S9leaMh+S7pO+8iOatpOaXtuS8muWGmeWFpeepuuaXpeW/l++8ie+8jOS5n+imgeimhuebluaXp+aXpeW/l++8jOi/meaYr+mYsuatoiBgc3dpcGVgIOmAoOaIkOaVsOaNruaxoeafk+eahOWFs+mUruOAglxuICpcbiAqICoq6IGM6LSj6L6555WMKio6XG4gKiAtIOacrOaooeWdlyoq5Y+q6LSf6LSj6K+75Y+WIE1LKirvvIzkuI3otJ/otKPliJvlu7rjgILliJvlu7ogTUsg55qE6IGM6LSj55Sx5LiK5ri455qEIGBtZXNzYWdlX2tleS50c2Ag5om/5ouF44CCXG4gKiAtIGBBcHBseVZhckNoYW5nZUZvck1lc3NhZ2VgIOWHveaVsCoq5Y+q6LSf6LSj5YaZ5YWl5Y+Y6YeP5ZKMIGBFZGl0TG9nYCoq77yM5LiN6LSf6LSj5pu05pawIGBTZWxlY3RlZE1rc2DjgIJcbiAqICAg5pu05pawIGBTZWxlY3RlZE1rc2Ag55qE6IGM6LSj6KKr56e75Lqk57uZ5LqG5pu05LiK5bGC55qE6LCD55So6ICF77yI5aaCIGBBcHBseVZhckNoYW5nZWAg5oiW5ZCM5q2l5Ye95pWw77yJ77yMXG4gKiAgIOS7pemBv+WFjeWcqOWQjOatpeW+queOr+S4reS/ruaUueato+WcqOiiq+ivu+WPlueahOeKtuaAge+8jOi/meaYr+S4gOenjemHjeimgeeahOW5tuWPkeaOp+WItuetlueVpeOAglxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgTE9HU19QQVRILCBTRUxfUEFUSCB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IHByb2Nlc3NEZWxldGVCbG9ja3MgfSBmcm9tICcuL2RlbGV0ZSc7XG5pbXBvcnQgeyBwcm9jZXNzSW5zZXJ0QmxvY2tzIH0gZnJvbSAnLi9pbnNlcnQnO1xuaW1wb3J0IHsgcmVhZE1lc3NhZ2VLZXkgfSBmcm9tICcuL21lc3NhZ2Vfa2V5JztcbmltcG9ydCB7IGZpbmRMYXN0QWlNZXNzYWdlLCBnZXRNZXNzYWdlQ29udGVudCwgaXNVc2VyTWVzc2FnZSB9IGZyb20gJy4vbWVzc2FnZV91dGlscyc7XG5pbXBvcnQgeyBwcm9jZXNzRWRpdEJsb2NrcyB9IGZyb20gJy4vdXBkYXRlJztcbmltcG9ydCB7IGVzY2FwZUVyYURhdGEsIGV4dHJhY3RCbG9ja3MsIExvZ2dlciwgcGFyc2VFZGl0TG9nLCBwYXJzZUpzb25sLCB1cGRhdGVFcmFNZXRhRGF0YSB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCd2YXJpYWJsZV9jaGFuZ2VfcHJvY2Vzc29yJyk7XG5cbi8qKlxuICogKirjgJDmoLjlv4Plrp7njrDjgJEqKiDlr7nmjIflrprnmoTmtojmga/lupTnlKjlj5jph4/kv67mlLnjgIJcbiAqIOi/meaYr+WPmOmHj+WGmeWFpea1geeoi+eahOaguOW/g++8jOWkhOeQhuWNleS4qua2iOaBr+OAglxuICpcbiAqIEBwYXJhbSB7VGF2ZXJuTWVzc2FnZX0gbXNnIC0g6KaB5aSE55CG55qE6YWS6aaG5raI5oGv5a+56LGh44CCXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmcgfCBudWxsPn0g5aaC5p6c5oiQ5Yqf5aSE55CG77yM6L+U5Zue6K+l5raI5oGv55qEIE1L77yb5aaC5p6c5raI5oGv5peg6ZyA5aSE55CG5oiW5aSE55CG5aSx6LSl77yM6L+U5ZueIG51bGzjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZSA9IGFzeW5jIChtc2c6IGFueSk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4gPT4ge1xuICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDlvIDlp4vlpITnkIbmtojmga8uLi5gLCB7IG1zZyB9KTtcbiAgdHJ5IHtcbiAgICBpZiAoIW1zZyB8fCB0eXBlb2YgbXNnLm1lc3NhZ2VfaWQgIT09ICdudW1iZXInKSB7XG4gICAgICBsb2dnZXIud2FybignQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgJ+aXoOaViOa2iOaBr+WvueixoeaIlue8uuWwkSBtZXNzYWdlX2lk77yM6YCA5Ye6Jyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlSWQgPSBtc2cubWVzc2FnZV9pZDtcbiAgICAvLyDlhpnlhaXlh73mlbDlj6rotJ/otKPor7vlj5YgTUvvvIzkuI3otJ/otKPliJvlu7rjgILliJvlu7rnmoTogYzotKPnlLHkuIrmuLjnmoQgYGVuc3VyZU1lc3NhZ2VLZXlgIOaJv+aLheOAglxuICAgIGNvbnN0IE1LID0gcmVhZE1lc3NhZ2VLZXkobXNnKTtcblxuICAgIC8vIOWmguaenOa2iOaBr+ayoeaciSBNS++8iOWPr+iDveaYr+S4gOS4quW8guW4uOeKtuaAge+8jOWmguaWsOa2iOaBr+i/mOacquiiq+azqOWFpSBNS++8ie+8jOWImei3s+i/h+OAglxuICAgIGlmICghTUspIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5LiN5ZCrIE1L77yM6Lez6L+H5Y+Y6YeP5YaZ5YWl44CCYCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDmoLnmja7orr7orqHvvIznlKjmiLfmtojmga/oh6rouqvkuI3lupTljIXlkKvlj5jph4/kv67mlLnmjIfku6TvvIzlm6DmraTot7Pov4flj5jph4/lpITnkIbvvIzkvYbov5Tlm57lhbblt7LmnInnmoQgTUvjgIJcbiAgICBpZiAoaXNVc2VyTWVzc2FnZShtc2cpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDmtojmga8gKElEOiAke21lc3NhZ2VJZH0pIOS4uueUqOaIt+a2iOaBr++8jOi3s+i/h+WPmOmHj+WGmeWFpe+8jOS9huS/neeVmeWFtiBNS+OAgmApO1xuICAgICAgcmV0dXJuIE1LO1xuICAgIH1cblxuICAgIGNvbnN0IHJhd0NvbnRlbnQgPSBnZXRNZXNzYWdlQ29udGVudChtc2cpIHx8ICcnO1xuXG4gICAgLy8gMS4g5LuO5raI5oGv5YaF5a655Lit6Kej5p6Q5Ye65omA5pyJ5oyH5Luk5Z2X44CCXG4gICAgY29uc3QgaW5zZXJ0QmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVJbnNlcnQnKTtcbiAgICBjb25zdCBlZGl0QmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVFZGl0Jyk7XG4gICAgY29uc3QgZGVsZXRlQmxvY2tzID0gZXh0cmFjdEJsb2NrcyhyYXdDb250ZW50LCAnVmFyaWFibGVEZWxldGUnKTtcblxuICAgIGlmICghaW5zZXJ0QmxvY2tzLmxlbmd0aCAmJiAhZWRpdEJsb2Nrcy5sZW5ndGggJiYgIWRlbGV0ZUJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOa2iOaBryAoSUQ6ICR7bWVzc2FnZUlkfSkg5pyq5qOA5rWL5Yiw5Y+Y6YeP5L+u5pS55qCH562+44CCYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmF3SW5zZXJ0cyA9IGluc2VydEJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzLCBsb2dnZXIpKTtcbiAgICBjb25zdCByYXdFZGl0cyA9IGVkaXRCbG9ja3MuZmxhdE1hcChzID0+IHBhcnNlSnNvbmwocywgbG9nZ2VyKSk7XG4gICAgY29uc3QgcmF3RGVsZXRlcyA9IGRlbGV0ZUJsb2Nrcy5mbGF0TWFwKHMgPT4gcGFyc2VKc29ubChzLCBsb2dnZXIpKTtcblxuICAgIC8vIOWcqOi/memHjOWvueS7jua2iOaBr+S4reino+aekOWHuueahOWOn+Wni+aVsOaNrui/m+ihjOi9rOS5ie+8jOehruS/neaJgOacieWQjue7reWkhOeQhumDveS9v+eUqOi9rOS5ieWQjueahOaVsOaNruOAglxuICAgIGNvbnN0IGFsbEluc2VydHMgPSBlc2NhcGVFcmFEYXRhKHJhd0luc2VydHMpO1xuICAgIGNvbnN0IGFsbEVkaXRzID0gZXNjYXBlRXJhRGF0YShyYXdFZGl0cyk7XG4gICAgY29uc3QgYWxsRGVsZXRlcyA9IGVzY2FwZUVyYURhdGEocmF3RGVsZXRlcyk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsICfmlbDmja7ovazkuYnlrozmiJAnLCB7XG4gICAgICBiZWZvcmU6IHsgaW5zZXJ0czogcmF3SW5zZXJ0cywgZWRpdHM6IHJhd0VkaXRzLCBkZWxldGVzOiByYXdEZWxldGVzIH0sXG4gICAgICBhZnRlcjogeyBpbnNlcnRzOiBhbGxJbnNlcnRzLCBlZGl0czogYWxsRWRpdHMsIGRlbGV0ZXM6IGFsbERlbGV0ZXMgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGVkaXRMb2c6IGFueVtdID0gW107IC8vIOeUqOS6juaUtumbhuacrOi9ruaTjeS9nOS6p+eUn+eahOaJgOacieWPmOabtOiusOW9leOAglxuXG4gICAgLy8gMi4gLS0tIOWkhOeQhuaJgOacieaPkuWFpeaTjeS9nCAoYDxWYXJpYWJsZUluc2VydD5gKSAtLS1cbiAgICBhd2FpdCBwcm9jZXNzSW5zZXJ0QmxvY2tzKGFsbEluc2VydHMsIGVkaXRMb2cpO1xuXG4gICAgLy8gMy4gLS0tIOWkhOeQhuaJgOaciee8lui+keaTjeS9nCAoYDxWYXJpYWJsZUVkaXQ+YCkgLS0tXG4gICAgYXdhaXQgcHJvY2Vzc0VkaXRCbG9ja3MoYWxsRWRpdHMsIGVkaXRMb2csIG1lc3NhZ2VJZCk7XG5cbiAgICAvLyA0LiAtLS0g5aSE55CG5omA5pyJ5Yig6Zmk5pON5L2cIChgPFZhcmlhYmxlRGVsZXRlPmApIC0tLVxuICAgIGF3YWl0IHByb2Nlc3NEZWxldGVCbG9ja3MoYWxsRGVsZXRlcywgZWRpdExvZyk7XG5cbiAgICAvLyA1LiAtLS0g6KaG55uW5byP5YaZ5YWlIEVkaXRMb2cgLS0tXG4gICAgLypcbiAgICAgKiDmoLjlv4PpgLvovpHvvJrml6DorrrmnKzova7mmK/lkKbkuqfnlJ/kuobmnInmlYjnmoTlj5jph4/kv67mlLnvvIzpg73lv4XpobvnlKjlvZPliY3nmoQgZWRpdExvZyAo5ZOq5oCV5piv56m65pWw57uEKSDopobnm5bml6fnmoQgRWRpdExvZ+OAglxuICAgICAqXG4gICAgICog5Li65LuA5LmI5b+F6aG76KaG55uW6ICM5LiN5piv5Zyo5rKh5pyJ5L+u5pS55pe26Lez6L+H77yfXG4gICAgICpcbiAgICAgKiDmoLnmnKzljp/lm6DlnKjkuo7vvIzlv4Xpobvnoa7kv53mr4/kuKogTUsg5a+55bqU55qEIEVkaXRMb2fvvIzkuKXmoLzkuJTllK/kuIDlnLDlj43mmKDlhbbmiYDlsZ7mtojmga8qKuW9k+WJjeWGheWuuSoq5omA5Lqn55Sf55qE5Y+Y6YeP5L+u5pS544CCXG4gICAgICpcbiAgICAgKiDogIPomZHkuIDkuKrlnLrmma/vvJpcbiAgICAgKiAxLiDmtojmga9BIChNS19BKSDnmoTlhoXlrrnljIXlkKvmjIfku6TvvIznlJ/miJDkuoYgRWRpdExvZ19B44CCXG4gICAgICogMi4g55So5oi35a+55raI5oGvQei/m+ihjCBzd2lwZe+8jOeUn+aIkOS6hua2iOaBr0IgKE1LX0Ip77yM5YW25YaF5a655a6M5YWo5rKh5pyJ5Y+Y6YeP5L+u5pS55qCH562+44CCXG4gICAgICpcbiAgICAgKiDlpoLmnpzlnKjlpITnkIbmtojmga9C5pe277yM5Zug5Li65rKh5pyJ5qOA5rWL5Yiw5oyH5Luk5bCx4oCc6Lez6L+H5YaZ5YWl4oCd77yM6YKj5LmI5LiOIE1LX0Ig5YWz6IGU55qEIEVkaXRMb2cg5bCx5Lya5piv56m655qE5oiW5LiN5a2Y5Zyo55qE44CCXG4gICAgICog6L+Z5Zyo5b2T5YmN5piv5q2j56Gu55qE44CCXG4gICAgICpcbiAgICAgKiDkvYblpoLmnpznlKjmiLflho3mrKEgc3dpcGXvvIzku47mtojmga9C5YiH5o2i5Zue5raI5oGvQeOAguatpOaXtuahhuaetuS8mumHjeaWsOWkhOeQhua2iOaBr0HjgIJcbiAgICAgKiDlpoLmnpzmiJHku6zkuI3miafooYzopobnm5blvI/lhpnlhaXvvIzpgqPkuYjkuI4gTUtfQSDlhbPogZTnmoQgRWRpdExvZyDku43nhLbmmK/kuYvliY3nlJ/miJDnmoQgRWRpdExvZ19B77yM6L+Z5rKh5pyJ6Zeu6aKY44CCXG4gICAgICpcbiAgICAgKiDnnJ/mraPnmoTpl67popjlnKjkuo7nirbmgIHnmoTmmI7noa7mgKfjgILopobnm5blvI/lhpnlhaXnoa7kv53kuobku7vkvZXkuIDkuKogTUsg55qE5pel5b+X77yM5Zyo5Lu75L2V5pe26Ze054K577yMXG4gICAgICog6YO95piv5YW2KirlvZPliY3lj6/op4HlhoXlrrkqKueahOebtOaOpeS6p+eJqe+8jOayoeacieS7u+S9leWOhuWPsumBl+eVmeOAgui/meS9v+W+l+aVtOS4quezu+e7n+eahOeKtuaAgeWPmOi/geWPmOW+l+a4heaZsOOAgeWPr+mihOa1i++8jFxuICAgICAqIOaegeWkp+WcsOmZjeS9juS6huWcqOWkjeadguaTjeS9nO+8iOWmguWkmuasoSBgc3dpcGVg44CB5Yig6Zmk44CB57yW6L6R77yJ5Lit5Ye6546w54q25oCB5LiN5LiA6Ie055qE6aOO6Zmp44CCXG4gICAgICpcbiAgICAgKiDlm6DmraTvvIzmraPnoa7nmoTlgZrms5XmmK/vvJrnlKjmnKzmrKHop6PmnpDmtojmga/lhoXlrrnnlJ/miJDnmoQgZWRpdExvZyAo5Zyo5peg5oyH5Luk55qE5Zy65pmv5LiL5pivIGBbXWApIOWOu+imhueblu+8jFxuICAgICAqIOS7juiAjOaWqeaWreS7u+S9leWPr+iDveWtmOWcqOeahOWOhuWPsuWFs+iBlO+8jOehruS/neaVsOaNrueahOS4gOiHtOaAp+WSjOe6r+eyueaAp+OAglxuICAgICAqL1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB1cGRhdGVFcmFNZXRhRGF0YShtZXRhID0+IHtcbiAgICAgICAgY29uc3QgbmV3QXJyID0gQXJyYXkuaXNBcnJheShlZGl0TG9nKSA/IGVkaXRMb2cgOiBwYXJzZUVkaXRMb2coZWRpdExvZyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJyxcbiAgICAgICAgICBg5YeG5aSH5Li6IE1LPSR7TUt9IChNc2dJRD0ke21lc3NhZ2VJZH0pIOWGmeWFpSBFZGl0TG9nOlxcbiR7SlNPTi5zdHJpbmdpZnkobmV3QXJyLCBudWxsLCAyKX1gLFxuICAgICAgICApO1xuICAgICAgICAvLyDlsIbmnKzova7nlJ/miJDnmoTml6Xlv5fmlbDnu4TvvIzku6XlvZPliY3mtojmga/nmoQgTUsg5Li66ZSu77yM5a2Y5YWlIGBFZGl0TG9nc2Ag5a+56LGh44CCXG4gICAgICAgIF8uc2V0KG1ldGEsIFtMT0dTX1BBVEgsIE1LXSwgSlNPTi5zdHJpbmdpZnkobmV3QXJyKSk7XG4gICAgICAgIC8qXG4gICAgICAgICAqIE4uQi4g5q2k5Ye95pWw5LiN5YaN6LSf6LSj5pu05pawIFNlbGVjdGVkTWtzIOaVsOe7hOOAglxuICAgICAgICAgKiDmm7TmlrAgU2VsZWN0ZWRNa3Mg55qE6IGM6LSj5bey56e75Lqk6Iez5LiK5bGC6LCD55So6ICFIChyZXN5bmNTdGF0ZU9uSGlzdG9yeUNoYW5nZSDmiJYgQXBwbHlWYXJDaGFuZ2Up77yMXG4gICAgICAgICAqIOS7pemBv+WFjeWcqCByZXN5bmMg5b6q546v5Lit5oSP5aSW5L+u5pS55q2j5Zyo6KKr6K+75Y+W55qEIG9sZFNlbGVjdGVkTWtzIOeKtuaAgeOAglxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIG1ldGE7XG4gICAgICB9KTtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwbHlWYXJDaGFuZ2VGb3JNZXNzYWdlJywgYOaIkOWKn+S4uiBNSz0ke01LfSDlhpnlhaUgRWRpdExvZ+OAgmApO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBcHBseVZhckNoYW5nZUZvck1lc3NhZ2UnLCBg5Li6IE1LPSR7TUt9IOWGmeWFpSBFZGl0TG9ncyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICAgIH1cblxuICAgIHJldHVybiBNSztcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZScsIGDlj5jph4/lhpnlhaXlmajlvILluLg6ICR7ZXJyPy5tZXNzYWdlIHx8IGVycn1gLCBlcnIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG4vKipcbiAqICoq44CQ5qCH5YeG5LqL5Lu25aSE55CG5YWl5Y+j44CRKipcbiAqIOi/meaYr+S4gOS4quS4iuWxguWwgeijhe+8jOeUqOS6juWkhOeQhuacgOaWsCBBSSDmtojmga/nmoTlj5jph4/lhpnlhaXvvIzlubbotJ/otKPmm7TmlrAgYFNlbGVjdGVkTWtzYCDmlbDnu4TjgIJcbiAqIOWug+S8muiHquWKqOWvu+aJvuacgOWQjuS4gOadoSBBSSDmtojmga/ov5vooYzmk43kvZzvvIzpgJrluLjooqvnu5HlrprliLDigJzmlrDmtojmga/nlJ/miJDigJ3nrYnkuovku7bkuIrjgIJcbiAqL1xuZXhwb3J0IGNvbnN0IEFwcGx5VmFyQ2hhbmdlID0gYXN5bmMgKCkgPT4ge1xuICBsb2dnZXIuZGVidWcoJ0FwcGx5VmFyQ2hhbmdlJywgYOWHveaVsOiiq+iwg+eUqC4uLmApO1xuICAvLyAxLiDmmbrog73mn6Xmib7mnIDlkI7kuIDmnaEgQUkg5raI5oGvXG4gIGNvbnN0IG1zZyA9IGZpbmRMYXN0QWlNZXNzYWdlKCk7XG4gIGlmICghbXNnIHx8IHR5cGVvZiBtc2cubWVzc2FnZV9pZCAhPT0gJ251bWJlcicpIHtcbiAgICBsb2dnZXIubG9nKCdBcHBseVZhckNoYW5nZScsICfmnKrmib7liLDlj6/lpITnkIbnmoQgQUkg5raI5oGv77yM6YCA5Ye644CCJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZUlkID0gbXNnLm1lc3NhZ2VfaWQ7XG4gIGxvZ2dlci5sb2coJ0FwcGx5VmFyQ2hhbmdlJywgYOaJvuWIsOebruaghyBBSSDmtojmga8gKElEOiAke21lc3NhZ2VJZH0p77yM5byA5aeL5aSE55CG5Y+Y6YeP5YaZ5YWlLi4uYCk7XG5cbiAgLy8gMi4g6LCD55So5qC45b+D5a6e546w5p2l5aSE55CG5Y+Y6YeP5ZKMIEVkaXRMb2cg55qE5YaZ5YWl44CCXG4gIC8vIEVkaXRMb2cg5Lya6KKr6Ieq5Yqo5YWz6IGU5Yiw5LuO6K+l5raI5oGv5Lit6K+75Y+W5Yiw55qEIE1LIOS4iuOAglxuICBjb25zdCBNSyA9IGF3YWl0IEFwcGx5VmFyQ2hhbmdlRm9yTWVzc2FnZShtc2cpO1xuXG4gIC8vIDMuIOWcqOaguOW/g+a1geeoi+aJp+ihjOWujOavleWQju+8jOWcqOatpOWkhOe7n+S4gOabtOaWsCBTZWxlY3RlZE1rc++8jOehruS/neeKtuaAgeS4gOiHtOOAglxuICB0cnkge1xuICAgIGF3YWl0IHVwZGF0ZUVyYU1ldGFEYXRhKG1ldGEgPT4ge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRNa3MgPSBfLmdldChtZXRhLCBTRUxfUEFUSCwgW10pO1xuICAgICAgLy8g5YWz6ZSu77ya5b+F6aG75L2/55So5oiR5Lus5q2j5Zyo5aSE55CG55qEIEFJIOa2iOaBr+eahCBtZXNzYWdlSWQg5L2c5Li657Si5byV77yMXG4gICAgICAvLyDmnaXmm7TmlrAgU2VsZWN0ZWRNa3Mg5pWw57uE5Lit5a+55bqU55qEIE1LIOiusOW9leOAglxuICAgICAgc2VsZWN0ZWRNa3NbbWVzc2FnZUlkXSA9IE1LO1xuICAgICAgXy5zZXQobWV0YSwgU0VMX1BBVEgsIHNlbGVjdGVkTWtzKTtcbiAgICAgIHJldHVybiBtZXRhO1xuICAgIH0pO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0FwcGx5VmFyQ2hhbmdlJywgYOabtOaWsCBTZWxlY3RlZE1rcyDlpLHotKU6ICR7ZT8ubWVzc2FnZSB8fCBlfWAsIGUpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ERA变量框架/variable_change_processor.ts\n\n}");
  },
  lodash: 
  /*!********************!*\
  !*** external "_" ***!
  \********************/ module => {
    module.exports = _;
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/ERA变量框架/index.ts");