{"version":3,"file":"index.js","mappings":"+MAGA,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,0ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,+6BACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,uEAAuE,MAAQ,GAAG,SAAW,uaAAua,eAAiB,CAAC,4hEAAmjE,WAAa,MAEpnF,S,SCFAD,EAAOG,QAAU,SAAUI,GACzB,IAAIC,EAAO,GA4EX,OAzEAA,EAAKC,SAAW,WACd,OAAOC,KAAKC,IAAI,SAAUC,GACxB,IAAIf,EAAU,GACVgB,OAA+B,IAAZD,EAAK,GAoB5B,OAnBIA,EAAK,KACPf,GAAW,cAAciB,OAAOF,EAAK,GAAI,QAEvCA,EAAK,KACPf,GAAW,UAAUiB,OAAOF,EAAK,GAAI,OAEnCC,IACFhB,GAAW,SAASiB,OAAOF,EAAK,GAAGG,OAAS,EAAI,IAAID,OAAOF,EAAK,IAAM,GAAI,OAE5Ef,GAAWU,EAAuBK,GAC9BC,IACFhB,GAAW,KAETe,EAAK,KACPf,GAAW,KAETe,EAAK,KACPf,GAAW,KAENA,CACT,GAAGmB,KAAK,GACV,EAGAR,EAAKS,EAAI,SAAWC,EAASC,EAAOC,EAAQC,EAAUC,GAC7B,iBAAZJ,IACTA,EAAU,CAAC,CAAC,KAAMA,OAASK,KAE7B,IAAIC,EAAyB,CAAC,EAC9B,GAAIJ,EACF,IAAK,IAAIK,EAAI,EAAGA,EAAIf,KAAKK,OAAQU,IAAK,CACpC,IAAIxB,EAAKS,KAAKe,GAAG,GACP,MAANxB,IACFuB,EAAuBvB,IAAM,EAEjC,CAEF,IAAK,IAAIyB,EAAK,EAAGA,EAAKR,EAAQH,OAAQW,IAAM,CAC1C,IAAId,EAAO,GAAGE,OAAOI,EAAQQ,IACzBN,GAAUI,EAAuBZ,EAAK,WAGrB,IAAVU,SACc,IAAZV,EAAK,KAGdA,EAAK,GAAK,SAASE,OAAOF,EAAK,GAAGG,OAAS,EAAI,IAAID,OAAOF,EAAK,IAAM,GAAI,MAAME,OAAOF,EAAK,GAAI,MAF/FA,EAAK,GAAKU,GAMVH,IACGP,EAAK,IAGRA,EAAK,GAAK,UAAUE,OAAOF,EAAK,GAAI,MAAME,OAAOF,EAAK,GAAI,KAC1DA,EAAK,GAAKO,GAHVP,EAAK,GAAKO,GAMVE,IACGT,EAAK,IAGRA,EAAK,GAAK,cAAcE,OAAOF,EAAK,GAAI,OAAOE,OAAOF,EAAK,GAAI,KAC/DA,EAAK,GAAKS,GAHVT,EAAK,GAAK,GAAGE,OAAOO,IAMxBb,EAAKF,KAAKM,GACZ,CACF,EACOJ,CACT,C,2ECjFIH,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,o+BACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,wDAAwD,MAAQ,GAAG,SAAW,yZAAyZ,eAAiB,CAAC,ogEAA++D,WAAa,MAEnhF,S,2ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,mlCACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,4DAA4D,MAAQ,GAAG,SAAW,8aAA8a,eAAiB,CAAC,w0JAAqyJ,WAAa,MAEl2K,S,2ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,ovDACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,sDAAsD,MAAQ,GAAG,SAAW,2tBAA2tB,eAAiB,CAAC,qwHAAwwH,WAAa,MAE5mJ,S,gBCLA,IAAIJ,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,4ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,g9BACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,sCAAsC,MAAQ,GAAG,SAAW,ibAAib,eAAiB,CAAC,s1JAA6yJ,WAAa,MAEv1K,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,qqEACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,4EAA4E,MAAQ,GAAG,SAAW,s2BAAs2B,eAAiB,CAAC,kqRAAyjR,WAAa,MAE9jT,S,gBCLA,IAAIJ,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,IACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,4ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,s5KACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,6DAA6D,MAAQ,GAAG,SAAW,iuDAAiuD,eAAiB,CAAC,+pgBAA4pgB,WAAa,MAE7gkB,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,8JACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,sCAAsC,MAAQ,GAAG,SAAW,qGAAqG,eAAiB,CAAC,s1JAA6yJ,WAAa,MAE3gK,S,gBCJe,SAAS0B,EAAcC,EAAUpB,GAG9C,IAFA,IAAIqB,EAAS,GACTC,EAAY,CAAC,EACRb,EAAI,EAAGA,EAAIT,EAAKO,OAAQE,IAAK,CACpC,IAAIL,EAAOJ,EAAKS,GACZhB,EAAKW,EAAK,GAIVmB,EAAO,CACT9B,GAAI2B,EAAW,IAAMX,EACrBe,IALQpB,EAAK,GAMbO,MALUP,EAAK,GAMfqB,UALcrB,EAAK,IAOhBkB,EAAU7B,GAGb6B,EAAU7B,GAAIiC,MAAM5B,KAAKyB,GAFzBF,EAAOvB,KAAKwB,EAAU7B,GAAM,CAAEA,GAAIA,EAAIiC,MAAO,CAACH,IAIlD,CACA,OAAOF,CACT,C,iBClBA,IAAIM,EAAkC,oBAAbC,SAEzB,GAAqB,oBAAVC,OAAyBA,QAC7BF,EACH,MAAM,IAAIG,MACV,6JAkBJ,IAAIC,EAAc,CAMhB,EAEEC,EAAOL,IAAgBC,SAASI,MAAQJ,SAASK,qBAAqB,QAAQ,IAC9EC,EAAmB,KACnBC,EAAmB,EACnBC,GAAe,EACfC,EAAO,WAAa,EACpBC,EAAU,KACVC,EAAW,kBAIXC,EAA+B,oBAAdC,WAA6B,eAAeC,KAAKD,UAAUE,UAAUC,eAE3E,SAASC,EAAiBzB,EAAUpB,EAAM8C,EAAeC,GACtEX,EAAeU,EAEfR,EAAUS,GAAY,CAAC,EAEvB,IAAI1B,EAASF,EAAaC,EAAUpB,GAGpC,OAFAgD,EAAe3B,GAER,SAAiB4B,GAEtB,IADA,IAAIC,EAAY,GACPzC,EAAI,EAAGA,EAAIY,EAAOd,OAAQE,IAAK,CACtC,IAAIL,EAAOiB,EAAOZ,IACd0C,EAAWpB,EAAY3B,EAAKX,KACvB2D,OACTF,EAAUpD,KAAKqD,EACjB,CACIF,EAEFD,EADA3B,EAASF,EAAaC,EAAU6B,IAGhC5B,EAAS,GAEX,IAASZ,EAAI,EAAGA,EAAIyC,EAAU3C,OAAQE,IAAK,CACzC,IAAI0C,EACJ,GAAsB,KADlBA,EAAWD,EAAUzC,IACZ2C,KAAY,CACvB,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAASzB,MAAMnB,OAAQ8C,IACzCF,EAASzB,MAAM2B,YAEVtB,EAAYoB,EAAS1D,GAC9B,CACF,CACF,CACF,CAEA,SAASuD,EAAgB3B,GACvB,IAAK,IAAIZ,EAAI,EAAGA,EAAIY,EAAOd,OAAQE,IAAK,CACtC,IAAIL,EAAOiB,EAAOZ,GACd0C,EAAWpB,EAAY3B,EAAKX,IAChC,GAAI0D,EAAU,CACZA,EAASC,OACT,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAASzB,MAAMnB,OAAQ8C,IACzCF,EAASzB,MAAM2B,GAAGjD,EAAKsB,MAAM2B,IAE/B,KAAOA,EAAIjD,EAAKsB,MAAMnB,OAAQ8C,IAC5BF,EAASzB,MAAM5B,KAAKwD,EAASlD,EAAKsB,MAAM2B,KAEtCF,EAASzB,MAAMnB,OAASH,EAAKsB,MAAMnB,SACrC4C,EAASzB,MAAMnB,OAASH,EAAKsB,MAAMnB,OAEvC,KAAO,CACL,IAAImB,EAAQ,GACZ,IAAS2B,EAAI,EAAGA,EAAIjD,EAAKsB,MAAMnB,OAAQ8C,IACrC3B,EAAM5B,KAAKwD,EAASlD,EAAKsB,MAAM2B,KAEjCtB,EAAY3B,EAAKX,IAAM,CAAEA,GAAIW,EAAKX,GAAI2D,KAAM,EAAG1B,MAAOA,EACxD,CACF,CACF,CAEA,SAAS6B,IACP,IAAIC,EAAe5B,SAAS6B,cAAc,SAG1C,OAFAD,EAAaE,KAAO,WACpB1B,EAAK2B,YAAYH,GACVA,CACT,CAEA,SAASF,EAAUM,GACjB,IAAIC,EAAQC,EACRN,EAAe5B,SAASmC,cAAc,SAAWxB,EAAW,MAAQqB,EAAInE,GAAK,MAEjF,GAAI+D,EAAc,CAChB,GAAIpB,EAGF,OAAOC,EAOPmB,EAAaQ,WAAWC,YAAYT,EAExC,CAEA,GAAIhB,EAAS,CAEX,IAAI0B,EAAa/B,IACjBqB,EAAetB,IAAqBA,EAAmBqB,KACvDM,EAASM,EAAoBC,KAAK,KAAMZ,EAAcU,GAAY,GAClEJ,EAASK,EAAoBC,KAAK,KAAMZ,EAAcU,GAAY,EACpE,MAEEV,EAAeD,IACfM,EAASQ,EAAWD,KAAK,KAAMZ,GAC/BM,EAAS,WACPN,EAAaQ,WAAWC,YAAYT,EACtC,EAKF,OAFAK,EAAOD,GAEA,SAAsBU,GAC3B,GAAIA,EAAQ,CACV,GAAIA,EAAO9C,MAAQoC,EAAIpC,KACnB8C,EAAO3D,QAAUiD,EAAIjD,OACrB2D,EAAO7C,YAAcmC,EAAInC,UAC3B,OAEFoC,EAAOD,EAAMU,EACf,MACER,GAEJ,CACF,CAEA,IACMS,EADFC,GACED,EAAY,GAET,SAAUE,EAAOC,GAEtB,OADAH,EAAUE,GAASC,EACZH,EAAUI,OAAOC,SAASpE,KAAK,KACxC,GAGF,SAAS2D,EAAqBX,EAAciB,EAAOX,EAAQF,GACzD,IAAIpC,EAAMsC,EAAS,GAAKF,EAAIpC,IAE5B,GAAIgC,EAAaqB,WACfrB,EAAaqB,WAAWC,QAAUN,EAAYC,EAAOjD,OAChD,CACL,IAAIuD,EAAUnD,SAASoD,eAAexD,GAClCyD,EAAazB,EAAayB,WAC1BA,EAAWR,IAAQjB,EAAaS,YAAYgB,EAAWR,IACvDQ,EAAW1E,OACbiD,EAAa0B,aAAaH,EAASE,EAAWR,IAE9CjB,EAAaG,YAAYoB,EAE7B,CACF,CAEA,SAASV,EAAYb,EAAcI,GACjC,IAAIpC,EAAMoC,EAAIpC,IACVb,EAAQiD,EAAIjD,MACZc,EAAYmC,EAAInC,UAiBpB,GAfId,GACF6C,EAAa2B,aAAa,QAASxE,GAEjC2B,EAAQ8C,OACV5B,EAAa2B,aAAa5C,EAAUqB,EAAInE,IAGtCgC,IAGFD,GAAO,mBAAqBC,EAAU4D,QAAQ,GAAK,MAEnD7D,GAAO,uDAAyD8D,KAAKC,SAASC,mBAAmBC,KAAKC,UAAUjE,MAAgB,OAG9H+B,EAAaqB,WACfrB,EAAaqB,WAAWC,QAAUtD,MAC7B,CACL,KAAOgC,EAAamC,YAClBnC,EAAaS,YAAYT,EAAamC,YAExCnC,EAAaG,YAAY/B,SAASoD,eAAexD,GACnD,CACF,C,cCzNA7B,EAAQ,EAAU,CAACiG,EAAKC,KACpB,MAAMC,EAASF,EAAIG,WAAaH,EAChC,IAAK,MAAOI,EAAKC,KAAQJ,EACrBC,EAAOE,GAAOC,EAElB,OAAOH,E,gBCNX,IAAIzG,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,GACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,4ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,kgCACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,wEAAwE,MAAQ,GAAG,SAAW,yaAAya,eAAiB,CAAC,85EAA83E,WAAa,MAEl8F,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,+YACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,8EAA8E,MAAQ,GAAG,SAAW,6KAA6K,eAAiB,CAAC,61CAAk3C,WAAa,MAEhsD,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,s8BACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,qDAAqD,MAAQ,GAAG,SAAW,wVAAwV,eAAiB,CAAC,6sFAAwqF,WAAa,MAExoG,S,gBCLA,IAAIJ,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,4ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,w6IACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,+EAA+E,MAAQ,GAAG,SAAW,qqDAAqqD,eAAiB,CAAC,o7cAAusc,WAAa,MAE9ggB,S,gBCLA,IAAIJ,EAAU,EAAQ,IACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,UCPtDG,EAAOG,QAAU,SAAUS,GACzB,IAAIf,EAAUe,EAAK,GACf8F,EAAa9F,EAAK,GACtB,IAAK8F,EACH,OAAO7G,EAET,GAAoB,mBAATiG,KAAqB,CAC9B,IAAIa,EAASb,KAAKC,SAASC,mBAAmBC,KAAKC,UAAUQ,MACzDE,EAAO,+DAA+D9F,OAAO6F,GAC7EE,EAAgB,OAAO/F,OAAO8F,EAAM,OACxC,MAAO,CAAC/G,GAASiB,OAAO,CAAC+F,IAAgB7F,KAAK,KAChD,CACA,MAAO,CAACnB,GAASmB,KAAK,KACxB,C,4ECZIX,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,4gDACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,oDAAoD,MAAQ,GAAG,SAAW,+lBAA+lB,eAAiB,CAAC,4iNAA27M,WAAa,MAEjqO,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,+tRACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,0DAA0D,MAAQ,GAAG,SAAW,0rFAA0rF,eAAiB,CAAC,s4WAAm4W,WAAa,MAE1sc,S,gBCLA,IAAIJ,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,gBCNtD,IAAIA,EAAU,EAAQ,IACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,GAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,UACO,WAAYP,GAAS,EAAO,CAAC,OAAQ,G,4ECNlDQ,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,ySACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,uDAAuD,MAAQ,GAAG,SAAW,2KAA2K,eAAiB,CAAC,gzBAA+yB,WAAa,MAEpmC,S,4ECLII,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACN,EAAOC,GAAI,+gJACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,0DAA0D,MAAQ,GAAG,SAAW,4uCAA4uC,eAAiB,CAAC,kzOAAqyO,WAAa,MAE9pR,S,GCPI6G,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBzF,IAAjB0F,EACH,OAAOA,EAAa9G,QAGrB,IAAIH,EAAS8G,EAAyBE,GAAY,CACjD/G,GAAI+G,EAEJ7G,QAAS,CAAC,GAOX,OAHA+G,EAAoBF,GAAUhH,EAAQA,EAAOG,QAAS4G,GAG/C/G,EAAOG,OACf,CCrBA4G,EAAoBI,EAAKnH,IACxB,IAAIoH,EAASpH,GAAUA,EAAOF,WAC7B,IAAOE,EAAiB,QACxB,IAAM,EAEP,OADA+G,EAAoBM,EAAED,EAAQ,CAAEE,EAAGF,IAC5BA,GCLRL,EAAoBM,EAAI,CAAClH,EAASoH,KACjC,IAAI,IAAIf,KAAOe,EACXR,EAAoBS,EAAED,EAAYf,KAASO,EAAoBS,EAAErH,EAASqG,IAC5EiB,OAAOC,eAAevH,EAASqG,EAAK,CAAEmB,YAAY,EAAMC,IAAKL,EAAWf,MCJ3EO,EAAoBS,EAAI,CAACpD,EAAKyD,IAAUJ,OAAOK,UAAUC,eAAeC,KAAK5D,EAAKyD,GCClFd,EAAoBkB,EAAK9H,IACH,oBAAX+H,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAevH,EAAS+H,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAevH,EAAS,aAAc,CAAEiI,OAAO,KCLvD,MAAM,EAA+BC,ECuCxBC,EAAiB,EAAAD,EAAEE,OAAO,CACrC,cAAe,EAAAF,EAAEG,UAAUzI,SAAQ,GACnC,MAAO,EAAAsI,EAAEI,SAAS1I,QAAQ,4BAC1B,MAAO,EAAAsI,EAAEG,UAAUzI,SAAQ,GAC3B,OAAQ,EAAAsI,EAAEG,UAAUzI,SAAQ,GAC5B,OAAQ,EAAAsI,EAAEG,UAAUzI,SAAQ,GAC5B,QAAS,EAAAsI,EAAEK,SAAS3I,QAAQ,GAC5B,MAAO,EAAAsI,EAAEG,UAAUzI,SAAQ,KAgBhB4I,EAAa,CAAEzE,KAAM,QAMrB0E,EAAiB,cAMjBC,EAAiB,YAgBjBC,EAAY,WAcZC,EAAW,cAQXC,EAAe,WAQfC,EAAiB,IAAIC,OAAO,IAAIF,gBAA2BA,MAQ3DG,EAAiB,CAC5BC,iBAAkB,qBAClBC,iBAAkB,qBAClBC,eAAgB,mBAChBC,eAAgB,mBAChBC,iBAAkB,qBAClBC,eAAgB,mBAEhBC,iBAAkB,qBAElBC,mBAAoB,sBAEpBC,0BAA2B,6BAE3BC,oBAAqB,uBAErBC,2BAA4B,8BAE5BC,mBAAoB,wBAOTC,EAEC,gBAFDA,EAIA,eAJAA,EAMQ,kBCnJfC,EAAsB,mBAE5B,IAAIC,EAA4B,GAC5BC,EAA6B,GAWjC,SAASC,IACP,IACE,MAAMC,EAAYC,WAAWC,cAAcC,QAAQP,IAAwB,+BAErEQ,EAASxE,KAAKyE,MAAML,GAEpBM,EAAWC,GAAc,IAAI1B,OAAO,IAAI0B,EAAEC,QAAQ,MAAO,WAC/DX,GAAmBO,EAAOK,SAAW,IAAInK,IAAIgK,GAC7CR,GAAoBM,EAAOM,UAAY,IAAIpK,IAAIgK,EACjD,CAAE,MAAOK,GACPC,QAAQC,MAAM,uBAAwBF,GACtCd,EAAkB,GAClBC,EAAmB,EACrB,CACF,CAgCA,SAASgB,EAAaC,GACpB,MAAMC,EAAe,CACnBP,QAAS,IAAI,IAAIQ,IAAIF,EAAUN,UAC/BC,SAAU,IAAI,IAAIO,IAAIF,EAAUL,YAElCT,WAAWC,cAAcgB,QAAQtB,EAAqBhE,KAAKC,UAAUmF,IACrEjB,IACAa,QAAQO,IAAI,sBAAuB,qCAAsC,CACvE,eAAgBH,EAAaP,QAC7B,gBAAiBO,EAAaN,UAElC,CAMA,GAHAX,IAG0B,oBAAfE,WAA4B,CACrC,MAAMmB,EAAW,CASf,GAAArL,CAAIsL,GACF,MAAMrB,EAAYC,WAAWC,cAAcC,QAAQP,IAAwB,+BACrEQ,EAAoDxE,KAAKyE,MAAML,GAC/DS,EAAU,IAAIQ,IAAIb,EAAOK,SAAW,IACpCC,EAAW,IAAIO,IAAIb,EAAOM,UAAY,IAE5CD,EAAQ1K,IAAIsL,GACZX,EAASY,OAAOD,GAEhBP,EAAa,CAAEL,QAASc,MAAMC,KAAKf,GAAUC,SAAUa,MAAMC,KAAKd,IACpE,EAUA,MAAAzG,CAAOoH,GACL,MAAMrB,EAAYC,WAAWC,cAAcC,QAAQP,IAAwB,+BACrEQ,EAAoDxE,KAAKyE,MAAML,GAC/DS,EAAU,IAAIQ,IAAIb,EAAOK,SAAW,IACpCC,EAAW,IAAIO,IAAIb,EAAOM,UAAY,IAE5CA,EAAS3K,IAAIsL,GACbZ,EAAQa,OAAOD,GAEfP,EAAa,CAAEL,QAASc,MAAMC,KAAKf,GAAUC,SAAUa,MAAMC,KAAKd,IACpE,EAKA,MAAAe,GACE,MAAMzB,EAAYC,WAAWC,cAAcC,QAAQP,IAAwB,+BACrEQ,EAASxE,KAAKyE,MAAML,GAC1BY,QAAQO,IAAI,qBAAsB,qCAAsCf,EAC1E,EAKA,KAAAsB,GACEZ,EAAa,CAAEL,QAAS,GAAIC,SAAU,IACxC,GAGDT,WAAmBmB,SAAWA,CACjC,CAcO,MAAMO,EAAa,CACxBC,GAAI,IAGC,MAAMC,EACHC,WAMR,WAAAC,CAAYD,GAEVzL,KAAKyL,WAAaA,GAAczL,KAAK2L,2BAA6B,SACpE,CAEQ,uBAAAA,GACN,IACE,MAEMC,IAFQ,IAAIhK,OAAQiK,OAAS,IAGhCC,MAAM,MACNC,KACCC,IACGA,EAAKC,SAAS,kBACbD,EAAKC,SAAS,mBACdD,EAAKC,SAAS,qBACdD,EAAKC,SAAS,wBACfD,EAAKC,SAAS,kBAGrB,IAAKL,EACH,OAAO,KAIT,MAAMM,EAAQN,EAAWM,MAAM,IAAI1D,OAAO,4CAE1C,IAAK0D,IAAUA,EAAM,GACnB,OAAO,KAMT,OAHaA,EAAM,GAIhB/B,QAAQ,MAAO,KACfA,QAAQ,iBAAkB,IAC1BA,QAAQ,WAAY,GACzB,CAAE,MAAOG,GAEP,OADAC,QAAQC,MAAM,iCAAkCF,GACzC,IACT,CACF,CAEQ,aAAA6B,CAAcC,EAAkBC,GAEtC,MAAO,QADUf,EAAWC,GAAK,IAAID,EAAWC,MAAQ,MAC7BvL,KAAKyL,eAAeW,KAAYE,OAAOD,IACpE,CAEA,KAAAE,CAAMH,EAAkBC,EAAc3I,GACpC,KAjLoB+H,EAiLAzL,KAAKyL,aA7KvBhC,EAAiB+C,KAAKC,GAAMA,EAAGjK,KAAKiJ,KAKT,IAA3BjC,EAAgBnJ,SAKhBmJ,EAAgBgD,KAAKC,GAAMA,EAAGjK,KAAKiJ,IAoKnC,OAlLN,IAAwBA,EAqLpB,MAAMiB,EAAmB1M,KAAKmM,cAAcC,EAAUC,QAC1CxL,IAAR6C,EACF6G,QAAQgC,MAAMG,EAAkBhJ,GAEhC6G,QAAQgC,MAAMG,EAElB,CAEA,GAAA5B,CAAIsB,EAAkBC,EAAc3I,GAClC,MAAMgJ,EAAmB1M,KAAKmM,cAAcC,EAAUC,QAC1CxL,IAAR6C,EACF6G,QAAQO,IAAI,KAAK4B,IAAoB,kBAAmBhJ,GAExD6G,QAAQO,IAAI,KAAK4B,IAAoB,kBAEzC,CAEA,IAAAC,CAAKP,EAAkBC,EAAc3I,GACnC,MAAMgJ,EAAmB1M,KAAKmM,cAAcC,EAAUC,QAC1CxL,IAAR6C,EACF6G,QAAQoC,KAAK,KAAKD,IAAoB,kBAAmBhJ,GAEzD6G,QAAQoC,KAAK,KAAKD,IAAoB,kBAE1C,CAEA,KAAAlC,CAAM4B,EAAkBC,EAAcO,GACpC,MAAMF,EAAmB1M,KAAKmM,cAAcC,EAAUC,QACrCxL,IAAb+L,EACFrC,QAAQC,MAAM,KAAKkC,IAAoB,qCAAsCE,GAE7ErC,QAAQC,MAAM,KAAKkC,IAAoB,qCAE3C,EChQF,MAAMG,EAAS,IAAIrB,EAAO,yBAKbsB,EAAe,CAC1BC,KAAM,CAACC,cAAcC,WACrBC,KAAM,CACJ,eACA5D,EACA0D,cAAcG,iBACdH,cAAcI,gBACdJ,cAAcK,eACdL,cAAcM,aACd,cACA,mBAEA,cAEFC,IAAKxG,OAAOyG,OAAO/E,GAEnBgF,eAAgB,CAACT,cAAcU,cAE/BC,oBAAqB,CAACX,cAAcY,oBAEpCC,eAAgB,CAACb,cAAcc,kBAiBpBC,EAAsB,IAAIC,IAAmD,CACxF,CAAChB,cAAcK,eAAgB,CAAEY,KAAMjB,cAAcY,mBAAoBM,YAAa,QAiB3EC,EAAkB,IAAIH,IAAuE,CACxG,CACEhB,cAAcc,gBACd,CAAEG,KAAMjB,cAAcY,mBAAoBQ,WAAY,aAAcF,YAAa,SAkBxEG,EAAqB,IAAIL,IAAoB,CACxD,CAAChB,cAAcK,eAAgB,KAC/B,CAACL,cAAcc,gBAAiB,QAkB3B,SAASQ,EAAcC,GAE5B,OAAKzB,EAAaC,KAAkBd,SAASsC,GAAmB,OAC3DzB,EAAaI,KAAkBjB,SAASsC,GAAmB,OAC3DzB,EAAaS,IAAiBtB,SAASsC,GAAmB,MAC1DzB,EAAaW,eAA4BxB,SAASsC,GAAmB,iBACrEzB,EAAaa,oBAAiC1B,SAASsC,GAAmB,sBAC1EzB,EAAae,eAA4B5B,SAASsC,GAAmB,iBACnE,SACT,CAQO,SAASC,EAAgBC,GAC9B,MAAMC,EAAiBC,EAAEC,UAAUH,GAC7BI,EAAwB,GAG9B,IAAK,MAAMC,KAAcL,EAAgB,CAEvC,GAAyB,IAArBI,EAAUxO,OAAc,CAC1BwO,EAAUjP,KAAKkP,GACf,QACF,CAEA,MAAMC,EAAUF,EAAUA,EAAUxO,OAAS,GACvC2O,EAAiBF,EAAWG,UAAYF,EAAQE,UAGhDC,EAAYf,EAAgBjH,IAAI6H,EAAQvL,MAC9C,GAAI0L,GAAaJ,EAAWtL,OAAS0L,EAAUjB,KAAM,CACnD,GAAIe,GAAkBE,EAAUhB,YAAa,CAC3CrB,EAAON,MACL,kBACA,YAAYwC,EAAQvL,UAAUsL,EAAWtL,cAAcwL,UAAuBE,EAAUhB,uBAAuBgB,EAAUd,kBAE3HS,EAAUM,MACVN,EAAUjP,KAAK,CAAE4D,KAAM0L,EAAUd,WAAYa,UAAWH,EAAWG,UAAWG,OAAQN,EAAWM,SACjG,QACF,CACEvC,EAAON,MACL,kBACA,uBAAuBwC,EAAQvL,UAAUsL,EAAWtL,cAAcwL,SAAsBE,EAAUhB,kBAGxG,CAGA,MAAMmB,EAAgBtB,EAAoB7G,IAAI6H,EAAQvL,MACtD,GAAI6L,GAAiBP,EAAWtL,OAAS6L,EAAcpB,KAAM,CAC3D,GAAIe,GAAkBK,EAAcnB,YAAa,CAC/CrB,EAAON,MACL,kBACA,cAAcwC,EAAQvL,UAAUsL,EAAWtL,cAAcwL,UAAuBK,EAAcnB,4BAEhGW,EAAUM,MACV,QACF,CACEtC,EAAON,MACL,kBACA,uBAAuBwC,EAAQvL,UAAUsL,EAAWtL,cAAcwL,SAAsBK,EAAcnB,kBAG5G,CAGA,MAAMoB,EAAYhB,EAAcS,EAAQvL,MAIjB8L,IAHFhB,EAAcQ,EAAWtL,OAIP,SAAd8L,EAKvBT,EAAUA,EAAUxO,OAAS,GAAKyO,EAGlCD,EAAUjP,KAAKkP,EAEnB,CAEA,MAAMS,EAAeV,EAAUpK,OAAO+K,IACpC,MAAMC,EAAQnB,EAAckB,EAAIhM,MAC1BkM,EAA+B,wBAAVD,EACrBE,EAAmC,mBAAVF,EAI/B,OAHIC,GAAsBC,IACxB9C,EAAON,MAAM,kBAAmB,aAAaiD,EAAIhM,SAE3CkM,IAAuBC,IASjC,OALA9C,EAAON,MAAM,kBAAmB,SAASmC,EAAerO,aAAakP,EAAalP,SAAU,CAC1FuP,OAAQlB,EAAezO,IAAKqK,GAAgBA,EAAE9G,MAC9CqM,MAAON,EAAatP,IAAKqK,GAAgBA,EAAE9G,QAGtC+L,CACT,CClNA,MAAM,EAA+BZ,E,aCiB9B,SAASmB,EAAiBpM,GAE/B,IAAK,aAAWA,GACd,OAAOA,EAIT,MAAMU,EAAS,cAAYV,GAqB3B,OAnBA,SAASqM,EAAQC,GACf,GAAI9E,MAAM+E,QAAQD,GAEhBA,EAAQE,QAAQhQ,GAAQ6P,EAAQ7P,SAC3B,GAAI,kBAAgB8P,GAEzB,IAAK,MAAMlK,KAAOkK,EAEZlK,EAAIqK,WAAW,YACVH,EAAQlK,GAGfiK,EAAQC,EAAQlK,GAIxB,CAEAiK,CAAQ3L,GACDA,CACT,CAMO,SAASgM,IACd,MAAMC,EAAWC,aAAarI,IAAe,CAAC,EAG9C,MAAO,CAAEsI,KAFI,QAAMF,EAAUnI,EAAgB,CAAC,GAE/BsI,KADF,QAAMH,EAAUlI,EAAgB,CAAC,GAEhD,CAmBOsI,eAAeC,EAAkBC,SAChCC,oBAAoBH,MAAMI,IAC9B,MAAMC,EAAc,QAAMD,EAAG3I,EAAgB,CAAC,GACxC6I,QAAgBJ,EAAQG,GAE9B,OADA,QAAMD,EAAG3I,EAAgB6I,GAClBF,GACN5I,EACL,CAMO,SAAS+I,IACd,MAAMC,EAAcX,aAAa,CAAE9M,KAAM,SAAU0N,UAAWC,gBAC9D,OAAOvJ,EAAeoC,MAAMiH,GAAe,CAAC,EAC9C,CAOOR,eAAeW,EACpBT,SAIMC,oBACJH,MAAMQ,IACJ,MAAMI,EAAkBzJ,EAAeoC,MAAMiH,GAAe,CAAC,GAE7D,aAD0BN,EAAQU,IAGpC,CAAE7N,KAAM,SAAU0N,UAAWC,eAEjC,CCxGA,MAAM,EAAS,IAAI3F,EAAO,sBAEpB8F,EAAwC,CAC5C,IAAK,UACL,IAAK,aACL,KAAK,cAGDC,EAA0C5C,EAAE6C,OAAOF,GAEnDG,EAAc,IAAIjJ,OAAOzB,OAAO2K,KAAKJ,GAAYrR,IAAI0O,EAAEgD,cAAcrR,KAAK,KAAM,KAChFsR,EAAgB,IAAIpJ,OAAOzB,OAAOyG,OAAO8D,GAAYrR,IAAI0O,EAAEgD,cAAcrR,KAAK,KAAM,KAOnF,SAASuR,EAAiB3L,GAC/B,GAAIgF,MAAM+E,QAAQ/J,GAChB,OAAOA,EAAKjG,IAAIC,GAAQ2R,EAAc3R,IAExC,GAAIyO,EAAEmD,cAAc5L,GAAO,CACzB,MAAM9B,EAAiC,CAAC,EACxC,IAAK,MAAM0B,KAAOI,EAChB,GAAIa,OAAOK,UAAUC,eAAeC,KAAKpB,EAAMJ,GAAM,CAEnD1B,EADmB0B,EAAIqE,QAAQsH,EAAavF,GAASoF,EAAWpF,KAC3C2F,EAAe3L,EAAaJ,GACnD,CAEF,OAAO1B,CACT,CACA,MAAoB,iBAAT8B,EACFA,EAAKiE,QAAQsH,EAAavF,GAASoF,EAAWpF,IAEhDhG,CACT,CAOO,SAAS6L,EAAmB7L,GACjC,GAAIgF,MAAM+E,QAAQ/J,GAChB,OAAOA,EAAKjG,IAAIC,GAAQ6R,EAAgB7R,IAE1C,GAAIyO,EAAEmD,cAAc5L,GAAO,CACzB,MAAM9B,EAAiC,CAAC,EACxC,IAAK,MAAM0B,KAAOI,EAChB,GAAIa,OAAOK,UAAUC,eAAeC,KAAKpB,EAAMJ,GAAM,CAEnD1B,EADqB0B,EAAIqE,QAAQyH,EAAe1F,GAASqF,EAAarF,KAC/C6F,EAAiB7L,EAAaJ,GACvD,CAEF,OAAO1B,CACT,CACA,MAAoB,iBAAT8B,EACFA,EAAKiE,QAAQyH,EAAe1F,GAASqF,EAAarF,IAEpDhG,CACT,CAgBO,SAAS8L,EAAenB,GAC7B,GAAI3F,MAAM+E,QAAQY,GAEhB,OAAOA,EAAE5Q,IAAIqK,GAAMY,MAAM+E,QAAQ3F,IAAMqE,EAAEmD,cAAcxH,GAAK/E,KAAKC,UAAU8E,GAAKA,GAC3E,GAAIqE,EAAEmD,cAAcjB,GAAI,CAE7B,MAAM/J,EAA4B,CAAC,EACnC,IAAK,MAAM/F,KAAK8P,EAAG/J,EAAE/F,GAAKiR,EAAenB,EAAE9P,IAC3C,OAAO+F,CACT,CAEE,OAAO+J,CAEX,CAwBO,SAASoB,EAAkBC,EAAWC,GAE3C,OAAOxD,EAAEyD,UAAUzD,EAAEC,UAAUsD,GAAOvD,EAAEC,UAAUuD,GAAQ,CAACvL,EAAQyL,KAEjE,GAAInH,MAAM+E,QAAQrJ,IAAMsE,MAAM+E,QAAQoC,GAAI,OAAOA,GAIrD,CAQO,SAAS,EAAaC,GAC3B,GAAIpH,MAAM+E,QAAQqC,GAAM,OAAOA,EAC/B,GAAIA,GAAsB,iBAARA,EAAkB,MAAO,CAACA,GAC5C,GAAmB,iBAARA,EAAkB,CAC3B,MAAMC,EAAID,EAAInI,QAAQ,kCAAmC,IACzD,IACE,MAAMqI,EAAMjN,KAAKyE,MAAMuI,GACvB,OAAOrH,MAAM+E,QAAQuC,GAAOA,EAAM,EACpC,CAAE,MACA,MAAO,EACT,CACF,CACA,MAAO,EACT,CA0FO,SAASC,GAAWC,GACzB,MAAMC,EAAiB,GACvB,IAAKD,GAAsB,iBAARA,EACjB,OAAOC,EAMT,MAAMC,EAjFR,SAAuBF,GACrB,IAAKA,EAAK,MAAO,GAEjB,IAAIG,EAAS,GACTC,GAAW,EAEf,IAAK,IAAIvS,EAAI,EAAGA,EAAImS,EAAIrS,OAAQE,IAAK,CACnC,MAAMwS,EAAOL,EAAInS,GAQjB,GALa,MAATwS,GAAuB,IAANxS,GAA0B,OAAfmS,EAAInS,EAAI,KACtCuS,GAAYA,GAIVA,EAAU,CACZD,GAAUE,EACV,QACF,CAGA,MAAMC,EAAWN,EAAInS,EAAI,GAGzB,GAAa,MAATwS,GAA6B,MAAbC,EAAkB,CACpC,MAAMC,EAAYP,EAAIQ,QAAQ,KAAM3S,EAAI,GACxC,IAAmB,IAAf0S,EAEF,MAGFJ,GAAU,KACVtS,EAAI0S,EACJ,QACF,CAGA,GAAa,MAATF,GAA6B,MAAbC,EAAkB,CACpC,MAAMG,EAAeT,EAAIQ,QAAQ,KAAM3S,EAAI,GAC3C,IAAsB,IAAlB4S,EAEF,MAGF5S,EAAI4S,EAAe,EACnB,QACF,CAGA,GAAa,MAATJ,GAA4C,YAA5BL,EAAIU,UAAU7S,EAAGA,EAAI,GAAe,CACtD,MAAM4S,EAAeT,EAAIQ,QAAQ,SAAO3S,EAAI,GAC5C,IAAsB,IAAlB4S,EAEF,MAEF5S,EAAI4S,EAAe,EACnB,QACF,CAGAN,GAAUE,CACZ,CACA,OAAOF,CACT,CAkB6BQ,CAAcX,GACnCY,EAAaV,EAAmBW,OAEtC,IAAIC,EAAa,EACbC,GAAc,EACdX,GAAW,EAEf,IAAK,IAAIvS,EAAI,EAAGA,EAAI+S,EAAWjT,OAAQE,IAAK,CAC1C,MAAMwS,EAAOO,EAAW/S,GAQxB,GALa,MAATwS,GAAuB,IAANxS,GAAiC,OAAtB+S,EAAW/S,EAAI,KAC7CuS,GAAYA,IAIVA,EAEJ,GAAa,MAATC,EACiB,IAAfS,IAEFC,EAAalT,GAEfiT,SACK,GAAa,MAATT,GACLS,EAAa,IACfA,IACmB,IAAfA,IAAoC,IAAhBC,GAAmB,CAEzC,MAAMC,EAAaJ,EAAWF,UAAUK,EAAYlT,EAAI,GACxD,IACE,MAAMmD,EAAM6B,KAAKyE,MAAM0J,GACvBf,EAAQ/S,KAAK8D,EACf,CAAE,MAAO4G,GAEP,EAAOE,MAAM,eAAeF,GAAG+B,SAAW/B,aAAaoJ,IAAcpJ,EACvE,CAEAmJ,GAAc,CAChB,CAGN,CACA,OAAOd,CACT,CCjRO,SAASgB,GAAepB,GAC7B,IAAKA,EAAG,OAAOA,EACf,IAAIqB,EAAItH,OAAOiG,GAAGgB,OAGlB,OAFAK,EAAIA,EAAEzJ,QAAQ,0CAA2C,IACzDyJ,EAAIA,EAAEzJ,QAAQ,uBAAwB,IAC/ByJ,EAAEL,MACX,CAUO,SAASM,GAAeC,EAAkB,GAAIC,EAAqB,SACxE,GAAa,QAATA,GAA8B,MAAZD,EACpB,MAAO,0BAGT,MAAME,EAAiBF,EAAQ3J,QAAQ,sBAAuB,QAE9D,OAAQ4J,GACN,IAAK,QACH,OAAO,IAAIvL,OAAO,IAAIwL,MACxB,IAAK,SACH,OAAO,IAAIxL,OAAO,IAAIwL,mBACxB,IAAK,SACH,OAAO,IAAIxL,OAAO,iBAAiBwL,MAErC,QACE,OAAO,IAAIxL,OAAO,iBAAiBwL,mBAEzC,CASA,SAASC,GACPC,EACAC,EACAC,EAAmBF,EAAK7T,QAExB,MAAMgU,EAAgB,IAAI7L,OAAO,KAAK2L,EAAaG,UAAW,KAC9D,IACIC,EADAC,EAAY,KAIhB,KAAqD,QAA7CD,EAAeF,EAAcI,KAAKP,KACpCK,EAAahQ,MAAQ6P,GACvBI,EAAYD,EAMhB,IAAKC,EACH,OAAO,KAGT,MAAME,EAAUF,EAAU,GACpBG,EAAaH,EAAUjQ,MAGvBqQ,EAAU,IAAIF,KACdG,EAAYX,EAAKY,YAAYF,EAASD,GAE5C,OAAmB,IAAfE,EAEKZ,GAAsBC,EAAMC,EAAcQ,GAG5C,CACLlB,WAAYoB,EACZT,SAAUO,EAAa,KAAKD,KAAWrU,OACvClB,QAAS+U,EAAKd,UAAUyB,EAAYD,EAAQvU,OAAQsU,GACpDD,QAASA,EAEb,CA0BO,SAASK,GAAgBb,EAAcC,GAE5C,OADcA,EAAe,IAAI3L,OAAO,MAAM2L,EAAaG,WAAa,oCAC3D9R,KAAK0R,EACpB,CAiCO,SAASc,GAAmBd,EAAce,EAA4BC,GAAwB,GAEnG,MACMC,EAzDD,SAA2BjB,EAAcC,GAC9C,IAAIgB,EAAgBjB,EACpB,OAAa,CACX,MAAMkB,EAAQnB,GAAsBkB,EAAehB,GACnD,IAAKiB,EACH,MAEFD,EAAgBA,EAAcE,MAAM,EAAGD,EAAM3B,YAAc0B,EAAcE,MAAMD,EAAMhB,SACvF,CACA,OAAOe,CACT,CA+CwBG,CAAkBpB,EADrBL,GAAe,QAAS,aAIrC0B,EA/BD,SAA8BrB,EAAcC,GACjD,MAAMqB,EAAmB,GACzB,IAAIC,EAAcvB,EAAK7T,OAEvB,KAAOoV,EAAc,GAAG,CACtB,MAAML,EAAQnB,GAAsBC,EAAMC,EAAcsB,GACxD,IAAKL,EACH,MAEFI,EAAOE,QAAQN,EAAMjW,SACrBsW,EAAcL,EAAM3B,UACtB,CAEA,OAAO+B,CACT,CAiBoBG,CAAqBR,EAAeF,GAEhDW,EAAwB,GAC9B,IAAK,MAAMC,KAASN,EAAW,CAE7B,MAAMO,EAAenC,GAAekC,EAAMtC,QAG1C,IAAIwB,GAAgBe,IAIhBA,EACF,GAAIZ,EAAc,CAChB,MAAMa,EAAkBC,GAAwBF,GAChDF,EAAYhW,KAAKmW,EACnB,MACEH,EAAYhW,KAAKkW,EAGvB,CAEA,OAAOF,CACT,CAOA,MAAMK,GAAY,EAAU,CAAE9K,KAAM,KAAM+K,GAAI,OACvC,SAASF,GAAwB9B,GACtC,OAAO+B,GAAU/B,EACnB,CCvMO,SAASiC,GAAqBjC,GAEnC,IAAKA,EAAKjI,SAAS,MACjB,OAAOiI,EAGT,IAAIrB,EAASqB,EAIb,OAFArB,EAASA,EAAO1I,QAAQ,aAAciM,YAAYC,OAClDxD,EAASA,EAAO1I,QAAQ,aAAciM,YAAYE,OAC3CzD,CACT,CAOO,MCVD/H,GAAM,IAAIU,EAAO,yBAoBhB,SAAS+K,GAAkBC,GAChC,IAAKA,EAAK,OAAO,KAEjB,IAAIrX,EAAyB,KAG7B,GAAuB,iBAAZqX,EAAIC,IACbtX,EAAUqX,EAAIC,SAGX,GAAIvL,MAAM+E,QAAQuG,EAAIE,QAAS,CAClC,MAAMC,EAAMC,OAAOJ,EAAIK,UAAY,GACnC1X,EAAUqX,EAAIE,OAAOC,IAAQ,IAC/B,KAEgC,iBAAhBH,EAAInK,UAClBlN,EAAUqX,EAAInK,SAGhB,OAAgB,OAAZlN,EACK,KAOFgX,GAAqBhX,EAC9B,CA4CO,SAAS2X,GAAcN,GAC5B,MACMtQ,EAvCR,SAAsB6Q,GACpB,GAA8B,iBAAnBA,EACT,OAAO,KAET,MAAM7K,EAAQ6K,EAAe7K,MAAM3D,GACnC,IAAK2D,IAAUA,EAAM,GACnB,OAAO,KAET,IAGE,MAAM8K,EAAoB9K,EAAM,GAC1B+K,EAAWD,EAAkB9K,MAAM,mCACnCgL,EAAYF,EAAkB9K,MAAM,oCAE1C,GAAI+K,IAAW,IAAMC,IAAY,GAAI,CACnC,MAAMC,EAAU,CACd,kBAAmBF,EAAS,GAC5B,mBAAoBC,EAAU,IAGhC,OADApM,GAAIyB,MAAM,eAAgB,eAAgB4K,GACnCA,CACT,CAEA,OADArM,GAAIyB,MAAM,eAAgB,yBAA0B,CAAEyK,sBAC/C,IACT,CAAE,MAAO1M,GAEP,OADAQ,GAAI6B,KAAK,eAAgB,oBAAqBrC,GACvC,IACT,CACF,CAUe8M,CADGb,GAAkBC,IAElC,OAAItQ,EACkC,SAA7BA,EAAK,oBAGO,SAAdsQ,GAAKa,IACd,CAMO,SAASC,KACd,MAAMC,EAAWC,gBAAgB,sBAAuB,CAAEC,gBAAgB,IAC1E,IAAKF,GAAgC,IAApBA,EAASlX,OAExB,OADAyK,GAAIyB,MAAM,oBAAqB,oBACxB,KAGT,IAAK,IAAIhM,EAAIgX,EAASlX,OAAS,EAAGE,GAAK,EAAGA,IAAK,CAC7C,MAAMiW,EAAMe,EAAShX,GACrB,IAAKuW,GAAcN,GAEjB,OADA1L,GAAIyB,MAAM,oBAAqB,qBAAqBiK,EAAIkB,cACjDlB,CAEX,CAGA,OADA1L,GAAIyB,MAAM,oBAAqB,sBACxB,IACT,CA0DOkE,eAAekH,GACpBtL,EACAuL,EACAC,EAAuC,QAEvC,MAAMC,EAAavB,GAAkBlK,GACrCvB,GAAIyB,MAAM,uBAAwB,YAAauL,GAC/ChN,GAAIyB,MAAM,uBAAwB,YAAaqL,GAE/C,MAAMG,EAA6E,CACjFL,WAAYrL,EAAQqL,YAGtB,GAAIxM,MAAM+E,QAAQ5D,EAAQqK,QAAS,CACjC,MAAMC,EAAMC,OAAOvK,EAAQwK,UAAY,GACjCmB,EAAY,IAAI3L,EAAQqK,QAC9BsB,EAAUrB,GAAOiB,EACjBG,EAAcrB,OAASsB,CACzB,MACED,EAAc1L,QAAUuL,QAGpBK,gBAAgB,CAACF,GAAgB,CAAEF,WAC3C,CCvLA,MAAM,GAAS,IAAIrM,EAAO,uBAyDnB,SAAS0M,GAAe1B,GAC7B,IAAKA,EAAK,MAAO,GAGjB,MAAMrX,EAAUoX,GAAkBC,GAMlC,OAhDF,SAAsBO,GACpB,GAA8B,iBAAnBA,EACT,OAAO,KAET,MAAM7K,EAAQ6K,EAAe7K,MAAM3D,GACnC,IAAK2D,IAAUA,EAAM,GACnB,OAAO,KAET,IAGE,MAAM8K,EAAoB9K,EAAM,GAC1B+K,EAAWD,EAAkB9K,MAAM,mCACnCgL,EAAYF,EAAkB9K,MAAM,oCAE1C,OAAI+K,IAAW,IAAMC,IAAY,GACxB,CACL,kBAAmBD,EAAS,GAC5B,mBAAoBC,EAAU,IAG3B,IACT,CAAE,MACA,OAAO,IACT,CACF,CAmBa,CAAa/X,KAAW,oBAAsB,EAuC3D,CAUOsR,eAAe0H,GAAiB3B,GACrC,IAAKA,GAAiC,iBAAnBA,EAAIkB,aAA4BlB,EAAIa,KAErD,OADA,GAAO1K,KAAK,mBAAoB,qBAAsB,CAAE6J,QACjD,CAAEjL,GAAI,GAAI6M,OAAO,GAI1B,MAAMC,EAAaH,GAAe1B,GAClC,GAAI6B,EACF,MAAO,CAAE9M,GAAI8M,EAAYD,OAAO,GAIlC,MAAME,EAAQ,UAAUC,KAAKC,SHnJtBC,KAAKC,SAAS3Y,SAAS,IAAIsV,MAAM,EAAG,KGoJrCsD,EAA2B,SAAbnC,EAAIa,KAAkB,OAAS,YAC7CuB,EAAa,IAAItQ,yBAAoCgQ,0BAA8BK,QAAkBrQ,KAE3G,GAAOiE,MAAM,mBAAoB,YAAYiK,EAAIkB,wBAAwBY,KAGzE,MAEMV,GAFiBrB,GAAkBC,IAAQ,IACV,KAAOoC,EAM9C,aAFMjB,GAAqBnB,EAAKoB,GAEzB,CAAErM,GAAI+M,EAAOF,OAAO,EAC7B,CAQO,MAkCMS,GAAyBpI,UACpC,MAAM+F,EAAMgB,iBAAiB,EAAG,CAAEC,gBAAgB,MAAU,GAC5D,IAAKjB,GAAiC,iBAAnBA,EAAIkB,WAAyB,OAGhD,MAAQnM,GAAIuN,SAAaX,GAAiB3B,GACrCsC,SAGCpI,EAAkBH,IACtB,MAAMwI,EAAcpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IAM1C,OAJI0Q,EAAYvC,EAAIkB,cAAgBoB,IAClCC,EAAYvC,EAAIkB,YAAcoB,EAC9BnK,EAAEqK,IAAIzI,EAAMlI,EAAU0Q,IAEjBxI,KCtOL,GAAS,IAAI/E,EAAO,gCAMnBiF,eAAewI,KACpB,GAAOnO,IAAI,6BAA8B,sBACnCsG,EAAqBX,MAAMyI,IAE/B,GAAO3M,MAAM,6BAA8B,QAAS2M,GAC7CA,IAET,GAAOpO,IAAI,6BAA8B,aAC3C,CAGAqO,EAAE,KACAF,OCVF,MAAM,GAAS,IAAIzN,EAAO,6BCM1B,MAAM,GAAS,IAAIA,EAAO,2BAY1B,SAAS4N,GAAc5I,EAAc1F,GACnC,IAAKA,IAAQA,EAAIzK,OAAQ,OAAOmQ,EAEhC,IAAK,IAAIjQ,EAAIuK,EAAIzK,OAAS,EAAGE,GAAK,EAAGA,IAAK,CACxC,MAAM8Y,EAAQvO,EAAIvK,GACZ+Y,EAAKhN,OAAO+M,GAAOC,IAAM,IAAI5W,cAC7B6W,EAAOjN,OAAO+M,GAAOE,MAAQ,IAC9BA,IAEM,WAAPD,EAEF3K,EAAE6K,MAAMhJ,EAAM+I,GACE,WAAPD,GAA0B,WAAPA,SAEG,IAApBD,EAAMI,UACf9K,EAAE6K,MAAMhJ,EAAM+I,GAEd5K,EAAEqK,IAAIxI,EAAM+I,EAAM5K,EAAEC,UAAUyK,EAAMI,aAG1C,CACA,OAAOjJ,CACT,CAQA,SAASkJ,GAAalJ,EAAc1F,GAClC,IAAKA,IAAQA,EAAIzK,OAAQ,OAAOmQ,EAEhC,IAAK,MAAM6I,KAASvO,EAAK,CACvB,IAAKuO,IAAUA,EAAME,KAAM,SAC3B,MAAMD,EAAKhN,OAAO+M,GAAOC,IAAM,IAAI5W,cAExB,WAAP4W,GAA0B,WAAPA,EACrB3K,EAAEqK,IAAIxI,EAAM6I,EAAME,KAAM5K,EAAEC,UAAUyK,EAAMM,YAC1B,WAAPL,GACT3K,EAAE6K,MAAMhJ,EAAM6I,EAAME,KAExB,CACA,OAAO/I,CACT,CA8HO,SAASoJ,GACdC,EACAd,EACAe,GAEA,MAAMC,EAAchB,EAAY7F,QAAQ2G,GAExC,IAAqB,IAAjBE,EAAoB,CACtB,MAAMC,EAAW,gBAAgBH,IAEjC,MADA,GAAOrP,MAAM,kBAAmBwP,EAAU,CAAEH,WAAUd,gBAChD,IAAInX,MAAMoY,EAClB,CAEA,IAAIC,EAAW,CAAC,EAGhB,IAAK,IAAI1Z,EAAI,EAAGA,GAAKwZ,EAAaxZ,IAAK,CACrC,MAAM2Z,EAAYnB,EAAYxY,GAC9B,IAAK2Z,EAAW,SAEhBD,EAAWP,GAAaO,EADZ,EAAaH,EAAQI,IAEnC,CAEA,OAAOD,CACT,CAoEO,SAASE,GACdZ,EACAa,EACArB,EACAe,GAIA,GAFA,IAAQvN,MAAM,qBAAsB,UAAUgN,aAAgBa,iBAE1DA,EAAiB,GAAKA,EAAiBrB,EAAY1Y,OAMrD,OALA,IAAQsM,KAAK,qBAAsB,aAAayN,UAAwB,CACtEb,OACAa,iBACAC,iBAAkBtB,EAAY1Y,SAEzB,KAIT,IAAK,IAAIE,EAAI6Z,EAAiB,EAAG7Z,GAAK,EAAGA,IAAK,CAC5C,MAAMgL,EAAKwN,EAAYxY,GACvB,IAAKgL,EAAI,SAGT,MACM+O,EAAe,EADGR,EAAQvO,IAGhC,GAAK+O,GAAwC,IAAxBA,EAAaja,OAGlC,IAAK,IAAI8C,EAAImX,EAAaja,OAAS,EAAG8C,GAAK,EAAGA,IAAK,CACjD,MAAMoX,EAAWD,EAAanX,GAC9B,GAAKoX,GAAaA,EAAShB,KAA3B,CAGA,GAAIgB,EAAShB,OAASA,EACpB,MAAoB,WAAhBgB,EAASjB,IACX,IAAQ3M,KACN,qBACA,WAAWpB,WAAYgO,0DAElB,OAET,IAAQhN,MACN,qBACA,eAAehB,cAAegO,WAC9BgB,EAASZ,WAEJhL,EAAEC,UAAU2L,EAASZ,YAM9B,GAAIJ,EAAKpJ,WAAWoK,EAAShB,KAAO,KAAM,CACxC,MAAMiB,EAAUjB,EAAKnG,UAAUmH,EAAShB,KAAKlZ,OAAS,GAChDoa,EAAeF,EAASZ,UAC9B,GAAIhL,EAAEmD,cAAc2I,IAAiB9L,EAAE+L,IAAID,EAAcD,GAAU,CACjE,MAAMG,EAAWhM,EAAEzH,IAAIuT,EAAcD,GAMrC,OALA,IAAQjO,MACN,qBACA,eAAehB,cAAegP,EAAShB,oBAAoBiB,UAC3DG,GAEKhM,EAAEC,UAAU+L,EACrB,CACF,CAlCyC,CAmC3C,CACF,CAIA,OADA,IAAQpO,MAAM,qBAAsB,aAAagN,0BAC1C,IACT,CC9VA,MAAM,GAAS,IAAI/N,EAAO,yBASnB,SAASoP,GAAYf,GAC1B,IACE,MAAM,KAAEtJ,GAASH,IACX2I,EAAiCpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IACvDyR,EAAoCnL,EAAEzH,IAAIqJ,EAAMnI,EAAW,CAAC,GAElE,IAAKyR,EAEH,OADA,GAAOrP,MAAM,cAAe,cAAe,CAAEqP,aACtC,KAIT,IAAKd,EAAY9M,SAAS4N,GAKxB,OAJA,GAAOrP,MAAM,cAAe,iBAAiBqP,4BAAoC,CAC/EA,WACAd,gBAEK,KAMT,OAFqBa,GAAgBC,EAAUd,EAAae,EAG9D,CAAE,MAAOtP,GAMP,OALA,GAAOA,MAAM,cAAe,cAAcA,GAAO6B,SAAW7B,IAAS,CACnEA,QACAqP,WACA1C,QAAS/G,MAEJ,IACT,CACF,CASO,SAASyK,GACdC,EACAC,GAEA,IACE,MAAM,KAAExK,GAASH,IACX2I,EAAiCpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IACvDyR,EAAoCnL,EAAEzH,IAAIqJ,EAAMnI,EAAW,CAAC,GAE5D4S,EAAWjC,EAAYtU,OAAQ8G,KAAuBA,GAC5D,GAAwB,IAApByP,EAAS3a,OACX,MAAO,GAIT,GAAIya,IAAYE,EAAS/O,SAAS6O,GAKhC,OAJA,GAAOtQ,MAAM,qBAAsB,gBAAgBsQ,4BAAmC,CACpFA,UACAE,aAEK,KAIT,GAAID,IAAUC,EAAS/O,SAAS8O,GAK9B,OAJA,GAAOvQ,MAAM,qBAAsB,cAAcuQ,4BAAiC,CAChFA,QACAC,aAEK,KAGT,MAAMC,EAAgBH,GAAWE,EAAS,GAGpCE,EDyIH,SACLJ,EACAC,EACAhC,EACAe,GAEA,MAAMrG,EAAasF,EAAY7F,QAAQ4H,GACjC1G,EAAW2E,EAAY7F,QAAQ6H,GAErC,IAAoB,IAAhBtH,IAAmC,IAAdW,GAAmBX,EAAaW,EAMvD,OALA,GAAO5J,MAAM,8BAA+B,uBAAwB,CAClEsQ,UACAC,QACAhC,gBAEK,GAIT,IAAIoC,EAAcvB,GAAgBkB,EAAS/B,EAAae,GACxD,MAAMoB,EAA8D,CAClE,CACE3P,GAAIuP,EACJpD,WAAYjE,EACZjD,KAAM7B,EAAEC,UAAUuM,KAKtB,IAAK,IAAI5a,EAAIkT,EAAa,EAAGlT,GAAK6T,EAAU7T,IAAK,CAC/C,MAAMgL,EAAKwN,EAAYxY,GAClBgL,IAGL4P,EAAczB,GAAayB,EADf,EAAarB,EAAQvO,KAEjC2P,EAAQtb,KAAK,CACX2L,GAAIA,EACJmM,WAAYnX,EACZiQ,KAAM7B,EAAEC,UAAUuM,KAEtB,CAEA,OAAOD,CACT,CCpLoBE,CAA4BH,EAFxBF,GAASC,EAASA,EAAS3a,OAAS,GAEgB0Y,EAAae,GACrF,OAAOoB,CACT,CAAE,MAAO1Q,GAOP,OANA,GAAOA,MAAM,qBAAsB,cAAcA,GAAO6B,SAAW7B,IAAS,CAC1EA,QACAsQ,UACAC,QACA5D,QAAS/G,MAEJ,IACT,CACF,CCrGA,MAAM,GAAS,IAAI5E,EAAO,kCAUb6P,GAAwB1M,EAAE2M,SACrC,KACEC,UAAUjS,GACV,GAAOwB,IAAI,wBAAyB,WAAWxB,UAEjD,GACA,CAAEkS,SAAS,EAAOC,UAAU,IAcvB,SAASC,GAAmBC,GAEjC,MAAM,KAAEnL,EAAI,KAAED,GAASH,IACjBwL,EAAkB9L,EAAiBU,GACzC,GAAOjE,MAAM,qBAAsB,uBAAwB,CAAEiE,OAAMD,OAAMqL,oBAGzE,MAAMC,EAAgC,IACjCF,EACHnL,KAAMuB,EAAgBvB,GACtBoL,gBAAiB7J,EAAgB6J,GACjC7C,YAAapK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IACnCyT,SAAUnN,EAAEzH,IAAIqJ,EAAMnI,EAAW,CAAC,IAGpC,GAAOmE,MAAM,qBAAsB,aAAc,CAC/CwP,aAAcJ,EACdE,YAAaA,IAGfN,UAAUjS,EAA8BuS,GACxC,GAAO/Q,IAAI,qBAAsB,OAAOxB,QAAoCuS,EAC9E,CAUO,SAASG,GAAqBC,EAA4CC,EAAcrJ,GAC7F,MAAM,KAAEtC,GAASH,IACXuL,EAA8B,CAClCM,YACAC,UACArJ,SACAkG,YAAapK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IACnCyT,SAAUnN,EAAEzH,IAAIqJ,EAAMnI,EAAW,CAAC,IAGpCmT,UAAUjS,EAAqCqS,GAC/C,GAAO7Q,IAAI,uBAAwB,SAASmR,SAAiB3S,QAC/D,CCxDA,MAAM,GAAS,IAAIkC,EAAO,uCAC1B,IAAI2Q,GAAgD,KAuGpD1L,eAAe2L,GAAgB5M,GAE7B,MAAM6M,EV1BS,CAACvV,IAChB,IACE,OAAOvB,KAAKC,UAAUsB,EAAG,KAAM,EACjC,CAAE,MAAOwD,GACP,MAAO,kBAAkBA,GAAG+B,SAAW/B,KACzC,GUqBsBgS,CAAE9M,EAAI+M,cACtB1G,EAAQ,MAAMrG,EAAIgN,cAAcH,QAAoB7M,EAAIgN,YAGxDC,QAAsBnF,KAC5B,IAAKmF,EAEH,YADA,GAAO9P,KAAK,kBAAmB,4BAIjC,MACMiL,GADkBrB,GAAkBkG,IAAkB,IACvB5G,EAErC,GAAOtJ,MAAM,kBAAmB,gBAAgBiD,EAAIgN,oBAAoBC,EAAc/E,uBAGhFC,GAAqB8E,EAAe7E,GAG1CyD,IACF,CCpIO,SAASqB,GAAelN,EAAemN,EAA4BhB,GACxE,MAAQnY,KAAM+K,EAAS,OAAEa,GAAWI,ED8J/B,IAAsB+J,EAAc7R,EC7JzCiV,EAAaC,KAAM,EAGfrO,IAAc9F,EAAeC,iBD0IjC0T,GAAgB,CAAEI,SAAU,iBAAkBD,aC1IoBnN,IACzDb,IAAc9F,EAAeE,iBDgJjC,SAAwBzC,GAC7BkW,GAAgB,CAAEI,SAAU,eAAgBD,aAAcrW,GAC5D,CClJ0D2W,CAAezN,GAC9Db,IAAc9F,EAAeG,gBDwJX2Q,ECxJwCnK,EAAOmK,KDwJjC7R,ECxJuC0H,EAAO1H,MD0JvF0U,GAAgB,CAAEI,SAAU,iBAAkBD,aADhC5N,EAAEqK,IAAI,CAAC,EAAGO,EAAM7R,MCxJrB6G,IAAc9F,EAAeI,eDiKjC,SAAsB0Q,EAAc7R,GAEzC0U,GAAgB,CAAEI,SAAU,eAAgBD,aAD9B5N,EAAEqK,IAAI,CAAC,EAAGO,EAAM7R,IAEhC,CCpKwDoV,CAAa1N,EAAOmK,KAAMnK,EAAO1H,OAC9E6G,IAAc9F,EAAeK,iBDyKjC,SAAwB5C,GAC7BkW,GAAgB,CAAEI,SAAU,iBAAkBD,aAAcrW,GAC9D,CC3K0D6W,CAAe3N,GAC9Db,IAAc9F,EAAeM,eDgLjC,SAAsBwQ,GAG3B6C,GAAgB,CAAEI,SAAU,iBAAkBD,aADhC5N,EAAEqK,IAAI,CAAC,EAAGO,EAAM,CAAC,IAEjC,CCpLwDyD,CAAa5N,EAAOmK,MACjEhL,IAAc9F,EAAeO,iBD0LjC,SAA8BoG,GACnC,GAAO7C,MAAM,uBAAwB,aACrC,MAAM,KAAEiE,EAAI,KAAED,GAASH,IACjB2I,EAAiCpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IACvD4U,EAASlE,EAAYA,EAAY1Y,OAAS,IAAM,GAChD6c,EAAgBnE,EAAY1Y,OAAS,EAErC8c,EADW3F,gBAAgB,sBAAuB,CAAEC,gBAAgB,IAC7CyF,GAU7BlB,GAAqB,iBAAkB5M,EARpB,CACjB7D,GAAI0R,EACJvF,WAAYwF,EACZE,UAASD,GAAcrG,GAAcqG,GACrC3M,KAAMuB,EAAgBvB,GACtBoL,gBAAiB7J,EAAgBjC,EAAiBU,KAItD,CC5M0D6M,CAAqBjO,GACpEb,IAAc9F,EAAeQ,mBDkNjC,SAA+BmG,GACpC,MAAM7D,EAAK6D,GAAQ7D,GACnB,IAAKA,EAEH,YADA,GAAOf,MAAM,wBAAyB,iBAIxC,GAAO+B,MAAM,wBAAyB,gBAAgBhB,KACtD,MAAMiF,EAAOoK,GAAYrP,GAEzB,GAAIiF,EAAM,CACR,MAAM,KAAED,GAASH,IAEXsH,EADiC/I,EAAEzH,IAAIqJ,EAAMlI,EAAU,IAC9B6K,QAAQ3H,GAEjCc,EADWmL,gBAAgB,sBAAuB,CAAEC,gBAAgB,IACjDC,GASzBsE,GAAqB,kBAAmB5M,EAPrB,CACjB7D,KACAmM,aACA0F,UAAS/Q,GAAUyK,GAAczK,GACjCmE,KAAMuB,EAAgBvB,GACtBoL,gBAAiB7J,EAAgBjC,EAAiBU,KAGtD,MACE,GAAOhG,MAAM,wBAAyB,cAAce,IAExD,CC9O4D+R,CAAsBlO,GACvEb,IAAc9F,EAAeS,0BDoPjC,SAAsCkG,GAC3C,MAAM,QAAE0L,EAAO,MAAEC,GAAU3L,GAAU,CAAC,EAEtC,GAAO7C,MAAM,+BAAgC,eAAeuO,GAAW,YAAYC,GAAS,QAC5F,MAAMG,EAAUL,GAAmBC,EAASC,GAE5C,GAAIG,EAAS,CACX,MAAM3D,EAAWC,gBAAgB,sBAAuB,CAAEC,gBAAgB,IAW1EuE,GAAqB,yBAA0B5M,EAT1B8L,EAAQjb,IAAIC,IAC/B,MAAMmM,EAAUkL,EAASrX,EAAKwX,YAC9B,MAAO,IACFxX,EACHkd,UAAS/Q,GAAUyK,GAAczK,GACjCmE,KAAMuB,EAAgB7R,EAAKsQ,MAC3BoL,gBAAiB7J,EAAgBjC,EAAiB5P,EAAKsQ,UAI7D,MACE,GAAOhG,MAAM,+BAAgC,YAEjD,CC1QmE+S,CAA6BnO,GACrFb,IAAc9F,EAAeU,oBDgRjC,SAAgCiG,GACrC,MAAMsI,EAAatI,GAAQsI,WAC3B,GAA0B,iBAAfA,EAET,YADA,GAAOlN,MAAM,yBAA0B,+BAIzC,GAAO+B,MAAM,yBAA0B,wBAAwBmL,KAE/D,MAAM,KAAEnH,GAASH,IACX2I,EAAiCpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IAE7D,GAAIqP,EAAa,GAAKA,GAAcqB,EAAY1Y,OAE9C,YADA,GAAOmK,MAAM,yBAA0B,cAAckN,cAAuBqB,EAAY1Y,OAAS,OAInG,MAAMkL,EAAKwN,EAAYrB,GACvB,IAAKnM,EAIH,OAHA,GAAOoB,KAAK,yBAA0B,cAAc+K,uBAEpDsE,GAAqB,mBAAoB5M,EAAQ,MAInD,MAAMoB,EAAOoK,GAAYrP,GAEzB,GAAIiF,EAAM,CACR,MACMnE,EADWmL,gBAAgB,sBAAuB,CAAEC,gBAAgB,IACjDC,GASzBsE,GAAqB,mBAAoB5M,EAPtB,CACjB7D,KACAmM,aACA0F,UAAS/Q,GAAUyK,GAAczK,GACjCmE,KAAMuB,EAAgBvB,GACtBoL,gBAAiB7J,EAAgBjC,EAAiBU,KAGtD,MACE,GAAOhG,MAAM,yBAA0B,cAAce,qBAAsBmM,KAE/E,CC1T6D8F,CAAuBpO,GACzEb,IAAc9F,EAAeW,2BDgUjC,SAAuCgG,GAC5C,MAAM,QAAEqO,EAAO,MAAEC,GAAUtO,GAAU,CAAC,EAEtC,GAAO7C,MACL,gCACA,kBAAkBkR,GAAW,eAAeC,GAAS,QAGvD,MAAM,KAAEnN,GAASH,IACX2I,EAAiCpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IAEvDoL,EAAagK,GAAW,EACxBrJ,EAAWsJ,GAAS3E,EAAY1Y,OAAS,EAE/C,GAAIoT,EAAaW,GAAYX,EAAa,GAAKW,GAAY2E,EAAY1Y,OAKrE,YAJA,GAAOmK,MACL,gCACA,UAAUiJ,MAAeW,kBAAyB2E,EAAY1Y,OAAS,OAM3E,MAAMya,EAAU/B,EAAYtF,GACtBsH,EAAQhC,EAAY3E,GAE1B,IAAK0G,IAAYC,EAEf,YADA,GAAOvQ,MAAM,gCAAiC,8BAIhD,MAAM0Q,EAAUL,GAAmBC,EAASC,GAE5C,GAAIG,EAAS,CACX,MAAM3D,EAAWC,gBAAgB,sBAAuB,CAAEC,gBAAgB,IAU1EuE,GAAqB,0BAA2B5M,EAT3B8L,EAAQjb,IAAIC,IAC/B,MAAMmM,EAAUkL,EAASrX,EAAKwX,YAC9B,MAAO,IACFxX,EACHkd,UAAS/Q,GAAUyK,GAAczK,GACjCmE,KAAMuB,EAAgB7R,EAAKsQ,MAC3BoL,gBAAiB7J,EAAgBjC,EAAiB5P,EAAKsQ,UAI7D,MACE,GAAOhG,MAAM,gCAAiC,YAElD,CChXoEmT,CAA8BvO,GACvFb,IAAc9F,EAAeY,qBDsXtC,GAAOkD,MAAM,yBAA0B,uBACnC4P,IACF,GAAO5P,MAAM,yBAA0B,0BACvCmP,GAAmBS,KAEnB,GAAOxP,KAAK,yBAA0B,yBC1X1C,CDTAiR,QAAQ,gBAAkBjC,IACxBQ,GAAuBR,IEdzB,MAAM,GAAS,IAAInQ,EAAO,4BAW1B,SAASqS,GAAmBC,EAAeC,EAAkBC,EAAeC,GAE1E,MAAMC,EAAoBH,EAAWpP,EAAEzH,IAAI4W,EAAUC,GAAYD,EAEjE,QAA0Bjd,IAAtBqd,EAKF,YAJA,GAAOvR,KAAK,qBAAsB,8BAA8BoR,GAAY,WAAY,CACtFA,WACAC,aAKJ,MAAMG,EAAYxP,EAAEzH,IAAIgX,EAAmB,CAAC,QAAS,cAG/CE,EAAYzP,EAAEzH,IAAI8W,EAAU,SAC5BK,EAEH1P,EAAEmD,cAAcsM,IAAczP,EAAE2P,QAAQF,IAEzCzP,EAAE+L,IAAIsD,EAAU,CAAC,QAAS,cAG5B,GAAIrP,EAAEmD,cAAckM,KAAcrP,EAAE2P,QAAQN,GAAW,CAIrD,GAAkB,QAAdG,IAAwBE,EAM1B,YALA,GAAO1R,KACL,qBACA,yBAAyBoR,sCACzB,CAAEA,WAAUC,WAAUE,sBAM1B,IAAK,MAAMpY,KAAOiB,OAAO2K,KAAKsM,GAAW,CAGvCH,GAAmBC,EAFFC,EAAW,GAAGA,KAAYjY,IAAQA,EAC/BkY,EAASlY,GACuBmY,EACtD,CACA,MACF,CAQA,GAAkB,SAAdE,GAAsC,QAAdA,EAM1B,YALA,GAAOxR,KACL,qBACA,yBAAyBoR,oBAA2BI,iBACpD,CAAEJ,WAAUC,WAAUE,sBAM1B,GAAiB,KAAbH,EAIF,YAHA,GAAOvT,MAAM,qBAAsB,8BAA+B,CAChEwT,aAMJ,MAAMO,EAAS5P,EAAEC,UAAUsP,GAC3BvP,EAAE6K,MAAMsE,EAAUC,GAClBE,EAAQre,KAAK,CAAE0Z,GAAI,SAAUC,KAAMwE,EAAUtE,UAAW8E,IACxD,GAAOhS,MAAM,qBAAsB,WAAWwR,IAChD,CC9FA,MAAM,GAAS,IAAIvS,EAAO,qCAwDnB,SAASgT,GAA4BC,EAAuB3Y,GACjE,IAAK2Y,EAAkB,OAGvB,MAAMC,EAAmB/P,EAAEzH,IAAIuX,EAAkB,aAG3CE,EAAkBhQ,EAAEzH,IAAIuX,EAAkB3Y,GAGhD,GAAI6I,EAAEmD,cAAc4M,IAAqB/P,EAAEmD,cAAc6M,GAAkB,CACzE,GAAOpS,MACL,8BACA,SAASzG,iCAAmCP,KAAKC,UAC/CkZ,oBACiBnZ,KAAKC,UAAUmZ,MAGpC,MAAMC,EAAS3M,EAAkBtD,EAAEC,UAAU8P,GAAmBC,GAEhE,OADA,GAAOpS,MAAM,8BAA+B,YAAYhH,KAAKC,UAAUoZ,MAChEA,CACT,CAAO,OAAIjQ,EAAEmD,cAAc6M,IACzB,GAAOpS,MACL,8BACA,SAASzG,gBAAkBP,KAAKC,UAAUmZ,MAErCA,GACEhQ,EAAEmD,cAAc4M,IACzB,GAAOnS,MACL,8BACA,SAASzG,eAAiBP,KAAKC,UAAUkZ,MAEpCA,QAGT,GAAOnS,MAAM,8BAA+B,kBAAkBzG,iBAEhE,CChFA,MAAM,GAAS,IAAI0F,EAAO,mCAoBnB,SAASqT,GACdf,EACAC,EACAC,EACAC,EACAa,EACAC,GAIA,MAAMC,EDhCD,SAAyBF,EAAuBG,GAErD,MAAMC,EAAcvQ,EAAEzH,IAAI+X,EAAgB,aAE1C,GAAO1S,MACL,kBACA,wBAAwBhH,KAAKC,UAAUsZ,oBAAmCvZ,KAAKC,UAC7E0Z,MAKJ,IAAIC,EAAqB,CAAC,EAM1B,OALAA,EAAgBlN,EAAkBkN,EAAeL,GACjDK,EAAgBlN,EAAkBkN,EAAeD,GAEjD,GAAO3S,MAAM,kBAAmB,eAAehH,KAAKC,UAAU2Z,MAE1DxQ,EAAE2P,QAAQa,GACL,KAGFA,CACT,CCS0BC,CAAgBN,EAAkBC,GAC1D,GAAOxS,MAAM,qBAAsB,mBAAmBwR,GAAY,UAAW,CAC3ED,SAAUnP,EAAEC,UAAUkP,KAIxB,MAAMI,EAAoBH,EAAWpP,EAAEzH,IAAI4W,EAAUC,GAAYD,EASjE,GARA,GAAOvR,MACL,qBACA,oBAAoBwR,GAAY,iCAChCG,GAKEH,QAAkCld,IAAtBqd,EAAiC,CAE/C,MAAMmB,ED4CH,SAA8BC,EAAiBtB,GAMpD,GALA,GAAOzR,MACL,uBACA,cAAchH,KAAKC,UAAU8Z,WAAoB/Z,KAAKC,UAAUwY,OAG7DrP,EAAEmD,cAAckM,GAEnB,OADA,GAAOzR,MAAM,uBAAwB,yBAC9ByR,EAET,IAAKsB,EAEH,OADA,GAAO/S,MAAM,uBAAwB,uBAC9ByR,EAIT,GAAIrP,EAAE2P,QAAQN,GAEZ,OADA,GAAOzR,MAAM,uBAAwB,oBAC9BoC,EAAEC,UAAU0Q,GAIrB,MAAMD,EAAWpN,EAAkBtD,EAAEC,UAAU0Q,GAAatB,GAE5D,OADA,GAAOzR,MAAM,uBAAwB,gBAAgBhH,KAAKC,UAAU6Z,MAC7DA,CACT,CCrEqBE,CAAqBP,EAAiBhB,GAEjDwB,EAAaxN,EAAeqN,GAKlC,OAJA,GAAO9S,MAAM,qBAAsB,aAAawR,OAAcxY,KAAKC,UAAUga,EAAY,KAAM,MAC/F7Q,EAAEqK,IAAI8E,EAAUC,EAAUyB,GAC1BvB,EAAQre,KAAK,CAAE0Z,GAAI,SAAUC,KAAMwE,EAAUpE,UAAWhL,EAAEC,UAAU4Q,UACpE,GAAOjT,MAAM,qBAAsB,cAAcwR,IAEnD,CAIA,GAAIpP,EAAEmD,cAAcoM,IAAsBvP,EAAEmD,cAAckM,GAAW,CACnE,GAAOzR,MACL,qBACA,oBAAoBwR,GAAY,8CACFxY,KAAKC,UAAUwZ,MAE/C,IAAK,MAAMlZ,KAAOiB,OAAO2K,KAAKsM,GAAW,CACvC,MAAMxD,EAAUuD,EAAW,GAAGA,KAAYjY,IAAQA,EAC5C2Z,EAAWzB,EAASlY,GAEpB4Z,EAAsBlB,GAA4BQ,EAAiBlZ,GACzE,GAAOyG,MACL,qBACA,iBAAiBzG,iDACmBP,KAAKC,UAAUka,MAGrDb,GAAmBf,EAAUtD,EAASiF,EAAUxB,EAASyB,EAAqBxB,EAChF,CACF,MAAWH,GAIT,GAAOpR,KAAK,qBAAsB,qCAAqCoR,IAAY,CACjFA,WACAC,WACAE,qBAIN,CCxFA,MAAM,GAAS,IAAI1S,EAAO,4BAqB1BiF,eAAekP,GACb7B,EACAC,EACAC,EACAC,EACA2B,EACA7G,EACAe,GAGA,MAAMoE,EAAoBH,EAAWpP,EAAEzH,IAAI4W,EAAUC,GAAYD,EACjE,QAA0Bjd,IAAtBqd,EAKF,YAJA,GAAOvR,KAAK,mBAAoB,4BAA4BoR,GAAY,WAAY,CAClFA,WACAC,aAOJ,MAAM6B,EAAclR,EAAEzH,IAAIgX,EAAmB,CAAC,QAAS,cAAc,GAG/DG,GACY,IAAhBwB,IAC4C,IAA5ClR,EAAEzH,IAAI8W,EAAU,CAAC,QAAS,cAG5B,IAAoB,IAAhB6B,GAA0BxB,EAW9B,IAAK,MAAMvY,KAAOiB,OAAO2K,KAAKsM,GAAW,CACvC,MAAMxD,EAAUuD,EAAW,GAAGA,KAAYjY,IAAQA,EAC5Cga,EAAS9B,EAASlY,GAIxB,GAAI6I,EAAEmD,cAAcgO,GAAS,OACrBH,GAAiB7B,EAAUtD,EAASsF,EAAQ7B,EAAS2B,EAAW7G,EAAae,GACnF,QACF,CAMA,IAAKnL,EAAE+L,IAAIoD,EAAUtD,GAAU,CAC7B,GAAO7N,KAAK,mBAAoB,gCAAgC6N,IAAW,CACzEA,UACAsF,SACAhC,aAEF,QACF,CAIA,GAAOvR,MAAM,mBAAoB,iBAAiBiO,cAAoBoF,cACtE,IAAIrB,EAASpE,GAAmBK,EAASoF,EAAW7G,EAAae,GAClD,OAAXyE,GAGFA,EAAS5P,EAAEzH,IAAI4W,EAAUtD,GACzB,GAAOjO,MACL,mBACA,yCAAyChH,KAAKC,UAAU+Y,OAG1D,GAAOhS,MAAM,mBAAoB,uBAAuBhH,KAAKC,UAAU+Y,MAGzE,MAAMwB,EAAU/N,EAAe8N,GAK/BnR,EAAEqK,IAAI8E,EAAUtD,EAASuF,GACzB9B,EAAQre,KAAK,CACX0Z,GAAI,SACJC,KAAMiB,EACNf,UAAW9K,EAAEC,UAAU2P,GACvB5E,UAAWhL,EAAEC,UAAUmR,IAE3B,MA9DE,GAAOpT,KACL,mBACA,uBAAuBoR,0CACvB,CAAEA,WAAUC,WAAUE,qBA4D5B,CCpGA,MAAM,GAAS,IAAI1S,EAAO,6BAoBbwU,GAA2BvP,MACtC+F,EACAyJ,EACA1P,EACAxG,EAA6B,CAAC,KAE9B,GAAOwC,MAAM,kCAAmC,eAAeiK,EAAIkB,kBACnE,MAAMnM,EAAK2M,GAAe1B,GAC1B,IAEE,MAAM,WAAE0J,EAAU,SAAEC,EAAQ,WAAEC,GboK3B,SACL5J,EACAtB,GAAwB,GAExB,MAAMmL,EAAa9J,GAAkBC,IAAQ,GAGvC8J,EAAetL,GAAmBqL,EAAYxM,GAAe,iBAAkB,SAAUqB,GACzFqL,EAAavL,GAAmBqL,EAAYxM,GAAe,eAAgB,SAAUqB,GACrFsL,EAAexL,GAAmBqL,EAAYxM,GAAe,iBAAkB,SAAUqB,GAE/FpK,GAAIyB,MAAM,0BAA2B,cAAeiU,GAE/CF,EAAajgB,QAAWkgB,EAAWlgB,QAAWmgB,EAAangB,QAC9DyK,GAAIyB,MAAM,0BAA2B,WAAWiK,EAAIkB,2BAGtD,MAAM+I,EAAaH,EAAaI,QAASnO,GAAcE,GAAWF,IAC5DoO,EAAWJ,EAAWG,QAASnO,GAAcE,GAAWF,IACxDqO,EAAaJ,EAAaE,QAASnO,GAAcE,GAAWF,IAG5D2N,EAAarO,EAAc4O,GAC3BN,EAAWtO,EAAc8O,GACzBP,EAAavO,EAAc+O,GAOjC,OALA9V,GAAIyB,MAAM,0BAA2B,SAAU,CAC7CqD,OAAQ,CAAEiR,QAASJ,EAAYK,MAAOH,EAAUI,QAASH,GACzD/Q,MAAO,CAAEgR,QAASX,EAAYY,MAAOX,EAAUY,QAASX,KAGnD,CAAEF,aAAYC,WAAUC,aACjC,CapMiDY,CAAwBxK,EAAKzM,EAAO,QAKzEkX,UAAWC,EAAiBjD,QAASkD,SFgD1C1Q,eACLyP,EACAD,GAEA,IAAKC,GAAoC,IAAtBA,EAAW7f,OAC5B,MAAO,CAAE4gB,UAAWhB,EAAahC,QAAS,IAG5C,GAAO1R,MAAM,sBAAuB,6CAA8CoC,EAAEC,UAAUqR,IAE9F,MAAM9E,EAAcxM,EAAEC,UAAUqR,GAC1BhC,EAAiB,GAQvB,IAAK,MAAMmD,KAAclB,EACvB,GAAKvR,EAAEmD,cAAcsP,KAAezS,EAAE2P,QAAQ8C,GAC9C,IACE,GAAO7U,MAAM,sBAAuB,kBAAkBhH,KAAKC,UAAU4b,MAErEvC,GAAmB1D,EAAa,GAAIiG,EAAYnD,EAAS,KAAM,KACjE,CAAE,MAAO3T,GACP,GAAOE,MAAM,sBAAuB,qBAAqBF,GAAG+B,SAAW/B,IAAK,CAC1EE,MAAOF,EACP8W,aACAjG,eAEJ,CAIF,OADA,GAAO5O,MAAM,sBAAuB,0BAC7B,CAAE0U,UAAW9F,EAAa8C,UACnC,CEpFqEoD,CAAoBnB,EAAYD,IAGzFgB,UAAWK,EAAerD,QAASsD,SD0ExC9Q,eACL0P,EACAP,EACAK,EACA1P,GAEA,IAAK4P,GAAgC,IAApBA,EAAS9f,OACxB,MAAO,CAAE4gB,UAAWtS,EAAEC,UAAUqR,GAAchC,QAAS,IAIzD,MAAMgD,EAAYtS,EAAEC,UAAUqR,GACxBhC,EAAiB,GAEjBlF,EAAwBpK,EAAEzH,IAAIqJ,EAAMlI,EAAU,IAC9CyR,EAAoCnL,EAAEzH,IAAIqJ,EAAMnI,EAAW,CAAC,GAGlE,IAAK,MAAMoZ,KAAYrB,EACrB,GAAKxR,EAAEmD,cAAc0P,KAAa7S,EAAE2P,QAAQkD,GAC5C,IACE,GAAOjV,MAAM,oBAAqB,gBAAiBiV,SAG7C7B,GAAiBsB,EAAW,GAAIO,EAAUvD,EAAS2B,EAAW7G,EAAae,EACnF,CAAE,MAAOxP,GACP,GAAOE,MAAM,oBAAqB,mBAAmBF,GAAG+B,SAAW/B,IAAK,CACtEE,MAAOF,EACPkX,WACAP,aAEJ,CAIF,OADA,GAAO1U,MAAM,oBAAqB,wBAC3B,CAAE0U,YAAWhD,UACtB,CC9GsEwD,CAChEtB,EACA3J,EAAIkB,WACJwJ,EACA3Q,IAIM0Q,UAAWS,EAAiBzD,QAAS0D,SJ6B1ClR,eACL2P,EACAH,GAEA,IAAKG,GAAoC,IAAtBA,EAAW/f,OAC5B,MAAO,CAAE4gB,UAAWhB,EAAahC,QAAS,IAG5C,MAAM9C,EAAcxM,EAAEC,UAAUqR,GAC1BhC,EAAiB,GAEvB,IAAK,MAAM2D,KAAcxB,EACvB,GAAKzR,EAAEmD,cAAc8P,KAAejT,EAAE2P,QAAQsD,GAC9C,IACE,GAAOrV,MAAM,sBAAuB,kBAAkBhH,KAAKC,UAAUoc,MAErE/D,GAAmB1C,EAAa,GAAIyG,EAAY3D,EAClD,CAAE,MAAO3T,GACP,GAAOE,MAAM,sBAAuB,qBAAqBF,GAAG+B,SAAW/B,IAAK,CAC1EE,MAAOF,EACPsX,aACAzG,eAEJ,CAIF,OADA,GAAO5O,MAAM,sBAAuB,0BAC7B,CAAE0U,UAAW9F,EAAa8C,UACnC,CIzDqE4D,CAAoBzB,EAAYkB,GAMjG,MAAO,CAAEL,UAAWS,EAAiBI,aAHhB,IAAKX,GAAa,MAASI,GAAgB,MAASI,GAAa,IAGnCpW,KACrD,CAAE,MAAOwW,GAQP,OAPA,GAAOvX,MAAM,kCAAmC,WAAWuX,GAAK1V,SAAW0V,IAAO,CAChFvX,MAAOuX,EACP1V,QAASmK,EACTyJ,cACA1P,SAGK,CAAE0Q,UAAWhB,EAAa6B,aAAc,GAAIvW,KACrD,GC5DI,GAAS,IAAIC,EAAO,qBAOpBwW,GAAgBxL,IACpB,MAAM1Q,EAAMoS,GAAe1B,GAC3B,OAAK1Q,GAAY,MAkCbmc,GAAsB,CAC1BC,EACAC,EACAC,EACAC,KAEA,GAAIA,EAEF,OADA,GAAOvX,IAAI,sBAAuB,mBAC3B,CAAEtH,KAAM,cAAe8e,SAAU,GAG1C,MAAMC,EAAaL,EAAYjiB,IAAI+hB,IAGnC,IAAIQ,GAAiB,EACrB,MAAMC,EAAYhK,KAAKiK,IAAIH,EAAWliB,OAAQ8hB,EAAe9hB,QAC7D,IAAK,IAAIE,EAAI,EAAGA,EAAIkiB,EAAWliB,IAC7B,GAAIgiB,EAAWhiB,KAAO4hB,EAAe5hB,GAAI,CACvCiiB,EAAgBjiB,EAChB,KACF,CAOF,IALuB,IAAnBiiB,GAAwBD,EAAWliB,SAAW8hB,EAAe9hB,SAC/DmiB,EAAgBC,IAIK,IAAnBD,EAAsB,CACxB,MAAMF,EAAWJ,EAAY7hB,OAAS,EAAI6hB,EAAY7hB,OAAS,EAAI,EAEnE,OADA,GAAOyK,IAAI,sBAAuB,kCAAkCwX,OAC7D,CAAE9e,KAAM,cAAe8e,WAChC,CAGA,MAAMK,EAAahU,EAAEiU,WAAWT,EAAgBI,GAIhD,OAAwB,IAHP5T,EAAEiU,WAAWL,EAAYJ,GAG7B9hB,QAAgBsiB,EAAWtiB,OAAS,GA7DrB,EAACwiB,EAAwBC,KACrD,IAAK,MAAMvX,KAAMsX,EACf,GAAKtX,GAEW,EADGoD,EAAEzH,IAAI4b,EAAU,CAAC1a,EAAWmD,KAEnClL,OAAS,EACnB,OAAO,EAGX,OAAO,GAoD+C0iB,CAAsBJ,EAAYP,IACtF,GAAOtX,IAAI,sBAAuB,wBAC3B,CAAEtH,KAAM,YAAawf,eAAgBT,KAI9C,GAAOzX,IAAI,sBAAuB,4BAA4B0X,UACvD,CAAEhf,KAAM,cAAe8e,SAAUE,KAS7BS,GAA6BxS,MAAO4R,GAAkB,KACjE,IACMA,EACF,GAAO1V,KAAK,6BAA8B,gBAE1C,GAAO7B,IAAI,6BAA8B,oBAI3C,MACMf,EAAS,CACb,MAFeiH,IAEC,OAIZkR,EAAc1K,gBAAgB,sBAAuB,CAAEC,gBAAgB,IAC7E,GAAOlL,MAAM,6BAA8B,oBAAqB2V,GAGhE,MAAQ1R,KAAMyP,EAAa1P,KAAM6R,GAAgBhS,IAE3C+R,EAAoCxT,EAAEC,UAAUD,EAAEzH,IAAIkb,EAAa/Z,EAAU,KAOnF,GALA,GAAOkE,MACL,6BACA,+BAA+B4V,EAAe9hB,8BAA8B6hB,GAAa7hB,QAAU,MAGhG6hB,GAAsC,IAAvBA,EAAY7hB,OAE9B,YADA,GAAOyK,IAAI,6BAA8B,0BAK3C,MAAMoY,EAAajB,GAAoBC,EAAaC,EAAgBC,EAAaC,GAGjF,GAAwB,cAApBa,EAAW1f,KAOb,OANA,GAAOsH,IAAI,6BAA8B,mBACnC4F,EAAkBH,IACtB5B,EAAEqK,IAAIzI,EAAMlI,EAAU6a,EAAWF,gBAC1BzS,SAET,GAAOzF,IAAI,6BAA8B,8BAI3C,MAAMqY,EAAgBD,EAAWZ,SAIjC,IAAIc,EAAgBnD,EACpB,GAAIkD,GAAiB,GAAKA,EAAgBhB,EAAe9hB,OAAQ,CAC/D,MAAMyZ,EAAoCnL,EAAEzH,IAAIkb,EAAaha,EAAW,CAAC,GACnEib,EAAYlB,EAAeA,EAAe9hB,OAAS,GACnDwZ,EAAWsJ,EAAgB,EAAIhB,EAAegB,EAAgB,QAAKtiB,EAErEwiB,IACF,GAAOvY,IAAI,6BAA8B,cAAcuY,SAAiBxJ,GAAY,UAEpFuJ,EVvGD,SACLvJ,EACAwJ,EACAlI,EACApC,EACAe,GAEA,MAAMwJ,EAAevK,EAAY7F,QAAQmQ,GAEnCtJ,EAAcF,EAAWd,EAAY7F,QAAQ2G,IAAa,EAEhE,IAAsB,IAAlByJ,EAAqB,CACvB,MAAMtJ,EAAW,gBAAgBqJ,IAEjC,MADA,GAAO7Y,MAAM,mBAAoBwP,EAAU,CAAEqJ,YAAWtK,gBAClD,IAAInX,MAAMoY,EAClB,CACA,GAAIH,IAA6B,IAAjBE,EAAoB,CAClC,MAAMC,EAAW,gBAAgBH,IAEjC,MADA,GAAOrP,MAAM,mBAAoBwP,EAAU,CAAEH,WAAUd,gBACjD,IAAInX,MAAMoY,EAClB,CAEA,GAAID,EAAcuJ,EAOhB,OANA,GAAO3W,KAAK,mBAAoB,mBAAoB,CAClDkN,WACAwJ,YACAtJ,cACAuJ,iBAEK3U,EAAEC,UAAUuM,GAErB,GAAIpB,IAAgBuJ,EAClB,OAAO3U,EAAEC,UAAUuM,GAGrB,IAAIlB,EAAWtL,EAAEC,UAAUuM,GAI3B,IAAK,IAAI5a,EAAI+iB,EAAc/iB,EAAIwZ,EAAaxZ,IAAK,CAC/C,MAAMgjB,EAAexK,EAAYxY,GAC5BgjB,IAELtJ,EAAWb,GAAca,EADb,EAAaH,EAAQyJ,KAEnC,CAEA,OAAOtJ,CACT,CUwDwBuJ,CAAiB3J,EAAUwJ,EAAWpD,EAAakC,EAAgBrI,GACnF,GAAOhP,IAAI,6BAA8B,gBAE7C,CAGA,GAAOA,IAAI,6BAA8B,QAAQqY,eACjD,MAAMH,EAAoCb,EAAe9M,MAAM,EAAG8N,GAG5DM,EAAgB9U,EAAEC,UAAUwT,GAElC,IAAK,IAAI7hB,EAAI4iB,EAAe5iB,EAAI2hB,EAAY7hB,OAAQE,IAAK,CACvD,MAAMiW,EAAM0L,EAAY3hB,GAKlBmjB,EAAc/U,EAAEC,UAAU6U,GAGhC9U,EAAEqK,IAAI0K,EAAarb,EAAU2a,EAAe3N,MAAM,EAAG9U,IAIrD,MAAM,UAAE0gB,EAAS,aAAEa,EAAY,GAAEvW,SAAayU,GAAyBxJ,EAAK4M,EAAeM,EAAa3Z,GAExGiZ,EAAeziB,GAAKgL,EACpB,GAAOgB,MAAM,6BAA8B,kBAAkBhM,UAAUgL,KAElEA,GAML6X,EAAgBnC,EAEhBtS,EAAEqK,IAAIyK,EAAe,CAACrb,EAAWmD,GAAKuW,IAPpC,GAAOvV,MAAM,6BAA8B,WAAWhM,kBAQ1D,CACA,GAAOuK,IAAI,6BAA8B,WAKzC6D,EAAEqK,IAAIyK,EAAepb,EAAU2a,SlB9K5BvS,eAAiCE,SAChCC,oBAAoBH,MAAMI,IAC9B,MAAMsK,EAAc,QAAMtK,EAAG1I,EAAgB,CAAC,GACxCwb,QAAgBhT,EAAQwK,GAE9B,OADA,QAAMtK,EAAG1I,EAAgBwb,GAClB9S,GACN5I,EACL,CkByKU2b,CAAkB,IAAMR,SACxB1S,EAAkB,IAAM+S,GAC9B,GAAO3Y,IAAI,6BAA8B,UAC3C,CAAE,MAAON,GACP,GAAOA,MAAM,6BAA8B,gBAAgBA,GAAO6B,SAAW7B,IAAS,CACpFA,QACA6X,kBACAlL,QAAS/G,IACT8R,YAAa1K,gBAAgB,sBAAuB,CAAEC,gBAAgB,KAE1E,GClPI,GAAM,IAAIjM,EAAO,oBA4CvBiF,eAAeoT,GAAmBjE,GAChC,MAAMrI,EAAWC,gBAAgBoI,GAEjC,IAAKrI,GAAgC,IAApBA,EAASlX,OAExB,YADA,GAAIsM,KAAK,qBAAsB,YAAYiT,UAI7C,MAAMvT,EAAUkL,EAAS,SAGnBU,gBAAgB,CAAC,CAAEP,WAAYkI,EAAWvT,QAASA,EAAQA,WACjE,GAAIE,MAAM,qBAAsB,4BAA4BqT,KAC9D,CCtDA,MAAM,GAAS,IAAIpU,EAAO,gCAEnBiF,eAAeqT,GACpBtU,EACAmN,EACAhB,GAEA,MAAQnY,KAAM+K,GAAciB,EAC5B,GAAOjD,MAAM,kBAAmB,MAAMgC,iBACtC,MAAMwV,EAA2B,qBAAdxV,QACb0U,GAA2Bc,GACjCpH,EAAaqH,QAAS,EAEL,cAAbzV,GD+CCkC,iBACL,MAAMwT,EAAa3T,aAAa,CAAE9M,KAAM,SAAU0N,UAAWC,gBAI7D,IADoBxC,EAAEzH,IAAI+c,EAAY,UAAU,GAG9C,YADA,GAAI1X,MAAM,4BAA6B,kBAKzC,MAAM2X,EAAevV,EAAEzH,IAAI+c,EAAY,UAAW,GAClD,GAAInZ,IAAI,4BAA6B,eAAeoZ,WAG9C,IAAIC,QAAQC,GAAWC,WAAWD,EAAS,MAEjD,MAAMlC,EAAc1K,gBAAgB,uBACpC,IAAK0K,GAAsC,IAAvBA,EAAY7hB,OAE9B,YADA,GAAIsM,KAAK,4BAA6B,oBAKxC,MAAM2X,EAAiBpC,EAAY7M,OAAO6O,GAE1C,IAAK,MAAM7X,KAAWiY,EACpB,GAAI/X,MAAM,4BAA6B,aAAaF,EAAQqL,oBACtDmM,GAAmBxX,EAAQqL,kBAE3B,IAAIyM,QAAQC,GAAWC,WAAWD,EAAS,MAEnD,GAAItZ,IAAI,4BAA6B,UACvC,CChFiCyZ,SAGzB1L,KACN6C,GAAmBC,EACrB,CCfA,MAAM,GAAS,IAAInQ,EAAO,6BAgC1B,IAAIgZ,GAAgD,KAiCpD,SAASC,KACP,MAAMlZ,EAAKD,EAAWC,GActB,OAbIA,GAAMiZ,IAAsBA,GAAmBjZ,KAAOA,GACxD,GAAOgB,MACL,2BACA,oBAAoBhB,UAAWiZ,GAAmBE,cAAcF,GAAmBE,MAAQ,KAE7FF,GAAmBE,UAEnB,GAAOnY,MACL,2BACA,kBAAkBhB,uBAAwBiZ,IAAoBjZ,MAEhEiZ,GAAqB,CAAEjZ,GAAIA,EAAImZ,MAAO,IAEjCF,GAAmBE,KAC5B,CASOjU,eAAekU,GAAuBnV,EAAeoV,GAC1D,MAAQphB,KAAM+K,GAAciB,EACtBqV,EAAavW,EAAcC,GACjC,IAAImJ,EAA4B,KAGhC,MAAMiF,EAA6B,CAAEmI,UAAU,EAAOC,OAAO,EAAOf,QAAQ,EAAOpH,KAAK,EAAOoI,UAAU,GAEzG,UjBqCKvU,eACLwU,EACAC,EAAkB,EAClBC,EAAgB,IAEhB,IAAI3O,EAEJ,GAAIyO,EACF,GAA2B,iBAAhBA,EAA0B,CACnC,MAAM1N,EAAWC,gBAAgByN,EAAa,CAAExN,gBAAgB,IAChEjB,EAAMe,EAAWA,EAAS,GAAK,IACjC,MACEf,EAAMyO,OAGRzO,EAAMc,KAGR,IAAKd,EAEH,OADA1L,GAAI6B,KAAK,6BAA8B,aAAc,CAAEsY,gBAChD,KAGT,IAAK,IAAI1kB,EAAI,EAAGA,EAAI2kB,EAAS3kB,IAAK,CAChC,MAAMpB,EAAUoX,GAAkBC,GAClC,GAAIrX,EACF,OAAOA,EAET2L,GAAIA,IAAI,6BAA8B,eAAeqa,cAAkB5kB,EAAI,cACrE,IAAI4jB,QAAQC,GAAWC,WAAWD,EAASe,GACnD,CAGA,OADAra,GAAI6B,KAAK,6BAA8B,MAAMuY,gBAAuB,CAAExN,WAAYlB,EAAIkB,aAC/EnB,GAAkBC,EAC3B,CiBpEU4O,GAGN,GAAOta,IAAI,yBAA0B,+BACrC,MAAM,GAAES,EAAImM,WAAY2N,EAAK,SAAEC,QhBiEK7U,WAKtC,IACE,MAAM+F,EAAMgB,iBAAiB,EAAG,CAAEC,gBAAgB,MAAU,GAI5D,GAFA,GAAOlL,MAAM,2BAA4B,mBAAoBiK,IAExDA,GAAiC,iBAAnBA,EAAIkB,WAErB,OADA,GAAO/K,KAAK,2BAA4B,kBAAmB,CAAE4Y,cAAe/O,IACrE,CAAEjL,GAAI,GAAImM,WAAY,KAAM4N,UAAU,GAI/C,MAAM,GAAE/Z,EAAE,MAAE6M,SAAgBD,GAAiB3B,GAE7C,OADA,GAAOjK,MAAM,2BAA4B,UAAUiK,EAAIkB,+BAA+BU,MAC/E,CAAE7M,KAAImM,WAAYlB,EAAIkB,WAAY4N,SAAUlN,EACrD,CAAE,MAAO2J,GAKP,OAJA,GAAOvX,MAAM,2BAA4B,YAAYuX,GAAK1V,SAAW0V,IAAO,CAC1EvX,MAAOuX,EACPwD,cAAe/N,iBAAiB,EAAG,CAAEC,gBAAgB,MAAU,KAE1D,CAAElM,GAAI,GAAImM,WAAY,KAAM4N,UAAU,EAC/C,GgB1FoDE,GAClD,IAAKja,GAAgB,OAAV8Z,EAET,OADA,GAAO1Y,KAAK,yBAA0B,6BAC/BiY,EAETtZ,EAAWC,GAAKA,EAChBmM,EAAa2N,EAGb,GAAOva,IAAI,yBAA0B,8Bd5GlC2F,eAAiCiH,GACtC,MAAMtL,EAAW,oBACjB,GAAOG,MAAMH,EAAU,kBAAkBsL,KAEzC,MAAMwB,EAAWlI,IACjB,IAAKkI,EAAS,cAEZ,YADA,GAAO3M,MAAMH,EAAU,cAGzB,GAAOG,MAAMH,EAAU,eAEvB,MAAMqZ,EAAejO,gBAAgBE,EAAY,CAAED,gBAAgB,IAAQ,GAC3E,IAAKgO,EAEH,YADA,GAAO9Y,KAAKP,EAAU,cAAcsL,YAKtC,GAFA,GAAOnL,MAAMH,EAAU,gBAAgBsL,KAAe+N,GAElD3O,GAAc2O,GAEhB,YADA,GAAOlZ,MAAMH,EAAU,MAAMsL,gBAG/B,GAAOnL,MAAMH,EAAU,MAAMsL,mBAE7B,MAAMgO,EAAcxM,EAAS,MACvByM,EAAiBpP,GAAkBkP,GAIzC,GAHA,GAAOlZ,MAAMH,EAAU,WAAY,CAAEjN,QAASwmB,IAC9C,GAAOpZ,MAAMH,EAAU,UAAW,CAAEsZ,gBAEhCC,GAAkBA,EAAe1Z,SAASyZ,GAE5C,YADA,GAAOnZ,MAAMH,EAAU,kBAIzB,MAAMwZ,GAAcD,GAAkB,IAAIE,UAAY,KAAOH,EAC7D,GAAOnZ,MAAMH,EAAU,gBAAiB,CAAEwZ,eAE1C,UACQjO,GAAqB8N,EAAcG,EAAY,YACrD,GAAOrZ,MAAMH,EAAU,UACzB,CAAE,MAAO5B,GACP,GAAOA,MAAM4B,EAAU,aAAc5B,EACvC,CACF,CckEUsb,CAAkBpO,GAGpB4N,GAAY/Z,IACdqZ,EAAa,CACXrZ,GAAIA,EACJwa,YAlH2C,IAuH/C,GAAOxZ,MAAM,yBAA0B,iCACvC,MAAM,WAAEyZ,EAAU,cAAEC,GAtFxB,SACE1X,EACA2X,EACAtB,GAEA,OAAIA,GAAcrW,IAAcvB,cAAcmZ,4BAA8BD,IAActB,EAAWrZ,IACnG,GAAOgB,MACL,6BACA,WAAWqY,EAAWrZ,2BAA2BqZ,EAAWmB,YAAc,KAE5EnB,EAAWmB,cACPnB,EAAWmB,aAAe,IAC5BnB,EAAa,KACb,GAAOrY,MAAM,6BAA8B,WAEtC,CAAEyZ,YAAY,EAAMC,cAAerB,IAErC,CAAEoB,YAAY,EAAOC,cAAerB,EAC7C,CAoE0CwB,CAA2B7X,EAAWhD,EAAIqZ,GAEhF,GADAA,EAAaqB,EACTD,EAEF,OAAOpB,EAGT,GAAO9Z,IAAI,yBAA0B,SAASyD,UAAkBsW,MAIhE,MAAMlJ,EAA6B,CACjCpQ,GAAIA,EACJmM,WAAYA,EACZ2O,QAAS1J,EACT2J,2BAA4B,GAG9B,OAAQzB,GACN,IAAK,OACH,GAAO/Z,IAAI,yBAA0B,iCACrCmO,KAEA0C,EAAQ2K,2BAA6B7B,KACrC,GAAO3Z,IAAI,yBAA0B,qCAC/BgZ,GAAgBtU,EAAKmN,EAAchB,GACzC,MACF,IAAK,OACHA,EAAQ2K,2BAA6B7B,KACrC,GAAO3Z,IAAI,yBAA0B,qCAC/BgZ,GAAgBtU,EAAKmN,EAAchB,GACzC,MACF,IAAK,MACH,GAAO7Q,IAAI,yBAA0B,qBACrC4R,GAAelN,EAAKmN,GACpB,MACF,IAAK,iBACH,GAAO7R,IAAI,yBAA0B,oCC7KtC2F,uBAECoI,IACR,CD2Kc0N,GAGZ,CAAE,MAAO/b,GACP,GAAOA,MAAM,yBAA0B,MAAM+D,WAAmB/D,IAASA,EAC3E,C,QAEEc,EAAWC,GAAK,EAKlB,CAEA,OAAOqZ,CACT,CE5KA,MAAM,GAAS,IAAIpZ,EAAO,wBAMpBgb,GAAyB,GAM/B,IAAIC,IAAe,EACfC,IAAY,EACZC,GAAoC,KAQjC,SAASC,GAAYpjB,EAAc4L,GACxC,GAAO7C,MAAM,cAAe,UAAU/I,WAAe,CAAE4L,WACvDoX,GAAW5mB,KAAK,CAAE4D,OAAM4L,SAAQH,UAAWsJ,KAAKC,QAQlD/H,iBAEE,GAAIiW,GAEF,YADA,GAAOna,MAAM,eAAgB,uBAK3Bka,KACF,GAAOla,MAAM,eAAgB,qBAC7Bma,IAAY,QAEN,IAAIvC,QAAcC,IACtBuC,GAAevC,IAEjBsC,IAAY,EACZ,GAAOna,MAAM,eAAgB,iBAI/B,GAA0B,IAAtBia,GAAWnmB,OAEb,YADA,GAAOkM,MAAM,eAAgB,cAM/Bka,IAAe,EACf,GAAOla,MAAM,eAAgB,SAG7B,MAAMsa,EAAWL,GAAW,GAE5B,GAAc,QADAlY,EAAcuY,EAASrjB,MAChB,CACnB,MAAMsjB,EAAezY,EAAmBnH,IAAI2f,EAASrjB,OAAS,IAC9D,GAAO+I,MAAM,eAAgB,eAAeua,gBACtC,IAAI3C,QAAQC,GAAWC,WAAWD,EAAS0C,GACnD,CAGA,GAAOva,MAAM,eAAgB,sBAAuBhH,KAAKC,UAAUghB,GAAWvmB,IAAIqK,GAAKA,EAAE9G,QAIzF,IAAIohB,EAAgC,KACpC,KAAO4B,GAAWnmB,OAAS,GAAG,CAC5B,MAAMoO,EAAiB+X,GAAWO,OAAO,EAAGP,GAAWnmB,QACjDwO,EAAYL,EAAgBC,GAElC,GAAOlC,MACL,eACA,gBAAgBkC,EAAepO,qBAAqBwO,EAAUxO,eAGhE,IAAK,MAAMmP,KAAOX,EAAW,CAE3B+V,QAD4BD,GAAuBnV,EAAKoV,EAE1D,CACA,GAAOrY,MAAM,eAAgB,YAC/B,CAOA,GAJAka,IAAe,EACf,GAAOla,MAAM,eAAgB,eAGzBoa,GAAc,CAChB,GAAOpa,MAAM,eAAgB,iBAC7B,MAAMya,EAASL,GACfA,GAAe,KACfK,GACF,CACF,CA/EEC,EACF,CC3CA,MAAM,GAAS,IAAIzb,EAAO,wBA8D1B2N,EAAE,KASA+N,kBAAkB,6CAA8C,CAACC,EAAS/T,EAAWgU,EAAU7N,IA/D1F,SAAwBrF,GAI7B,IAAKA,EAAKjI,SAAS,SACjB,OAAOiI,EAIT,MAAM,KAAE1D,GAASJ,IACjB,OAAKI,EAME0D,EAAK/J,QAfO,6CAea,CAACiJ,EAAWgU,EAAU7N,KACpD,MACM8N,EAAc9N,EAAKhG,OACnB+T,IAAgBF,EAEtB,IAAIlhB,EAOJ,GALEA,EADkB,aAAhBmhB,EACK7W,EAEA7B,EAAEzH,IAAIsJ,EAAM6W,QAGRxmB,IAATqF,EAEF,OADA,GAAOyG,KAZQ,iBAYO,uBAAuB0a,kBACtC,GAIT,MAAME,EAAqBD,EAAcphB,EAAO4J,EAAiB5J,GAG3DshB,EAAYzV,EAAgBwV,GAQlC,OANA,GAAOhb,MAAM,iBAAkB,aAAa8a,IAAe,CACzDzX,OAAQ2X,EACR1X,MAAO2X,IAIgB,iBAAdA,GAAwC,OAAdA,EAC5BjiB,KAAKC,UAAUgiB,GAIjBlb,OAAOkb,MAvCd,GAAO7a,KAAK,iBAAkB,2BAEvBuH,EAuCX,CAcWuT,CAAerU,MC9E1B,MAAM,GAA+BsU,ICE/BC,GAAa,CAAEC,MAAO,OACtBC,GAAa,CAAC,iBACdC,GAAa,CAAEF,MAAO,SACtBG,GAAa,CAAEH,MAAO,QACtBI,GAAa,CAAEJ,MAAO,SAE5B,IAA6B,sBAAiB,CAC1CK,OAAQ,eACRtiB,MAAO,CACHuiB,MAAO,CAAC,EACRC,YAAa,CAAE3kB,KAAMkB,QAASrF,SAAS,IAE3C,KAAA+oB,CAAMC,GACF,MAAM1iB,EAAQ0iB,EACRC,GAAO,KAAAC,KAAI5iB,EAAMwiB,aACvB,MAAO,CAACK,EAAMC,MACF,mBAAc,yBAAoB,UAAWd,GAAY,EAC7D,yBAAoB,eACpB,yBAAoB,SAAU,CAC1BC,MAAO,WACP,gBAAiBU,EAAK5gB,MAAQ,OAAS,QACvCghB,QAASD,EAAO,KAAOA,EAAO,GAAME,GAAYL,EAAK5gB,OAAS4gB,EAAK5gB,QACpE,EACC,yBAAoB,OAAQ,CACxBkgB,OAAO,qBAAgB,CAAC,QAAS,CAAEU,KAAMA,EAAK5gB,UAC/C,IAAK,IACR,yBAAoB,WACpB,yBAAoB,OAAQogB,IAAY,sBAAiBO,EAAQH,OAAQ,IACzE,yBAAoB,UACpBO,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,UAAY,MAAO,KAClF,yBAAoB,WACpB,yBAAoB,OAAQG,IAAY,sBAAiBO,EAAK5gB,MAAQ,KAAO,MAAO,IACpF,yBAAoB,WACrB,EAAemgB,KAClB,yBAAoB,2BACpB,yBAAoB,MAAO,CACvBD,OAAO,qBAAgB,CAAC,WAAY,CAAEU,KAAMA,EAAK5gB,UAClD,EACC,yBAAoB,MAAOsgB,GAAY,EACnC,iBAAYQ,EAAKI,OAAQ,cAE9B,KAGf,I,qBCxCJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEhB,MAAO,QACtB,GAAa,CAAEA,MAAO,MACtB,GAAa,CAAEA,MAAO,QACtB,GAAa,CAAC,SACd,GAAa,CAAEA,MAAO,QACtBiB,GAAa,CAAEjB,MAAO,KACtBkB,GAAa,CAAElB,MAAO,QACtBmB,GAAa,CAAEnB,MAAO,KAG5B,IAA6B,sBAAiB,CAC1CK,OAAQ,aACRtiB,MAAO,CACH4F,GAAI,CAAC,EACLqU,UAAW,CAAC,EACZoJ,OAAQ,CAAExlB,KAAMkB,UAEpB,KAAA0jB,CAAMC,GACF,MAAMxb,EAAS,IAAIrB,EAAO,oDAEpB7F,EAAQ0iB,EAOd,OANA,KAAAY,WAAU,SAGV,KAAAC,OAAM,IAAMvjB,EAAOwjB,IACftc,EAAON,MAAM,cAAe,aAAc,CAAE4c,cAC7C,CAAEC,MAAM,IACJ,CAACZ,EAAMC,MACF,mBAAc,yBAAoB,UAAW,GAAY,EAC7D,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,MAAO,GAAY,CACnCA,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,KAAO,MAAO,KAC7E,yBAAoB,WACpB,yBAAoB,OAAQ,CACxBA,MAAO,IACPM,MAAOG,EAAQ9c,KAChB,sBAAiB8c,EAAQ9c,IAAM,KAAM,EAAqB,KAC7D,yBAAoB,aAExB,yBAAoB,MAAO,GAAY,CACnCkd,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,KAAO,cAAe,KACrF,yBAAoB,mBACpB,yBAAoB,OAAQiB,IAAY,sBAAiBR,EAAQzI,WAAa,KAAM,IACpF,yBAAoB,qBAExB,yBAAoB,MAAOkJ,GAAY,CACnCL,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,KAAO,MAAO,KAC7E,yBAAoB,WACpB,yBAAoB,OAAQmB,IAAY,sBAAiBV,EAAQW,OAAS,KAAO,MAAO,IACxF,yBAAoB,gBAKxC,I,OClDJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCLjE,GAAa,CAAEpB,MAAO,QACtB,GAAa,CAAEA,MAAO,OACtB,GAAa,CAAEA,MAAO,SACtB,GAAa,CACf9hB,IAAK,EACL8hB,MAAO,WAEL,GAAa,CACf9hB,IAAK,EACL8hB,MAAO,iBAEL,GAAa,CAAEA,MAAO,SCV5B,UAAe,KAAAyB,iBAAgB,CAC3BC,KAAM,WACN3jB,MAAO,CACH5E,EAAG,CAAEyC,KAAM,CAAC8I,OAAQsK,QAAS2S,UAAU,GACvC1Y,EAAG,CAAE0Y,UAAU,GACfhQ,KAAM,CAAE/V,KAAM8I,OAAQid,UAAU,GAChCC,MAAO,CAAEhmB,KAAMoT,OAAQ2S,UAAU,GACjCE,iBAAkB,CAAEjmB,KAAMkB,QAASrF,SAAS,GAC5CqqB,SAAU,CAAElmB,KAAMoT,OAAQvX,QAAS,IAEvC,KAAA+oB,CAAMle,GACF,MAAM2C,EAAS,IAAIrB,EAAO,iCAC1B,KAAAyd,WAAU,QAIV,MAAMzlB,GAAO,KAAAmmB,UAAS,KAClB,MAAM5jB,EAAMmE,EAAE2G,EACd,GAAY,OAAR9K,EACA,MAAO,OACX,GAAImF,MAAM+E,QAAQlK,GACd,MAAO,QACX,MAAM6N,SAAW7N,EACjB,MAAU,WAAN6N,EACO,SACD,cAANA,EACO,YACJA,IAGL3D,GAAU,KAAA0Z,UAAS,IAAqB,UAAfnmB,EAAKkE,OAC9BkiB,GAAW,KAAAD,UAAS,IAAqB,WAAfnmB,EAAKkE,OAE/BmiB,GAAW,KAAAF,UAAS,IAAM1Z,EAAQvI,OAASkiB,EAASliB,OAEpD4gB,GAAO,KAAAC,KAAIre,EAAEsf,QAAUtf,EAAEwf,UAAY,KAAaxf,EAAEuf,mBAC1D,KAAAP,OAAMZ,EAAMwB,IACRjd,EAAON,MAAM,aAAc,aAAYud,EAAe,KAAO,SAGjE,MAAMC,GAAgB,KAAAJ,UAAS,KAC3B,MAAM5jB,EAAMmE,EAAE2G,EACd,OAAQrN,EAAKkE,OACT,IAAK,SACD,OAAOnC,KAAKC,UAAUO,GAC1B,IAAK,SAUL,IAAK,SACD,OAAOuG,OAAOvG,GATlB,IAAK,UACD,OAAOA,EAAM,OAAS,QAC1B,IAAK,OACD,MAAO,OACX,IAAK,YACD,MAAO,YACX,IAAK,SACD,OAAOuG,OAAOvG,GAAO,IAGzB,IAAK,WACD,MAAO,MACX,QACI,MAAO,MAIbikB,GAAU,KAAAL,UAAS,IACjB1Z,EAAQvI,MACD,SAASwC,EAAE2G,EAAExQ,UACpBupB,EAASliB,MACF,UAAUX,OAAO2K,KAAKxH,EAAE2G,GAAK,CAAC,GAAGxQ,UACrC,IAGL4pB,GAAe,KAAAN,UAAS,KAC1B,GAAIC,EAASliB,MACT,OAAOwC,EAAE2G,EACb,GAAIZ,EAAQvI,MAAO,CACf,MAAMwiB,EAAM,CAAC,EAIb,OAHAhgB,EAAE2G,EAAEX,QAAQ,CAACia,EAAIC,KACbF,EAAI5d,OAAO8d,IAAQD,IAEhBD,CACX,CACA,MAAO,CAAC,IAEZ,MAAO,CAAE1mB,OAAMyM,UAAS4Z,WAAUvB,OAAMyB,gBAAeC,UAASC,eACpE,I,OChFJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,SFMpD,SAAgBzB,EAAMC,EAAQ4B,EAAQC,EAAQC,EAAOC,GACxD,MAAMC,GAAsB,uBAAkB,YAAY,GAC1D,OAAQ,mBAAc,yBAAoB,YAAW,KAAM,EACvD,yBAAoB,iBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,qBACpB,yBAAoB,MAAO,CACvB7C,MAAO,YACP8C,OAAO,qBAAgB,CAAEC,YAA0B,GAAbnC,EAAKgB,MAAa,QACzD,EACC,yBAAoB,UACnBhB,EAAa,WACP,mBAAc,yBAAoB,SAAU,CAC3C1iB,IAAK,EACL8hB,OAAO,qBAAgB,CAAC,QAAS,CAAEU,KAAME,EAAKF,QAC9C,aAAc,SACdI,QAASD,EAAO,KAAOA,EAAO,GAAME,GAAYH,EAAKF,MAAQE,EAAKF,OACnE,IAAK,KACN,yBAAoB,QAAQ,IAClC,yBAAoB,aACpB,yBAAoB,OAAQ,IAAY,sBAAiBE,EAAKznB,GAAI,GAClE0nB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,KAAM,KAChF,yBAAoB,WACpB,yBAAoB,2CACnBY,EAAa,WACP,mBAAc,yBAAoB,YAAW,CAAE1iB,IAAK,GAAK,EACxD,yBAAoB,OAAQ,IAAY,sBAAiB0iB,EAAKvY,QAAU,IAAM,KAAM,IACpF,yBAAoB,YAClBuY,EAAKF,MAED,yBAAoB,QAAQ,KAD3B,mBAAc,yBAAoB,OAAQ,IAAY,sBAAiBE,EAAKwB,SAAU,KAE7F,yBAAoB,aACrB,OACA,mBAAc,yBAAoB,YAAW,CAAElkB,IAAK,GAAK,EACxD,yBAAoB,iBACpB,yBAAoB,OAAQ,CACxB8hB,OAAO,qBAAgB,CAAC,MAAOY,EAAKhlB,SACrC,sBAAiBglB,EAAKuB,eAAgB,IACzC,yBAAoB,YACrB,MACR,IACH,yBAAoB,0BACnBvB,EAAKqB,UAAYrB,EAAKF,OAChB,mBAAc,yBAAoB,MAAO,GAAY,EACpD,yBAAoB,wDACnB,iBAAW,IAAO,yBAAoB,YAAW,MAAM,iBAAYE,EAAKyB,aAAc,CAACW,EAAUC,MACtF,mBAAc,kBAAaJ,EAAqB,CACpD3kB,IAAK0iB,EAAKjP,KAAO,IAAMjN,OAAOue,GAC9B9pB,EAAGuL,OAAOue,GACVha,EAAG+Z,EACHrR,KAAMiP,EAAKjP,KAAO,IAAMjN,OAAOue,GAC/BrB,MAAOhB,EAAKgB,MAAQ,EACpB,oBAAqBhB,EAAKiB,iBAC1B,YAAajB,EAAKkB,UACnB,KAAM,EAAe,CAAC,IAAK,IAAK,OAAQ,QAAS,oBAAqB,gBACzE,OACJ,yBAAoB,MAAO,CACvB9B,MAAO,YACP8C,OAAO,qBAAgB,CAAEC,YAA0B,GAAbnC,EAAKgB,MAAa,QACzD,EACC,yBAAoB,OAAQ,IAAY,sBAAiBhB,EAAKvY,QAAU,IAAM,KAAM,IACpF,yBAAoB,aACrB,OAEL,yBAAoB,QAAQ,MAEvC,KACP,GEzE4E,CAAC,YAAY,qBCLnF,GAAa,CAAE2X,MAAO,aACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CAAEA,MAAO,SACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CACf9hB,IAAK,EACL8hB,MAAO,YACP8C,MAAO,CAAEC,YAAa,SAEpB,GAAa,CAAE/C,MAAO,aACtB,GAAa,CAAEA,MAAO,SAI5B,IAA6B,sBAAiB,CAC1CK,OAAQ,mBACRtiB,MAAO,CACH+B,MAAO,CAAC,EACR+hB,iBAAkB,CAAEjmB,KAAMkB,QAASrF,SAAS,GAC5CqqB,SAAU,CAAErqB,QAAS,IAEzB,KAAA+oB,CAAMC,GACF,MAAMxb,EAAS,IAAIrB,EAAO,wCACpB7F,EAAQ0iB,EACRyC,GAAuB,KAAAnB,UAAS,KAClC,MAAM9Y,EAAIlL,EAAM+B,MACVmL,EAAe,OAANhC,GAA2B,iBAANA,EAIpC,OAHAhE,EAAON,MAAM,uBAAwB,SAASsG,OAAYA,EAAS,IAAM,eAAgB,CACrF,IAAKhC,IAEFgC,IAELkY,GAAgB,KAAApB,UAAS,KAC3B,MAAM9Y,EAAIlL,EAAM+B,MAChB,IAAImL,EACJ,GAAU,OAANhC,EACAgC,EAAS,YAER,GAAI3H,MAAM+E,QAAQY,GACnBgC,EAAS,YAER,CACD,MAAMe,SAAW/C,EACjBgC,EAAe,cAANe,EAAoB,YAAcA,CAC/C,CAEA,OADA/G,EAAON,MAAM,gBAAiB,YAAYsG,IAAU,CAAE,IAAKhC,IACpDgC,IAELkX,GAAgB,KAAAJ,UAAS,KAC3B,MAAM9Y,EAAIlL,EAAM+B,MAChB,IAAImL,EACJ,OAAQkY,EAAcrjB,OAElB,IAAK,SACDmL,EAAStN,KAAKC,UAAUqL,GACxB,MACJ,IAAK,SAeL,IAAK,SACDgC,EAASvG,OAAOuE,GAChB,MAdJ,IAAK,UACDgC,EAAShC,EAAI,OAAS,QACtB,MACJ,IAAK,OACDgC,EAAS,OACT,MACJ,IAAK,YACDA,EAAS,YACT,MACJ,IAAK,SACDA,EAASvG,OAAOuE,GAAK,IACrB,MAIJ,IAAK,WACDgC,EAAS,MACT,MACJ,QACIA,EAAS,GAOjB,OAJAhG,EAAON,MAAM,gBAAiB,cAAcsG,KAAW,CACnD,IAAKhC,EACL,GAAIka,EAAcrjB,QAEfmL,IAELmY,GAAc,KAAArB,UAAS,KACzB,MAAM9W,EAAS3H,MAAM+E,QAAQtK,EAAM+B,OAEnC,OADAmF,EAAON,MAAM,cAAe,eAAesG,IAAU,CAAE,IAAKlN,EAAM+B,QAC3DmL,IAELoY,GAAW,KAAAtB,UAAS,IAAOqB,EAAYtjB,MAAQ,IAAM,KACrDwjB,GAAY,KAAAvB,UAAS,IAAOqB,EAAYtjB,MAAQ,IAAM,KAC5D,MAAO,CAAC8gB,EAAMC,MACF,mBAAc,yBAAoB,MAAO,GAAY,EACzD,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,OAAQ,IAAY,sBAAiBwC,EAASvjB,OAAQ,IAC1E,yBAAoB,uBAExB,yBAAoB,MAAO,GAAY,CAClCojB,EAA0B,QACpB,iBAAW,IAAO,yBAAoB,YAAW,CAAEhlB,IAAK,IAAK,iBAAYuiB,EAAQ3gB,MAAO,CAACmJ,EAAG9P,MACnF,mBAAc,kBAAaoqB,GAAU,CACzCrlB,IAAKwG,OAAOvL,GACZA,EAAGuL,OAAOvL,GACV8P,EAAGA,EACH0I,KAAMjN,OAAOvL,GACbyoB,MAAO,EACP,oBAAqBnB,EAAQoB,iBAC7B,YAAapB,EAAQqB,UACtB,KAAM,EAAe,CAAC,IAAK,IAAK,OAAQ,oBAAqB,gBAChE,QACD,mBAAc,yBAAoB,MAAO,GAAY,CACpDjB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,OAAS,SAAU,IAClFa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,KAAM,KAChF,yBAAoB,OAAQ,CACxBA,OAAO,qBAAgB,CAAC,MAAOmD,EAAcrjB,UAC9C,sBAAiBqiB,EAAcriB,OAAQ,SAGtD,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,OAAQ,IAAY,sBAAiBwjB,EAAUxjB,OAAQ,IAC3E,yBAAoB,wBAIpC,I,OC3HJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEkgB,MAAO,mBACtB,GAAa,CAAEA,MAAO,gBACtB,GAAa,CAAEA,MAAO,gBAG5B,IAA6B,sBAAiB,CAC1CK,OAAQ,mBACRtiB,MAAO,CACHO,KAAM,CAAC,GAEXkiB,MAAMC,GACK,CAACG,EAAMC,MACF,mBAAc,kBAAa2C,GAAc,CAC7ClD,MAAO,aACP,gBAAgB,GACjB,CACC7oB,SAAS,cAAS,IAAM,EACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,MAAO,GAAY,CACnCopB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,KAAM,CAAEb,MAAO,gBAAkB,mBAAoB,KACnG,kBAAayD,GAAkB,CAC3B3jB,MAAO2gB,EAAQniB,KAAK6S,YACpB,qBAAqB,EACrB,YAAa,GACd,KAAM,EAAe,CAAC,aAE7B,yBAAoB,MAAO,GAAY,CACnC0P,EAAO,KAAOA,EAAO,IAAK,yBAAoB,KAAM,CAAEb,MAAO,gBAAkB,gBAAiB,KAChG,kBAAayD,GAAkB,CAC3B3jB,MAAO2gB,EAAQniB,KAAK4V,SACpB,qBAAqB,EACrB,YAAa,GACd,KAAM,EAAe,CAAC,gBAIrCnN,EAAG,O,OChCnB,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEiZ,MAAO,QACtB,GAAa,CACfA,MAAO,UACPvQ,KAAM,WAEJ,GAAa,CAAC,WACd,GAAa,CAAEuQ,MAAO,eACtB,GAAa,CAAE9hB,IAAK,GACpB,GAAa,CAAEA,IAAK,GAG1B,IAA6B,sBAAiB,CAC1CmiB,OAAQ,YACRtiB,MAAO,CACH2lB,KAAM,CAAC,EACPC,OAAQ,CAAC,GAEbC,MAAO,CAAC,iBACR,KAAApD,CAAMC,GAAWoD,KAAMC,IACnB,MAAM7e,EAAS,IAAIrB,EAAO,iCACpB7F,EAAQ0iB,EACRoD,EAAOC,EACPC,GAAc,KAAApD,KAAI5iB,EAAM4lB,QAAU,QAexC,OAdA,KAAArC,OAAM,IAAMvjB,EAAM4lB,OAAQ1a,IAClBA,IACAhE,EAAON,MAAM,eAAgB,sBAAsBsE,KACnD8a,EAAYjkB,MAAQmJ,MAQ5B,KAAAoY,WAAU,QAGH,CAACT,EAAMC,MACF,mBAAc,yBAAoB,UAAW,GAAY,EAC7D,yBAAoB,UACpB,yBAAoB,MAAO,GAAY,GAClC,iBAAW,IAAO,yBAAoB,YAAW,MAAM,iBAAYJ,EAAQiD,KAAO1X,KACvE,mBAAc,yBAAoB,SAAU,CAChD9N,IAAK8N,EAAE9N,IACP8hB,OAAO,qBAAgB,CAAC,UAAW,CAAE2D,OAAQ3X,EAAE9N,MAAQ6lB,EAAYjkB,SACnE2P,KAAM,MACNqR,QAAUC,IAAW,OAjBtB5nB,EAiBiC6S,EAAE9N,IAhBlD+G,EAAON,MAAM,YAAa,kBAAkBxL,KAC5C4qB,EAAYjkB,MAAQ3G,OACpB0qB,EAAK,gBAAiB1qB,GAH1B,IAAmBA,KAkBA,sBAAiB6S,EAAEgY,OAAQ,GAA6B,MAC3D,SAER,yBAAoB,sBACpB,yBAAoB,MAAO,GAAY,CACZ,SAAtBD,EAAYjkB,QACN,mBAAc,yBAAoB,MAAO,GAAY,EACpD,iBAAY8gB,EAAKI,OAAQ,SACzB,yBAAoB,mBAErB,mBAAc,yBAAoB,MAAO,GAAY,EACpD,iBAAYJ,EAAKI,OAAQ,SACzB,yBAAoB,qBAK5C,I,OC5DJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CACfrpB,GAAI,kBACJqoB,MAAO,oBAEL,GAAa,CAAEA,MAAO,oBACtB,GAAa,CACfA,MAAO,eACPvQ,KAAM,QACN,kBAAmB,YAEjB,GAAa,CAAEuQ,MAAO,oBACtB,GAAa,CAAC,SACd,GAAa,CAAEA,MAAO,oBACtB,GAAa,CACfA,MAAO,eACPvQ,KAAM,QACN,kBAAmB,aAEjB,GAAa,CAAEuQ,MAAO,sBACtBiE,GAAa,CACf/lB,IAAK,EACL8hB,MAAO,qBAELkE,GAAc,CAChBhmB,IAAK,EACL8hB,MAAO,iBASX,IAA6B,sBAAiB,CAC1CK,OAAQ,kBACRtiB,MAAO,CACHomB,WAAY,CAAC,GAEjB,KAAA3D,CAAMC,GACF,MAAM1iB,EAAQ0iB,EACRxb,EAAS,IAAIrB,EAAO,yCACpBwgB,GAAoB,KAAArC,UAAS,IAAMhkB,EAAMomB,YAAYxgB,IAAM,MAC3D0gB,GAAa,KAAA1D,KAAIyD,EAAkBtkB,OACnCwkB,GAAiB,KAAA3D,KAAI,MACrB4D,GAAqB,KAAA5D,KAAI,MACzB6D,GAAU,KAAA7D,MAAI,GACd/d,GAAQ,KAAA+d,KAAI,MACZ+C,EAAO,CACT,CAAExlB,IAAK,OAAQ8lB,MAAO,UACtB,CAAE9lB,IAAK,OAAQ8lB,MAAO,WAEpBS,GAAY,KAAA9D,KAAI,QAChB+D,GAAsB,KAAA3C,UAAS,IAC1BhkB,EAAMomB,YAAYhT,aAAa1D,QAAQkX,WAAa,IAEzDC,GAAc,KAAA7C,UAAS,IAErBwC,EAAmBzkB,MACZykB,EAAmBzkB,MAG1BukB,EAAWvkB,QAAUskB,EAAkBtkB,MAChC/B,EAAMomB,WAGV,MAELU,GAAwB,KAAA9C,UAAS,KACnC,IAAK6C,EAAY9kB,MACb,OAAO,EAEX,GAAI,YAAa8kB,EAAY9kB,MACzB,OAAO8kB,EAAY9kB,MAAM0V,QAG7B,MAAM/Q,EAAUmL,gBAAgBgV,EAAY9kB,MAAMgQ,WAAY,CAAED,gBAAgB,IAAS,GACzF,QAAOpL,GAAUyK,GAAczK,MAEnC,KAAA6c,OAAM,IAAM8C,EAAkBtkB,MAAOglB,IAEjCT,EAAWvkB,MAAQglB,EACnBP,EAAmBzkB,MAAQ,KAC3BwkB,EAAexkB,MAAQ,KACvB8C,EAAM9C,MAAQ,KACd0kB,EAAQ1kB,OAAQ,GACjB,CAAEilB,WAAW,IAChB,MAAMC,EAAwB,KAC1B,MAAMrhB,EAAK0gB,EAAWvkB,MAEtBwkB,EAAexkB,MAAQ,KACvBykB,EAAmBzkB,MAAQ,KAC3B8C,EAAM9C,MAAQ,KACT6D,GAAMA,IAAOygB,EAAkBtkB,OAIpC0kB,EAAQ1kB,OAAQ,EAChBmF,EAAON,MAAM,kBAAmB,yBAAyBhB,KACzDgQ,UAAU,sBAAuB,CAAEhQ,QAL/B6gB,EAAQ1kB,OAAQ,GAOlBmlB,EAAa,KACc,OAAzBX,EAAexkB,OAAkBwkB,EAAexkB,MAAQ,EACxD8C,EAAM9C,MAAQ,sBAIlBukB,EAAWvkB,MAAQ,KACnBykB,EAAmBzkB,MAAQ,KAC3B8C,EAAM9C,MAAQ,KACd0kB,EAAQ1kB,OAAQ,EAChBmF,EAAON,MAAM,kBAAmB,gCAAgC2f,EAAexkB,SAC/E6T,UAAU,uBAAwB,CAAE7D,WAAYwU,EAAexkB,UAE7DolB,EAAqB1d,IACvBgd,EAAQ1kB,OAAQ,EAChB,MAAMqlB,EAAe,CAACla,EAAQmH,KACtBnH,GACAsZ,EAAmBzkB,MAAQmL,EAE3BoZ,EAAWvkB,MAAQmL,EAAOtH,GAC1Bf,EAAM9C,MAAQ,OAGdykB,EAAmBzkB,MAAQ,KAC3B8C,EAAM9C,MAAQsS,IAGG,oBAArB5K,EAAO6M,WAAmC7M,EAAO8M,QAAQ3Q,KAAO0gB,EAAWvkB,MAC3EqlB,EAAa3d,EAAOyD,OAAQ,YAAYoZ,EAAWvkB,iBAEzB,qBAArB0H,EAAO6M,WAAoC7M,EAAO8M,QAAQxE,aAAewU,EAAexkB,OAC7FqlB,EAAa3d,EAAOyD,OAAQ,cAAcqZ,EAAexkB,kBAG3DslB,EAAqB,CAACzhB,EAAIhH,KAC5B,MACM8gB,EADQiH,EAAoB5kB,MAAMrH,OAClB,EAAIkE,EACpB0oB,EAAW1hB,IAAOygB,EAAkBtkB,MAC1C,IAAK6D,EACD,MAAO,MAAM8Z,UACjB,MACMuG,EAAQ,MAAMvG,SADJ9Z,EAAG6H,UAAU7H,EAAGlL,OAAS,MAEzC,OAAO4sB,EAAW,GAAGrB,SAAeA,GAQxC,OANA,KAAA3C,WAAU,KACNrL,QAAQ,kBAAmBkP,MAE/B,KAAAI,aAAY,KACRC,oBAAoB,kBAAmBL,KAEpC,CAACtE,EAAMC,MACF,mBAAc,yBAAoB,YAAW,KAAM,EACvD,yBAAoB,mCACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,wBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,iBACpBA,EAAO,KAAOA,EAAO,IAAK,yBAAoB,QAAS,CACnDlpB,GAAI,WACJ6tB,IAAK,cACLxF,MAAO,eACR,eAAgB,KACnB,yBAAoB,qBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,uBACpB,sBAAgB,yBAAoB,SAAU,CAC1CroB,GAAI,cACJ,sBAAuBkpB,EAAO,KAAOA,EAAO,GAAME,GAAY,EAAajhB,MAAQihB,GACnFf,MAAO,cACPyF,SAAUT,GACX,CACCnE,EAAO,KAAOA,EAAO,IAAK,yBAAoB,SAAU,CACpD/gB,MAAO,KACP2C,SAAU,IACX,gBAAiB,MACnB,iBAAW,IAAO,yBAAoB,YAAW,MAAM,iBAAYiiB,EAAoB5kB,MAAO,CAAC6D,EAAIhH,MACxF,mBAAc,yBAAoB,SAAU,CAChDuB,IAAKyF,GAAM,QAAQhH,IACnBmD,MAAO6D,GACR,EACC,uBAAiB,sBAAiByhB,EAAmBzhB,EAAIhH,IAAU,IAAK,IACxE,yBAAoB,aACrB,EAAe,MAClB,OACL,KAAuC,CACtC,CAAC,gBAAe0nB,EAAWvkB,gBAK3C,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,MAAO,GAAY,CACnC+gB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,QAAS,CACnDlpB,GAAI,YACJ6tB,IAAK,YACLxF,MAAO,eACR,WAAY,KACf,yBAAoB,MAAO,GAAY,EACnC,sBAAgB,yBAAoB,QAAS,CACzCroB,GAAI,YACJ,sBAAuBkpB,EAAO,KAAOA,EAAO,GAAME,GAAY,EAAiBjhB,MAAQihB,GACvFnlB,KAAM,SACNokB,MAAO,uBACPlC,YAAa,aACb4H,SAAS,eAAUT,EAAY,CAAC,WACjC,KAAM,KAAuC,CAC5C,CACI,cACAX,EAAexkB,WACf,EACA,CAAEM,QAAQ,OAGlB,yBAAoB,SAAU,CAC1B4f,MAAO,eACPc,QAASmE,GACV,YAIdT,EAAa,QACP,mBAAc,yBAAoB,MAAOP,GAAY,eACtD,yBAAoB,QAAQ,GACjCrhB,EAAW,QACL,mBAAc,yBAAoB,MAAOshB,IAAa,sBAAiBthB,EAAM9C,OAAQ,KACtF,yBAAoB,QAAQ,GACjC8kB,EAAiB,QACX,mBAAc,yBAAoB,YAAW,CAAE1mB,IAAK,GAAK,EACxD,kBAAaslB,GAAc,CACvBlD,MAAO,QACP,gBAAgB,GACjB,CACC7oB,SAAS,cAAS,IAAM,EACpB,kBAAakuB,GAAY,CACrBhiB,GAAIihB,EAAY9kB,MAAM6D,GACtB,aAAcihB,EAAY9kB,MAAMgQ,WAChC,UAAW+U,EAAsB/kB,OAClC,KAAM,EAAe,CAAC,KAAM,aAAc,cAEjDiH,EAAG,KAEP,kBAAa6e,GAAW,CACpBjC,OAAQc,EAAU3kB,MAClB,kBAAmB+gB,EAAO,KAAOA,EAAO,GAAME,GAAY,EAAYjhB,MAAQihB,GAC9E2C,KAAMA,GACP,CACCmC,MAAM,cAAS,IAAM,EACjB,kBAAapC,GAAkB,CAC3B3jB,MAAO8kB,EAAY9kB,MAAMkU,gBACzB,qBAAqB,EACrB,YAAa8R,KACd,KAAM,EAAe,CAAC,YAE7BC,MAAM,cAAS,IAAM,EACjB,kBAAatC,GAAkB,CAC3B3jB,MAAO8kB,EAAY9kB,MAAM8I,KACzB,qBAAqB,EACrB,YAAakd,KACd,KAAM,EAAe,CAAC,YAE7B/e,EAAG,GACJ,EAAe,CAAC,YACpB,MACD,yBAAoB,QAAQ,MAEvC,MAEX,I,KC1QJ,MAEA,GAFoB,GCHd,GAAa,CAAEiZ,MAAO,aACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CAAEA,MAAO,cACtB,GAAa,CAAEA,MAAO,yBACtB,GAAa,CACf9hB,IAAK,EACL8hB,MAAO,SAOX,IAA6B,sBAAiB,CAC1CK,OAAQ,WACRtiB,MAAO,CACHO,KAAM,CAAC,GAEX,KAAAkiB,CAAMC,GACF,MAAMxb,EAAS,IAAIrB,EAAO,kCAU1B,MAAO,CAACgd,EAAMC,MACF,mBAAc,yBAAoB,MAAO,GAAY,EACzD,yBAAoB,SAAU,GAAY,CACtCA,EAAO,KAAOA,EAAO,IAAK,yBAAoB,KAAM,CAAEb,MAAO,eAAiB,YAAa,KAC3F,yBAAoB,SAAU,CAC1BA,MAAO,YACP,aAAc,KACdc,QAASD,EAAO,KAAOA,EAAO,GAAME,IAAW,OAhBpCiF,EAgBuD,eAf9E/gB,EAAON,MAAM,oBAAqB,YAAYqhB,UAC1CC,OAAOC,gBACPD,OAAOC,gBAAgBF,GAGvB/gB,EAAOF,KAAK,oBAAqB,+BANf,IAACihB,KAiBZ,QAEP,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,MAAO,GAAY,CAClCvF,EAAY,OACN,mBAAc,yBAAoB,YAAW,CAAEviB,IAAK,GAAK,EACxD,kBAAaslB,GAAc,CACvBlD,MAAO,UACP,gBAAgB,GACjB,CACC7oB,SAAS,cAAS,IAAM,EACpB,kBAAakuB,GAAY,CACrBhiB,GAAI8c,EAAQniB,KAAKqF,GACjB,aAAc8c,EAAQniB,KAAKwR,YAC5B,KAAM,EAAe,CAAC,KAAM,iBAEnC/I,EAAG,KAEP,kBAAaof,GAAkB,CAAE7nB,KAAMmiB,EAAQniB,MAAQ,KAAM,EAAe,CAAC,UAC7E,kBAAa8nB,GAAiB,CAAE,cAAe3F,EAAQniB,MAAQ,KAAM,EAAe,CAAC,iBACtF,OACA,mBAAc,yBAAoB,MAAO,GAAY,iCAKhF,I,OC3DJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCFvE,IAA6B,sBAAiB,CAC1C+hB,OAAQ,eACRuD,MAAO,CAAC,SACR,KAAApD,CAAMC,GACa,IAAI7c,EAAO,sCAI1B,OAHA,KAAAyd,WAAU,QAGH,CAACT,EAAMC,MACF,mBAAc,yBAAoB,MAAO,CAC7Cb,MAAO,gBACPc,QAASD,EAAO,KAAOA,EAAO,GAAME,GAAYH,EAAKyF,MAAM,WAC5D,CACCxF,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAClDb,MAAO,WACP,cAAe,QAChB,OAAQ,KACX,yBAAoB,kBAGhC,I,OClBJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CACfA,MAAO,iBACPvQ,KAAM,gBACN,aAAc,UAElB,IAA6B,sBAAiB,CAC1C4Q,OAAQ,WACRG,MAAMC,GAEK,CAACG,EAAMC,MACF,mBAAc,yBAAoB,UAAW,GAAY,IAAKA,EAAO,KAAOA,EAAO,GAAK,EACxF,wBAAmB,ysBAA0tB,U,OCPjwB,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCNjE,GAA+ByF,O,eCErC,MAAM,GAAS,IAAI1iB,EAAO,uBAqBnBiF,eAAe0d,GACpBC,GAEA,IAAKC,kCAAmC,CACtC,MAAMC,EAAS,gBAEf,OADA,GAAO/hB,MAAM,uBAAwB+hB,GAC9B,CAAEC,SAAS,EAAOnjB,OAAQ,UAAWkjB,SAC9C,CAKA,GAHyBE,iBAAiB,CAAEC,MAAO,cACVjiB,KAAKkiB,GAASA,EAAMC,cAAgBP,EAAUO,aAIrF,OADA,GAAOpiB,MAAM,uBAAwB,OAAO6hB,EAAUO,6BAC/C,CAAEJ,SAAS,EAAMnjB,OAAQ,UAGlC,IAeE,OAdA,GAAOmB,MAAM,uBAAwB,UAAU6hB,EAAUO,kCACnDC,wBACJC,IAEEA,EAAQjvB,KAAK,IACRwuB,EACH7uB,GAAI,GACJkvB,MAAO,cAEFI,GAET,CAAEJ,MAAO,cAEX,GAAOliB,MAAM,uBAAwB,WAC9B,CAAEgiB,SAAS,EAAMnjB,OAAQ,WAClC,CAAE,MAAOZ,GACP,MAAM8jB,EAAS,SAASF,EAAUO,yBAElC,OADA,GAAOnkB,MAAM,uBAAwB8jB,EAAQ9jB,GACtC,CAAE+jB,SAAS,EAAOnjB,OAAQ,SAAUkjB,SAC7C,CACF,CChDO,MAAMQ,GAAyD,CACpEH,YAAa,aACbvkB,SAAS,EACT2kB,aAAa,EACbC,WAAY1iB,OAAOgG,GAAG,6JACtB2c,eAAgB,GAChB3a,OAAQ,CACN4a,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,YAAY,GAEdC,YAAa,CACXC,SAAS,EACTC,QAAQ,GAEVC,UAAW,KACXC,UAAW,MClBAC,GAA6D,CACxEhB,YAAa,cACbvkB,SAAS,EACT2kB,aAAa,EACbC,WAAY1iB,OAAOgG,GAAG,uJACtB2c,eAAgB,GAChB3a,OAAQ,CACN4a,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,YAAY,GAEdC,YAAa,CACXC,SAAS,EACTC,QAAQ,GAEVC,UAAW,KACXC,UAAW,MCjBAE,GAA6D,CACxEjB,YAAa,cACbvkB,SAAS,EACT2kB,aAAa,EACbC,WAAY1iB,OAAOgG,GAAG,qHACtB2c,eAAgB,GAChB3a,OAAQ,CACN4a,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,YAAY,GAEdC,YAAa,CACXC,SAAS,EACTC,QAAQ,GAEVC,UAAW,KACXC,UAAW,MCRN,MAAMG,GAA+D,CAC1ElB,YAAa,YACbvkB,SAAS,EACT2kB,aAAa,EACbC,WAAY,kCACZC,eAAgB,04WAChB3a,OAAQ,CACN4a,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,YAAY,GAEdC,YAAa,CACXC,SAAS,EACTC,QAAQ,GAEVC,UAAW,KACXC,UAAW,MC/BP,GAAS,IAAIlkB,EAAO,+BCH1B,MAAM,GAAS,IAAIA,EAAO,2BAoDnBiF,eAAeqf,GACpBC,EACAC,GAEA,MAAM5jB,EAAW,yBACjB,IAAK4jB,EAAS1G,KAAM,CAClB,MAAMgF,EAAS,wBAEf,OADA,GAAO9jB,MAAM4B,EAAUkiB,GAChB,CAAEC,SAAS,EAAOnjB,OAAQ,SAAUkjB,SAC7C,CAEA,MAAM2B,QArCDxf,eAAkCsf,EAAuBG,GAC9D,MAAM9jB,EAAW,qBACjB,IACE,GAAOG,MAAMH,EAAU,WAAW2jB,aAAyBG,SAC3D,MACMC,SADgBC,aAAaL,IACZvjB,KAAK6M,GAASA,EAAMiQ,OAAS4G,GAEpD,OADA,GAAO3jB,MAAMH,EAAU,YAAY2jB,MAAkBI,EAAS,KAAO,WAAWD,OACzEC,CACT,CAAE,MAAO3lB,GAEP,OADA,GAAOA,MAAM4B,EAAU,SAAS2jB,WAAwBvlB,IACjD,CACT,CACF,CAyB4B6lB,CAAmBN,EAAeC,EAAS1G,MACrE,GAAI2G,EAEF,OADA,GAAO1jB,MAAMH,EAAU,MAAM4jB,EAAS1G,gBAAgByG,aAC/C,CAAExB,SAAS,EAAMnjB,OAAQ,UAGlC,IAIE,OAHA,GAAOmB,MAAMH,EAAU,UAAU2jB,WAAuBC,EAAS1G,kBAC3DgH,uBAAuBP,EAAe,CAACC,IAC7C,GAAOzjB,MAAMH,EAAU,UAAU2jB,WAAuBC,EAAS1G,UAC1D,CAAEiF,SAAS,EAAMnjB,OAAQ,WAClC,CAAE,MAAOZ,GACP,MAAM8jB,EAAS,QAAQyB,UAAsBC,EAAS1G,cAEtD,OADA,GAAO9e,MAAM4B,EAAUkiB,EAAQ9jB,GACxB,CAAE+jB,SAAS,EAAOnjB,OAAQ,SAAUkjB,SAC7C,CACF,C,MC9EaiC,GAAwD,CACnEjH,KAH+C,aAI/CnqB,Q,o9DACAiL,SAAS,EACTomB,SAAU,CACRhtB,KAAM,WACNkO,KAAM,GACN+e,eAAgB,CACdC,MAAO,UACPhf,KAAM,IAERif,WAAY,kBAEdC,SAAU,CACRptB,KAAM,WACN6T,KAAM,SACNwZ,MAAO,EACPC,MAAO,MAETC,YAAa,IACbC,UAAW,CACTC,kBAAkB,EAClBC,kBAAkB,EAClBC,YAAa,MAEfC,OAAQ,CACNC,OAAQ,KACRC,SAAU,KACVnM,MAAO,OC5BEoM,GAAiD,CAC5DjI,KAHuC,aAIvCnqB,Q,gDACAiL,SAAS,EACTomB,SAAU,CACRhtB,KAAM,WACNkO,KAAM,GACN+e,eAAgB,CACdC,MAAO,UACPhf,KAAM,IAERif,WAAY,kBAEdC,SAAU,CACRptB,KAAM,WACN6T,KAAM,SACNwZ,MAAO,EACPC,MAAO,MAETC,YAAa,IACbC,UAAW,CACTC,kBAAkB,EAClBC,kBAAkB,EAClBC,YAAa,MAEfC,OAAQ,CACNC,OAAQ,KACRC,SAAU,KACVnM,MAAO,OC5BL,GAAS,IAAI3Z,EAAO,mCAgBnBiF,eAAe+gB,KACpB,MAAMplB,EAAW,0BACjB,GAAOtB,IAAIsB,EAAU,eAErB,IACIqlB,SADuBC,sBAAsB,YACXC,QAEtC,GAAKF,EAUH,GAAOllB,MAAMH,EAAU,YAAYqlB,UAVd,CACrB,GAAO9kB,KAAKP,EAAU,+BACtB,IACEqlB,QH0DChhB,iBACL,MAAMrE,EAAW,gCACX2jB,EAAgB,YACtB,GAAOxjB,MAAMH,EAAU,aAAa2jB,eAC9B6B,gBAAgB7B,GAEtB,MAAM8B,QAAuBH,sBAAsB,WAOnD,OANAG,EAAeF,QAAU5B,EAEzB,GAAOxjB,MAAMH,EAAU,WAAW2jB,4BAC5B+B,qBAAqB,UAAWD,GAEtC,GAAOtlB,MAAMH,EAAU,YAChB2jB,CACT,CGxE+BgC,EAC3B,CAAE,MAAOvnB,GACP,MAAM8jB,EAAS,eAEf,OADA,GAAO9jB,MAAM4B,EAAUkiB,EAAQ9jB,GACxB,CAAE+jB,SAAS,EAAOD,SAAQ0D,QAAS,GAC5C,CACF,CAIA,MAAMC,EAAkB,CAAC1B,GAA0BgB,IAC7CrW,EAAU,GAChB,IAAIgX,GAAa,EAEjB,IAAK,MAAM7Y,KAAS4Y,EAAiB,CACnC,IAAK5Y,EAAMiQ,KAAM,CACf,GAAO3c,KAAKP,EAAU,sBAAuBiN,GAC7C,QACF,CACA,MAAMxG,QAAeid,GAAuB2B,EAAkBpY,GAC9D6B,EAAQtb,KAAK,CACXswB,UAAW7W,EAAMiQ,KACjBle,OAAQyH,EAAOzH,OACfkjB,OAAQzb,EAAOyb,SAEZzb,EAAO0b,UACV2D,GAAa,EAEjB,CAGA,OADA,GAAOpnB,IAAIsB,EAAU,aACd,CAAEmiB,QAAS2D,EAAYF,QAAS9W,EACzC,CC7DA,MAAM,GAAa,CACf0M,MAAO,sBACPvQ,KAAM,gBACN,aAAc,YAEZ,GAAa,CAAEuQ,MAAO,QACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CAAEA,MAAO,aACtB,GAAa,CAAEA,MAAO,aAK5B,IAA6B,sBAAiB,CAC1CK,OAAQ,gBACR,KAAAG,CAAMC,GACF,MAAMxb,EAAS,IAAIrB,EAAO,wDAC1BiF,eAAe0hB,IACXtlB,EAAO/B,IAAI,gBAAiB,yBAC5B,IAEI,IACI,MAAMsnB,EAAe5a,gBAAgB,GACrC,IAAK4a,GAAwC,IAAxBA,EAAa/xB,OAC9B,MAAM,IAAIuB,MAAM,oBAExB,CACA,MAAO0I,GAGH,OAFA,WAAa,cAAe,0BAC5BuC,EAAOF,KAAK,gBAAiB,2BAA4BrC,EAE7D,CAEA,MAAM+nB,QLPf5hB,iBACL,IAAK4d,kCAAmC,CACtC,MAAMC,EAAS,4BAEf,OADA,GAAO3hB,KAAK,0BAA2B2hB,GAChC,CAAEC,SAAS,EAAOD,SAAQ0D,QAAS,GAC5C,CAEA,MAAMM,EAAkB,CACtBxD,GACAe,GACAF,GACAC,IAEI1U,EAAU,GAChB,IAAIgX,GAAa,EAEjB,IAAK,MAAMxD,KAAS4D,EAAiB,CACnC,MAAMzf,QAAesb,GAAqBO,GAC1CxT,EAAQtb,KAAK,CACX2yB,UAAW7D,EAAMC,YACjBvjB,OAAQyH,EAAOzH,OACfkjB,OAAQzb,EAAOyb,SAEZzb,EAAO0b,UACV2D,GAAa,EAEjB,CAEA,MAAO,CAAE3D,QAAS2D,EAAYF,QAAS9W,EACzC,CKtB0CsX,GAC1B,IAAKH,EAAY9D,QAGb,OAFA,WAAa8D,EAAY/D,QAAU,OAAQ,gBAC3CzhB,EAAOrC,MAAM,gBAAiB,UAAW6nB,EAAY/D,QAGpD,CACD,MAAMmE,EAAgBJ,EAAYL,QAAQvtB,OAAOkC,GAAkB,aAAbA,EAAEyE,QAAuB/K,OACzEqyB,EAAcL,EAAYL,QAAQvtB,OAAOkC,GAAkB,WAAbA,EAAEyE,QAAqB/K,OAC3E,IAAIgM,EAAU,GACVomB,EAAgB,IAChBpmB,GAAW,QAAQomB,WAEnBC,EAAc,IACdrmB,GAAW,IAAIqmB,aAEfrmB,GACA,aAAeA,EAAQkH,OAAQ,UAEvC,CAEA,MAAMof,QAAwBnB,KAC9B,GAAKmB,EAAgBpE,QAIhB,CACD,MAAMkE,EAAgBE,EAAgBX,QAAQvtB,OAAOkC,GAAkB,aAAbA,EAAEyE,QAAuB/K,OAC7EqyB,EAAcC,EAAgBX,QAAQvtB,OAAOkC,GAAkB,WAAbA,EAAEyE,QAAqB/K,OAC/E,IAAIgM,EAAU,GACVomB,EAAgB,IAChBpmB,GAAW,QAAQomB,WAEnBC,EAAc,IACdrmB,GAAW,IAAIqmB,aAEnB,aAAermB,EAAQkH,OAAQ,WACnC,MAdI,WAAaof,EAAgBrE,QAAU,kBAAmB,YAC1DzhB,EAAOrC,MAAM,gBAAiB,WAAYmoB,GAc9C9lB,EAAO/B,IAAI,gBAAiB,WAChC,CACA,MAAON,GACHqC,EAAOrC,MAAM,gBAAiB,gBAAiBA,GAC/C,WAAa,uBAAwB,QACzC,CACJ,CACA,SAASooB,IAEL/lB,EAAO/B,IAAI,aAAc,sCACzB,IACIyQ,UAAU,oBACV,aAAe,iBAAkB,OACrC,CACA,MAAO/Q,GACHqC,EAAOrC,MAAM,aAAc,6BAA8BA,GACzD,WAAa,iBAAkB,OACnC,CACJ,CACA,SAASqoB,IAELhmB,EAAO/B,IAAI,aAAc,mCACzB,IACIyQ,UAAU,eACV,aAAe,mBAAoB,OACvC,CACA,MAAO/Q,GACHqC,EAAOrC,MAAM,aAAc,wBAAyBA,GACpD,WAAa,iBAAkB,OACnC,CACJ,CACA,MAAO,CAACge,EAAMC,MACF,mBAAc,yBAAoB,YAAW,KAAM,EACvD,yBAAoB,2BACpB,yBAAoB,UAAW,GAAY,EACvC,yBAAoB,gBACpBA,EAAO,KAAOA,EAAO,IAAK,yBAAoB,KAAM,CAAEb,MAAO,cAAgB,QAAS,KACtF,yBAAoB,gBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,iBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,SAAU,CAC1BA,MAAO,cACPM,MAAO,WACPQ,SAAS,oBAAekK,EAAY,CAAC,UACtC,EACC,yBAAoB,cACpBnK,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAClDb,MAAO,MACP,cAAe,QAChB,MAAO,KACV,yBAAoB,aACpBa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,UAAW,KACrF,yBAAoB,eAExBa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,IAAK,CAAEb,MAAO,YAAc,iEAAkE,OAEhJ,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,SAAU,CAC1BA,MAAO,aACPM,MAAO,aACPQ,SAAS,oBAAemK,EAAY,CAAC,UACtC,EACC,yBAAoB,cACpBpK,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAClDb,MAAO,MACP,cAAe,QAChB,MAAO,KACV,yBAAoB,aACpBa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,YAAa,KACvF,yBAAoB,eAExBa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,IAAK,CAAEb,MAAO,YAAc,iGAAkG,OAEhL,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,SAAU,CAC1BA,MAAO,aACPM,MAAO,gBACPQ,SAAS,oBAAeyJ,EAAe,CAAC,UACzC,IAAK1J,EAAO,KAAOA,EAAO,GAAK,EAC1B,yBAAoB,OAAQ,CACxBb,MAAO,MACP,cAAe,QAChB,MAAO,IACV,yBAAoB,OAAQ,CAAEA,MAAO,SAAW,aAAc,OAEtEa,EAAO,KAAOA,EAAO,IAAK,yBAAoB,IAAK,CAAEb,MAAO,YAAc,EACtE,sBAAiB,iCACjB,yBAAoB,OACpB,sBAAiB,mCACjB,yBAAoB,OACpB,sBAAiB,kCACjB,yBAAoB,OACpB,sBAAiB,iDACjB,yBAAoB,OACpB,sBAAiB,0CACjB,yBAAoB,OACpB,sBAAiB,yCACjB,yBAAoB,OACpB,sBAAiB,iCACjB,yBAAoB,OACpB,sBAAiB,kDACjB,yBAAoB,OACpB,sBAAiB,mDACjB,WAIjB,MAEX,I,OCjLJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CACfA,MAAO,gBACPvQ,KAAM,SACN,aAAc,UAEZ,GAAa,CAAC,iBACd,GAAa,CACfuQ,MAAO,OACP,cAAe,QAEb,GAAa,CAAEA,MAAO,WACtB,GAAa,CAAEA,MAAO,WACtB,GAAa,CAAEA,MAAO,QACtB,GAAa,CAAC,SACd,GAAa,CAAEA,MAAO,cACtB,GAAa,CACf9hB,IAAK,EACL8hB,MAAO,UAEL,GAAc,CAAC,uBACfkL,GAAc,CAAC,sBAAuB,eACtCC,GAAc,CAAC,sBAAuB,eACtCC,GAAc,CAAC,sBAAuB,cAAe,WACrDC,GAAc,CAAErL,MAAO,aAK7B,IAA6B,sBAAiB,CAC1CK,OAAQ,mBACR,KAAAG,CAAMC,GAMF,MAAMxb,EAAS,IAAIrB,EAAO,2DAEpB0nB,GAAS,KAAA3K,MAAI,GAEb4K,GAAO,KAAA5K,KAAI,IACXzH,GAAQ,KAAAsS,UAAS,CAAC,GAClBC,GAAc,KAAAD,UAAS,CAAC,GACxBE,GAAY,KAAAF,UAAS,CAAC,GAgB5B,SAASG,EAAc1iB,GAEnB,IACI,OAAOtL,KAAKC,UAAUqL,EAAG,KAAM,EACnC,CACA,MACI,OAAOvE,OAAOuE,EAClB,CACJ,CAEA,SAAS2iB,IACL,IACI3mB,EAAON,MAAM,WAAY,eACzB,MAAM7I,EAAMsN,IAEZ,GADAnE,EAAON,MAAM,WAAY,YAAa7I,IACjCA,GAAmC,IAA5BqD,OAAO2K,KAAKhO,GAAKrD,OAIzB,OAHAwM,EAAOF,KAAK,WAAY,qBACxBwmB,EAAKzrB,MAAQ,QACb,UAAY,cAIhByrB,EAAKzrB,MAAQ,GACb,IAAK,MAAM3G,KAAKgG,OAAO2K,KAAKoP,UACjBA,EAAM/f,GACjB,IAAK,MAAMA,KAAKgG,OAAO2K,KAAK2hB,UACjBA,EAAYtyB,GACvB,IAAK,MAAMA,KAAKgG,OAAO2K,KAAK4hB,UACjBA,EAAUvyB,GAErBgG,OAAO0sB,QAAQ/vB,GACVe,OAAO,EAAEqB,KAAiB,UAARA,GAClBoK,QAAQ,EAAEpK,EAAK4B,MAChB,MAAMkM,EA7CG,kBAFD/C,EA+CanJ,GA5ClB,UACM,iBAANmJ,GAAkB+F,OAAO8c,SAAS7iB,GAClC,SACM,iBAANA,EACA,SACJ,OARX,IAAoBA,EAgDRsiB,EAAKzrB,MAAM9H,KAAK,CAAEkG,MAAK4B,QAAOlE,KAAMoQ,IAC1B,SAANA,EACAyf,EAAYvtB,GAAOytB,EAAc7rB,GAGjCoZ,EAAMhb,GAAO4B,IAGrB,aAAe,iBAAkB,OACrC,CACA,MAAO4C,GACHuC,EAAOrC,MAAM,WAAY,YAAaF,GACtC,WAAa,yBAA0B,OAC3C,CACJ,CAEA,SAASqpB,IAELT,EAAOxrB,OAASwrB,EAAOxrB,MACnBwrB,EAAOxrB,OAA+B,IAAtByrB,EAAKzrB,MAAMrH,QAC3BmzB,GACR,CAoBA,SAASI,IAEL/mB,EAAO/B,IAAI,eAAgB,YAC3B0oB,IACA,UAAY,gBAAiB,OACjC,CAEA/iB,eAAeojB,IAEX,UACUziB,EAAqBC,IACvB,MAAMpD,EAAO,IAAKoD,GAelB,OAbAtK,OAAO0sB,QAAQ3S,GAAO5Q,QAAQ,EAAEnP,EAAG8P,MAE/B5C,EADYlN,GACA8P,IAGhB9J,OAAO0sB,QAAQJ,GAAanjB,QAAQ,EAAEnP,EAAG+yB,MACrC,GAAW,MAAPA,EAAa,CACb,GAAIR,EAAUvyB,IAAIgzB,IACd,MAAM,IAAInyB,MAAM,KAAKb,kBAEzBkN,EADYlN,GACAwE,KAAKyE,MAAM8pB,EAC3B,IAEG7lB,IAEXpB,EAAO/B,IAAI,YAAa,WACxB,aAAe,gBAAiB,QAChC+iB,OAAOmG,cAAc,IAAIC,YAAY,yBACrCT,GACJ,CACA,MAAOlpB,GACHuC,EAAOrC,MAAM,YAAa,QAASF,GACnC,WAAa,QAAQA,GAAG+B,SAAW/B,IAAK,OAC5C,CACJ,CACA,MAAO,CAACke,EAAMC,MACF,mBAAc,yBAAoB,YAAW,KAAM,EACvD,yBAAoB,4CACpB,yBAAoB,UAAW,GAAY,EACvC,yBAAoB,aACpB,yBAAoB,mBACpB,yBAAoB,SAAU,CAC1Bb,MAAO,cACP,gBAAiBsL,EAAOxrB,MACxBghB,QAASiL,GACV,EACC,yBAAoB,cACpBlL,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,UAAW,KACrF,yBAAoB,WACpB,yBAAoB,OAAQ,IAAY,sBAAiBsL,EAAOxrB,MAAQ,IAAM,KAAM,IACpF,yBAAoB,WACrB,EAAe,KAClB,yBAAoB,4BACpB,sBAAgB,yBAAoB,MAAO,GAAY,EACnD,yBAAoB,aACpB,yBAAoB,uBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,UACpB,yBAAoB,SAAU,CAC1BkgB,MAAO,WACPM,MAAO,WACPQ,SAAS,oBAAe8K,EAAU,CAAC,UACpC,YACH,yBAAoB,UACpB/K,EAAO,KAAOA,EAAO,IAAK,yBAAoB,MAAO,CAAEb,MAAO,UAAY,MAAO,KACjF,yBAAoB,WACpB,yBAAoB,SAAU,CAC1BA,MAAO,kBACPM,MAAO,WACPQ,SAAS,oBAAekL,EAAc,CAAC,UACxC,YACH,yBAAoB,WACpB,yBAAoB,SAAU,CAC1BhM,MAAO,mBACPM,MAAO,YACPQ,SAAS,oBAAemL,EAAW,CAAC,UACrC,YACH,yBAAoB,aAExB,yBAAoB,gBACpB,yBAAoB,MAAO,GAAY,CAClCV,EAAKzrB,MAAMrH,OAAS,IACd,mBAAc,yBAAoB,YAAW,CAAEyF,IAAK,GAAK,EACxD,yBAAoB,gBACnB,iBAAW,IAAO,yBAAoB,YAAW,MAAM,iBAAYqtB,EAAKzrB,MAAQwsB,IAC7E,OAAQ,mBAAc,yBAAoB,MAAO,CAC7CpuB,IAAKouB,EAAIpuB,IACT8hB,MAAO,WACR,EACC,yBAAoB,aACpB,yBAAoB,QAAS,CACzBA,MAAO,UACPM,MAAOgM,EAAIpuB,MACZ,sBAAiBouB,EAAIpuB,KAAM,EAAqB,KACnD,yBAAoB,UACpB,yBAAoB,sBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,YACpB,yBAAoB,YACN,YAAbouB,EAAI1wB,OACE,mBAAc,yBAAoB,QAAS,GAAY,EACtD,yBAAoB,cACpB,sBAAgB,yBAAoB,QAAS,CACzC,sBAAwBmlB,GAAa7H,EAAMoT,EAAIpuB,KAAQ6iB,EACvDnlB,KAAM,YACP,KAAM,EAAe,IAAc,CAClC,CAAC,kBAAiBsd,EAAMoT,EAAIpuB,SAEhC,yBAAoB,SACpB2iB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,OAAQ,CAAEb,MAAO,SAAW,MAAO,KACjF,yBAAoB,WAER,WAAbsM,EAAI1wB,OACA,mBAAc,yBAAoB,YAAW,CAAEsC,IAAK,GAAK,EACxD,yBAAoB,mBACpB,sBAAgB,yBAAoB,QAAS,CACzC,sBAAwB6iB,GAAa7H,EAAMoT,EAAIpuB,KAAQ6iB,EACvDnlB,KAAM,SACNokB,MAAO,MACPlC,YAAapZ,OAAO4nB,EAAIxsB,QACzB,KAAM,EAAeorB,IAAc,CAClC,CACI,cACAhS,EAAMoT,EAAIpuB,UACV,EACA,CAAEkC,QAAQ,OAGlB,yBAAoB,WACrB,KACa,WAAbksB,EAAI1wB,OACA,mBAAc,yBAAoB,YAAW,CAAEsC,IAAK,GAAK,EACxD,yBAAoB,kBACpB,sBAAgB,yBAAoB,QAAS,CACzC,sBAAwB6iB,GAAa7H,EAAMoT,EAAIpuB,KAAQ6iB,EACvDnlB,KAAM,OACNokB,MAAO,MACPlC,YAAapZ,OAAO4nB,EAAIxsB,QACzB,KAAM,EAAeqrB,IAAc,CAClC,CAAC,cAAajS,EAAMoT,EAAIpuB,SAE5B,yBAAoB,WACrB,OACA,mBAAc,yBAAoB,YAAW,CAAEA,IAAK,GAAK,EACxD,yBAAoB,iCACpB,sBAAgB,yBAAoB,WAAY,CAC5C,sBAAwB6iB,GAAa0K,EAAYa,EAAIpuB,KAAQ6iB,EAC7Df,MAAO,SACPlC,YAAa6N,EAAcW,EAAIxsB,OAC/BysB,QAAUxL,GA1KtE,SAAyB7iB,GAErB,MAAMguB,EAAMT,EAAYvtB,IAAQ,GAChC,GAAmB,KAAfguB,EAAIvgB,OAKR,IACIhO,KAAKyE,MAAM8pB,GACXR,EAAUxtB,GAAO,CAAEsuB,IAAI,EAAML,KAAK,EAAOvd,IAAK,YAClD,CACA,MAAOlM,GAEHgpB,EAAUxtB,GAAO,CAAEiuB,KAAK,EAAMK,IAAI,EAAO5d,IAAK,aAAalM,GAAG+B,SAAW,KAC7E,MAVIinB,EAAUxtB,GAAO,CAAEiuB,KAAK,EAAMK,IAAI,EAAO5d,IAAK,0BAWtD,CA0JiF,CAAiB0d,EAAIpuB,MAC3C,KAAM,GAAgCktB,IAAc,CACnD,CAAC,cAAaK,EAAYa,EAAIpuB,SAElC,yBAAoB,eACpB,yBAAoB,OAAQ,CACxB8hB,OAAO,qBAAgB,CAAC,OAAQ,CAAEwM,GAAId,EAAUY,EAAIpuB,MAAMsuB,GAAIL,IAAKT,EAAUY,EAAIpuB,MAAMiuB,SACxF,sBAAiBT,EAAUY,EAAIpuB,MAAM0Q,KAAO,iBAAkB,IACjE,yBAAoB,gBACrB,QAEnB,yBAAoB,WACpB,yBAAoB,OAAQyc,IAAa,uBAnP1Drf,EAmPqFsgB,EAAI1wB,KAjP3F,YAANoQ,EAAkB,KAAa,WAANA,EAAiB,KAAa,WAANA,EAAiB,MAAQ,SAiP+B,IAChF,yBAAoB,YApPxD,IAAmBA,IAsPa,OACL,OACA,mBAAc,yBAAoB,YAAW,CAAE9N,IAAK,GAAK,EACxD,yBAAoB,cACpB2iB,EAAO,KAAOA,EAAO,IAAK,yBAAoB,MAAO,CAAEb,MAAO,eAAiB,EAC3E,yBAAoB,IAAK,KAAM,gBAC/B,yBAAoB,WACpB,yBAAoB,IAAK,CAAEA,MAAO,OAAS,EACvC,sBAAiB,YACjB,yBAAoB,OAAQ,KAAM,cAClC,sBAAiB,eACjB,yBAAoB,OAAQ,KAAM,iCAClC,sBAAiB,gBAErB,yBAAoB,YACpB,KACL,QAEZ,KAAuB,CACtB,CAAC,SAAQsL,EAAOxrB,YAGzB,MAEX,I,OCjUJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEkgB,MAAO,cACtB,GAAa,CAAEA,MAAO,8BAI5B,IAA6B,sBAAiB,CAC1CK,OAAQ,YACRG,MAAMC,GACK,CAACG,EAAMC,MACF,mBAAc,yBAAoB,QAAS,GAAY,EAC3D,yBAAoB,MAAO,GAAY,EACnC,kBAAa4L,KACb,kBAAaC,KACb,kBAAaC,W,OCTjC,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJvE,IAA6B,sBAAiB,CAC1CtM,OAAQ,eACRG,MAAK,CAACC,GAAWmM,OAAQC,MAGrBA,EAAS,CACLC,YAHe,KAAAnM,MAAI,KAKhB,U,OCLf,MAEA,GAFoB,GCDPoM,GAAa,EAAY,KAAM,KAC1C,MAAMC,GAAc,KAAArM,KAAqC,gBACnDsM,GAAY,KAAAtM,KAA6B,MAY/C,MAAO,CACLqM,cACAC,YACAC,WAbF,SAAoBlH,GACdgH,EAAYltB,QAAUkmB,IACxBgH,EAAYltB,MAAQkmB,EAExB,EAUEmH,aARF,SAAsB7uB,GACpB2uB,EAAUntB,MAAQxB,CACpB,KCdI,GAAa,CAAE0hB,MAAO,sBACtB,GAAa,CAAEA,MAAO,aAU5B,IAA6B,sBAAiB,CAC1CK,OAAQ,MACR,KAAAG,CAAMC,GACF,MAAMxb,EAAS,IAAIrB,EAAO,kBAEpBwpB,EAAUL,MACRC,YAAaK,EAAkBJ,UAAWK,GAAY,EAAYF,GAEpEG,GAAe,KAAA5M,KAAI,MACnBmM,GAAa,KAAAnM,MAAI,GACjB6M,EAAmB,KACrB,IACI,MAAMlc,EAAWlI,IACXqkB,EAAgBnc,IAAW,YAAa,EAC9Cwb,EAAWhtB,MAAQ2tB,EACfF,EAAaztB,QACbytB,EAAaztB,MAAMgtB,WAAaW,GAEpCxoB,EAAON,MAAM,mBAAoB,YAAW8oB,EAAgB,OAAS,SACzE,CACA,MAAO/qB,GACHuC,EAAOrC,MAAM,mBAAoB,WAAYF,GAC7CoqB,EAAWhtB,OAAQ,CACvB,IAEJ,KAAAuhB,WAAU,KACNmM,IACAvH,OAAOyH,iBAAiB,uBAAwBF,MAEpD,KAAAG,iBAAgB,KACZ1H,OAAO2H,oBAAoB,uBAAwBJ,KAMvD,MAAO,CAAC5M,EAAMC,MACF,mBAAc,yBAAoB,MAAO,CAC7Cb,OAAO,qBAAgB,CAAC,oBAAqB,CAAE,aAAc8M,EAAWhtB,UACzE,EACC,kBAAa+tB,GAAc,CACvBC,QAAS,eACTnN,IAAK4M,GACN,KAAM,MACT,sBAAgB,kBAAaQ,GAAc,CACvCjN,QAASD,EAAO,KAAOA,EAAO,GAAME,IAAW,OAbhCiF,EAamD,eAZ1E/gB,EAAON,MAAM,oBAAqB,YAAYqhB,UAC9CoH,EAAQF,WAAWlH,GAFG,IAACA,KAchB,KAAM,KAAuB,CAC5B,CAAC,SAAqC,kBAA7B,YAAOqH,OAEpB,sBAAgB,yBAAoB,MAAO,GAAY,EACnD,yBAAoB,oBACpB,yBAAoB,MAAO,GAAY,EACnC,yBAAoB,wBACpB,kBAAaW,GAAU,CAAE1vB,MAAM,YAAOgvB,IAAY,KAAM,EAAe,CAAC,UACxE,kBAAaW,OAElB,KAAuB,CACtB,CAAC,SAAqC,kBAA7B,YAAOZ,OAErB,GAEX,I,cCnEJ,MAEA,IAFiC,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBCCvE,MAAM,GAAS,IAAIzpB,EAAO,cAC1B,IAAIsqB,GAAwB,KACxBC,GAA4C,KA2BhD,SAASC,KACP,GAAOlrB,IAAI,WAAY,aARnBgrB,KACF,GAAOvpB,MAAM,gBAAiB,aAC9BupB,GAAOG,UACPH,GAAS,MCVX3c,EAAE,yBAAyBhI,mBAAmBvN,SDkB1CmyB,KACF,GAAOxpB,MAAM,WAAY,SChC3B4M,EAAE,0BAA0BhI,iBAAiBvN,SDkC3CmyB,GAAa,MAGflI,OAAO2H,oBAAoB,WAAYQ,IACvC,GAAOlrB,IAAI,WAAY,YACzB,CAtBC+iB,OAAeC,gBAXhB,SAAoBF,GAClB,GAAOrhB,MAAM,aAAc,YAAYqhB,KAElCC,OAAeqI,WACjBrI,OAAeqI,WAAWpB,WAAWlH,GAEtC,GAAOjhB,KAAK,aAAc,gBAE9B,EA4BAwM,EAAE,KAEA,IAA0B,IADTnI,IACJ,SAGX,OAFA,GAAOlG,IAAI,aAAc,2BACzBkrB,KAGF,GAAOlrB,IAAI,aAAc,cAEzBirB,GC5DO5c,EAAE,SAASgd,KAAK,KAAM,sBAAsBhlB,iBAAiB7P,IAAI,CACtEsvB,SAAU,QACVwF,OAAQ,OACRC,KAAM,OACN,UAAW,MDyDb,GAAO9pB,MAAM,oBAAqB,QAASwpB,IAG3C5c,EAAE,QAAQmd,OAAOP,IACjB,GAAOxpB,MAAM,oBAAqB,gBAGlCupB,IAAS,KAAAS,WAAUC,IACnB,MAAMC,EAAQ,IACdX,GAAOY,IAAID,GACXX,GAAOa,MAAMZ,GAAW,IAGxB,MAAMf,EAAUL,GAAW8B,GAC1B5I,OAAeqI,WAAalB,EC/DxB,WACL,MAAM4B,EAAWzlB,cAEjBgI,EAAE,yBAAyByd,OAAchzB,SAEzC,MAAMizB,EAAO1d,EAAE,SAASgd,KAAK,YAAaS,GAAUN,OAAOnd,EAAEzX,UAAUqK,KAAK,gBAAgB+qB,SAC5F3d,EAAE,QAAQmd,OAAOO,EACnB,CD2DEE,GACA,GAAOxqB,MAAM,aAAc,qBAG3BqR,QAAQ,gBAAkB1X,IACxB,GAAO4E,IAAI,gBAAiB,gCAAiC5E,GAC7D8uB,EAAQD,aAAa7uB,KAEvB,GAAOqG,MAAM,oBAAqB,2BAGlCshB,OAAO2H,oBAAoB,WAAYQ,IACvCnI,OAAOyH,iBAAiB,WAAYU,MEzDf,IAClBlpB,EAAaC,QACbD,EAAaI,QACbJ,EAAaS,OACbT,EAAaW,kBACbX,EAAaa,uBACbb,EAAae,gBAKHqC,QAAQ8mB,IAGrBpZ,QAAQoZ,EAAK5nB,GAAgBwX,GAAYoQ,EAAI5nB,MAK/CwO,QAAQqZ,eAAe,UAAW,IAAMrQ,GAAY,iBACpDhJ,QAAQqZ,eAAe,UAAW,IAAMrQ,GAAY,gBACpDhJ,QAAQqZ,eAAe,UAAW,IAAMrQ,GAAY","sources":["webpack://tavern_helper_template/src/ERA变量框架/ui/components/SnapshotManager.vue?a168","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/AboutEra.vue?cfc3","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js","webpack://tavern_helper_template/src/ERA变量框架/ui/template/EraAccordion.vue?4a48","webpack://tavern_helper_template/src/ERA变量框架/ui/template/PrettyJsonViewer.vue?2547","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanel.vue?05cc","webpack://tavern_helper_template/src/ERA变量框架/ui/template/JsonNode.vue?7369","webpack://tavern_helper_template/src/ERA变量框架/ui/App.vue?ed69","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/ActionButtons.vue?dc0d","webpack://tavern_helper_template/src/ERA变量框架/ui/App.vue?710e","webpack://tavern_helper_template/src/ERA变量框架/ui/App.vue?a729","webpack://tavern_helper_template/src/ERA变量框架/ui/template/EraAccordion.vue?6821","webpack://tavern_helper_template/src/ERA变量框架/ui/components/FloatingBall.vue?ab9d","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/OperationDetails.vue?b6dc","webpack://tavern_helper_template/src/ERA变量框架/ui/components/SnapshotManager.vue?7212","webpack://tavern_helper_template/src/ERA变量框架/ui/App.vue?cfc8","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/MetaHeader.vue?7c1d","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/AboutEra.vue?999a","webpack://tavern_helper_template/src/ERA变量框架/ui/template/TabSwitch.vue?d993","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/ActionButtons.vue?c9d9","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/MetaHeader.vue?ac5c","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/OperationDetails.vue?3657","webpack://tavern_helper_template/src/ERA变量框架/ui/template/TabSwitch.vue?e1f5","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/EraSettingsPanel.vue?0da0","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/EraSettingsPanel.vue?9488","webpack://tavern_helper_template/src/ERA变量框架/ui/template/PrettyJsonViewer.vue?4f2e","webpack://tavern_helper_template/src/ERA变量框架/ui/components/ThemeManager.vue?137a","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src/ERA变量框架/ui/template/JsonNode.vue?12f0","webpack://tavern_helper_template/src/ERA变量框架/ui/components/ThemeManager.vue?e320","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRail.vue?378d","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanel.vue?e93e","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRail.vue?5240","webpack://tavern_helper_template/src/ERA变量框架/ui/components/FloatingBall.vue?deba","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/ERA变量框架/utils/constants.ts","src://tavern_helper_template/src/ERA变量框架/utils/log.ts","src://tavern_helper_template/src/ERA变量框架/events/merger.ts","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/ERA变量框架/utils/era_data.ts","src://tavern_helper_template/src/ERA变量框架/utils/data.ts","src://tavern_helper_template/src/ERA变量框架/utils/string.ts","src://tavern_helper_template/src/ERA变量框架/utils/text.ts","src://tavern_helper_template/src/ERA变量框架/utils/message.ts","src://tavern_helper_template/src/ERA变量框架/core/key/mk.ts","src://tavern_helper_template/src/ERA变量框架/initer/auto/settings.ts","src://tavern_helper_template/src/ERA变量框架/macro/placeholder.ts","src://tavern_helper_template/src/ERA变量框架/core/timetravel.ts","src://tavern_helper_template/src/ERA变量框架/core/snapshot.ts","src://tavern_helper_template/src/ERA变量框架/events/emitters/events.ts","src://tavern_helper_template/src/ERA变量框架/events/handlers/api/handler.ts","src://tavern_helper_template/src/ERA变量框架/events/handlers/api/dispatcher.ts","src://tavern_helper_template/src/ERA变量框架/core/crud/delete.ts","src://tavern_helper_template/src/ERA变量框架/core/crud/insert/template.ts","src://tavern_helper_template/src/ERA变量框架/core/crud/insert/insert.ts","src://tavern_helper_template/src/ERA变量框架/core/crud/update.ts","src://tavern_helper_template/src/ERA变量框架/core/crud/patcher.ts","src://tavern_helper_template/src/ERA变量框架/core/sync.ts","src://tavern_helper_template/src/ERA变量框架/ui/patch.ts","src://tavern_helper_template/src/ERA变量框架/events/handlers/sync.ts","src://tavern_helper_template/src/ERA变量框架/events/dispatcher.ts","src://tavern_helper_template/src/ERA变量框架/events/handlers/updateMkOnly.ts","src://tavern_helper_template/src/ERA变量框架/events/queue.ts","src://tavern_helper_template/src/ERA变量框架/macro/parser.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/ERA变量框架/ui/template/EraAccordion.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/template/EraAccordion.vue?c75d","src://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/MetaHeader.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/MetaHeader.vue?da11","webpack://tavern_helper_template/./src/ERA变量框架/ui/template/JsonNode.vue?19c7","src://tavern_helper_template/src/ERA变量框架/ui/template/JsonNode.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/template/JsonNode.vue?6f7a","src://tavern_helper_template/src/ERA变量框架/ui/template/PrettyJsonViewer.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/template/PrettyJsonViewer.vue?a8b2","src://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/OperationDetails.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanelContent/OperationDetails.vue?18ea","src://tavern_helper_template/src/ERA变量框架/ui/template/TabSwitch.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/template/TabSwitch.vue?5a73","src://tavern_helper_template/src/ERA变量框架/ui/components/SnapshotManager.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/SnapshotManager.vue?f02e","src://tavern_helper_template/src/ERA变量框架/ui/components/EraPanel.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/EraPanel.vue?936c","src://tavern_helper_template/src/ERA变量框架/ui/components/FloatingBall.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/FloatingBall.vue?013d","src://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/AboutEra.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/AboutEra.vue?b120","src://tavern_helper_template/external var \"toastr\"","src://tavern_helper_template/src/ERA变量框架/utils/regex.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/regex_objects/hide_era_data.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/regex_objects/hide_era_metadata.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/regex_objects/hide_era_thinking.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/regex_objects/replace_placeholder.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/regex.ts","src://tavern_helper_template/src/ERA变量框架/utils/worldbook.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/worldbook_entries/era_var_operation_rule.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/worldbook_entries/era_var_intent.ts","src://tavern_helper_template/src/ERA变量框架/initer/manual/worldbook.ts","src://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/ActionButtons.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/ActionButtons.vue?f76e","src://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/EraSettingsPanel.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRailContent/EraSettingsPanel.vue?1f96","src://tavern_helper_template/src/ERA变量框架/ui/components/RightRail.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/RightRail.vue?d8d2","src://tavern_helper_template/src/ERA变量框架/ui/components/ThemeManager.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/components/ThemeManager.vue?92a0","src://tavern_helper_template/src/ERA变量框架/ui/store.ts","src://tavern_helper_template/src/ERA变量框架/ui/App.vue","webpack://tavern_helper_template/src/ERA变量框架/ui/App.vue?55af","src://tavern_helper_template/src/ERA变量框架/ui/index.ts","src://tavern_helper_template/src/ERA变量框架/ui/utils/dom.ts","src://tavern_helper_template/src/ERA变量框架/index.ts"],"sourcesContent":["/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./SnapshotManager.vue?vue&type=style&index=0&id=39fd399a&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"3204ea59\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./SnapshotManager.vue?vue&type=style&index=0&id=39fd399a&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./SnapshotManager.vue?vue&type=style&index=0&id=39fd399a&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.about-era-card[data-v-9b1026a6]{width:100%;padding:12px;background:var(--actions-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--actions-shadow-card),var(--shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-title[data-v-9b1026a6]{margin:0 0 4px;font-size:14px;font-weight:800;letter-spacing:0.3px;color:var(--text-title);transition:color 0.3s ease}.info-list[data-v-9b1026a6]{font-size:13px;color:var(--text-normal)}.info-list ul[data-v-9b1026a6]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.info-list li[data-v-9b1026a6]{display:flex;justify-content:space-between}.info-list a[data-v-9b1026a6]{color:var(--text-subtitle);text-decoration:none;font-weight:600;transition:color 0.3s ease}.info-list a[data-v-9b1026a6]:hover{color:var(--text-title);text-decoration:underline}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/RightRailContent/AboutEra.vue\"],\"names\":[],\"mappings\":\"AAqCA,iCACE,UAAW,CACX,YAAa,CACb,kCAAmC,CACnC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,yDAA2D,CAC3D,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAEA,6BACE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CAEA,4BACE,cAAe,CACf,wBACF,CAEA,+BACE,eAAgB,CAChB,SAAU,CACV,QAAS,CACT,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,+BACE,YAAa,CACb,6BACF,CAEA,8BACE,0BAA2B,CAC3B,oBAAqB,CACrB,eAAgB,CAChB,0BACF,CAEA,oCACE,uBAAwB,CACxB,yBACF\",\"sourcesContent\":[\"<template>\\n  <section class=\\\"about-era-card\\\" role=\\\"complementary\\\" aria-label=\\\"关于 ERA\\\">\\n    <h4 class=\\\"card-title\\\">关于 ERA</h4>\\n    <div class=\\\"info-list\\\">\\n      <ul>\\n        <li>\\n          <strong>ERA 项目地址:</strong>\\n          <a\\n            href=\\\"https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master\\\"\\n            target=\\\"_blank\\\"\\n            rel=\\\"noopener noreferrer\\\"\\n          >\\n            GitHub\\n          </a>\\n        </li>\\n        <li>\\n          <strong>ERA 介绍帖:</strong>\\n          <a\\n            href=\\\"https://discord.com/channels/1134557553011998840/1423319849400270928\\\"\\n            target=\\\"_blank\\\"\\n            rel=\\\"noopener noreferrer\\\"\\n          >\\n            Discord\\n          </a>\\n        </li>\\n        <li><strong>作者:</strong> 世界的山田</li>\\n        <li><strong>ERA 框架交流群:</strong> 1006127516</li>\\n      </ul>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\n// This component is purely informational.\\n</script>\\n\\n<style scoped>\\n.about-era-card {\\n  width: 100%;\\n  padding: 12px;\\n  background: var(--actions-bg-glass);\\n  border: 1px solid var(--border-strong);\\n  border-radius: 16px;\\n  backdrop-filter: blur(10px);\\n  box-shadow: var(--actions-shadow-card), var(--shadow-inset);\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n.card-title {\\n  margin: 0 0 4px;\\n  font-size: 14px;\\n  font-weight: 800;\\n  letter-spacing: 0.3px;\\n  color: var(--text-title);\\n  transition: color 0.3s ease;\\n}\\n\\n.info-list {\\n  font-size: 13px;\\n  color: var(--text-normal);\\n}\\n\\n.info-list ul {\\n  list-style: none;\\n  padding: 0;\\n  margin: 0;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n}\\n\\n.info-list li {\\n  display: flex;\\n  justify-content: space-between;\\n}\\n\\n.info-list a {\\n  color: var(--text-subtitle);\\n  text-decoration: none;\\n  font-weight: 600;\\n  transition: color 0.3s ease;\\n}\\n\\n.info-list a:hover {\\n  color: var(--text-title);\\n  text-decoration: underline;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.acc[data-v-f723f6d6]{border:1px solid var(--border-soft);border-radius:12px;background:var(--accordion-bg);overflow:hidden;transition:background 0.3s ease,border-color 0.3s ease}.acc-head[data-v-f723f6d6]{width:100%;display:flex;align-items:center;gap:10px;background:var(--mk-pill-null-bg);border-bottom:1px solid var(--border-soft);padding:10px 12px;cursor:pointer;font-weight:800;color:var(--text-subtitle);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.caret[data-v-f723f6d6]{transition:transform 0.18s ease}.caret.open[data-v-f723f6d6]{transform:rotate(90deg)}.title[data-v-f723f6d6]{font-size:13px}.spacer[data-v-f723f6d6]{flex:1}.hint[data-v-f723f6d6]{font-size:12px;color:var(--text-normal);transition:color 0.3s ease}.acc-body[data-v-f723f6d6]{max-height:0;overflow:hidden;transition:max-height 0.28s ease-in-out;background:var(--accordion-body-bg)}.acc-body.open[data-v-f723f6d6]{max-height:600px;overflow-y:auto}.inner[data-v-f723f6d6]{padding:10px 12px}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/template/EraAccordion.vue\"],\"names\":[],\"mappings\":\"AAkCA,sBACE,mCAAoC,CACpC,kBAAmB,CACnB,8BAA+B,CAC/B,eAAgB,CAChB,sDAGF,CAEA,2BACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,iCAAkC,CAClC,0CAA2C,CAC3C,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,0BAA2B,CAC3B,sEAIF,CACA,wBACE,+BACF,CACA,6BACE,uBACF,CACA,wBACE,cACF,CACA,yBACE,MACF,CACA,uBACE,cAAe,CACf,wBAAyB,CACzB,0BACF,CAEA,2BACE,YAAa,CACb,eAAgB,CAChB,uCAAwC,CACxC,mCACF,CACA,gCACE,gBAAiB,CACjB,eACF,CAEA,wBACE,iBACF\",\"sourcesContent\":[\"<template>\\n  <section class=\\\"acc\\\">\\n    <!-- 折叠头：点击切换 -->\\n    <button class=\\\"acc-head\\\" :aria-expanded=\\\"open ? 'true' : 'false'\\\" @click=\\\"open = !open\\\">\\n      <span class=\\\"caret\\\" :class=\\\"{ open }\\\">▸</span>\\n      <!-- 指示箭头 -->\\n      <span class=\\\"title\\\">{{ title }}</span>\\n      <!-- 标题文本 -->\\n      <span class=\\\"spacer\\\"></span>\\n      <!-- 弹性空隙 -->\\n      <span class=\\\"hint\\\">{{ open ? '收起' : '展开' }}</span>\\n      <!-- 右侧提示 -->\\n    </button>\\n\\n    <!-- 内容：高度过渡（使用 CSS Grid） -->\\n    <div class=\\\"acc-body\\\" :class=\\\"{ open }\\\">\\n      <div class=\\\"inner\\\">\\n        <slot />\\n      </div>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { ref } from 'vue';\\n\\nconst props = withDefaults(defineProps<{ title: string; defaultOpen?: boolean }>(), {\\n  defaultOpen: false,\\n});\\n\\nconst open = ref<boolean>(props.defaultOpen);\\n</script>\\n\\n<style scoped>\\n.acc {\\n  border: 1px solid var(--border-soft);\\n  border-radius: 12px;\\n  background: var(--accordion-bg);\\n  overflow: hidden;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n.acc-head {\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  gap: 10px;\\n  background: var(--mk-pill-null-bg);\\n  border-bottom: 1px solid var(--border-soft);\\n  padding: 10px 12px;\\n  cursor: pointer;\\n  font-weight: 800;\\n  color: var(--text-subtitle);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n.caret {\\n  transition: transform 0.18s ease;\\n}\\n.caret.open {\\n  transform: rotate(90deg);\\n}\\n.title {\\n  font-size: 13px;\\n}\\n.spacer {\\n  flex: 1;\\n}\\n.hint {\\n  font-size: 12px;\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n}\\n\\n.acc-body {\\n  max-height: 0;\\n  overflow: hidden;\\n  transition: max-height 0.28s ease-in-out;\\n  background: var(--accordion-body-bg);\\n}\\n.acc-body.open {\\n  max-height: 600px; /* 为展开的内容提供一个更大的最大高度 */\\n  overflow-y: auto; /* 当内容超出最大高度时，显示滚动条 */\\n}\\n\\n.inner {\\n  padding: 10px 12px;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.json-root[data-v-6fc9ef75]{font-size:12px;color:var(--settings-text-input);transition:color 0.3s ease}.json-line[data-v-6fc9ef75]{position:relative;display:flex;align-items:center;gap:6px;padding:2px 6px;border-radius:6px;transition:background 0.2s ease}.json-line[data-v-6fc9ef75]:hover{background:var(--json-hover-bg)}.json-children[data-v-6fc9ef75]{border-left:1px dashed var(--json-tree-line);transition:border-color 0.3s ease}.key[data-v-6fc9ef75]{color:var(--json-key-color);font-weight:700;transition:color 0.3s ease}.colon[data-v-6fc9ef75]{color:var(--text-normal);transition:color 0.3s ease}.brace[data-v-6fc9ef75]{color:var(--text-normal);transition:color 0.3s ease}.val.string[data-v-6fc9ef75]{color:var(--json-val-string)}.val.number[data-v-6fc9ef75]{color:var(--json-val-number)}.val.boolean[data-v-6fc9ef75]{color:var(--json-val-boolean)}.val.null[data-v-6fc9ef75]{color:var(--json-val-null)}.val.undefined[data-v-6fc9ef75]{color:var(--json-val-null)}.json-root[data-v-6fc9ef75]{overflow:clip;contain:layout paint;min-height:0}.json-children[data-v-6fc9ef75]{overflow:clip;contain:paint}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/template/PrettyJsonViewer.vue\"],\"names\":[],\"mappings\":\"AAkIA,4BACE,cAAe,CACf,gCAAiC,CACjC,0BACF,CACA,4BACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,eAAgB,CAChB,iBAAkB,CAClB,+BACF,CACA,kCACE,+BACF,CACA,gCACE,4CAA6C,CAC7C,iCACF,CAEA,sBACE,2BAA4B,CAC5B,eAAgB,CAChB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CAEA,6BACE,4BACF,CACA,6BACE,4BACF,CACA,8BACE,6BACF,CACA,2BACE,0BACF,CACA,gCACE,0BACF,CAGA,4BAEE,aAAc,CACd,oBAAqB,CACrB,YACF,CAEA,gCAEE,aAAc,CACd,aACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"json-root\\\">\\n    <div class=\\\"json-line\\\">\\n      <span class=\\\"brace\\\">{{ rootOpen }}</span>\\n      <!-- 根开括号：对象{ / 数组[ -->\\n    </div>\\n\\n    <div class=\\\"json-children\\\">\\n      <template v-if=\\\"isPlainObjectOrArray\\\">\\n        <JsonNode\\n          v-for=\\\"(v, k) in value\\\"\\n          :key=\\\"String(k)\\\"\\n          :k=\\\"String(k)\\\"\\n          :v=\\\"v\\\"\\n          :path=\\\"String(k)\\\"\\n          :level=\\\"1\\\"\\n          :default-collapsed=\\\"defaultCollapsed\\\"\\n          :max-depth=\\\"maxDepth\\\"\\n        />\\n      </template>\\n\\n      <template v-else>\\n        <div class=\\\"json-line\\\" :style=\\\"{ paddingLeft: 1 * 14 + 'px' }\\\">\\n          <span class=\\\"key\\\">value</span><span class=\\\"colon\\\">:</span>\\n          <span class=\\\"val\\\" :class=\\\"primitiveType\\\">{{ primitiveText }}</span>\\n        </div>\\n      </template>\\n    </div>\\n\\n    <div class=\\\"json-line\\\">\\n      <span class=\\\"brace\\\">{{ rootClose }}</span>\\n      <!-- 根闭括号：对象} / 数组] -->\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { computed } from 'vue'; // 计算属性工具\\nimport { Logger } from '../../utils/log';\\nimport JsonNode from './JsonNode.vue'; // ✅ 改为导入独立 SFC 的递归节点组件\\n\\nconst logger = new Logger();\\n\\nconst props = withDefaults(\\n  defineProps<{\\n    value: any; // 要展示的 JSON 值\\n    defaultCollapsed?: boolean; // 默认是否折叠\\n    maxDepth?: number; // 初次展开最大层数\\n  }>(),\\n  {\\n    defaultCollapsed: true, // 默认折叠\\n    maxDepth: 3, // 默认展开到 3 层\\n  },\\n);\\n\\nconst isPlainObjectOrArray = computed(() => {\\n  const v = props.value; // 取入参值\\n  const result = v !== null && typeof v === 'object'; // 仅对象/数组才进入逐键渲染\\n  logger.debug('isPlainObjectOrArray', `计算结果: ${result}。该值${result ? '是' : '不是'}普通对象或数组。`, {\\n    传入值: v,\\n  });\\n  return result;\\n}); // 是否对象/数组\\n\\nconst primitiveType = computed(() => {\\n  const v = props.value; // 取入参值\\n  let result: string;\\n  if (v === null) {\\n    result = 'null';\\n  } else if (Array.isArray(v)) {\\n    result = 'array'; // 数组（不会走到该分支，因为上面 isPlainObjectOrArray 判断过）\\n  } else {\\n    const t = typeof v; // 原始类型\\n    result = t === 'undefined' ? 'undefined' : t;\\n  }\\n  logger.debug('primitiveType', `计算原始值类型: ${result}`, { 传入值: v });\\n  return result;\\n}); // 原始值类型名（用于着色）\\n\\nconst primitiveText = computed(() => {\\n  const v = props.value; // 取入参值\\n  let result: string;\\n  switch (\\n    primitiveType.value // 按类型格式化文本\\n  ) {\\n    case 'string':\\n      result = JSON.stringify(v); // 字符串带引号\\n      break;\\n    case 'number':\\n      result = String(v); // 数字\\n      break;\\n    case 'boolean':\\n      result = v ? 'true' : 'false'; // 布尔\\n      break;\\n    case 'null':\\n      result = 'null'; // null\\n      break;\\n    case 'undefined':\\n      result = 'undefined'; // undefined\\n      break;\\n    case 'bigint':\\n      result = String(v) + 'n'; // bigint\\n      break;\\n    case 'symbol':\\n      result = String(v); // symbol\\n      break;\\n    case 'function':\\n      result = 'ƒ()'; // 函数\\n      break;\\n    default:\\n      result = ''; // 兜底\\n      break;\\n  }\\n  logger.debug('primitiveText', `格式化原始值文本: \\\"${result}\\\"`, {\\n    传入值: v,\\n    类型: primitiveType.value,\\n  });\\n  return result;\\n}); // 原始值文本\\n\\nconst isArrayRoot = computed(() => {\\n  const result = Array.isArray(props.value);\\n  logger.debug('isArrayRoot', `计算根节点是否为数组: ${result}`, { 传入值: props.value });\\n  return result;\\n}); // 根是否数组\\nconst rootOpen = computed(() => (isArrayRoot.value ? '[' : '{')); // 根开括号\\nconst rootClose = computed(() => (isArrayRoot.value ? ']' : '}')); // 根闭括号\\n</script>\\n\\n<style scoped>\\n.json-root {\\n  font-size: 12px;\\n  color: var(--settings-text-input);\\n  transition: color 0.3s ease;\\n}\\n.json-line {\\n  position: relative;\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  padding: 2px 6px;\\n  border-radius: 6px;\\n  transition: background 0.2s ease;\\n}\\n.json-line:hover {\\n  background: var(--json-hover-bg);\\n}\\n.json-children {\\n  border-left: 1px dashed var(--json-tree-line);\\n  transition: border-color 0.3s ease;\\n}\\n\\n.key {\\n  color: var(--json-key-color);\\n  font-weight: 700;\\n  transition: color 0.3s ease;\\n}\\n.colon {\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n}\\n.brace {\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n}\\n\\n.val.string {\\n  color: var(--json-val-string);\\n}\\n.val.number {\\n  color: var(--json-val-number);\\n}\\n.val.boolean {\\n  color: var(--json-val-boolean);\\n}\\n.val.null {\\n  color: var(--json-val-null);\\n}\\n.val.undefined {\\n  color: var(--json-val-null);\\n}\\n\\n/* ===[新增] 防溢出：根与子容器都裁剪绘制，避免在外部容器高度为 0 时“透出” === */\\n.json-root {\\n  /* JSON 根容器：自身成为一个绘制边界 */\\n  overflow: clip; /* 裁剪一切溢出（比 hidden 更省性能、无滚动条） */\\n  contain: layout paint; /* 隔离布局与绘制，防外部高度计算误差 */\\n  min-height: 0; /* 防止 flex 场景 min-content 顶高父级 */\\n}\\n\\n.json-children {\\n  /* 子区：同样裁剪，解决左侧虚线在收起时外露 */\\n  overflow: clip; /* 子级再保险裁剪 */\\n  contain: paint; /* 进一步隔离绘制 */\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.era-panel[data-v-0e43fd44]{flex:2 1 600px;min-width:320px;height:min(680px,86vh);display:flex;flex-direction:column;background:var(--bg-blur-heavy);border:1px solid var(--border-strong);backdrop-filter:blur(10px);border-radius:16px;box-shadow:var(--shadow-panel),var(--shadow-inset);overflow:hidden;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;transition:background 0.3s ease,border-color 0.3s ease}.panel-top[data-v-0e43fd44]{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border-soft);background:var(--bg-blur-light);transition:background 0.3s ease,border-color 0.3s ease}.panel-title[data-v-0e43fd44]{font-size:16px;font-weight:800;letter-spacing:0.5px;color:var(--text-title);transition:color 0.3s ease}.btn-close[data-v-0e43fd44]{width:32px;height:32px;line-height:30px;text-align:center;border-radius:8px;border:1px solid var(--border-normal);background:var(--bg-solid);cursor:pointer;font-size:18px;color:var(--text-normal);box-shadow:var(--shadow-button);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.btn-close[data-v-0e43fd44]:hover{transform:translateY(-1px);box-shadow:var(--shadow-button-hover)}.panel-body[data-v-0e43fd44]{padding:0;overflow:hidden;flex-grow:1;display:flex;flex-direction:column}.panel-content-wrapper[data-v-0e43fd44]{padding:14px 14px 16px;overflow-y:auto;flex-grow:1}.panel-content-wrapper[data-v-0e43fd44]>*+*{margin-top:12px}.empty[data-v-0e43fd44]{height:100%;display:grid;place-items:center;color:var(--text-normal);font-size:14px;border:1px dashed var(--border-dashed);border-radius:12px;background:var(--bg-empty);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/EraPanel.vue\"],\"names\":[],\"mappings\":\"AAqDA,4BACE,cAAe,CACf,eAAgB,CAChB,sBAAwB,CACxB,YAAa,CACb,qBAAsB,CACtB,+BAAgC,CAChC,qCAAsC,CACtC,0BAA2B,CAC3B,kBAAmB,CACnB,kDAAoD,CACpD,eAAgB,CAChB,gEAAqE,CACrE,sDAGF,CAEA,4BACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,0CAA2C,CAC3C,+BAAgC,CAChC,sDAGF,CACA,8BACE,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CACA,4BACE,UAAW,CACX,WAAY,CACZ,gBAAiB,CACjB,iBAAkB,CAClB,iBAAkB,CAClB,qCAAsC,CACtC,0BAA2B,CAC3B,cAAe,CACf,cAAe,CACf,wBAAyB,CACzB,+BAAgC,CAChC,+GAMF,CACA,kCACE,0BAA2B,CAC3B,qCACF,CAEA,6BACE,SAAU,CACV,eAAgB,CAChB,WAAY,CACZ,YAAa,CACb,qBACF,CAEA,wCACE,sBAAuB,CACvB,eAAgB,CAChB,WACF,CAGA,4CACE,eACF,CAEA,wBACE,WAAY,CACZ,YAAa,CACb,kBAAmB,CACnB,wBAAyB,CACzB,cAAe,CACf,sCAAuC,CACvC,kBAAmB,CACnB,0BAA2B,CAC3B,sEAIF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"era-panel\\\">\\n    <header class=\\\"panel-top\\\">\\n      <h3 class=\\\"panel-title\\\">ERA 数据面板</h3>\\n      <button class=\\\"btn-close\\\" aria-label=\\\"关闭\\\" @click=\\\"requestSwitchView('FloatingBall')\\\">×</button>\\n    </header>\\n    <div class=\\\"panel-body\\\">\\n      <div class=\\\"panel-content-wrapper\\\">\\n        <template v-if=\\\"data\\\">\\n          <EraAccordion title=\\\"最新消息元数据\\\" :default-open=\\\"false\\\">\\n            <MetaHeader :mk=\\\"data.mk\\\" :message-id=\\\"data.message_id\\\" />\\n          </EraAccordion>\\n\\n          <OperationDetails :data=\\\"data\\\" />\\n\\n          <SnapshotManager :latest-data=\\\"data\\\" />\\n        </template>\\n        <template v-else>\\n          <div class=\\\"empty\\\">等待 era:writeDone 事件数据…</div>\\n        </template>\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { ref } from 'vue';\\nimport type { WriteDonePayload } from '../../utils/constants';\\nimport { Logger } from '../../utils/log';\\nimport EraAccordion from '../template/EraAccordion.vue';\\nimport MetaHeader from './EraPanelContent/MetaHeader.vue';\\nimport OperationDetails from './EraPanelContent/OperationDetails.vue';\\nimport SnapshotManager from './SnapshotManager.vue';\\n\\ntype TabItem = { key: 'pure' | 'full'; label: string };\\n\\nconst logger = new Logger();\\n\\ndefineProps<{\\n  data: WriteDonePayload | null;\\n}>();\\n\\nconst requestSwitchView = (viewName: 'FloatingBall' | 'ExpandedView') => {\\n  logger.debug('requestSwitchView', `请求切换视图到: ${viewName}`);\\n  if ((window as any).eraUiSwitchView) {\\n    (window as any).eraUiSwitchView(viewName);\\n  } else {\\n    logger.warn('requestSwitchView', '全局切换函数 eraUiSwitchView 未找到');\\n  }\\n};\\n</script>\\n\\n<style scoped>\\n.era-panel {\\n  flex: 2 1 600px;\\n  min-width: 320px;\\n  height: min(680px, 86vh);\\n  display: flex;\\n  flex-direction: column;\\n  background: var(--bg-blur-heavy);\\n  border: 1px solid var(--border-strong);\\n  backdrop-filter: blur(10px);\\n  border-radius: 16px;\\n  box-shadow: var(--shadow-panel), var(--shadow-inset);\\n  overflow: hidden;\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n.panel-top {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 14px 16px;\\n  border-bottom: 1px solid var(--border-soft);\\n  background: var(--bg-blur-light);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n.panel-title {\\n  font-size: 16px;\\n  font-weight: 800;\\n  letter-spacing: 0.5px;\\n  color: var(--text-title);\\n  transition: color 0.3s ease;\\n}\\n.btn-close {\\n  width: 32px;\\n  height: 32px;\\n  line-height: 30px;\\n  text-align: center;\\n  border-radius: 8px;\\n  border: 1px solid var(--border-normal);\\n  background: var(--bg-solid);\\n  cursor: pointer;\\n  font-size: 18px;\\n  color: var(--text-normal);\\n  box-shadow: var(--shadow-button);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease,\\n    transform 0.2s ease,\\n    box-shadow 0.2s ease;\\n}\\n.btn-close:hover {\\n  transform: translateY(-1px);\\n  box-shadow: var(--shadow-button-hover);\\n}\\n\\n.panel-body {\\n  padding: 0;\\n  overflow: hidden;\\n  flex-grow: 1;\\n  display: flex; /* 确保 wrapper 能撑满 */\\n  flex-direction: column;\\n}\\n\\n.panel-content-wrapper {\\n  padding: 14px 14px 16px;\\n  overflow-y: auto; /* 内部滚动 */\\n  flex-grow: 1;\\n}\\n\\n/* 用 margin 替代 gap */\\n.panel-content-wrapper > * + * {\\n  margin-top: 12px;\\n}\\n\\n.empty {\\n  height: 100%; /* 撑满父容器 */\\n  display: grid;\\n  place-items: center;\\n  color: var(--text-normal);\\n  font-size: 14px;\\n  border: 1px dashed var(--border-dashed);\\n  border-radius: 12px;\\n  background: var(--bg-empty);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./JsonNode.vue?vue&type=style&index=0&id=6c2ac46e&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"1c903dce\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./JsonNode.vue?vue&type=style&index=0&id=6c2ac46e&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./JsonNode.vue?vue&type=style&index=0&id=6c2ac46e&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.era-shell[data-v-17743fb0]{display:flex;align-items:flex-start;gap:12px;flex-wrap:nowrap}[data-v-17743fb0] .era-panel{flex:0 1 auto}@media (max-width:992px){.era-shell[data-v-17743fb0]{flex-wrap:wrap}[data-v-17743fb0] .era-panel,[data-v-17743fb0] .right-rail{width:100%;flex-basis:auto}[data-v-17743fb0] .right-rail{position:static;margin-top:12px;height:auto;max-height:40vh}}[data-v-17743fb0] .floating-ball{position:fixed;right:max(16px,env(safe-area-inset-right));bottom:max(90px,env(safe-area-inset-bottom));z-index:2147483647;pointer-events:auto;touch-action:manipulation;will-change:transform}.era-expanded-layer[data-v-17743fb0]{position:fixed;inset:0;display:grid;place-items:center;padding:clamp(12px,2.5vw,24px);pointer-events:auto;z-index:2147483646;background:transparent;overflow:auto}@media (max-width:640px){[data-v-17743fb0] .era-panel{width:min(92vw,560px);height:min(88vh,calc(100svh - 32px))}.panel-body[data-v-17743fb0]{overscroll-behavior:contain}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/App.vue\"],\"names\":[],\"mappings\":\"AAqFA,4BAEE,YAAa,CACb,sBAAuB,CACvB,QAAS,CACT,gBACF,CAGA,6BACE,aACF,CAGA,yBAEE,4BACE,cACF,CACA,2DAEE,UAAW,CACX,eACF,CACA,8BACE,eAAgB,CAChB,eAAgB,CAChB,WAAY,CACZ,eACF,CACF,CAGA,iCAEE,cAAe,CACf,0CAA4C,CAC5C,4CAA8C,CAC9C,kBAAmB,CACnB,mBAAoB,CACpB,yBAA0B,CAC1B,qBACF,CAGA,qCAEE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,kBAAmB,CACnB,8BAAiC,CACjC,mBAAoB,CACpB,kBAAmB,CACnB,sBAAuB,CACvB,aACF,CAGA,yBAEE,6BAEE,qBAAuB,CACvB,oCACF,CACA,6BAEE,2BACF,CACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"era-app-container\\\" :class=\\\"{ 'dark-theme': isDarkMode }\\\">\\n    <ThemeManager ref=\\\"themeManager\\\" />\\n    <FloatingBall v-show=\\\"currentComponent === 'FloatingBall'\\\" @click=\\\"requestSwitchView('ExpandedView')\\\" />\\n    <div v-show=\\\"currentComponent === 'ExpandedView'\\\" class=\\\"era-expanded-layer\\\">\\n      <!-- 视口级展开层：悬浮模态容器 -->\\n      <div class=\\\"era-shell\\\">\\n        <!-- 新增横向壳容器：左面板 + 右侧栏 -->\\n        <EraPanel :data=\\\"dataRef\\\" />\\n        <RightRail />\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { storeToRefs } from 'pinia';\\nimport { onBeforeUnmount, onMounted, ref } from 'vue';\\nimport { getScriptSettings } from '../utils/era_data';\\nimport { Logger } from '../utils/log';\\nimport EraPanel from './components/EraPanel.vue';\\nimport FloatingBall from './components/FloatingBall.vue';\\nimport RightRail from './components/RightRail.vue';\\nimport ThemeManager from './components/ThemeManager.vue';\\nimport { useUiStore } from './store';\\n\\nconst logger = new Logger();\\n\\n// 从 Pinia store 获取状态和 action\\nconst uiStore = useUiStore();\\nconst { currentView: currentComponent, eventData: dataRef } = storeToRefs(uiStore);\\n\\n// 主题状态管理\\nconst themeManager = ref<InstanceType<typeof ThemeManager> | null>(null);\\nconst isDarkMode = ref(false);\\n\\nconst loadThemeSetting = () => {\\n  try {\\n    const settings = getScriptSettings();\\n    const darkModeValue = settings?.['开启黑夜模式'] ?? false;\\n    isDarkMode.value = darkModeValue;\\n    if (themeManager.value) {\\n      themeManager.value.isDarkMode = darkModeValue;\\n    }\\n    logger.debug('loadThemeSetting', `主题已更新为: ${darkModeValue ? 'Dark' : 'Light'}`);\\n  } catch (e) {\\n    logger.error('loadThemeSetting', '加载主题设置失败', e);\\n    isDarkMode.value = false; // Fallback to light mode\\n  }\\n};\\n\\nonMounted(() => {\\n  loadThemeSetting();\\n  window.addEventListener('era-settings-updated', loadThemeSetting);\\n});\\n\\nonBeforeUnmount(() => {\\n  window.removeEventListener('era-settings-updated', loadThemeSetting);\\n});\\n\\nconst requestSwitchView = (viewName: 'FloatingBall' | 'ExpandedView') => {\\n  logger.debug('requestSwitchView', `请求切换视图到: ${viewName}`);\\n  uiStore.switchView(viewName);\\n};\\n</script>\\n\\n<style>\\n/* App.vue 视口级悬浮容器（替换原有 .era-app-container） */\\n.era-app-container {\\n  /* 作为全局悬浮层根容器 */\\n  position: fixed; /* 固定在视口，不受外层布局影响 */\\n  inset: 0; /* 覆盖整个视口区域（top/right/bottom/left 全 0） */\\n  z-index: 2147483646; /* 超高层级，盖住站点其它层 */\\n  pointer-events: none; /* 默认不截获点击，避免阻挡页面 */\\n  isolation: isolate; /* 新建独立层叠上下文，防止被外层混合影响 */\\n  contain: layout style paint; /* 创建渲染封装，减少外界干扰 */\\n  width: 100svw; /* 适配移动端动态视口宽度 */\\n  height: 100svh; /* 适配移动端动态视口高度 */\\n}\\n</style>\\n\\n<style scoped>\\n/* 从 EraDataPanel.vue 迁移过来的样式 */\\n\\n/* ===[新增] 横向壳：左面板 + 右侧栏（按钮）=== */\\n.era-shell {\\n  /* 横向包裹容器 */ /* 中文注释：横向排列容器 */\\n  display: flex; /* 横向布局 */ /* 中文注释：flex 横排 */\\n  align-items: flex-start; /* 顶对齐 */ /* 中文注释：上缘对齐 */\\n  gap: 12px; /* 左右间距 */ /* 中文注释：元素间距 */\\n  flex-wrap: nowrap; /* 默认不换行 */ /* 中文注释：保持并排 */\\n}\\n\\n/* 保持面板宽高（原样），但让它更好地在横向中自适应 */\\n:deep(.era-panel) {\\n  flex: 0 1 auto; /* 面板按自身宽度布局 */\\n}\\n\\n/* 小屏回落：改为上下堆叠（按钮在下） */\\n@media (max-width: 992px) {\\n  /* 992px (平板) 以下回落 */\\n  .era-shell {\\n    flex-wrap: wrap; /* 允许换行 */\\n  }\\n  :deep(.era-panel),\\n  :deep(.right-rail) {\\n    width: 100%; /* 各占一行 */\\n    flex-basis: auto; /* 重置 flex-basis */\\n  }\\n  :deep(.right-rail) {\\n    position: static; /* 取消吸顶 */\\n    margin-top: 12px; /* 与上方留白 */\\n    height: auto; /* 高度自适应 */\\n    max-height: 40vh; /* 限制最大高度，避免过长 */\\n  }\\n}\\n\\n/* ===[新增] 悬浮球：固定在右下角 + 开启点击 === */\\n:deep(.floating-ball) {\\n  /* 选中子组件根元素（scoped 下用 deep） */\\n  position: fixed; /* 固定定位到视口 */\\n  right: max(16px, env(safe-area-inset-right)); /* 右侧安全区 + 基础边距 */\\n  bottom: max(90px, env(safe-area-inset-bottom)); /* 底部安全区 + 基础边距 */\\n  z-index: 2147483647; /* 高于容器根，确保始终可点 */\\n  pointer-events: auto; /* 启用点击（父容器是 none） */\\n  touch-action: manipulation; /* 移动端减少点击延迟 */\\n  will-change: transform; /* 提前分层，避免站点 3D/滤镜影响 */\\n}\\n\\n/* ===[新增] 展开层：视口级模态容器（只在 ExpandedView v-show 为 true 时存在） === */\\n.era-expanded-layer {\\n  /* 绑定在模板新增的 class */\\n  position: fixed; /* 固定在视口（不受外层布局约束） */\\n  inset: 0; /* 铺满视口 */\\n  display: grid; /* 用 grid 居中内容 */\\n  place-items: center; /* 水平垂直置中 */\\n  padding: clamp(12px, 2.5vw, 24px); /* 视口自适应内边距 */\\n  pointer-events: auto; /* 启用点击（与父容器的 none 区分） */\\n  z-index: 2147483646; /* 仅次于悬浮球，保证在最上层 */\\n  background: transparent; /* 如需半透明遮罩可改为 rgba(0,0,0,.25) */\\n  overflow: auto; /* 内容超出时，容器自身滚动，不被裁剪 */\\n}\\n\\n/* ===[新增] 小屏适配：面板在移动端更“填充”可视区 === */\\n@media (max-width: 640px) {\\n  /* 针对手机宽度 */\\n  :deep(.era-panel) {\\n    /* 重设面板宽高更贴合手机 */\\n    width: min(92vw, 560px); /* 放宽到 92vw，避免 60vw 太窄 */\\n    height: min(88vh, calc(100svh - 32px)); /* 兼顾状态栏/地址栏动态高度 */\\n  }\\n  .panel-body {\\n    /* 主要内容区滚动容器 */\\n    overscroll-behavior: contain; /* 防止滚动牵动背景页面 */\\n  }\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.action-buttons-card[data-v-3cd160a6]{width:100%;padding:12px;background:var(--actions-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--actions-shadow-card),var(--shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-title[data-v-3cd160a6]{margin:0 0 4px;font-size:14px;font-weight:800;letter-spacing:0.3px;color:var(--text-title);transition:color 0.3s ease}.btns[data-v-3cd160a6]{display:flex;flex-direction:column;gap:16px}.btn-group[data-v-3cd160a6]{display:flex;flex-direction:column;gap:6px}.btn-desc[data-v-3cd160a6]{font-size:11px;color:var(--text-soft);padding:0 4px;line-height:1.5;margin:0;transition:color 0.3s ease}.btn[data-v-3cd160a6]{display:grid;grid-template-columns:22px 1fr;align-items:center;-moz-column-gap:8px;column-gap:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--border-soft);background:var(--actions-btn-bg);color:var(--actions-btn-text);font-weight:700;font-size:13px;cursor:pointer;box-shadow:var(--settings-shadow-inset),var(--shadow-button);transition:transform 0.12s ease,box-shadow 0.12s ease,background 0.2s ease,color 0.3s ease,border-color 0.3s ease;text-align:left}.btn.primary[data-v-3cd160a6]{background:var(--actions-btn-primary-bg);border-color:var(--actions-btn-primary-border);color:var(--actions-btn-primary-text)}.btn.subtle[data-v-3cd160a6]{background:var(--actions-btn-subtle-bg);border-color:var(--actions-btn-subtle-border)}.btn.danger[data-v-3cd160a6]{background:var(--actions-btn-danger-bg);border-color:var(--actions-btn-danger-border);color:var(--actions-btn-danger-text)}.btn[data-v-3cd160a6]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--shadow-button-hover)}.btn[data-v-3cd160a6]:active{transform:translateY(0);box-shadow:var(--settings-shadow-inset),var(--actions-shadow-btn-active)}.btn[data-v-3cd160a6]:focus-visible{outline:2px solid var(--actions-outline-focus);outline-offset:2px}.ico[data-v-3cd160a6]{display:inline-grid;place-items:center;width:22px;height:22px;filter:saturate(0.95)}.label[data-v-3cd160a6]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/RightRailContent/ActionButtons.vue\"],\"names\":[],\"mappings\":\"AAwJA,sCAEE,UAAW,CACX,YAAa,CACb,kCAAmC,CACnC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,yDAA2D,CAC3D,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAGA,6BAEE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,uBAAwB,CACxB,0BACF,CAGA,uBAEE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,4BACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,2BACE,cAAe,CACf,sBAAuB,CACvB,aAAc,CACd,eAAgB,CAChB,QAAS,CACT,0BACF,CAGA,sBAEE,YAAa,CACb,8BAA+B,CAC/B,kBAAmB,CACnB,mBAAe,CAAf,cAAe,CACf,iBAAkB,CAClB,kBAAmB,CACnB,mCAAoC,CACpC,gCAAiC,CACjC,6BAA8B,CAC9B,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,4DAA8D,CAC9D,iHAKwB,CACxB,eACF,CAGA,8BAEE,wCAAyC,CACzC,8CAA+C,CAC/C,qCACF,CAGA,6BAEE,uCAAwC,CACxC,6CACF,CAGA,6BACE,uCAAwC,CACxC,6CAA8C,CAC9C,oCACF,CAGA,4BAEE,0BAA2B,CAC3B,kEACF,CACA,6BAEE,uBAAwB,CACxB,wEACF,CAGA,oCAEE,8CAA+C,CAC/C,kBACF,CAGA,sBAEE,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,WAAY,CACZ,qBACF,CACA,wBAEE,kBAAmB,CACnB,eAAgB,CAChB,sBACF\",\"sourcesContent\":[\"<template>\\n  <!-- 右侧操作卡：外层自包含，不依赖父组件样式 -->\\n  <section class=\\\"action-buttons-card\\\" role=\\\"complementary\\\" aria-label=\\\"ERA 快捷操作\\\">\\n    <!-- 中文注释：操作卡容器 -->\\n    <h4 class=\\\"card-title\\\">快捷操作</h4>\\n    <!-- 中文注释：卡片标题 -->\\n    <div class=\\\"btns\\\">\\n      <!-- 中文注释：按钮垂直栈 -->\\n      <div class=\\\"btn-group\\\">\\n        <button class=\\\"btn primary\\\" title=\\\"重新计算所有变量\\\" @click.stop=\\\"onFullSync\\\">\\n          <!-- 中文注释：主按钮 -->\\n          <span class=\\\"ico\\\" aria-hidden=\\\"true\\\">🔄</span>\\n          <!-- 中文注释：图标 -->\\n          <span class=\\\"label\\\">完全重算变量</span>\\n          <!-- 中文注释：文字 -->\\n        </button>\\n        <p class=\\\"btn-desc\\\">\\n          当变量与预期不符时，点击此按钮可从**第一条消息**开始重新计算所有消息，以确保数据完全同步。这是一个非常耗时的操作。\\n        </p>\\n      </div>\\n\\n      <div class=\\\"btn-group\\\">\\n        <button class=\\\"btn subtle\\\" title=\\\"只重算最新一楼的变量\\\" @click.stop=\\\"onLastSync\\\">\\n          <!-- 中文注释：次按钮 -->\\n          <span class=\\\"ico\\\" aria-hidden=\\\"true\\\">♻️</span>\\n          <!-- 中文注释：图标 -->\\n          <span class=\\\"label\\\">重算最后一楼变量</span>\\n          <!-- 中文注释：文字 -->\\n        </button>\\n        <p class=\\\"btn-desc\\\">\\n          仅根据最新一条消息重新计算变量，速度较快。适用于修复最近一次操作导致的小问题或在手动编辑了最后一条消息后重新写入变量（注意，era会无视所有**用户发送的消息**中的变量更新语句）。\\n        </p>\\n      </div>\\n\\n      <div class=\\\"btn-group\\\">\\n        <button class=\\\"btn danger\\\" title=\\\"为角色卡注入 ERA 规则\\\" @click.stop=\\\"onInjectRegex\\\">\\n          <span class=\\\"ico\\\" aria-hidden=\\\"true\\\">🥽</span>\\n          <span class=\\\"label\\\">ERA 快速初始化</span>\\n        </button>\\n        <p class=\\\"btn-desc\\\">\\n          【角色卡作者专用】点击后，会向当前角色卡注入四条规则：<br />\\n          1. 添加“ERA 数据隐藏正则”以隐藏聊天中的数据标签。<br />\\n          2. 添加“ERA状态栏模板”以将模板状态栏替换至消息。<br />\\n          3. 向角色主世界书中添加“ERA变量操作规则”条目以令ai明白era变量的操作规则。<br />\\n          4. 向角色主世界书中添加“ERA变量意图说明”条目以存放变量意图说明。<br />\\n          注意：作者可以用该功能快速注入使用era的几个基础配置。但你仍旧需要：<br />\\n          1. 自己设计角色卡用到的变量结构并写入角色的开场白。<br />\\n          2. 在角色主世界书中‘ERA变量意图说明’条目中添加向ai说明各个变量的意图的提示词。<br />\\n          3. 修改‘ERA状态栏模板’正则中的状态栏代码，令其与**你设计的变量系统匹配**。\\n        </p>\\n      </div>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport toastr from 'toastr';\\nimport { initEraCharacterRegexes } from '../../../initer/manual/regex';\\nimport { initEraWorldbookEntries } from '../../../initer/manual/worldbook';\\nimport { Logger } from '../../../utils/log'; // 中文注释：日志工具\\nimport { ui } from 'jquery';\\n\\nconst logger = new Logger(); // 中文注释：实例化日志\\n\\nasync function onInjectRegex() {\\n  logger.log('onInjectRegex', '点击“ERA 快速初始化”，开始注入...');\\n  try {\\n    // 检查是否存在第 0 条消息\\n    try {\\n      const firstMessage = getChatMessages(0);\\n      if (!firstMessage || firstMessage.length === 0) {\\n        throw new Error('No messages found');\\n      }\\n    } catch (e) {\\n      toastr.error('然后再次点击快速初始化', '请在角色卡的开场白中添加任意内容。');\\n      logger.warn('onInjectRegex', '获取第 0 条消息失败，可能是因为聊天记录为空。', e);\\n      return;\\n    }\\n\\n    // 初始化正则\\n    const regexResult = await initEraCharacterRegexes();\\n    if (!regexResult.success) {\\n      toastr.error(regexResult.reason ?? '未知错误', '正则初始化失败');\\n      logger.error('onInjectRegex', '正则注入失败:', regexResult.reason);\\n      return;\\n    } else {\\n      const injectedCount = regexResult.details.filter(d => d.status === 'injected').length;\\n      const existsCount = regexResult.details.filter(d => d.status === 'exists').length;\\n      let message = '';\\n      if (injectedCount > 0) {\\n        message += `成功注入 ${injectedCount} 个新正则。`;\\n      }\\n      if (existsCount > 0) {\\n        message += ` ${existsCount} 个正则已存在。`;\\n      }\\n      if (message) {\\n        toastr.success(message.trim(), '正则初始化完成');\\n      }\\n    }\\n\\n    // 初始化世界书\\n    const worldbookResult = await initEraWorldbookEntries();\\n    if (!worldbookResult.success) {\\n      toastr.error(worldbookResult.reason ?? '一个或多个世界书条目注入失败。', '世界书初始化失败');\\n      logger.error('onInjectRegex', '世界书注入失败:', worldbookResult);\\n    } else {\\n      const injectedCount = worldbookResult.details.filter(d => d.status === 'injected').length;\\n      const existsCount = worldbookResult.details.filter(d => d.status === 'exists').length;\\n      let message = '';\\n      if (injectedCount > 0) {\\n        message += `成功注入 ${injectedCount} 个新条目。`;\\n      }\\n      if (existsCount > 0) {\\n        message += ` ${existsCount} 个条目已存在。`;\\n      }\\n      toastr.success(message.trim(), '世界书初始化完成');\\n    }\\n\\n    logger.log('onInjectRegex', '初始化流程完成。');\\n  } catch (error) {\\n    logger.error('onInjectRegex', '执行初始化时发生意外错误:', error);\\n    toastr.error('发生意外错误，请检查控制台获取详细信息。', '初始化失败');\\n  }\\n}\\n\\nfunction onFullSync() {\\n  // 中文注释：完全重算事件\\n  logger.log('onFullSync', '点击“完全重算变量”，发送 manual_full_sync 事件。'); // 中文注释：日志\\n  try {\\n    eventEmit('manual_full_sync'); // 中文注释：发送全量重算事件（保持不变）\\n    toastr.success('已发送“完全重算变量”请求。', '操作成功');\\n  } catch (error) {\\n    logger.error('onFullSync', '发送 manual_full_sync 事件时出错:', error);\\n    toastr.error('发送请求失败，请检查控制台。', '操作失败');\\n  }\\n}\\n\\nfunction onLastSync() {\\n  // 中文注释：局部重算事件\\n  logger.log('onLastSync', '点击“重算最后一楼变量”，发送 manual_sync 事件。'); // 中文注释：日志\\n  try {\\n    eventEmit('manual_sync'); // 中文注释：发送单楼重算事件（保持不变）\\n    toastr.success('已发送“重算最后一楼变量”请求。', '操作成功');\\n  } catch (error) {\\n    logger.error('onLastSync', '发送 manual_sync 事件时出错:', error);\\n    toastr.error('发送请求失败，请检查控制台。', '操作失败');\\n  }\\n}\\n</script>\\n\\n<style scoped>\\n/* === 外层卡片：与左侧 ERA 面板同风格（玻璃卡 + 轻浮雕） === */\\n.action-buttons-card {\\n  /* 中文注释：卡片容器 */\\n  width: 100%; /* 占满侧栏 */ /* 中文注释：自适应宽度 */\\n  padding: 12px; /* 内边距 */ /* 中文注释：留白 */\\n  background: var(--actions-bg-glass);\\n  border: 1px solid var(--border-strong);\\n  border-radius: 16px; /* 中文注释：圆角 */\\n  backdrop-filter: blur(10px); /* 中文注释：毛玻璃效果 */\\n  box-shadow: var(--actions-shadow-card), var(--shadow-inset);\\n  display: flex; /* 中文注释：纵向布局 */\\n  flex-direction: column; /* 中文注释：垂直排列 */\\n  gap: 10px; /* 中文注释：元素间距 */\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n/* 标题：与面板标题权重接近但略轻 */\\n.card-title {\\n  /* 中文注释：卡片标题 */\\n  margin: 0 0 4px; /* 中文注释：底部留白 */\\n  font-size: 14px; /* 中文注释：字号 */\\n  font-weight: 800; /* 中文注释：加粗 */\\n  letter-spacing: 0.3px; /* 中文注释：字距 */\\n  color: var(--text-title);\\n  transition: color 0.3s ease;\\n}\\n\\n/* 按钮栈：竖直排列 */\\n.btns {\\n  /* 中文注释：按钮容器 */\\n  display: flex; /* 中文注释：flex 布局 */\\n  flex-direction: column; /* 中文注释：垂直排列 */\\n  gap: 16px; /* 中文注释：上下间距 */\\n}\\n\\n.btn-group {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n}\\n\\n.btn-desc {\\n  font-size: 11px;\\n  color: var(--text-soft);\\n  padding: 0 4px;\\n  line-height: 1.5;\\n  margin: 0;\\n  transition: color 0.3s ease;\\n}\\n\\n/* 通用按钮造型：大号、易点、可聚焦 */\\n.btn {\\n  /* 中文注释：通用按钮 */\\n  display: grid; /* 中文注释：网格方便对齐图标与文字 */\\n  grid-template-columns: 22px 1fr; /* 中文注释：左 22px 图标 + 右侧文字 */\\n  align-items: center; /* 中文注释：垂直居中 */\\n  column-gap: 8px; /* 中文注释：图标与文字间距 */\\n  padding: 10px 12px; /* 中文注释：触控友好尺寸 */\\n  border-radius: 12px; /* 中文注释：圆角 */\\n  border: 1px solid var(--border-soft);\\n  background: var(--actions-btn-bg);\\n  color: var(--actions-btn-text);\\n  font-weight: 700; /* 中文注释：字重 */\\n  font-size: 13px; /* 中文注释：字号 */\\n  cursor: pointer; /* 中文注释：可点击 */\\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button);\\n  transition:\\n    transform 0.12s ease,\\n    box-shadow 0.12s ease,\\n    background 0.2s ease,\\n    color 0.3s ease,\\n    border-color 0.3s ease;\\n  text-align: left; /* 中文注释：靠左 */\\n}\\n\\n/* 主按钮：略带品牌色调（蓝青） */\\n.btn.primary {\\n  /* 中文注释：主按钮 */\\n  background: var(--actions-btn-primary-bg);\\n  border-color: var(--actions-btn-primary-border);\\n  color: var(--actions-btn-primary-text);\\n}\\n\\n/* 次按钮：更素雅 */\\n.btn.subtle {\\n  /* 中文注释：次按钮 */\\n  background: var(--actions-btn-subtle-bg);\\n  border-color: var(--actions-btn-subtle-border);\\n}\\n\\n/* 危险按钮：用于特殊或破坏性操作 */\\n.btn.danger {\\n  background: var(--actions-btn-danger-bg);\\n  border-color: var(--actions-btn-danger-border);\\n  color: var(--actions-btn-danger-text);\\n}\\n\\n/* 悬停与按压反馈 */\\n.btn:hover {\\n  /* 中文注释：悬停态 */\\n  transform: translateY(-1px); /* 中文注释：轻浮起 */\\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button-hover);\\n}\\n.btn:active {\\n  /* 中文注释：按下态 */\\n  transform: translateY(0); /* 中文注释：回落 */\\n  box-shadow: var(--settings-shadow-inset), var(--actions-shadow-btn-active);\\n}\\n\\n/* 焦点可见性（无障碍） */\\n.btn:focus-visible {\\n  /* 中文注释：键盘聚焦态 */\\n  outline: 2px solid var(--actions-outline-focus);\\n  outline-offset: 2px; /* 中文注释：描边偏移 */\\n}\\n\\n/* 图标与文字 */\\n.ico {\\n  /* 中文注释：图标框 */\\n  display: inline-grid; /* 中文注释：网格放置 */\\n  place-items: center; /* 中文注释：居中 */\\n  width: 22px; /* 中文注释：宽度 */\\n  height: 22px; /* 中文注释：高度 */\\n  filter: saturate(0.95); /* 中文注释：轻饱和 */\\n}\\n.label {\\n  /* 中文注释：文字 */\\n  white-space: nowrap; /* 中文注释：不换行（文字短） */\\n  overflow: hidden; /* 中文注释：溢出裁剪 */\\n  text-overflow: ellipsis; /* 中文注释：省略号 */\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=1&id=17743fb0&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"cb34e530\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=1&id=17743fb0&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=1&id=17743fb0&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=17743fb0&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"1e6ee8fe\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=17743fb0&lang=css\", function() {\n     var newContent = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=17743fb0&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraAccordion.vue?vue&type=style&index=0&id=f723f6d6&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"28935e6a\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraAccordion.vue?vue&type=style&index=0&id=f723f6d6&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraAccordion.vue?vue&type=style&index=0&id=f723f6d6&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./FloatingBall.vue?vue&type=style&index=0&id=3bb5cc6c&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"8caf0956\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./FloatingBall.vue?vue&type=style&index=0&id=3bb5cc6c&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./FloatingBall.vue?vue&type=style&index=0&id=3bb5cc6c&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./OperationDetails.vue?vue&type=style&index=0&id=6079192c&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"2b28b6d1\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./OperationDetails.vue?vue&type=style&index=0&id=6079192c&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./OperationDetails.vue?vue&type=style&index=0&id=6079192c&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `:where(#era-snapshot-ui){--snapshot-text:var(--text-normal,#1f2328);--snapshot-muted:var(--muted,#6b7280);--snapshot-bg:var(--paper,#ffffff);--snapshot-bg-gradient:linear-gradient(to bottom,color-mix(in oklab,var(--paper,#fff),transparent 92%),transparent);--snapshot-stroke:var(--line,rgba(0,0,0,0.12));--snapshot-accent:var(--primary,var(--accent,#4f46e5));--on-accent:var(--on-accent,#ffffff);--snapshot-accent-soft:color-mix(in oklab,var(--snapshot-accent),transparent 82%);--snapshot-outer-shadow:0 6px 18px color-mix(in oklab,#000,transparent 90%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 92%);--snapshot-focus-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 90%);--snapshot-danger:var(--danger,#e11d48);--snapshot-danger-soft:color-mix(in oklab,var(--snapshot-danger),transparent 88%)}:where(html[data-theme='dark'] #era-snapshot-ui),:where(body[data-theme='dark'] #era-snapshot-ui){--snapshot-outer-shadow:0 8px 22px color-mix(in oklab,#000,transparent 70%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 94%)}@media (prefers-color-scheme:dark){#era-snapshot-ui{--snapshot-outer-shadow:0 8px 22px color-mix(in oklab,#000,transparent 72%);--snapshot-inner-shadow:inset 0 1px 0 color-mix(in oklab,#fff,transparent 94%)}}#era-snapshot-ui.snapshot-manager{display:flex;flex-direction:column;gap:16px}#era-snapshot-ui .selector-wrapper{display:block;margin-bottom:4px}#era-snapshot-ui .select-field{position:relative;display:block}#era-snapshot-ui .selector-label{font-size:14px;font-weight:700;color:var(--text-title);flex-shrink:0;letter-spacing:0.2px}#era-snapshot-ui .select-container{position:relative;flex-grow:1;isolation:isolate}#era-snapshot-ui .select-container::after{content:'▾';position:absolute;top:50%;right:12px;transform:translateY(-50%) rotate(0deg);font-size:14px;color:var(--snapshot-muted);pointer-events:none;transition:transform 0.18s ease,color 0.2s ease;z-index:1}#era-snapshot-ui .select-container:focus-within::after{transform:translateY(-50%) rotate(180deg);color:var(--snapshot-accent)}#era-snapshot-ui .mk-selector{width:100%;padding:10px 36px 10px 12px;border-radius:10px;border:1px solid var(--snapshot-stroke);background:var(--snapshot-bg-gradient),var(--snapshot-bg);backdrop-filter:saturate(1.05) blur(2px);color:var(--snapshot-text);font-family:inherit;font-size:14px;line-height:1.2;cursor:pointer;-webkit-appearance:none;appearance:none;transition:border-color 0.18s ease,box-shadow 0.18s ease,background 0.25s ease;box-shadow:var(--snapshot-inner-shadow),var(--snapshot-outer-shadow)}#era-snapshot-ui .mk-selector:hover{border-color:color-mix(in oklab,var(--snapshot-stroke),var(--snapshot-accent) 22%)}#era-snapshot-ui .mk-selector:focus{outline:none;border-color:var(--snapshot-accent);box-shadow:0 0 0 3px var(--snapshot-accent-soft),var(--snapshot-focus-inner-shadow)}#era-snapshot-ui .mk-selector:focus-visible{outline:none}#era-snapshot-ui .mk-selector option{color:var(--snapshot-text);background:var(--snapshot-bg)}#era-snapshot-ui .loading-indicator,#era-snapshot-ui .error-message{padding:18px;text-align:center;border-radius:12px;border:1px dashed var(--line,rgba(0,0,0,0.12));background:var(--bg-empty,rgba(0,0,0,0.03));color:var(--text-normal,#2a2a2a)}#era-snapshot-ui .error-message{color:var(--snapshot-danger);background:var(--snapshot-danger-soft);border-color:color-mix(in oklab,var(--snapshot-danger),transparent 55%)}@media (prefers-reduced-motion:reduce){#era-snapshot-ui .select-container::after,#era-snapshot-ui .mk-selector{transition:none}}#era-snapshot-ui .field-label{position:absolute;top:0;left:12px;transform:translateY(-50%);padding:0 6px;font-size:12px;line-height:1;color:var(--snapshot-muted);background:var(--snapshot-bg);border-radius:6px;pointer-events:none;z-index:1}#era-snapshot-ui .mk-selector{padding-top:22px}#era-snapshot-ui .select-field:focus-within .field-label{color:var(--snapshot-accent)}#era-snapshot-ui .select-container::after{content:'▾';position:absolute;top:50%;right:12px;transform:translateY(-50%);font-size:14px;color:var(--snapshot-muted);pointer-events:none;transition:transform 0.18s ease,color 0.2s ease}#era-snapshot-ui .select-container:focus-within::after{transform:translateY(-50%) rotate(180deg);color:var(--snapshot-accent)}#era-snapshot-ui .id-query-container{display:flex;border-radius:10px;transition:box-shadow 0.18s ease}#era-snapshot-ui .id-query-container:focus-within{box-shadow:0 0 0 3px var(--snapshot-accent-soft)}#era-snapshot-ui .id-input{flex-grow:1;border-top-right-radius:0;border-bottom-right-radius:0;border-right-width:0}#era-snapshot-ui .id-input:focus{box-shadow:none;border-color:var(--snapshot-stroke)}#era-snapshot-ui .query-button{flex-shrink:0;padding:22px 16px 10px;border-radius:10px;border-top-left-radius:0;border-bottom-left-radius:0;background-color:var(--snapshot-btn-bg);color:var(--snapshot-btn-text);border:1px solid var(--snapshot-stroke);font-family:inherit;font-size:14px;line-height:1.2;font-weight:700;cursor:pointer;transition:background-color 0.2s ease,border-color 0.2s ease,transform 0.1s ease}#era-snapshot-ui .query-button:hover{background-color:var(--snapshot-btn-hover-bg);border-color:color-mix(in oklab,var(--snapshot-stroke),var(--snapshot-text) 10%)}#era-snapshot-ui .query-button:active{transform:scale(0.97);background-color:var(--snapshot-btn-active-bg)}#era-snapshot-ui .query-button:focus-visible{outline:none;z-index:1;box-shadow:0 0 0 3px var(--snapshot-accent-soft)}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/SnapshotManager.vue\"],\"names\":[],\"mappings\":\"AAmNA,yBAEE,0CAA4C,CAC5C,qCAAuC,CACvC,kCAAoC,CACpC,mHAIC,CAGD,8CAAmD,CAGnD,sDAAyD,CACzD,oCAAsC,CAGtC,iFAAoF,CACpF,2EAA8E,CAC9E,8EAAiF,CACjF,oFAAuF,CAGvF,uCAAyC,CACzC,iFACF,CAGA,kGAEE,2EAA8E,CAC9E,8EACF,CAGA,mCACE,iBACE,2EAA8E,CAC9E,8EACF,CACF,CAQA,kCAEE,YAAa,CACb,qBAAsB,CACtB,QACF,CAGA,mCAEE,aAAc,CACd,iBACF,CACA,+BAEE,iBAAkB,CAClB,aACF,CAGA,iCAEE,cAAe,CACf,eAAgB,CAChB,uBAAwB,CACxB,aAAc,CACd,oBACF,CAGA,mCAEE,iBAAkB,CAClB,WAAY,CACZ,iBACF,CAGA,0CAEE,WAAY,CACZ,iBAAkB,CAClB,OAAQ,CACR,UAAW,CACX,uCAAwC,CACxC,cAAe,CACf,2BAA4B,CAC5B,mBAAoB,CACpB,+CAEiB,CACjB,SACF,CAGA,uDAEE,yCAA0C,CAC1C,4BACF,CAGA,8BAEE,UAAW,CACX,2BAA4B,CAC5B,kBAAmB,CACnB,uCAAwC,CACxC,yDAA2D,CAC3D,wCAAyC,CACzC,0BAA2B,CAC3B,mBAAoB,CACpB,cAAe,CACf,eAAgB,CAChB,cAAe,CACf,uBAAwB,CAExB,eAAgB,CAChB,8EAGuB,CACvB,oEACF,CAGA,oCAEE,kFACF,CAGA,oCAEE,YAAa,CACb,mCAAoC,CACpC,mFAGF,CACA,4CAEE,YACF,CAGA,qCAEE,0BAA2B,CAC3B,6BACF,CAGA,oEAGE,YAAa,CACb,iBAAkB,CAClB,kBAAmB,CACnB,8CAAmD,CACnD,2CAAgD,CAChD,gCACF,CAGA,gCAEE,4BAA6B,CAC7B,sCAAuC,CACvC,uEACF,CAGA,uCACE,wEAEE,eACF,CACF,CAGA,8BAEE,iBAAkB,CAClB,KAAM,CACN,SAAU,CACV,0BAA2B,CAC3B,aAAc,CACd,cAAe,CACf,aAAc,CACd,2BAA4B,CAC5B,6BAA8B,CAC9B,iBAAkB,CAClB,mBAAoB,CACpB,SACF,CAGA,8BACE,gBACF,CAGA,yDACE,4BACF,CAGA,0CACE,WAAY,CACZ,iBAAkB,CAClB,OAAQ,CACR,UAAW,CACX,0BAA2B,CAC3B,cAAe,CACf,2BAA4B,CAC5B,mBAAoB,CACpB,+CAGF,CAGA,uDACE,yCAA0C,CAC1C,4BACF,CAOA,qCACE,YAAa,CACb,kBAAmB,CACnB,gCACF,CACA,kDACE,gDACF,CAGA,2BACE,WAAY,CACZ,yBAA0B,CAC1B,4BAA6B,CAC7B,oBACF,CAEA,iCACE,eAAgB,CAChB,mCACF,CAGA,+BACE,aAAc,CACd,sBAAuB,CACvB,kBAAmB,CACnB,wBAAyB,CACzB,2BAA4B,CAC5B,uCAAwC,CACxC,8BAA+B,CAC/B,uCAAwC,CACxC,mBAAoB,CACpB,cAAe,CACf,eAAgB,CAChB,eAAgB,CAChB,cAAe,CACf,gFAIF,CACA,qCACE,6CAA8C,CAC9C,gFACF,CACA,sCACE,qBAAsB,CACtB,8CACF,CACA,6CACE,YAAa,CACb,SAAU,CACV,gDACF\",\"sourcesContent\":[\"<template>\\n  <!-- ★ 新增唯一 id：不改变任何逻辑，仅用于限制样式作用域 -->\\n  <div id=\\\"era-snapshot-ui\\\" class=\\\"snapshot-manager\\\">\\n    <div class=\\\"selector-wrapper\\\">\\n      <!-- 外层容器：保留，改为纵向布局更协调 -->\\n      <div class=\\\"select-field\\\" role=\\\"group\\\" aria-labelledby=\\\"mk-label\\\">\\n        <!-- 字段容器：用于浮动标题 -->\\n        <label id=\\\"mk-label\\\" for=\\\"mk-selector\\\" class=\\\"field-label\\\">按消息密钥(MK)查看</label>\\n        <!-- 浮动小标题：不再占用水平空间 -->\\n        <div class=\\\"select-container\\\">\\n          <!-- 下拉容器：保留右侧箭头与阴影效果 -->\\n          <select id=\\\"mk-selector\\\" v-model=\\\"selectedMk\\\" class=\\\"mk-selector\\\" @change=\\\"handleSelectionChange\\\">\\n            <option :value=\\\"null\\\" disabled>-- 从列表中选择 --</option>\\n            <option v-for=\\\"(mk, index) in reversedSelectedMks\\\" :key=\\\"mk || `null-${index}`\\\" :value=\\\"mk\\\">\\n              {{ formatMkForDisplay(mk, index) }}\\n              <!-- 选项显示文本 -->\\n            </option>\\n          </select>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div class=\\\"selector-wrapper\\\">\\n      <div class=\\\"select-field\\\" role=\\\"group\\\" aria-labelledby=\\\"mid-label\\\">\\n        <label id=\\\"mid-label\\\" for=\\\"mid-input\\\" class=\\\"field-label\\\">按消息ID查看</label>\\n        <div class=\\\"id-query-container\\\">\\n          <input\\n            id=\\\"mid-input\\\"\\n            v-model.number=\\\"messageIdInput\\\"\\n            type=\\\"number\\\"\\n            class=\\\"mk-selector id-input\\\"\\n            placeholder=\\\"输入消息 ID...\\\"\\n            @keyup.enter=\\\"queryByMId\\\"\\n          />\\n          <button class=\\\"query-button\\\" @click=\\\"queryByMId\\\">查找</button>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"loading\\\" class=\\\"loading-indicator\\\">正在加载快照...</div>\\n    <div v-if=\\\"error\\\" class=\\\"error-message\\\">{{ error }}</div>\\n\\n    <template v-if=\\\"displayData\\\">\\n      <EraAccordion title=\\\"消息元数据\\\" :default-open=\\\"true\\\">\\n        <MetaHeader :mk=\\\"displayData.mk\\\" :message-id=\\\"displayData.message_id\\\" :is-user=\\\"isUserMessageComputed\\\" />\\n      </EraAccordion>\\n\\n      <TabSwitch v-model:active=\\\"activeTab\\\" :tabs=\\\"tabs\\\">\\n        <template #pure>\\n          <PrettyJsonViewer :value=\\\"displayData.statWithoutMeta\\\" :default-collapsed=\\\"true\\\" :max-depth=\\\"Infinity\\\" />\\n        </template>\\n        <template #full>\\n          <PrettyJsonViewer :value=\\\"displayData.stat\\\" :default-collapsed=\\\"true\\\" :max-depth=\\\"Infinity\\\" />\\n        </template>\\n      </TabSwitch>\\n    </template>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\\nimport type { QueryResultItem, QueryResultPayload, WriteDonePayload } from '../../utils/constants';\\nimport { Logger } from '../../utils/log';\\nimport { isUserMessage } from '../../utils/message';\\nimport EraAccordion from '../template/EraAccordion.vue';\\nimport PrettyJsonViewer from '../template/PrettyJsonViewer.vue';\\nimport TabSwitch from '../template/TabSwitch.vue';\\nimport MetaHeader from './EraPanelContent/MetaHeader.vue';\\n\\ntype DisplayData = Pick<WriteDonePayload, 'mk' | 'message_id' | 'stat' | 'statWithoutMeta'>;\\ntype TabItem = { key: 'pure' | 'full'; label: string };\\n\\nconst props = defineProps<{\\n  latestData: WriteDonePayload | null;\\n}>();\\n\\nconst logger = new Logger();\\n\\nconst latestMkFromProps = computed(() => props.latestData?.mk ?? null);\\nconst selectedMk = ref<string | null>(latestMkFromProps.value);\\nconst messageIdInput = ref<number | null>(null);\\nconst historicalSnapshot = ref<QueryResultItem | null>(null);\\nconst loading = ref(false);\\nconst error = ref<string | null>(null);\\n\\nconst tabs: TabItem[] = [\\n  { key: 'pure', label: '纯净状态数据' },\\n  { key: 'full', label: '完整状态数据' },\\n];\\nconst activeTab = ref<'pure' | 'full'>('pure');\\n\\nconst reversedSelectedMks = computed(() => {\\n  return props.latestData?.selectedMks?.slice().reverse() ?? [];\\n});\\n\\nconst displayData = computed<DisplayData | null>(() => {\\n  // 优先显示查询到的历史快照\\n  if (historicalSnapshot.value) {\\n    return historicalSnapshot.value;\\n  }\\n  // 如果没有历史快照，且当前选中了最新的MK（或默认状态），则显示最新的数据\\n  if (selectedMk.value === latestMkFromProps.value) {\\n    return props.latestData;\\n  }\\n  // 其他情况（如列表选中了非最新项但还没返回结果）不显示\\n  return null;\\n});\\n\\nconst isUserMessageComputed = computed(() => {\\n  if (!displayData.value) return false;\\n  // 如果是历史快照(QueryResultItem)，它会包含 is_user 属性\\n  if ('is_user' in displayData.value) {\\n    return (displayData.value as QueryResultItem).is_user;\\n  }\\n  // 否则，这是最新数据(WriteDonePayload)，我们需要从消息中获取它\\n  const message = getChatMessages(displayData.value.message_id, { include_swipes: false })[0];\\n  return message ? isUserMessage(message) : false;\\n});\\n\\nwatch(\\n  () => latestMkFromProps.value,\\n  newLatestMk => {\\n    // 当外部数据更新时，重置UI到最新状态\\n    selectedMk.value = newLatestMk;\\n    historicalSnapshot.value = null;\\n    messageIdInput.value = null;\\n    error.value = null;\\n    loading.value = false;\\n  },\\n  { immediate: true },\\n);\\n\\nconst handleSelectionChange = () => {\\n  const mk = selectedMk.value;\\n  // 清理其他查询方式的状态\\n  messageIdInput.value = null;\\n  historicalSnapshot.value = null;\\n  error.value = null;\\n\\n  if (!mk || mk === latestMkFromProps.value) {\\n    loading.value = false;\\n    return;\\n  }\\n\\n  loading.value = true;\\n  logger.debug('SnapshotManager', `(MK Select) 请求快照, mk: ${mk}`);\\n  eventEmit('era:getSnapshotAtMk', { mk });\\n};\\n\\nconst queryByMId = () => {\\n  if (messageIdInput.value === null || messageIdInput.value < 0) {\\n    error.value = '请输入一个有效的、非负的消息 ID。';\\n    return;\\n  }\\n  // 清理其他查询方式的状态\\n  selectedMk.value = null; // 从下拉列表中取消选择\\n  historicalSnapshot.value = null;\\n  error.value = null;\\n  loading.value = true;\\n\\n  logger.debug('SnapshotManager', `(ID Query) 请求快照, message_id: ${messageIdInput.value}`);\\n  eventEmit('era:getSnapshotAtMId', { message_id: messageIdInput.value });\\n};\\n\\nconst handleQueryResult = (detail: QueryResultPayload) => {\\n  loading.value = false;\\n\\n  const handleResult = (result: QueryResultItem | null, errorMsg: string) => {\\n    if (result) {\\n      historicalSnapshot.value = result;\\n      // 同步下拉框的选中项\\n      selectedMk.value = result.mk;\\n      error.value = null;\\n    } else {\\n      historicalSnapshot.value = null;\\n      error.value = errorMsg;\\n    }\\n  };\\n\\n  if (detail.queryType === 'getSnapshotAtMk' && detail.request.mk === selectedMk.value) {\\n    handleResult(detail.result as QueryResultItem | null, `未找到与 MK \\\"${selectedMk.value}\\\" 相关的快照。`);\\n  } else if (detail.queryType === 'getSnapshotAtMId' && detail.request.message_id === messageIdInput.value) {\\n    handleResult(detail.result as QueryResultItem | null, `未找到与消息 ID \\\"${messageIdInput.value}\\\" 相关的快照。`);\\n  }\\n};\\n\\nconst formatMkForDisplay = (mk: string | null, index: number): string => {\\n  const total = reversedSelectedMks.value.length;\\n  const msgId = total - 1 - index;\\n  const isLatest = mk === latestMkFromProps.value;\\n\\n  if (!mk) return `消息 ${msgId} (无MK)`;\\n\\n  const shortMk = mk.substring(mk.length - 6);\\n  const label = `消息 ${msgId} (...${shortMk})`;\\n\\n  return isLatest ? `${label} (最新)` : label;\\n};\\n\\nonMounted(() => {\\n  eventOn('era:queryResult', handleQueryResult);\\n});\\n\\nonUnmounted(() => {\\n  eventRemoveListener('era:queryResult', handleQueryResult);\\n});\\n</script>\\n\\n<!-- ★ 取消 scoped，统一以 #era-snapshot-ui 作为“伪作用域”根选择器 -->\\n<style>\\n/* ───────── 局部主题变量映射：让本组件随全局明/暗主题自动变色 ───────── */\\n:where(#era-snapshot-ui) {\\n  /* 文本与背景（映射全局变量，若不存在则使用安全回退值） */\\n  --snapshot-text: var(--text-normal, #1f2328); /* 常规文字色 */\\n  --snapshot-muted: var(--muted, #6b7280); /* 次级文字色 */\\n  --snapshot-bg: var(--paper, #ffffff); /* 控件/卡片底色 */\\n  --snapshot-bg-gradient: linear-gradient(\\n    to bottom,\\n    color-mix(in oklab, var(--paper, #fff), transparent 92%),\\n    transparent\\n  );\\n\\n  /* 线条与描边 */\\n  --snapshot-stroke: var(--line, rgba(0, 0, 0, 0.12)); /* 统一描边色 */\\n\\n  /* 品牌/强调色（优先使用 --primary；否则退回 --accent，再退回一个安全紫靛） */\\n  --snapshot-accent: var(--primary, var(--accent, #4f46e5));\\n  --on-accent: var(--on-accent, #ffffff); /* 强调底上的可读前景色 */\\n\\n  /* 软光环/阴影（随主题微调） */\\n  --snapshot-accent-soft: color-mix(in oklab, var(--snapshot-accent), transparent 82%);\\n  --snapshot-outer-shadow: 0 6px 18px color-mix(in oklab, #000, transparent 90%);\\n  --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 92%);\\n  --snapshot-focus-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 90%);\\n\\n  /* 危险/错误色（映射全局 danger，没有则回退红色系） */\\n  --snapshot-danger: var(--danger, #e11d48);\\n  --snapshot-danger-soft: color-mix(in oklab, var(--snapshot-danger), transparent 88%);\\n}\\n\\n/* （可选）若你的 ThemeToggle 通过 data-theme 切换，这段让暗色阴影层次更自然 */\\n:where(html[data-theme='dark'] #era-snapshot-ui),\\n:where(body[data-theme='dark'] #era-snapshot-ui) {\\n  --snapshot-outer-shadow: 0 8px 22px color-mix(in oklab, #000, transparent 70%);\\n  --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 94%);\\n}\\n\\n/* （亦可选）系统级暗色偏好时的微调：双保险 */\\n@media (prefers-color-scheme: dark) {\\n  #era-snapshot-ui {\\n    --snapshot-outer-shadow: 0 8px 22px color-mix(in oklab, #000, transparent 72%);\\n    --snapshot-inner-shadow: inset 0 1px 0 color-mix(in oklab, #fff, transparent 94%);\\n  }\\n}\\n\\n/* =========================\\n   ERA Snapshot 下拉框主题（仅限本组件）\\n   通过唯一根选择器 #era-snapshot-ui 约束作用范围\\n   ========================= */\\n\\n/* ---- 根容器：保留原布局，增强可读间距 ---- */\\n#era-snapshot-ui.snapshot-manager {\\n  /* 仅限本组件根容器 */\\n  display: flex; /* 弹性布局：竖向栈 */\\n  flex-direction: column; /* 纵向排列 */\\n  gap: 16px; /* 行距 */\\n}\\n\\n/* ---- 选择器区域：标签与下拉并排 ---- */\\n#era-snapshot-ui .selector-wrapper {\\n  /* 选择器外层容器 */\\n  display: block; /* 纵向堆叠，标题在上，下拉在下 */\\n  margin-bottom: 4px; /* 底部留一点呼吸 */\\n}\\n#era-snapshot-ui .select-field {\\n  /* 字段容器 */\\n  position: relative; /* 作为浮动标题的定位上下文 */\\n  display: block; /* 独占一行，便于对齐其他控件 */\\n}\\n\\n/* ---- 左侧标签：略提权重与对比度 ---- */\\n#era-snapshot-ui .selector-label {\\n  /* “查看快照:” 标签 */\\n  font-size: 14px; /* 字号 */\\n  font-weight: 700; /* 加粗，便于识别 */\\n  color: var(--text-title); /* 使用标题色 */\\n  flex-shrink: 0; /* 不随容器收缩 */\\n  letter-spacing: 0.2px; /* 微调字距，增强精致感 */\\n}\\n\\n/* ---- 下拉容器：做“输入框卡片”视觉 ---- */\\n#era-snapshot-ui .select-container {\\n  /* 下拉容器 */\\n  position: relative; /* 用于放置内置箭头 */\\n  flex-grow: 1; /* 占满剩余宽度 */\\n  isolation: isolate; /* 防止子层混合到外部 */\\n}\\n\\n/* ---- 自定义下拉箭头：跟随焦点旋转 ---- */\\n#era-snapshot-ui .select-container::after {\\n  /* 右侧箭头 */\\n  content: '▾'; /* 使用更纤细的三角字符 */\\n  position: absolute; /* 绝对定位到右侧 */\\n  top: 50%; /* 垂直居中基准 */\\n  right: 12px; /* 右侧内边距 */\\n  transform: translateY(-50%) rotate(0deg); /* 居中与初始角度 */\\n  font-size: 14px; /* 箭头字号 */\\n  color: var(--snapshot-muted); /* 箭头颜色 */\\n  pointer-events: none; /* 不遮挡点击 */\\n  transition:\\n    transform 0.18s ease,\\n    color 0.2s ease; /* 旋转与颜色过渡 */\\n  z-index: 1; /* 在下拉之上但仍在容器内 */\\n}\\n\\n/* ---- 焦点时箭头旋转，提示“已激活” ---- */\\n#era-snapshot-ui .select-container:focus-within::after {\\n  /* 容器获焦 */\\n  transform: translateY(-50%) rotate(180deg); /* 箭头翻转 */\\n  color: var(--snapshot-accent); /* 用主色提示激活 */\\n}\\n\\n/* ---- 下拉本体：做“半玻璃输入框 + 细描边 + 阴影” ---- */\\n#era-snapshot-ui .mk-selector {\\n  /* 原下拉元素 */\\n  width: 100%; /* 占满容器宽度 */\\n  padding: 10px 36px 10px 12px; /* 留出右侧箭头空间 */\\n  border-radius: 10px; /* 圆角输入框 */\\n  border: 1px solid var(--snapshot-stroke); /* 细描边 */\\n  background: var(--snapshot-bg-gradient), var(--snapshot-bg); /* 基底色（卡片色） */\\n  backdrop-filter: saturate(1.05) blur(2px); /* 轻玻璃效果（有支持的浏览器） */\\n  color: var(--snapshot-text); /* 文本颜色 */\\n  font-family: inherit; /* 继承字体 */\\n  font-size: 14px; /* 字号 */\\n  line-height: 1.2; /* 行高 */\\n  cursor: pointer; /* 指针形态 */\\n  -webkit-appearance: none; /* 去除默认外观：Safari/Chrome */\\n  -moz-appearance: none; /* 去除默认外观：Firefox */\\n  appearance: none; /* 标准去除默认外观 */\\n  transition:\\n    border-color 0.18s ease,\\n    box-shadow 0.18s ease,\\n    background 0.25s ease; /* 交互过渡 */\\n  box-shadow: var(--snapshot-inner-shadow), var(--snapshot-outer-shadow); /* 轻外阴影，浮起感 */\\n}\\n\\n/* ---- 悬停：描边加深，提示可交互 ---- */\\n#era-snapshot-ui .mk-selector:hover {\\n  /* 悬停态 */\\n  border-color: color-mix(in oklab, var(--snapshot-stroke), var(--snapshot-accent) 22%); /* 混合一点主色 */\\n}\\n\\n/* ---- 焦点/键盘访问：主色描边 + 柔光外环 ---- */\\n#era-snapshot-ui .mk-selector:focus {\\n  /* 焦点态（含鼠标） */\\n  outline: none; /* 移除系统外描边 */\\n  border-color: var(--snapshot-accent); /* 主色描边 */\\n  box-shadow:\\n    0 0 0 3px var(--snapshot-accent-soft),\\n    /* 柔光外环 */ var(--snapshot-focus-inner-shadow); /* 保留内高光 */\\n}\\n#era-snapshot-ui .mk-selector:focus-visible {\\n  /* 键盘可见焦点态 */\\n  outline: none; /* 保持一致 */\\n}\\n\\n/* ---- 选项样式（可控性有限，不同系统略有差异） ---- */\\n#era-snapshot-ui .mk-selector option {\\n  /* 下拉列表项 */\\n  color: var(--snapshot-text); /* 文本色 */\\n  background: var(--snapshot-bg); /* 背景色 */\\n}\\n\\n/* ---- 加载 / 错误块：统一卡片化观感 ---- */\\n#era-snapshot-ui .loading-indicator,\\n#era-snapshot-ui .error-message {\\n  /* 信息卡片 */\\n  padding: 18px; /* 内边距 */\\n  text-align: center; /* 居中展示 */\\n  border-radius: 12px; /* 圆角 */\\n  border: 1px dashed var(--line, rgba(0, 0, 0, 0.12)); /* 虚线边界 */\\n  background: var(--bg-empty, rgba(0, 0, 0, 0.03)); /* 空态背景 */\\n  color: var(--text-normal, #2a2a2a); /* 文字色 */\\n}\\n\\n/* ---- 错误态：更醒目的红系提示，但保持柔和 ---- */\\n#era-snapshot-ui .error-message {\\n  /* ❗三件套全部改为 snapshot danger 系列，自动随主题适配 */\\n  color: var(--snapshot-danger);\\n  background: var(--snapshot-danger-soft);\\n  border-color: color-mix(in oklab, var(--snapshot-danger), transparent 55%);\\n}\\n\\n/* ---- 细节优化：在低运动偏好下关闭动画 ---- */\\n@media (prefers-reduced-motion: reduce) {\\n  #era-snapshot-ui .select-container::after,\\n  #era-snapshot-ui .mk-selector {\\n    transition: none; /* 关闭过渡 */\\n  }\\n}\\n\\n/* ── 浮动标题：微型标签，悬停于输入框上边缘 ── */\\n#era-snapshot-ui .field-label {\\n  /* 浮动标题文本“查看快照” */\\n  position: absolute; /* 绝对定位到输入框之上 */\\n  top: 0; /* 贴近容器顶部 */\\n  left: 12px; /* 与输入框左内边距对齐 */\\n  transform: translateY(-50%); /* 上移半行，呈“贴边悬浮”效果 */\\n  padding: 0 6px; /* 小口袋背景，避免与输入框边线重叠 */\\n  font-size: 12px; /* 微小字号，作为字段名 */\\n  line-height: 1; /* 紧凑行高 */\\n  color: var(--snapshot-muted); /* 次要文字色 */\\n  background: var(--snapshot-bg); /* 背景同卡片色，营造“挖空”效果 */\\n  border-radius: 6px; /* 圆润角 */\\n  pointer-events: none; /* 不遮挡点击到 select */\\n  z-index: 1; /* 盖在输入框描边之上 */\\n}\\n\\n/* ── 让下拉本体为浮动标题“腾位”：加上足够的上内边距 ── */\\n#era-snapshot-ui .mk-selector {\\n  padding-top: 22px;\\n}\\n\\n/* ── 可选：当获得焦点时，标题颜色联动强调 ── */\\n#era-snapshot-ui .select-field:focus-within .field-label {\\n  color: var(--snapshot-accent);\\n}\\n\\n/* ── 箭头：保持你先前的右侧内置箭头样式不变（引用已有规则） ── */\\n#era-snapshot-ui .select-container::after {\\n  content: '▾';\\n  position: absolute;\\n  top: 50%;\\n  right: 12px;\\n  transform: translateY(-50%);\\n  font-size: 14px;\\n  color: var(--snapshot-muted);\\n  pointer-events: none;\\n  transition:\\n    transform 0.18s ease,\\n    color 0.2s ease;\\n}\\n\\n/* ── 获焦时箭头联动旋转高亮（如果你之前已有此规则，可保留任一版本） ── */\\n#era-snapshot-ui .select-container:focus-within::after {\\n  transform: translateY(-50%) rotate(180deg);\\n  color: var(--snapshot-accent);\\n}\\n\\n/* =========================\\n   ID 查询输入框与按钮\\n   ========================= */\\n\\n/* 容器：实现无缝拼接和整体焦点效果 */\\n#era-snapshot-ui .id-query-container {\\n  display: flex;\\n  border-radius: 10px;\\n  transition: box-shadow 0.18s ease;\\n}\\n#era-snapshot-ui .id-query-container:focus-within {\\n  box-shadow: 0 0 0 3px var(--snapshot-accent-soft);\\n}\\n\\n/* 输入框：继承 .mk-selector 样式，并调整拼接侧的圆角和边框 */\\n#era-snapshot-ui .id-input {\\n  flex-grow: 1;\\n  border-top-right-radius: 0;\\n  border-bottom-right-radius: 0;\\n  border-right-width: 0;\\n}\\n/* 输入框获焦时，由父容器处理阴影 */\\n#era-snapshot-ui .id-input:focus {\\n  box-shadow: none;\\n  border-color: var(--snapshot-stroke);\\n}\\n\\n/* 查询按钮：独立且完整的样式，确保高度一致 */\\n#era-snapshot-ui .query-button {\\n  flex-shrink: 0;\\n  padding: 22px 16px 10px; /* 统一垂直 padding 以对齐输入框 */\\n  border-radius: 10px;\\n  border-top-left-radius: 0;\\n  border-bottom-left-radius: 0;\\n  background-color: var(--snapshot-btn-bg);\\n  color: var(--snapshot-btn-text);\\n  border: 1px solid var(--snapshot-stroke);\\n  font-family: inherit;\\n  font-size: 14px;\\n  line-height: 1.2;\\n  font-weight: 700;\\n  cursor: pointer;\\n  transition:\\n    background-color 0.2s ease,\\n    border-color 0.2s ease,\\n    transform 0.1s ease;\\n}\\n#era-snapshot-ui .query-button:hover {\\n  background-color: var(--snapshot-btn-hover-bg);\\n  border-color: color-mix(in oklab, var(--snapshot-stroke), var(--snapshot-text) 10%);\\n}\\n#era-snapshot-ui .query-button:active {\\n  transform: scale(0.97);\\n  background-color: var(--snapshot-btn-active-bg);\\n}\\n#era-snapshot-ui .query-button:focus-visible {\\n  outline: none;\\n  z-index: 1; /* 确保焦点阴影在最上层 */\\n  box-shadow: 0 0 0 3px var(--snapshot-accent-soft);\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.era-app-container{position:fixed;inset:0;z-index:2147483646;pointer-events:none;isolation:isolate;contain:layout style paint;width:100svw;height:100svh}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/App.vue\"],\"names\":[],\"mappings\":\"AAoEA,mBAEE,cAAe,CACf,OAAQ,CACR,kBAAmB,CACnB,mBAAoB,CACpB,iBAAkB,CAClB,0BAA2B,CAC3B,YAAa,CACb,aACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"era-app-container\\\" :class=\\\"{ 'dark-theme': isDarkMode }\\\">\\n    <ThemeManager ref=\\\"themeManager\\\" />\\n    <FloatingBall v-show=\\\"currentComponent === 'FloatingBall'\\\" @click=\\\"requestSwitchView('ExpandedView')\\\" />\\n    <div v-show=\\\"currentComponent === 'ExpandedView'\\\" class=\\\"era-expanded-layer\\\">\\n      <!-- 视口级展开层：悬浮模态容器 -->\\n      <div class=\\\"era-shell\\\">\\n        <!-- 新增横向壳容器：左面板 + 右侧栏 -->\\n        <EraPanel :data=\\\"dataRef\\\" />\\n        <RightRail />\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { storeToRefs } from 'pinia';\\nimport { onBeforeUnmount, onMounted, ref } from 'vue';\\nimport { getScriptSettings } from '../utils/era_data';\\nimport { Logger } from '../utils/log';\\nimport EraPanel from './components/EraPanel.vue';\\nimport FloatingBall from './components/FloatingBall.vue';\\nimport RightRail from './components/RightRail.vue';\\nimport ThemeManager from './components/ThemeManager.vue';\\nimport { useUiStore } from './store';\\n\\nconst logger = new Logger();\\n\\n// 从 Pinia store 获取状态和 action\\nconst uiStore = useUiStore();\\nconst { currentView: currentComponent, eventData: dataRef } = storeToRefs(uiStore);\\n\\n// 主题状态管理\\nconst themeManager = ref<InstanceType<typeof ThemeManager> | null>(null);\\nconst isDarkMode = ref(false);\\n\\nconst loadThemeSetting = () => {\\n  try {\\n    const settings = getScriptSettings();\\n    const darkModeValue = settings?.['开启黑夜模式'] ?? false;\\n    isDarkMode.value = darkModeValue;\\n    if (themeManager.value) {\\n      themeManager.value.isDarkMode = darkModeValue;\\n    }\\n    logger.debug('loadThemeSetting', `主题已更新为: ${darkModeValue ? 'Dark' : 'Light'}`);\\n  } catch (e) {\\n    logger.error('loadThemeSetting', '加载主题设置失败', e);\\n    isDarkMode.value = false; // Fallback to light mode\\n  }\\n};\\n\\nonMounted(() => {\\n  loadThemeSetting();\\n  window.addEventListener('era-settings-updated', loadThemeSetting);\\n});\\n\\nonBeforeUnmount(() => {\\n  window.removeEventListener('era-settings-updated', loadThemeSetting);\\n});\\n\\nconst requestSwitchView = (viewName: 'FloatingBall' | 'ExpandedView') => {\\n  logger.debug('requestSwitchView', `请求切换视图到: ${viewName}`);\\n  uiStore.switchView(viewName);\\n};\\n</script>\\n\\n<style>\\n/* App.vue 视口级悬浮容器（替换原有 .era-app-container） */\\n.era-app-container {\\n  /* 作为全局悬浮层根容器 */\\n  position: fixed; /* 固定在视口，不受外层布局影响 */\\n  inset: 0; /* 覆盖整个视口区域（top/right/bottom/left 全 0） */\\n  z-index: 2147483646; /* 超高层级，盖住站点其它层 */\\n  pointer-events: none; /* 默认不截获点击，避免阻挡页面 */\\n  isolation: isolate; /* 新建独立层叠上下文，防止被外层混合影响 */\\n  contain: layout style paint; /* 创建渲染封装，减少外界干扰 */\\n  width: 100svw; /* 适配移动端动态视口宽度 */\\n  height: 100svh; /* 适配移动端动态视口高度 */\\n}\\n</style>\\n\\n<style scoped>\\n/* 从 EraDataPanel.vue 迁移过来的样式 */\\n\\n/* ===[新增] 横向壳：左面板 + 右侧栏（按钮）=== */\\n.era-shell {\\n  /* 横向包裹容器 */ /* 中文注释：横向排列容器 */\\n  display: flex; /* 横向布局 */ /* 中文注释：flex 横排 */\\n  align-items: flex-start; /* 顶对齐 */ /* 中文注释：上缘对齐 */\\n  gap: 12px; /* 左右间距 */ /* 中文注释：元素间距 */\\n  flex-wrap: nowrap; /* 默认不换行 */ /* 中文注释：保持并排 */\\n}\\n\\n/* 保持面板宽高（原样），但让它更好地在横向中自适应 */\\n:deep(.era-panel) {\\n  flex: 0 1 auto; /* 面板按自身宽度布局 */\\n}\\n\\n/* 小屏回落：改为上下堆叠（按钮在下） */\\n@media (max-width: 992px) {\\n  /* 992px (平板) 以下回落 */\\n  .era-shell {\\n    flex-wrap: wrap; /* 允许换行 */\\n  }\\n  :deep(.era-panel),\\n  :deep(.right-rail) {\\n    width: 100%; /* 各占一行 */\\n    flex-basis: auto; /* 重置 flex-basis */\\n  }\\n  :deep(.right-rail) {\\n    position: static; /* 取消吸顶 */\\n    margin-top: 12px; /* 与上方留白 */\\n    height: auto; /* 高度自适应 */\\n    max-height: 40vh; /* 限制最大高度，避免过长 */\\n  }\\n}\\n\\n/* ===[新增] 悬浮球：固定在右下角 + 开启点击 === */\\n:deep(.floating-ball) {\\n  /* 选中子组件根元素（scoped 下用 deep） */\\n  position: fixed; /* 固定定位到视口 */\\n  right: max(16px, env(safe-area-inset-right)); /* 右侧安全区 + 基础边距 */\\n  bottom: max(90px, env(safe-area-inset-bottom)); /* 底部安全区 + 基础边距 */\\n  z-index: 2147483647; /* 高于容器根，确保始终可点 */\\n  pointer-events: auto; /* 启用点击（父容器是 none） */\\n  touch-action: manipulation; /* 移动端减少点击延迟 */\\n  will-change: transform; /* 提前分层，避免站点 3D/滤镜影响 */\\n}\\n\\n/* ===[新增] 展开层：视口级模态容器（只在 ExpandedView v-show 为 true 时存在） === */\\n.era-expanded-layer {\\n  /* 绑定在模板新增的 class */\\n  position: fixed; /* 固定在视口（不受外层布局约束） */\\n  inset: 0; /* 铺满视口 */\\n  display: grid; /* 用 grid 居中内容 */\\n  place-items: center; /* 水平垂直置中 */\\n  padding: clamp(12px, 2.5vw, 24px); /* 视口自适应内边距 */\\n  pointer-events: auto; /* 启用点击（与父容器的 none 区分） */\\n  z-index: 2147483646; /* 仅次于悬浮球，保证在最上层 */\\n  background: transparent; /* 如需半透明遮罩可改为 rgba(0,0,0,.25) */\\n  overflow: auto; /* 内容超出时，容器自身滚动，不被裁剪 */\\n}\\n\\n/* ===[新增] 小屏适配：面板在移动端更“填充”可视区 === */\\n@media (max-width: 640px) {\\n  /* 针对手机宽度 */\\n  :deep(.era-panel) {\\n    /* 重设面板宽高更贴合手机 */\\n    width: min(92vw, 560px); /* 放宽到 92vw，避免 60vw 太窄 */\\n    height: min(88vh, calc(100svh - 32px)); /* 兼顾状态栏/地址栏动态高度 */\\n  }\\n  .panel-body {\\n    /* 主要内容区滚动容器 */\\n    overscroll-behavior: contain; /* 防止滚动牵动背景页面 */\\n  }\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./MetaHeader.vue?vue&type=style&index=0&id=9a5820b4&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"b1ac160e\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./MetaHeader.vue?vue&type=style&index=0&id=9a5820b4&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./MetaHeader.vue?vue&type=style&index=0&id=9a5820b4&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./AboutEra.vue?vue&type=style&index=0&id=9b1026a6&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"4633824b\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./AboutEra.vue?vue&type=style&index=0&id=9b1026a6&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./AboutEra.vue?vue&type=style&index=0&id=9b1026a6&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./TabSwitch.vue?vue&type=style&index=0&id=2874077c&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"03c8c1f6\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./TabSwitch.vue?vue&type=style&index=0&id=2874077c&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./TabSwitch.vue?vue&type=style&index=0&id=2874077c&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ActionButtons.vue?vue&type=style&index=0&id=3cd160a6&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"6150052a\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ActionButtons.vue?vue&type=style&index=0&id=3cd160a6&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ActionButtons.vue?vue&type=style&index=0&id=3cd160a6&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.meta[data-v-9a5820b4]{position:relative;border:1px solid var(--border-soft);border-radius:12px;background:var(--meta-bg);box-shadow:var(--meta-shadow),var(--settings-shadow-inset);transition:background 0.3s ease,border-color 0.3s ease}.kv[data-v-9a5820b4]{display:grid;grid-template-columns:120px 1fr;gap:8px 12px}.item[data-v-9a5820b4]{display:contents}.k[data-v-9a5820b4]{justify-self:start;align-self:center;font-size:12px;color:var(--text-normal);background:var(--meta-key-bg);border:1px solid var(--settings-border-input);padding:4px 8px;border-radius:8px;font-weight:700;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.v[data-v-9a5820b4]{align-self:center;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:var(--settings-text-input);background:var(--bg-solid);border:1px solid var(--settings-border-input);padding:6px 8px;border-radius:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/EraPanelContent/MetaHeader.vue\"],\"names\":[],\"mappings\":\"AAgDA,uBACE,iBAAkB,CAElB,mCAAoC,CACpC,kBAAmB,CACnB,yBAA0B,CAC1B,0DAA4D,CAC5D,sDAGF,CAEA,qBACE,YAAa,CACb,+BAAgC,CAChC,YACF,CACA,uBACE,gBACF,CACA,oBACE,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,6BAA8B,CAC9B,6CAA8C,CAC9C,eAAgB,CAChB,iBAAkB,CAClB,eAAgB,CAChB,sEAIF,CACA,oBACE,iBAAkB,CAClB,iDAAqD,CACrD,cAAe,CACf,gCAAiC,CACjC,0BAA2B,CAC3B,6CAA8C,CAC9C,eAAgB,CAChB,iBAAkB,CAClB,eAAgB,CAChB,sBAAuB,CACvB,kBAAmB,CACnB,sEAIF\",\"sourcesContent\":[\"<template>\\n  <section class=\\\"meta\\\">\\n    <div class=\\\"kv\\\">\\n      <div class=\\\"item\\\">\\n        <span class=\\\"k\\\">mk</span>\\n        <!-- 键：mk -->\\n        <span class=\\\"v\\\" :title=\\\"mk\\\">{{ mk || '—' }}</span>\\n        <!-- 值：mk -->\\n      </div>\\n      <div class=\\\"item\\\">\\n        <span class=\\\"k\\\">message_id</span>\\n        <!-- 键：message_id -->\\n        <span class=\\\"v\\\">{{ messageId ?? '—' }}</span>\\n        <!-- 值：message_id -->\\n      </div>\\n      <div class=\\\"item\\\">\\n        <span class=\\\"k\\\">来源</span>\\n        <!-- 键：来源 -->\\n        <span class=\\\"v\\\">{{ isUser ? '用户' : 'AI' }}</span>\\n        <!-- 值：来源 -->\\n      </div>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { onMounted, watch } from 'vue';\\nimport { Logger } from '../../../utils/log';\\n\\nconst logger = new Logger();\\n\\n// 接收父组件传入的两个字段\\nconst props = defineProps<{ mk: string; messageId: number; isUser: boolean }>(); // 简单的只读展示\\n\\nonMounted(() => {\\n  //logger.debug('onMounted', '组件已挂载', { props });\\n});\\n\\nwatch(\\n  () => props,\\n  newProps => {\\n    logger.debug('watch:props', 'Props 发生变化', { newProps });\\n  },\\n  { deep: true },\\n);\\n</script>\\n\\n<style scoped>\\n.meta {\\n  position: relative;\\n  /* padding is handled by EraAccordion's .inner */\\n  border: 1px solid var(--border-soft);\\n  border-radius: 12px;\\n  background: var(--meta-bg);\\n  box-shadow: var(--meta-shadow), var(--settings-shadow-inset);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n.kv {\\n  display: grid;\\n  grid-template-columns: 120px 1fr;\\n  gap: 8px 12px;\\n}\\n.item {\\n  display: contents;\\n}\\n.k {\\n  justify-self: start;\\n  align-self: center;\\n  font-size: 12px;\\n  color: var(--text-normal);\\n  background: var(--meta-key-bg);\\n  border: 1px solid var(--settings-border-input);\\n  padding: 4px 8px;\\n  border-radius: 8px;\\n  font-weight: 700;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n.v {\\n  align-self: center;\\n  font-family: ui-monospace, Menlo, Consolas, monospace;\\n  font-size: 12px;\\n  color: var(--settings-text-input);\\n  background: var(--bg-solid);\\n  border: 1px solid var(--settings-border-input);\\n  padding: 6px 8px;\\n  border-radius: 8px;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.details-wrapper[data-v-6079192c]{display:flex;flex-direction:column;gap:10px}.detail-block[data-v-6079192c]{padding:10px 12px;background:var(--bg-soft);border:1px solid var(--border-soft);border-radius:10px;transition:background 0.3s ease,border-color 0.3s ease}.detail-title[data-v-6079192c]{margin:0 0 8px;font-size:13px;font-weight:800;color:var(--text-subtitle);transition:color 0.3s ease}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/EraPanelContent/OperationDetails.vue\"],\"names\":[],\"mappings\":\"AA4BA,kCACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,+BACE,iBAAkB,CAClB,yBAA0B,CAC1B,mCAAoC,CACpC,kBAAmB,CACnB,sDAGF,CAEA,+BACE,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,0BAA2B,CAC3B,0BACF\",\"sourcesContent\":[\"<template>\\n  <EraAccordion title=\\\"ERA 最新操作详情\\\" :default-open=\\\"false\\\">\\n    <template #default>\\n      <div class=\\\"details-wrapper\\\">\\n        <div class=\\\"detail-block\\\">\\n          <h4 class=\\\"detail-title\\\">SelectedMks（数组）</h4>\\n          <PrettyJsonViewer :value=\\\"data.selectedMks\\\" :default-collapsed=\\\"true\\\" :max-depth=\\\"3\\\" />\\n        </div>\\n        <div class=\\\"detail-block\\\">\\n          <h4 class=\\\"detail-title\\\">EditLogs（对象）</h4>\\n          <PrettyJsonViewer :value=\\\"data.editLogs\\\" :default-collapsed=\\\"true\\\" :max-depth=\\\"2\\\" />\\n        </div>\\n      </div>\\n    </template>\\n  </EraAccordion>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport type { WriteDonePayload } from '../../../utils/constants';\\nimport EraAccordion from '../../template/EraAccordion.vue';\\nimport PrettyJsonViewer from '../../template/PrettyJsonViewer.vue';\\n\\ndefineProps<{\\n  data: WriteDonePayload;\\n}>();\\n</script>\\n\\n<style scoped>\\n.details-wrapper {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n}\\n\\n.detail-block {\\n  padding: 10px 12px;\\n  background: var(--bg-soft);\\n  border: 1px solid var(--border-soft);\\n  border-radius: 10px;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n.detail-title {\\n  margin: 0 0 8px;\\n  font-size: 13px;\\n  font-weight: 800;\\n  color: var(--text-subtitle);\\n  transition: color 0.3s ease;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.tabs[data-v-2874077c]{border:1px solid var(--border-soft);border-radius:12px;overflow:hidden;background:var(--accordion-bg);transition:background 0.3s ease,border-color 0.3s ease}.tab-bar[data-v-2874077c]{display:flex;gap:8px;padding:8px;border-bottom:1px solid var(--border-soft);background:var(--mk-pill-null-bg);transition:background 0.3s ease,border-color 0.3s ease}.tab-btn[data-v-2874077c]{padding:8px 12px;font-weight:800;font-size:13px;color:var(--text-normal);background:var(--bg-solid);border:1px solid var(--settings-border-input);border-radius:10px;cursor:pointer;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,box-shadow 0.3s ease}.tab-btn.active[data-v-2874077c]{color:var(--settings-text-input);border-color:var(--settings-border-btn-primary);box-shadow:var(--settings-shadow-inset),var(--tab-active-shadow)}.tab-content[data-v-2874077c]{padding:10px 12px;background:var(--tab-content-bg);transition:background 0.3s ease}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/template/TabSwitch.vue\"],\"names\":[],\"mappings\":\"AA+DA,uBACE,mCAAoC,CACpC,kBAAmB,CACnB,eAAgB,CAChB,8BAA+B,CAC/B,sDAGF,CACA,0BACE,YAAa,CACb,OAAQ,CACR,WAAY,CACZ,0CAA2C,CAC3C,iCAAkC,CAClC,sDAGF,CACA,0BACE,gBAAiB,CACjB,eAAgB,CAChB,cAAe,CACf,wBAAyB,CACzB,0BAA2B,CAC3B,6CAA8C,CAC9C,kBAAmB,CACnB,cAAe,CACf,2FAKF,CACA,iCACE,gCAAiC,CACjC,+CAAgD,CAChD,gEACF,CACA,8BACE,iBAAkB,CAClB,gCAAiC,CACjC,+BACF\",\"sourcesContent\":[\"<template>\\n  <section class=\\\"tabs\\\">\\n    <!-- 页签行 -->\\n    <div class=\\\"tab-bar\\\" role=\\\"tablist\\\">\\n      <button\\n        v-for=\\\"t in tabs\\\"\\n        :key=\\\"t.key\\\"\\n        class=\\\"tab-btn\\\"\\n        :class=\\\"{ active: t.key === innerActive }\\\"\\n        role=\\\"tab\\\"\\n        @click=\\\"setActive(t.key)\\\"\\n      >\\n        {{ t.label }}\\n      </button>\\n    </div>\\n\\n    <!-- 内容区：根据活动键渲染对应插槽 -->\\n    <div class=\\\"tab-content\\\">\\n      <div v-if=\\\"innerActive === 'pure'\\\">\\n        <slot name=\\\"pure\\\" />\\n        <!-- 纯净状态数据内容 -->\\n      </div>\\n      <div v-else>\\n        <slot name=\\\"full\\\" />\\n        <!-- 完整状态数据内容 -->\\n      </div>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { onMounted, ref, watch } from 'vue'; // 引入响应式工具\\nimport { Logger } from '../../utils/log';\\n\\ntype TabItem = { key: 'pure' | 'full'; label: string }; // Tab 项类型\\n\\nconst logger = new Logger();\\nconst props = defineProps<{ tabs: TabItem[]; active?: 'pure' | 'full' }>(); // 输入 tabs 与可选 active\\nconst emit = defineEmits<{ 'update:active': ['pure' | 'full'] }>(); // v-model:active\\n\\nconst innerActive = ref<'pure' | 'full'>(props.active ?? 'pure'); // 内部活动键\\n\\nwatch(\\n  () => props.active,\\n  v => {\\n    if (v) {\\n      logger.debug('watch:active', `外部同步 active tab 为: ${v}`);\\n      innerActive.value = v;\\n    }\\n  },\\n); // 外部变更时同步\\nfunction setActive(k: 'pure' | 'full') {\\n  logger.debug('setActive', `用户点击，切换 tab 到: ${k}`);\\n  innerActive.value = k;\\n  emit('update:active', k);\\n} // 切换并抛出\\n\\nonMounted(() => {\\n  //logger.debug('onMounted', '组件已挂载', { props });\\n});\\n</script>\\n\\n<style scoped>\\n.tabs {\\n  border: 1px solid var(--border-soft);\\n  border-radius: 12px;\\n  overflow: hidden;\\n  background: var(--accordion-bg);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n.tab-bar {\\n  display: flex;\\n  gap: 8px;\\n  padding: 8px;\\n  border-bottom: 1px solid var(--border-soft);\\n  background: var(--mk-pill-null-bg);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n.tab-btn {\\n  padding: 8px 12px;\\n  font-weight: 800;\\n  font-size: 13px;\\n  color: var(--text-normal);\\n  background: var(--bg-solid);\\n  border: 1px solid var(--settings-border-input);\\n  border-radius: 10px;\\n  cursor: pointer;\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease,\\n    box-shadow 0.3s ease;\\n}\\n.tab-btn.active {\\n  color: var(--settings-text-input);\\n  border-color: var(--settings-border-btn-primary);\\n  box-shadow: var(--settings-shadow-inset), var(--tab-active-shadow);\\n}\\n.tab-content {\\n  padding: 10px 12px;\\n  background: var(--tab-content-bg);\\n  transition: background 0.3s ease;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraSettingsPanel.vue?vue&type=style&index=0&id=7e3f3b77&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"58fe31fa\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraSettingsPanel.vue?vue&type=style&index=0&id=7e3f3b77&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraSettingsPanel.vue?vue&type=style&index=0&id=7e3f3b77&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.settings-card[data-v-7e3f3b77]{width:100%;padding:12px;background:var(--settings-bg-glass);border:1px solid var(--border-strong);border-radius:16px;backdrop-filter:blur(10px);box-shadow:var(--settings-shadow-card),var(--settings-shadow-inset);display:flex;flex-direction:column;gap:10px;transition:background 0.3s ease,border-color 0.3s ease}.card-header[data-v-7e3f3b77]{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;border:1px solid var(--border-soft);background:var(--chip-bg);color:var(--text-title);font-weight:800;font-size:13px;cursor:pointer;box-shadow:var(--settings-shadow-inset),var(--shadow-button);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.card-header[data-v-7e3f3b77]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--shadow-button-hover)}.title[data-v-7e3f3b77]{pointer-events:none}.chev[data-v-7e3f3b77]{opacity:0.7}.content[data-v-7e3f3b77]{display:flex;flex-direction:column;gap:10px}.toolbar[data-v-7e3f3b77]{display:flex;align-items:center;gap:8px}.spacer[data-v-7e3f3b77]{flex:1}.mini-btn[data-v-7e3f3b77]{padding:6px 10px;border-radius:8px;border:1px solid var(--border-normal);background:var(--chip-bg);color:var(--text-normal);cursor:pointer;font-size:12px;font-weight:700;box-shadow:var(--settings-shadow-inset),var(--settings-shadow-minibtn);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease,transform 0.2s ease,box-shadow 0.2s ease}.mini-btn[data-v-7e3f3b77]:hover{transform:translateY(-1px);box-shadow:var(--settings-shadow-inset),var(--settings-shadow-minibtn-hover)}.mini-btn.primary[data-v-7e3f3b77]{background:var(--settings-bg-btn-primary);border-color:var(--settings-border-btn-primary);color:var(--settings-text-primary-btn)}.mini-btn.subtle[data-v-7e3f3b77]{background:var(--settings-bg-btn-subtle);border-color:var(--settings-border-input)}.vars[data-v-7e3f3b77]{display:flex;flex-direction:column;gap:8px}.var-row[data-v-7e3f3b77]{display:grid;grid-template-columns:1fr minmax(120px,1.2fr) auto;align-items:center;gap:10px;padding:8px 10px;border:1px solid var(--border-soft);border-radius:10px;background:var(--settings-bg-var-row);transition:background 0.3s ease,border-color 0.3s ease}.var-key[data-v-7e3f3b77]{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;color:var(--text-subtitle);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:color 0.3s ease}.var-editor[data-v-7e3f3b77]{display:flex;align-items:center;gap:8px}.ipt[data-v-7e3f3b77]{width:100%;padding:8px 10px;border-radius:8px;border:1px solid var(--settings-border-input);background:var(--bg-solid);font-size:12px;color:var(--settings-text-input);box-shadow:var(--settings-shadow-inset);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.ta[data-v-7e3f3b77]{min-height:64px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}.type-chip[data-v-7e3f3b77]{font-size:11px;color:var(--text-subtitle);background:var(--settings-bg-type-chip);border:1px solid var(--settings-border-type-chip);border-radius:999px;padding:4px 8px;white-space:nowrap;transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.switch[data-v-7e3f3b77]{position:relative;width:42px;height:24px;display:inline-block}.switch input[data-v-7e3f3b77]{opacity:0;width:0;height:0}.switch .track[data-v-7e3f3b77]{position:absolute;inset:0;border-radius:999px;background:var(--settings-bg-switch-track);box-shadow:var(--settings-shadow-inset);transition:background 0.2s ease}.switch .track[data-v-7e3f3b77]::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:var(--settings-bg-switch-handle);box-shadow:var(--settings-shadow-switch-handle);transition:transform 0.2s ease,background 0.3s ease}.switch input:checked+.track[data-v-7e3f3b77]{background:var(--settings-bg-switch-checked)}.switch input:checked+.track[data-v-7e3f3b77]::after{transform:translateX(18px)}.hint[data-v-7e3f3b77]{font-size:11px;color:var(--text-normal);transition:color 0.3s ease}.hint.ok[data-v-7e3f3b77]{color:var(--settings-text-hint-ok)}.hint.bad[data-v-7e3f3b77]{color:var(--settings-text-hint-bad)}.placeholder[data-v-7e3f3b77]{padding:10px;color:var(--text-normal);font-size:12px;border:1px dashed var(--border-dashed);border-radius:10px;background:var(--bg-placeholder);transition:background 0.3s ease,border-color 0.3s ease,color 0.3s ease}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/RightRailContent/EraSettingsPanel.vue\"],\"names\":[],\"mappings\":\"AAiQA,gCAEE,UAAW,CACX,YAAa,CACb,mCAAoC,CACpC,qCAAsC,CACtC,kBAAmB,CACnB,0BAA2B,CAC3B,mEAAqE,CACrE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,sDAGF,CAGA,8BAEE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,gBAAiB,CACjB,kBAAmB,CACnB,mCAAoC,CACpC,yBAA0B,CAC1B,uBAAwB,CACxB,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,4DAA8D,CAC9D,+GAMF,CACA,oCACE,0BAA2B,CAC3B,kEACF,CACA,wBACE,mBACF,CACA,uBACE,WACF,CAGA,0BACE,YAAa,CACb,qBAAsB,CACtB,QACF,CAGA,0BACE,YAAa,CACb,kBAAmB,CACnB,OACF,CACA,yBACE,MACF,CAEA,2BAEE,gBAAiB,CACjB,iBAAkB,CAClB,qCAAsC,CACtC,yBAA0B,CAC1B,wBAAyB,CACzB,cAAe,CACf,cAAe,CACf,eAAgB,CAChB,sEAAwE,CACxE,+GAMF,CACA,iCACE,0BAA2B,CAC3B,4EACF,CACA,mCACE,yCAA0C,CAC1C,+CAAgD,CAChD,sCACF,CACA,kCACE,wCAAyC,CACzC,yCACF,CAGA,uBACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,0BAEE,YAAa,CACb,kDAAoD,CACpD,kBAAmB,CACnB,QAAS,CACT,gBAAiB,CACjB,mCAAoC,CACpC,kBAAmB,CACnB,qCAAsC,CACtC,sDAGF,CACA,0BACE,gEAAqE,CACrE,cAAe,CACf,0BAA2B,CAC3B,eAAgB,CAChB,sBAAuB,CACvB,kBAAmB,CACnB,0BACF,CACA,6BACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,sBAEE,UAAW,CACX,gBAAiB,CACjB,iBAAkB,CAClB,6CAA8C,CAC9C,0BAA2B,CAC3B,cAAe,CACf,gCAAiC,CACjC,uCAAwC,CACxC,sEAIF,CACA,qBACE,eAAgB,CAChB,gEACF,CAEA,4BAEE,cAAe,CACf,0BAA2B,CAC3B,uCAAwC,CACxC,iDAAkD,CAClD,mBAAoB,CACpB,eAAgB,CAChB,kBAAmB,CACnB,sEAIF,CAGA,yBACE,iBAAkB,CAClB,UAAW,CACX,WAAY,CACZ,oBACF,CACA,+BACE,SAAU,CACV,OAAQ,CACR,QACF,CACA,gCACE,iBAAkB,CAClB,OAAQ,CACR,mBAAoB,CACpB,0CAA2C,CAC3C,uCAAwC,CACxC,+BACF,CACA,uCACE,UAAW,CACX,iBAAkB,CAClB,OAAQ,CACR,QAAS,CACT,UAAW,CACX,WAAY,CACZ,iBAAkB,CAClB,2CAA4C,CAC5C,+CAAgD,CAChD,mDAGF,CACA,8CACE,4CACF,CACA,qDACE,0BACF,CAEA,uBACE,cAAe,CACf,wBAAyB,CACzB,0BACF,CACA,0BACE,kCACF,CACA,2BACE,mCACF,CAEA,8BACE,YAAa,CACb,wBAAyB,CACzB,cAAe,CACf,sCAAuC,CACvC,kBAAmB,CACnB,gCAAiC,CACjC,sEAIF\",\"sourcesContent\":[\"<template>\\n  <!-- 外层卡片：与 ActionButtons 保持一致的玻璃卡风格，但默认收起 -->\\n  <section class=\\\"settings-card\\\" role=\\\"region\\\" aria-label=\\\"ERA 设置\\\">\\n    <!-- 设置卡片容器 -->\\n    <!-- 标题行：可点击折叠/展开 -->\\n    <button class=\\\"card-header\\\" :aria-expanded=\\\"isOpen\\\" @click=\\\"onToggle\\\">\\n      <!-- 点击切换展开状态 -->\\n      <span class=\\\"title\\\">ERA 设置</span>\\n      <!-- 标题文字 -->\\n      <span class=\\\"chev\\\" aria-hidden=\\\"true\\\">{{ isOpen ? '▾' : '▸' }}</span>\\n      <!-- 展开箭头 -->\\n    </button>\\n\\n    <!-- 内容体：默认收起；展开后显示变量列表与操作 -->\\n    <div v-show=\\\"isOpen\\\" class=\\\"content\\\">\\n      <!-- 展开内容容器 -->\\n      <!-- 顶部操作区：刷新/保存/重置编辑 -->\\n      <div class=\\\"toolbar\\\">\\n        <!-- 工具条 -->\\n        <button class=\\\"mini-btn\\\" title=\\\"重新读取脚本变量\\\" @click.stop=\\\"loadVars\\\">🔄 重新读取</button>\\n        <!-- 读取按钮 -->\\n        <div class=\\\"spacer\\\"></div>\\n        <!-- 占位撑开 -->\\n        <button class=\\\"mini-btn subtle\\\" title=\\\"丢弃未保存的修改\\\" @click.stop=\\\"discardEdits\\\">↩︎ 丢弃修改</button>\\n        <!-- 丢弃编辑 -->\\n        <button class=\\\"mini-btn primary\\\" title=\\\"保存修改到脚本变量\\\" @click.stop=\\\"saveEdits\\\">💾 保存修改</button>\\n        <!-- 保存修改 -->\\n      </div>\\n\\n      <!-- 变量列表：逐项渲染 -->\\n      <div class=\\\"vars\\\">\\n        <template v-if=\\\"rows.length > 0\\\">\\n          <!-- 有变量时渲染列表 -->\\n          <div v-for=\\\"row in rows\\\" :key=\\\"row.key\\\" class=\\\"var-row\\\">\\n            <!-- 每个变量一行 -->\\n            <label class=\\\"var-key\\\" :title=\\\"row.key\\\">{{ row.key }}</label>\\n            <!-- 变量名 -->\\n            <!-- 根据变量类型选择不同的编辑控件 -->\\n            <div class=\\\"var-editor\\\">\\n              <!-- 编辑器容器 -->\\n              <!-- 布尔：勾选框 -->\\n              <template v-if=\\\"row.type === 'boolean'\\\">\\n                <label class=\\\"switch\\\">\\n                  <!-- 自定义开关外观 -->\\n                  <input v-model=\\\"edits[row.key]\\\" type=\\\"checkbox\\\" />\\n                  <!-- 勾选值 -->\\n                  <span class=\\\"track\\\"></span>\\n                  <!-- 轨道 -->\\n                </label>\\n              </template>\\n\\n              <!-- 数字：number 输入 -->\\n              <template v-else-if=\\\"row.type === 'number'\\\">\\n                <input v-model.number=\\\"edits[row.key]\\\" type=\\\"number\\\" class=\\\"ipt\\\" :placeholder=\\\"String(row.value)\\\" />\\n                <!-- 数字输入 -->\\n              </template>\\n\\n              <!-- 字符串：text 输入 -->\\n              <template v-else-if=\\\"row.type === 'string'\\\">\\n                <input v-model=\\\"edits[row.key]\\\" type=\\\"text\\\" class=\\\"ipt\\\" :placeholder=\\\"String(row.value)\\\" />\\n                <!-- 文本输入 -->\\n              </template>\\n\\n              <!-- 其他（对象/数组/null/未知）：JSON 文本域 -->\\n              <template v-else>\\n                <textarea\\n                  v-model=\\\"jsonBuffers[row.key]\\\"\\n                  class=\\\"ipt ta\\\"\\n                  :placeholder=\\\"safeStringify(row.value)\\\"\\n                  @input=\\\"markJsonTouched(row.key)\\\"\\n                ></textarea>\\n                <!-- JSON 文本域 -->\\n                <span class=\\\"hint\\\" :class=\\\"{ ok: jsonState[row.key]?.ok, bad: jsonState[row.key]?.bad }\\\">{{\\n                  jsonState[row.key]?.msg ?? '以 JSON 格式编辑此值'\\n                }}</span>\\n                <!-- JSON 校验提示 -->\\n              </template>\\n            </div>\\n            <!-- 类型徽标 -->\\n            <span class=\\\"type-chip\\\">{{ humanType(row.type) }}</span>\\n            <!-- 类型展示 -->\\n          </div>\\n        </template>\\n\\n        <template v-else>\\n          <!-- 没有变量时的占位 -->\\n          <div class=\\\"placeholder\\\">\\n            <p>未读取到任何脚本变量。</p>\\n            <!-- 文本提示 -->\\n            <p class=\\\"dim\\\">\\n              请先确保在 <code>app_ready</code> 或初始化阶段通过\\n              <code>initializeExternalSettings()</code> 写入默认变量。\\n            </p>\\n            <!-- 辅助说明 -->\\n          </div>\\n        </template>\\n      </div>\\n    </div>\\n  </section>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\n/* 块头：逻辑说明\\n   - 默认收起，展开时读取脚本域变量；\\n   - 支持 boolean/number/string/json 四类编辑；\\n   - 保存时按原类型回写到脚本域。\\n*/\\nimport { reactive, ref } from 'vue'; // 中文注释：Vue 响应式 API\\nimport toastr from 'toastr';\\nimport { z } from 'zod';\\nimport { SettingsSchema } from '../../../utils/constants';\\nimport { getScriptSettings, updateScriptSettings } from '../../../utils/era_data';\\nimport { Logger } from '../../../utils/log'; // 中文注释：项目内日志工具\\n\\nconst logger = new Logger(); // 中文注释：实例化日志\\n\\n// === 折叠状态 ===\\nconst isOpen = ref(false); // 中文注释：是否展开\\n\\n// === 原始数据与编辑缓存 ===\\ntype Row = { key: string; value: any; type: 'boolean' | 'number' | 'string' | 'json' }; // 中文注释：一行变量的结构\\nconst rows = ref<Row[]>([]); // 中文注释：可渲染的变量行\\nconst edits = reactive<Record<string, any>>({}); // 中文注释：针对简单类型的编辑缓存（布尔/数字/字符串）\\nconst jsonBuffers = reactive<Record<string, string>>({}); // 中文注释：针对 JSON 类型的文本缓存\\nconst jsonState = reactive<Record<string, { ok?: boolean; bad?: boolean; msg?: string }>>({}); // 中文注释：JSON 校验状态\\n\\n// === 工具：类型判定与人类可读名 ===\\nfunction detectType(v: any): Row['type'] {\\n  // 中文注释：检测变量类型\\n  if (typeof v === 'boolean') return 'boolean'; // 中文注释：布尔\\n  if (typeof v === 'number' && Number.isFinite(v)) return 'number'; // 中文注释：有限数\\n  if (typeof v === 'string') return 'string'; // 中文注释：字符串\\n  return 'json'; // 中文注释：其他一律归为 json（对象/数组/null/特殊数等）\\n}\\nfunction humanType(t: Row['type']): string {\\n  // 中文注释：类型中文名\\n  return t === 'boolean' ? '布尔' : t === 'number' ? '数字' : t === 'string' ? '字符串' : 'JSON'; // 中文注释：映射\\n}\\nfunction safeStringify(v: any): string {\\n  // 中文注释：安全 JSON 序列化\\n  try {\\n    return JSON.stringify(v, null, 2);\\n  } catch {\\n    return String(v);\\n  } // 中文注释：失败则转字符串\\n}\\n\\n// === 加载变量列表 ===\\nfunction loadVars() {\\n  try {\\n    logger.debug('loadVars', '尝试读取脚本设置...');\\n    const obj = getScriptSettings();\\n    logger.debug('loadVars', '成功读取脚本设置:', obj);\\n\\n    if (!obj || Object.keys(obj).length === 0) {\\n      logger.warn('loadVars', '设置对象为空，UI 将不会被填充。');\\n      rows.value = [];\\n      toastr.info('未找到任何脚本变量。');\\n      return;\\n    }\\n\\n    // 清空旧缓存\\n    rows.value = [];\\n    for (const k of Object.keys(edits)) delete edits[k];\\n    for (const k of Object.keys(jsonBuffers)) delete jsonBuffers[k];\\n    for (const k of Object.keys(jsonState)) delete jsonState[k];\\n\\n    // 构建可编辑行\\n    Object.entries(obj)\\n      .filter(([key]) => key !== '开启悬浮球')\\n      .forEach(([key, value]) => {\\n        const t = detectType(value);\\n        rows.value.push({ key, value, type: t });\\n        if (t === 'json') {\\n          jsonBuffers[key] = safeStringify(value);\\n        } else {\\n          edits[key] = value;\\n        }\\n      });\\n    toastr.success('已从脚本变量中加载最新设置。', '读取成功');\\n  } catch (e) {\\n    logger.error('loadVars', '读取脚本变量失败:', e);\\n    toastr.error('读取 ERA 设置失败，请检查浏览器控制台。', '读取失败');\\n  }\\n}\\n\\n// === 展开折叠 ===\\nfunction onToggle() {\\n  // 中文注释：切换展开\\n  isOpen.value = !isOpen.value; // 中文注释：翻转状态\\n  if (isOpen.value && rows.value.length === 0) loadVars(); // 中文注释：首次展开时读取数据\\n}\\n\\n// === JSON 文本域编辑标记 + 校验 ===\\nfunction markJsonTouched(key: string) {\\n  // 中文注释：标记 JSON 文本改动并校验\\n  const txt = jsonBuffers[key] ?? ''; // 中文注释：读取文本\\n  if (txt.trim() === '') {\\n    // 中文注释：空文本提示\\n    jsonState[key] = { bad: true, ok: false, msg: '不能为空（若要设为 null 请写 null）' }; // 中文注释：空提示\\n    return; // 中文注释：返回\\n  }\\n  try {\\n    JSON.parse(txt);\\n    jsonState[key] = { ok: true, bad: false, msg: 'JSON 格式有效' };\\n  } catch (e: any) {\\n    // 中文注释：校验通过\\n    jsonState[key] = { bad: true, ok: false, msg: `JSON 格式错误：${e?.message ?? ''}` };\\n  } // 中文注释：校验失败\\n}\\n\\n// === 丢弃未保存的编辑 ===\\nfunction discardEdits() {\\n  // 中文注释：丢弃编辑\\n  logger.log('discardEdits', '点击“丢弃修改”');\\n  loadVars(); // 中文注释：重新读取覆盖本地改动\\n  toastr.info('所有未保存的修改已被丢弃。', '操作完成');\\n}\\n\\n// === 保存修改 ===\\nasync function saveEdits() {\\n  // 中文注释：保存到脚本域\\n  try {\\n    await updateScriptSettings(currentSettings => {\\n      const next: z.infer<typeof SettingsSchema> = { ...currentSettings };\\n\\n      // 合并简单类型的改动（布尔/数字/字符串）\\n      Object.entries(edits).forEach(([k, v]) => {\\n        const key = k as keyof z.infer<typeof SettingsSchema>;\\n        (next as any)[key] = v;\\n      });\\n\\n      // 合并 JSON 文本改动（需先通过校验）\\n      Object.entries(jsonBuffers).forEach(([k, txt]) => {\\n        if (txt != null) {\\n          if (jsonState[k]?.bad) throw new Error(`键 ${k} 的 JSON 格式不正确`);\\n          const key = k as keyof z.infer<typeof SettingsSchema>;\\n          (next as any)[key] = JSON.parse(txt);\\n        }\\n      });\\n\\n      return next;\\n    });\\n\\n    logger.log('saveEdits', '脚本变量已保存');\\n    toastr.success('设置已成功保存到脚本变量。', '保存成功');\\n    window.dispatchEvent(new CustomEvent('era-settings-updated'));\\n    loadVars();\\n  } catch (e) {\\n    logger.error('saveEdits', '保存失败：', e);\\n    toastr.error(`保存失败：${(e as any)?.message ?? e}`, '保存失败');\\n  }\\n}\\n</script>\\n\\n<style scoped>\\n/* === 外层卡片容器（与 ActionButtons 保持同系外观） === */\\n.settings-card {\\n  /* 玻璃卡容器 */\\n  width: 100%; /* 占满侧栏宽度 */\\n  padding: 12px; /* 内边距 */\\n  background: var(--settings-bg-glass);\\n  border: 1px solid var(--border-strong);\\n  border-radius: 16px; /* 圆角 */\\n  backdrop-filter: blur(10px); /* 毛玻璃 */\\n  box-shadow: var(--settings-shadow-card), var(--settings-shadow-inset);\\n  display: flex; /* 纵向布局 */\\n  flex-direction: column; /* 垂直排布 */\\n  gap: 10px; /* 间距 */\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n\\n/* 标题按钮：收起/展开控制 */\\n.card-header {\\n  /* 标题行按钮 */\\n  display: flex; /* 横向布局 */\\n  align-items: center; /* 垂直居中 */\\n  justify-content: space-between; /* 两端对齐 */\\n  padding: 8px 10px; /* 内边距 */\\n  border-radius: 10px; /* 圆角 */\\n  border: 1px solid var(--border-soft);\\n  background: var(--chip-bg);\\n  color: var(--text-title);\\n  font-weight: 800; /* 加粗 */\\n  font-size: 13px; /* 字号 */\\n  cursor: pointer; /* 可点 */\\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease,\\n    transform 0.2s ease,\\n    box-shadow 0.2s ease;\\n}\\n.card-header:hover {\\n  transform: translateY(-1px);\\n  box-shadow: var(--settings-shadow-inset), var(--shadow-button-hover);\\n} /* 悬停态 */\\n.title {\\n  pointer-events: none;\\n} /* 避免子元素截获点击 */\\n.chev {\\n  opacity: 0.7;\\n} /* 箭头淡化 */\\n\\n/* 内容体 */\\n.content {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n} /* 内容容器 */\\n\\n/* 工具条 */\\n.toolbar {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n} /* 工具条布局 */\\n.spacer {\\n  flex: 1;\\n} /* 右对齐按钮用 */\\n\\n.mini-btn {\\n  /* 通用小按钮 */\\n  padding: 6px 10px; /* 内边距 */\\n  border-radius: 8px; /* 圆角 */\\n  border: 1px solid var(--border-normal);\\n  background: var(--chip-bg);\\n  color: var(--text-normal);\\n  cursor: pointer; /* 可点击 */\\n  font-size: 12px; /* 字号 */\\n  font-weight: 700; /* 加粗 */\\n  box-shadow: var(--settings-shadow-inset), var(--settings-shadow-minibtn);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease,\\n    transform 0.2s ease,\\n    box-shadow 0.2s ease;\\n}\\n.mini-btn:hover {\\n  transform: translateY(-1px);\\n  box-shadow: var(--settings-shadow-inset), var(--settings-shadow-minibtn-hover);\\n} /* 悬停 */\\n.mini-btn.primary {\\n  background: var(--settings-bg-btn-primary);\\n  border-color: var(--settings-border-btn-primary);\\n  color: var(--settings-text-primary-btn);\\n} /* 主要 */\\n.mini-btn.subtle {\\n  background: var(--settings-bg-btn-subtle);\\n  border-color: var(--settings-border-input);\\n} /* 次要 */\\n\\n/* 变量列表 */\\n.vars {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n} /* 列表容器 */\\n\\n.var-row {\\n  /* 一行变量 */\\n  display: grid; /* 网格布局 */\\n  grid-template-columns: 1fr minmax(120px, 1.2fr) auto; /* 三列：键 / 编辑器 / 类型 */\\n  align-items: center; /* 垂直居中 */\\n  gap: 10px; /* 列间距 */\\n  padding: 8px 10px; /* 内边距 */\\n  border: 1px solid var(--border-soft);\\n  border-radius: 10px; /* 圆角 */\\n  background: var(--settings-bg-var-row);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease;\\n}\\n.var-key {\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\\n  font-size: 12px;\\n  color: var(--text-subtitle);\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  transition: color 0.3s ease;\\n} /* 键名样式 */\\n.var-editor {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n} /* 编辑器容器 */\\n\\n.ipt {\\n  /* 通用输入框 */\\n  width: 100%; /* 拉满可用宽度 */\\n  padding: 8px 10px; /* 内边距 */\\n  border-radius: 8px; /* 圆角 */\\n  border: 1px solid var(--settings-border-input);\\n  background: var(--bg-solid);\\n  font-size: 12px; /* 字号 */\\n  color: var(--settings-text-input);\\n  box-shadow: var(--settings-shadow-inset);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n.ta {\\n  min-height: 64px;\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\\n} /* JSON 文本域 */\\n\\n.type-chip {\\n  /* 类型标签 */\\n  font-size: 11px; /* 字号 */\\n  color: var(--text-subtitle);\\n  background: var(--settings-bg-type-chip);\\n  border: 1px solid var(--settings-border-type-chip);\\n  border-radius: 999px; /* 胶囊 */\\n  padding: 4px 8px; /* 内边距 */\\n  white-space: nowrap; /* 不换行 */\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n\\n/* 自定义开关（布尔） */\\n.switch {\\n  position: relative;\\n  width: 42px;\\n  height: 24px;\\n  display: inline-block;\\n} /* 开关容器 */\\n.switch input {\\n  opacity: 0;\\n  width: 0;\\n  height: 0;\\n} /* 隐藏原生框 */\\n.switch .track {\\n  position: absolute;\\n  inset: 0;\\n  border-radius: 999px;\\n  background: var(--settings-bg-switch-track);\\n  box-shadow: var(--settings-shadow-inset);\\n  transition: background 0.2s ease;\\n} /* 轨道 */\\n.switch .track::after {\\n  content: '';\\n  position: absolute;\\n  top: 3px;\\n  left: 3px;\\n  width: 18px;\\n  height: 18px;\\n  border-radius: 50%;\\n  background: var(--settings-bg-switch-handle);\\n  box-shadow: var(--settings-shadow-switch-handle);\\n  transition:\\n    transform 0.2s ease,\\n    background 0.3s ease;\\n} /* 拖头 */\\n.switch input:checked + .track {\\n  background: var(--settings-bg-switch-checked);\\n} /* 选中轨道色 */\\n.switch input:checked + .track::after {\\n  transform: translateX(18px);\\n} /* 拖头右移 */\\n\\n.hint {\\n  font-size: 11px;\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n} /* JSON 提示 */\\n.hint.ok {\\n  color: var(--settings-text-hint-ok);\\n} /* 通过提示色 */\\n.hint.bad {\\n  color: var(--settings-text-hint-bad);\\n} /* 错误提示色 */\\n\\n.placeholder {\\n  padding: 10px;\\n  color: var(--text-normal);\\n  font-size: 12px;\\n  border: 1px dashed var(--border-dashed);\\n  border-radius: 10px;\\n  background: var(--bg-placeholder);\\n  transition:\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n} /* 空状态 */\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./PrettyJsonViewer.vue?vue&type=style&index=0&id=6fc9ef75&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"cd4d425e\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./PrettyJsonViewer.vue?vue&type=style&index=0&id=6fc9ef75&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./PrettyJsonViewer.vue?vue&type=style&index=0&id=6fc9ef75&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ThemeManager.vue?vue&type=style&index=0&id=dc652d14&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"4c7de2b8\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ThemeManager.vue?vue&type=style&index=0&id=dc652d14&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./ThemeManager.vue?vue&type=style&index=0&id=dc652d14&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.json-line[data-v-6c2ac46e]{position:relative;display:flex;align-items:center;gap:6px;padding:2px 6px;border-radius:6px;transition:background 0.2s ease}.json-line[data-v-6c2ac46e]:hover{background:var(--json-hover-bg)}.json-children[data-v-6c2ac46e]{border-left:1px dashed var(--json-tree-line);transition:border-color 0.3s ease}.key[data-v-6c2ac46e]{color:var(--json-key-color);font-weight:700;transition:color 0.3s ease}.colon[data-v-6c2ac46e]{color:var(--text-normal);transition:color 0.3s ease}.brace[data-v-6c2ac46e]{color:var(--text-normal);transition:color 0.3s ease}.summary[data-v-6c2ac46e]{color:var(--text-normal);margin-left:4px;transition:color 0.3s ease}.val.string[data-v-6c2ac46e]{color:var(--json-val-string)}.val.number[data-v-6c2ac46e]{color:var(--json-val-number)}.val.boolean[data-v-6c2ac46e]{color:var(--json-val-boolean)}.val.null[data-v-6c2ac46e]{color:var(--json-val-null)}.val.undefined[data-v-6c2ac46e]{color:var(--json-val-null)}.caret[data-v-6c2ac46e]{width:18px;height:18px;border:1px solid var(--border-soft);border-radius:4px;background:var(--bg-solid);line-height:16px;text-align:center;font-size:10px;color:var(--text-normal);cursor:pointer;box-shadow:var(--json-caret-shadow);transition:transform 0.18s ease,box-shadow 0.18s ease,background 0.3s ease,border-color 0.3s ease,color 0.3s ease}.caret.open[data-v-6c2ac46e]{transform:rotate(90deg);box-shadow:var(--json-caret-open-shadow)}.node[data-v-6c2ac46e]{overflow:clip;contain:paint;min-height:0}.json-children[data-v-6c2ac46e]{overflow:clip;contain:paint}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/template/JsonNode.vue\"],\"names\":[],\"mappings\":\"AAoJA,4BACE,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,eAAgB,CAChB,iBAAkB,CAClB,+BACF,CACA,kCACE,+BACF,CACA,gCACE,4CAA6C,CAC7C,iCACF,CAGA,sBACE,2BAA4B,CAC5B,eAAgB,CAChB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,wBACE,wBAAyB,CACzB,0BACF,CACA,0BACE,wBAAyB,CACzB,eAAgB,CAChB,0BACF,CACA,6BACE,4BACF,CACA,6BACE,4BACF,CACA,8BACE,6BACF,CACA,2BACE,0BACF,CACA,gCACE,0BACF,CAGA,wBACE,UAAW,CACX,WAAY,CACZ,mCAAoC,CACpC,iBAAkB,CAClB,0BAA2B,CAC3B,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,wBAAyB,CACzB,cAAe,CACf,mCAAoC,CACpC,iHAMF,CACA,6BACE,uBAAwB,CACxB,wCACF,CAGA,uBAEE,aAAc,CACd,aAAc,CACd,YACF,CAEA,gCAEE,aAAc,CACd,aACF\",\"sourcesContent\":[\"<template>\\n  <!-- 单条节点（支持递归） -->\\n  <div class=\\\"node\\\">\\n    <!-- 每个键值对 / 数组项的容器 -->\\n    <div class=\\\"json-line\\\" :style=\\\"{ paddingLeft: level * 14 + 'px' }\\\">\\n      <!-- 行+缩进 -->\\n      <button v-if=\\\"foldable\\\" class=\\\"caret\\\" :class=\\\"{ open }\\\" aria-label=\\\"toggle\\\" @click=\\\"open = !open\\\">▸</button>\\n      <!-- 折叠箭头按钮 -->\\n\\n      <span class=\\\"key\\\">{{ k }}</span\\n      ><span class=\\\"colon\\\">:</span>\\n      <!-- 键与冒号 -->\\n\\n      <!-- 可折叠容器：只显示括号与摘要；展开后由下方 children 区域递归渲染 -->\\n      <template v-if=\\\"foldable\\\">\\n        <span class=\\\"brace\\\">{{ isArray ? '[' : '{' }}</span>\\n        <!-- 容器起始括号 -->\\n        <span v-if=\\\"!open\\\" class=\\\"summary\\\">{{ summary }}</span>\\n        <!-- 收起时的摘要 -->\\n      </template>\\n\\n      <!-- 原始值：直接着色渲染 -->\\n      <template v-else>\\n        <span class=\\\"val\\\" :class=\\\"type\\\">{{ primitiveText }}</span>\\n        <!-- 原始值文本 -->\\n      </template>\\n    </div>\\n\\n    <!-- 子元素区域：仅当可折叠且处于展开态时显示 -->\\n    <template v-if=\\\"foldable && open\\\">\\n      <div class=\\\"json-children\\\">\\n        <!-- 递归：自引用同名组件 JsonNode（依赖 name: 'JsonNode' 实现自递归） -->\\n        <JsonNode\\n          v-for=\\\"(childVal, childKey) in childEntries\\\"\\n          :key=\\\"path + '/' + String(childKey)\\\"\\n          :k=\\\"String(childKey)\\\"\\n          :v=\\\"childVal\\\"\\n          :path=\\\"path + '/' + String(childKey)\\\"\\n          :level=\\\"level + 1\\\"\\n          :default-collapsed=\\\"defaultCollapsed\\\"\\n          :max-depth=\\\"maxDepth\\\"\\n        />\\n        <div class=\\\"json-line\\\" :style=\\\"{ paddingLeft: level * 14 + 'px' }\\\">\\n          <span class=\\\"brace\\\">{{ isArray ? ']' : '}' }}</span>\\n          <!-- 容器闭合括号 -->\\n        </div>\\n      </div>\\n    </template>\\n  </div>\\n</template>\\n\\n<script lang=\\\"ts\\\">\\nimport { computed, defineComponent, onMounted, ref, watch } from 'vue'; // 引入响应式/组件工具\\nimport { Logger } from '../../utils/log';\\n\\nexport default defineComponent({\\n  name: 'JsonNode', // 关键：为自递归提供组件名\\n  props: {\\n    k: { type: [String, Number], required: true }, // 当前键（或数组下标）\\n    v: { required: true }, // 当前值\\n    path: { type: String, required: true }, // 路径（仅用于 key/调试）\\n    level: { type: Number, required: true }, // 层级（用于缩进）\\n    defaultCollapsed: { type: Boolean, default: true }, // 默认是否折叠\\n    maxDepth: { type: Number, default: 3 }, // 初次展开的最大深度\\n  },\\n  setup(p) {\\n    const logger = new Logger();\\n\\n    onMounted(() => {\\n      //logger.debug('onMounted', '组件已挂载', { props: p });\\n    });\\n\\n    // 节点类型判定\\n    const type = computed(() => {\\n      const val = p.v;\\n      if (val === null) return 'null';\\n      if (Array.isArray(val)) return 'array';\\n      const t = typeof val;\\n      if (t === 'object') return 'object';\\n      if (t === 'undefined') return 'undefined';\\n      return t as 'string' | 'number' | 'boolean' | 'bigint' | 'symbol' | 'function';\\n    });\\n\\n    // 是否数组/对象\\n    const isArray = computed(() => type.value === 'array');\\n    const isObject = computed(() => type.value === 'object');\\n\\n    // 是否可折叠\\n    const foldable = computed(() => isArray.value || isObject.value);\\n\\n    // 初始开合：不超过 maxDepth 的层级默认展开；否则遵循 defaultCollapsed\\n    const open = ref<boolean>(p.level <= (p.maxDepth ?? 3) ? true : !p.defaultCollapsed);\\n\\n    watch(open, newOpenState => {\\n      logger.debug('watch:open', `折叠状态改变为: ${newOpenState ? '展开' : '收起'}`);\\n    });\\n\\n    // 原始值渲染文本（补足 undefined / bigint / symbol）\\n    const primitiveText = computed(() => {\\n      const val = p.v as any;\\n      switch (type.value) {\\n        case 'string':\\n          return JSON.stringify(val);\\n        case 'number':\\n          return String(val);\\n        case 'boolean':\\n          return val ? 'true' : 'false';\\n        case 'null':\\n          return 'null';\\n        case 'undefined':\\n          return 'undefined';\\n        case 'bigint':\\n          return String(val) + 'n';\\n        case 'symbol':\\n          return String(val);\\n        case 'function':\\n          return 'ƒ()';\\n        default:\\n          return '';\\n      }\\n    });\\n\\n    // 收起时的摘要信息\\n    const summary = computed(() => {\\n      if (isArray.value) return `Array[${(p.v as any[]).length}]`;\\n      if (isObject.value) return `Object{${Object.keys(p.v || {}).length}}`;\\n      return '';\\n    });\\n\\n    // 子项列表：对象 → 其 entries；数组 → 直接枚举索引和值\\n    const childEntries = computed<Record<string, any>>(() => {\\n      if (isObject.value) return p.v as Record<string, any>;\\n      if (isArray.value) {\\n        const out: Record<string, any> = {};\\n        (p.v as any[]).forEach((cv, idx) => {\\n          out[String(idx)] = cv;\\n        });\\n        return out;\\n      }\\n      return {};\\n    });\\n\\n    return { type, isArray, foldable, open, primitiveText, summary, childEntries };\\n  },\\n});\\n</script>\\n\\n<style scoped>\\n.json-line {\\n  position: relative;\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  padding: 2px 6px;\\n  border-radius: 6px;\\n  transition: background 0.2s ease;\\n}\\n.json-line:hover {\\n  background: var(--json-hover-bg);\\n}\\n.json-children {\\n  border-left: 1px dashed var(--json-tree-line);\\n  transition: border-color 0.3s ease;\\n}\\n\\n/* 结构元素与着色 */\\n.key {\\n  color: var(--json-key-color);\\n  font-weight: 700;\\n  transition: color 0.3s ease;\\n}\\n.colon {\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n}\\n.brace {\\n  color: var(--text-normal);\\n  transition: color 0.3s ease;\\n}\\n.summary {\\n  color: var(--text-normal);\\n  margin-left: 4px;\\n  transition: color 0.3s ease;\\n}\\n.val.string {\\n  color: var(--json-val-string);\\n}\\n.val.number {\\n  color: var(--json-val-number);\\n}\\n.val.boolean {\\n  color: var(--json-val-boolean);\\n}\\n.val.null {\\n  color: var(--json-val-null);\\n}\\n.val.undefined {\\n  color: var(--json-val-null);\\n}\\n\\n/* 折叠箭头 */\\n.caret {\\n  width: 18px;\\n  height: 18px;\\n  border: 1px solid var(--border-soft);\\n  border-radius: 4px;\\n  background: var(--bg-solid);\\n  line-height: 16px;\\n  text-align: center;\\n  font-size: 10px;\\n  color: var(--text-normal);\\n  cursor: pointer;\\n  box-shadow: var(--json-caret-shadow);\\n  transition:\\n    transform 0.18s ease,\\n    box-shadow 0.18s ease,\\n    background 0.3s ease,\\n    border-color 0.3s ease,\\n    color 0.3s ease;\\n}\\n.caret.open {\\n  transform: rotate(90deg);\\n  box-shadow: var(--json-caret-open-shadow);\\n}\\n\\n/* ===[新增] 防溢出：节点与子树都裁剪（配合上层折叠时彻底看不见） === */\\n.node {\\n  /* 单个节点容器 */\\n  overflow: clip; /* 裁剪节点内部所有绘制 */\\n  contain: paint; /* 隔离绘制，避免 1px 渲染外泄 */\\n  min-height: 0; /* 防“最小高度”把父级撑开 */\\n}\\n\\n.json-children {\\n  /* 子节点区域 */\\n  overflow: clip; /* 裁剪子树（含左侧虚线等装饰） */\\n  contain: paint; /* 防止子元素阴影/边框超界 */\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `:root{--bg-blur-heavy:linear-gradient(180deg,rgba(255,255,255,0.75),rgba(255,255,255,0.65));--bg-blur-light:linear-gradient(90deg,rgba(255,255,255,0.65),rgba(255,255,255,0.45));--bg-solid:#fff;--bg-soft:rgba(255,255,255,0.6);--bg-empty:rgba(255,255,255,0.5);--border-strong:rgba(255,255,255,0.6);--border-normal:rgba(0,0,0,0.08);--border-soft:rgba(0,0,0,0.06);--border-dashed:rgba(0,0,0,0.08);--text-title:#1f2937;--text-subtitle:#374151;--text-normal:#6b7280;--shadow-panel:0 10px 40px rgba(0,0,0,0.18);--shadow-button:0 2px 8px rgba(0,0,0,0.08);--shadow-button-hover:0 6px 16px rgba(0,0,0,0.12);--shadow-inset:inset 0 1px 0 rgba(255,255,255,0.6);--chip-bg:linear-gradient(180deg,#fafafa,#f4f4f4);--chip-text:#6b7280;--chip-border:rgba(0,0,0,0.06);--chip-ok-bg:linear-gradient(180deg,#ecfdf5,#d1fae5);--chip-ok-text:#065f46;--chip-ok-border:#a7f3d0;--mk-pill-bg:linear-gradient(180deg,#eef2ff,#e0e7ff);--mk-pill-text:#4338ca;--mk-pill-border:#c7d2fe;--mk-pill-null-bg:linear-gradient(180deg,#f9fafb,#f3f4f6);--mk-pill-null-text:#6b7280;--mk-pill-null-border:#e5e7eb;--settings-bg-glass:linear-gradient(180deg,rgba(255,255,255,0.76),rgba(255,255,255,0.62));--settings-shadow-card:0 10px 40px rgba(0,0,0,0.16);--settings-shadow-inset:inset 0 1px 0 #fff;--settings-shadow-minibtn:0 2px 6px rgba(0,0,0,0.06);--settings-shadow-minibtn-hover:0 5px 12px rgba(0,0,0,0.1);--settings-bg-var-row:linear-gradient(180deg,#ffffff,#f8fafc);--settings-text-input:#111827;--settings-text-primary-btn:#0f172a;--settings-border-input:#e5e7eb;--settings-bg-btn-primary:linear-gradient(180deg,#e0f2fe,#bfdbfe);--settings-border-btn-primary:#93c5fd;--settings-bg-btn-subtle:linear-gradient(180deg,#f9fafb,#f3f4f6);--settings-bg-type-chip:#eef2ff;--settings-border-type-chip:#c7d2fe;--settings-bg-switch-track:#e5e7eb;--settings-bg-switch-handle:#fff;--settings-shadow-switch-handle:0 1px 3px rgba(0,0,0,0.2);--settings-bg-switch-checked:#93c5fd;--settings-text-hint-ok:#065f46;--settings-text-hint-bad:#b91c1c;--actions-bg-glass:linear-gradient(180deg,rgba(255,255,255,0.76),rgba(255,255,255,0.62));--actions-shadow-card:0 10px 40px rgba(0,0,0,0.16);--actions-btn-bg:linear-gradient(180deg,#fafafa,#f3f4f6);--actions-btn-text:#374151;--actions-btn-primary-bg:linear-gradient(180deg,#e0f2fe,#bfdbfe);--actions-btn-primary-border:#93c5fd;--actions-btn-primary-text:#0f172a;--actions-btn-subtle-bg:linear-gradient(180deg,#f9fafb,#f3f4f6);--actions-btn-subtle-border:#e5e7eb;--actions-btn-danger-bg:linear-gradient(180deg,#fee2e2,#fecaca);--actions-btn-danger-border:#fca5a5;--actions-btn-danger-text:#991b1b;--actions-shadow-btn-active:0 2px 8px rgba(0,0,0,0.1);--actions-outline-focus:#60a5fa;--text-soft:#6b7280;--accordion-bg:linear-gradient(180deg,#fff,#fafafa);--accordion-body-bg:rgba(255,255,255,0.82);--meta-bg:linear-gradient(180deg,#ffffff,#f9fafb);--meta-shadow:0 6px 18px rgba(0,0,0,0.06);--meta-key-bg:#f3f4f6;--meta-glow-bg:linear-gradient(90deg,#60a5fa,#a78bfa,#34d399,#f472b6);--json-hover-bg:rgba(59,130,246,0.06);--json-tree-line:rgba(107,114,128,0.25);--json-key-color:#1f2937;--json-val-string:#047857;--json-val-number:#7c3aed;--json-val-boolean:#0369a1;--json-val-null:#9ca3af;--json-caret-shadow:0 1px 0 #fff,0 2px 6px rgba(0,0,0,0.06);--json-caret-open-shadow:0 3px 10px rgba(0,0,0,0.12);--tab-active-shadow:0 0 0 3px rgba(147,197,253,0.35);--tab-content-bg:rgba(255,255,255,0.86);--ball-hue:210;--ball-sat:15%;--ball-lum:95%;--ball-shadow-color:rgba(0,0,0,0.15);--ball-glow-color:rgba(180,200,220,0.55);--ball-inner-shadow-color:rgba(0,0,0,0.1);--ball-specular-color:rgba(255,255,255,0.9);--ball-glass-color:rgba(255,255,255,0.1);--ball-focus-outline:rgba(180,200,220,0.85);--ball-logo-bg:linear-gradient(180deg,#8899aa 0%,#556677 100%);--ball-logo-shadow-top:rgba(0,0,0,0.25);--ball-logo-shadow-near:rgba(255,255,255,0.6);--ball-logo-shadow-far:rgba(0,0,0,0.1);--ball-logo-filter-glow:drop-shadow(0 0 1px rgba(0,0,0,0.2));--snapshot-accent:#5b8cff;--snapshot-accent-soft:rgba(91,140,255,0.25);--snapshot-bg:#fff;--snapshot-stroke:rgba(0,0,0,0.12);--snapshot-text:#2a2a2a;--snapshot-muted:#777;--snapshot-bg-gradient:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.3));--snapshot-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.45);--snapshot-outer-shadow:0 1px 2px rgba(0,0,0,0.04);--snapshot-focus-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.5);--snapshot-btn-bg:#f5f5f0;--snapshot-btn-text:#333;--snapshot-btn-hover-bg:#e9e9e0;--snapshot-btn-active-bg:#dcdccf}.dark-theme{--bg-blur-heavy:linear-gradient(180deg,rgba(35,37,43,0.8),rgba(28,29,33,0.75));--bg-blur-light:linear-gradient(90deg,rgba(50,52,59,0.7),rgba(42,43,48,0.6));--bg-solid:#2d2f37;--bg-soft:rgba(60,63,73,0.5);--bg-empty:rgba(60,63,73,0.25);--border-strong:rgba(255,255,255,0.12);--border-normal:rgba(255,255,255,0.1);--border-soft:rgba(255,255,255,0.08);--border-dashed:rgba(255,255,255,0.1);--text-title:#f9fafb;--text-subtitle:#d1d5db;--text-normal:#9ca3af;--shadow-panel:0 10px 40px rgba(0,0,0,0.3);--shadow-button:0 2px 8px rgba(0,0,0,0.25);--shadow-button-hover:0 6px 16px rgba(0,0,0,0.35);--shadow-inset:inset 0 1px 0 rgba(255,255,255,0.1);--chip-bg:linear-gradient(180deg,#4b5563,#374151);--chip-text:#e5e7eb;--chip-border:rgba(255,255,255,0.1);--chip-ok-bg:linear-gradient(180deg,#064e3b,#052e22);--chip-ok-text:#a7f3d0;--chip-ok-border:#047857;--mk-pill-bg:linear-gradient(180deg,#3730a3,#312e81);--mk-pill-text:#c7d2fe;--mk-pill-border:#4f46e5;--mk-pill-null-bg:linear-gradient(180deg,#4b5563,#374151);--mk-pill-null-text:#9ca3af;--mk-pill-null-border:#6b7280;--settings-bg-glass:linear-gradient(180deg,rgba(40,42,48,0.8),rgba(33,34,38,0.75));--settings-shadow-card:0 10px 40px rgba(0,0,0,0.3);--settings-shadow-inset:inset 0 1px 0 rgba(255,255,255,0.05);--settings-shadow-minibtn:0 2px 6px rgba(0,0,0,0.2);--settings-shadow-minibtn-hover:0 5px 12px rgba(0,0,0,0.3);--settings-bg-var-row:#2d2f37;--settings-text-input:#f9fafb;--settings-text-primary-btn:#e0f2fe;--settings-border-input:#4b5563;--settings-bg-btn-primary:linear-gradient(180deg,#3b82f6,#2563eb);--settings-border-btn-primary:#1d4ed8;--settings-bg-btn-subtle:linear-gradient(180deg,#4b5563,#374151);--settings-bg-type-chip:#3730a3;--settings-border-type-chip:#4f46e5;--settings-bg-switch-track:#4b5563;--settings-bg-switch-handle:#d1d5db;--settings-shadow-switch-handle:0 1px 3px rgba(0,0,0,0.4);--settings-bg-switch-checked:#3b82f6;--settings-text-hint-ok:#34d399;--settings-text-hint-bad:#ef4444;--actions-bg-glass:linear-gradient(180deg,rgba(40,42,48,0.8),rgba(33,34,38,0.75));--actions-shadow-card:0 10px 40px rgba(0,0,0,0.3);--actions-btn-bg:linear-gradient(180deg,#4b5563,#374151);--actions-btn-text:#d1d5db;--actions-btn-primary-bg:linear-gradient(180deg,#3b82f6,#2563eb);--actions-btn-primary-border:#1d4ed8;--actions-btn-primary-text:#f1f5f9;--actions-btn-subtle-bg:linear-gradient(180deg,#4b5563,#374151);--actions-btn-subtle-border:#6b7280;--actions-shadow-btn-active:0 2px 8px rgba(0,0,0,0.2);--actions-outline-focus:#2563eb;--accordion-bg:var(--bg-solid);--accordion-body-bg:rgba(45,47,55,0.5);--meta-bg:linear-gradient(180deg,#2d2f37,#24262b);--meta-shadow:0 6px 18px rgba(0,0,0,0.2);--meta-key-bg:#374151;--meta-glow-bg:linear-gradient(90deg,#3b82f6,#8b5cf6,#10b981,#ec4899);--json-hover-bg:rgba(147,197,253,0.1);--json-tree-line:rgba(107,114,128,0.4);--json-key-color:#e5e7eb;--json-val-string:#6ee7b7;--json-val-number:#c4b5fd;--json-val-boolean:#7dd3fc;--json-val-null:#9ca3af;--json-caret-shadow:0 1px 0 rgba(255,255,255,0.05),0 2px 6px rgba(0,0,0,0.2);--json-caret-open-shadow:0 3px 10px rgba(0,0,0,0.3);--tab-active-shadow:0 0 0 3px rgba(59,130,246,0.4);--tab-content-bg:rgba(45,47,55,0.5);--ball-hue:220;--ball-sat:10%;--ball-lum:25%;--ball-shadow-color:rgba(0,0,0,0.3);--ball-glow-color:rgba(150,180,210,0.4);--ball-inner-shadow-color:rgba(0,0,0,0.4);--ball-specular-color:rgba(255,255,255,0.15);--ball-glass-color:rgba(255,255,255,0.05);--ball-focus-outline:rgba(150,180,210,0.7);--ball-logo-bg:linear-gradient(180deg,rgba(255,255,255,0.9) 0%,rgba(233,213,255,0.6) 45%,rgba(220,200,255,0.5) 65%,rgba(191,128,255,0.65) 100%),linear-gradient(180deg,rgba(0,0,0,0.45),rgba(0,0,0,0) 60%);--ball-logo-shadow-top:rgba(255,255,255,0.6);--ball-logo-shadow-near:rgba(0,0,0,0.3);--ball-logo-shadow-far:rgba(138,43,226,0.45);--ball-logo-filter-glow:drop-shadow(0 0 3px rgba(191,128,255,0.35));--snapshot-accent:#3b82f6;--snapshot-accent-soft:rgba(59,130,246,0.3);--snapshot-bg:#2d2f37;--snapshot-stroke:rgba(255,255,255,0.1);--snapshot-text:#f9fafb;--snapshot-muted:#9ca3af;--snapshot-bg-gradient:linear-gradient(180deg,rgba(255,255,255,0.08),transparent);--snapshot-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.05);--snapshot-outer-shadow:0 1px 2px rgba(0,0,0,0.2);--snapshot-focus-inner-shadow:inset 0 1px 0 rgba(255,255,255,0.1);--snapshot-btn-bg:#4a4a4a;--snapshot-btn-text:#eee;--snapshot-btn-hover-bg:#5a5a5a;--snapshot-btn-active-bg:#3a3a3a}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/ThemeManager.vue\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"<script setup lang=\\\"ts\\\">\\nimport { defineExpose, ref } from 'vue';\\n\\nconst isDarkMode = ref(false);\\n\\n// 通过 defineExpose 将状态和方法暴露给父组件\\ndefineExpose({\\n  isDarkMode,\\n});\\n</script>\\n\\n<style>\\n/*\\n  这个 style 标签没有 'scoped' 属性，\\n  因此当 ThemeManager 组件被挂载时，\\n  这里的所有样式都会作为全局样式注入到页面中。\\n*/\\n\\n/* 亮色主题（默认） */\\n:root {\\n  /* === App.vue & General Styles === */\\n  --bg-blur-heavy: linear-gradient(180deg, rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.65));\\n  --bg-blur-light: linear-gradient(90deg, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.45));\\n  --bg-solid: #fff;\\n  --bg-soft: rgba(255, 255, 255, 0.6);\\n  --bg-empty: rgba(255, 255, 255, 0.5);\\n  --border-strong: rgba(255, 255, 255, 0.6);\\n  --border-normal: rgba(0, 0, 0, 0.08);\\n  --border-soft: rgba(0, 0, 0, 0.06);\\n  --border-dashed: rgba(0, 0, 0, 0.08);\\n  --text-title: #1f2937;\\n  --text-subtitle: #374151;\\n  --text-normal: #6b7280;\\n  --shadow-panel: 0 10px 40px rgba(0, 0, 0, 0.18);\\n  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.08);\\n  --shadow-button-hover: 0 6px 16px rgba(0, 0, 0, 0.12);\\n  --shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.6);\\n  --chip-bg: linear-gradient(180deg, #fafafa, #f4f4f4);\\n  --chip-text: #6b7280;\\n  --chip-border: rgba(0, 0, 0, 0.06);\\n  --chip-ok-bg: linear-gradient(180deg, #ecfdf5, #d1fae5);\\n  --chip-ok-text: #065f46;\\n  --chip-ok-border: #a7f3d0;\\n  --mk-pill-bg: linear-gradient(180deg, #eef2ff, #e0e7ff);\\n  --mk-pill-text: #4338ca;\\n  --mk-pill-border: #c7d2fe;\\n  --mk-pill-null-bg: linear-gradient(180deg, #f9fafb, #f3f4f6);\\n  --mk-pill-null-text: #6b7280;\\n  --mk-pill-null-border: #e5e7eb;\\n\\n  /* === EraSettingsPanel.vue Styles === */\\n  --settings-bg-glass: linear-gradient(180deg, rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.62));\\n  --settings-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.16);\\n  --settings-shadow-inset: inset 0 1px 0 #fff;\\n  --settings-shadow-minibtn: 0 2px 6px rgba(0, 0, 0, 0.06);\\n  --settings-shadow-minibtn-hover: 0 5px 12px rgba(0, 0, 0, 0.1);\\n  --settings-bg-var-row: linear-gradient(180deg, #ffffff, #f8fafc);\\n  --settings-text-input: #111827;\\n  --settings-text-primary-btn: #0f172a;\\n  --settings-border-input: #e5e7eb;\\n  --settings-bg-btn-primary: linear-gradient(180deg, #e0f2fe, #bfdbfe);\\n  --settings-border-btn-primary: #93c5fd;\\n  --settings-bg-btn-subtle: linear-gradient(180deg, #f9fafb, #f3f4f6);\\n  --settings-bg-type-chip: #eef2ff;\\n  --settings-border-type-chip: #c7d2fe;\\n  --settings-bg-switch-track: #e5e7eb;\\n  --settings-bg-switch-handle: #fff;\\n  --settings-shadow-switch-handle: 0 1px 3px rgba(0, 0, 0, 0.2);\\n  --settings-bg-switch-checked: #93c5fd;\\n  --settings-text-hint-ok: #065f46;\\n  --settings-text-hint-bad: #b91c1c;\\n\\n  /* === ActionButtons.vue & AboutEra.vue Styles === */\\n  --actions-bg-glass: linear-gradient(180deg, rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.62));\\n  --actions-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.16);\\n  --actions-btn-bg: linear-gradient(180deg, #fafafa, #f3f4f6);\\n  --actions-btn-text: #374151;\\n  --actions-btn-primary-bg: linear-gradient(180deg, #e0f2fe, #bfdbfe);\\n  --actions-btn-primary-border: #93c5fd;\\n  --actions-btn-primary-text: #0f172a;\\n  --actions-btn-subtle-bg: linear-gradient(180deg, #f9fafb, #f3f4f6);\\n  --actions-btn-subtle-border: #e5e7eb;\\n  --actions-btn-danger-bg: linear-gradient(180deg, #fee2e2, #fecaca);\\n  --actions-btn-danger-border: #fca5a5;\\n  --actions-btn-danger-text: #991b1b;\\n  --actions-shadow-btn-active: 0 2px 8px rgba(0, 0, 0, 0.1);\\n  --actions-outline-focus: #60a5fa;\\n  --text-soft: #6b7280;\\n\\n  /* === EraAccordion.vue Styles === */\\n  --accordion-bg: linear-gradient(180deg, #fff, #fafafa);\\n  --accordion-body-bg: rgba(255, 255, 255, 0.82);\\n\\n  /* === MetaHeader.vue Styles === */\\n  --meta-bg: linear-gradient(180deg, #ffffff, #f9fafb);\\n  --meta-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);\\n  --meta-key-bg: #f3f4f6;\\n  --meta-glow-bg: linear-gradient(90deg, #60a5fa, #a78bfa, #34d399, #f472b6);\\n\\n  /* === JsonNode.vue Styles === */\\n  --json-hover-bg: rgba(59, 130, 246, 0.06);\\n  --json-tree-line: rgba(107, 114, 128, 0.25);\\n  --json-key-color: #1f2937;\\n  --json-val-string: #047857;\\n  --json-val-number: #7c3aed;\\n  --json-val-boolean: #0369a1;\\n  --json-val-null: #9ca3af;\\n  --json-caret-shadow: 0 1px 0 #fff, 0 2px 6px rgba(0, 0, 0, 0.06);\\n  --json-caret-open-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);\\n\\n  /* === TabSwitch.vue Styles === */\\n  --tab-active-shadow: 0 0 0 3px rgba(147, 197, 253, 0.35);\\n  --tab-content-bg: rgba(255, 255, 255, 0.86);\\n\\n  /* === FloatingBall.vue Styles === */\\n  --ball-hue: 210;\\n  --ball-sat: 15%;\\n  --ball-lum: 95%;\\n  --ball-shadow-color: rgba(0, 0, 0, 0.15);\\n  --ball-glow-color: rgba(180, 200, 220, 0.55);\\n  --ball-inner-shadow-color: rgba(0, 0, 0, 0.1);\\n  --ball-specular-color: rgba(255, 255, 255, 0.9);\\n  --ball-glass-color: rgba(255, 255, 255, 0.1);\\n  --ball-focus-outline: rgba(180, 200, 220, 0.85);\\n  --ball-logo-bg: linear-gradient(180deg, #8899aa 0%, #556677 100%);\\n  --ball-logo-shadow-top: rgba(0, 0, 0, 0.25);\\n  --ball-logo-shadow-near: rgba(255, 255, 255, 0.6);\\n  --ball-logo-shadow-far: rgba(0, 0, 0, 0.1);\\n  --ball-logo-filter-glow: drop-shadow(0 0 1px rgba(0, 0, 0, 0.2));\\n\\n  /* === SnapshotManager.vue Styles === */\\n  --snapshot-accent: #5b8cff;\\n  --snapshot-accent-soft: rgba(91, 140, 255, 0.25);\\n  --snapshot-bg: #fff;\\n  --snapshot-stroke: rgba(0, 0, 0, 0.12);\\n  --snapshot-text: #2a2a2a;\\n  --snapshot-muted: #777;\\n  --snapshot-bg-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));\\n  --snapshot-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45);\\n  --snapshot-outer-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);\\n  --snapshot-focus-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5);\\n\\n  /* Custom Button Colors */\\n  --snapshot-btn-bg: #f5f5f0;\\n  --snapshot-btn-text: #333;\\n  --snapshot-btn-hover-bg: #e9e9e0;\\n  --snapshot-btn-active-bg: #dcdccf;\\n}\\n\\n/* 暗色主题 */\\n.dark-theme {\\n  /* === App.vue & General Styles === */\\n  --bg-blur-heavy: linear-gradient(180deg, rgba(35, 37, 43, 0.8), rgba(28, 29, 33, 0.75));\\n  --bg-blur-light: linear-gradient(90deg, rgba(50, 52, 59, 0.7), rgba(42, 43, 48, 0.6));\\n  --bg-solid: #2d2f37;\\n  --bg-soft: rgba(60, 63, 73, 0.5);\\n  --bg-empty: rgba(60, 63, 73, 0.25);\\n  --border-strong: rgba(255, 255, 255, 0.12);\\n  --border-normal: rgba(255, 255, 255, 0.1);\\n  --border-soft: rgba(255, 255, 255, 0.08);\\n  --border-dashed: rgba(255, 255, 255, 0.1);\\n  --text-title: #f9fafb;\\n  --text-subtitle: #d1d5db;\\n  --text-normal: #9ca3af;\\n  --shadow-panel: 0 10px 40px rgba(0, 0, 0, 0.3);\\n  --shadow-button: 0 2px 8px rgba(0, 0, 0, 0.25);\\n  --shadow-button-hover: 0 6px 16px rgba(0, 0, 0, 0.35);\\n  --shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.1);\\n  --chip-bg: linear-gradient(180deg, #4b5563, #374151);\\n  --chip-text: #e5e7eb;\\n  --chip-border: rgba(255, 255, 255, 0.1);\\n  --chip-ok-bg: linear-gradient(180deg, #064e3b, #052e22);\\n  --chip-ok-text: #a7f3d0;\\n  --chip-ok-border: #047857;\\n  --mk-pill-bg: linear-gradient(180deg, #3730a3, #312e81);\\n  --mk-pill-text: #c7d2fe;\\n  --mk-pill-border: #4f46e5;\\n  --mk-pill-null-bg: linear-gradient(180deg, #4b5563, #374151);\\n  --mk-pill-null-text: #9ca3af;\\n  --mk-pill-null-border: #6b7280;\\n\\n  /* === EraSettingsPanel.vue Styles === */\\n  --settings-bg-glass: linear-gradient(180deg, rgba(40, 42, 48, 0.8), rgba(33, 34, 38, 0.75));\\n  --settings-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.3);\\n  --settings-shadow-inset: inset 0 1px 0 rgba(255, 255, 255, 0.05);\\n  --settings-shadow-minibtn: 0 2px 6px rgba(0, 0, 0, 0.2);\\n  --settings-shadow-minibtn-hover: 0 5px 12px rgba(0, 0, 0, 0.3);\\n  --settings-bg-var-row: #2d2f37;\\n  --settings-text-input: #f9fafb;\\n  --settings-text-primary-btn: #e0f2fe;\\n  --settings-border-input: #4b5563;\\n  --settings-bg-btn-primary: linear-gradient(180deg, #3b82f6, #2563eb);\\n  --settings-border-btn-primary: #1d4ed8;\\n  --settings-bg-btn-subtle: linear-gradient(180deg, #4b5563, #374151);\\n  --settings-bg-type-chip: #3730a3;\\n  --settings-border-type-chip: #4f46e5;\\n  --settings-bg-switch-track: #4b5563;\\n  --settings-bg-switch-handle: #d1d5db;\\n  --settings-shadow-switch-handle: 0 1px 3px rgba(0, 0, 0, 0.4);\\n  --settings-bg-switch-checked: #3b82f6;\\n  --settings-text-hint-ok: #34d399;\\n  --settings-text-hint-bad: #ef4444;\\n\\n  /* === ActionButtons.vue & AboutEra.vue Styles === */\\n  --actions-bg-glass: linear-gradient(180deg, rgba(40, 42, 48, 0.8), rgba(33, 34, 38, 0.75));\\n  --actions-shadow-card: 0 10px 40px rgba(0, 0, 0, 0.3);\\n  --actions-btn-bg: linear-gradient(180deg, #4b5563, #374151);\\n  --actions-btn-text: #d1d5db;\\n  --actions-btn-primary-bg: linear-gradient(180deg, #3b82f6, #2563eb);\\n  --actions-btn-primary-border: #1d4ed8;\\n  --actions-btn-primary-text: #f1f5f9;\\n  --actions-btn-subtle-bg: linear-gradient(180deg, #4b5563, #374151);\\n  --actions-btn-subtle-border: #6b7280;\\n  --actions-shadow-btn-active: 0 2px 8px rgba(0, 0, 0, 0.2);\\n  --actions-outline-focus: #2563eb;\\n\\n  /* === EraAccordion.vue Styles === */\\n  --accordion-bg: var(--bg-solid);\\n  --accordion-body-bg: rgba(45, 47, 55, 0.5);\\n\\n  /* === MetaHeader.vue Styles === */\\n  --meta-bg: linear-gradient(180deg, #2d2f37, #24262b);\\n  --meta-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);\\n  --meta-key-bg: #374151;\\n  --meta-glow-bg: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981, #ec4899);\\n\\n  /* === JsonNode.vue Styles === */\\n  --json-hover-bg: rgba(147, 197, 253, 0.1);\\n  --json-tree-line: rgba(107, 114, 128, 0.4);\\n  --json-key-color: #e5e7eb;\\n  --json-val-string: #6ee7b7;\\n  --json-val-number: #c4b5fd;\\n  --json-val-boolean: #7dd3fc;\\n  --json-val-null: #9ca3af;\\n  --json-caret-shadow: 0 1px 0 rgba(255, 255, 255, 0.05), 0 2px 6px rgba(0, 0, 0, 0.2);\\n  --json-caret-open-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);\\n\\n  /* === TabSwitch.vue Styles === */\\n  --tab-active-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);\\n  --tab-content-bg: rgba(45, 47, 55, 0.5);\\n\\n  /* === FloatingBall.vue Styles === */\\n  --ball-hue: 220;\\n  --ball-sat: 10%;\\n  --ball-lum: 25%;\\n  --ball-shadow-color: rgba(0, 0, 0, 0.3);\\n  --ball-glow-color: rgba(150, 180, 210, 0.4);\\n  --ball-inner-shadow-color: rgba(0, 0, 0, 0.4);\\n  --ball-specular-color: rgba(255, 255, 255, 0.15);\\n  --ball-glass-color: rgba(255, 255, 255, 0.05);\\n  --ball-focus-outline: rgba(150, 180, 210, 0.7);\\n  --ball-logo-bg:\\n    linear-gradient(\\n      180deg,\\n      rgba(255, 255, 255, 0.9) 0%,\\n      rgba(233, 213, 255, 0.6) 45%,\\n      rgba(220, 200, 255, 0.5) 65%,\\n      rgba(191, 128, 255, 0.65) 100%\\n    ),\\n    linear-gradient(180deg, rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0) 60%);\\n  --ball-logo-shadow-top: rgba(255, 255, 255, 0.6);\\n  --ball-logo-shadow-near: rgba(0, 0, 0, 0.3);\\n  --ball-logo-shadow-far: rgba(138, 43, 226, 0.45);\\n  --ball-logo-filter-glow: drop-shadow(0 0 3px rgba(191, 128, 255, 0.35));\\n\\n  /* === SnapshotManager.vue Styles === */\\n  --snapshot-accent: #3b82f6;\\n  --snapshot-accent-soft: rgba(59, 130, 246, 0.3);\\n  --snapshot-bg: #2d2f37;\\n  --snapshot-stroke: rgba(255, 255, 255, 0.1);\\n  --snapshot-text: #f9fafb;\\n  --snapshot-muted: #9ca3af;\\n  --snapshot-bg-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.08), transparent);\\n  --snapshot-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);\\n  --snapshot-outer-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\\n  --snapshot-focus-inner-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);\\n\\n  /* Custom Button Colors */\\n  --snapshot-btn-bg: #4a4a4a;\\n  --snapshot-btn-text: #eee;\\n  --snapshot-btn-hover-bg: #5a5a5a;\\n  --snapshot-btn-active-bg: #3a3a3a;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./RightRail.vue?vue&type=style&index=0&id=61d00544&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"5fc4b7f0\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./RightRail.vue?vue&type=style&index=0&id=61d00544&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./RightRail.vue?vue&type=style&index=0&id=61d00544&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraPanel.vue?vue&type=style&index=0&id=0e43fd44&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"2ba442f0\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraPanel.vue?vue&type=style&index=0&id=0e43fd44&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-46.use[1]!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.102.1/node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./EraPanel.vue?vue&type=style&index=0&id=0e43fd44&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.right-rail[data-v-61d00544]{flex:1 1 420px;min-width:400px;height:min(680px,86vh);position:sticky;top:10px;align-self:flex-start;z-index:1;display:flex;flex-direction:column}.right-rail-content-wrapper[data-v-61d00544]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;flex-grow:1}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/RightRail.vue\"],\"names\":[],\"mappings\":\"AAiBA,6BACE,cAAe,CACf,eAAgB,CAChB,sBAAwB,CACxB,eAAgB,CAChB,QAAS,CACT,qBAAsB,CACtB,SAAU,CACV,YAAa,CACb,qBACF,CAEA,6CACE,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,eAAgB,CAChB,WACF\",\"sourcesContent\":[\"<template>\\n  <aside class=\\\"right-rail\\\">\\n    <div class=\\\"right-rail-content-wrapper\\\">\\n      <ActionButtons />\\n      <EraSettingsPanel />\\n      <AboutEra />\\n    </div>\\n  </aside>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport AboutEra from './RightRailContent/AboutEra.vue';\\nimport ActionButtons from './RightRailContent/ActionButtons.vue';\\nimport EraSettingsPanel from './RightRailContent/EraSettingsPanel.vue';\\n</script>\\n\\n<style scoped>\\n.right-rail {\\n  flex: 1 1 420px;\\n  min-width: 400px;\\n  height: min(680px, 86vh);\\n  position: sticky;\\n  top: 10px;\\n  align-self: flex-start;\\n  z-index: 1;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.right-rail-content-wrapper {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 12px;\\n  overflow-y: auto;\\n  flex-grow: 1;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.102.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.floating-ball[data-v-3bb5cc6c]{--size:50px;--hue:var(--ball-hue,212);--sat:var(--ball-sat,100%);--lum:var(--ball-lum,52%);--surface:hsl(var(--hue) var(--sat) var(--lum));--surface-2:hsl(var(--hue) 95% 64%);--ring:hsl(calc(var(--hue) + 20) 95% 65%);--shadow:var(--ball-shadow-color,rgba(0,123,255,0.36));--glow:var(--ball-glow-color,rgba(102,200,255,0.55));--inner-shadow:var(--ball-inner-shadow-color,rgba(0,0,0,0.22));--specular:var(--ball-specular-color,rgba(255,255,255,0.75));--glass:var(--ball-glass-color,rgba(255,255,255,0.18));width:var(--size);height:var(--size);border-radius:50%;position:relative;display:grid;place-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;background:radial-gradient(120% 120% at 30% 28%,rgba(255,255,255,0.85) 0%,rgba(255,255,255,0.22) 18%,rgba(255,255,255,0) 36%),radial-gradient(120% 120% at 70% 72%,rgba(0,0,0,0.18) 0%,rgba(0,0,0,0) 38%),conic-gradient(from 210deg at 50% 50%,var(--surface),var(--surface-2),var(--surface));box-shadow:inset 0 2px 6px var(--inner-shadow),0 2px 4px rgba(0,0,0,0.08),0 10px 22px var(--shadow);transition:transform 0.28s ease,box-shadow 0.28s ease,filter 0.28s ease;will-change:transform,box-shadow,filter;animation:ball-bob-3bb5cc6c 3.2s ease-in-out infinite}.floating-ball[data-v-3bb5cc6c]::after{content:'';position:absolute;inset:-8px;border-radius:50%;background:conic-gradient(from 0deg,var(--ring),transparent 30%,transparent 70%,var(--ring));filter:blur(6px);opacity:0.55;pointer-events:none;-webkit-mask:radial-gradient(farthest-side,transparent calc(100% - 12px),#000 0);mask:radial-gradient(farthest-side,transparent calc(100% - 12px),#000 0);animation:ring-spin-3bb5cc6c 12s linear infinite}.floating-ball[data-v-3bb5cc6c]::before{content:'';position:absolute;inset:2px;border-radius:50%;background:radial-gradient(120% 80% at 26% 24%,var(--specular) 0%,rgba(255,255,255,0.2) 26%,rgba(255,255,255,0) 46%),linear-gradient(160deg,var(--glass) 0%,rgba(255,255,255,0) 50%);mix-blend-mode:screen;pointer-events:none;transition:opacity 0.28s ease,transform 0.28s ease}.floating-ball[data-v-3bb5cc6c]:hover{transform:translateY(-2px) scale(1.04);box-shadow:inset 0 2px 8px rgba(0,0,0,0.22),0 4px 10px rgba(0,0,0,0.12),0 16px 36px rgba(0,123,255,0.45);filter:saturate(1.08)}.floating-ball[data-v-3bb5cc6c]:hover::before{opacity:0.95;animation:shimmer-3bb5cc6c 1.2s ease-out}.floating-ball[data-v-3bb5cc6c]:active{transform:translateY(0) scale(0.98);box-shadow:inset 0 2px 10px rgba(0,0,0,0.28),0 2px 6px rgba(0,0,0,0.12),0 10px 22px rgba(0,123,255,0.35)}.floating-ball[data-v-3bb5cc6c]:focus-visible{outline:2px solid var(--ball-focus-outline,rgba(102,200,255,0.85));outline-offset:2px}@media (prefers-reduced-motion:reduce){.floating-ball[data-v-3bb5cc6c]{animation:none}.floating-ball[data-v-3bb5cc6c]::after{animation:none}}@keyframes ball-bob-3bb5cc6c{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes ring-spin-3bb5cc6c{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes shimmer-3bb5cc6c{0%{transform:translateY(-1px) scale(0.98);opacity:0.6}50%{transform:translateY(-2px) scale(1.02);opacity:1}100%{transform:translateY(-1px) scale(0.99);opacity:0.85}}.floating-ball[data-v-3bb5cc6c]{--logo-scale:0.38}.era-logo[data-v-3bb5cc6c]{font-weight:800;font-size:calc(var(--size) * var(--logo-scale));letter-spacing:0.02em;line-height:1;transform:translateY(-1px);white-space:nowrap;-webkit-user-select:none;user-select:none;pointer-events:none;z-index:1;background:var(--ball-logo-bg,linear-gradient(180deg,rgba(255,255,255,0.96) 0%,rgba(255,255,255,0.55) 45%,rgba(220,240,255,0.4) 65%,rgba(120,195,255,0.55) 100%),linear-gradient(180deg,rgba(0,0,0,0.38),rgba(0,0,0,0) 60%));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 1px 0 var(--ball-logo-shadow-top,rgba(255,255,255,0.75)),0 2px 4px var(--ball-logo-shadow-near,rgba(0,0,0,0.25)),0 8px 18px var(--ball-logo-shadow-far,rgba(0,123,255,0.35));filter:var(--ball-logo-filter-glow,drop-shadow(0 0 2px rgba(102,200,255,0.25)));animation:era-sheen-3bb5cc6c 4s ease-in-out infinite;transition:text-shadow 0.3s ease,filter 0.3s ease}.floating-ball:hover .era-logo[data-v-3bb5cc6c]{text-shadow:0 1px 0 var(--ball-logo-shadow-top,rgba(255,255,255,0.85)),0 3px 8px var(--ball-logo-shadow-near,rgba(0,0,0,0.28)),0 10px 26px var(--ball-logo-shadow-far,rgba(0,123,255,0.55));filter:var(--ball-logo-filter-glow,drop-shadow(0 0 3px rgba(102,200,255,0.38)))}@keyframes era-sheen-3bb5cc6c{0%,100%{background-position:0% 0%,0% 0%}50%{background-position:0% 40%,0% 0%}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/ERA变量框架/ui/components/FloatingBall.vue\"],\"names\":[],\"mappings\":\"AAuBA,gCACE,WAAY,CACZ,yBAA2B,CAC3B,0BAA4B,CAC5B,yBAA2B,CAC3B,+CAAgD,CAChD,mCAAoC,CACpC,yCAA0C,CAC1C,sDAA2D,CAC3D,oDAAyD,CACzD,8DAAmE,CACnE,4DAAiE,CACjE,sDAA2D,CAC3D,iBAAkB,CAClB,kBAAmB,CACnB,iBAAkB,CAClB,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,cAAe,CACf,wBAAiB,CAAjB,gBAAiB,CACjB,uCAAwC,CACxC,+RAQ0G,CAC1G,mGAG0C,CAC1C,uEAGmB,CACnB,uCAA0C,CAC1C,qDACF,CAGA,uCACE,UAAW,CACX,iBAAkB,CAClB,UAAW,CACX,iBAAkB,CAClB,4FAMC,CACD,gBAAiB,CACjB,YAAa,CACb,mBAAoB,CACpB,gFAA2E,CAA3E,wEAA2E,CAC3E,gDACF,CAGA,wCACE,UAAW,CACX,iBAAkB,CAClB,SAAU,CACV,iBAAkB,CAClB,oLAE+E,CAC/E,qBAAsB,CACtB,mBAAoB,CACpB,kDAGF,CAGA,sCACE,sCAAuC,CACvC,wGAGgD,CAChD,qBACF,CAGA,8CACE,YAAa,CACb,wCACF,CAGA,uCACE,mCAAoC,CACpC,wGAIF,CAGA,8CACE,kEAAuE,CACvE,kBACF,CAGA,uCACE,gCACE,cACF,CACA,uCACE,cACF,CACF,CAGA,6BACE,QAEE,uBACF,CACA,IACE,0BACF,CACF,CAGA,8BACE,GACE,sBACF,CACA,KACE,wBACF,CACF,CAGA,4BACE,GACE,sCAAuC,CACvC,WACF,CACA,IACE,sCAAuC,CACvC,SACF,CACA,KACE,sCAAuC,CACvC,YACF,CACF,CAGA,gCACE,iBACF,CAEA,2BACE,eAAgB,CAChB,+CAAgD,CAChD,qBAAsB,CACtB,aAAc,CACd,0BAA2B,CAC3B,kBAAmB,CACnB,wBAAiB,CAAjB,gBAAiB,CACjB,mBAAoB,CACpB,SAAU,CAGV,4NAUC,CACD,4BAA6B,CAC7B,oBAAqB,CACrB,iBAAkB,CAClB,0LAG2E,CAC3E,+EAAoF,CACpF,oDAA4C,CAC5C,iDAGF,CAEA,gDACE,2LAGkE,CAClE,+EACF,CAGA,8BACE,QAEE,+BAGF,CACA,IACE,gCAGF,CACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"floating-ball\\\" @click=\\\"$emit('click')\\\">\\n    <span class=\\\"era-logo\\\" aria-hidden=\\\"true\\\">ERA</span>\\n    <!-- 仅显示用；不拦截事件 -->\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { onMounted } from 'vue';\\nimport { Logger } from '../../utils/log';\\n\\nconst logger = new Logger();\\ndefineEmits(['click']);\\n\\nonMounted(() => {\\n  //logger.debug('onMounted', 'FloatingBall.vue 组件已挂载');\\n});\\n</script>\\n\\n<style scoped>\\n/* =========================\\n   可调外观变量（局部作用域）\\n   ========================= */\\n.floating-ball {\\n  --size: 50px; /* 直径：保持默认 50px，与原始一致 */\\n  --hue: var(--ball-hue, 212); /* 主色相：212≈#007bff，方便全局协调色相 */\\n  --sat: var(--ball-sat, 100%); /* 饱和度：更鲜亮 */\\n  --lum: var(--ball-lum, 52%); /* 明度：主色的明度 */\\n  --surface: hsl(var(--hue) var(--sat) var(--lum)); /* 主表面色 */\\n  --surface-2: hsl(var(--hue) 95% 64%); /* 渐变第二色，略亮 */\\n  --ring: hsl(calc(var(--hue) + 20) 95% 65%); /* 外环的点缀色，偏青一点 */\\n  --shadow: var(--ball-shadow-color, rgba(0, 123, 255, 0.36)); /* 阴影颜色（与主色相近） */\\n  --glow: var(--ball-glow-color, rgba(102, 200, 255, 0.55)); /* 外发光颜色 */\\n  --inner-shadow: var(--ball-inner-shadow-color, rgba(0, 0, 0, 0.22)); /* 内阴影增强体积感 */\\n  --specular: var(--ball-specular-color, rgba(255, 255, 255, 0.75)); /* 高光 */\\n  --glass: var(--ball-glass-color, rgba(255, 255, 255, 0.18)); /* 玻璃质感覆盖层 */\\n  width: var(--size); /* 宽度设为可变量 */\\n  height: var(--size); /* 高度设为可变量 */\\n  border-radius: 50%; /* 圆形 */\\n  position: relative; /* 作为伪元素定位参照 */\\n  display: grid; /* 用 grid 实现精确居中 */\\n  place-items: center; /* 居中对齐 */\\n  cursor: pointer; /* 手型光标（仅视觉，不改逻辑） */\\n  user-select: none; /* 防止误选中文本 */\\n  -webkit-tap-highlight-color: transparent; /* 移动端点击高亮去除 */\\n  background:\\n    radial-gradient(\\n      120% 120% at 30% 28%,\\n      rgba(255, 255, 255, 0.85) 0%,\\n      rgba(255, 255, 255, 0.22) 18%,\\n      rgba(255, 255, 255, 0) 36%\\n    ),\\n    /* 玻璃高光 */ radial-gradient(120% 120% at 70% 72%, rgba(0, 0, 0, 0.18) 0%, rgba(0, 0, 0, 0) 38%),\\n    /* 微内阴影，增加体积 */ conic-gradient(from 210deg at 50% 50%, var(--surface), var(--surface-2), var(--surface)); /* 主表面渐变：柔和流动感 */\\n  box-shadow:\\n    inset 0 2px 6px var(--inner-shadow),\\n    /* 内阴影：球体边缘收束 */ 0 2px 4px rgba(0, 0, 0, 0.08),\\n    /* 基础投影：贴地感 */ 0 10px 22px var(--shadow); /* 远投影：悬浮感 */\\n  transition:\\n    transform 0.28s ease,\\n    box-shadow 0.28s ease,\\n    filter 0.28s ease; /* 悬停时的平滑过渡 */\\n  will-change: transform, box-shadow, filter; /* 提示浏览器优化 */\\n  animation: ball-bob 3.2s ease-in-out infinite; /* 轻微上下浮动 */\\n}\\n\\n/* 光晕外环（纯视觉层），不占点击区域 */\\n.floating-ball::after {\\n  content: ''; /* 生成外环层 */\\n  position: absolute; /* 绝对定位贴合父元素 */\\n  inset: -8px; /* 向外延展 8px，制造发光边缘 */\\n  border-radius: 50%; /* 保持圆形 */\\n  background: conic-gradient(\\n    from 0deg,\\n    var(--ring),\\n    transparent 30%,\\n    transparent 70%,\\n    var(--ring)\\n  ); /* 细腻的色环闪烁 */\\n  filter: blur(6px); /* 模糊成柔和光晕 */\\n  opacity: 0.55; /* 半透明，避免喧宾 */\\n  pointer-events: none; /* 不拦截鼠标事件 */\\n  mask: radial-gradient(farthest-side, transparent calc(100% - 12px), #000 0); /* 掏空中心形成环 */\\n  animation: ring-spin 12s linear infinite; /* 慢速旋转，低侵扰 */\\n}\\n\\n/* 玻璃高光层（更立体） */\\n.floating-ball::before {\\n  content: ''; /* 生成高光层 */\\n  position: absolute; /* 绝对定位 */\\n  inset: 2px; /* 缩进一点，保留边缘 */\\n  border-radius: 50%; /* 圆形 */\\n  background:\\n    radial-gradient(120% 80% at 26% 24%, var(--specular) 0%, rgba(255, 255, 255, 0.2) 26%, rgba(255, 255, 255, 0) 46%),\\n    /* 亮斑 */ linear-gradient(160deg, var(--glass) 0%, rgba(255, 255, 255, 0) 50%); /* 玻璃蒙层 */\\n  mix-blend-mode: screen; /* 与底色叠加更自然 */\\n  pointer-events: none; /* 不拦截事件 */\\n  transition:\\n    opacity 0.28s ease,\\n    transform 0.28s ease; /* 悬停联动 */\\n}\\n\\n/* 悬停态：轻微抬升+增强光影 */\\n.floating-ball:hover {\\n  transform: translateY(-2px) scale(1.04); /* 轻微升起并放大 */\\n  box-shadow:\\n    inset 0 2px 8px rgba(0, 0, 0, 0.22),\\n    /* 内阴影略加强 */ 0 4px 10px rgba(0, 0, 0, 0.12),\\n    /* 近影增强 */ 0 16px 36px rgba(0, 123, 255, 0.45); /* 远影更亮，呈现发光 */\\n  filter: saturate(1.08); /* 提升饱和度一点点 */\\n}\\n\\n/* 悬停时的微光扫过效果 */\\n.floating-ball:hover::before {\\n  opacity: 0.95; /* 高光更显著 */\\n  animation: shimmer 1.2s ease-out; /* 一次性高光掠过 */\\n}\\n\\n/* 按下态：略压低 */\\n.floating-ball:active {\\n  transform: translateY(0) scale(0.98); /* 回落一点并轻微压扁 */\\n  box-shadow:\\n    inset 0 2px 10px rgba(0, 0, 0, 0.28),\\n    0 2px 6px rgba(0, 0, 0, 0.12),\\n    0 10px 22px rgba(0, 123, 255, 0.35); /* 回到接近初始的阴影 */\\n}\\n\\n/* 可达性：键盘聚焦时的可见描边（不改变布局） */\\n.floating-ball:focus-visible {\\n  outline: 2px solid var(--ball-focus-outline, rgba(102, 200, 255, 0.85)); /* 高亮描边 */\\n  outline-offset: 2px; /* 外移 2px，避免遮挡球体 */\\n}\\n\\n/* 减少动态偏好：关闭动画保持静态优雅 */\\n@media (prefers-reduced-motion: reduce) {\\n  .floating-ball {\\n    animation: none;\\n  } /* 去除上下浮动 */\\n  .floating-ball::after {\\n    animation: none;\\n  } /* 停止外环旋转 */\\n}\\n\\n/* 轻微上下浮动（循环） */\\n@keyframes ball-bob {\\n  0%,\\n  100% {\\n    transform: translateY(0);\\n  } /* 起点/终点：原位 */\\n  50% {\\n    transform: translateY(-2px);\\n  } /* 中点：上浮 2px */\\n}\\n\\n/* 外环慢速旋转（不刺眼） */\\n@keyframes ring-spin {\\n  0% {\\n    transform: rotate(0deg);\\n  } /* 起点：0 度 */\\n  100% {\\n    transform: rotate(360deg);\\n  } /* 终点：整周旋转 */\\n}\\n\\n/* 悬停时的高光扫过 */\\n@keyframes shimmer {\\n  0% {\\n    transform: translateY(-1px) scale(0.98);\\n    opacity: 0.6;\\n  } /* 初始：弱一点的高光 */\\n  50% {\\n    transform: translateY(-2px) scale(1.02);\\n    opacity: 1;\\n  } /* 中段：最亮最大 */\\n  100% {\\n    transform: translateY(-1px) scale(0.99);\\n    opacity: 0.85;\\n  } /* 结束：回落 */\\n}\\n\\n/* ======= ERA 内标（仅视觉层） ======= */\\n.floating-ball {\\n  --logo-scale: 0.38;\\n} /* 可调：字体占球直径比例 */\\n\\n.era-logo {\\n  font-weight: 800; /* 粗体，增强刻感 */\\n  font-size: calc(var(--size) * var(--logo-scale)); /* 跟随球大小缩放 */\\n  letter-spacing: 0.02em; /* 轻微字距，避免糊 */\\n  line-height: 1; /* 紧凑对齐 */\\n  transform: translateY(-1px); /* 视觉微调居中 */\\n  white-space: nowrap; /* 防止换行 */\\n  user-select: none;\\n  pointer-events: none; /* 不抢事件、不选中 */\\n  z-index: 1; /* 位于背景之上（仍在 ::after 光环之下） */\\n\\n  /* 渐变镂空字 + 立体阴影 */\\n  background: var(\\n    --ball-logo-bg,\\n    linear-gradient(\\n      180deg,\\n      rgba(255, 255, 255, 0.96) 0%,\\n      rgba(255, 255, 255, 0.55) 45%,\\n      rgba(220, 240, 255, 0.4) 65%,\\n      rgba(120, 195, 255, 0.55) 100%\\n    ),\\n    linear-gradient(180deg, rgba(0, 0, 0, 0.38), rgba(0, 0, 0, 0) 60%)\\n  );\\n  -webkit-background-clip: text;\\n  background-clip: text; /* 渐变裁剪到文字 */\\n  color: transparent; /* 镂空填充由背景提供 */\\n  text-shadow:\\n    0 1px 0 var(--ball-logo-shadow-top, rgba(255, 255, 255, 0.75)),\\n    /* 顶部掣光 */ 0 2px 4px var(--ball-logo-shadow-near, rgba(0, 0, 0, 0.25)),\\n    /* 近阴影 */ 0 8px 18px var(--ball-logo-shadow-far, rgba(0, 123, 255, 0.35)); /* 远发光阴影 */\\n  filter: var(--ball-logo-filter-glow, drop-shadow(0 0 2px rgba(102, 200, 255, 0.25))); /* 柔光晕 */\\n  animation: era-sheen 4s ease-in-out infinite; /* 轻微高光流动 */\\n  transition:\\n    text-shadow 0.3s ease,\\n    filter 0.3s ease;\\n}\\n\\n.floating-ball:hover .era-logo {\\n  text-shadow:\\n    0 1px 0 var(--ball-logo-shadow-top, rgba(255, 255, 255, 0.85)),\\n    0 3px 8px var(--ball-logo-shadow-near, rgba(0, 0, 0, 0.28)),\\n    0 10px 26px var(--ball-logo-shadow-far, rgba(0, 123, 255, 0.55)); /* 悬停增强立体感 */\\n  filter: var(--ball-logo-filter-glow, drop-shadow(0 0 3px rgba(102, 200, 255, 0.38))); /* 发光略加强 */\\n}\\n\\n/* 高光缓慢上移，制造玻璃流光感（低侵扰） */\\n@keyframes era-sheen {\\n  0%,\\n  100% {\\n    background-position:\\n      0% 0%,\\n      0% 0%;\\n  }\\n  50% {\\n    background-position:\\n      0% 40%,\\n      0% 0%;\\n  }\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = z;","/**\n * @file ERA 变量框架 - 核心常量模块\n * @description\n * 该文件集中定义了整个 ERA 框架所使用的关键常量。\n * 这些常量主要用作在酒馆 `chat` 变量中存储和检索 ERA 核心数据的路径（键名）。\n *\n * **核心数据结构**:\n * ERA 的数据被分为两部分，存储在 `chat` 变量下：\n * 1. **元数据 (ERAMetaData)**: 包含框架自身运行所需的核心数据，如 `EditLogs` 和 `SelectedMks`。\n * 2. **状态数据 (stat_data)**: 包含所有由用户和 AI 管理的游戏/故事变量，如 `player`、`world_state` 等。\n *\n * 其结构大致如下：\n * ```json\n * {\n *   \"ERAMetaData\": {\n *     \"EditLogs\": { ... },\n *     \"SelectedMks\": [ ... ]\n *   },\n *   \"stat_data\": {\n *     \"player\": { \"hp\": 100, \"gold\": 50 },\n *     \"world_state\": { ... }\n *   }\n * }\n * ```\n * 将这些路径定义为常量，有助于：\n * 1. **避免硬编码**：减少因拼写错误导致的 bug。\n * 2. **提高可维护性**：如果未来需要调整数据结构，只需修改此文件即可。\n * 3. **增强代码可读性**：常量的名称清晰地表达了其所指向的数据的含义。\n */\n\n'use strict';\n\nimport { z } from 'zod';\n\n/**\n * @constant {z.ZodObject} SettingsSchema\n * @description\n * 定义了脚本设置的 Zod schema，包括类型和默认值。\n */\nexport const SettingsSchema = z.object({\n  在ai消息尾部生成特殊符号: z.boolean().default(true),\n  特殊符号值: z.string().default('<StatusPlaceHolderImpl/>'),\n  开启悬浮球: z.boolean().default(true),\n  开启黑夜模式: z.boolean().default(false),\n  强制重载功能: z.boolean().default(false),\n  强制重载消息数: z.number().default(2),\n  繁体转简体: z.boolean().default(false),\n});\n\n/**\n * @type {EraConfig}\n * @description ERA 框架的配置类型。\n */\nexport type EraConfig = z.infer<typeof SettingsSchema>;\n\n/**\n * @constant {object} CHAT_SCOPE\n * @description\n * 用于酒馆助手 `getVariables` 和 `replaceVariables` 系列函数的 `scope` 参数。\n * 它指定了操作的目标是当前**聊天（Chat）**级别的变量。\n * ERA 框架的所有核心数据和用户变量都存储在此作用域下。\n */\nexport const CHAT_SCOPE = { type: 'chat' as const };\n\n/**\n * @constant {string} META_DATA_PATH\n * @description 在 `chat` 变量中，存储 ERA 框架**元数据**的根对象的键名。\n */\nexport const META_DATA_PATH = 'ERAMetaData';\n\n/**\n * @constant {string} STAT_DATA_PATH\n * @description 在 `chat` 变量中，存储用户**状态数据**的根对象的键名。\n */\nexport const STAT_DATA_PATH = 'stat_data';\n\n/**\n * @constant {string} LOGS_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**编辑日志（Edit Logs）**的对象的键名，即 `\"EditLogs\"`。\n * `EditLogs` 是一个以**消息密钥（MK）**为键，以该消息引发的变量变更记录数组为值的对象。\n * 这是实现“逆序回滚”功能的基础数据。\n *\n * @example\n * // chat.ERAMetaData.EditLogs 的一个条目\n * \"era_mk_1759246942209_jipmrj\": [\n *   { \"op\": \"insert\", \"path\": \"testData.inventory\", \"value_new\": { \"gold\": 100, \"slots\": [\"sword\", \"shield\"] } },\n *   { \"op\": \"update\", \"path\": \"player.hp\", \"value_old\": 90, \"value_new\": 100 }\n * ]\n */\nexport const LOGS_PATH = 'EditLogs';\n\n/**\n * @constant {string} SEL_PATH\n * @description\n * 在 `ERAMetaData` 对象中，存储**已选择消息密钥链（Selected Message Keys）**的数组的键名，即 `\"SelectedMks\"`。\n * `SelectedMks` 是一个稀疏数组，其**索引约等于消息 ID**，值是该楼层消息的 MK。\n * 这个数组是 ERA 框架的“脊梁”，是连接抽象变量状态与具体聊天历史的桥梁。\n * 框架通过比对 `SelectedMks` 与实际消息流中的 MK，来判断数据是否需要同步。\n *\n * @example\n * // chat.ERAMetaData.SelectedMks\n * [ , \"era_mk_greeting\", \"era_mk_abc123\", , \"era_mk_xyz789\"]\n */\nexport const SEL_PATH = 'SelectedMks';\n\n/**\n * @constant {string} ERA_DATA_TAG\n * @description\n * 用于在消息内容中包裹 ERA 元数据（如消息密钥 MK）的 XML 风格标签名。\n * e.g., `<era_data>{...}</era_data>`\n */\nexport const ERA_DATA_TAG = 'era_data';\n\n/**\n * @constant {RegExp} ERA_DATA_REGEX\n * @description\n * 用于从消息内容字符串中匹配和提取 `<era_data>` 块的正则表达式。\n * 这个常量被定义在这里，以避免 `message_key.ts` 和 `message_utils.ts` 之间的循环依赖。\n */\nexport const ERA_DATA_REGEX = new RegExp(`<${ERA_DATA_TAG}>({.*?})<\\\\/${ERA_DATA_TAG}>`);\n\n/**\n * @constant {object} ERA_API_EVENTS\n * @description\n * 定义了所有供外部脚本通过 `eventEmit` 调用的自定义 API 事件名称。\n * 使用这些常量可以避免在代码中使用硬编码的字符串。\n */\nexport const ERA_API_EVENTS = {\n  INSERT_BY_OBJECT: 'era:insertByObject',\n  UPDATE_BY_OBJECT: 'era:updateByObject',\n  INSERT_BY_PATH: 'era:insertByPath',\n  UPDATE_BY_PATH: 'era:updateByPath',\n  DELETE_BY_OBJECT: 'era:deleteByObject',\n  DELETE_BY_PATH: 'era:deleteByPath',\n  /** 获取当前最新的变量状态 */\n  GET_CURRENT_VARS: 'era:getCurrentVars',\n  /** 获取指定 MK 的历史变量快照 */\n  GET_SNAPSHOT_AT_MK: 'era:getSnapshotAtMk',\n  /** 获取两个 MK 之间的所有历史变量快照 */\n  GET_SNAPSHOTS_BETWEEN_MKS: 'era:getSnapshotsBetweenMks',\n  /** 获取指定 message_id 的历史变量快照 */\n  GET_SNAPSHOT_AT_MID: 'era:getSnapshotAtMId',\n  /** 获取两个 message_id 之间的所有历史变量快照 */\n  GET_SNAPSHOTS_BETWEEN_MIDS: 'era:getSnapshotsBetweenMIds',\n  /** 请求 ERA 重新广播最新的 `writeDone` 事件 */\n  REQUEST_WRITE_DONE: 'era:requestWriteDone',\n} as const;\n\n/**\n * @constant {object} ERA_EVENT_EMITTER\n * @description 定义了所有由 ERA 框架**向外发出**的事件。\n */\nexport const ERA_EVENT_EMITTER = {\n  /** 当变量写入完成时触发 */\n  WRITE_DONE: 'era:writeDone',\n  /** 当API执行写入时触发 */\n  API_WRITE: 'era:apiWrite',\n  /** 当变量查询准备好时触发，用于响应 GET_... 系列 API 事件 */\n  VARS_QUERY_RESULT: 'era:queryResult',\n} as const;\n\n/**\n * `era:writeDone` 事件的负载对象结构。它提供了关于一次成功写入操作的完整上下文。\n */\nexport interface WriteDonePayload {\n  /**\n   * 本轮事件处理循环中，最后操作的消息的**消息密钥 (Message Key)**。\n   * 通常由 `ensureMkForLatestMessage` 在循环开始时确定。\n   */\n  mk: string;\n  /**\n   * 本轮事件处理循环中，最后操作的消息的**消息 ID**。\n   */\n  message_id: number;\n  /**\n   * 描述在本轮事件处理中，执行了哪些核心操作。\n   * 这对于外部脚本理解状态变更的原因至关重要。\n   */\n  actions: {\n    /** 是否执行了 `rollbackByMk` 操作 */\n    rollback: boolean;\n    /** 是否执行了 `ApplyVarChange` 操作 */\n    apply: boolean;\n    /** 是否执行了 `resyncStateOnHistoryChange` 操作 */\n    resync: boolean;\n    /** 是否执行了 API 调用 */\n    api: boolean;\n    /** 是否是由API调用触发的后续逻辑 */\n    apiWrite: boolean;\n  };\n  /**\n   * 事件处理完成**之后**，整个聊天会话的**已选择消息密钥链 (Selected Message Keys)** 的最新状态。\n   * 这是一个稀疏数组，其索引约等于消息 ID，值是对应楼层消息的 MK。\n   * 它代表了当前聊天记录的“主干”，是 ERA 判断同步状态的核心数据结构。\n   */\n  selectedMks: (string | null)[];\n  /**\n   * 事件处理完成**之后**，`chat` 变量中存储的**完整的编辑日志对象 (EditLogs)**。\n   * 这是一个以 MK 为键，以变更记录数组为值的对象。\n   */\n  editLogs: { [key: string]: any[] };\n  /**\n   * 事件处理完成**之后**，整个聊天会话的**状态数据 (`stat_data`)** 的最新状态。\n   * 这个版本**包含**所有内部使用的 `$meta` 字段。\n   */\n  stat: any;\n  /**\n   * 事件处理完成**之后**，一个**不包含**任何 `$meta` 字段的 `stat_data` 的深拷贝版本。\n   * 适用于需要纯净数据进行展示或进一步处理的场景。\n   */\n  statWithoutMeta: any;\n  /**\n   * 表示这是对当前 `mk` 的第几次连续处理。\n   * 如果一个新的 `mk` 被处理，这个计数会重置为 1。\n   * 这对于需要感知状态是否在同一消息上连续更新的外部脚本很有用。\n   */\n  consecutiveProcessingCount: number;\n}\n\n/**\n * `era:queryResult` 事件中，单个查询结果的结构。\n */\nexport interface QueryResultItem {\n  mk: string;\n  message_id: number;\n  is_user: boolean;\n  stat: any;\n  statWithoutMeta: any;\n}\n\n/**\n * `era:queryResult` 事件的负载对象结构。\n */\nexport interface QueryResultPayload {\n  /** 原始查询的类型 */\n  queryType:\n    | 'getCurrentVars'\n    | 'getSnapshotAtMk'\n    | 'getSnapshotsBetweenMks'\n    | 'getSnapshotAtMId'\n    | 'getSnapshotsBetweenMIds';\n  /** 原始查询的 detail 对象 */\n  request: any;\n  /** 查询的结果。根据 queryType，可以是单个结果或结果数组。 */\n  result: QueryResultItem | QueryResultItem[];\n  /**\n   * 查询执行时，整个聊天会话的**已选择消息密钥链 (Selected Message Keys)** 的最新状态。\n   */\n  selectedMks: (string | null)[];\n  /**\n   * 查询执行时，`chat` 变量中存储的**完整的编辑日志对象 (EditLogs)**。\n   */\n  editLogs: { [key: string]: any[] };\n}\n","/**\n * @file ERA 变量框架 - 日志记录模块 (V3 - 规则分离版)\n */\n\n'use strict';\n\n// --- 新的运行时调试配置系统 (V3) ---\n\n/**\n * @constant {string} DEBUG_CONFIG_LS_KEY\n * @description 用于在 localStorage 中存储调试配置的键名。\n */\nconst DEBUG_CONFIG_LS_KEY = 'era_debug_config';\n\nlet enabledPatterns: RegExp[] = [];\nlet disabledPatterns: RegExp[] = [];\n\n/**\n * @typedef {object} DebugConfig\n * @property {string[]} enabled - 启用的模式列表。\n * @property {string[]} disabled - 禁用的模式列表。\n */\n\n/**\n * 从 localStorage 加载并解析调试配置。\n */\nfunction loadDebugConfig() {\n  try {\n    const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{\"enabled\":[],\"disabled\":[]}';\n    /** @type {DebugConfig} */\n    const config = JSON.parse(configStr);\n\n    const toRegex = (p: string) => new RegExp(`^${p.replace(/\\*/g, '.*?')}$`);\n    enabledPatterns = (config.enabled || []).map(toRegex);\n    disabledPatterns = (config.disabled || []).map(toRegex);\n  } catch (e) {\n    console.error('《ERA-Log》: 加载调试配置失败。', e);\n    enabledPatterns = [];\n    disabledPatterns = [];\n  }\n}\n\n/**\n * 检查给定的模块名是否应该输出 debug 日志。\n * @param {string} moduleName - 要检查的模块名。\n * @returns {boolean} - 如果允许输出则返回 true。\n */\nfunction isDebugEnabled(moduleName: string): boolean {\n  if (!moduleName) return false;\n\n  // 规则 1: 如果匹配任何一个“禁用”模式，则绝对禁用。\n  if (disabledPatterns.some(re => re.test(moduleName))) {\n    return false;\n  }\n\n  // 规则 2: 如果“启用”列表为空，则全部禁用。\n  if (enabledPatterns.length === 0) {\n    return false;\n  }\n\n  // 规则 3: 如果匹配任何一个“启用”模式，则启用。\n  if (enabledPatterns.some(re => re.test(moduleName))) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * 更新并保存调试配置。\n * @param {{ enabled: string[], disabled: string[] }} newConfig\n */\nfunction updateConfig(newConfig: { enabled: string[]; disabled: string[] }) {\n  const uniqueConfig = {\n    enabled: [...new Set(newConfig.enabled)],\n    disabled: [...new Set(newConfig.disabled)],\n  };\n  globalThis.localStorage?.setItem(DEBUG_CONFIG_LS_KEY, JSON.stringify(uniqueConfig));\n  loadDebugConfig();\n  console.log(`%c《ERA-Log》调试模式已更新。`, 'color: #3498db; font-weight: bold;', {\n    '启用 (Enabled)': uniqueConfig.enabled,\n    '禁用 (Disabled)': uniqueConfig.disabled,\n  });\n}\n\n// 初始化配置\nloadDebugConfig();\n\n// 将控制对象暴露到全局\nif (typeof globalThis !== 'undefined') {\n  const eraDebug = {\n    /**\n     * 将一个模式添加到“启用列表”，使其匹配的模块显示日志。\n     * 这也会从“禁用列表”中移除该模式。\n     * @param {string} pattern - 要启用的模式，支持 * 通配符。\n     * @example\n     * // 开启所有 core 开头的模块\n     * eraDebug.add('core*')\n     */\n    add(pattern: string) {\n      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{\"enabled\":[],\"disabled\":[]}';\n      const config: { enabled: string[]; disabled: string[] } = JSON.parse(configStr);\n      const enabled = new Set(config.enabled || []);\n      const disabled = new Set(config.disabled || []);\n\n      enabled.add(pattern);\n      disabled.delete(pattern);\n\n      updateConfig({ enabled: Array.from(enabled), disabled: Array.from(disabled) });\n    },\n\n    /**\n     * 将一个模式添加到“禁用列表”，使其匹配的模块不显示日志。\n     * 这也会从“启用列表”中移除该模式。\n     * @param {string} pattern - 要禁用的模式，支持 * 通配符。\n     * @example\n     * // 禁用 core-key 模块\n     * eraDebug.remove('core-key')\n     */\n    remove(pattern: string) {\n      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{\"enabled\":[],\"disabled\":[]}';\n      const config: { enabled: string[]; disabled: string[] } = JSON.parse(configStr);\n      const enabled = new Set(config.enabled || []);\n      const disabled = new Set(config.disabled || []);\n\n      disabled.add(pattern);\n      enabled.delete(pattern);\n\n      updateConfig({ enabled: Array.from(enabled), disabled: Array.from(disabled) });\n    },\n\n    /**\n     * 查看当前的调试配置。\n     */\n    status() {\n      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{\"enabled\":[],\"disabled\":[]}';\n      const config = JSON.parse(configStr);\n      console.log(`%c《ERA-Log》当前调试配置:`, 'color: #3498db; font-weight: bold;', config);\n    },\n\n    /**\n     * 清空所有调试规则。\n     */\n    clear() {\n      updateConfig({ enabled: [], disabled: [] });\n    },\n  };\n\n  (globalThis as any).eraDebug = eraDebug;\n}\n\n// --- Logger 类 ---\n\n/**\n * @class Logger\n * @description 一个为 ERA 框架设计的、支持动态配置的日志记录器。\n *\n * **核心功能**:\n * 1. **动态调试**: 可通过浏览器控制台 `eraDebug('...')` 命令在运行时开启/关闭指定模块的 `debug` 日志。\n * 2. **统一格式**: 所有日志都遵循 `《ERA》「模块名」【函数名】日志内容` 的格式。\n * 3. **自动模块名**: 自动从调用栈解析模块名，推荐在每个文件中创建独立的 logger 实例以保证准确性。\n *    例如: `const logger = new Logger();`\n */\nexport const logContext = {\n  mk: '',\n};\n\nexport class Logger {\n  private moduleName: string;\n\n  /**\n   * 创建一个新的 Logger 实例。\n   * @param moduleName - 【请勿手动填写】此参数由 Webpack 构建过程自动注入，用于标识当前模块。\n   */\n  constructor(moduleName?: string) {\n    // 优先使用由 Webpack 注入的模块名，如果不存在，则回退到旧的堆栈解析方法（仅用于非打包环境）\n    this.moduleName = moduleName || this._getModuleNameFromStack() || 'unknown';\n  }\n\n  private _getModuleNameFromStack(): string | null {\n    try {\n      const stack = new Error().stack || '';\n      // 智能寻找调用者：遍历堆栈，找到第一个不属于 log.ts 的、包含项目路径的行\n      const callerLine = stack\n        .split('\\n')\n        .find(\n          line =>\n            (line.includes(`/src/ERA变量框架/`) ||\n              line.includes(`/dist/ERA变量框架/`) ||\n              line.includes(`\\\\src\\\\ERA变量框架\\\\`) ||\n              line.includes(`\\\\dist\\\\ERA变量框架\\\\`)) &&\n            !line.includes('/utils/log.ts'),\n        );\n\n      if (!callerLine) {\n        return null;\n      }\n\n      // 更鲁棒的正则，用于从不同格式的堆栈行中提取路径\n      const match = callerLine.match(new RegExp(`(src|dist)[\\\\\\\\/]ERA变量框架[\\\\\\\\/]([^?:]+)`));\n\n      if (!match || !match[2]) {\n        return null;\n      }\n\n      const path = match[2];\n\n      // 移除文件扩展名和 /index 后缀，并统一路径分隔符\n      return path\n        .replace(/\\\\/g, '/')\n        .replace(/\\.(vue|ts|js)$/, '')\n        .replace(/\\/index$/, '');\n    } catch (e) {\n      console.error('《ERA-Log-Debug》: 解析模块名时发生意外错误。', e);\n      return null;\n    }\n  }\n\n  private formatMessage(funcName: string, message: any): string {\n    const mkString = logContext.mk ? `（${logContext.mk}）` : '';\n    return `《ERA》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;\n  }\n\n  debug(funcName: string, message: any, obj?: any) {\n    if (!isDebugEnabled(this.moduleName)) {\n      return;\n    }\n\n    const formattedMessage = this.formatMessage(funcName, message);\n    if (obj !== undefined) {\n      console.debug(formattedMessage, obj);\n    } else {\n      console.debug(formattedMessage);\n    }\n  }\n\n  log(funcName: string, message: any, obj?: any) {\n    const formattedMessage = this.formatMessage(funcName, message);\n    if (obj !== undefined) {\n      console.log(`%c${formattedMessage}`, 'color: #3498db;', obj);\n    } else {\n      console.log(`%c${formattedMessage}`, 'color: #3498db;');\n    }\n  }\n\n  warn(funcName: string, message: any, obj?: any) {\n    const formattedMessage = this.formatMessage(funcName, message);\n    if (obj !== undefined) {\n      console.warn(`%c${formattedMessage}`, 'color: #f39c12;', obj);\n    } else {\n      console.warn(`%c${formattedMessage}`, 'color: #f39c12;');\n    }\n  }\n\n  error(funcName: string, message: any, errorObj?: any) {\n    const formattedMessage = this.formatMessage(funcName, message);\n    if (errorObj !== undefined) {\n      console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;', errorObj);\n    } else {\n      console.error(`%c${formattedMessage}`, 'color: #e74c3c; font-weight: bold;');\n    }\n  }\n}\n","'use strict';\n\nimport { ERA_API_EVENTS, ERA_EVENT_EMITTER } from '../utils/constants';\nimport { Logger } from '../utils/log';\n\nconst logger = new Logger();\n\n/**\n * @description 定义需要监听的事件的分组\n */\nexport const EVENT_GROUPS = {\n  INIT: [tavern_events.APP_READY],\n  SYNC: [\n    'manual_write',\n    ERA_EVENT_EMITTER.API_WRITE,\n    tavern_events.MESSAGE_RECEIVED,\n    tavern_events.MESSAGE_DELETED,\n    tavern_events.MESSAGE_SWIPED,\n    tavern_events.CHAT_CHANGED,\n    'manual_sync',\n    'manual_full_sync',\n    /** 由 message_updated 和 generation_started 组合而成的同步事件 */\n    'combo_sync',\n  ],\n  API: Object.values(ERA_API_EVENTS),\n  /** 仅更新MK的事件 */\n  UPDATE_MK_ONLY: [tavern_events.MESSAGE_SENT],\n  /** 仅用于对冲检测的事件，本身不触发逻辑 */\n  COLLISION_DETECTORS: [tavern_events.GENERATION_STARTED],\n  /** 用于组合事件的起始事件 */\n  COMBO_STARTERS: [tavern_events.MESSAGE_UPDATED],\n};\n\n/**\n * @constant {Map<string, string>} EVENT_COLLISION_MAP\n * @description\n * 定义了事件对冲规则。\n * 如果在事件队列的同一次批处理中，同时出现了 key 事件和 value 事件，\n * 则这两个事件都将被忽略。\n *\n * @example\n * // 当用户快速左滑然后点击生成时，会依次触发 `MESSAGE_SWIPED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并同时忽略这两个事件，避免不必要的同步。\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 500 }]\n * ])\n */\nexport const EVENT_COLLISION_MAP = new Map<string, { next: string; maxInterval: number }>([\n  [tavern_events.MESSAGE_SWIPED, { next: tavern_events.GENERATION_STARTED, maxInterval: 600 }],\n]);\n\n/**\n * @constant {Map<string, { next: string; resultType: string; maxInterval: number }>} EVENT_COMBO_MAP\n * @description\n * 定义了事件组合规则。\n * 如果在事件队列的同一次批处理中，一个 key 事件紧跟着一个 `next` 事件，\n * 它们将被合并成一个新的 `resultType` 事件。\n *\n * @example\n * // 当用户消息被AI编辑后立刻开始生成下一条消息时，会依次触发 `MESSAGE_UPDATED` 和 `GENERATION_STARTED`。\n * // 这条规则会捕获这种模式并将它们合并为一个 `combo_sync` 事件，以确保数据一致性。\n * new Map([\n *   [tavern_events.MESSAGE_UPDATED, { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 2100 }]\n * ])\n */\nexport const EVENT_COMBO_MAP = new Map<string, { next: string; resultType: string; maxInterval: number }>([\n  [\n    tavern_events.MESSAGE_UPDATED,\n    { next: tavern_events.GENERATION_STARTED, resultType: 'combo_sync', maxInterval: 1600 },\n  ],\n]);\n\n/**\n * @constant {Map<string, number>} EVENT_DEBOUNCE_MAP\n * @description\n * 为特定事件定义自定义的防抖时间（毫秒）。\n * 在事件队列处理器中，如果一个事件在此映射中定义了时间，\n * 将使用该时间代替默认的防抖时间。\n * 这对于那些需要更长窗口来捕获后续事件的“前置事件”特别有用。\n *\n * @example\n * // 为 MESSAGE_SWIPED 设置更长的等待时间，以确保能捕获到后续的 GENERATION_STARTED\n * new Map([\n *   [tavern_events.MESSAGE_SWIPED, 500]\n * ])\n */\nexport const EVENT_DEBOUNCE_MAP = new Map<string, number>([\n  [tavern_events.MESSAGE_SWIPED, 500], // 对冲事件的前置事件\n  [tavern_events.MESSAGE_UPDATED, 1500], // 组合事件的前置事件\n]);\n\n/**\n * @interface EventJob\n * @description 定义了事件队列中每个任务对象的结构。\n */\nexport interface EventJob {\n  type: string;\n  detail?: any;\n  timestamp: number;\n}\n\n/**\n * 根据事件类型，查找它属于哪个预定义的组。\n * @param {string} eventType - 要检查的事件类型。\n * @returns {string} 事件所属的组名 ('INIT', 'SYNC', 'API', 'UPDATE_MK_ONLY', 'UNKNOWN')。\n */\nexport function getEventGroup(eventType: string): string {\n  // 使用 as string[] 来解决 TypeScript 因 'as const' 推断出的过于严格的类型问题\n  if ((EVENT_GROUPS.INIT as string[]).includes(eventType)) return 'INIT';\n  if ((EVENT_GROUPS.SYNC as string[]).includes(eventType)) return 'SYNC';\n  if ((EVENT_GROUPS.API as string[]).includes(eventType)) return 'API';\n  if ((EVENT_GROUPS.UPDATE_MK_ONLY as string[]).includes(eventType)) return 'UPDATE_MK_ONLY';\n  if ((EVENT_GROUPS.COLLISION_DETECTORS as string[]).includes(eventType)) return 'COLLISION_DETECTORS';\n  if ((EVENT_GROUPS.COMBO_STARTERS as string[]).includes(eventType)) return 'COMBO_STARTERS';\n  return 'UNKNOWN';\n}\n\n/**\n * **【事件合并器】**\n * 对一批事件进行智能合并，包括处理事件对冲和合并同组可覆盖事件。\n * @param {EventJob[]} batchToProcess - 从队列中取出的一批原始事件。\n * @returns {EventJob[]} - 经过合并优化后的事件数组。\n */\nexport function mergeEventBatch(batchToProcess: EventJob[]): EventJob[] {\n  const originalEvents = _.cloneDeep(batchToProcess);\n  const finalJobs: EventJob[] = [];\n\n  // 使用 for...of 循环，让逻辑更清晰\n  for (const currentJob of batchToProcess) {\n    // 如果是第一个事件，直接放入结果中\n    if (finalJobs.length === 0) {\n      finalJobs.push(currentJob);\n      continue; // 继续处理下一个事件\n    }\n\n    const prevJob = finalJobs[finalJobs.length - 1];\n    const timeDifference = currentJob.timestamp - prevJob.timestamp;\n\n    // 1. 检查事件组合\n    const comboRule = EVENT_COMBO_MAP.get(prevJob.type);\n    if (comboRule && currentJob.type === comboRule.next) {\n      if (timeDifference <= comboRule.maxInterval) {\n        logger.debug(\n          'mergeEventBatch',\n          `检测到事件组合: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${comboRule.maxInterval}ms)。将合并为 ${comboRule.resultType} 事件。`,\n        );\n        finalJobs.pop(); // 移除前一个事件\n        finalJobs.push({ type: comboRule.resultType, timestamp: currentJob.timestamp, detail: currentJob.detail });\n        continue;\n      } else {\n        logger.debug(\n          'mergeEventBatch',\n          `检测到潜在的事件组合，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${comboRule.maxInterval}ms)。`,\n        );\n      }\n    }\n\n    // 2. 检查事件对冲\n    const collisionRule = EVENT_COLLISION_MAP.get(prevJob.type);\n    if (collisionRule && currentJob.type === collisionRule.next) {\n      if (timeDifference <= collisionRule.maxInterval) {\n        logger.debug(\n          'mergeEventBatch',\n          `检测到相邻事件对冲: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms <= ${collisionRule.maxInterval}ms)。将忽略这两个事件。`,\n        );\n        finalJobs.pop(); // 移除前一个事件\n        continue; // 跳过当前事件，从而忽略两者\n      } else {\n        logger.debug(\n          'mergeEventBatch',\n          `检测到潜在的事件对冲，但因超时而失败: ${prevJob.type} 和 ${currentJob.type} (时间差: ${timeDifference}ms > ${collisionRule.maxInterval}ms)。`,\n        );\n      }\n    }\n\n    // 3. 如果不冲突或组合，则检查同组事件合并\n    const prevGroup = getEventGroup(prevJob.type);\n    const currentGroup = getEventGroup(currentJob.type);\n\n    // 定义合并条件，让 if 判断的意图更清晰\n    const areInSameGroup = prevGroup === currentGroup;\n    const isMergeableGroup = prevGroup === 'SYNC';\n\n    // 如果满足合并条件\n    if (areInSameGroup && isMergeableGroup) {\n      // 用当前事件覆盖掉结果数组中的最后一个事件\n      finalJobs[finalJobs.length - 1] = currentJob;\n    } else {\n      // 否则，将当前事件追加到结果数组\n      finalJobs.push(currentJob);\n    }\n  }\n  // 最后，清理掉所有未配对的检测器和组合起始事件\n  const filteredJobs = finalJobs.filter(job => {\n    const group = getEventGroup(job.type);\n    const isOrphanedDetector = group === 'COLLISION_DETECTORS';\n    const isOrphanedComboStarter = group === 'COMBO_STARTERS';\n    if (isOrphanedDetector || isOrphanedComboStarter) {\n      logger.debug('mergeEventBatch', `清理未配对的事件: ${job.type}`);\n    }\n    return !isOrphanedDetector && !isOrphanedComboStarter;\n  });\n\n  // 打印合并日志\n  logger.debug('mergeEventBatch', `事件合并: ${originalEvents.length} -> ${filteredJobs.length}`, {\n    before: originalEvents.map((e: EventJob) => e.type),\n    after: filteredJobs.map((e: EventJob) => e.type),\n  });\n\n  return filteredJobs;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = _;","/**\n * @file ERA 变量框架 - ERA 核心变量读写模块\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport { CHAT_SCOPE, META_DATA_PATH, STAT_DATA_PATH, SettingsSchema } from './constants';\n\ndeclare function getScriptId(): string;\n\n/**\n * 递归地从对象中移除所有以 `$` 开头的字段（如 `$meta`, `$template`）。\n * 此函数会创建一个对象的深拷贝，因此不会修改原始对象。\n * @param {any} obj - 待处理的对象或值。\n * @returns {any} 一个不包含 `$` 前缀字段的新对象或原始值。\n */\nexport function removeMetaFields(obj: any): any {\n  // 对于非对象类型，直接返回原始值\n  if (!_.isObject(obj)) {\n    return obj;\n  }\n\n  // 创建深拷贝以避免修改原始对象\n  const newObj = _.cloneDeep(obj);\n\n  function recurse(current: any) {\n    if (Array.isArray(current)) {\n      // 如果是数组，则递归处理数组中的每个元素\n      current.forEach(item => recurse(item));\n    } else if (_.isPlainObject(current)) {\n      // 如果是纯粹的对象，遍历其所有键\n      for (const key in current) {\n        // 如果键以 '$' 开头，则删除该属性\n        if (key.startsWith('$')) {\n          delete current[key];\n        } else {\n          // 否则，递归处理该属性的值\n          recurse(current[key]);\n        }\n      }\n    }\n  }\n\n  recurse(newObj);\n  return newObj;\n}\n\n/**\n * 获取并确保 ERA 的元数据和状态数据对象的存在。\n * @returns {{meta: object, stat: object}} 包含元数据和状态数据的对象。\n */\nexport function getEraData(): { meta: any; stat: any } {\n  const chatVars = getVariables(CHAT_SCOPE) || {};\n  const meta = _.get(chatVars, META_DATA_PATH, {});\n  const stat = _.get(chatVars, STAT_DATA_PATH, {});\n  return { meta, stat };\n}\n\n/**\n * 原子性地更新 ERA 的状态数据 (stat_data)。\n * @param {(currentStatData: any) => (any | Promise<any>)} updater - 一个接收当前 stat_data 并返回修改后 stat_data 的函数 (可以是 async)。\n */\nexport async function updateEraStatData(updater: (currentStatData: any) => any | Promise<any>) {\n  await updateVariablesWith(async v => {\n    const currentStat = _.get(v, STAT_DATA_PATH, {});\n    const newStat = await updater(currentStat);\n    _.set(v, STAT_DATA_PATH, newStat);\n    return v;\n  }, CHAT_SCOPE);\n}\n\n/**\n * 原子性地更新 ERA 的元数据 (ERAMetaData)。\n * @param {(currentMetaData: any) => (any | Promise<any>)} updater - 一个接收当前 ERAMetaData 并返回修改后 ERAMetaData 的函数 (可以是 async)。\n */\nexport async function updateEraMetaData(updater: (currentMetaData: any) => any | Promise<any>) {\n  await updateVariablesWith(async v => {\n    const currentMeta = _.get(v, META_DATA_PATH, {});\n    const newMeta = await updater(currentMeta);\n    _.set(v, META_DATA_PATH, newMeta);\n    return v;\n  }, CHAT_SCOPE);\n}\n\n/**\n * 获取并解析脚本设置\n * @returns {z.infer<typeof SettingsSchema>}\n */\nexport function getScriptSettings(): z.infer<typeof SettingsSchema> {\n  const rawSettings = getVariables({ type: 'script', script_id: getScriptId() });\n  return SettingsSchema.parse(rawSettings ?? {});\n}\n\n/**\n * 原子性地更新脚本设置\n * @param {(currentSettings: z.infer<typeof SettingsSchema>) => z.infer<typeof SettingsSchema>} updater\n * @returns {Promise<void>}\n */\nexport async function updateScriptSettings(\n  updater: (\n    currentSettings: z.infer<typeof SettingsSchema>,\n  ) => z.infer<typeof SettingsSchema> | Promise<z.infer<typeof SettingsSchema>>,\n): Promise<void> {\n  await updateVariablesWith(\n    async rawSettings => {\n      const currentSettings = SettingsSchema.parse(rawSettings ?? {});\n      const newSettings = await updater(currentSettings);\n      return newSettings;\n    },\n    { type: 'script', script_id: getScriptId() },\n  );\n}\n","/**\n * @file ERA 变量框架 - 通用数据处理模块\n */\n\n'use strict';\n\nimport { Logger } from './log';\n\nconst logger = new Logger();\n\nconst ESCAPE_MAP: { [key: string]: string } = {\n  '.': '__DOT__',\n  '\"': '__DQUOTE__',\n  \"'\": '__SQUOTE__',\n};\n\nconst UNESCAPE_MAP: { [key: string]: string } = _.invert(ESCAPE_MAP);\n\nconst escapeRegex = new RegExp(Object.keys(ESCAPE_MAP).map(_.escapeRegExp).join('|'), 'g');\nconst unescapeRegex = new RegExp(Object.values(ESCAPE_MAP).map(_.escapeRegExp).join('|'), 'g');\n\n/**\n * 递归地转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 转义后的数据。\n */\nexport function escapeEraData<T>(data: T): T {\n  if (Array.isArray(data)) {\n    return data.map(item => escapeEraData(item)) as any;\n  }\n  if (_.isPlainObject(data)) {\n    const newObj: { [key: string]: any } = {};\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        const escapedKey = key.replace(escapeRegex, match => ESCAPE_MAP[match]);\n        newObj[escapedKey] = escapeEraData((data as any)[key]);\n      }\n    }\n    return newObj as any;\n  }\n  if (typeof data === 'string') {\n    return data.replace(escapeRegex, match => ESCAPE_MAP[match]) as any;\n  }\n  return data;\n}\n\n/**\n * 递归地反转义对象或数组中所有字符串值和键的特殊字符。\n * @param data - 要处理的数据。\n * @returns - 反转义后的数据。\n */\nexport function unescapeEraData<T>(data: T): T {\n  if (Array.isArray(data)) {\n    return data.map(item => unescapeEraData(item)) as any;\n  }\n  if (_.isPlainObject(data)) {\n    const newObj: { [key: string]: any } = {};\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        const unescapedKey = key.replace(unescapeRegex, match => UNESCAPE_MAP[match]);\n        newObj[unescapedKey] = unescapeEraData((data as any)[key]);\n      }\n    }\n    return newObj as any;\n  }\n  if (typeof data === 'string') {\n    return data.replace(unescapeRegex, match => UNESCAPE_MAP[match]) as any;\n  }\n  return data;\n}\n\n/**\n * 判断一个值是否为“纯粹的对象”（Plain Object）。\n * 数组、null、函数、Date 对象等都会返回 false。\n * @param {*} v - 待检查的值。\n * @returns {boolean} 如果是纯粹的对象则返回 true，否则返回 false。\n */\nexport const isPO = (v: any): v is Record<string, any> => _.isPlainObject(v);\n\n/**\n * 递归地“净化”一个对象，将其中的数组或对象值转换为字符串。\n * 主要用于准备数据以便在某些特定场景下展示或存储。\n * @param {*} v - 待净化的值。\n * @returns {*} 净化后的值。\n */\nexport function sanitizeArrays(v: any): any {\n  if (Array.isArray(v)) {\n    // 如果是数组，则遍历其元素。如果元素是数组或对象，则字符串化它。\n    return v.map(e => (Array.isArray(e) || _.isPlainObject(e) ? JSON.stringify(e) : e));\n  } else if (_.isPlainObject(v)) {\n    // 如果是对象，则递归地对其每个属性值进行净化。\n    const o: { [key: string]: any } = {};\n    for (const k in v) o[k] = sanitizeArrays(v[k]);\n    return o;\n  } else {\n    // 其他类型的值直接返回。\n    return v;\n  }\n}\n\n/**\n * 安全地将一个对象序列化为格式化的 JSON 字符串。\n * 如果序列化失败，不会抛出异常，而是返回一个包含错误信息的字符串。\n * @param {*} o - 待序列化的对象。\n * @returns {string} 成功则返回 JSON 字符串，失败则返回错误提示。\n */\nexport const J = (o: any): string => {\n  try {\n    return JSON.stringify(o, null, 2); // 使用 2 个空格进行缩进，提高可读性。\n  } catch (e: any) {\n    return `<<stringify失败: ${e?.message || e}>>`;\n  }\n};\n\n/**\n * 使用“新数组覆盖旧数组”的策略来深度合并两个对象。\n * 这是 `_.merge` 的一个变体，专门用于处理模板合并等场景，\n * 在这些场景中，我们希望补丁对象中的数组能够完全替换基础对象中的数组，而不是合并它们。\n * @param {*} base - 基础对象。\n * @param {*} patch - 补丁对象。\n * @returns {*} 合并后的新对象。\n */\nexport function mergeReplaceArray(base: any, patch: any): any {\n  // 使用 _.cloneDeep 确保不修改原始对象。\n  return _.mergeWith(_.cloneDeep(base), _.cloneDeep(patch), (a: any, b: any) => {\n    // 自定义合并逻辑：如果任一值为数组，则直接返回补丁值（b），从而实现覆盖。\n    if (Array.isArray(a) || Array.isArray(b)) return b;\n    // 对于非数组类型，返回 undefined 以使用 _.merge 的默认合并行为。\n    return undefined;\n  });\n}\n\n/**\n * 健壮地解析 `EditLog` 的原始数据。\n * `EditLog` 可能以多种格式存在（对象、数组、JSON字符串），此函数旨在统一处理它们。\n * @param {*} raw - 从变量中读取的原始 `EditLog` 数据。\n * @returns {any[]} 解析后的 `EditLog` 数组。如果解析失败或输入无效，则返回一个空数组。\n */\nexport function parseEditLog(raw: any): any[] {\n  if (Array.isArray(raw)) return raw;\n  if (raw && typeof raw === 'object') return [raw]; // 单个对象也视为有效日志\n  if (typeof raw === 'string') {\n    const s = raw.replace(/^\\s*```(?:json)?\\s*|\\s*```\\s*$/g, ''); // 移除代码围栏\n    try {\n      const arr = JSON.parse(s);\n      return Array.isArray(arr) ? arr : [];\n    } catch {\n      return [];\n    }\n  }\n  return [];\n}\n\n/**\n * 智能地从字符串中移除各种风格的注释，同时保留字符串字面量中的内容。\n *\n * **工作原理**:\n * 该函数通过一个小型状态机来逐字解析输入字符串。它维护一个 `inString` 状态，\n * 用于判断当前字符是否位于一个双引号包裹的字符串内部。\n *\n * 1. 当检测到进入或退出一个字符串时（通过非转义的双引号 `\"`），`inString` 状态会翻转。\n * 2. 如果 `inString` 为 `true`，则所有字符都会被无条件地保留。这确保了字符串值（如 URL）中的 `//` 或 `/*` 不会被当作注释处理。\n * 3. 如果 `inString` 为 `false`，函数会检查是否存在注释标记（`//`, `/*`, `<!--`）。\n * 4. 如果找到注释标记，函数会向前扫描直到注释结束，并跳过这部分内容。\n * 5. 如果没有找到注释，则将当前字符追加到结果中。\n *\n * @param str - 待处理的字符串。\n * @returns 移除了注释的字符串。\n */\nfunction stripComments(str: string): string {\n  if (!str) return '';\n\n  let result = '';\n  let inString = false; // 状态：是否在字符串内部\n\n  for (let i = 0; i < str.length; i++) {\n    const char = str[i];\n\n    // 检查是否进入或退出字符串。忽略转义的双引号 `\\\"`。\n    if (char === '\"' && (i === 0 || str[i - 1] !== '\\\\')) {\n      inString = !inString;\n    }\n\n    // 如果在字符串内部，直接追加字符，不进行任何注释检查。\n    if (inString) {\n      result += char;\n      continue;\n    }\n\n    // --- 只有在字符串外部时，才进行注释检查 ---\n    const nextChar = str[i + 1];\n\n    // 检查行注释 `//`\n    if (char === '/' && nextChar === '/') {\n      const endOfLine = str.indexOf('\\n', i + 2);\n      if (endOfLine === -1) {\n        // 如果没有换行符，说明注释直到字符串末尾，直接结束循环。\n        break;\n      }\n      // 保留换行符，并将索引 `i` 快进到行尾。\n      result += '\\n';\n      i = endOfLine;\n      continue;\n    }\n\n    // 检查块注释 `/* ... */`\n    if (char === '/' && nextChar === '*') {\n      const endOfComment = str.indexOf('*/', i + 2);\n      if (endOfComment === -1) {\n        // 未闭合的注释，忽略剩余所有内容。\n        break;\n      }\n      // 将索引 `i` 快进到注释结尾。\n      i = endOfComment + 1;\n      continue;\n    }\n\n    // 检查 HTML 注释 `<!-- ... -->`\n    if (char === '<' && str.substring(i, i + 4) === '<!--') {\n      const endOfComment = str.indexOf('-->', i + 4);\n      if (endOfComment === -1) {\n        // 未闭合的注释。\n        break;\n      }\n      i = endOfComment + 2;\n      continue;\n    }\n\n    // 如果不是注释，则保留该字符。\n    result += char;\n  }\n  return result;\n}\n\n/**\n * 解析一个包含多个串联 JSON 对象的字符串（类似于 JSONL 格式）。\n * 这种格式有时会由 AI 生成。此函数能够逐个提取并解析它们。\n *\n * @param {string} str - 待解析的字符串。\n * @returns {any[]} 解析出的对象数组。\n */\nexport function parseJsonl(str: string): any[] {\n  const objects: any[] = [];\n  if (!str || typeof str !== 'string') {\n    return objects;\n  }\n\n  // 在解析 JSON 之前，必须先安全地移除所有注释。\n  // 不能使用简单的正则表达式（如 `/\\/\\/.*/g`），因为它无法区分代码中的注释和字符串值（如 URL \"https://...\"）中的 `//`，\n  // 会错误地破坏 JSON 字符串的结构。`stripComments` 函数通过状态管理解决了这个问题。\n  const strWithoutComments = stripComments(str);\n  const trimmedStr = strWithoutComments.trim();\n\n  let braceCount = 0; // 花括号平衡计数器\n  let startIndex = -1; // 当前 JSON 对象的起始索引\n  let inString = false; // 标记是否处于双引号字符串内部\n\n  for (let i = 0; i < trimmedStr.length; i++) {\n    const char = trimmedStr[i];\n\n    // 切换 inString 状态，忽略转义的双引号\n    if (char === '\"' && (i === 0 || trimmedStr[i - 1] !== '\\\\')) {\n      inString = !inString;\n    }\n\n    // 如果在字符串内部，则跳过所有花括号的逻辑判断\n    if (inString) continue;\n\n    if (char === '{') {\n      if (braceCount === 0) {\n        // 发现一个新 JSON 对象的开始\n        startIndex = i;\n      }\n      braceCount++;\n    } else if (char === '}') {\n      if (braceCount > 0) {\n        braceCount--;\n        if (braceCount === 0 && startIndex !== -1) {\n          // 花括号平衡，一个完整的 JSON 对象被找到\n          const jsonString = trimmedStr.substring(startIndex, i + 1);\n          try {\n            const obj = JSON.parse(jsonString);\n            objects.push(obj);\n          } catch (e: any) {\n            // 如果解析失败，记录错误并继续，不中断整个过程\n            logger.error(`JSONL 解析失败: ${e?.message || e}. 失败的片段: ${jsonString}`, e);\n          }\n          // 重置状态，准备寻找下一个对象\n          startIndex = -1;\n        }\n      }\n    }\n  }\n  return objects;\n}\n","/**\n * @file ERA 变量框架 - 字符串处理模块\n */\n\n'use strict';\n\nimport { Converter } from 'opencc-js';\n\n/**\n * 生成一个指定长度的随机字符串，用作唯一标识符。\n * @returns {string} 一个随机的、由数字和小写字母组成的字符串。\n */\nexport function rnd(): string {\n  return Math.random().toString(36).slice(2, 8);\n}\n\n/**\n * 从字符串中移除 AI 生成的 Markdown 代码块围栏（如 ```json ... ```）。\n * @param {string} s - 待处理的字符串。\n * @returns {string} 移除围栏并修剪首尾空格后的字符串。\n */\nexport function stripCodeFence(s: string): string {\n  if (!s) return s;\n  let t = String(s).trim();\n  t = t.replace(/^\\s*(?:```|~~~)\\[a-zA-Z0-9_-\\]*\\s*\\r?\\n/, '');\n  t = t.replace(/\\r?\\n(?:```|~~~)\\s*$/, '');\n  return t.trim();\n}\n\nexport type TagMatchMode = 'exact' | 'prefix' | 'suffix' | 'contains' | 'any';\n\n/**\n * 辅助函数：根据关键字和模式创建用于匹配标签名的正则表达式。\n * @param {string} [keyword=''] - 标签关键字。\n * @param {TagMatchMode} [mode='exact'] - 匹配模式。\n * @returns {RegExp} 生成的正则表达式。\n */\nexport function createTagRegex(keyword: string = '', mode: TagMatchMode = 'exact'): RegExp {\n  if (mode === 'any' || keyword === '*') {\n    return /([a-zA-Z][a-zA-Z0-9_]*)/;\n  }\n  // 对 keyword 进行转义，防止特殊字符影响正则\n  const escapedKeyword = keyword.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n  switch (mode) {\n    case 'exact':\n      return new RegExp(`(${escapedKeyword})`);\n    case 'prefix':\n      return new RegExp(`(${escapedKeyword}[a-zA-Z0-9_]*)`);\n    case 'suffix':\n      return new RegExp(`([a-zA-Z0-9_]*${escapedKeyword})`);\n    case 'contains':\n    default:\n      return new RegExp(`([a-zA-Z0-9_]*${escapedKeyword}[a-zA-Z0-9_]*)`);\n  }\n}\n\n/**\n * 核心函数：从文本尾部开始，使用正则表达式反向查找第一个完整闭合的标签。\n * @param {string} text - 原始文本。\n * @param {RegExp} tagNameRegex - 用于匹配标签名的正则表达式，必须包含一个捕获组。\n * @param {number} [endIndex=text.length] - 开始搜索的位置。\n * @returns {{startIndex: number, endIndex: number, content: string, tagName: string} | null} 包含起止索引、内容和完整标签名的对象，或 null。\n */\nfunction findTagFromEndByRegex(\n  text: string,\n  tagNameRegex: RegExp,\n  endIndex: number = text.length,\n): { startIndex: number; endIndex: number; content: string; tagName: string } | null {\n  const closeTagRegex = new RegExp(`</${tagNameRegex.source}>`, 'g');\n  let lastMatch = null;\n  let currentMatch;\n\n  // 1. 找到最后一个在 endIndex 之前的闭合标签\n  while ((currentMatch = closeTagRegex.exec(text)) !== null) {\n    if (currentMatch.index < endIndex) {\n      lastMatch = currentMatch;\n    } else {\n      break;\n    }\n  }\n\n  if (!lastMatch) {\n    return null;\n  }\n\n  const tagName = lastMatch[1];\n  const closeIndex = lastMatch.index;\n\n  // 2. 用找到的完整标签名，反向查找对应的开标签\n  const openTag = `<${tagName}>`;\n  const openIndex = text.lastIndexOf(openTag, closeIndex);\n\n  if (openIndex === -1) {\n    // 如果找不到匹配的开标签，则从这个闭合标签前继续递归搜索\n    return findTagFromEndByRegex(text, tagNameRegex, closeIndex);\n  }\n\n  return {\n    startIndex: openIndex,\n    endIndex: closeIndex + `</${tagName}>`.length,\n    content: text.substring(openIndex + openTag.length, closeIndex),\n    tagName: tagName,\n  };\n}\n\n/**\n * 从文本中移除指定的 XML 标签及其内容，支持正则匹配。\n * @param {string} text - 原始文本。\n * @param {RegExp} tagNameRegex - 用于匹配要移除的标签名的正则表达式。\n * @returns {string} 移除标签后的文本。\n */\nexport function removeTagsByRegex(text: string, tagNameRegex: RegExp): string {\n  let processedText = text;\n  while (true) {\n    const found = findTagFromEndByRegex(processedText, tagNameRegex);\n    if (!found) {\n      break;\n    }\n    processedText = processedText.slice(0, found.startIndex) + processedText.slice(found.endIndex);\n  }\n  return processedText;\n}\n\n/**\n * 检查字符串中是否包含 XML 风格的标签，支持正则匹配。\n * @param {string} text - 要检查的字符串。\n * @param {RegExp} [tagNameRegex] - 用于匹配标签名的正则表达式。如果未提供，则检查任何标签。\n * @returns {boolean} 如果包含则返回 true，否则返回 false。\n */\nexport function containsXMLTags(text: string, tagNameRegex?: RegExp): boolean {\n  const regex = tagNameRegex ? new RegExp(`</?${tagNameRegex.source}>`) : /<\\/?\\s*[a-zA-Z][a-zA-Z0-9_]*\\s*>/;\n  return regex.test(text);\n}\n\n/**\n * 从文本尾部开始，反向提取所有被特定 XML 风格标签包裹的、完整闭合的内容块，支持正则匹配。\n * @param {string} text - 包含标签的原始文本。\n * @param {RegExp} tagNameRegex - 用于匹配要提取的标签名的正则表达式。\n * @returns {string[]} 包含所有提取内容的数组，顺序与在文本中出现的顺序一致。\n */\nexport function extractBlocksByRegex(text: string, tagNameRegex: RegExp): string[] {\n  const blocks: string[] = [];\n  let searchIndex = text.length;\n\n  while (searchIndex > 0) {\n    const found = findTagFromEndByRegex(text, tagNameRegex, searchIndex);\n    if (!found) {\n      break;\n    }\n    blocks.unshift(found.content); // 保持原始顺序\n    searchIndex = found.startIndex;\n  }\n\n  return blocks;\n}\n\n/**\n * 从文本中安全地提取所有有效、闭合的特定标签内容块。\n * 这是推荐使用的主要提取函数。\n *\n * @param {string} text - 包含标签的原始文本。\n * @param {RegExp} targetTagNameRegex - 用于匹配目标标签名的正则表达式。\n * @param {boolean} [toSimplified=false] - 是否将提取的内容转换为简体中文。\n * @returns {string[]} 包含所有有效内容块的数组。\n */\nexport function extractValidBlocks(text: string, targetTagNameRegex: RegExp, toSimplified: boolean = false): string[] {\n  // 1. 预处理：移除所有包含 \"think\" 的标签块\n  const thinkRegex = createTagRegex('think', 'contains');\n  const processedText = removeTagsByRegex(text, thinkRegex);\n\n  // 2. 提取：从尾部开始查找目标 tag，确保标签闭合\n  const extracted = extractBlocksByRegex(processedText, targetTagNameRegex);\n\n  const validBlocks: string[] = [];\n  for (const block of extracted) {\n    // 3. 清理和校验\n    const cleanedBlock = stripCodeFence(block.trim());\n\n    // 校验：如果内部还包含任何XML标签，则丢弃\n    if (containsXMLTags(cleanedBlock)) {\n      continue;\n    }\n\n    if (cleanedBlock) {\n      if (toSimplified) {\n        const simplifiedBlock = traditionalToSimplified(cleanedBlock);\n        validBlocks.push(simplifiedBlock);\n      } else {\n        validBlocks.push(cleanedBlock);\n      }\n    }\n  }\n\n  return validBlocks;\n}\n\n/**\n * 将字符串中的繁体中文字符转换为简体中文。\n * @param {string} text - 待转换的字符串。\n * @returns {string} 转换后的简体中文字符串。\n */\nconst converter = Converter({ from: 'tw', to: 'cn' });\nexport function traditionalToSimplified(text: string): string {\n  return converter(text);\n}\n","/**\n * 解析字符串中的角色和用户宏, 并将其替换为对应的名称。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nexport function parseCharacterMacros(text: string): string {\n  // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n  if (!text.includes('{{')) {\n    return text;\n  }\n\n  let result = text;\n  // 使用全局不区分大小写的替换\n  result = result.replace(/{{user}}/gi, SillyTavern.name1);\n  result = result.replace(/{{char}}/gi, SillyTavern.name2);\n  return result;\n}\n\n/**\n * 深度遍历数据, 对所有字符串类型的值应用 parseCharacterMacros 宏替换。\n * @param data - 任何类型的数据。\n * @returns - 经过宏替换后的数据。\n */\nexport const deepParseCharacterMacros = (data: any): any => {\n  if (typeof data === 'string') {\n    return parseCharacterMacros(data);\n  }\n  if (Array.isArray(data)) {\n    return data.map(item => deepParseCharacterMacros(item));\n  }\n  if (typeof data === 'object' && data !== null) {\n    return Object.entries(data).reduce(\n      (acc, [key, value]) => {\n        acc[key] = deepParseCharacterMacros(value);\n        return acc;\n      },\n      {} as Record<string, any>,\n    );\n  }\n  return data;\n};\n","/**\n * @file ERA 变量框架 - 消息处理模块\n * @description\n * 该文件提供了一系列用于处理、查询和更新酒馆消息对象的通用辅助函数。\n */\n\n'use strict';\n\nimport { ERA_DATA_REGEX } from './constants';\nimport { escapeEraData, parseJsonl } from './data';\nimport { Logger } from './log';\nimport { createTagRegex, extractValidBlocks } from './string';\nimport { parseCharacterMacros } from './text';\n\nconst log = new Logger();\n\n/**\n * @type {EraData} - 定义了存储在 `<era_data>` 块中的元数据结构。\n */\ntype EraData = {\n  'era-message-key': string;\n  'era-message-type': 'user' | 'assistant';\n};\n\n// ==================================================================\n// 消息读取与解析\n// ==================================================================\n\n/**\n * **【获取消息内容】** 从酒馆的消息对象中安全地提取当前激活（被选中）的消息内容字符串。\n * 这个函数是 ERA 中所有消息内容读取的唯一入口，以确保逻辑统一和健壮性。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string | null} 当前激活的消息内容；如果无法获取，则返回 null。\n */\nexport function getMessageContent(msg: any): string | null {\n  if (!msg) return null;\n\n  let content: string | null = null;\n\n  // 优先检查 .mes 属性，这是新版酒馆的规范\n  if (typeof msg.mes === 'string') {\n    content = msg.mes;\n  }\n  // 如果没有 .mes，则处理 swipes\n  else if (Array.isArray(msg.swipes)) {\n    const sid = Number(msg.swipe_id ?? 0);\n    content = msg.swipes[sid] || null;\n  }\n  // 最后，作为兼容，检查旧版的 .message 属性\n  else if (typeof msg.message === 'string') {\n    content = msg.message;\n  }\n\n  if (content === null) {\n    return null;\n  }\n\n  // 在返回内容前进行宏替换。\n  // 这样做是因为酒馆自身的宏替换行为不一致：有时（如消息流式生成后）会替换，\n  // 但有时（如聊天记录刚加载时）则不会，这会导致读取到的内容状态混乱。\n  // 因此，我们统一在获取消息时手动执行一次宏替换，以确保数据的一致性。\n  return parseCharacterMacros(content);\n}\n\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent: string | null | undefined): EraData | null {\n  if (typeof messageContent !== 'string') {\n    return null;\n  }\n  const match = messageContent.match(ERA_DATA_REGEX);\n  if (!match || !match[1]) {\n    return null;\n  }\n  try {\n    // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n    // 必须使用正则表达式进行宽松匹配来提取键值。\n    const customFormatBlock = match[1];\n    const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n    const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n\n    if (keyMatch?.[1] && typeMatch?.[1]) {\n      const eraData = {\n        'era-message-key': keyMatch[1],\n        'era-message-type': typeMatch[1] as 'user' | 'assistant',\n      };\n      log.debug('parseEraData', '成功解析 EraData', eraData);\n      return eraData;\n    }\n    log.debug('parseEraData', '未能在 EraData 块中找到完整的键值对', { customFormatBlock });\n    return null;\n  } catch (e) {\n    log.warn('parseEraData', '解析 EraData 块时发生异常', e);\n    return null;\n  }\n}\n\n/**\n * **【判断消息类型】** 根据消息内容中的 `era-message-type` 元数据或 `role` 属性判断是否为用户消息。\n * 优先信任注入的元数据。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {boolean} 如果是用户消息，则返回 true。\n */\nexport function isUserMessage(msg: any): boolean {\n  const content = getMessageContent(msg);\n  const data = parseEraData(content);\n  if (data) {\n    return data['era-message-type'] === 'user';\n  }\n  // 回退到检查 role 属性\n  return msg?.role === 'user';\n}\n\n/**\n * 从后向前查找并返回最后一条 AI 消息。\n * @returns {TavernMessage | null} 找到的 AI 消息对象，如果找不到则返回 null。\n */\nexport function findLastAiMessage(): any | null {\n  const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n  if (!messages || messages.length === 0) {\n    log.debug('findLastAiMessage', '聊天记录为空, 未找到任何消息。');\n    return null;\n  }\n\n  for (let i = messages.length - 1; i >= 0; i--) {\n    const msg = messages[i];\n    if (!isUserMessage(msg)) {\n      log.debug('findLastAiMessage', `找到最后一条 AI 消息, ID: ${msg.message_id}`);\n      return msg;\n    }\n  }\n\n  log.debug('findLastAiMessage', '未在聊天记录中找到任何 AI 消息。');\n  return null;\n}\n\n/**\n * **【带重试获取消息内容】**\n * 尝试获取指定或最新AI消息的内容，如果初次获取为空，则会进行指定次数和间隔的重试。\n * 这主要用于应对酒馆消息在事件触发后可能存在的更新延迟。\n * @param {TavernMessage | number} [messageOrId] - （可选）酒馆消息对象或消息 ID。如果未提供，则自动查找最新的 AI 消息。\n * @param {number} [retries=3] - 最大重试次数。\n * @param {number} [delay=50] - 每次重试之间的等待时间（毫秒）。\n * @returns {Promise<string | null>} 成功则返回消息内容，重试后仍然失败则返回 null。\n */\nexport async function getMessageContentWithRetry(\n  messageOrId?: any | number,\n  retries: number = 5,\n  delay: number = 50,\n): Promise<string | null> {\n  let msg: any;\n\n  if (messageOrId) {\n    if (typeof messageOrId === 'number') {\n      const messages = getChatMessages(messageOrId, { include_swipes: true });\n      msg = messages ? messages[0] : null;\n    } else {\n      msg = messageOrId;\n    }\n  } else {\n    msg = findLastAiMessage();\n  }\n\n  if (!msg) {\n    log.warn('getMessageContentWithRetry', '找不到有效的消息对象', { messageOrId });\n    return null;\n  }\n\n  for (let i = 0; i < retries; i++) {\n    const content = getMessageContent(msg);\n    if (content) {\n      return content;\n    }\n    log.log('getMessageContentWithRetry', `获取消息内容失败，将在 ${delay}ms 后重试 (第 ${i + 1} 次)`);\n    await new Promise(resolve => setTimeout(resolve, delay));\n  }\n\n  log.warn('getMessageContentWithRetry', `重试 ${retries} 次后仍无法获取消息内容`, { message_id: msg.message_id });\n  return getMessageContent(msg); // 返回最后一次尝试的结果 (可能为 null)\n}\n\n// ==================================================================\n// 消息写入\n// ==================================================================\n\n/**\n * **【通用】** 更新指定消息的内容。\n * 这个辅助函数封装了处理 `swipes` 和普通 `message` 的逻辑，提供一个统一的写入接口。\n * @param {any} message - 要更新的消息对象。\n * @param {string} newContent - 全新的消息内容。\n * @param {'none' | 'affected' | 'all'} [refresh='none'] - 更新后是否刷新消息。\n */\nexport async function updateMessageContent(\n  message: any,\n  newContent: string,\n  refresh: 'none' | 'affected' | 'all' = 'none',\n) {\n  const oldContent = getMessageContent(message);\n  log.debug('updateMessageContent', '更新前的消息内容:', oldContent);\n  log.debug('updateMessageContent', '更新后的消息内容:', newContent);\n\n  const updatePayload: { message_id: number; message?: string; swipes?: string[] } = {\n    message_id: message.message_id,\n  };\n\n  if (Array.isArray(message.swipes)) {\n    const sid = Number(message.swipe_id ?? 0);\n    const newSwipes = [...message.swipes];\n    newSwipes[sid] = newContent;\n    updatePayload.swipes = newSwipes;\n  } else {\n    updatePayload.message = newContent;\n  }\n\n  await setChatMessages([updatePayload], { refresh });\n}\n\n/**\n * 从消息对象中提取、解析并转义所有 ERA 指令块。\n *\n * @param {any} msg - 酒馆消息对象。\n * @param {boolean} [toSimplified=false] - 是否将提取的指令内容转换为简体中文。\n * @returns {{ allInserts: any[], allEdits: any[], allDeletes: any[] }} - 包含已转义指令数据的对象。\n */\nexport function extractAndParseCommands(\n  msg: any,\n  toSimplified: boolean = false,\n): { allInserts: any[]; allEdits: any[]; allDeletes: any[] } {\n  const rawContent = getMessageContent(msg) || '';\n\n  // 1. 从消息内容中解析出所有指令块。\n  const insertBlocks = extractValidBlocks(rawContent, createTagRegex('VariableInsert', 'exact'), toSimplified);\n  const editBlocks = extractValidBlocks(rawContent, createTagRegex('VariableEdit', 'exact'), toSimplified);\n  const deleteBlocks = extractValidBlocks(rawContent, createTagRegex('VariableDelete', 'exact'), toSimplified);\n\n  log.debug('extractAndParseCommands', 'delete拿到的指令', deleteBlocks);\n\n  if (!insertBlocks.length && !editBlocks.length && !deleteBlocks.length) {\n    log.debug('extractAndParseCommands', `消息 (ID: ${msg.message_id}) 未检测到变量修改标签。`);\n  }\n\n  const rawInserts = insertBlocks.flatMap((s: string) => parseJsonl(s));\n  const rawEdits = editBlocks.flatMap((s: string) => parseJsonl(s));\n  const rawDeletes = deleteBlocks.flatMap((s: string) => parseJsonl(s));\n\n  // 在这里对从消息中解析出的原始数据进行转义，确保所有后续处理都使用转义后的数据。\n  const allInserts = escapeEraData(rawInserts);\n  const allEdits = escapeEraData(rawEdits);\n  const allDeletes = escapeEraData(rawDeletes);\n\n  log.debug('extractAndParseCommands', '数据转义完成', {\n    before: { inserts: rawInserts, edits: rawEdits, deletes: rawDeletes },\n    after: { inserts: allInserts, edits: allEdits, deletes: allDeletes },\n  });\n\n  return { allInserts, allEdits, allDeletes };\n}\n","/**\n * @file ERA 变量框架 - 消息密钥 (MK) 管理模块\n * @description\n * 这个模块是 ERA 框架的基石，负责管理“消息密钥”（Message Key, MK）。\n *\n * **设计理念**:\n * ERA 的核心优势在于其鲁棒性，它通过将变量状态与 SillyTavern 不稳定的消息变量（message variables）\n * 解耦来实现这一点。MK 正是实现解耦的关键。\n *\n * MK 是一个由 **ERA 框架自身** 动态生成并**注入到消息内容字符串顶部**的唯一标识符。\n * 它就像一个不可变的“锚点”，随消息内容本身一起存在。ERA 的所有核心逻辑，包括变量追踪、\n * 回滚和同步，都围绕着识别和操作这些锚点来进行，而不是依赖于可能发生错位或被错误继承的消息变量。\n *\n * **MK 格式**:\n * MK 被包裹在一个独特的、类似 XML 的 `<era_data>` 标签中，其内部是一种**非标准**的类 JSON 格式，\n * 使用 `=` 作为分隔符，以避免与 AI 可能生成的标准 JSON 混淆。\n * e.g., `<era_data>{\"era-message-key\"=\"era_mk_...\",\"era-message-type\"=\"user\"}</era_data>`\n * 这种设计（而不是用 HTML 注释 `<!-- -->`）是为了防止 MK 被其他可能移除注释的脚本无意中破坏。\n *\n * **核心功能**:\n * 1. **生成与注入**: `ensureMessageKey` 函数确保任何需要追踪的消息都拥有一个 MK。如果不存在，\n *    它会生成一个新的 MK 并注入到消息内容的开头。\n * 2. **解析与读取**: `readMessageKey` 函数提供了一个只读的接口，用于从消息内容中解析出 MK。\n * 3. **同步保障**: `updateLatestSelectedMk` 等函数确保核心数据结构 `SelectedMks` 与最新的\n *    消息状态保持一致，是框架自愈能力的重要组成部分。\n */\n\n'use strict';\n\nimport { ERA_DATA_REGEX, ERA_DATA_TAG, SEL_PATH } from '../../utils/constants';\nimport { updateEraMetaData } from '../../utils/era_data';\nimport { Logger } from '../../utils/log';\nimport { getMessageContent, updateMessageContent } from '../../utils/message';\nimport { rnd } from '../../utils/string';\n\nconst logger = new Logger();\n\n/**\n * @type {EraData} - 定义了存储在 `<era_data>` 块中的元数据结构。\n */\ntype EraData = {\n  'era-message-key': string;\n  'era-message-type': 'user' | 'assistant';\n};\n\n// ==================================================================\n// 内部辅助函数\n// ==================================================================\n\n/**\n * 从消息内容字符串中解析出 `EraData` 对象。这是一个只读操作。\n * @param {string | null | undefined} messageContent - 消息的内容字符串。\n * @returns {EraData | null} 解析成功则返回 `EraData` 对象，否则返回 null。\n */\nfunction parseEraData(messageContent: string | null | undefined): EraData | null {\n  if (typeof messageContent !== 'string') {\n    return null;\n  }\n  const match = messageContent.match(ERA_DATA_REGEX);\n  if (!match || !match[1]) {\n    return null;\n  }\n  try {\n    // 由于 MK 块内部是自定义的 `{\"key\"=\"value\"}` 格式，不能使用 JSON.parse。\n    // 必须使用正则表达式进行宽松匹配来提取键值。\n    const customFormatBlock = match[1];\n    const keyMatch = customFormatBlock.match(/\"era-message-key\"\\s*=\\s*\"(.*?)\"/);\n    const typeMatch = customFormatBlock.match(/\"era-message-type\"\\s*=\\s*\"(.*?)\"/);\n\n    if (keyMatch?.[1] && typeMatch?.[1]) {\n      return {\n        'era-message-key': keyMatch[1],\n        'era-message-type': typeMatch[1] as 'user' | 'assistant',\n      };\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n\n/**\n * **【读取 MK】** 从一个消息对象中只读地提取其消息密钥（MK）。\n * 这个函数经过特别优化，以应对滑动（swipe）等场景下消息对象结构不一致的问题。\n * 它会全面检查消息的 `mes`、`message` 以及 `swipes` 数组中的每一个元素，直到找到第一个有效的 MK 为止。\n * @param {TavernMessage} msg - 酒馆消息对象。\n * @returns {string} 找到的 MK；如果不存在，则返回空字符串。\n */\nexport function readMessageKey(msg: any): string {\n  if (!msg) return '';\n\n  // 核心逻辑：始终且仅根据 getMessageContent 的结果来解析 MK。\n  const content = getMessageContent(msg);\n\n  const mk = parseEraData(content)?.['era-message-key'] || '';\n\n  // 移除遍历其他 swipes 的错误逻辑。如果当前激活的内容没有 MK，就必须返回空字符串，\n  // 以强制 ensureMessageKey 生成新的 MK。\n  return mk;\n\n  /*\n   * ==================================================================\n   * 【已废弃的兼容逻辑】 - 2025/10/02\n   *\n   * 以下代码块是为了兼容旧版酒馆的一个特性：一个消息的多个 swipe 可能共享同一个底层消息变量，\n   * 因此 MK 可能存在于任何一个 swipe 中。\n   *\n   * **废弃原因**:\n   * 在当前的 ERA 架构中，每个 swipe 都被视为独立的内容。如果当前激活的 swipe 内容中没有 MK，\n   * 就意味着它是一个全新的、需要被赋予新 MK 的消息。此时若继续查找并返回其他 swipe 的旧 MK，\n   * 将会导致 `ensureMessageKey` 错误地认为新消息已有 MK，从而跳过必要的“生成新 MK”流程。\n   * 这正是导致 swipe 新消息时无法正确写入变量的根本原因。\n   *\n   * 因此，该兼容逻辑已被注释掉，以确保 `readMessageKey` 的行为与当前架构的设计意图保持一致。\n   * ==================================================================\n   */\n  // const mkFromCurrent = parseEraData(content)?.['era-message-key'];\n  // if (mkFromCurrent) {\n  //   return mkFromCurrent;\n  // }\n  // if (Array.isArray(msg.swipes)) {\n  //   for (const swipeContent of msg.swipes) {\n  //     const mkFromSwipe = parseEraData(swipeContent)?.['era-message-key'];\n  //     if (mkFromSwipe) {\n  //       return mkFromSwipe;\n  //     }\n  //   }\n  // }\n  // const mkFromMessage = parseEraData(msg.message)?.['era-message-key'];\n  // if (mkFromMessage) {\n  //   return mkFromMessage;\n  // }\n  // return '';\n}\n\n/**\n * **【确保 MK 存在】**\n * 这是本模块最核心的函数。它检查一个消息是否已拥有 MK，如果尚未拥有，则为其生成一个新的 MK 并注入到消息内容中。\n * 这是解决“鸡生蛋/蛋生鸡”问题的关键：在对变量进行任何操作之前，必须先确保有一个可供依附的锚点（MK）。\n *\n * @param {TavernMessage} msg - 目标消息对象 (必须包含 `message_id`, `role`, 以及 `message` 或 `swipes`)。\n * @returns {Promise<{mk: string, isNew: boolean}>} 返回包含 MK 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nexport async function ensureMessageKey(msg: any): Promise<{ mk: string; isNew: boolean }> {\n  if (!msg || typeof msg.message_id !== 'number' || !msg.role) {\n    logger.warn('ensureMessageKey', `无效的消息对象结构，无法确保Key。`, { msg });\n    return { mk: '', isNew: false };\n  }\n\n  // 1. 使用增强的 readMessageKey 检查是否已存在 MK\n  const existingMk = readMessageKey(msg);\n  if (existingMk) {\n    return { mk: existingMk, isNew: false }; // 已存在，直接返回\n  }\n\n  // 2. 生成新的 MK 和元数据块\n  const newMk = `era_mk_${Date.now()}_${rnd()}`;\n  const messageType = msg.role === 'user' ? 'user' : 'assistant';\n  const dataString = `<${ERA_DATA_TAG}>{\"era-message-key\"=\"${newMk}\",\"era-message-type\"=\"${messageType}\"}</${ERA_DATA_TAG}>`;\n\n  logger.debug('ensureMessageKey', `为消息 (ID: ${msg.message_id}) 注入新的Key: ${newMk}`);\n\n  // 3. 构造新的消息内容并统一调用更新函数\n  const currentContent = getMessageContent(msg) ?? '';\n  const contentWithMk = currentContent + '\\n' + dataString; //尝试改为把mk放到末尾\n  const newContent = contentWithMk;\n\n  // 使用从 utils.ts 导入的通用函数来更新消息，该函数已封装了处理 swipes 的逻辑。\n  await updateMessageContent(msg, newContent);\n\n  return { mk: newMk, isNew: true };\n}\n\n/**\n * **【确保最新消息的 MK】**\n * 这是一个便捷函数，专门用于确保当前聊天记录中的最后一条消息拥有 MK。\n * 它通常在监听到新消息生成等事件时被调用，以确保新消息能被 ERA 系统正确追踪。\n * @returns {Promise<{mk: string, message_id: number | null, isNewKey: boolean}>} 返回包含 MK、消息 ID 和一个布尔值的对象，该布尔值指示是否创建了新的 MK。\n */\nexport const ensureMkForLatestMessage = async (): Promise<{\n  mk: string;\n  message_id: number | null;\n  isNewKey: boolean;\n}> => {\n  try {\n    const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n    // 保留此日志，因为它对于调试事件触发时的消息状态至关重要。\n    logger.debug('ensureMkForLatestMessage', `获取到的最新消息对象 (msg)`, msg);\n\n    if (!msg || typeof msg.message_id !== 'number') {\n      logger.warn('ensureMkForLatestMessage', '无法读取最新消息或其ID，退出', { latestMessage: msg });\n      return { mk: '', message_id: null, isNewKey: false };\n    }\n\n    // ensureMessageKey 会返回最终的 MK 和一个布尔值\n    const { mk, isNew } = await ensureMessageKey(msg);\n    logger.debug('ensureMkForLatestMessage', `已为最新消息 ${msg.message_id} 确保 MK 存在。 (是否新建: ${isNew})`);\n    return { mk, message_id: msg.message_id, isNewKey: isNew };\n  } catch (err: any) {\n    logger.error('ensureMkForLatestMessage', `确保MK时异常: ${err?.message || err}`, {\n      error: err,\n      latestMessage: getChatMessages(-1, { include_swipes: true })?.[0],\n    });\n    return { mk: '', message_id: null, isNewKey: false };\n  }\n};\n\n/**\n * **【更新最新已选 MK】**\n * 这是一个“保险”函数，用于在每次事件处理的最后，强制校准 `SelectedMks` 数组中关于**最新消息**的记录。\n * 它确保即使在复杂的异步流程中，`SelectedMks` 的尾部也始终与实际的最新消息保持严格同步。\n * @returns {Promise<void>}\n */\nexport const updateLatestSelectedMk = async () => {\n  const msg = getChatMessages(-1, { include_swipes: true })?.[0];\n  if (!msg || typeof msg.message_id !== 'number') return;\n\n  // 确保 MK 存在并获取它\n  const { mk: MK } = await ensureMessageKey(msg);\n  if (!MK) return;\n\n  // 更新 ERAMetaData 中的 SelectedMks 数组\n  await updateEraMetaData(meta => {\n    const selectedMks = _.get(meta, SEL_PATH, []);\n    // 只有在记录不一致时才执行写操作，以优化性能\n    if (selectedMks[msg.message_id] !== MK) {\n      selectedMks[msg.message_id] = MK;\n      _.set(meta, SEL_PATH, selectedMks);\n    }\n    return meta;\n  });\n};\n","import { updateScriptSettings } from '../../utils/era_data';\nimport { Logger } from '../../utils/log';\n\nconst logger = new Logger();\n\n/**\n * 初始化脚本的外部设置变量。\n * 该函数会确保所有设置都存在，如果不存在则使用默认值。\n */\nexport async function initializeExternalSettings() {\n  logger.log('initializeExternalSettings', '开始初始化脚本设置...');\n  await updateScriptSettings(async settings => {\n    // updateScriptSettings 内部会处理默认值，所以这里我们只需要返回它\n    logger.debug('initializeExternalSettings', '当前设置:', settings);\n    return settings;\n  });\n  logger.log('initializeExternalSettings', '脚本设置初始化完成。');\n}\n\n// 导出函数，由事件分发器在 app_ready 事件时调用\n$(() => {\n  initializeExternalSettings();\n});\n","'use strict';\n\nimport { Logger } from '../utils/log';\nimport { getScriptSettings } from '../utils/era_data';\nimport { isUserMessage, getMessageContent, updateMessageContent } from '../utils/message';\n\n/**\n * @file ERA 变量框架 - 状态占位符宏\n * @description 监听消息接收事件，并确保消息中存在用于渲染状态UI的占位符。\n */\n\nconst logger = new Logger();\n\n/**\n * **【占位符保障】**\n * 确保指定 ID 的 AI 消息末尾存在用于渲染状态 UI 的占位符。\n * 如果占位符不存在，则会自动添加。\n * @param {number} message_id - 要检查和处理的消息的 ID。\n */\nexport async function ensurePlaceholder(message_id: number) {\n  const funcName = 'ensurePlaceholder';\n  logger.debug(funcName, `执行占位符保障，消息 ID: ${message_id}`);\n\n  const settings = getScriptSettings();\n  if (!settings.在ai消息尾部生成特殊符号) {\n    logger.debug(funcName, '功能未启用，已跳过。');\n    return;\n  }\n  logger.debug(funcName, '功能已启用，继续执行。');\n\n  const chat_message = getChatMessages(message_id, { include_swipes: true })[0];\n  if (!chat_message) {\n    logger.warn(funcName, `无法找到消息 ID: ${message_id} 对应的消息。`);\n    return;\n  }\n  logger.debug(funcName, `获取到消息对象 (ID: ${message_id})`, chat_message);\n\n  if (isUserMessage(chat_message)) {\n    logger.debug(funcName, `消息 ${message_id} 是用户消息，已跳过。`);\n    return;\n  }\n  logger.debug(funcName, `消息 ${message_id} 是 AI 消息，继续处理。`);\n\n  const placeholder = settings.特殊符号值;\n  const currentContent = getMessageContent(chat_message);\n  logger.debug(funcName, '读取到消息内容:', { content: currentContent });\n  logger.debug(funcName, '使用的占位符:', { placeholder });\n\n  if (currentContent && currentContent.includes(placeholder)) {\n    logger.debug(funcName, '消息已包含占位符，无需操作。');\n    return;\n  }\n\n  const newMessage = (currentContent || '').trimEnd() + '\\n' + placeholder;\n  logger.debug(funcName, '准备更新消息，添加占位符。', { newMessage });\n\n  try {\n    await updateMessageContent(chat_message, newMessage, 'affected');\n    logger.debug(funcName, '消息更新成功。');\n  } catch (error) {\n    logger.error(funcName, '更新消息时发生错误。', error);\n  }\n}\n","/**\n * @file ERA 变量框架 - 状态时间旅行模块\n * @description\n * 该模块提供了在不同时间点（由 MK 标记）之间移动变量状态（stat）的核心功能。\n * 它不直接与酒馆的 `variables` 交互，而是提供纯粹的、可测试的计算函数。\n *\n * **核心理念**:\n * - **状态的确定性**: 任何时刻的变量状态（stat）都是由一个初始状态（空对象）加上从头到该时刻的所有 `EditLog` 顺序应用而成的。\n * - **可逆操作**: 所有 `EditLog` 记录的操作都是可逆的。\n * - **顺序的重要性**: `EditLog` 本身是无序的（存储在以 MK 为键的对象中），必须依赖 `selectedMks` 数组提供的正确顺序来应用。\n */\n\n'use strict';\n\nimport { parseEditLog } from '../utils/data';\nimport { Logger } from '../utils/log';\n\nconst logger = new Logger();\n\n// ==================================================================\n// 内部辅助函数 (复刻自 rollback.ts 和 sync.ts)\n// ==================================================================\n\n/**\n * 对一个 stat 对象应用反向的 EditLog。这是一个纯函数。\n * @param stat - 起始状态对象。\n * @param log - 要反向应用的 EditLog 数组。\n * @returns {object} - 应用了反向操作后的新 stat 对象。\n */\nfunction applyRollback(stat: object, log: any[]): object {\n  if (!log || !log.length) return stat;\n  // 关键：必须逆序遍历 EditLog 来执行回滚。\n  for (let i = log.length - 1; i >= 0; i--) {\n    const entry = log[i];\n    const op = String(entry?.op || '').toLowerCase();\n    const path = String(entry?.path || '');\n    if (!path) continue;\n\n    if (op === 'insert') {\n      // 对于“插入”操作，回滚即为“删除”。\n      _.unset(stat, path);\n    } else if (op === 'update' || op === 'delete') {\n      // 对于“更新”或“删除”操作，回滚即为恢复到“旧值”。\n      if (typeof entry.value_old === 'undefined') {\n        _.unset(stat, path);\n      } else {\n        _.set(stat, path, _.cloneDeep(entry.value_old));\n      }\n    }\n  }\n  return stat;\n}\n\n/**\n * 对一个 stat 对象应用正向的 EditLog。这是一个纯函数。\n * @param stat - 起始状态对象。\n * @param log - 要正向应用的 EditLog 数组。\n * @returns {object} - 应用了正向操作后的新 stat 对象。\n */\nfunction applyForward(stat: object, log: any[]): object {\n  if (!log || !log.length) return stat;\n  // 正序遍历 log\n  for (const entry of log) {\n    if (!entry || !entry.path) continue;\n    const op = String(entry?.op || '').toLowerCase();\n\n    if (op === 'insert' || op === 'update') {\n      _.set(stat, entry.path, _.cloneDeep(entry.value_new));\n    } else if (op === 'delete') {\n      _.unset(stat, entry.path);\n    }\n  }\n  return stat;\n}\n\n// ==================================================================\n// 导出的核心函数\n// ==================================================================\n\n/**\n * **【函数一】**: 将一个 stat 从 currentMK 回滚到指定 targetMK 对应的状态。\n *\n * @param {string} targetMK - 你想回滚到的目标消息的 MK。\n * @param {string} currentMK - 当前状态所对应的 MK。\n * @param {object} currentStat - 当前的变量状态。\n * @param {string[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象。\n * @returns {object} - 回滚完成后的 stat 对象。\n */\nexport function rollbackStatToMK(\n  targetMK: string | null | undefined,\n  currentMK: string,\n  currentStat: object,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n): object {\n  const currentIndex = selectedMks.indexOf(currentMK);\n  // 允许 targetMK 为 null 或 undefined, 此时 targetIndex 为 -1\n  const targetIndex = targetMK ? selectedMks.indexOf(targetMK) : -1;\n\n  if (currentIndex === -1) {\n    const errorMsg = `在序列中未找到当前MK: ${currentMK}`;\n    logger.error('rollbackStatToMK', errorMsg, { currentMK, selectedMks });\n    throw new Error(errorMsg);\n  }\n  if (targetMK && targetIndex === -1) {\n    const errorMsg = `在序列中未找到目标MK: ${targetMK}`;\n    logger.error('rollbackStatToMK', errorMsg, { targetMK, selectedMks });\n    throw new Error(errorMsg);\n  }\n\n  if (targetIndex > currentIndex) {\n    logger.warn('rollbackStatToMK', '目标MK不在过去，返回当前状态。', {\n      targetMK,\n      currentMK,\n      targetIndex,\n      currentIndex,\n    });\n    return _.cloneDeep(currentStat);\n  }\n  if (targetIndex === currentIndex) {\n    return _.cloneDeep(currentStat);\n  }\n\n  let tempStat = _.cloneDeep(currentStat);\n\n  // 从当前位置开始，回滚到目标位置的后一个\n  // 如果 targetIndex 是 -1, 循环会一直执行到 i > -1, 即 i=0, 从而回滚所有历史\n  for (let i = currentIndex; i > targetIndex; i--) {\n    const mkToRollback = selectedMks[i];\n    if (!mkToRollback) continue;\n    const log = parseEditLog(allLogs[mkToRollback]);\n    tempStat = applyRollback(tempStat, log);\n  }\n\n  return tempStat;\n}\n\n/**\n * **【函数二】**: 从一个已知的 stat 和 mk 开始，正向计算到目标 mk 的状态。\n *\n * @param {object} startStat - 起始的变量状态。\n * @param {string} startMK - 起始状态对应的 MK。\n * @param {string} targetMK - 目标状态对应的 MK。\n * @param {string[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象。\n * @returns {object} - 计算出的目标 MK 对应的 stat。\n */\nexport function calculateStatForward(\n  startStat: object,\n  startMK: string,\n  targetMK: string,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n): object {\n  const startIndex = selectedMks.indexOf(startMK);\n  const targetIndex = selectedMks.indexOf(targetMK);\n\n  if (startIndex === -1 || targetIndex === -1) {\n    const errorMsg = `在序列中未找到MK。起始MK: ${startMK}, 目标MK: ${targetMK}`;\n    logger.error('calculateStatForward', errorMsg, { startMK, targetMK, selectedMks });\n    throw new Error(errorMsg);\n  }\n\n  if (targetIndex < startIndex) {\n    logger.warn('calculateStatForward', '目标MK不在未来，返回起始状态。', {\n      startMK,\n      targetMK,\n      startIndex,\n      targetIndex,\n    });\n    return _.cloneDeep(startStat);\n  }\n  if (targetIndex === startIndex) {\n    return _.cloneDeep(startStat);\n  }\n\n  let tempStat = _.cloneDeep(startStat);\n\n  // 从起始位置的下一个开始，正向应用到目标位置\n  for (let i = startIndex + 1; i <= targetIndex; i++) {\n    const mkToApply = selectedMks[i];\n    if (!mkToApply) continue;\n    const log = parseEditLog(allLogs[mkToApply]);\n    tempStat = applyForward(tempStat, log);\n  }\n\n  return tempStat;\n}\n\n/**\n * **【函数三】**: 从零开始，计算出任意目标 MK 的状态。\n * 这是最稳健的实现，它通过从一个空的初始状态，再正向计算到目标状态来确保结果的准确性。\n *\n * @param {string} targetMK - 目标状态对应的 MK。\n * @param {string[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象。\n * @returns {object} - 计算出的目标 stat 对象。\n */\nexport function calculateStatAt(\n  targetMK: string,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n): object {\n  const targetIndex = selectedMks.indexOf(targetMK);\n\n  if (targetIndex === -1) {\n    const errorMsg = `在序列中未找到目标MK: ${targetMK}`;\n    logger.error('calculateStatAt', errorMsg, { targetMK, selectedMks });\n    throw new Error(errorMsg);\n  }\n\n  let tempStat = {}; // 从绝对的初始状态开始\n\n  // 从初始状态正向应用到 targetIndex\n  for (let i = 0; i <= targetIndex; i++) {\n    const mkToApply = selectedMks[i];\n    if (!mkToApply) continue;\n    const log = parseEditLog(allLogs[mkToApply]);\n    tempStat = applyForward(tempStat, log);\n  }\n\n  return tempStat;\n}\n\n/**\n * **【函数四】**: 计算从 startMk 到 endMk 之间所有消息的 stat 快照。\n * 这是一个纯计算函数，返回一个包含每个步骤结果的数组。\n *\n * @param {string} startMk - 起始 MK。\n * @param {string} endMk - 结束 MK。\n * @param {(string | null)[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象。\n * @returns {{mk: string, message_id: number, stat: object}[]} - 包含每个快照及其元数据的数组。\n */\nexport function calculateAllStatsBetweenMks(\n  startMk: string,\n  endMk: string,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n): { mk: string; message_id: number; stat: object }[] {\n  const startIndex = selectedMks.indexOf(startMk);\n  const endIndex = selectedMks.indexOf(endMk);\n\n  if (startIndex === -1 || endIndex === -1 || startIndex > endIndex) {\n    logger.error('calculateAllStatsBetweenMks', '无效的 startMk 或 endMk。', {\n      startMk,\n      endMk,\n      selectedMks,\n    });\n    return [];\n  }\n\n  // 1. 计算起始点的状态\n  let currentStat = calculateStatAt(startMk, selectedMks, allLogs);\n  const results: { mk: string; message_id: number; stat: object }[] = [\n    {\n      mk: startMk,\n      message_id: startIndex,\n      stat: _.cloneDeep(currentStat),\n    },\n  ];\n\n  // 2. 从起始点的下一条开始，迭代计算后续状态\n  for (let i = startIndex + 1; i <= endIndex; i++) {\n    const mk = selectedMks[i];\n    if (!mk) continue;\n\n    const log = parseEditLog(allLogs[mk]);\n    currentStat = applyForward(currentStat, log);\n    results.push({\n      mk: mk,\n      message_id: i,\n      stat: _.cloneDeep(currentStat),\n    });\n  }\n\n  return results;\n}\n\n/**\n * **【历史追溯】**\n * 向上追溯 `selectedMks` 历史，查找某个变量路径在指定消息之前的最后一个值 (`value_new`)。\n * 这是一个纯函数，用于在生成 `update` 日志时准确地记录下 `value_old`。\n *\n * @param {string} path - 要查找的变量的完整路径。\n * @param {number} startMessageId - 从此消息 ID (在 selectedMks 中的索引) 的**前一条**消息开始向上查找。\n * @param {string[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象，键为 MK，值为原始日志字符串。\n * @returns {any} 返回找到的 `value_new`。如果追溯到开头都未找到，则返回 `null`。\n */\nexport function findLatestNewValue(\n  path: string,\n  startMessageId: number,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n): any {\n  logger?.debug('findLatestNewValue', `开始为路径 <${path}> 从消息索引 <${startMessageId}> 向上追溯历史值...`);\n\n  if (startMessageId < 0 || startMessageId > selectedMks.length) {\n    logger?.warn('findLatestNewValue', `错误：起始消息索引 ${startMessageId} 超出范围。`, {\n      path,\n      startMessageId,\n      selectedMksCount: selectedMks.length,\n    });\n    return null;\n  }\n\n  // 1. 从起始消息的前一条开始，向上（向旧）遍历 `selectedMks` 数组。\n  for (let i = startMessageId - 1; i >= 0; i--) {\n    const mk = selectedMks[i];\n    if (!mk) continue;\n\n    // 2. 通过 mk 从 allLogs 中获取当前 mk 对应的 EditLog。\n    const editLogForMkRaw = allLogs[mk];\n    const editLogForMk = parseEditLog(editLogForMkRaw);\n\n    if (!editLogForMk || editLogForMk.length === 0) continue;\n\n    // 3. 关键：从后向前遍历当前 MK 的 EditLog，这样找到的第一个匹配项就是最新的。\n    for (let j = editLogForMk.length - 1; j >= 0; j--) {\n      const logEntry = editLogForMk[j];\n      if (!logEntry || !logEntry.path) continue;\n\n      // Case 1: 精确路径匹配。\n      if (logEntry.path === path) {\n        if (logEntry.op === 'delete') {\n          logger?.warn(\n            'findLatestNewValue',\n            `>> 在 MK:${mk} 中为路径 <${path}> 找到了 'delete' 记录。这可能意味着正在尝试编辑一个已被删除的变量，因此其旧值应为 null。`,\n          );\n          return null;\n        }\n        logger?.debug(\n          'findLatestNewValue',\n          `>> 成功! 在 MK:${mk} 中找到精确路径 <${path}> 的值为: `,\n          logEntry.value_new,\n        );\n        return _.cloneDeep(logEntry.value_new);\n      }\n\n      // Case 2: 查找的路径是日志条目路径的子路径 (即 logEntry.path 是父级)。\n      // 例如, 查找 \"a.b.c.d\", 而日志中有对 \"a.b\" 的修改。\n      // `_.get` 可以处理任意深度的子路径 (如 \"c.d\")，因此不需要递归。\n      if (path.startsWith(logEntry.path + '.')) {\n        const subPath = path.substring(logEntry.path.length + 1);\n        const parentNewVal = logEntry.value_new;\n        if (_.isPlainObject(parentNewVal) && _.has(parentNewVal, subPath)) {\n          const foundVal = _.get(parentNewVal, subPath);\n          logger?.debug(\n            'findLatestNewValue',\n            `>> 成功! 在 MK:${mk} 中找到父级路径 <${logEntry.path}>, 并从中提取子路径 <${subPath}> 的值为:`,\n            foundVal,\n          );\n          return _.cloneDeep(foundVal);\n        }\n      }\n    }\n  }\n\n  // 如果追溯到开头都未找到，说明这是该变量的首次出现。\n  logger?.debug('findLatestNewValue', `向上追溯未找到路径 ${path} 的任何历史值，将使用 null 作为旧值`);\n  return null;\n}\n","/**\n * @file ERA 变量框架 - 状态快照模块\n * @description\n * 提供一个高级接口，用于获取任意历史时间点（由 MK 标记）的变量状态（stat）快照。\n */\n\n'use strict';\n\nimport { LOGS_PATH, SEL_PATH } from '../utils/constants';\nimport { getEraData } from '../utils/era_data';\nimport { Logger } from '../utils/log';\nimport { calculateAllStatsBetweenMks, calculateStatAt } from './timetravel';\n\nconst logger = new Logger();\n\n/**\n * 获取指定 MK 时间点的变量状态（stat）快照。\n * 这是一个高级接口，它会自动获取全局数据并调用纯计算函数。\n *\n * @param {string} targetMK - 目标状态对应的消息密钥 (MK)。\n * @returns {object | null} - 计算出的目标 stat 对象。如果找不到 MK 或发生错误，则返回 null。\n */\nexport function getStatAtMK(targetMK: string): object | null {\n  try {\n    const { meta } = getEraData();\n    const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n    const allLogs: { [mk: string]: string } = _.get(meta, LOGS_PATH, {});\n\n    if (!targetMK) {\n      logger.error('getStatAtMK', `目标 MK 不能为空。`, { targetMK });\n      return null;\n    }\n\n    // 检查 targetMK 是否有效\n    if (!selectedMks.includes(targetMK)) {\n      logger.error('getStatAtMK', `提供的 targetMK \"${targetMK}\" 无效或不存在于 selectedMks 中。`, {\n        targetMK,\n        selectedMks,\n      });\n      return null;\n    }\n\n    // 调用 timetravel 中的纯函数进行计算\n    const statAtTarget = calculateStatAt(targetMK, selectedMks, allLogs);\n\n    return statAtTarget;\n  } catch (error: any) {\n    logger.error('getStatAtMK', `计算状态快照时出错: ${error?.message || error}`, {\n      error,\n      targetMK,\n      eraData: getEraData(),\n    });\n    return null;\n  }\n}\n\n/**\n * 获取两个 MK（包含）之间的所有 stat 快照。\n * 这是一个高级接口，它会自动处理边界情况并调用纯计算函数。\n * @param {string} [startMk] - 起始 MK。如果为空，则从第一条消息开始。\n * @param {string} [endMk] - 结束 MK。如果为空，则到最后一条消息结束。\n * @returns {{mk: string, message_id: number, stat: object}[] | null} - 包含每个快照及其元数据的数组，或在出错时返回 null。\n */\nexport function getStatsBetweenMKs(\n  startMk?: string,\n  endMk?: string,\n): { mk: string; message_id: number; stat: object }[] | null {\n  try {\n    const { meta } = getEraData();\n    const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n    const allLogs: { [mk: string]: string } = _.get(meta, LOGS_PATH, {});\n\n    const validMks = selectedMks.filter((mk): mk is string => !!mk);\n    if (validMks.length === 0) {\n      return [];\n    }\n\n    // 检查 startMk 是否有效\n    if (startMk && !validMks.includes(startMk)) {\n      logger.error('getStatsBetweenMKs', `提供的 startMk \"${startMk}\" 无效或不存在于 selectedMks 中。`, {\n        startMk,\n        validMks,\n      });\n      return null;\n    }\n\n    // 检查 endMk 是否有效\n    if (endMk && !validMks.includes(endMk)) {\n      logger.error('getStatsBetweenMKs', `提供的 endMk \"${endMk}\" 无效或不存在于 selectedMks 中。`, {\n        endMk,\n        validMks,\n      });\n      return null;\n    }\n\n    const actualStartMk = startMk || validMks[0];\n    const actualEndMk = endMk || validMks[validMks.length - 1];\n\n    const results = calculateAllStatsBetweenMks(actualStartMk, actualEndMk, selectedMks, allLogs);\n    return results;\n  } catch (error: any) {\n    logger.error('getStatsBetweenMKs', `计算批量快照时出错: ${error?.message || error}`, {\n      error,\n      startMk,\n      endMk,\n      eraData: getEraData(),\n    });\n    return null;\n  }\n}\n","'use strict';\n\nimport { ERA_EVENT_EMITTER, LOGS_PATH, QueryResultPayload, SEL_PATH, WriteDonePayload } from '../../utils/constants';\nimport { unescapeEraData } from '../../utils/data';\nimport { getEraData, removeMetaFields } from '../../utils/era_data';\nimport { Logger } from '../../utils/log';\nimport { DispatcherPayload } from '../types';\n\nconst logger = new Logger();\n\n// ==================================================================\n// API 事件广播器\n// ==================================================================\n\n/**\n * 使用 lodash.debounce 创建一个防抖函数来发送 API 写入事件。\n * 这个事件通知主循环，有一个由 API 触发的、需要处理的变量变更。\n */\nexport const debouncedEmitApiWrite = _.debounce(\n  () => {\n    eventEmit(ERA_EVENT_EMITTER.API_WRITE);\n    logger.log('debouncedEmitApiWrite', `已触发合并后的 ${ERA_EVENT_EMITTER.API_WRITE} 事件。`);\n  },\n  50, // API 调用的防抖改成 50 毫秒，提高即时性\n  { leading: false, trailing: true },\n);\n\n// ==================================================================\n// 核心事件广播器\n// ==================================================================\n\n/**\n * **【广播器】** 触发 `era:writeDone` 事件。\n * 当一次完整的变量写入操作（包括增、删、改）成功完成后，应调用此函数。\n * 它向外部脚本广播一个事件，通知它们变量状态已发生改变，并提供详细的上下文。\n *\n * @param {DispatcherPayload} payload - 包含核心上下文信息的内部载荷。\n */\nexport function emitWriteDoneEvent(payload: DispatcherPayload) {\n  // 在广播前，获取最新的全量 ERA 数据\n  const { stat, meta } = getEraData();\n  const statWithoutMeta = removeMetaFields(stat);\n  logger.debug('emitWriteDoneEvent', '获取了最新的 ERA 数据并生成了纯净版', { stat, meta, statWithoutMeta });\n\n  // 构建完整的 WriteDonePayload\n  const fullPayload: WriteDonePayload = {\n    ...payload,\n    stat: unescapeEraData(stat),\n    statWithoutMeta: unescapeEraData(statWithoutMeta),\n    selectedMks: _.get(meta, SEL_PATH, []),\n    editLogs: _.get(meta, LOGS_PATH, {}),\n  };\n\n  logger.debug('emitWriteDoneEvent', '构建了完整的事件载荷', {\n    inputPayload: payload,\n    fullPayload: fullPayload,\n  });\n\n  eventEmit(ERA_EVENT_EMITTER.WRITE_DONE, fullPayload);\n  logger.log('emitWriteDoneEvent', `已触发 ${ERA_EVENT_EMITTER.WRITE_DONE} 事件。`, fullPayload);\n}\n\n/**\n * **【广播器】** 触发 `era:queryResult` 事件。\n * 用于响应所有 `GET_...` 系列的 API 请求。\n *\n * @param {QueryResultPayload['queryType']} queryType - 原始查询的类型。\n * @param {any} request - 原始查询的 `detail` 对象。\n * @param {any} result - 查询的结果（单个 QueryResultItem 或 QueryResultItem 数组）。\n */\nexport function emitQueryResultEvent(queryType: QueryResultPayload['queryType'], request: any, result: any) {\n  const { meta } = getEraData();\n  const payload: QueryResultPayload = {\n    queryType,\n    request,\n    result,\n    selectedMks: _.get(meta, SEL_PATH, []),\n    editLogs: _.get(meta, LOGS_PATH, {}),\n  };\n\n  eventEmit(ERA_EVENT_EMITTER.VARS_QUERY_RESULT, payload);\n  logger.log('emitQueryResultEvent', `已为查询 [${queryType}] 发送 ${ERA_EVENT_EMITTER.VARS_QUERY_RESULT} 事件。`);\n}\n","/**\n * @file ERA 变量框架 - 外部事件 API 实现模块\n * @description\n * 该模块是 ERA 框架与外部脚本交互的接口层。它实现了一系列自定义事件的处理器。\n *\n * **设计理念**:\n * ERA 框架不直接向外暴露函数调用接口。外部脚本与 ERA 交互的**唯一**方式是通过酒馆的\n * `eventEmit(eventName, eventData)` 函数，发送特定格式的事件。\n *\n * `index.ts` 模块会监听这些 `era:*` 前缀的事件，并将其推入 `event_queue.ts` 中进行处理。\n * 事件队列最终会调用本文件中对应的处理器函数（如 `insertByObject`）。\n *\n * 本模块中的函数通过一种巧妙、解耦的方式工作：它们在最新的 AI 消息末尾动态注入\n * `<VariableInsert>` 或 `<VariableEdit>` 指令块，然后调用酒馆的 `setChatMessages` 更新消息。\n * 这次修改会触发 `character_message_rendered` 等事件，被 ERA 的主监听器捕获，\n * 从而将 API 调用无缝地整合到 ERA 的原生解析和同步流程中。\n */\n\nimport { getStatAtMK, getStatsBetweenMKs } from '../../../core/snapshot';\nimport { SEL_PATH, WriteDonePayload } from '../../../utils/constants';\nimport { J, unescapeEraData } from '../../../utils/data';\nimport { getEraData, removeMetaFields } from '../../../utils/era_data';\nimport { Logger } from '../../../utils/log';\nimport { findLastAiMessage, getMessageContent, isUserMessage, updateMessageContent } from '../../../utils/message';\nimport { debouncedEmitApiWrite, emitQueryResultEvent, emitWriteDoneEvent } from '../../emitters/events';\n\nconst logger = new Logger();\nlet lastWriteDonePayload: WriteDonePayload | null = null;\neventOn('era:writeDone', (payload: WriteDonePayload) => {\n  lastWriteDonePayload = payload;\n});\n\n// API 写入任务的接口定义\ninterface ApiWriteJob {\n  blockTag: 'VariableInsert' | 'VariableEdit' | 'VariableDelete';\n  blockContent: object;\n}\n\n// ==================================================================\n// API 事件参考\n// (事件名称的常量定义见于 `constants.ts` 中的 `ERA_API_EVENTS` 对象)\n// ==================================================================\n\n/**\n * @section API Event: 'era:insertByObject'\n * @description 通过一个对象，非破坏性地插入新变量。只会写入不存在的路径。\n * @param {object} detail - 要插入的变量对象。\n * @example\n * eventEmit('era:insertByObject', {\n *   player: { name: \"勇者\", hp: 100, inventory: [] }\n * });\n */\n\n/**\n * @section API Event: 'era:updateByObject'\n * @description 通过一个对象，修改已存在的变量。如果路径不存在，则忽略。\n * @param {object} detail - 要更新的变量对象。\n * @example\n * eventEmit('era:updateByObject', {\n *   player: { hp: 120, status: 'blessed' }\n * });\n */\n\n/**\n * @section API Event: 'era:insertByPath'\n * @description 通过指定路径和值，非破坏性地插入一个新变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径，使用点或方括号表示法。\n * @param {*} detail.value - 要插入的值。\n * @example\n * eventEmit('era:insertByPath', {\n *   path: 'player.inventory[0]',\n *   value: { name: '生命药水', count: 3 }\n * });\n */\n\n/**\n * @section API Event: 'era:updateByPath'\n * @description 通过指定路径和值，修改一个已存在的变量。\n * @param {object} detail - 包含路径和值的对象。\n * @param {string} detail.path - 变量的路径。\n * @param {*} detail.value - 要设置的新值。可以是直接的值，也可以是运算表达式。\n * @example\n * eventEmit('era:updateByPath', {\n *   path: 'player.hp',\n *   value: '+=10'\n * });\n */\n\n/**\n * @section API Event: 'era:deleteByObject'\n * @description 通过一个对象，删除已存在的变量。\n * @param {object} detail - 描述要删除路径的结构。值的结构决定了删除行为。\n * @example\n * // 准备删除 player.gold。指令中 gold 的值必须是空对象 {}\n * eventEmit('era:deleteByObject', { player: { gold: {} } });\n *\n * // 准备删除整个 player 对象。\n * eventEmit('era:deleteByObject', { player: {} });\n *\n * // **重要**: 如果 player 对象包含 gold 和 mana 两个属性，\n * // 以下指令只会删除 gold 和 mana，而 player 对象本身会被保留（变为空对象）。\n * // 这与 `eventEmit('era:deleteByObject', { player: {} })` 的效果是不同的。\n * eventEmit('era:deleteByObject', { player: { gold: {}, mana: {} } });\n */\n\n/**\n * @section API Event: 'era:deleteByPath'\n * @description 通过指定路径，删除一个已存在的变量。\n * @param {object} detail - 包含路径的对象。\n * @param {string} detail.path - 要删除的变量的路径。\n * @example\n * eventEmit('era:deleteByPath', { path: 'player.inventory[0]' });\n */\n\n// ==================================================================\n// 内部核心函数\n// ==================================================================\n\n/**\n * 在聊天记录中查找并返回最后一条由 AI 发送的消息。\n * 这是注入变量修改指令的目标消息。\n * @returns {Promise<any | null>} 返回找到的消息对象，如果不存在 AI 消息则返回 null。\n */\n\n/**\n * 执行一次 API 写入操作。\n * 它将指定的变量修改块追加到最后一条 AI 消息的末尾，然后调度一个 'era:apiWrite' 事件。\n * @param {ApiWriteJob} job - 要执行的写入任务。\n */\nasync function performApiWrite(job: ApiWriteJob) {\n  // 1. 生成指令块\n  const contentString = J(job.blockContent);\n  const block = `\\n<${job.blockTag}>\\n${contentString}\\n</${job.blockTag}>`;\n\n  // 2. 查找目标消息并追加内容\n  const lastAiMessage = await findLastAiMessage();\n  if (!lastAiMessage) {\n    logger.warn('performApiWrite', '找不到任何 AI 消息，无法执行 API 写入。');\n    return;\n  }\n\n  const originalContent = getMessageContent(lastAiMessage) ?? '';\n  const newContent = originalContent + block;\n\n  logger.debug('performApiWrite', `实时写入 API 任务 (${job.blockTag}) 到消息 ID ${lastAiMessage.message_id}...`);\n\n  // 3. 实时更新消息内容\n  await updateMessageContent(lastAiMessage, newContent);\n\n  // 4. 调用防抖函数来调度写入事件的发送\n  debouncedEmitApiWrite();\n}\n\n// ==================================================================\n// 事件处理器实现 (由 event_queue.ts 调用)\n// ==================================================================\n\n/**\n * **【处理器】** 处理 `era:insertByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nexport function insertByObject(data: object) {\n  performApiWrite({ blockTag: 'VariableInsert', blockContent: data });\n}\n\n/**\n * **【处理器】** 处理 `era:updateByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量对象。\n */\nexport function updateByObject(data: object) {\n  performApiWrite({ blockTag: 'VariableEdit', blockContent: data });\n}\n\n/**\n * **【处理器】** 处理 `era:insertByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nexport function insertByPath(path: string, value: any) {\n  const block = _.set({}, path, value);\n  performApiWrite({ blockTag: 'VariableInsert', blockContent: block });\n}\n\n/**\n * **【处理器】** 处理 `era:updateByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n * @param {*} value - 从事件 `detail` 的 `value` 属性获取。\n */\nexport function updateByPath(path: string, value: any) {\n  const block = _.set({}, path, value);\n  performApiWrite({ blockTag: 'VariableEdit', blockContent: block });\n}\n\n/**\n * **【处理器】** 处理 `era:deleteByObject` 事件。\n * @param {object} data - 从事件的 `detail` 中获取的变量结构。\n */\nexport function deleteByObject(data: object) {\n  performApiWrite({ blockTag: 'VariableDelete', blockContent: data });\n}\n\n/**\n * **【处理器】** 处理 `era:deleteByPath` 事件。\n * @param {string} path - 从事件 `detail` 的 `path` 属性获取。\n */\nexport function deleteByPath(path: string) {\n  // 对于删除操作，我们用一个空对象作为值来表示删除该路径的意图\n  const block = _.set({}, path, {});\n  performApiWrite({ blockTag: 'VariableDelete', blockContent: block });\n}\n\n/**\n * **【处理器】** 处理 `era:getCurrentVars` 事件。\n * 获取当前最新的变量状态，并通过 `era:queryResult` 事件发回结果。\n * @param {any} detail - 原始请求的 detail 对象。\n */\nexport function handleGetCurrentVars(detail: any) {\n  logger.debug('handleGetCurrentVars', `请求获取当前变量。`);\n  const { stat, meta } = getEraData();\n  const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n  const lastMk = selectedMks[selectedMks.length - 1] || '';\n  const lastMessageId = selectedMks.length - 1;\n  const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n  const lastMessage = messages[lastMessageId];\n\n  const resultItem = {\n    mk: lastMk,\n    message_id: lastMessageId,\n    is_user: lastMessage ? isUserMessage(lastMessage) : false,\n    stat: unescapeEraData(stat),\n    statWithoutMeta: unescapeEraData(removeMetaFields(stat)),\n  };\n\n  emitQueryResultEvent('getCurrentVars', detail, resultItem);\n}\n\n/**\n * **【处理器】** 处理 `era:getSnapshotAtMk` 事件。\n * 计算指定 MK 的历史快照，并通过 `era:queryResult` 事件发回结果。\n * @param {any} detail - 从事件中获取的 `detail` 对象，应包含 `mk`。\n */\nexport function handleGetSnapshotAtMk(detail: any) {\n  const mk = detail?.mk;\n  if (!mk) {\n    logger.error('handleGetSnapshotAtMk', '请求缺少 \"mk\" 参数。');\n    return;\n  }\n\n  logger.debug('handleGetSnapshotAtMk', `请求获取历史快照，MK: ${mk}`);\n  const stat = getStatAtMK(mk);\n\n  if (stat) {\n    const { meta } = getEraData();\n    const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n    const message_id = selectedMks.indexOf(mk);\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    const message = messages[message_id];\n\n    const resultItem = {\n      mk,\n      message_id,\n      is_user: message ? isUserMessage(message) : false,\n      stat: unescapeEraData(stat),\n      statWithoutMeta: unescapeEraData(removeMetaFields(stat)),\n    };\n    emitQueryResultEvent('getSnapshotAtMk', detail, resultItem);\n  } else {\n    logger.error('handleGetSnapshotAtMk', `获取快照失败，MK: ${mk}`);\n  }\n}\n\n/**\n * **【处理器】** 处理 `era:getSnapshotsBetweenMks` 事件。\n * 计算两个 MK 之间的所有历史快照，并通过 `era:queryResult` 事件发回结果数组。\n * @param {any} detail - 从事件中获取的 `detail` 对象，应包含 `startMk` 和 `endMk`。\n */\nexport function handleGetSnapshotsBetweenMks(detail: any) {\n  const { startMk, endMk } = detail || {};\n\n  logger.debug('handleGetSnapshotsBetweenMks', `请求获取批量快照，从: ${startMk || '开始'}, 到: ${endMk || '结束'}`);\n  const results = getStatsBetweenMKs(startMk, endMk);\n\n  if (results) {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    // 为每个结果添加 statWithoutMeta\n    const finalResults = results.map(item => {\n      const message = messages[item.message_id];\n      return {\n        ...item,\n        is_user: message ? isUserMessage(message) : false,\n        stat: unescapeEraData(item.stat),\n        statWithoutMeta: unescapeEraData(removeMetaFields(item.stat)),\n      };\n    });\n    emitQueryResultEvent('getSnapshotsBetweenMks', detail, finalResults);\n  } else {\n    logger.error('handleGetSnapshotsBetweenMks', '获取批量快照失败。');\n  }\n}\n\n/**\n * **【处理器】** 处理 `era:getSnapshotAtMId` 事件。\n * 计算指定 message_id 的历史快照，并通过 `era:queryResult` 事件发回结果。\n * @param {any} detail - 从事件中获取的 `detail` 对象，应包含 `message_id`。\n */\nexport function handleGetSnapshotAtMId(detail: any) {\n  const message_id = detail?.message_id;\n  if (typeof message_id !== 'number') {\n    logger.error('handleGetSnapshotAtMId', '请求缺少 \"message_id\" 参数或类型不正确。');\n    return;\n  }\n\n  logger.debug('handleGetSnapshotAtMId', `请求获取历史快照，Message ID: ${message_id}`);\n\n  const { meta } = getEraData();\n  const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n\n  if (message_id < 0 || message_id >= selectedMks.length) {\n    logger.error('handleGetSnapshotAtMId', `Message ID ${message_id} 超出范围 [0, ${selectedMks.length - 1}]。`);\n    return;\n  }\n\n  const mk = selectedMks[message_id];\n  if (!mk) {\n    logger.warn('handleGetSnapshotAtMId', `Message ID ${message_id} 处没有找到有效的 MK。`);\n    // 即使没有 MK，也返回一个空结果，让调用者知道查询已执行\n    emitQueryResultEvent('getSnapshotAtMId', detail, null);\n    return;\n  }\n\n  const stat = getStatAtMK(mk);\n\n  if (stat) {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    const message = messages[message_id];\n\n    const resultItem = {\n      mk,\n      message_id,\n      is_user: message ? isUserMessage(message) : false,\n      stat: unescapeEraData(stat),\n      statWithoutMeta: unescapeEraData(removeMetaFields(stat)),\n    };\n    emitQueryResultEvent('getSnapshotAtMId', detail, resultItem);\n  } else {\n    logger.error('handleGetSnapshotAtMId', `获取快照失败，MK: ${mk} (来自 Message ID: ${message_id})`);\n  }\n}\n\n/**\n * **【处理器】** 处理 `era:getSnapshotsBetweenMIds` 事件。\n * 计算两个 message_id 之间的所有历史快照，并通过 `era:queryResult` 事件发回结果数组。\n * @param {any} detail - 从事件中获取的 `detail` 对象，应包含 `startId` 和 `endId`。\n */\nexport function handleGetSnapshotsBetweenMIds(detail: any) {\n  const { startId, endId } = detail || {};\n\n  logger.debug(\n    'handleGetSnapshotsBetweenMIds',\n    `请求获取批量快照，从 ID: ${startId ?? '开始'}, 到 ID: ${endId ?? '结束'}`,\n  );\n\n  const { meta } = getEraData();\n  const selectedMks: (string | null)[] = _.get(meta, SEL_PATH, []);\n\n  const startIndex = startId ?? 0;\n  const endIndex = endId ?? selectedMks.length - 1;\n\n  if (startIndex > endIndex || startIndex < 0 || endIndex >= selectedMks.length) {\n    logger.error(\n      'handleGetSnapshotsBetweenMIds',\n      `ID 范围 [${startIndex}, ${endIndex}] 无效或超出范围 [0, ${selectedMks.length - 1}]。`,\n    );\n    return;\n  }\n\n  // 使用第一个和最后一个有效的 MK 来调用现有的批量获取函数\n  const startMk = selectedMks[startIndex];\n  const endMk = selectedMks[endIndex];\n\n  if (!startMk || !endMk) {\n    logger.error('handleGetSnapshotsBetweenMIds', '指定的 ID 范围内没有找到有效的起始或结束 MK。');\n    return;\n  }\n\n  const results = getStatsBetweenMKs(startMk, endMk);\n\n  if (results) {\n    const messages = getChatMessages('0-{{lastMessageId}}', { include_swipes: false });\n    const finalResults = results.map(item => {\n      const message = messages[item.message_id];\n      return {\n        ...item,\n        is_user: message ? isUserMessage(message) : false,\n        stat: unescapeEraData(item.stat),\n        statWithoutMeta: unescapeEraData(removeMetaFields(item.stat)),\n      };\n    });\n    emitQueryResultEvent('getSnapshotsBetweenMIds', detail, finalResults);\n  } else {\n    logger.error('handleGetSnapshotsBetweenMIds', '获取批量快照失败。');\n  }\n}\n\n/**\n * **【处理器】** 处理 `era:requestWriteDone` 事件。\n * 请求 ERA 框架重新广播最新的 `writeDone` 事件。\n */\nexport function handleRequestWriteDone() {\n  logger.debug('handleRequestWriteDone', '接收到 writeDone 重播请求。');\n  if (lastWriteDonePayload) {\n    logger.debug('handleRequestWriteDone', '正在重播上一次的 writeDone 事件。');\n    emitWriteDoneEvent(lastWriteDonePayload);\n  } else {\n    logger.warn('handleRequestWriteDone', '没有可供重播的 writeDone 事件。');\n  }\n}\n","'use strict';\n\nimport {\n  deleteByObject,\n  deleteByPath,\n  handleGetCurrentVars,\n  handleGetSnapshotAtMId,\n  handleGetSnapshotAtMk,\n  handleGetSnapshotsBetweenMIds,\n  handleGetSnapshotsBetweenMks,\n  handleRequestWriteDone,\n  insertByObject,\n  insertByPath,\n  updateByObject,\n  updateByPath,\n} from './handler';\nimport { ERA_API_EVENTS } from '../../../utils/constants';\nimport { EventJob } from '../../merger';\nimport { ActionsTaken, DispatcherPayload } from '../../types';\n\nexport function handleApiEvent(job: EventJob, actionsTaken: ActionsTaken, payload: DispatcherPayload): void {\n  const { type: eventType, detail } = job;\n  actionsTaken.api = true;\n\n  // API 事件是“即发即忘”的，同步调用处理器将任务推入 api.ts 的队列后立即返回，不阻塞事件队列。\n  if (eventType === ERA_API_EVENTS.INSERT_BY_OBJECT) insertByObject(detail);\n  else if (eventType === ERA_API_EVENTS.UPDATE_BY_OBJECT) updateByObject(detail);\n  else if (eventType === ERA_API_EVENTS.INSERT_BY_PATH) insertByPath(detail.path, detail.value);\n  else if (eventType === ERA_API_EVENTS.UPDATE_BY_PATH) updateByPath(detail.path, detail.value);\n  else if (eventType === ERA_API_EVENTS.DELETE_BY_OBJECT) deleteByObject(detail);\n  else if (eventType === ERA_API_EVENTS.DELETE_BY_PATH) deleteByPath(detail.path);\n  else if (eventType === ERA_API_EVENTS.GET_CURRENT_VARS) handleGetCurrentVars(detail);\n  else if (eventType === ERA_API_EVENTS.GET_SNAPSHOT_AT_MK) handleGetSnapshotAtMk(detail);\n  else if (eventType === ERA_API_EVENTS.GET_SNAPSHOTS_BETWEEN_MKS) handleGetSnapshotsBetweenMks(detail);\n  else if (eventType === ERA_API_EVENTS.GET_SNAPSHOT_AT_MID) handleGetSnapshotAtMId(detail);\n  else if (eventType === ERA_API_EVENTS.GET_SNAPSHOTS_BETWEEN_MIDS) handleGetSnapshotsBetweenMIds(detail);\n  else if (eventType === ERA_API_EVENTS.REQUEST_WRITE_DONE) handleRequestWriteDone();\n}\n","/**\n * @file ERA 变量框架 - 变量删除模块\n * @description\n * 该模块负责处理 `<VariableDelete>` 指令，实现对已存在变量的删除，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **指令驱动**: 递归行为由指令对象的结构驱动。空对象 `{}` 表示删除当前节点，非空对象表示递归删除子节点。\n * - **安全第一**: 删除是破坏性操作，因此引入了 `$meta.necessary` 权限机制来防止误删。\n * - **精确豁免**: `necessary` 的保护只有在删除指令明确指向 `necessary` 属性自身时才会被绕过。\n * - **原子性日志**: 为每一次删除生成单一、精确的 `EditLog`，确保操作可完全回滚。\n */\n'use strict';\n\nimport { Logger } from '../../utils/log';\n\nconst logger = new Logger();\n\n/**\n * **【递归删除】**\n * 实现了 `<VariableDelete>` 的核心逻辑，其行为由指令 `patchObj` 的结构驱动。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、与 `basePath` 对应的部分。\n * @param {any[]} editLog - 用于收集变更记录的日志数组。\n */\nfunction applyDeleteAtLevel(statData: any, basePath: string, patchObj: any, editLog: any[]) {\n  // --- 1. 入口守卫和状态获取 ---\n  const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n\n  if (currentNodeInVars === undefined) {\n    logger.warn('applyDeleteAtLevel', `VariableDelete 跳过：路径不存在 -> ${basePath || '(root)'}`, {\n      basePath,\n      patchObj,\n    });\n    return;\n  }\n\n  const necessary = _.get(currentNodeInVars, ['$meta', 'necessary']);\n\n  // 精确判断豁免条件\n  const metaPatch = _.get(patchObj, '$meta');\n  const isBypassingProtection =\n    // 场景1: 指令要删除整个 $meta 对象\n    (_.isPlainObject(metaPatch) && _.isEmpty(metaPatch)) ||\n    // 场景2: 指令明确要删除 $meta.necessary 键\n    _.has(patchObj, ['$meta', 'necessary']);\n\n  // --- 2. 判断意图：递归删除子节点 vs 删除当前节点 ---\n  if (_.isPlainObject(patchObj) && !_.isEmpty(patchObj)) {\n    // **意图：递归删除子节点**\n\n    // 权限检查：如果节点受 'all' 保护，且指令不满足豁免条件，则禁止深入。\n    if (necessary === 'all' && !isBypassingProtection) {\n      logger.warn(\n        'applyDeleteAtLevel',\n        `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: all\" 保护，其子节点无法被删除。`,\n        { basePath, patchObj, currentNodeInVars },\n      );\n      return;\n    }\n\n    // 权限通过，或存在豁免，继续向内递归。\n    for (const key of Object.keys(patchObj)) {\n      const fullPath = basePath ? `${basePath}.${key}` : key;\n      const subPatchObj = patchObj[key];\n      applyDeleteAtLevel(statData, fullPath, subPatchObj, editLog);\n    }\n    return; // 子节点处理完毕，返回。\n  }\n\n  // --- 3. 执行删除当前节点 ---\n  // (能走到这里，说明 patchObj 是空对象、非对象或 null)\n  // **意图：删除当前节点 `basePath`**\n\n  // 权限检查：'self' 或 'all' 都会阻止当前节点的直接删除。\n  // 直接删除节点的意图无法豁免保护，必须通过递归意图删除 '$meta' 来解除保护。\n  if (necessary === 'self' || necessary === 'all') {\n    logger.warn(\n      'applyDeleteAtLevel',\n      `VariableDelete 失败：路径 <${basePath}> 受 \"necessary: ${necessary}\" 保护，无法被直接删除。`,\n      { basePath, patchObj, currentNodeInVars },\n    );\n    return;\n  }\n\n  // 根节点（basePath 为 ''）不应被删除。\n  if (basePath === '') {\n    logger.error('applyDeleteAtLevel', 'VariableDelete 失败：不允许删除根对象。', {\n      patchObj,\n    });\n    return;\n  }\n\n  // 执行原子性删除\n  const valOld = _.cloneDeep(currentNodeInVars);\n  _.unset(statData, basePath);\n  editLog.push({ op: 'delete', path: basePath, value_old: valOld });\n  logger.debug('applyDeleteAtLevel', `成功删除节点: ${basePath}`);\n}\n\n/**\n * **【纯函数】** 处理所有 `<VariableDelete>` 指令块。\n *\n * @param {any[]} allDeletes - 从消息中解析出的所有 delete 指令对象。\n * @param {any} initialStat - 操作开始前的初始 `stat_data` 状态。\n * @returns {Promise<{ finalStat: any, editLog: any[] }>} - 返回一个包含操作完成后的最终状态和生成的编辑日志的对象。\n */\nexport async function processDeleteBlocks(\n  allDeletes: any[],\n  initialStat: any,\n): Promise<{ finalStat: any; editLog: any[] }> {\n  if (!allDeletes || allDeletes.length === 0) {\n    return { finalStat: initialStat, editLog: [] };\n  }\n\n  const currentStat = _.cloneDeep(initialStat);\n  const editLog: any[] = [];\n\n  for (const deleteRoot of allDeletes) {\n    if (!_.isPlainObject(deleteRoot) || _.isEmpty(deleteRoot)) continue;\n    try {\n      logger.debug('processDeleteBlocks', `处理 deleteRoot: ${JSON.stringify(deleteRoot)}`);\n      // 从根路径开始递归\n      applyDeleteAtLevel(currentStat, '', deleteRoot, editLog);\n    } catch (e: any) {\n      logger.error('processDeleteBlocks', `处理 deleteRoot 失败: ${e?.message || e}`, {\n        error: e,\n        deleteRoot,\n        currentStat,\n      });\n    }\n  }\n\n  logger.debug('processDeleteBlocks', '所有 VariableDelete 操作完成');\n  return { finalStat: currentStat, editLog };\n}\n","'use strict';\n\nimport { mergeReplaceArray } from '../../../utils/data';\nimport { Logger } from '../../../utils/log';\n\nconst logger = new Logger();\n\n/**\n * **【解析并合并模板内容】**\n *\n * 从继承的模板内容和父节点变量中定义的模板内容中，合并出当前层级可用的模板。\n *\n * @param inheritedContent - 从上上层继承的模板内容。\n * @param parentNodeData - 当前正在处理的节点的 **父节点** 在变量中的数据。\n * @returns {any} - 合并后的单一内容对象，如果所有来源都无效，则返回 `null`。\n */\nexport function resolveTemplate(inheritedContent: any, parentNodeData: any): any {\n  // 1. 从父节点变量中，找到作为当前节点兄弟的 $template\n  const varsContent = _.get(parentNodeData, '$template');\n\n  logger.debug(\n    'resolveTemplate',\n    `解析出的模板内容:\\n    - 继承: ${JSON.stringify(inheritedContent)}\\n    - 父节点变量: ${JSON.stringify(\n      varsContent,\n    )}`,\n  );\n\n  // 2. 按优先级合并 (父节点变量 > 继承)\n  let mergedContent: any = {};\n  mergedContent = mergeReplaceArray(mergedContent, inheritedContent);\n  mergedContent = mergeReplaceArray(mergedContent, varsContent);\n\n  logger.debug('resolveTemplate', `合并后的最终模板内容: ${JSON.stringify(mergedContent)}`);\n\n  if (_.isEmpty(mergedContent)) {\n    return null;\n  }\n\n  return mergedContent;\n}\n\n/**\n * **【获取子节点要继承的模板内容】**\n *\n * 在一个给定的“父级模板内容”中，查找并合并其内部定义的“原型规则” (`$template`) 和“特异性规则” (`key`)，\n * 以生成供特定子节点 `key` 使用的最终模板内容。\n *\n * @example\n * // 输入:\n * const parentTplContent = {\n *   \"$template\": { \"hp\": 10, \"mana\": 100, \"a\": { \"d\": 1 } },\n *   \"lili\": { \"hp\": 15, \"class\": \"warrior\", \"a\": { \"c\": 1 } }\n * };\n * const key = \"lili\";\n * // 输出 (合并后的内容):\n * // { \"hp\": 15, \"mana\": 100, \"class\": \"warrior\", \"a\": { \"c\": 1, \"d\": 1 } }\n *\n * @param parentTplContent - 父级的模板内容，它本身可能包含 `$template` 和 `key` 作为子键。\n * @param key - 正在处理的子节点的键名。\n * @returns {any} - 子节点应该继承的、已合并的模板内容，或 `undefined`。\n */\nexport function getInheritedTemplateContent(parentTplContent: any, key: string): any {\n  if (!parentTplContent) return undefined;\n\n  // 步骤 1: 在父级模板内容中查找通用的原型规则\n  const prototypeContent = _.get(parentTplContent, '$template');\n\n  // 步骤 2: 在父级模板内容中查找给 key 的特异性规则\n  const specificContent = _.get(parentTplContent, key);\n\n  // 步骤 3: 根据查找结果决定最终模板内容\n  if (_.isPlainObject(prototypeContent) && _.isPlainObject(specificContent)) {\n    logger.debug(\n      'getInheritedTemplateContent',\n      `为子节点 \"${key}\" 同时找到原型和特异性内容。\\n      - 原型: ${JSON.stringify(\n        prototypeContent,\n      )}\\n      - 特异性: ${JSON.stringify(specificContent)}`,\n    );\n    // 直接使用 mergeReplaceArray 进行合并\n    const merged = mergeReplaceArray(_.cloneDeep(prototypeContent), specificContent);\n    logger.debug('getInheritedTemplateContent', `  - 合并后: ${JSON.stringify(merged)}`);\n    return merged;\n  } else if (_.isPlainObject(specificContent)) {\n    logger.debug(\n      'getInheritedTemplateContent',\n      `为子节点 \"${key}\" 只找到特异性内容: ${JSON.stringify(specificContent)}`,\n    );\n    return specificContent;\n  } else if (_.isPlainObject(prototypeContent)) {\n    logger.debug(\n      'getInheritedTemplateContent',\n      `为子节点 \"${key}\" 只找到原型内容: ${JSON.stringify(prototypeContent)}`,\n    );\n    return prototypeContent;\n  }\n\n  logger.debug('getInheritedTemplateContent', `在父级模板内容中未为子节点 \"${key}\" 找到任何可继承的规则。`);\n  return undefined;\n}\n\n/**\n * **【应用模板内容到补丁】**\n *\n * 将一个“模板内容”对象应用到一个“补丁”对象上，作为其默认值。\n *\n * @param tplContent - 当前层级合并后的模板内容。\n * @param patchObj - 要应用模板的补丁数据。\n * @returns {any} - 应用了模板默认值之后，最终合成的数据对象。\n */\nexport function applyTemplateToPatch(tplContent: any, patchObj: any): any {\n  logger.debug(\n    'applyTemplateToPatch',\n    `[进入] 模板内容: ${JSON.stringify(tplContent)}, 补丁: ${JSON.stringify(patchObj)}`,\n  );\n\n  if (!_.isPlainObject(patchObj)) {\n    logger.debug('applyTemplateToPatch', `[退出] 补丁不是一个普通对象，直接返回。`);\n    return patchObj;\n  }\n  if (!tplContent) {\n    logger.debug('applyTemplateToPatch', `[退出] 模板内容无效，直接返回补丁。`);\n    return patchObj;\n  }\n\n  // 如果补丁是空对象，直接使用模板内容\n  if (_.isEmpty(patchObj)) {\n    logger.debug('applyTemplateToPatch', `补丁为空对象，完全使用模板内容。`);\n    return _.cloneDeep(tplContent);\n  }\n\n  // 如果补丁非空，将模板内容作为默认值与补丁合并\n  const composed = mergeReplaceArray(_.cloneDeep(tplContent), patchObj);\n  logger.debug('applyTemplateToPatch', `合并模板与补丁后的结果: ${JSON.stringify(composed)}`);\n  return composed;\n}\n","/**\n * @file ERA 变量框架 - 变量插入模块\n * @description\n * 该模块负责处理 `<VariableInsert>` 指令，实现变量的非破坏性插入，并生成相应的 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **原子性操作**: `applyInsertAtLevel` 实现了原子性的插入，确保了数据结构的完整性。\n *   如果一个基础路径不存在，它会将整个对象作为一整个单元一次性插入。\n * - **容错性**: 当遇到无效路径（如尝试向已存在的路径插入）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n'use strict';\n\nimport { sanitizeArrays } from '../../../utils/data';\nimport { Logger } from '../../../utils/log';\nimport { applyTemplateToPatch, getInheritedTemplateContent, resolveTemplate } from './template';\n\nconst logger = new Logger();\n\n/**\n * **【递归插入】**\n * 实现了 `<VariableInsert>` 的核心逻辑：**非破坏性地**递归插入值。\n *\n * **核心规则**:\n * 1. **只在路径不存在时写入**。如果路径已存在，则跳过该路径的写入。\n * 2. **原子性插入**。如果一个基础路径（如 `player.inventory`）不存在，它会将整个 `inventory`\n *    对象作为一整个单元一次性插入，并只记录一条 `insert` 日志。\n * 3. **递归补充**。如果基础路径已存在，它会递归地深入，尝试在其下补充插入新的子路径。\n * 4. **模板支持**。支持从 `$template` 中继承模板，实现数据结构的复用。\n *\n * @param {any} statData - 状态数据对象 (即 `stat_data`)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 从指令中解析出的、要应用于当前层级的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组（引用传递）。\n * @param {any} inheritedContent - 从上层继承的、纯粹的模板“内容”对象。\n * @param {any} parentData - 当前节点的父节点在 `statData` 中的数据。\n */\nexport function applyInsertAtLevel(\n  statData: any,\n  basePath: string,\n  patchObj: any,\n  editLog: any[],\n  inheritedContent: any,\n  parentData: any, // 新增参数，直接传递父节点数据\n) {\n  // --- 1. 确定当前层级的模板内容 ---\n  // 调用 resolveTemplate，它现在直接使用传入的 parentData\n  const localTplContent = resolveTemplate(inheritedContent, parentData);\n  logger.debug('applyInsertAtLevel', `[入口] basePath: \"${basePath || 'root'}\"`, {\n    statData: _.cloneDeep(statData),\n  });\n\n  // --- 2. 检查路径存在性，决定执行策略 ---\n  const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n  logger.debug(\n    'applyInsertAtLevel',\n    `[路径检查] at path: \"${basePath || 'root'}\". currentNodeInVars 的值:`,\n    currentNodeInVars,\n  );\n\n  // **策略一：原子性插入 (Atomic Insert)**\n  // 如果当前路径在变量中不存在，则将整个补丁对象作为新值一次性插入。\n  if (basePath && currentNodeInVars === undefined) {\n    // 调用 applyTemplateToPatch 函数，将合并后的模板内容应用到补丁上\n    const composed = applyTemplateToPatch(localTplContent, patchObj);\n\n    const finalValue = sanitizeArrays(composed); // 清理数组中的 null 等无效值。\n    logger.debug('applyInsertAtLevel', `最终插入数据 at ${basePath}:\\n${JSON.stringify(finalValue, null, 2)}`);\n    _.set(statData, basePath, finalValue); // 执行插入。\n    editLog.push({ op: 'insert', path: basePath, value_new: _.cloneDeep(finalValue) });\n    logger.debug('applyInsertAtLevel', `原子性插入到新路径: ${basePath}`);\n    return; // 插入完成，终止递归。\n  }\n\n  // **策略二：递归补充 (Recursive Supplement)**\n  // 如果当前路径已存在，并且补丁和当前值都是对象，则深入递归。\n  if (_.isPlainObject(currentNodeInVars) && _.isPlainObject(patchObj)) {\n    logger.debug(\n      'applyInsertAtLevel',\n      `[递归补充] at path: \"${basePath || 'root'}\"\n      - 当前层级模板 (localTplContent): ${JSON.stringify(localTplContent)}`,\n    );\n    for (const key of Object.keys(patchObj)) {\n      const subPath = basePath ? `${basePath}.${key}` : key;\n      const subPatch = patchObj[key];\n      // 调用 getInheritedTemplateContent，从当前模板内容中为子节点查找其应继承的内容\n      const subInheritedContent = getInheritedTemplateContent(localTplContent, key);\n      logger.debug(\n        'applyInsertAtLevel',\n        `  - 准备递归子节点: \"${key}\"\n      - 将传递给子节点的模板 (subInheritedContent): ${JSON.stringify(subInheritedContent)}`,\n      );\n      // 将当前节点数据 currentNodeInVars 作为下一层的 parentData 传递下去\n      applyInsertAtLevel(statData, subPath, subPatch, editLog, subInheritedContent, currentNodeInVars);\n    }\n  } else if (basePath) {\n    // **插入失败**\n    // 如果路径已存在，但不是可递归补充的对象结构（例如，一个是对象，另一个是字符串），\n    // 则记录警告。insert 不会覆盖已存在的值。\n    logger.warn('applyInsertAtLevel', `VariableInsert 失败：路径已存在且无法递归补充 -> ${basePath}`, {\n      basePath,\n      patchObj,\n      currentNodeInVars,\n    });\n  }\n  // 如果 basePath 为空（在根级别）且 patch 不是对象，则不执行任何操作，因为根不能被非对象替换。\n}\n\n/**\n * **【纯函数】** 处理所有 `<VariableInsert>` 指令块。\n *\n * @param {any[]} allInserts - 从消息中解析出的所有 insert 指令对象。\n * @param {any} initialStat - 操作开始前的初始 `stat_data` 状态。\n * @returns {Promise<{ finalStat: any, editLog: any[] }>} - 返回一个包含操作完成后的最终状态和生成的编辑日志的对象。\n */\nexport async function processInsertBlocks(\n  allInserts: any[],\n  initialStat: any,\n): Promise<{ finalStat: any; editLog: any[] }> {\n  if (!allInserts || allInserts.length === 0) {\n    return { finalStat: initialStat, editLog: [] };\n  }\n\n  logger.debug('processInsertBlocks', '[初始状态] 进入 processInsertBlocks 时的 statData:', _.cloneDeep(initialStat));\n\n  const currentStat = _.cloneDeep(initialStat);\n  const editLog: any[] = [];\n\n  /*\n   * 循环处理每个 insertRoot。\n   * 在纯函数模式下，每个 insertRoot 都在上一个 insertRoot 修改后的 `currentStat` 基础上进行操作，\n   * 从而确保了在同一消息内，前一个 <VariableInsert> 块中插入的数据，\n   * 可以被后一个 <VariableInsert> 块访问和使用。\n   */\n  for (const insertRoot of allInserts) {\n    if (!_.isPlainObject(insertRoot) || _.isEmpty(insertRoot)) continue;\n    try {\n      logger.debug('processInsertBlocks', `处理 insertRoot: ${JSON.stringify(insertRoot)}`);\n      // 从根路径 '' 开始统一递归入口，顶层调用时，父节点为 null\n      applyInsertAtLevel(currentStat, '', insertRoot, editLog, null, null);\n    } catch (e: any) {\n      logger.error('processInsertBlocks', `处理 insertRoot 失败: ${e?.message || e}`, {\n        error: e,\n        insertRoot,\n        currentStat,\n      });\n    }\n  }\n\n  logger.debug('processInsertBlocks', '所有 VariableInsert 操作完成');\n  return { finalStat: currentStat, editLog };\n}\n","/**\n * @file ERA 变量框架 - 变量编辑模块\n * @description\n * 该模块负责处理 `<VariableEdit>` 指令，实现对已存在变量的修改，并生成用于回滚的精确 `EditLog`。\n *\n * **设计理念**:\n * - **职责单一**: 模块只关心如何根据指令修改变量状态并生成日志，不关心指令从何而来。\n * - **精确日志**: `EditLog` 的准确性是回滚功能的基础。`applyEditAtLevel` 通过精巧的逻辑，\n *   特别是对“旧值”的历史追溯，确保了日志的绝对可靠。\n * - **容错性**: 当遇到无效路径（如尝试编辑不存在的路径）时，会跳过该条指令并继续处理其他有效指令，\n *   而不是中断整个写入过程。\n */\n'use strict';\n\nimport { LOGS_PATH, SEL_PATH } from '../../utils/constants';\nimport { sanitizeArrays } from '../../utils/data';\nimport { Logger } from '../../utils/log';\nimport { findLatestNewValue } from '../timetravel';\n\nconst logger = new Logger();\n\n/**\n * **【内部辅助函数 | 递归编辑】**\n * 实现了 `<VariableEdit>` 的核心逻辑：**只修改已存在的路径**。\n *\n * **核心规则**:\n * 1. **路径必须存在**。如果指令中指定的路径在当前变量状态中不存在，则跳过该操作。\n * 2. **叶子节点操作**。只在遇到指令对象中的叶子节点（非对象值）时才执行实际的修改和日志记录。\n * 3. **精确的旧值查找**。为了生成可供回滚的 `EditLog`，它需要找到变量在本次修改发生**之前**的“旧值”。\n *    查找顺序为：首先通过 `findLatestNewValue` 在历史 `EditLog` 中回溯；如果找不到，\n *    则从当前消息处理开始时的变量快照中获取。这是确保日志准确性的关键。\n *\n * @param {any} statData - 要修改的状态数据对象 (会直接被修改)。\n * @param {string} basePath - 当前递归层级的基础路径。\n * @param {any} patchObj - 要应用的补丁对象。\n * @param {any[]} editLog - 用于收集变更记录的日志数组 (会直接被修改)。\n * @param {number} messageId - 当前正在处理的消息的 ID，用于历史追溯。\n * @param {string[]} selectedMks - 完整的、有序的 MK 序列。\n * @param {{ [mk: string]: string }} allLogs - 包含所有 EditLog 的对象。\n */\nasync function applyEditAtLevel(\n  statData: any,\n  basePath: string,\n  patchObj: any,\n  editLog: any[],\n  messageId: number,\n  selectedMks: (string | null)[],\n  allLogs: { [mk: string]: string },\n) {\n  // --- 1. 路径和存在性检查 ---\n  const currentNodeInVars = basePath ? _.get(statData, basePath) : statData;\n  if (currentNodeInVars === undefined) {\n    logger.warn('applyEditAtLevel', `VariableEdit 跳过：路径不存在 -> ${basePath || '(root)'}`, {\n      basePath,\n      patchObj,\n    });\n    return;\n  }\n\n  // --- 2. 权限检查 (`updatable`) ---\n  // 读取 updatable 标志，如果未定义，则默认为 true (允许更新)。\n  const isUpdatable = _.get(currentNodeInVars, ['$meta', 'updatable'], true);\n\n  // 定义豁免条件：只有当指令明确要将 updatable 从 false 改为 true 时，才允许操作。\n  const isBypassingProtection =\n    isUpdatable === false && // 当前是受保护的\n    _.get(patchObj, ['$meta', 'updatable']) === true; // 且指令意图是明确地将其改为 true\n\n  // 如果受保护且不满足豁免条件，则阻止整个子树的更新。\n  if (isUpdatable === false && !isBypassingProtection) {\n    logger.warn(\n      'applyEditAtLevel',\n      `VariableEdit 失败：路径 <${basePath}> 受 \"$meta.updatable: false\" 保护，无法被修改。`,\n      { basePath, patchObj, currentNodeInVars },\n    );\n    return; // 终止此分支的递归。\n  }\n\n  // --- 3. 递归或执行 ---\n  // 遍历指令的键，以驱动递归。\n  for (const key of Object.keys(patchObj)) {\n    const subPath = basePath ? `${basePath}.${key}` : key;\n    const valNew = patchObj[key];\n\n    // **策略一：递归深入**\n    // 如果指令的值是对象，则继续向内递归。\n    if (_.isPlainObject(valNew)) {\n      await applyEditAtLevel(statData, subPath, valNew, editLog, messageId, selectedMks, allLogs);\n      continue; // 继续处理下一个键。\n    }\n\n    // **策略二：执行更新 (叶子节点)**\n    // 只有当指令的值不是对象时，才执行更新操作。\n\n    // 路径合法性检查：确保要写入的完整路径是存在的。\n    if (!_.has(statData, subPath)) {\n      logger.warn('applyEditAtLevel', `VariableEdit 失败：路径非法，无法写入 -> ${subPath}`, {\n        subPath,\n        valNew,\n        statData,\n      });\n      continue;\n    }\n\n    // a. 查找旧值 (`valOld`)\n    // 这是确保回滚准确性的核心。\n    logger.debug('applyEditAtLevel', `[旧值查找] 准备为路径 <${subPath}> 从消息 ID <${messageId}> 向上追溯...`);\n    let valOld = findLatestNewValue(subPath, messageId, selectedMks, allLogs);\n    if (valOld === null) {\n      // 如果历史追溯未找到，则从当前（可能已被本轮其他指令修改过的）statData 中获取。\n      // 这确保了在同一个 <VariableEdit> 块内对同一变量的连续修改能正确记录旧值。\n      valOld = _.get(statData, subPath);\n      logger.debug(\n        'applyEditAtLevel',\n        `[旧值查找] 追溯未找到历史值，从当前 stat_data 中获取到旧值: ${JSON.stringify(valOld)}`,\n      );\n    } else {\n      logger.debug('applyEditAtLevel', `[旧值查找] 追溯成功，找到历史旧值: ${JSON.stringify(valOld)}`);\n    }\n\n    const cleaned = sanitizeArrays(valNew); // 清理新值\n\n    // b. 记录编辑意图\n    // 即使新旧值相同，也记录 EditLog，以完整反映作者的编辑意图。\n    // 这对于调试和历史追溯非常有用。\n    _.set(statData, subPath, cleaned);\n    editLog.push({\n      op: 'update',\n      path: subPath,\n      value_old: _.cloneDeep(valOld),\n      value_new: _.cloneDeep(cleaned),\n    });\n  }\n}\n\n/**\n * 处理所有 `<VariableEdit>` 指令块，并返回修改后的状态和日志。\n * 这是一个纯函数，它接收初始状态并返回一个全新的结果对象，不会修改任何外部状态。\n *\n * @param {any[]} allEdits - 从消息中解析出的所有 edit 指令对象。\n * @param {number} messageId - 当前正在处理的消息的 ID。\n * @param {any} initialStat - 操作开始前的初始 `stat` 对象。\n * @param {any} meta - 包含 `selectedMks` 和 `allLogs` 的元数据对象。\n * @returns {Promise<{ finalStat: any, editLog: any[] }>} 一个包含最终状态和生成日志的对象。\n */\nexport async function processEditBlocks(\n  allEdits: any[],\n  messageId: number,\n  initialStat: any,\n  meta: any,\n): Promise<{ finalStat: any; editLog: any[] }> {\n  if (!allEdits || allEdits.length === 0) {\n    return { finalStat: _.cloneDeep(initialStat), editLog: [] };\n  }\n\n  // 创建初始状态的深拷贝，以避免副作用。\n  const finalStat = _.cloneDeep(initialStat);\n  const editLog: any[] = [];\n\n  const selectedMks: string[] = _.get(meta, SEL_PATH, []);\n  const allLogs: { [mk: string]: string } = _.get(meta, LOGS_PATH, {});\n\n  // 遍历所有 <VariableEdit> 指令块。\n  for (const editRoot of allEdits) {\n    if (!_.isPlainObject(editRoot) || _.isEmpty(editRoot)) continue;\n    try {\n      logger.debug('processEditBlocks', `处理 editRoot: `, editRoot);\n      // 从根路径 '' 开始统一递归入口，保持逻辑一致性。\n      // applyEditAtLevel 会直接修改 finalStat 和 editLog。\n      await applyEditAtLevel(finalStat, '', editRoot, editLog, messageId, selectedMks, allLogs);\n    } catch (e: any) {\n      logger.error('processEditBlocks', `处理 editRoot 失败: ${e?.message || e}`, {\n        error: e,\n        editRoot,\n        finalStat,\n      });\n    }\n  }\n\n  logger.debug('processEditBlocks', '所有 VariableEdit 操作完成');\n  return { finalStat, editLog };\n}\n","/**\n * @file ERA 变量框架 - 变量写入模块\n * @description\n * 该模块是 ERA 框架的“执行引擎”，负责将消息内容中的变量修改指令应用到实际的 `chat` 变量中。\n *\n * **设计理念**:\n * 变量的写入是一个严谨的过程，必须确保所有变更都被正确记录，以便后续的回滚和同步。\n * 此模块的核心职责是：\n * 1. **解析指令**: 从 AI 消息中提取 `<VariableInsert>` 和 `<VariableEdit>` 块。\n * 2. **顺序执行**: 确保同一消息内的多个指令块按顺序执行，且后续指令能感知到前面指令的结果。\n * 3. **生成日志**: 在应用变更的同时，调用 `recursive.ts` 中的递归函数来生成精确的 `EditLog`。\n * 4. **覆盖式日志写入**: 确保每个消息密钥（MK）对应的 `EditLog` 严格反映其当前内容，\n *    即使内容中没有任何指令（此时会写入空日志），也要覆盖旧日志，这是防止 `swipe` 造成数据污染的关键。\n *\n * **职责边界**:\n * - 本模块**只负责读取 MK**，不负责创建。创建 MK 的职责由上游的 `message_key.ts` 承担。\n * - `ApplyVarChangeForMessage` 函数**只负责写入变量和 `EditLog`**，不负责更新 `SelectedMks`。\n *   更新 `SelectedMks` 的职责被移交给了更上层的调用者（如 `ApplyVarChange` 或同步函数），\n *   以避免在同步循环中修改正在被读取的状态，这是一种重要的并发控制策略。\n */\n\n'use strict';\n\nimport { readMessageKey } from '../../core/key/mk';\nimport { EraConfig, LOGS_PATH, SEL_PATH } from '../../utils/constants';\nimport { parseEditLog } from '../../utils/data';\nimport { getEraData, updateEraMetaData, updateEraStatData } from '../../utils/era_data';\nimport { Logger } from '../../utils/log';\nimport { extractAndParseCommands, findLastAiMessage, isUserMessage } from '../../utils/message';\nimport { processDeleteBlocks } from './delete';\nimport { processInsertBlocks } from './insert/insert';\nimport { processEditBlocks } from './update';\n\nconst logger = new Logger();\n\n/**\n * **【核心计算函数 - 纯粹】**\n *\n * **设计理念**:\n * 这是一个纯函数，是整个变量修改流程的计算核心。它遵循“输入决定输出”的原则，不执行任何读写全局状态的副作用。\n * 它的职责非常单一：接收一条消息和当前的状态，然后计算出这条消息会如何改变这个状态，并返回最终结果。\n *\n * **调用者职责**:\n * 调用此函数的外部代码（如 `ApplyVarChange` 或 `resyncStateOnHistoryChange`）必须负责：\n * 1. **准备输入**: 在调用前，获取有效的消息对象 `msg`、初始状态 `initialStat` 和元数据 `meta`。\n * 2. **处理输出**: 接收函数返回的 `{ finalStat, finalEditLog }`，并负责将这些结果写入到全局状态中\n *    （例如，通过 `updateEraStatData` 和 `updateEraMetaData`）。\n *\n * @param {any} msg - 要处理的酒馆消息对象。\n * @param {any} initialStat - 操作开始前的 `stat_data`。\n * @param {any} meta - 包含 `EditLogs` 和 `SelectedMks` 的元数据对象。\n * @returns {Promise<{ finalStat: any; finalEditLog: any[] }>} 返回计算出的最终状态和为该消息生成的 EditLog。\n */\nexport const ApplyVarChangeForMessage = async (\n  msg: any,\n  initialStat: any,\n  meta: any,\n  config: Partial<EraConfig> = {},\n): Promise<{ finalStat: any; finalEditLog: any[]; mk: string | null }> => {\n  logger.debug('ApplyVarChangeForMessage (Pure)', `开始计算消息 (ID: ${msg.message_id})...`);\n  const mk = readMessageKey(msg);\n  try {\n    // 1. 从消息中提取、解析并转义所有指令。\n    const { allInserts, allEdits, allDeletes } = extractAndParseCommands(msg, config.繁体转简体);\n\n    // --- 纯函数处理流水线：insert -> edit -> delete ---\n\n    // 2. 处理插入操作\n    const { finalStat: statAfterInsert, editLog: insertLog } = await processInsertBlocks(allInserts, initialStat);\n\n    // 3. 处理编辑操作\n    const { finalStat: statAfterEdit, editLog: editBlockLog } = await processEditBlocks(\n      allEdits,\n      msg.message_id,\n      statAfterInsert,\n      meta,\n    );\n\n    // 4. 处理删除操作\n    const { finalStat: statAfterDelete, editLog: deleteLog } = await processDeleteBlocks(allDeletes, statAfterEdit);\n\n    // 5. 合并所有日志\n    const finalEditLog = [...(insertLog || []), ...(editBlockLog || []), ...(deleteLog || [])];\n\n    // 6. 返回计算结果\n    return { finalStat: statAfterDelete, finalEditLog, mk };\n  } catch (err: any) {\n    logger.error('ApplyVarChangeForMessage (Pure)', `变量计算异常: ${err?.message || err}`, {\n      error: err,\n      message: msg,\n      initialStat,\n      meta,\n    });\n    // 在异常情况下，返回未修改的初始状态和空日志，以防止破坏后续流程。\n    return { finalStat: initialStat, finalEditLog: [], mk };\n  }\n};\n","'use strict';\n\n/**\n * @file 状态同步核心\n * @description 本文件中的 `resyncStateOnHistoryChange` 是 ERA 变量框架最核心的函数之一。\n * 它通过实现“逆序回滚，顺序重算”的逻辑，解决了因消息删除、切换分支 (swipe) 等操作导致的变量状态与消息历史不一致的棘手问题。\n *\n * ### 酒馆的奇特行为 (Feature, not a bug)\n *\n * 当删除一条 swipe (例如，带有变量 id=2 的消息) 时：\n * 1. **内容与变量错位**: 后一条 swipe (id=3) 的**内容**会“顶”到被删除的 swipe (id=2) 的位置上，但**变量**却保留了 id=2 的变量。\n * 2. **孤儿变量残留**: 原本的 swipe 3 消息虽然在界面上消失了，但它对应的**消息变量** (id=3) 仍然残留在聊天数据中，成为“孤儿变量”。\n * 3. **孤儿变量继承**: 如果用户此时再 swipe 一次，新生成的 swipe 3 将会**继承**这个残留的孤儿变量 (id=3)，导致新内容配旧变量，进一步加剧状态混乱。\n * 4. **结果**: 我们得到了一个内容是 id=3、变量是 id=2 的“混合”消息，并且还有一个 id=3 的孤儿变量随时可能被新消息继承，造成严重的状态不一致。\n *\n * ### 本函数的解决策略\n *\n * `resyncStateOnHistoryChange` 通过全面的状态比对来解决此问题：\n * 1. 在 `message_deleted`, `message_swiped` 等事件触发时被调用。\n * 2. 全面获取当前实际的消息列表，并与之前记录的 `SelectedMks` 序列进行比对。\n * 3. 精确找到第一个不一致的点（无论是删除、还是修改）。\n * 4. **逆序回滚**: 从后往前，将所有不一致的 `MK` 所引入的变量修改全部撤销。\n * 5. **顺序重算**: 从不一致点开始，根据当前消息的**实际内容**，重新计算并写入变量。\n *\n * **最终效果**: 无论历史记录发生何种变化，变量状态都能被完美地自动修复，确保数据一致性。\n */\n\nimport { LOGS_PATH, SEL_PATH } from '../utils/constants';\nimport { parseEditLog } from '../utils/data';\nimport { getEraData, getScriptSettings, updateEraMetaData, updateEraStatData } from '../utils/era_data';\nimport { Logger } from '../utils/log';\nimport { ApplyVarChangeForMessage } from './crud/patcher';\nimport { readMessageKey } from './key/mk';\nimport { rollbackStatToMK } from './timetravel';\n\nconst logger = new Logger();\n\n/**\n * 获取用于变量操作的MK。如果消息是用户消息，则返回null以跳过操作。\n * @param msg 消息对象\n * @returns MK 字符串或 null\n */\nconst getMkFromMsg = (msg: any): string | null => {\n  const key = readMessageKey(msg);\n  if (!key) return null;\n\n  return key;\n};\n\n/**\n * 检查一组 MK 对应的 EditLog 是否都为空\n * @param mks MK 列表\n * @param metaData 要检查的元数据对象\n * @returns 如果所有 EditLog 都为空则返回 true\n */\nconst checkEditLogsAreEmpty = (mks: (string | null)[], metaData: any): boolean => {\n  for (const mk of mks) {\n    if (!mk) continue; // 跳过 null (用户消息)\n    const editLogRaw = _.get(metaData, [LOGS_PATH, mk]);\n    const editLog = parseEditLog(editLogRaw);\n    if (editLog.length > 0) {\n      return false; // 发现一个非空 log，直接返回 false\n    }\n  }\n  return true; // 所有 log 都为空\n};\n\n/**\n * 比较当前消息历史与最后已知状态，以找到分歧的第一个点。\n * 这决定了变量应从何处开始重新计算。\n * 它还包括一个优化，如果仅删除了没有变量更改的消息，则执行“快速同步”。\n *\n * @param allMessages 当前所有消息的列表。\n * @param oldSelectedMks 上次同步状态下的消息密钥 (MK) 列表。\n * @param initialMeta 上次同步状态下的元数据，用于检查 EditLogs。\n * @param forceFullResync 如果为 true，则强制从头开始重新计算。\n * @returns 一个描述所需操作的对象。\n */\nconst findDivergencePoint = (\n  allMessages: any[],\n  oldSelectedMks: (string | null)[],\n  initialMeta: any,\n  forceFullResync: boolean,\n): { type: 'FULL_RECALC'; recalcId: number } | { type: 'FAST_SYNC'; newSelectedMks: (string | null)[] } => {\n  if (forceFullResync) {\n    logger.log('findDivergencePoint', '强制模式：设置重算起点为 0。');\n    return { type: 'FULL_RECALC', recalcId: 0 };\n  }\n\n  const currentMks = allMessages.map(getMkFromMsg);\n\n  // 1. 首先，无条件找到第一个分歧点\n  let firstMismatch = -1;\n  const minLength = Math.min(currentMks.length, oldSelectedMks.length);\n  for (let i = 0; i < minLength; i++) {\n    if (currentMks[i] !== oldSelectedMks[i]) {\n      firstMismatch = i;\n      break;\n    }\n  }\n  if (firstMismatch === -1 && currentMks.length !== oldSelectedMks.length) {\n    firstMismatch = minLength;\n  }\n\n  // 2. 处理“无分歧”的情况\n  if (firstMismatch === -1) {\n    const recalcId = allMessages.length > 0 ? allMessages.length - 1 : 0;\n    logger.log('findDivergencePoint', `所有MK均匹配。启动模拟写入，强制重算最后一条消息 (ID: ${recalcId})。`);\n    return { type: 'FULL_RECALC', recalcId };\n  }\n\n  // 3. 处理“有分歧”的情况\n  const deletedMks = _.difference(oldSelectedMks, currentMks);\n  const addedMks = _.difference(currentMks, oldSelectedMks);\n\n  // 唯一的优化机会：纯粹的无害删除\n  if (addedMks.length === 0 && deletedMks.length > 0 && checkEditLogsAreEmpty(deletedMks, initialMeta)) {\n    logger.log('findDivergencePoint', '检测到纯粹的无害删除。建议执行快速同步。');\n    return { type: 'FAST_SYNC', newSelectedMks: currentMks };\n  }\n\n  // 所有其他情况（有害删除、有新增、混合更改）都必须从最早的分歧点重算\n  logger.log('findDivergencePoint', `检测到需要分歧点重算。将从最早的分歧点 (ID: ${firstMismatch}) 开始。`);\n  return { type: 'FULL_RECALC', recalcId: firstMismatch };\n};\n\n/**\n * 当聊天记录发生变化（删除、切换分支）时，重新同步状态的核心函数\n * 实现了“逆序回滚，顺序重算”的逻辑。\n * 在没有检测到历史变化时，该函数还会自动回滚并重算最后一条消息，从而实现了“写入”操作的统一。\n * @param {boolean} [forceFullResync=false] - 如果为 true，则强制从头开始完全重算，忽略差异检测。\n */\nexport const resyncStateOnHistoryChange = async (forceFullResync = false) => {\n  try {\n    if (forceFullResync) {\n      logger.warn('resyncStateOnHistoryChange', '强制完全重算模式已启动！');\n    } else {\n      logger.log('resyncStateOnHistoryChange', '聊天记录变更，启动状态同步...');\n    }\n\n    // 获取脚本设置并构建 config\n    const settings = getScriptSettings();\n    const config = {\n      繁体转简体: settings.繁体转简体,\n    };\n\n    // 核心假设：getChatMessages 会重新生成 message_id，使其保持从 0 开始的连续序列。\n    const allMessages = getChatMessages('0-{{lastMessageId}}', { include_swipes: true });\n    logger.debug('resyncStateOnHistoryChange', '获取到的 allMessages:', allMessages);\n\n    // 在函数开始时一次性获取所有数据\n    const { stat: initialStat, meta: initialMeta } = getEraData();\n    // oldSelectedMks 从 initialMeta 派生\n    const oldSelectedMks: (string | null)[] = _.cloneDeep(_.get(initialMeta, SEL_PATH, []));\n\n    logger.debug(\n      'resyncStateOnHistoryChange',\n      `状态快照: oldSelectedMks.length=${oldSelectedMks.length}, allMessages.length=${allMessages?.length ?? 0}`,\n    );\n\n    if (!allMessages || allMessages.length === 0) {\n      logger.log('resyncStateOnHistoryChange', '当前聊天记录为空，不执行任何操作，同步终止。');\n      return;\n    }\n\n    // 1. 找出分歧点\n    const divergence = findDivergencePoint(allMessages, oldSelectedMks, initialMeta, forceFullResync);\n\n    // 2. 处理分歧结果\n    if (divergence.type === 'FAST_SYNC') {\n      logger.log('resyncStateOnHistoryChange', '执行快速同步...');\n      await updateEraMetaData(meta => {\n        _.set(meta, SEL_PATH, divergence.newSelectedMks);\n        return meta;\n      });\n      logger.log('resyncStateOnHistoryChange', '快速同步完成，仅修正 SelectedMks 数组。');\n      return;\n    }\n\n    const firstRecalcId = divergence.recalcId;\n\n    // 3. 执行逆序回滚（内存中）\n    // 确定重算的起始状态。默认为初始状态。\n    let statForRecalc = initialStat;\n    if (firstRecalcId > -1 && firstRecalcId < oldSelectedMks.length) {\n      const allLogs: { [mk: string]: string } = _.get(initialMeta, LOGS_PATH, {});\n      const currentMK = oldSelectedMks[oldSelectedMks.length - 1];\n      const targetMK = firstRecalcId > 0 ? oldSelectedMks[firstRecalcId - 1] : undefined;\n\n      if (currentMK) {\n        logger.log('resyncStateOnHistoryChange', `准备一次性回滚。从: ${currentMK}, 到: ${targetMK || '初始状态'}`);\n        // 回滚结果作为重算的起点\n        statForRecalc = rollbackStatToMK(targetMK, currentMK, initialStat, oldSelectedMks, allLogs);\n        logger.log('resyncStateOnHistoryChange', '逆序回滚完成（内存中）。');\n      }\n    }\n\n    // 4. 从不匹配点开始，顺序重新应用变量修改，并构建新的 selectedMks\n    logger.log('resyncStateOnHistoryChange', `从 ID ${firstRecalcId} 开始顺序重算...`);\n    const newSelectedMks: (string | null)[] = oldSelectedMks.slice(0, firstRecalcId); // 继承匹配部分\n\n    // 为重算过程创建一个 meta 的可变副本\n    const metaForRecalc = _.cloneDeep(initialMeta);\n\n    for (let i = firstRecalcId; i < allMessages.length; i++) {\n      const msg = allMessages[i];\n\n      // --- 关键修复 ---\n      // 为本次计算创建一个拥有正确历史范围的“上下文元数据”。\n      // 1. 继承到目前为止已重算的所有日志。\n      const contextMeta = _.cloneDeep(metaForRecalc);\n      // 2. 关键：将上下文中的 selectedMks 严格限制为当前消息之前的部分。\n      //    newSelectedMks 在每次循环开始时，都代表了从 0 到 i-1 的正确历史。\n      _.set(contextMeta, SEL_PATH, newSelectedMks.slice(0, i));\n      // --- 修复结束 ---\n\n      // 使用这个有正确作用域的上下文来调用纯函数\n      const { finalStat, finalEditLog, mk } = await ApplyVarChangeForMessage(msg, statForRecalc, contextMeta, config);\n\n      newSelectedMks[i] = mk; // 记录当前消息的 MK\n      logger.debug('resyncStateOnHistoryChange', `[重算] 正在处理消息索引: ${i}, MK: ${mk}`);\n\n      if (!mk) {\n        logger.debug('resyncStateOnHistoryChange', `消息 (ID: ${i}) 无 MK，跳过变量计算。`);\n        continue; // 如果是用户消息等，则跳过\n      }\n\n      // 更新状态，为下一次循环做准备\n      statForRecalc = finalStat;\n      // 将新生成的日志写入主 metaForRecalc 对象，为下一次循环的 clone 做准备\n      _.set(metaForRecalc, [LOGS_PATH, mk], finalEditLog);\n    }\n    logger.log('resyncStateOnHistoryChange', '顺序重算完成。');\n\n    // 5. 循环结束后，一次性将最终计算出的状态写入全局\n    // statForRecalc 已经是最终的 stat\n    // metaForRecalc 包含了正确的日志，我们只需要更新 SEL_PATH\n    _.set(metaForRecalc, SEL_PATH, newSelectedMks);\n\n    await updateEraStatData(() => statForRecalc);\n    await updateEraMetaData(() => metaForRecalc);\n    logger.log('resyncStateOnHistoryChange', '状态同步完成。');\n  } catch (error: any) {\n    logger.error('resyncStateOnHistoryChange', `状态同步时发生严重错误: ${error?.message || error}`, {\n      error,\n      forceFullResync,\n      eraData: getEraData(),\n      allMessages: getChatMessages('0-{{lastMessageId}}', { include_swipes: true }),\n    });\n  }\n};\n","/**\n * @file 强制宏渲染模块\n * @description 通过模拟用户UI操作, 强制酒馆重新渲染消息, 以触发完整的宏替换。\n */\n\nimport { Logger } from '../utils/log';\n\nconst log = new Logger();\n\n/*\n * 强制重新渲染单条消息 (UI事件模拟备份)。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在模拟点击完成后 resolve。\n */\n// function forceRenderMessage_backup_by_UI_event(messageId: number): Promise<void> {\n//   return new Promise(resolve => {\n//     const messageSelector = `div.mes[mesid=\"${messageId}\"]`;\n//     const $message = $(messageSelector);\n//\n//     if ($message.length === 0) {\n//       log.warn('forceRenderMessage_backup_by_UI_event', `找不到消息ID为 ${messageId} 的div。`);\n//       return resolve();\n//     }\n//\n//     const { state, buttons } = analyzeMessageUI($message);\n//\n//     if (state === 'editing') {\n//       // 如果已经是编辑状态，直接点击取消\n//       buttons.cancelEdit?.trigger('click');\n//       log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 处于编辑状态，已点击取消。`);\n//       setTimeout(resolve, 50);\n//     } else {\n//       // 如果是常规状态，先点击编辑，再点击取消\n//       buttons.edit?.trigger('click');\n//       log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 处于常规状态，已点击编辑。`);\n//       setTimeout(() => {\n//         // 重新分析以获取新状态下的按钮\n//         const { buttons: updatedButtons } = analyzeMessageUI($message);\n//         updatedButtons.cancelEdit?.trigger('click');\n//         log.debug('forceRenderMessage_backup_by_UI_event', `消息 ${messageId} 已点击取消。`);\n//         resolve();\n//       }, 50);\n//     }\n//   });\n// }\n\n/**\n * 强制重新渲染单条消息。\n * @param messageId 要强制渲染的消息ID。\n * @returns 一个 Promise, 在操作完成后 resolve。\n */\nasync function forceRenderMessage(messageId: number): Promise<void> {\n  const messages = getChatMessages(messageId);\n\n  if (!messages || messages.length === 0) {\n    log.warn('forceRenderMessage', `找不到消息ID为 ${messageId} 的消息。`);\n    return;\n  }\n\n  const message = messages[0];\n\n  // 使用 setChatMessages 并传入原封不动的消息内容来触发刷新\n  await setChatMessages([{ message_id: messageId, message: message.message }]);\n  log.debug('forceRenderMessage', `已使用 setChatMessages 刷新消息 ${messageId}。`);\n}\n\n/**\n * 强制重新渲染最近的N条消息, 以确保宏被正确替换。\n * 是否执行以及渲染的数量由脚本变量控制。\n */\nexport async function forceRenderRecentMessages() {\n  const scriptVars = getVariables({ type: 'script', script_id: getScriptId() });\n\n  // 检查是否启用了强制重载功能\n  const forceReload = _.get(scriptVars, '强制重载功能', false);\n  if (!forceReload) {\n    log.debug('forceRenderRecentMessages', '强制重载功能未启用, 跳过。');\n    return; // 如果未启用，则不执行任何操作\n  }\n\n  // 获取要重载的消息数量，默认为1\n  const messageCount = _.get(scriptVars, '强制重载消息数', 1);\n  log.log('forceRenderRecentMessages', `开始强制重载, 数量: ${messageCount}`);\n\n  // 等待一小段时间, 确保变量更新已经完成\n  await new Promise(resolve => setTimeout(resolve, 1000));\n\n  const allMessages = getChatMessages('0-{{lastMessageId}}');\n  if (!allMessages || allMessages.length === 0) {\n    log.warn('forceRenderRecentMessages', '无法获取到任何消息, 终止重载。');\n    return;\n  }\n\n  // 根据脚本变量设置的数量来截取最近的消息\n  const recentMessages = allMessages.slice(-messageCount);\n\n  for (const message of recentMessages) {\n    log.debug('forceRenderRecentMessages', `正在强制渲染消息: ${message.message_id}`);\n    await forceRenderMessage(message.message_id);\n    // 在每次操作之间短暂暂停, 避免操作过快导致UI问题。\n    await new Promise(resolve => setTimeout(resolve, 100));\n  }\n  log.log('forceRenderRecentMessages', '强制重载完成。');\n}\n","'use strict';\n\nimport { updateLatestSelectedMk } from '../../core/key/mk';\nimport { resyncStateOnHistoryChange } from '../../core/sync';\nimport { forceRenderRecentMessages } from '../../ui/patch';\nimport { Logger } from '../../utils/log';\nimport { emitWriteDoneEvent } from '../emitters/events';\nimport { EventJob } from '../merger';\nimport { ActionsTaken, DispatcherPayload } from '../types';\n\nconst logger = new Logger();\n\nexport async function handleSyncEvent(\n  job: EventJob,\n  actionsTaken: ActionsTaken,\n  payload: DispatcherPayload,\n): Promise<void> {\n  const { type: eventType } = job;\n  logger.debug('handleSyncEvent', `事件 ${eventType} 触发状态同步流程...`);\n  const isFullSync = eventType === 'manual_full_sync';\n  await resyncStateOnHistoryChange(isFullSync);\n  actionsTaken.resync = true;\n  // 在同步完成后，强制重新渲染消息以触发宏\n  if (eventType != 'combo_sync') forceRenderRecentMessages();\n\n  // 更新状态并发送事件\n  await updateLatestSelectedMk();\n  emitWriteDoneEvent(payload);\n}\n","'use strict';\n\nimport { ensureMkForLatestMessage } from '../core/key/mk';\nimport { initializeExternalSettings } from '../initer/auto/settings';\nimport { ensurePlaceholder } from '../macro/placeholder';\nimport { logContext, Logger } from '../utils/log';\nimport { getMessageContentWithRetry } from '../utils/message';\nimport { handleApiEvent } from './handlers/api/dispatcher';\nimport { handleSyncEvent } from './handlers/sync';\nimport { handleUpdateMkOnlyEvent } from './handlers/updateMkOnly';\nimport { EventJob, getEventGroup } from './merger';\nimport { ActionsTaken, DispatcherPayload } from './types';\n\nconst logger = new Logger();\n\n/**\n * @constant {number} RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION\n * @description 当 `ensureMessageKey` 注入一个新的 MK 后，需要忽略的由该操作触发的 `character_message_rendered` 事件的数量。\n * 通常设置为 1，因为一次消息内容更新通常只会触发一次渲染事件。\n */\nconst RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION = 1;\n\n/**\n * @interface IgnoreRule\n * @description 定义了因 MK 注入而需要忽略后续渲染事件的规则。\n */\nexport interface IgnoreRule {\n  mk: string;\n  ignoreCount: number;\n}\n\n/**\n * @interface ConsecutiveMkState\n * @description 定义了用于追踪同一个 MK 被连续处理次数的状态。\n */\nexport interface ConsecutiveMkState {\n  mk: string | null;\n  count: number;\n}\n\n/**\n * @var {ConsecutiveMkState | null} consecutiveMkState\n * @description 追踪同一个 MK 被连续处理次数的状态。\n * **作用域**: 跨批次持久化。在整个脚本生命周期内，记录字面意义上的“上一次”执行的 MK。\n */\nlet consecutiveMkState: ConsecutiveMkState | null = null;\n\n/**\n * **【辅助函数】处理由 MK 注入触发的冗余渲染事件**\n * @param eventType - 当前事件的类型。\n * @param currentMk - 当前消息的 MK。\n * @param mkToIgnore - 当前的忽略规则。\n * @returns {{ shouldSkip: boolean; newIgnoreRule: IgnoreRule | null }} - 返回是否应跳过此事件，以及更新后的忽略规则。\n */\nfunction handleRedundantRenderEvent(\n  eventType: string,\n  currentMk: string | null,\n  mkToIgnore: IgnoreRule | null,\n): { shouldSkip: boolean; newIgnoreRule: IgnoreRule | null } {\n  if (mkToIgnore && eventType === tavern_events.CHARACTER_MESSAGE_RENDERED && currentMk === mkToIgnore.mk) {\n    logger.debug(\n      'handleRedundantRenderEvent',\n      `忽略由 MK (${mkToIgnore.mk}) 注入触发的冗余渲染事件。剩余忽略次数: ${mkToIgnore.ignoreCount - 1}`,\n    );\n    mkToIgnore.ignoreCount--;\n    if (mkToIgnore.ignoreCount <= 0) {\n      mkToIgnore = null; // 忽略次数用完，重置\n      logger.debug('handleRedundantRenderEvent', `忽略次数用完`);\n    }\n    return { shouldSkip: true, newIgnoreRule: mkToIgnore };\n  }\n  return { shouldSkip: false, newIgnoreRule: mkToIgnore };\n}\n\n/**\n * **【辅助函数】更新连续处理计数**\n * @returns {number} - 返回更新后的连续处理次数。\n */\nfunction updateConsecutiveMkCount(): number {\n  const mk = logContext.mk;\n  if (mk && consecutiveMkState && consecutiveMkState.mk === mk) {\n    logger.debug(\n      'updateConsecutiveMkCount',\n      `连续处理写入/同步操作的 MK: ${mk}。旧计数: ${consecutiveMkState.count}，新计数: ${consecutiveMkState.count + 1}`,\n    );\n    consecutiveMkState.count++;\n  } else {\n    logger.debug(\n      'updateConsecutiveMkCount',\n      `新的写入/同步操作的 MK: ${mk}。重置计数为 1。前一个 MK 是: ${consecutiveMkState?.mk}`,\n    );\n    consecutiveMkState = { mk: mk, count: 1 };\n  }\n  return consecutiveMkState.count;\n}\n\n/**\n * **【任务执行器】**\n * 负责执行单个事件任务，包含所有前置、后置处理和错误捕获。\n * @param {EventJob} job - 要执行的事件任务。\n * @param {IgnoreRule | null} mkToIgnore - 当前的忽略规则。**作用域**: 仅在单次批处理 (event queue processing loop) 中生效。\n * @returns {Promise<IgnoreRule | null>} - 返回更新后的忽略规则。\n */\nexport async function dispatchAndExecuteTask(job: EventJob, mkToIgnore: IgnoreRule | null): Promise<IgnoreRule | null> {\n  const { type: eventType } = job;\n  const eventGroup = getEventGroup(eventType);\n  let message_id: number | null = null;\n\n  // 在每轮任务开始时，初始化操作记录器\n  const actionsTaken: ActionsTaken = { rollback: false, apply: false, resync: false, api: false, apiWrite: false };\n\n  try {\n    // **入口保障**: 尝试获取最新消息内容，内置的重试和延迟机制可以应对酒馆消息更新延迟。\n    // 即使最终失败，也继续执行，目的只是为了“等待”。\n    await getMessageContentWithRetry();\n\n    // **前置保障**: 确保最新消息有 MK 并设置日志上下文。\n    logger.log('dispatchAndExecuteTask', '调用 ensureMkForLatestMessage');\n    const { mk, message_id: msgId, isNewKey } = await ensureMkForLatestMessage();\n    if (!mk || msgId === null) {\n      logger.warn('dispatchAndExecuteTask', '无法获取有效的 MK 或消息 ID，跳过任务执行。');\n      return mkToIgnore;\n    }\n    logContext.mk = mk;\n    message_id = msgId;\n\n    // **前置保障**: 确保 AI 消息有占位符\n    logger.log('dispatchAndExecuteTask', '调用 ensurePlaceholder');\n    await ensurePlaceholder(message_id);\n\n    // 如果 ensureMkForLatestMessage 刚刚注入了一个新的 MK，就创建或更新忽略规则。\n    if (isNewKey && mk) {\n      mkToIgnore = {\n        mk: mk,\n        ignoreCount: RENDER_EVENTS_TO_IGNORE_AFTER_MK_INJECTION,\n      };\n    }\n\n    // **核心优化**: 检查并处理由 MK 注入触发的冗余渲染事件。\n    logger.debug('dispatchAndExecuteTask', '调用 handleRedundantRenderEvent');\n    const { shouldSkip, newIgnoreRule } = handleRedundantRenderEvent(eventType, mk, mkToIgnore);\n    mkToIgnore = newIgnoreRule; // 更新忽略规则的状态\n    if (shouldSkip) {\n      // 如果事件被忽略，则直接返回，不更新连续处理计数\n      return mkToIgnore;\n    }\n\n    logger.log('dispatchAndExecuteTask', `执行任务: ${eventType} (分组: ${eventGroup})`);\n\n    // **任务分发**\n    // v3.1 优化：payload 仅包含最核心的上下文，其他数据由下游函数自行获取。\n    const payload: DispatcherPayload = {\n      mk: mk,\n      message_id: message_id,\n      actions: actionsTaken,\n      consecutiveProcessingCount: 1, // 初始值\n    };\n\n    switch (eventGroup) {\n      case 'INIT':\n        logger.log('dispatchAndExecuteTask', '调用 initializeExternalSettings');\n        initializeExternalSettings();\n        // 为了兼容旧版酒馆的swipe逻辑，这里也调用同步\n        payload.consecutiveProcessingCount = updateConsecutiveMkCount();\n        logger.log('dispatchAndExecuteTask', '调用 handleSyncEvent for INIT');\n        await handleSyncEvent(job, actionsTaken, payload);\n        break;\n      case 'SYNC':\n        payload.consecutiveProcessingCount = updateConsecutiveMkCount();\n        logger.log('dispatchAndExecuteTask', '调用 handleSyncEvent for SYNC');\n        await handleSyncEvent(job, actionsTaken, payload);\n        break;\n      case 'API':\n        logger.log('dispatchAndExecuteTask', '调用 handleApiEvent');\n        handleApiEvent(job, actionsTaken, payload);\n        break;\n      case 'UPDATE_MK_ONLY':\n        logger.log('dispatchAndExecuteTask', '调用 handleUpdateMkOnlyEvent');\n        await handleUpdateMkOnlyEvent();\n        break;\n    }\n  } catch (error) {\n    logger.error('dispatchAndExecuteTask', `事件 ${eventType} 处理异常: ${error}`, error);\n  } finally {\n    // 清理日志上下文，为下一个事件做准备\n    logContext.mk = '';\n\n    // **节流**: 在每个独立任务后都进行短暂等待，确保酒馆底层有时间完成其异步操作。\n    //暂时取消等待逻辑，提高即时性。\n    //await new Promise(resolve => setTimeout(resolve, 50));\n  }\n\n  return mkToIgnore;\n}\n","'use strict';\n\nimport { updateLatestSelectedMk } from '../../core/key/mk';\n\nexport async function handleUpdateMkOnlyEvent(): Promise<void> {\n  // 监听此事件仅用于为用户消息创建 MK。\n  await updateLatestSelectedMk();\n}\n","/**\n * @file ERA 变量框架 - 事件队列与总调度模块\n * @description\n * 该模块是 ERA 框架的“神经中枢”。它通过一个事件队列机制，将所有事件的接收、\n * 合并、分发和执行流程化，从根本上解决了并发和状态竞争问题。\n *\n * **工作原理**:\n * 1. **事件入队**: 所有事件（来自酒馆或 API）都被封装成 `EventJob` 对象，推入 `eventQueue`。\n * 2. **单线程处理**: `processQueue` 函数使用 `isProcessing` 锁确保同一时间只有一个处理循环在运行。\n * 3. **防抖与批处理**: 在处理前会进行短暂防抖，以收集短时间内连续触发的多个事件，形成一个“批次”。\n * 4. **委托合并**: 将整个批次交由 `event_merger.ts` 模块进行智能合并（对冲、覆盖）。\n * 5. **委托执行**: 循环遍历合并后的任务，将每个任务委托给 `task_dispatcher.ts` 模块进行独立、原子的执行。\n * 6. **状态传递**: 在不同任务的执行之间，传递和更新必要的上下文状态（如 `mkToIgnore` 和 `consecutiveMkState`）。\n */\n\n'use strict';\n\nimport { Logger } from '../utils/log';\nimport { dispatchAndExecuteTask, IgnoreRule } from './dispatcher';\nimport { EVENT_DEBOUNCE_MAP, EventJob, getEventGroup, mergeEventBatch } from './merger';\n\nconst logger = new Logger();\n\n/**\n * @const {EventJob[]} eventQueue\n * @description 事件队列，存储所有待处理的事件任务。\n */\nconst eventQueue: EventJob[] = [];\n\n/**\n * @let {boolean} isProcessing\n * @description 处理器锁。为 true 时表示 `processQueue` 正在运行，防止重入。\n */\nlet isProcessing = false;\nlet isWaiting = false;\nlet unlockSignal: (() => void) | null = null;\n\n/**\n * **【事件入口】**\n * 将一个事件推入队列，并尝试启动或排队等待处理器。\n * @param {string} type - 事件类型 (e.g., `tavern_events.MESSAGE_DELETED`)。\n * @param {any} [detail] - 事件附带的数据。\n */\nexport function pushToQueue(type: string, detail?: any) {\n  logger.debug('pushToQueue', `接收到事件: ${type}，已推入队列。`, { detail });\n  eventQueue.push({ type, detail, timestamp: Date.now() });\n  processQueue();\n}\n\n/**\n * **【核心事件处理器】**\n * 采用“锁-等待-释放-通知”机制，确保事件处理的连续性。\n */\nasync function processQueue() {\n  // 如果已经有一个调用在“排队等待”，则本次调用直接返回，防止多个等待者。\n  if (isWaiting) {\n    logger.debug('processQueue', '已有处理函数在排队等待，本次调用忽略。');\n    return;\n  }\n\n  // 如果处理器正在忙碌，则进入“排队等待”状态。\n  if (isProcessing) {\n    logger.debug('processQueue', '处理器忙碌，进入排队等待状态...');\n    isWaiting = true;\n    // 等待当前处理器释放锁的信号\n    await new Promise<void>(resolve => {\n      unlockSignal = resolve;\n    });\n    isWaiting = false;\n    logger.debug('processQueue', '等待结束，获取到处理权。');\n  }\n\n  // 获得处理权后，如果队列已经被前一个处理器清空，则无需做任何事。\n  if (eventQueue.length === 0) {\n    logger.debug('processQueue', '队列为空，无需处理。');\n    return;\n  }\n\n  // 【加锁】\n  // 正式开始处理，加锁以阻止其他调用进入。\n  isProcessing = true;\n  logger.debug('processQueue', '处理器启动');\n\n  // 【防抖】\n  const firstJob = eventQueue[0];\n  const group = getEventGroup(firstJob.type);\n  if (group !== 'API') {\n    const debounceTime = EVENT_DEBOUNCE_MAP.get(firstJob.type) ?? 300;\n    logger.debug('processQueue', `启动事件收集窗口，等待 ${debounceTime}ms...`);\n    await new Promise(resolve => setTimeout(resolve, debounceTime));\n  }\n\n  // 【调试日志】\n  logger.debug('processQueue', '事件收集窗口关闭，准备处理的队列内容:', JSON.stringify(eventQueue.map(e => e.type)));\n\n  // 【循环处理】\n  // 只要队列不为空，就持续处理。这能确保在防抖期间新到达的事件也被纳入处理范围。\n  let mkToIgnore: IgnoreRule | null = null;\n  while (eventQueue.length > 0) {\n    const batchToProcess = eventQueue.splice(0, eventQueue.length);\n    const finalJobs = mergeEventBatch(batchToProcess);\n\n    logger.debug(\n      'processQueue',\n      `开始处理一个新批次，包含 ${batchToProcess.length} 个原始事件，合并后为 ${finalJobs.length} 个任务。`,\n    );\n\n    for (const job of finalJobs) {\n      const newIgnoreRule = await dispatchAndExecuteTask(job, mkToIgnore);\n      mkToIgnore = newIgnoreRule;\n    }\n    logger.debug('processQueue', '本轮批次处理完毕。');\n  }\n\n  // 【解锁并通知】\n  isProcessing = false;\n  logger.debug('processQueue', '处理器空闲，已释放锁。');\n\n  // 如果有等待者，则发送解锁信号，让它立即开始。\n  if (unlockSignal) {\n    logger.debug('processQueue', '通知排队的处理器开始工作。');\n    const signal = unlockSignal;\n    unlockSignal = null;\n    signal();\n  }\n}\n","import { unescapeEraData } from '../utils/data';\nimport { getEraData, removeMetaFields } from '../utils/era_data';\nimport { Logger } from '../utils/log';\n\nconst logger = new Logger();\n\n/**\n * 解析字符串中的 ERA 宏, 并将其替换为对应的变量值。\n * 这是提供给其他模块调用的公共接口。\n * @param text - 包含宏的输入字符串。\n * @returns - 替换宏后的字符串。\n */\nexport function parseEraMacros(text: string): string {\n  const macroRegex = /{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi;\n\n  // 如果文本中不包含宏特征字符串, 直接返回以优化性能\n  if (!text.includes('{{ERA')) {\n    return text;\n  }\n\n  // 获取 stat_data\n  const { stat } = getEraData();\n  if (!stat) {\n    logger.warn('parseEraMacros', '无法获取到 stat_data, 宏替换失败.');\n    // 如果没有 stat_data, 任何宏都无法解析, 直接返回原文本\n    return text;\n  }\n\n  return text.replace(macroRegex, (substring, withMeta, path) => {\n    const funcName = 'parseEraMacros';\n    const trimmedPath = path.trim();\n    const includeMeta = !!withMeta;\n\n    let data;\n    if (trimmedPath === '$ALLDATA') {\n      data = stat;\n    } else {\n      data = _.get(stat, trimmedPath);\n    }\n\n    if (data === undefined) {\n      logger.warn(funcName, `在 stat_data 中未找到路径 \"${trimmedPath}\", 宏将替换为空字符串.`);\n      return ''; // 路径未找到, 返回空字符串\n    }\n\n    // 根据 withMeta 标志决定是否移除 $meta 字段\n    const dataBeforeUnescape = includeMeta ? data : removeMetaFields(data);\n\n    // 在返回数据前进行反转义\n    const finalData = unescapeEraData(dataBeforeUnescape);\n\n    logger.debug('parseEraMacros', `宏替换数据反转义: ${trimmedPath}`, {\n      before: dataBeforeUnescape,\n      after: finalData,\n    });\n\n    // 如果是对象或数组, 转换为 JSON 字符串\n    if (typeof finalData === 'object' && finalData !== null) {\n      return JSON.stringify(finalData);\n    }\n\n    // 如果是原始类型, 直接转换为字符串\n    return String(finalData);\n  });\n}\n\n$(() => {\n  /**\n   * 注册 ERA 宏, 用于在发送给 AI 的消息中查询当前聊天的变量数据\n   *\n   * - `{{ERA:path.to.data}}`: 查询并替换为**不含** `$meta` 的纯净数据。\n   *   - `{{ERA:$ALLDATA}}` 将返回整个移除 `$meta` 后的 `stat_data` 对象。\n   * - `{{ERA-withmeta:path.to.data}}`: 查询并替换为**包含** `$meta` 的原始数据。\n   *   - `{{ERA-withmeta:$ALLDATA}}` 将返回完整的 `stat_data` 对象。\n   */\n  registerMacroLike(/{{\\s*ERA(-withmeta)?\\s*:\\s*([^}]+?)\\s*}}/gi, (context, substring, withMeta, path) => {\n    // 直接复用 parseEraMacros 函数的逻辑。\n    // substring 参数是匹配到的完整宏字符串, 如 \"{{ERA:path.to.data}}\"\n    return parseEraMacros(substring);\n  });\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"acc\" };\nconst _hoisted_2 = [\"aria-expanded\"];\nconst _hoisted_3 = { class: \"title\" };\nconst _hoisted_4 = { class: \"hint\" };\nconst _hoisted_5 = { class: \"inner\" };\nimport { ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'EraAccordion',\n    props: {\n        title: {},\n        defaultOpen: { type: Boolean, default: false }\n    },\n    setup(__props) {\n        const props = __props;\n        const open = ref(props.defaultOpen);\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createCommentVNode(\" 折叠头：点击切换 \"),\n                _createElementVNode(\"button\", {\n                    class: \"acc-head\",\n                    \"aria-expanded\": open.value ? 'true' : 'false',\n                    onClick: _cache[0] || (_cache[0] = ($event) => (open.value = !open.value))\n                }, [\n                    _createElementVNode(\"span\", {\n                        class: _normalizeClass([\"caret\", { open: open.value }])\n                    }, \"▸\", 2 /* CLASS */),\n                    _createCommentVNode(\" 指示箭头 \"),\n                    _createElementVNode(\"span\", _hoisted_3, _toDisplayString(__props.title), 1 /* TEXT */),\n                    _createCommentVNode(\" 标题文本 \"),\n                    _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"spacer\" }, null, -1 /* CACHED */)),\n                    _createCommentVNode(\" 弹性空隙 \"),\n                    _createElementVNode(\"span\", _hoisted_4, _toDisplayString(open.value ? '收起' : '展开'), 1 /* TEXT */),\n                    _createCommentVNode(\" 右侧提示 \")\n                ], 8 /* PROPS */, _hoisted_2),\n                _createCommentVNode(\" 内容：高度过渡（使用 CSS Grid） \"),\n                _createElementVNode(\"div\", {\n                    class: _normalizeClass([\"acc-body\", { open: open.value }])\n                }, [\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _renderSlot(_ctx.$slots, \"default\")\n                    ])\n                ], 2 /* CLASS */)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./EraAccordion.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./EraAccordion.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./EraAccordion.vue?vue&type=style&index=0&id=f723f6d6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-f723f6d6\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"meta\" };\nconst _hoisted_2 = { class: \"kv\" };\nconst _hoisted_3 = { class: \"item\" };\nconst _hoisted_4 = [\"title\"];\nconst _hoisted_5 = { class: \"item\" };\nconst _hoisted_6 = { class: \"v\" };\nconst _hoisted_7 = { class: \"item\" };\nconst _hoisted_8 = { class: \"v\" };\nimport { onMounted, watch } from 'vue';\nimport { Logger } from '../../../utils/log';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'MetaHeader',\n    props: {\n        mk: {},\n        messageId: {},\n        isUser: { type: Boolean }\n    },\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/EraPanelContent/MetaHeader\");\n        // 接收父组件传入的两个字段\n        const props = __props; // 简单的只读展示\n        onMounted(() => {\n            //logger.debug('onMounted', '组件已挂载', { props });\n        });\n        watch(() => props, newProps => {\n            logger.debug('watch:props', 'Props 发生变化', { newProps });\n        }, { deep: true });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _cache[0] || (_cache[0] = _createElementVNode(\"span\", { class: \"k\" }, \"mk\", -1 /* CACHED */)),\n                        _createCommentVNode(\" 键：mk \"),\n                        _createElementVNode(\"span\", {\n                            class: \"v\",\n                            title: __props.mk\n                        }, _toDisplayString(__props.mk || '—'), 9 /* TEXT, PROPS */, _hoisted_4),\n                        _createCommentVNode(\" 值：mk \")\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"k\" }, \"message_id\", -1 /* CACHED */)),\n                        _createCommentVNode(\" 键：message_id \"),\n                        _createElementVNode(\"span\", _hoisted_6, _toDisplayString(__props.messageId ?? '—'), 1 /* TEXT */),\n                        _createCommentVNode(\" 值：message_id \")\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_7, [\n                        _cache[2] || (_cache[2] = _createElementVNode(\"span\", { class: \"k\" }, \"来源\", -1 /* CACHED */)),\n                        _createCommentVNode(\" 键：来源 \"),\n                        _createElementVNode(\"span\", _hoisted_8, _toDisplayString(__props.isUser ? '用户' : 'AI'), 1 /* TEXT */),\n                        _createCommentVNode(\" 值：来源 \")\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./MetaHeader.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./MetaHeader.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./MetaHeader.vue?vue&type=style&index=0&id=9a5820b4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-9a5820b4\"]])\n\nexport default __exports__","import { createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, Fragment as _Fragment, normalizeStyle as _normalizeStyle, renderList as _renderList, resolveComponent as _resolveComponent, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"node\" };\nconst _hoisted_2 = { class: \"key\" };\nconst _hoisted_3 = { class: \"brace\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"summary\"\n};\nconst _hoisted_5 = {\n    key: 0,\n    class: \"json-children\"\n};\nconst _hoisted_6 = { class: \"brace\" };\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n    const _component_JsonNode = _resolveComponent(\"JsonNode\", true);\n    return (_openBlock(), _createElementBlock(_Fragment, null, [\n        _createCommentVNode(\" 单条节点（支持递归） \"),\n        _createElementVNode(\"div\", _hoisted_1, [\n            _createCommentVNode(\" 每个键值对 / 数组项的容器 \"),\n            _createElementVNode(\"div\", {\n                class: \"json-line\",\n                style: _normalizeStyle({ paddingLeft: _ctx.level * 14 + 'px' })\n            }, [\n                _createCommentVNode(\" 行+缩进 \"),\n                (_ctx.foldable)\n                    ? (_openBlock(), _createElementBlock(\"button\", {\n                        key: 0,\n                        class: _normalizeClass([\"caret\", { open: _ctx.open }]),\n                        \"aria-label\": \"toggle\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.open = !_ctx.open))\n                    }, \"▸\", 2 /* CLASS */))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\" 折叠箭头按钮 \"),\n                _createElementVNode(\"span\", _hoisted_2, _toDisplayString(_ctx.k), 1 /* TEXT */),\n                _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"colon\" }, \":\", -1 /* CACHED */)),\n                _createCommentVNode(\" 键与冒号 \"),\n                _createCommentVNode(\" 可折叠容器：只显示括号与摘要；展开后由下方 children 区域递归渲染 \"),\n                (_ctx.foldable)\n                    ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                        _createElementVNode(\"span\", _hoisted_3, _toDisplayString(_ctx.isArray ? '[' : '{'), 1 /* TEXT */),\n                        _createCommentVNode(\" 容器起始括号 \"),\n                        (!_ctx.open)\n                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_4, _toDisplayString(_ctx.summary), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true),\n                        _createCommentVNode(\" 收起时的摘要 \")\n                    ], 64 /* STABLE_FRAGMENT */))\n                    : (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                        _createCommentVNode(\" 原始值：直接着色渲染 \"),\n                        _createElementVNode(\"span\", {\n                            class: _normalizeClass([\"val\", _ctx.type])\n                        }, _toDisplayString(_ctx.primitiveText), 3 /* TEXT, CLASS */),\n                        _createCommentVNode(\" 原始值文本 \")\n                    ], 64 /* STABLE_FRAGMENT */))\n            ], 4 /* STYLE */),\n            _createCommentVNode(\" 子元素区域：仅当可折叠且处于展开态时显示 \"),\n            (_ctx.foldable && _ctx.open)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                    _createCommentVNode(\" 递归：自引用同名组件 JsonNode（依赖 name: 'JsonNode' 实现自递归） \"),\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.childEntries, (childVal, childKey) => {\n                        return (_openBlock(), _createBlock(_component_JsonNode, {\n                            key: _ctx.path + '/' + String(childKey),\n                            k: String(childKey),\n                            v: childVal,\n                            path: _ctx.path + '/' + String(childKey),\n                            level: _ctx.level + 1,\n                            \"default-collapsed\": _ctx.defaultCollapsed,\n                            \"max-depth\": _ctx.maxDepth\n                        }, null, 8 /* PROPS */, [\"k\", \"v\", \"path\", \"level\", \"default-collapsed\", \"max-depth\"]));\n                    }), 128 /* KEYED_FRAGMENT */)),\n                    _createElementVNode(\"div\", {\n                        class: \"json-line\",\n                        style: _normalizeStyle({ paddingLeft: _ctx.level * 14 + 'px' })\n                    }, [\n                        _createElementVNode(\"span\", _hoisted_6, _toDisplayString(_ctx.isArray ? ']' : '}'), 1 /* TEXT */),\n                        _createCommentVNode(\" 容器闭合括号 \")\n                    ], 4 /* STYLE */)\n                ]))\n                : _createCommentVNode(\"v-if\", true)\n        ])\n    ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */));\n}\n","import { computed, defineComponent, onMounted, ref, watch } from 'vue'; // 引入响应式/组件工具\nimport { Logger } from '../../utils/log';\nexport default defineComponent({\n    name: 'JsonNode', // 关键：为自递归提供组件名\n    props: {\n        k: { type: [String, Number], required: true }, // 当前键（或数组下标）\n        v: { required: true }, // 当前值\n        path: { type: String, required: true }, // 路径（仅用于 key/调试）\n        level: { type: Number, required: true }, // 层级（用于缩进）\n        defaultCollapsed: { type: Boolean, default: true }, // 默认是否折叠\n        maxDepth: { type: Number, default: 3 }, // 初次展开的最大深度\n    },\n    setup(p) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/template/JsonNode\");\n        onMounted(() => {\n            //logger.debug('onMounted', '组件已挂载', { props: p });\n        });\n        // 节点类型判定\n        const type = computed(() => {\n            const val = p.v;\n            if (val === null)\n                return 'null';\n            if (Array.isArray(val))\n                return 'array';\n            const t = typeof val;\n            if (t === 'object')\n                return 'object';\n            if (t === 'undefined')\n                return 'undefined';\n            return t;\n        });\n        // 是否数组/对象\n        const isArray = computed(() => type.value === 'array');\n        const isObject = computed(() => type.value === 'object');\n        // 是否可折叠\n        const foldable = computed(() => isArray.value || isObject.value);\n        // 初始开合：不超过 maxDepth 的层级默认展开；否则遵循 defaultCollapsed\n        const open = ref(p.level <= (p.maxDepth ?? 3) ? true : !p.defaultCollapsed);\n        watch(open, newOpenState => {\n            logger.debug('watch:open', `折叠状态改变为: ${newOpenState ? '展开' : '收起'}`);\n        });\n        // 原始值渲染文本（补足 undefined / bigint / symbol）\n        const primitiveText = computed(() => {\n            const val = p.v;\n            switch (type.value) {\n                case 'string':\n                    return JSON.stringify(val);\n                case 'number':\n                    return String(val);\n                case 'boolean':\n                    return val ? 'true' : 'false';\n                case 'null':\n                    return 'null';\n                case 'undefined':\n                    return 'undefined';\n                case 'bigint':\n                    return String(val) + 'n';\n                case 'symbol':\n                    return String(val);\n                case 'function':\n                    return 'ƒ()';\n                default:\n                    return '';\n            }\n        });\n        // 收起时的摘要信息\n        const summary = computed(() => {\n            if (isArray.value)\n                return `Array[${p.v.length}]`;\n            if (isObject.value)\n                return `Object{${Object.keys(p.v || {}).length}}`;\n            return '';\n        });\n        // 子项列表：对象 → 其 entries；数组 → 直接枚举索引和值\n        const childEntries = computed(() => {\n            if (isObject.value)\n                return p.v;\n            if (isArray.value) {\n                const out = {};\n                p.v.forEach((cv, idx) => {\n                    out[String(idx)] = cv;\n                });\n                return out;\n            }\n            return {};\n        });\n        return { type, isArray, foldable, open, primitiveText, summary, childEntries };\n    },\n});\n","/* unplugin-vue-components disabled */import { render } from \"./JsonNode.vue?vue&type=template&id=6c2ac46e&scoped=true&ts=true\"\nimport script from \"./JsonNode.vue?vue&type=script&lang=ts\"\nexport * from \"./JsonNode.vue?vue&type=script&lang=ts\"\n\nimport \"./JsonNode.vue?vue&type=style&index=0&id=6c2ac46e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-6c2ac46e\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"json-root\" };\nconst _hoisted_2 = { class: \"json-line\" };\nconst _hoisted_3 = { class: \"brace\" };\nconst _hoisted_4 = { class: \"json-children\" };\nconst _hoisted_5 = {\n    key: 1,\n    class: \"json-line\",\n    style: { paddingLeft: 1 * 14 + 'px' }\n};\nconst _hoisted_6 = { class: \"json-line\" };\nconst _hoisted_7 = { class: \"brace\" };\nimport { computed } from 'vue'; // 计算属性工具\nimport { Logger } from '../../utils/log';\nimport JsonNode from './JsonNode.vue'; // ✅ 改为导入独立 SFC 的递归节点组件\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'PrettyJsonViewer',\n    props: {\n        value: {},\n        defaultCollapsed: { type: Boolean, default: true },\n        maxDepth: { default: 3 }\n    },\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/template/PrettyJsonViewer\");\n        const props = __props;\n        const isPlainObjectOrArray = computed(() => {\n            const v = props.value; // 取入参值\n            const result = v !== null && typeof v === 'object'; // 仅对象/数组才进入逐键渲染\n            logger.debug('isPlainObjectOrArray', `计算结果: ${result}。该值${result ? '是' : '不是'}普通对象或数组。`, {\n                传入值: v,\n            });\n            return result;\n        }); // 是否对象/数组\n        const primitiveType = computed(() => {\n            const v = props.value; // 取入参值\n            let result;\n            if (v === null) {\n                result = 'null';\n            }\n            else if (Array.isArray(v)) {\n                result = 'array'; // 数组（不会走到该分支，因为上面 isPlainObjectOrArray 判断过）\n            }\n            else {\n                const t = typeof v; // 原始类型\n                result = t === 'undefined' ? 'undefined' : t;\n            }\n            logger.debug('primitiveType', `计算原始值类型: ${result}`, { 传入值: v });\n            return result;\n        }); // 原始值类型名（用于着色）\n        const primitiveText = computed(() => {\n            const v = props.value; // 取入参值\n            let result;\n            switch (primitiveType.value // 按类型格式化文本\n            ) {\n                case 'string':\n                    result = JSON.stringify(v); // 字符串带引号\n                    break;\n                case 'number':\n                    result = String(v); // 数字\n                    break;\n                case 'boolean':\n                    result = v ? 'true' : 'false'; // 布尔\n                    break;\n                case 'null':\n                    result = 'null'; // null\n                    break;\n                case 'undefined':\n                    result = 'undefined'; // undefined\n                    break;\n                case 'bigint':\n                    result = String(v) + 'n'; // bigint\n                    break;\n                case 'symbol':\n                    result = String(v); // symbol\n                    break;\n                case 'function':\n                    result = 'ƒ()'; // 函数\n                    break;\n                default:\n                    result = ''; // 兜底\n                    break;\n            }\n            logger.debug('primitiveText', `格式化原始值文本: \"${result}\"`, {\n                传入值: v,\n                类型: primitiveType.value,\n            });\n            return result;\n        }); // 原始值文本\n        const isArrayRoot = computed(() => {\n            const result = Array.isArray(props.value);\n            logger.debug('isArrayRoot', `计算根节点是否为数组: ${result}`, { 传入值: props.value });\n            return result;\n        }); // 根是否数组\n        const rootOpen = computed(() => (isArrayRoot.value ? '[' : '{')); // 根开括号\n        const rootClose = computed(() => (isArrayRoot.value ? ']' : '}')); // 根闭括号\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"span\", _hoisted_3, _toDisplayString(rootOpen.value), 1 /* TEXT */),\n                    _createCommentVNode(\" 根开括号：对象{ / 数组[ \")\n                ]),\n                _createElementVNode(\"div\", _hoisted_4, [\n                    (isPlainObjectOrArray.value)\n                        ? (_openBlock(true), _createElementBlock(_Fragment, { key: 0 }, _renderList(__props.value, (v, k) => {\n                            return (_openBlock(), _createBlock(JsonNode, {\n                                key: String(k),\n                                k: String(k),\n                                v: v,\n                                path: String(k),\n                                level: 1,\n                                \"default-collapsed\": __props.defaultCollapsed,\n                                \"max-depth\": __props.maxDepth\n                            }, null, 8 /* PROPS */, [\"k\", \"v\", \"path\", \"default-collapsed\", \"max-depth\"]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                            _cache[0] || (_cache[0] = _createElementVNode(\"span\", { class: \"key\" }, \"value\", -1 /* CACHED */)),\n                            _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"colon\" }, \":\", -1 /* CACHED */)),\n                            _createElementVNode(\"span\", {\n                                class: _normalizeClass([\"val\", primitiveType.value])\n                            }, _toDisplayString(primitiveText.value), 3 /* TEXT, CLASS */)\n                        ]))\n                ]),\n                _createElementVNode(\"div\", _hoisted_6, [\n                    _createElementVNode(\"span\", _hoisted_7, _toDisplayString(rootClose.value), 1 /* TEXT */),\n                    _createCommentVNode(\" 根闭括号：对象} / 数组] \")\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./PrettyJsonViewer.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./PrettyJsonViewer.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./PrettyJsonViewer.vue?vue&type=style&index=0&id=6fc9ef75&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6fc9ef75\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"details-wrapper\" };\nconst _hoisted_2 = { class: \"detail-block\" };\nconst _hoisted_3 = { class: \"detail-block\" };\nimport EraAccordion from '../../template/EraAccordion.vue';\nimport PrettyJsonViewer from '../../template/PrettyJsonViewer.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'OperationDetails',\n    props: {\n        data: {}\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(EraAccordion, {\n                title: \"ERA 最新操作详情\",\n                \"default-open\": false\n            }, {\n                default: _withCtx(() => [\n                    _createElementVNode(\"div\", _hoisted_1, [\n                        _createElementVNode(\"div\", _hoisted_2, [\n                            _cache[0] || (_cache[0] = _createElementVNode(\"h4\", { class: \"detail-title\" }, \"SelectedMks（数组）\", -1 /* CACHED */)),\n                            _createVNode(PrettyJsonViewer, {\n                                value: __props.data.selectedMks,\n                                \"default-collapsed\": true,\n                                \"max-depth\": 3\n                            }, null, 8 /* PROPS */, [\"value\"])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _cache[1] || (_cache[1] = _createElementVNode(\"h4\", { class: \"detail-title\" }, \"EditLogs（对象）\", -1 /* CACHED */)),\n                            _createVNode(PrettyJsonViewer, {\n                                value: __props.data.editLogs,\n                                \"default-collapsed\": true,\n                                \"max-depth\": 2\n                            }, null, 8 /* PROPS */, [\"value\"])\n                        ])\n                    ])\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./OperationDetails.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./OperationDetails.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./OperationDetails.vue?vue&type=style&index=0&id=6079192c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6079192c\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, renderSlot as _renderSlot } from \"vue\";\nconst _hoisted_1 = { class: \"tabs\" };\nconst _hoisted_2 = {\n    class: \"tab-bar\",\n    role: \"tablist\"\n};\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = { class: \"tab-content\" };\nconst _hoisted_5 = { key: 0 };\nconst _hoisted_6 = { key: 1 };\nimport { onMounted, ref, watch } from 'vue'; // 引入响应式工具\nimport { Logger } from '../../utils/log';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'TabSwitch',\n    props: {\n        tabs: {},\n        active: {}\n    },\n    emits: [\"update:active\"],\n    setup(__props, { emit: __emit }) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/template/TabSwitch\");\n        const props = __props; // 输入 tabs 与可选 active\n        const emit = __emit; // v-model:active\n        const innerActive = ref(props.active ?? 'pure'); // 内部活动键\n        watch(() => props.active, v => {\n            if (v) {\n                logger.debug('watch:active', `外部同步 active tab 为: ${v}`);\n                innerActive.value = v;\n            }\n        }); // 外部变更时同步\n        function setActive(k) {\n            logger.debug('setActive', `用户点击，切换 tab 到: ${k}`);\n            innerActive.value = k;\n            emit('update:active', k);\n        } // 切换并抛出\n        onMounted(() => {\n            //logger.debug('onMounted', '组件已挂载', { props });\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createCommentVNode(\" 页签行 \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.tabs, (t) => {\n                        return (_openBlock(), _createElementBlock(\"button\", {\n                            key: t.key,\n                            class: _normalizeClass([\"tab-btn\", { active: t.key === innerActive.value }]),\n                            role: \"tab\",\n                            onClick: ($event) => (setActive(t.key))\n                        }, _toDisplayString(t.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_3));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ]),\n                _createCommentVNode(\" 内容区：根据活动键渲染对应插槽 \"),\n                _createElementVNode(\"div\", _hoisted_4, [\n                    (innerActive.value === 'pure')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                            _renderSlot(_ctx.$slots, \"pure\"),\n                            _createCommentVNode(\" 纯净状态数据内容 \")\n                        ]))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                            _renderSlot(_ctx.$slots, \"full\"),\n                            _createCommentVNode(\" 完整状态数据内容 \")\n                        ]))\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./TabSwitch.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./TabSwitch.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./TabSwitch.vue?vue&type=style&index=0&id=2874077c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2874077c\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, vModelText as _vModelText, withKeys as _withKeys, createVNode as _createVNode, withCtx as _withCtx } from \"vue\";\nconst _hoisted_1 = {\n    id: \"era-snapshot-ui\",\n    class: \"snapshot-manager\"\n};\nconst _hoisted_2 = { class: \"selector-wrapper\" };\nconst _hoisted_3 = {\n    class: \"select-field\",\n    role: \"group\",\n    \"aria-labelledby\": \"mk-label\"\n};\nconst _hoisted_4 = { class: \"select-container\" };\nconst _hoisted_5 = [\"value\"];\nconst _hoisted_6 = { class: \"selector-wrapper\" };\nconst _hoisted_7 = {\n    class: \"select-field\",\n    role: \"group\",\n    \"aria-labelledby\": \"mid-label\"\n};\nconst _hoisted_8 = { class: \"id-query-container\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"loading-indicator\"\n};\nconst _hoisted_10 = {\n    key: 1,\n    class: \"error-message\"\n};\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { Logger } from '../../utils/log';\nimport { isUserMessage } from '../../utils/message';\nimport EraAccordion from '../template/EraAccordion.vue';\nimport PrettyJsonViewer from '../template/PrettyJsonViewer.vue';\nimport TabSwitch from '../template/TabSwitch.vue';\nimport MetaHeader from './EraPanelContent/MetaHeader.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'SnapshotManager',\n    props: {\n        latestData: {}\n    },\n    setup(__props) {\n        const props = __props;\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/SnapshotManager\");\n        const latestMkFromProps = computed(() => props.latestData?.mk ?? null);\n        const selectedMk = ref(latestMkFromProps.value);\n        const messageIdInput = ref(null);\n        const historicalSnapshot = ref(null);\n        const loading = ref(false);\n        const error = ref(null);\n        const tabs = [\n            { key: 'pure', label: '纯净状态数据' },\n            { key: 'full', label: '完整状态数据' },\n        ];\n        const activeTab = ref('pure');\n        const reversedSelectedMks = computed(() => {\n            return props.latestData?.selectedMks?.slice().reverse() ?? [];\n        });\n        const displayData = computed(() => {\n            // 优先显示查询到的历史快照\n            if (historicalSnapshot.value) {\n                return historicalSnapshot.value;\n            }\n            // 如果没有历史快照，且当前选中了最新的MK（或默认状态），则显示最新的数据\n            if (selectedMk.value === latestMkFromProps.value) {\n                return props.latestData;\n            }\n            // 其他情况（如列表选中了非最新项但还没返回结果）不显示\n            return null;\n        });\n        const isUserMessageComputed = computed(() => {\n            if (!displayData.value)\n                return false;\n            // 如果是历史快照(QueryResultItem)，它会包含 is_user 属性\n            if ('is_user' in displayData.value) {\n                return displayData.value.is_user;\n            }\n            // 否则，这是最新数据(WriteDonePayload)，我们需要从消息中获取它\n            const message = getChatMessages(displayData.value.message_id, { include_swipes: false })[0];\n            return message ? isUserMessage(message) : false;\n        });\n        watch(() => latestMkFromProps.value, newLatestMk => {\n            // 当外部数据更新时，重置UI到最新状态\n            selectedMk.value = newLatestMk;\n            historicalSnapshot.value = null;\n            messageIdInput.value = null;\n            error.value = null;\n            loading.value = false;\n        }, { immediate: true });\n        const handleSelectionChange = () => {\n            const mk = selectedMk.value;\n            // 清理其他查询方式的状态\n            messageIdInput.value = null;\n            historicalSnapshot.value = null;\n            error.value = null;\n            if (!mk || mk === latestMkFromProps.value) {\n                loading.value = false;\n                return;\n            }\n            loading.value = true;\n            logger.debug('SnapshotManager', `(MK Select) 请求快照, mk: ${mk}`);\n            eventEmit('era:getSnapshotAtMk', { mk });\n        };\n        const queryByMId = () => {\n            if (messageIdInput.value === null || messageIdInput.value < 0) {\n                error.value = '请输入一个有效的、非负的消息 ID。';\n                return;\n            }\n            // 清理其他查询方式的状态\n            selectedMk.value = null; // 从下拉列表中取消选择\n            historicalSnapshot.value = null;\n            error.value = null;\n            loading.value = true;\n            logger.debug('SnapshotManager', `(ID Query) 请求快照, message_id: ${messageIdInput.value}`);\n            eventEmit('era:getSnapshotAtMId', { message_id: messageIdInput.value });\n        };\n        const handleQueryResult = (detail) => {\n            loading.value = false;\n            const handleResult = (result, errorMsg) => {\n                if (result) {\n                    historicalSnapshot.value = result;\n                    // 同步下拉框的选中项\n                    selectedMk.value = result.mk;\n                    error.value = null;\n                }\n                else {\n                    historicalSnapshot.value = null;\n                    error.value = errorMsg;\n                }\n            };\n            if (detail.queryType === 'getSnapshotAtMk' && detail.request.mk === selectedMk.value) {\n                handleResult(detail.result, `未找到与 MK \"${selectedMk.value}\" 相关的快照。`);\n            }\n            else if (detail.queryType === 'getSnapshotAtMId' && detail.request.message_id === messageIdInput.value) {\n                handleResult(detail.result, `未找到与消息 ID \"${messageIdInput.value}\" 相关的快照。`);\n            }\n        };\n        const formatMkForDisplay = (mk, index) => {\n            const total = reversedSelectedMks.value.length;\n            const msgId = total - 1 - index;\n            const isLatest = mk === latestMkFromProps.value;\n            if (!mk)\n                return `消息 ${msgId} (无MK)`;\n            const shortMk = mk.substring(mk.length - 6);\n            const label = `消息 ${msgId} (...${shortMk})`;\n            return isLatest ? `${label} (最新)` : label;\n        };\n        onMounted(() => {\n            eventOn('era:queryResult', handleQueryResult);\n        });\n        onUnmounted(() => {\n            eventRemoveListener('era:queryResult', handleQueryResult);\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createCommentVNode(\" ★ 新增唯一 id：不改变任何逻辑，仅用于限制样式作用域 \"),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createCommentVNode(\" 外层容器：保留，改为纵向布局更协调 \"),\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _createCommentVNode(\" 字段容器：用于浮动标题 \"),\n                            _cache[4] || (_cache[4] = _createElementVNode(\"label\", {\n                                id: \"mk-label\",\n                                for: \"mk-selector\",\n                                class: \"field-label\"\n                            }, \"按消息密钥(MK)查看\", -1 /* CACHED */)),\n                            _createCommentVNode(\" 浮动小标题：不再占用水平空间 \"),\n                            _createElementVNode(\"div\", _hoisted_4, [\n                                _createCommentVNode(\" 下拉容器：保留右侧箭头与阴影效果 \"),\n                                _withDirectives(_createElementVNode(\"select\", {\n                                    id: \"mk-selector\",\n                                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((selectedMk).value = $event)),\n                                    class: \"mk-selector\",\n                                    onChange: handleSelectionChange\n                                }, [\n                                    _cache[3] || (_cache[3] = _createElementVNode(\"option\", {\n                                        value: null,\n                                        disabled: \"\"\n                                    }, \"-- 从列表中选择 --\", -1 /* CACHED */)),\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(reversedSelectedMks.value, (mk, index) => {\n                                        return (_openBlock(), _createElementBlock(\"option\", {\n                                            key: mk || `null-${index}`,\n                                            value: mk\n                                        }, [\n                                            _createTextVNode(_toDisplayString(formatMkForDisplay(mk, index)) + \" \", 1 /* TEXT */),\n                                            _createCommentVNode(\" 选项显示文本 \")\n                                        ], 8 /* PROPS */, _hoisted_5));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                    [_vModelSelect, selectedMk.value]\n                                ])\n                            ])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_6, [\n                        _createElementVNode(\"div\", _hoisted_7, [\n                            _cache[5] || (_cache[5] = _createElementVNode(\"label\", {\n                                id: \"mid-label\",\n                                for: \"mid-input\",\n                                class: \"field-label\"\n                            }, \"按消息ID查看\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_8, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    id: \"mid-input\",\n                                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((messageIdInput).value = $event)),\n                                    type: \"number\",\n                                    class: \"mk-selector id-input\",\n                                    placeholder: \"输入消息 ID...\",\n                                    onKeyup: _withKeys(queryByMId, [\"enter\"])\n                                }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                    [\n                                        _vModelText,\n                                        messageIdInput.value,\n                                        void 0,\n                                        { number: true }\n                                    ]\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"query-button\",\n                                    onClick: queryByMId\n                                }, \"查找\")\n                            ])\n                        ])\n                    ]),\n                    (loading.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"正在加载快照...\"))\n                        : _createCommentVNode(\"v-if\", true),\n                    (error.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, _toDisplayString(error.value), 1 /* TEXT */))\n                        : _createCommentVNode(\"v-if\", true),\n                    (displayData.value)\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                            _createVNode(EraAccordion, {\n                                title: \"消息元数据\",\n                                \"default-open\": true\n                            }, {\n                                default: _withCtx(() => [\n                                    _createVNode(MetaHeader, {\n                                        mk: displayData.value.mk,\n                                        \"message-id\": displayData.value.message_id,\n                                        \"is-user\": isUserMessageComputed.value\n                                    }, null, 8 /* PROPS */, [\"mk\", \"message-id\", \"is-user\"])\n                                ]),\n                                _: 1 /* STABLE */\n                            }),\n                            _createVNode(TabSwitch, {\n                                active: activeTab.value,\n                                \"onUpdate:active\": _cache[2] || (_cache[2] = ($event) => ((activeTab).value = $event)),\n                                tabs: tabs\n                            }, {\n                                pure: _withCtx(() => [\n                                    _createVNode(PrettyJsonViewer, {\n                                        value: displayData.value.statWithoutMeta,\n                                        \"default-collapsed\": true,\n                                        \"max-depth\": Infinity\n                                    }, null, 8 /* PROPS */, [\"value\"])\n                                ]),\n                                full: _withCtx(() => [\n                                    _createVNode(PrettyJsonViewer, {\n                                        value: displayData.value.stat,\n                                        \"default-collapsed\": true,\n                                        \"max-depth\": Infinity\n                                    }, null, 8 /* PROPS */, [\"value\"])\n                                ]),\n                                _: 1 /* STABLE */\n                            }, 8 /* PROPS */, [\"active\"])\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ])\n            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./SnapshotManager.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./SnapshotManager.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./SnapshotManager.vue?vue&type=style&index=0&id=39fd399a&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, withCtx as _withCtx, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"era-panel\" };\nconst _hoisted_2 = { class: \"panel-top\" };\nconst _hoisted_3 = { class: \"panel-body\" };\nconst _hoisted_4 = { class: \"panel-content-wrapper\" };\nconst _hoisted_5 = {\n    key: 1,\n    class: \"empty\"\n};\nimport { Logger } from '../../utils/log';\nimport EraAccordion from '../template/EraAccordion.vue';\nimport MetaHeader from './EraPanelContent/MetaHeader.vue';\nimport OperationDetails from './EraPanelContent/OperationDetails.vue';\nimport SnapshotManager from './SnapshotManager.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'EraPanel',\n    props: {\n        data: {}\n    },\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/EraPanel\");\n        const requestSwitchView = (viewName) => {\n            logger.debug('requestSwitchView', `请求切换视图到: ${viewName}`);\n            if (window.eraUiSwitchView) {\n                window.eraUiSwitchView(viewName);\n            }\n            else {\n                logger.warn('requestSwitchView', '全局切换函数 eraUiSwitchView 未找到');\n            }\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"header\", _hoisted_2, [\n                    _cache[1] || (_cache[1] = _createElementVNode(\"h3\", { class: \"panel-title\" }, \"ERA 数据面板\", -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"btn-close\",\n                        \"aria-label\": \"关闭\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (requestSwitchView('FloatingBall')))\n                    }, \"×\")\n                ]),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        (__props.data)\n                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                _createVNode(EraAccordion, {\n                                    title: \"最新消息元数据\",\n                                    \"default-open\": false\n                                }, {\n                                    default: _withCtx(() => [\n                                        _createVNode(MetaHeader, {\n                                            mk: __props.data.mk,\n                                            \"message-id\": __props.data.message_id\n                                        }, null, 8 /* PROPS */, [\"mk\", \"message-id\"])\n                                    ]),\n                                    _: 1 /* STABLE */\n                                }),\n                                _createVNode(OperationDetails, { data: __props.data }, null, 8 /* PROPS */, [\"data\"]),\n                                _createVNode(SnapshotManager, { \"latest-data\": __props.data }, null, 8 /* PROPS */, [\"latest-data\"])\n                            ], 64 /* STABLE_FRAGMENT */))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \"等待 era:writeDone 事件数据…\"))\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./EraPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./EraPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./EraPanel.vue?vue&type=style&index=0&id=0e43fd44&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0e43fd44\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nimport { onMounted } from 'vue';\nimport { Logger } from '../../utils/log';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'FloatingBall',\n    emits: ['click'],\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/FloatingBall\");\n        onMounted(() => {\n            //logger.debug('onMounted', 'FloatingBall.vue 组件已挂载');\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"floating-ball\",\n                onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('click')))\n            }, [\n                _cache[1] || (_cache[1] = _createElementVNode(\"span\", {\n                    class: \"era-logo\",\n                    \"aria-hidden\": \"true\"\n                }, \"ERA\", -1 /* CACHED */)),\n                _createCommentVNode(\" 仅显示用；不拦截事件 \")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./FloatingBall.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./FloatingBall.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./FloatingBall.vue?vue&type=style&index=0&id=3bb5cc6c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3bb5cc6c\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createStaticVNode as _createStaticVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n    class: \"about-era-card\",\n    role: \"complementary\",\n    \"aria-label\": \"关于 ERA\"\n};\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'AboutEra',\n    setup(__props) {\n        // This component is purely informational.\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [...(_cache[0] || (_cache[0] = [\n                    _createStaticVNode(\"<h4 class=\\\"card-title\\\" data-v-9b1026a6>关于 ERA</h4><div class=\\\"info-list\\\" data-v-9b1026a6><ul data-v-9b1026a6><li data-v-9b1026a6><strong data-v-9b1026a6>ERA 项目地址:</strong><a href=\\\"https://github.com/RockingSisyphus/ERA-EfficientRollbackArchitecture/tree/master\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" data-v-9b1026a6> GitHub </a></li><li data-v-9b1026a6><strong data-v-9b1026a6>ERA 介绍帖:</strong><a href=\\\"https://discord.com/channels/1134557553011998840/1423319849400270928\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" data-v-9b1026a6> Discord </a></li><li data-v-9b1026a6><strong data-v-9b1026a6>作者:</strong> 世界的山田</li><li data-v-9b1026a6><strong data-v-9b1026a6>ERA 框架交流群:</strong> 1006127516</li></ul></div>\", 2)\n                ]))]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./AboutEra.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./AboutEra.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./AboutEra.vue?vue&type=style&index=0&id=9b1026a6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-9b1026a6\"]])\n\nexport default __exports__","const __WEBPACK_NAMESPACE_OBJECT__ = toastr;","import { Logger } from './log';\n\nconst logger = new Logger();\n\n/**\n * @file ERA 变量框架 - 正则表达式工具模块\n * @description 提供用于管理和同步酒馆正则表达式的实用函数。\n */\n\ntype RegexInjectionResult = {\n  success: boolean;\n  status: 'injected' | 'exists' | 'failed' | 'skipped';\n  reason?: string;\n};\n\n/**\n * 确保指定的正则表达式存在于当前角色的局部正则列表中。\n * 如果不存在，则会创建一个新的并添加到列表的末尾。\n *\n * @param regexData 一个不包含 `id` 和 `scope` 的 `TavernRegex` 对象。\n * 函数将根据 `script_name` 来检查正则是否存在。\n * @returns 一个包含操作结果的对象\n */\nexport async function ensureCharacterRegex(\n  regexData: Omit<TavernRegex, 'id' | 'scope'>,\n): Promise<RegexInjectionResult> {\n  if (!isCharacterTavernRegexesEnabled()) {\n    const reason = '局部正则未启用，跳过注入。';\n    logger.debug('ensureCharacterRegex', reason);\n    return { success: false, status: 'skipped', reason };\n  }\n\n  const characterRegexes = getTavernRegexes({ scope: 'character' });\n  const isAlreadyExists = characterRegexes.some(regex => regex.script_name === regexData.script_name);\n\n  if (isAlreadyExists) {\n    logger.debug('ensureCharacterRegex', `名为 \"${regexData.script_name}\" 的正则已存在，无需注入。`);\n    return { success: true, status: 'exists' };\n  }\n\n  try {\n    logger.debug('ensureCharacterRegex', `未找到名为 \"${regexData.script_name}\" 的正则，正在注入...`);\n    await updateTavernRegexesWith(\n      regexes => {\n        // 在末尾添加新的正则表达式\n        regexes.push({\n          ...regexData,\n          id: '', // id 会由酒馆自动生成\n          scope: 'character',\n        });\n        return regexes;\n      },\n      { scope: 'character' },\n    );\n    logger.debug('ensureCharacterRegex', '正则注入成功。');\n    return { success: true, status: 'injected' };\n  } catch (error) {\n    const reason = `注入名为 \"${regexData.script_name}\" 的正则时发生错误。`;\n    logger.error('ensureCharacterRegex', reason, error);\n    return { success: false, status: 'failed', reason };\n  }\n}\n","/**\n * @constant {Omit<TavernRegex, 'id' | 'scope'>} HIDE_ERA_DATA_REGEX\n * @description\n * 用于隐藏消息中 ERA 数据标签的正则表达式对象。\n * 这个正则是为了从用户和 AI 的输出中移除 <era_data> 和 <variable...> 等标签，\n * 以免它们在最终显示或作为提示词时对用户或模型造成干扰。\n *\n * - **find_regex**: 匹配 <era_data>...</era_data> 或 <variable...>...</variable...> 块。\n * - **replace_string**: 替换为空字符串，即删除匹配到的内容。\n * - **source**: 应用于用户输入和 AI 输出。\n * - **destination**: 同时作用于“显示”和“提示词”两种场景。\n * - **run_on_edit**: 在编辑消息时也生效。\n */\nexport const HIDE_ERA_DATA_REGEX: Omit<TavernRegex, 'id' | 'scope'> = {\n  script_name: 'ERA 数据隐藏正则',\n  enabled: true,\n  run_on_edit: true,\n  find_regex: String.raw`/<(variable(?:insert|edit|delete))>\\s*(?=[\\s\\S]*?\\S[\\s\\S]*?<\\/\\1>)((?:(?!<(?:era_data|variable(?:think|insert|edit|delete))>|<\\/\\1>)[\\s\\S])*?)\\s*<\\/\\1>/gi`,\n  replace_string: '',\n  source: {\n    user_input: true,\n    ai_output: true,\n    slash_command: false,\n    world_info: false,\n  },\n  destination: {\n    display: true,\n    prompt: true,\n  },\n  min_depth: null,\n  max_depth: null,\n};\n","/**\n * @constant {Omit<TavernRegex, 'id' | 'scope'>} HIDE_ERA_METADATA_REGEX\n * @description\n * 用于隐藏发送给AI的ERA元数据\n * This regex is for hiding ERA metadata sent to AI.\n *\n * - **find_regex**: 匹配 <metadata>...</metadata> 块。\n * - **replace_string**: 替换为空字符串，即删除匹配到的内容。\n * - **source**: 应用于 AI 输出。\n * - **destination**: 同时作用于“显示”和“提示词”两种场景。\n * - **run_on_edit**: 在编辑消息时也生效。\n */\nexport const HIDE_ERA_METADATA_REGEX: Omit<TavernRegex, 'id' | 'scope'> = {\n  script_name: 'ERA 元数据隐藏正则',\n  enabled: true,\n  run_on_edit: true,\n  find_regex: String.raw`/<era_data>\\s*(?=[\\s\\S]*?\\S[\\s\\S]*?<\\/era_data>)((?:(?!<(?:era_data|variable(?:think|insert|edit|delete))>|<\\/era_data>)[\\s\\S])*?)\\s*<\\/era_data>/gi`,\n  replace_string: '',\n  source: {\n    user_input: true,\n    ai_output: true,\n    slash_command: false,\n    world_info: false,\n  },\n  destination: {\n    display: true,\n    prompt: true,\n  },\n  min_depth: null,\n  max_depth: null,\n};\n","/**\n * @constant {Omit<TavernRegex, 'id' | 'scope'>} HIDE_ERA_THINKING_REGEX\n * @description\n * 用于隐藏发送给AI的ERA变量思考块\n * This regex is for hiding ERA variable thinking blocks sent to AI.\n *\n * - **find_regex**: 匹配 <thinking>...</thinking> 块。\n * - **replace_string**: 替换为空字符串，即删除匹配到的内容。\n * - **source**: 应用于 AI 输出。\n * - **destination**: 同时作用于“显示”和“提示词”两种场景。\n * - **run_on_edit**: 在编辑消息时也生效。\n */\nexport const HIDE_ERA_THINKING_REGEX: Omit<TavernRegex, 'id' | 'scope'> = {\n  script_name: 'ERA 思考块隐藏正则',\n  enabled: true,\n  run_on_edit: true,\n  find_regex: String.raw`/<variablethink>\\s*(?=[\\s\\S]*?\\S[\\s\\S]*?<\\/variablethink>)((?:(?!<variablethink>)[\\s\\S])*?)\\s*<\\/variablethink>/gi`,\n  replace_string: '',\n  source: {\n    user_input: true,\n    ai_output: true,\n    slash_command: false,\n    world_info: false,\n  },\n  destination: {\n    display: true,\n    prompt: true,\n  },\n  min_depth: null,\n  max_depth: null,\n};\n","import statusBarHtml from './status_bar.html?raw';\n\n/**\n * 转义 HTML 字符串，以便安全地用于正则表达式的替换字符串。\n * @param {string} html - 原始 HTML 字符串。\n * @returns {string} - 转义后的字符串。\n */\nfunction escapeHtmlForRegex(html: string): string {\n  // 移除可能干扰的注释\n  const withoutComments = html.replace(/<!--[\\s\\S]*?-->/g, '');\n  // 将字符串转换为 JSON 格式，这会自动处理大多数转义（如 \\n, \", \\）\n  const jsonString = JSON.stringify(withoutComments);\n  // 移除 JSON.stringify 添加的首尾引号\n  return jsonString.slice(1, jsonString.length - 1);\n}\n\n/**\n * @constant {Omit<TavernRegex, 'id' | 'scope'>} REPLACE_PLACEHOLDER_REGEX\n * @description\n * 用于将消息中的状态栏占位符替换为实际的状态栏 HTML。\n */\nexport const REPLACE_PLACEHOLDER_REGEX: Omit<TavernRegex, 'id' | 'scope'> = {\n  script_name: 'ERA 状态栏模板',\n  enabled: true,\n  run_on_edit: true,\n  find_regex: `/<StatusPlaceHolderImpl\\\\/>/gsi`,\n  replace_string: `\\`\\`\\`html\\n${statusBarHtml}\\n\\`\\`\\``,\n  source: {\n    user_input: false,\n    ai_output: true,\n    slash_command: false,\n    world_info: false,\n  },\n  destination: {\n    display: true,\n    prompt: false,\n  },\n  min_depth: null,\n  max_depth: null,\n};\n","import { ensureCharacterRegex } from '../../utils/regex';\nimport { HIDE_ERA_DATA_REGEX } from './regex_objects/hide_era_data';\nimport { HIDE_ERA_METADATA_REGEX } from './regex_objects/hide_era_metadata';\nimport { HIDE_ERA_THINKING_REGEX } from './regex_objects/hide_era_thinking';\nimport { REPLACE_PLACEHOLDER_REGEX } from './regex_objects/replace_placeholder';\nimport { Logger } from '../../utils/log';\n\nconst logger = new Logger();\n\n/**\n * @file 手动初始化模块 - 正则表达式\n * @description 该模块负责在需要时手动触发 ERA 框架相关的正则表达式的初始化。\n */\n\ntype InitRegexResult = {\n  success: boolean;\n  reason?: string;\n  details: {\n    regexName: string;\n    status: 'injected' | 'exists' | 'failed' | 'skipped';\n    reason?: string;\n  }[];\n};\n\n/**\n * 初始化 ERA 框架所需的所有角色卡级别的正则表达式。\n * @returns {Promise<InitRegexResult>} 返回一个包含详细操作结果的对象。\n */\nexport async function initEraCharacterRegexes(): Promise<InitRegexResult> {\n  if (!isCharacterTavernRegexesEnabled()) {\n    const reason = '当前角色卡未开启局部正则，请先在角色卡设置中启用。';\n    logger.warn('initEraCharacterRegexes', reason);\n    return { success: false, reason, details: [] };\n  }\n\n  const regexesToInject = [\n    HIDE_ERA_DATA_REGEX,\n    REPLACE_PLACEHOLDER_REGEX,\n    HIDE_ERA_METADATA_REGEX,\n    HIDE_ERA_THINKING_REGEX,\n  ];\n  const results = [];\n  let allSuccess = true;\n\n  for (const regex of regexesToInject) {\n    const result = await ensureCharacterRegex(regex);\n    results.push({\n      regexName: regex.script_name,\n      status: result.status,\n      reason: result.reason,\n    });\n    if (!result.success) {\n      allSuccess = false;\n    }\n  }\n\n  return { success: allSuccess, details: results };\n}\n","import _ from 'lodash';\nimport type { PartialDeep } from 'type-fest';\nimport { Logger } from './log';\n\nconst logger = new Logger();\n\n/**\n * 获取当前角色卡绑定的所有世界书名称\n * @returns 包含主世界书和附加世界书的数组\n */\nexport async function getBoundWorldbookNames(): Promise<string[]> {\n  const funcName = 'getBoundWorldbookNames';\n  logger.debug(funcName, '开始获取角色卡绑定的世界书...');\n  const charWorldbooks = await getCharWorldbookNames('current');\n  const worldbooks = [];\n  if (charWorldbooks.primary) {\n    worldbooks.push(charWorldbooks.primary);\n  }\n  worldbooks.push(...charWorldbooks.additional);\n  const uniqueWorldbooks = _.uniq(worldbooks);\n  logger.debug(funcName, '获取成功，绑定的世界书列表为：', uniqueWorldbooks);\n  return uniqueWorldbooks;\n}\n\n/**\n * 检查指定名称的条目是否存在于某个世界书中\n * @param worldbookName - 世界书的名称\n * @param entryName - 要检查的条目的名称\n * @returns 如果存在则返回 true，否则返回 false\n */\nexport async function isEntryInWorldbook(worldbookName: string, entryName: string): Promise<boolean> {\n  const funcName = 'isEntryInWorldbook';\n  try {\n    logger.debug(funcName, `正在检查世界书「${worldbookName}」中是否存在条目「${entryName}」...`);\n    const entries = await getWorldbook(worldbookName);\n    const exists = entries.some(entry => entry.name === entryName);\n    logger.debug(funcName, `检查完成，世界书「${worldbookName}」中${exists ? '存在' : '不存在'}条目「${entryName}」。`);\n    return exists;\n  } catch (error) {\n    logger.error(funcName, `获取世界书「${worldbookName}」时发生错误。`, error);\n    return false;\n  }\n}\n\ntype InjectionResult = {\n  success: boolean;\n  status: 'injected' | 'exists' | 'failed';\n  reason?: string;\n};\n\n/**\n * 向世界书注入一个新条目，如果同名条目已存在则不执行任何操作\n * @param worldbookName - 世界书的名称\n * @param newEntry - 要注入的新条目\n * @returns 一个包含操作结果的对象\n */\nexport async function injectEntryToWorldbook(\n  worldbookName: string,\n  newEntry: PartialDeep<WorldbookEntry>,\n): Promise<InjectionResult> {\n  const funcName = 'injectEntryToWorldbook';\n  if (!newEntry.name) {\n    const reason = '注入失败：新条目必须包含 name 字段。';\n    logger.error(funcName, reason);\n    return { success: false, status: 'failed', reason };\n  }\n\n  const entryExists = await isEntryInWorldbook(worldbookName, newEntry.name);\n  if (entryExists) {\n    logger.debug(funcName, `条目「${newEntry.name}」已存在于世界书「${worldbookName}」中，无需注入。`);\n    return { success: true, status: 'exists' };\n  }\n\n  try {\n    logger.debug(funcName, `正在向世界书「${worldbookName}」注入新条目「${newEntry.name}」...`);\n    await createWorldbookEntries(worldbookName, [newEntry]);\n    logger.debug(funcName, `成功向世界书「${worldbookName}」注入新条目「${newEntry.name}」。`);\n    return { success: true, status: 'injected' };\n  } catch (error) {\n    const reason = `向世界书「${worldbookName}」注入条目「${newEntry.name}」时发生错误。`;\n    logger.error(funcName, reason, error);\n    return { success: false, status: 'failed', reason };\n  }\n}\n\n/**\n * 创建一个新的世界书并将其设置为主世界书\n * @returns 新创建的世界书的名称\n */\nexport async function createAndBindPrimaryWorldbook(): Promise<string> {\n  const funcName = 'createAndBindPrimaryWorldbook';\n  const worldbookName = 'ERA卡示例世界书';\n  logger.debug(funcName, `正在创建新的世界书「${worldbookName}」...`);\n  await createWorldbook(worldbookName);\n\n  const charWorldbooks = await getCharWorldbookNames('current');\n  charWorldbooks.primary = worldbookName;\n\n  logger.debug(funcName, `正在将新世界书「${worldbookName}」绑定为当前角色卡的主世界书...`);\n  await rebindCharWorldbooks('current', charWorldbooks);\n\n  logger.debug(funcName, '创建并绑定成功。');\n  return worldbookName;\n}\n","import type { PartialDeep } from 'type-fest';\nimport content from './era_var_operation_rule.txt?raw';\n\nexport const ERA_VAR_OPERATION_RULE_ENTRY_NAME = 'ERA 变量操作规则';\n\nexport const eraVarOperationRuleEntry: PartialDeep<WorldbookEntry> = {\n  name: ERA_VAR_OPERATION_RULE_ENTRY_NAME,\n  content,\n  enabled: true,\n  strategy: {\n    type: 'constant',\n    keys: [],\n    keys_secondary: {\n      logic: 'and_any',\n      keys: [],\n    },\n    scan_depth: 'same_as_global',\n  },\n  position: {\n    type: 'at_depth',\n    role: 'system',\n    depth: 0,\n    order: 9999,\n  },\n  probability: 100,\n  recursion: {\n    prevent_incoming: false,\n    prevent_outgoing: false,\n    delay_until: null,\n  },\n  effect: {\n    sticky: null,\n    cooldown: null,\n    delay: null,\n  },\n};\n","import type { PartialDeep } from 'type-fest';\nimport content from './era_var_intent.txt?raw';\n\nexport const ERA_VAR_INTENT_ENTRY_NAME = 'ERA 变量意图说明';\n\nexport const eraVarIntentEntry: PartialDeep<WorldbookEntry> = {\n  name: ERA_VAR_INTENT_ENTRY_NAME,\n  content,\n  enabled: true,\n  strategy: {\n    type: 'constant',\n    keys: [],\n    keys_secondary: {\n      logic: 'and_any',\n      keys: [],\n    },\n    scan_depth: 'same_as_global',\n  },\n  position: {\n    type: 'at_depth',\n    role: 'system',\n    depth: 0,\n    order: 9998, // 比操作规则低一点\n  },\n  probability: 100,\n  recursion: {\n    prevent_incoming: false,\n    prevent_outgoing: false,\n    delay_until: null,\n  },\n  effect: {\n    sticky: null,\n    cooldown: null,\n    delay: null,\n  },\n};\n","import { createAndBindPrimaryWorldbook, injectEntryToWorldbook } from '../../utils/worldbook';\nimport { Logger } from '../../utils/log';\nimport { eraVarOperationRuleEntry } from './worldbook_entries/era_var_operation_rule';\nimport { eraVarIntentEntry } from './worldbook_entries/era_var_intent';\n\nconst logger = new Logger();\n\ntype InitWorldbookResult = {\n  success: boolean;\n  reason?: string;\n  details: {\n    entryName: string;\n    status: 'injected' | 'exists' | 'failed';\n    reason?: string;\n  }[];\n};\n\n/**\n * 初始化世界书，确保 ERA 相关条目存在于主世界书中。\n * @returns {Promise<InitWorldbookResult>} 返回一个包含详细操作结果的对象。\n */\nexport async function initEraWorldbookEntries(): Promise<InitWorldbookResult> {\n  const funcName = 'initEraWorldbookEntries';\n  logger.log(funcName, '开始世界书初始化...');\n\n  let charWorldbooks = await getCharWorldbookNames('current');\n  let primaryWorldbook = charWorldbooks.primary;\n\n  if (!primaryWorldbook) {\n    logger.warn(funcName, '当前角色卡未绑定主世界书，将创建并绑定一个新的世界书。');\n    try {\n      primaryWorldbook = await createAndBindPrimaryWorldbook();\n    } catch (error) {\n      const reason = '创建并绑定主世界书失败。';\n      logger.error(funcName, reason, error);\n      return { success: false, reason, details: [] };\n    }\n  } else {\n    logger.debug(funcName, `找到主世界书: 「${primaryWorldbook}」`);\n  }\n\n  const entriesToInject = [eraVarOperationRuleEntry, eraVarIntentEntry];\n  const results = [];\n  let allSuccess = true;\n\n  for (const entry of entriesToInject) {\n    if (!entry.name) {\n      logger.warn(funcName, '发现一个没有名称的世界书条目，已跳过。', entry);\n      continue;\n    }\n    const result = await injectEntryToWorldbook(primaryWorldbook, entry);\n    results.push({\n      entryName: entry.name,\n      status: result.status,\n      reason: result.reason,\n    });\n    if (!result.success) {\n      allSuccess = false;\n    }\n  }\n\n  logger.log(funcName, '世界书初始化完成。');\n  return { success: allSuccess, details: results };\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, withModifiers as _withModifiers, createTextVNode as _createTextVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n    class: \"action-buttons-card\",\n    role: \"complementary\",\n    \"aria-label\": \"ERA 快捷操作\"\n};\nconst _hoisted_2 = { class: \"btns\" };\nconst _hoisted_3 = { class: \"btn-group\" };\nconst _hoisted_4 = { class: \"btn-group\" };\nconst _hoisted_5 = { class: \"btn-group\" };\nimport toastr from 'toastr';\nimport { initEraCharacterRegexes } from '../../../initer/manual/regex';\nimport { initEraWorldbookEntries } from '../../../initer/manual/worldbook';\nimport { Logger } from '../../../utils/log'; // 中文注释：日志工具\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ActionButtons',\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/RightRailContent/ActionButtons\"); // 中文注释：实例化日志\n        async function onInjectRegex() {\n            logger.log('onInjectRegex', '点击“ERA 快速初始化”，开始注入...');\n            try {\n                // 检查是否存在第 0 条消息\n                try {\n                    const firstMessage = getChatMessages(0);\n                    if (!firstMessage || firstMessage.length === 0) {\n                        throw new Error('No messages found');\n                    }\n                }\n                catch (e) {\n                    toastr.error('然后再次点击快速初始化', '请在角色卡的开场白中添加任意内容。');\n                    logger.warn('onInjectRegex', '获取第 0 条消息失败，可能是因为聊天记录为空。', e);\n                    return;\n                }\n                // 初始化正则\n                const regexResult = await initEraCharacterRegexes();\n                if (!regexResult.success) {\n                    toastr.error(regexResult.reason ?? '未知错误', '正则初始化失败');\n                    logger.error('onInjectRegex', '正则注入失败:', regexResult.reason);\n                    return;\n                }\n                else {\n                    const injectedCount = regexResult.details.filter(d => d.status === 'injected').length;\n                    const existsCount = regexResult.details.filter(d => d.status === 'exists').length;\n                    let message = '';\n                    if (injectedCount > 0) {\n                        message += `成功注入 ${injectedCount} 个新正则。`;\n                    }\n                    if (existsCount > 0) {\n                        message += ` ${existsCount} 个正则已存在。`;\n                    }\n                    if (message) {\n                        toastr.success(message.trim(), '正则初始化完成');\n                    }\n                }\n                // 初始化世界书\n                const worldbookResult = await initEraWorldbookEntries();\n                if (!worldbookResult.success) {\n                    toastr.error(worldbookResult.reason ?? '一个或多个世界书条目注入失败。', '世界书初始化失败');\n                    logger.error('onInjectRegex', '世界书注入失败:', worldbookResult);\n                }\n                else {\n                    const injectedCount = worldbookResult.details.filter(d => d.status === 'injected').length;\n                    const existsCount = worldbookResult.details.filter(d => d.status === 'exists').length;\n                    let message = '';\n                    if (injectedCount > 0) {\n                        message += `成功注入 ${injectedCount} 个新条目。`;\n                    }\n                    if (existsCount > 0) {\n                        message += ` ${existsCount} 个条目已存在。`;\n                    }\n                    toastr.success(message.trim(), '世界书初始化完成');\n                }\n                logger.log('onInjectRegex', '初始化流程完成。');\n            }\n            catch (error) {\n                logger.error('onInjectRegex', '执行初始化时发生意外错误:', error);\n                toastr.error('发生意外错误，请检查控制台获取详细信息。', '初始化失败');\n            }\n        }\n        function onFullSync() {\n            // 中文注释：完全重算事件\n            logger.log('onFullSync', '点击“完全重算变量”，发送 manual_full_sync 事件。'); // 中文注释：日志\n            try {\n                eventEmit('manual_full_sync'); // 中文注释：发送全量重算事件（保持不变）\n                toastr.success('已发送“完全重算变量”请求。', '操作成功');\n            }\n            catch (error) {\n                logger.error('onFullSync', '发送 manual_full_sync 事件时出错:', error);\n                toastr.error('发送请求失败，请检查控制台。', '操作失败');\n            }\n        }\n        function onLastSync() {\n            // 中文注释：局部重算事件\n            logger.log('onLastSync', '点击“重算最后一楼变量”，发送 manual_sync 事件。'); // 中文注释：日志\n            try {\n                eventEmit('manual_sync'); // 中文注释：发送单楼重算事件（保持不变）\n                toastr.success('已发送“重算最后一楼变量”请求。', '操作成功');\n            }\n            catch (error) {\n                logger.error('onLastSync', '发送 manual_sync 事件时出错:', error);\n                toastr.error('发送请求失败，请检查控制台。', '操作失败');\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createCommentVNode(\" 右侧操作卡：外层自包含，不依赖父组件样式 \"),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createCommentVNode(\" 中文注释：操作卡容器 \"),\n                    _cache[8] || (_cache[8] = _createElementVNode(\"h4\", { class: \"card-title\" }, \"快捷操作\", -1 /* CACHED */)),\n                    _createCommentVNode(\" 中文注释：卡片标题 \"),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createCommentVNode(\" 中文注释：按钮垂直栈 \"),\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _createElementVNode(\"button\", {\n                                class: \"btn primary\",\n                                title: \"重新计算所有变量\",\n                                onClick: _withModifiers(onFullSync, [\"stop\"])\n                            }, [\n                                _createCommentVNode(\" 中文注释：主按钮 \"),\n                                _cache[0] || (_cache[0] = _createElementVNode(\"span\", {\n                                    class: \"ico\",\n                                    \"aria-hidden\": \"true\"\n                                }, \"🔄\", -1 /* CACHED */)),\n                                _createCommentVNode(\" 中文注释：图标 \"),\n                                _cache[1] || (_cache[1] = _createElementVNode(\"span\", { class: \"label\" }, \"完全重算变量\", -1 /* CACHED */)),\n                                _createCommentVNode(\" 中文注释：文字 \")\n                            ]),\n                            _cache[2] || (_cache[2] = _createElementVNode(\"p\", { class: \"btn-desc\" }, \" 当变量与预期不符时，点击此按钮可从**第一条消息**开始重新计算所有消息，以确保数据完全同步。这是一个非常耗时的操作。 \", -1 /* CACHED */))\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"button\", {\n                                class: \"btn subtle\",\n                                title: \"只重算最新一楼的变量\",\n                                onClick: _withModifiers(onLastSync, [\"stop\"])\n                            }, [\n                                _createCommentVNode(\" 中文注释：次按钮 \"),\n                                _cache[3] || (_cache[3] = _createElementVNode(\"span\", {\n                                    class: \"ico\",\n                                    \"aria-hidden\": \"true\"\n                                }, \"♻️\", -1 /* CACHED */)),\n                                _createCommentVNode(\" 中文注释：图标 \"),\n                                _cache[4] || (_cache[4] = _createElementVNode(\"span\", { class: \"label\" }, \"重算最后一楼变量\", -1 /* CACHED */)),\n                                _createCommentVNode(\" 中文注释：文字 \")\n                            ]),\n                            _cache[5] || (_cache[5] = _createElementVNode(\"p\", { class: \"btn-desc\" }, \" 仅根据最新一条消息重新计算变量，速度较快。适用于修复最近一次操作导致的小问题或在手动编辑了最后一条消息后重新写入变量（注意，era会无视所有**用户发送的消息**中的变量更新语句）。 \", -1 /* CACHED */))\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            _createElementVNode(\"button\", {\n                                class: \"btn danger\",\n                                title: \"为角色卡注入 ERA 规则\",\n                                onClick: _withModifiers(onInjectRegex, [\"stop\"])\n                            }, [...(_cache[6] || (_cache[6] = [\n                                    _createElementVNode(\"span\", {\n                                        class: \"ico\",\n                                        \"aria-hidden\": \"true\"\n                                    }, \"🥽\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", { class: \"label\" }, \"ERA 快速初始化\", -1 /* CACHED */)\n                                ]))]),\n                            _cache[7] || (_cache[7] = _createElementVNode(\"p\", { class: \"btn-desc\" }, [\n                                _createTextVNode(\" 【角色卡作者专用】点击后，会向当前角色卡注入四条规则：\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 1. 添加“ERA 数据隐藏正则”以隐藏聊天中的数据标签。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 2. 添加“ERA状态栏模板”以将模板状态栏替换至消息。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 3. 向角色主世界书中添加“ERA变量操作规则”条目以令ai明白era变量的操作规则。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 4. 向角色主世界书中添加“ERA变量意图说明”条目以存放变量意图说明。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 注意：作者可以用该功能快速注入使用era的几个基础配置。但你仍旧需要：\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 1. 自己设计角色卡用到的变量结构并写入角色的开场白。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 2. 在角色主世界书中‘ERA变量意图说明’条目中添加向ai说明各个变量的意图的提示词。\"),\n                                _createElementVNode(\"br\"),\n                                _createTextVNode(\" 3. 修改‘ERA状态栏模板’正则中的状态栏代码，令其与**你设计的变量系统匹配**。 \")\n                            ], -1 /* CACHED */))\n                        ])\n                    ])\n                ])\n            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ActionButtons.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ActionButtons.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./ActionButtons.vue?vue&type=style&index=0&id=3cd160a6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3cd160a6\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, withModifiers as _withModifiers, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelCheckbox as _vModelCheckbox, withDirectives as _withDirectives, vModelText as _vModelText, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, vShow as _vShow } from \"vue\";\nconst _hoisted_1 = {\n    class: \"settings-card\",\n    role: \"region\",\n    \"aria-label\": \"ERA 设置\"\n};\nconst _hoisted_2 = [\"aria-expanded\"];\nconst _hoisted_3 = {\n    class: \"chev\",\n    \"aria-hidden\": \"true\"\n};\nconst _hoisted_4 = { class: \"content\" };\nconst _hoisted_5 = { class: \"toolbar\" };\nconst _hoisted_6 = { class: \"vars\" };\nconst _hoisted_7 = [\"title\"];\nconst _hoisted_8 = { class: \"var-editor\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"switch\"\n};\nconst _hoisted_10 = [\"onUpdate:modelValue\"];\nconst _hoisted_11 = [\"onUpdate:modelValue\", \"placeholder\"];\nconst _hoisted_12 = [\"onUpdate:modelValue\", \"placeholder\"];\nconst _hoisted_13 = [\"onUpdate:modelValue\", \"placeholder\", \"onInput\"];\nconst _hoisted_14 = { class: \"type-chip\" };\nimport { reactive, ref } from 'vue'; // 中文注释：Vue 响应式 API\nimport toastr from 'toastr';\nimport { getScriptSettings, updateScriptSettings } from '../../../utils/era_data';\nimport { Logger } from '../../../utils/log'; // 中文注释：项目内日志工具\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'EraSettingsPanel',\n    setup(__props) {\n        /* 块头：逻辑说明\n           - 默认收起，展开时读取脚本域变量；\n           - 支持 boolean/number/string/json 四类编辑；\n           - 保存时按原类型回写到脚本域。\n        */\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/components/RightRailContent/EraSettingsPanel\"); // 中文注释：实例化日志\n        // === 折叠状态 ===\n        const isOpen = ref(false); // 中文注释：是否展开\n        // === 原始数据与编辑缓存 ===\n        const rows = ref([]); // 中文注释：可渲染的变量行\n        const edits = reactive({}); // 中文注释：针对简单类型的编辑缓存（布尔/数字/字符串）\n        const jsonBuffers = reactive({}); // 中文注释：针对 JSON 类型的文本缓存\n        const jsonState = reactive({}); // 中文注释：JSON 校验状态\n        // === 工具：类型判定与人类可读名 ===\n        function detectType(v) {\n            // 中文注释：检测变量类型\n            if (typeof v === 'boolean')\n                return 'boolean'; // 中文注释：布尔\n            if (typeof v === 'number' && Number.isFinite(v))\n                return 'number'; // 中文注释：有限数\n            if (typeof v === 'string')\n                return 'string'; // 中文注释：字符串\n            return 'json'; // 中文注释：其他一律归为 json（对象/数组/null/特殊数等）\n        }\n        function humanType(t) {\n            // 中文注释：类型中文名\n            return t === 'boolean' ? '布尔' : t === 'number' ? '数字' : t === 'string' ? '字符串' : 'JSON'; // 中文注释：映射\n        }\n        function safeStringify(v) {\n            // 中文注释：安全 JSON 序列化\n            try {\n                return JSON.stringify(v, null, 2);\n            }\n            catch {\n                return String(v);\n            } // 中文注释：失败则转字符串\n        }\n        // === 加载变量列表 ===\n        function loadVars() {\n            try {\n                logger.debug('loadVars', '尝试读取脚本设置...');\n                const obj = getScriptSettings();\n                logger.debug('loadVars', '成功读取脚本设置:', obj);\n                if (!obj || Object.keys(obj).length === 0) {\n                    logger.warn('loadVars', '设置对象为空，UI 将不会被填充。');\n                    rows.value = [];\n                    toastr.info('未找到任何脚本变量。');\n                    return;\n                }\n                // 清空旧缓存\n                rows.value = [];\n                for (const k of Object.keys(edits))\n                    delete edits[k];\n                for (const k of Object.keys(jsonBuffers))\n                    delete jsonBuffers[k];\n                for (const k of Object.keys(jsonState))\n                    delete jsonState[k];\n                // 构建可编辑行\n                Object.entries(obj)\n                    .filter(([key]) => key !== '开启悬浮球')\n                    .forEach(([key, value]) => {\n                    const t = detectType(value);\n                    rows.value.push({ key, value, type: t });\n                    if (t === 'json') {\n                        jsonBuffers[key] = safeStringify(value);\n                    }\n                    else {\n                        edits[key] = value;\n                    }\n                });\n                toastr.success('已从脚本变量中加载最新设置。', '读取成功');\n            }\n            catch (e) {\n                logger.error('loadVars', '读取脚本变量失败:', e);\n                toastr.error('读取 ERA 设置失败，请检查浏览器控制台。', '读取失败');\n            }\n        }\n        // === 展开折叠 ===\n        function onToggle() {\n            // 中文注释：切换展开\n            isOpen.value = !isOpen.value; // 中文注释：翻转状态\n            if (isOpen.value && rows.value.length === 0)\n                loadVars(); // 中文注释：首次展开时读取数据\n        }\n        // === JSON 文本域编辑标记 + 校验 ===\n        function markJsonTouched(key) {\n            // 中文注释：标记 JSON 文本改动并校验\n            const txt = jsonBuffers[key] ?? ''; // 中文注释：读取文本\n            if (txt.trim() === '') {\n                // 中文注释：空文本提示\n                jsonState[key] = { bad: true, ok: false, msg: '不能为空（若要设为 null 请写 null）' }; // 中文注释：空提示\n                return; // 中文注释：返回\n            }\n            try {\n                JSON.parse(txt);\n                jsonState[key] = { ok: true, bad: false, msg: 'JSON 格式有效' };\n            }\n            catch (e) {\n                // 中文注释：校验通过\n                jsonState[key] = { bad: true, ok: false, msg: `JSON 格式错误：${e?.message ?? ''}` };\n            } // 中文注释：校验失败\n        }\n        // === 丢弃未保存的编辑 ===\n        function discardEdits() {\n            // 中文注释：丢弃编辑\n            logger.log('discardEdits', '点击“丢弃修改”');\n            loadVars(); // 中文注释：重新读取覆盖本地改动\n            toastr.info('所有未保存的修改已被丢弃。', '操作完成');\n        }\n        // === 保存修改 ===\n        async function saveEdits() {\n            // 中文注释：保存到脚本域\n            try {\n                await updateScriptSettings(currentSettings => {\n                    const next = { ...currentSettings };\n                    // 合并简单类型的改动（布尔/数字/字符串）\n                    Object.entries(edits).forEach(([k, v]) => {\n                        const key = k;\n                        next[key] = v;\n                    });\n                    // 合并 JSON 文本改动（需先通过校验）\n                    Object.entries(jsonBuffers).forEach(([k, txt]) => {\n                        if (txt != null) {\n                            if (jsonState[k]?.bad)\n                                throw new Error(`键 ${k} 的 JSON 格式不正确`);\n                            const key = k;\n                            next[key] = JSON.parse(txt);\n                        }\n                    });\n                    return next;\n                });\n                logger.log('saveEdits', '脚本变量已保存');\n                toastr.success('设置已成功保存到脚本变量。', '保存成功');\n                window.dispatchEvent(new CustomEvent('era-settings-updated'));\n                loadVars();\n            }\n            catch (e) {\n                logger.error('saveEdits', '保存失败：', e);\n                toastr.error(`保存失败：${e?.message ?? e}`, '保存失败');\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createCommentVNode(\" 外层卡片：与 ActionButtons 保持一致的玻璃卡风格，但默认收起 \"),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createCommentVNode(\" 设置卡片容器 \"),\n                    _createCommentVNode(\" 标题行：可点击折叠/展开 \"),\n                    _createElementVNode(\"button\", {\n                        class: \"card-header\",\n                        \"aria-expanded\": isOpen.value,\n                        onClick: onToggle\n                    }, [\n                        _createCommentVNode(\" 点击切换展开状态 \"),\n                        _cache[0] || (_cache[0] = _createElementVNode(\"span\", { class: \"title\" }, \"ERA 设置\", -1 /* CACHED */)),\n                        _createCommentVNode(\" 标题文字 \"),\n                        _createElementVNode(\"span\", _hoisted_3, _toDisplayString(isOpen.value ? '▾' : '▸'), 1 /* TEXT */),\n                        _createCommentVNode(\" 展开箭头 \")\n                    ], 8 /* PROPS */, _hoisted_2),\n                    _createCommentVNode(\" 内容体：默认收起；展开后显示变量列表与操作 \"),\n                    _withDirectives(_createElementVNode(\"div\", _hoisted_4, [\n                        _createCommentVNode(\" 展开内容容器 \"),\n                        _createCommentVNode(\" 顶部操作区：刷新/保存/重置编辑 \"),\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            _createCommentVNode(\" 工具条 \"),\n                            _createElementVNode(\"button\", {\n                                class: \"mini-btn\",\n                                title: \"重新读取脚本变量\",\n                                onClick: _withModifiers(loadVars, [\"stop\"])\n                            }, \"🔄 重新读取\"),\n                            _createCommentVNode(\" 读取按钮 \"),\n                            _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"spacer\" }, null, -1 /* CACHED */)),\n                            _createCommentVNode(\" 占位撑开 \"),\n                            _createElementVNode(\"button\", {\n                                class: \"mini-btn subtle\",\n                                title: \"丢弃未保存的修改\",\n                                onClick: _withModifiers(discardEdits, [\"stop\"])\n                            }, \"↩︎ 丢弃修改\"),\n                            _createCommentVNode(\" 丢弃编辑 \"),\n                            _createElementVNode(\"button\", {\n                                class: \"mini-btn primary\",\n                                title: \"保存修改到脚本变量\",\n                                onClick: _withModifiers(saveEdits, [\"stop\"])\n                            }, \"💾 保存修改\"),\n                            _createCommentVNode(\" 保存修改 \")\n                        ]),\n                        _createCommentVNode(\" 变量列表：逐项渲染 \"),\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            (rows.value.length > 0)\n                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                    _createCommentVNode(\" 有变量时渲染列表 \"),\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(rows.value, (row) => {\n                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                            key: row.key,\n                                            class: \"var-row\"\n                                        }, [\n                                            _createCommentVNode(\" 每个变量一行 \"),\n                                            _createElementVNode(\"label\", {\n                                                class: \"var-key\",\n                                                title: row.key\n                                            }, _toDisplayString(row.key), 9 /* TEXT, PROPS */, _hoisted_7),\n                                            _createCommentVNode(\" 变量名 \"),\n                                            _createCommentVNode(\" 根据变量类型选择不同的编辑控件 \"),\n                                            _createElementVNode(\"div\", _hoisted_8, [\n                                                _createCommentVNode(\" 编辑器容器 \"),\n                                                _createCommentVNode(\" 布尔：勾选框 \"),\n                                                (row.type === 'boolean')\n                                                    ? (_openBlock(), _createElementBlock(\"label\", _hoisted_9, [\n                                                        _createCommentVNode(\" 自定义开关外观 \"),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": ($event) => ((edits[row.key]) = $event),\n                                                            type: \"checkbox\"\n                                                        }, null, 8 /* PROPS */, _hoisted_10), [\n                                                            [_vModelCheckbox, edits[row.key]]\n                                                        ]),\n                                                        _createCommentVNode(\" 勾选值 \"),\n                                                        _cache[2] || (_cache[2] = _createElementVNode(\"span\", { class: \"track\" }, null, -1 /* CACHED */)),\n                                                        _createCommentVNode(\" 轨道 \")\n                                                    ]))\n                                                    : (row.type === 'number')\n                                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                                            _createCommentVNode(\" 数字：number 输入 \"),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": ($event) => ((edits[row.key]) = $event),\n                                                                type: \"number\",\n                                                                class: \"ipt\",\n                                                                placeholder: String(row.value)\n                                                            }, null, 8 /* PROPS */, _hoisted_11), [\n                                                                [\n                                                                    _vModelText,\n                                                                    edits[row.key],\n                                                                    void 0,\n                                                                    { number: true }\n                                                                ]\n                                                            ]),\n                                                            _createCommentVNode(\" 数字输入 \")\n                                                        ], 64 /* STABLE_FRAGMENT */))\n                                                        : (row.type === 'string')\n                                                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                                                                _createCommentVNode(\" 字符串：text 输入 \"),\n                                                                _withDirectives(_createElementVNode(\"input\", {\n                                                                    \"onUpdate:modelValue\": ($event) => ((edits[row.key]) = $event),\n                                                                    type: \"text\",\n                                                                    class: \"ipt\",\n                                                                    placeholder: String(row.value)\n                                                                }, null, 8 /* PROPS */, _hoisted_12), [\n                                                                    [_vModelText, edits[row.key]]\n                                                                ]),\n                                                                _createCommentVNode(\" 文本输入 \")\n                                                            ], 64 /* STABLE_FRAGMENT */))\n                                                            : (_openBlock(), _createElementBlock(_Fragment, { key: 3 }, [\n                                                                _createCommentVNode(\" 其他（对象/数组/null/未知）：JSON 文本域 \"),\n                                                                _withDirectives(_createElementVNode(\"textarea\", {\n                                                                    \"onUpdate:modelValue\": ($event) => ((jsonBuffers[row.key]) = $event),\n                                                                    class: \"ipt ta\",\n                                                                    placeholder: safeStringify(row.value),\n                                                                    onInput: ($event) => (markJsonTouched(row.key))\n                                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_13), [\n                                                                    [_vModelText, jsonBuffers[row.key]]\n                                                                ]),\n                                                                _createCommentVNode(\" JSON 文本域 \"),\n                                                                _createElementVNode(\"span\", {\n                                                                    class: _normalizeClass([\"hint\", { ok: jsonState[row.key]?.ok, bad: jsonState[row.key]?.bad }])\n                                                                }, _toDisplayString(jsonState[row.key]?.msg ?? '以 JSON 格式编辑此值'), 3 /* TEXT, CLASS */),\n                                                                _createCommentVNode(\" JSON 校验提示 \")\n                                                            ], 64 /* STABLE_FRAGMENT */))\n                                            ]),\n                                            _createCommentVNode(\" 类型徽标 \"),\n                                            _createElementVNode(\"span\", _hoisted_14, _toDisplayString(humanType(row.type)), 1 /* TEXT */),\n                                            _createCommentVNode(\" 类型展示 \")\n                                        ]));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ], 64 /* STABLE_FRAGMENT */))\n                                : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                    _createCommentVNode(\" 没有变量时的占位 \"),\n                                    _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"placeholder\" }, [\n                                        _createElementVNode(\"p\", null, \"未读取到任何脚本变量。\"),\n                                        _createCommentVNode(\" 文本提示 \"),\n                                        _createElementVNode(\"p\", { class: \"dim\" }, [\n                                            _createTextVNode(\" 请先确保在 \"),\n                                            _createElementVNode(\"code\", null, \"app_ready\"),\n                                            _createTextVNode(\" 或初始化阶段通过 \"),\n                                            _createElementVNode(\"code\", null, \"initializeExternalSettings()\"),\n                                            _createTextVNode(\" 写入默认变量。 \")\n                                        ]),\n                                        _createCommentVNode(\" 辅助说明 \")\n                                    ], -1 /* CACHED */))\n                                ], 64 /* STABLE_FRAGMENT */))\n                        ])\n                    ], 512 /* NEED_PATCH */), [\n                        [_vShow, isOpen.value]\n                    ])\n                ])\n            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./EraSettingsPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./EraSettingsPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./EraSettingsPanel.vue?vue&type=style&index=0&id=7e3f3b77&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-7e3f3b77\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"right-rail\" };\nconst _hoisted_2 = { class: \"right-rail-content-wrapper\" };\nimport AboutEra from './RightRailContent/AboutEra.vue';\nimport ActionButtons from './RightRailContent/ActionButtons.vue';\nimport EraSettingsPanel from './RightRailContent/EraSettingsPanel.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'RightRail',\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"aside\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createVNode(ActionButtons),\n                    _createVNode(EraSettingsPanel),\n                    _createVNode(AboutEra)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./RightRail.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./RightRail.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./RightRail.vue?vue&type=style&index=0&id=61d00544&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-61d00544\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ThemeManager',\n    setup(__props, { expose: __expose }) {\n        const isDarkMode = ref(false);\n        // 通过 defineExpose 将状态和方法暴露给父组件\n        __expose({\n            isDarkMode,\n        });\n        return () => { };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ThemeManager.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ThemeManager.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./ThemeManager.vue?vue&type=style&index=0&id=dc652d14&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineStore } from 'pinia';\nimport { ref } from 'vue';\nimport type { WriteDonePayload } from '../utils/constants';\n\nexport const useUiStore = defineStore('ui', () => {\n  const currentView = ref<'FloatingBall' | 'ExpandedView'>('FloatingBall');\n  const eventData = ref<WriteDonePayload | null>(null);\n\n  function switchView(viewName: 'FloatingBall' | 'ExpandedView') {\n    if (currentView.value !== viewName) {\n      currentView.value = viewName;\n    }\n  }\n\n  function setEventData(data: WriteDonePayload | null) {\n    eventData.value = data;\n  }\n\n  return {\n    currentView,\n    eventData,\n    switchView,\n    setEventData,\n  };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createVNode as _createVNode, unref as _unref, vShow as _vShow, withDirectives as _withDirectives, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"era-expanded-layer\" };\nconst _hoisted_2 = { class: \"era-shell\" };\nimport { storeToRefs } from 'pinia';\nimport { onBeforeUnmount, onMounted, ref } from 'vue';\nimport { getScriptSettings } from '../utils/era_data';\nimport { Logger } from '../utils/log';\nimport EraPanel from './components/EraPanel.vue';\nimport FloatingBall from './components/FloatingBall.vue';\nimport RightRail from './components/RightRail.vue';\nimport ThemeManager from './components/ThemeManager.vue';\nimport { useUiStore } from './store';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const logger = new Logger(\"ERA\\u53D8\\u91CF\\u6846\\u67B6/ui/App\");\n        // 从 Pinia store 获取状态和 action\n        const uiStore = useUiStore();\n        const { currentView: currentComponent, eventData: dataRef } = storeToRefs(uiStore);\n        // 主题状态管理\n        const themeManager = ref(null);\n        const isDarkMode = ref(false);\n        const loadThemeSetting = () => {\n            try {\n                const settings = getScriptSettings();\n                const darkModeValue = settings?.['开启黑夜模式'] ?? false;\n                isDarkMode.value = darkModeValue;\n                if (themeManager.value) {\n                    themeManager.value.isDarkMode = darkModeValue;\n                }\n                logger.debug('loadThemeSetting', `主题已更新为: ${darkModeValue ? 'Dark' : 'Light'}`);\n            }\n            catch (e) {\n                logger.error('loadThemeSetting', '加载主题设置失败', e);\n                isDarkMode.value = false; // Fallback to light mode\n            }\n        };\n        onMounted(() => {\n            loadThemeSetting();\n            window.addEventListener('era-settings-updated', loadThemeSetting);\n        });\n        onBeforeUnmount(() => {\n            window.removeEventListener('era-settings-updated', loadThemeSetting);\n        });\n        const requestSwitchView = (viewName) => {\n            logger.debug('requestSwitchView', `请求切换视图到: ${viewName}`);\n            uiStore.switchView(viewName);\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"era-app-container\", { 'dark-theme': isDarkMode.value }])\n            }, [\n                _createVNode(ThemeManager, {\n                    ref_key: \"themeManager\",\n                    ref: themeManager\n                }, null, 512 /* NEED_PATCH */),\n                _withDirectives(_createVNode(FloatingBall, {\n                    onClick: _cache[0] || (_cache[0] = ($event) => (requestSwitchView('ExpandedView')))\n                }, null, 512 /* NEED_PATCH */), [\n                    [_vShow, _unref(currentComponent) === 'FloatingBall']\n                ]),\n                _withDirectives(_createElementVNode(\"div\", _hoisted_1, [\n                    _createCommentVNode(\" 视口级展开层：悬浮模态容器 \"),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createCommentVNode(\" 新增横向壳容器：左面板 + 右侧栏 \"),\n                        _createVNode(EraPanel, { data: _unref(dataRef) }, null, 8 /* PROPS */, [\"data\"]),\n                        _createVNode(RightRail)\n                    ])\n                ], 512 /* NEED_PATCH */), [\n                    [_vShow, _unref(currentComponent) === 'ExpandedView']\n                ])\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=17743fb0&lang=css\"\nimport \"./App.vue?vue&type=style&index=1&id=17743fb0&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.22_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-17743fb0\"]])\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport { createApp, App as VueApp } from 'vue';\nimport { getScriptSettings } from '../utils/era_data';\nimport { Logger } from '../utils/log';\nimport App from './App.vue';\nimport { useUiStore } from './store';\nimport { createMountPoint, destroyMountPoint, deteleportStyle, teleportStyle } from './utils/dom';\n\nconst logger = new Logger();\nlet vueApp: VueApp | null = null;\nlet mountPoint: JQuery<HTMLDivElement> | null = null;\n\n/**\n * 切换视图的全局函数\n * @param viewName 要切换到的视图名称\n */\nfunction switchView(viewName: 'FloatingBall' | 'ExpandedView') {\n  logger.debug('switchView', `请求切换视图到: ${viewName}`);\n  // 初始化后，store 实例将可用\n  if ((window as any).eraUiStore) {\n    (window as any).eraUiStore.switchView(viewName);\n  } else {\n    logger.warn('switchView', 'UI store尚未初始化');\n  }\n}\n\n// 暴露切换函数到 window\n(window as any).eraUiSwitchView = switchView;\n\nfunction unmountVueApp() {\n  if (vueApp) {\n    logger.debug('unmountVueApp', '卸载 Vue 实例');\n    vueApp.unmount();\n    vueApp = null;\n  }\n}\n\nfunction unloadUI() {\n  logger.log('unloadUI', 'UI 脚本开始卸载');\n  unmountVueApp();\n  deteleportStyle();\n  if (mountPoint) {\n    logger.debug('unloadUI', '销毁挂载点');\n    destroyMountPoint();\n    mountPoint = null;\n  }\n  // 卸载时自我清理，防止内存泄漏\n  window.removeEventListener('pagehide', unloadUI);\n  logger.log('unloadUI', 'UI 脚本卸载完成');\n}\n\n// 在加载时执行\n$(() => {\n  const settings = getScriptSettings();\n  if (settings['开启悬浮球'] === false) {\n    logger.log('initialize', '悬浮球设置为关闭，开始卸载UI...');\n    unloadUI();\n    return;\n  }\n  logger.log('initialize', 'UI 脚本开始初始化');\n  // 创建挂载点\n  mountPoint = createMountPoint();\n  logger.debug('$(document).ready', '创建挂载点', mountPoint);\n\n  // 将挂载点添加到 body\n  $('body').append(mountPoint);\n  logger.debug('$(document).ready', '挂载点已添加到 body');\n\n  // 创建并挂载 Vue 实例\n  vueApp = createApp(App);\n  const pinia = createPinia();\n  vueApp.use(pinia);\n  vueApp.mount(mountPoint[0]);\n\n  // 获取 store 实例并暴露到 window，以便外部函数调用\n  const uiStore = useUiStore(pinia);\n  (window as any).eraUiStore = uiStore;\n\n  // 传送样式，也只执行一次\n  teleportStyle();\n  logger.debug('initialize', 'Vue App 已挂载，样式已传送');\n\n  // 监听 era:writeDone 事件\n  eventOn('era:writeDone', (data: any) => {\n    logger.log('era:writeDone', '接收到 era:writeDone 事件，更新 store', data);\n    uiStore.setEventData(data); // 通过 store action 更新数据\n  });\n  logger.debug('$(document).ready', '已设置 era:writeDone 事件监听器');\n\n  // 在卸载时执行，并确保只绑定一次\n  window.removeEventListener('pagehide', unloadUI); // 先移除旧的\n  window.addEventListener('pagehide', unloadUI); // 再添加新的\n});\n","export function createMountPoint(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('id', `era-ui-mount-point-${getScriptId()}`).css({\n    position: 'fixed',\n    bottom: '20px',\n    left: '20px',\n    'z-index': 10000,\n  }) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyMountPoint(): void {\n  $(`div#era-ui-mount-point-${getScriptId()}`).remove();\n}\n\nexport function teleportStyle(): void {\n  const scriptId = getScriptId();\n  // 先移除旧的，确保样式是最新的\n  $(`head > div[script_id=\"${scriptId}\"]`).remove();\n\n  const $div = $('<div>').attr('script_id', scriptId).append($(document).find('head > style').clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle(): void {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n","/**\n * @file ERA 变量框架 - 主入口与事件监听模块\n * @description\n * 该文件是整个 ERA 变量框架的起点。它的职责非常清晰和专一：\n * 1. **定义监听范围**: 声明框架所关心的所有事件类型。\n * 2. **注册监听器**: 为上述所有事件注册监听器。\n * 3. **统一派发**: 当任何一个被监听的事件触发时，它不进行任何逻辑处理，\n *    而是立即将该事件（包括事件类型和附带数据）原封不动地推入到 `event_queue.ts`\n *    中的事件处理队列中。\n *\n * 这种设计体现了良好的**关注点分离**原则：`index.ts` 只负责“听”，而 `event_queue.ts`\n * 负责“思考”和“行动”。这使得事件的来源和处理逻辑完全解耦，非常清晰且易于维护。\n */\n\n'use strict';\n\nimport { EVENT_GROUPS } from './events/merger';\nimport { pushToQueue } from './events/queue';\n\n// 导入查询模块, 以注册 {{ERA:...}} 宏\nimport './macro/parser';\nimport './macro/placeholder';\n\n// 导入 UI 模块\nimport './ui';\n\n// ===============================\n// 事件监听器注册\n// ===============================\n\n/**\n * @const {string[]} eventsToListen\n * @description 定义了所有需要被 ERA 框架监听的事件。\n */\nconst eventsToListen = [\n  ...EVENT_GROUPS.INIT,\n  ...EVENT_GROUPS.SYNC,\n  ...EVENT_GROUPS.API,\n  ...EVENT_GROUPS.UPDATE_MK_ONLY,\n  ...EVENT_GROUPS.COLLISION_DETECTORS,\n  ...EVENT_GROUPS.COMBO_STARTERS,\n];\n\n// 遍历事件列表，为每个事件注册一个回调函数。\n// 这个回调函数是所有事件的统一入口。\neventsToListen.forEach(ev => {\n  // `eventOn` 是酒馆助手提供的全局函数，用于注册事件监听。\n  // 当事件 `ev` 触发时，回调函数被调用，并将事件类型 `ev` 和事件详情 `detail` 推入队列。\n  eventOn(ev, (detail: any) => pushToQueue(ev, detail));\n});\n\n// 为酒馆助手脚本界面中的手动按钮注册监听器。\n// 点击按钮时，同样是向队列中推入一个特定类型的事件。\neventOn(getButtonEvent('写入变量修改'), () => pushToQueue('manual_write'));\neventOn(getButtonEvent('手动同步状态'), () => pushToQueue('manual_sync'));\neventOn(getButtonEvent('强制完全重算'), () => pushToQueue('manual_full_sync'));\n"],"names":["content","__esModule","default","module","id","locals","exports","add","___CSS_LOADER_EXPORT___","push","cssWithMappingToString","list","toString","this","map","item","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","listToStyles","parentId","styles","newStyles","part","css","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","sfc","props","target","__vccOpts","key","val","cssMapping","base64","data","sourceMapping","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","z","SettingsSchema","object","boolean","string","number","CHAT_SCOPE","META_DATA_PATH","STAT_DATA_PATH","LOGS_PATH","SEL_PATH","ERA_DATA_TAG","ERA_DATA_REGEX","RegExp","ERA_API_EVENTS","INSERT_BY_OBJECT","UPDATE_BY_OBJECT","INSERT_BY_PATH","UPDATE_BY_PATH","DELETE_BY_OBJECT","DELETE_BY_PATH","GET_CURRENT_VARS","GET_SNAPSHOT_AT_MK","GET_SNAPSHOTS_BETWEEN_MKS","GET_SNAPSHOT_AT_MID","GET_SNAPSHOTS_BETWEEN_MIDS","REQUEST_WRITE_DONE","ERA_EVENT_EMITTER","DEBUG_CONFIG_LS_KEY","enabledPatterns","disabledPatterns","loadDebugConfig","configStr","globalThis","localStorage","getItem","config","parse","toRegex","p","replace","enabled","disabled","e","console","error","updateConfig","newConfig","uniqueConfig","Set","setItem","log","eraDebug","pattern","delete","Array","from","status","clear","logContext","mk","Logger","moduleName","constructor","_getModuleNameFromStack","callerLine","stack","split","find","line","includes","match","formatMessage","funcName","message","String","debug","some","re","formattedMessage","warn","errorObj","logger","EVENT_GROUPS","INIT","tavern_events","APP_READY","SYNC","MESSAGE_RECEIVED","MESSAGE_DELETED","MESSAGE_SWIPED","CHAT_CHANGED","API","values","UPDATE_MK_ONLY","MESSAGE_SENT","COLLISION_DETECTORS","GENERATION_STARTED","COMBO_STARTERS","MESSAGE_UPDATED","EVENT_COLLISION_MAP","Map","next","maxInterval","EVENT_COMBO_MAP","resultType","EVENT_DEBOUNCE_MAP","getEventGroup","eventType","mergeEventBatch","batchToProcess","originalEvents","_","cloneDeep","finalJobs","currentJob","prevJob","timeDifference","timestamp","comboRule","pop","detail","collisionRule","prevGroup","filteredJobs","job","group","isOrphanedDetector","isOrphanedComboStarter","before","after","removeMetaFields","recurse","current","isArray","forEach","startsWith","getEraData","chatVars","getVariables","meta","stat","async","updateEraMetaData","updater","updateVariablesWith","v","currentMeta","newMeta","getScriptSettings","rawSettings","script_id","getScriptId","updateScriptSettings","currentSettings","ESCAPE_MAP","UNESCAPE_MAP","invert","escapeRegex","keys","escapeRegExp","unescapeRegex","escapeEraData","isPlainObject","unescapeEraData","sanitizeArrays","mergeReplaceArray","base","patch","mergeWith","b","raw","s","arr","parseJsonl","str","objects","strWithoutComments","result","inString","char","nextChar","endOfLine","indexOf","endOfComment","substring","stripComments","trimmedStr","trim","braceCount","startIndex","jsonString","stripCodeFence","t","createTagRegex","keyword","mode","escapedKeyword","findTagFromEndByRegex","text","tagNameRegex","endIndex","closeTagRegex","source","currentMatch","lastMatch","exec","tagName","closeIndex","openTag","openIndex","lastIndexOf","containsXMLTags","extractValidBlocks","targetTagNameRegex","toSimplified","processedText","found","slice","removeTagsByRegex","extracted","blocks","searchIndex","unshift","extractBlocksByRegex","validBlocks","block","cleanedBlock","simplifiedBlock","traditionalToSimplified","converter","to","parseCharacterMacros","SillyTavern","name1","name2","getMessageContent","msg","mes","swipes","sid","Number","swipe_id","isUserMessage","messageContent","customFormatBlock","keyMatch","typeMatch","eraData","parseEraData","role","findLastAiMessage","messages","getChatMessages","include_swipes","message_id","updateMessageContent","newContent","refresh","oldContent","updatePayload","newSwipes","setChatMessages","readMessageKey","ensureMessageKey","isNew","existingMk","newMk","Date","now","Math","random","messageType","dataString","updateLatestSelectedMk","MK","selectedMks","set","initializeExternalSettings","settings","$","applyRollback","entry","op","path","unset","value_old","applyForward","value_new","calculateStatAt","targetMK","allLogs","targetIndex","errorMsg","tempStat","mkToApply","findLatestNewValue","startMessageId","selectedMksCount","editLogForMk","logEntry","subPath","parentNewVal","has","foundVal","getStatAtMK","getStatsBetweenMKs","startMk","endMk","validMks","actualStartMk","results","currentStat","calculateAllStatsBetweenMks","debouncedEmitApiWrite","debounce","eventEmit","leading","trailing","emitWriteDoneEvent","payload","statWithoutMeta","fullPayload","editLogs","inputPayload","emitQueryResultEvent","queryType","request","lastWriteDonePayload","performApiWrite","contentString","J","blockContent","blockTag","lastAiMessage","handleApiEvent","actionsTaken","api","updateByObject","updateByPath","deleteByObject","deleteByPath","lastMk","lastMessageId","lastMessage","is_user","handleGetCurrentVars","handleGetSnapshotAtMk","handleGetSnapshotsBetweenMks","handleGetSnapshotAtMId","startId","endId","handleGetSnapshotsBetweenMIds","eventOn","applyDeleteAtLevel","statData","basePath","patchObj","editLog","currentNodeInVars","necessary","metaPatch","isBypassingProtection","isEmpty","valOld","getInheritedTemplateContent","parentTplContent","prototypeContent","specificContent","merged","applyInsertAtLevel","inheritedContent","parentData","localTplContent","parentNodeData","varsContent","mergedContent","resolveTemplate","composed","tplContent","applyTemplateToPatch","finalValue","subPatch","subInheritedContent","applyEditAtLevel","messageId","isUpdatable","valNew","cleaned","ApplyVarChangeForMessage","initialStat","allInserts","allEdits","allDeletes","rawContent","insertBlocks","editBlocks","deleteBlocks","rawInserts","flatMap","rawEdits","rawDeletes","inserts","edits","deletes","extractAndParseCommands","finalStat","statAfterInsert","insertLog","insertRoot","processInsertBlocks","statAfterEdit","editBlockLog","editRoot","processEditBlocks","statAfterDelete","deleteLog","deleteRoot","processDeleteBlocks","finalEditLog","err","getMkFromMsg","findDivergencePoint","allMessages","oldSelectedMks","initialMeta","forceFullResync","recalcId","currentMks","firstMismatch","minLength","min","deletedMks","difference","mks","metaData","checkEditLogsAreEmpty","newSelectedMks","resyncStateOnHistoryChange","divergence","firstRecalcId","statForRecalc","currentMK","currentIndex","mkToRollback","rollbackStatToMK","metaForRecalc","contextMeta","newStat","updateEraStatData","forceRenderMessage","handleSyncEvent","isFullSync","resync","scriptVars","messageCount","Promise","resolve","setTimeout","recentMessages","forceRenderRecentMessages","consecutiveMkState","updateConsecutiveMkCount","count","dispatchAndExecuteTask","mkToIgnore","eventGroup","rollback","apply","apiWrite","messageOrId","retries","delay","getMessageContentWithRetry","msgId","isNewKey","latestMessage","ensureMkForLatestMessage","chat_message","placeholder","currentContent","newMessage","trimEnd","ensurePlaceholder","ignoreCount","shouldSkip","newIgnoreRule","currentMk","CHARACTER_MESSAGE_RENDERED","handleRedundantRenderEvent","actions","consecutiveProcessingCount","handleUpdateMkOnlyEvent","eventQueue","isProcessing","isWaiting","unlockSignal","pushToQueue","firstJob","debounceTime","splice","signal","processQueue","registerMacroLike","context","withMeta","trimmedPath","includeMeta","dataBeforeUnescape","finalData","parseEraMacros","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","__name","title","defaultOpen","setup","__props","open","ref","_ctx","_cache","onClick","$event","$slots","_hoisted_6","_hoisted_7","_hoisted_8","isUser","onMounted","watch","newProps","deep","defineComponent","name","required","level","defaultCollapsed","maxDepth","computed","isObject","foldable","newOpenState","primitiveText","summary","childEntries","out","cv","idx","$props","$setup","$data","$options","_component_JsonNode","style","paddingLeft","childVal","childKey","isPlainObjectOrArray","primitiveType","isArrayRoot","rootOpen","rootClose","JsonNode","EraAccordion","PrettyJsonViewer","tabs","active","emits","emit","__emit","innerActive","label","_hoisted_9","_hoisted_10","latestData","latestMkFromProps","selectedMk","messageIdInput","historicalSnapshot","loading","activeTab","reversedSelectedMks","reverse","displayData","isUserMessageComputed","newLatestMk","immediate","handleSelectionChange","queryByMId","handleQueryResult","handleResult","formatMkForDisplay","isLatest","onUnmounted","eventRemoveListener","for","onChange","onKeyup","MetaHeader","TabSwitch","pure","Infinity","full","viewName","window","eraUiSwitchView","OperationDetails","SnapshotManager","$emit","toastr","ensureCharacterRegex","regexData","isCharacterTavernRegexesEnabled","reason","success","getTavernRegexes","scope","regex","script_name","updateTavernRegexesWith","regexes","HIDE_ERA_DATA_REGEX","run_on_edit","find_regex","replace_string","user_input","ai_output","slash_command","world_info","destination","display","prompt","min_depth","max_depth","HIDE_ERA_METADATA_REGEX","HIDE_ERA_THINKING_REGEX","REPLACE_PLACEHOLDER_REGEX","injectEntryToWorldbook","worldbookName","newEntry","entryExists","entryName","exists","getWorldbook","isEntryInWorldbook","createWorldbookEntries","eraVarOperationRuleEntry","strategy","keys_secondary","logic","scan_depth","position","depth","order","probability","recursion","prevent_incoming","prevent_outgoing","delay_until","effect","sticky","cooldown","eraVarIntentEntry","initEraWorldbookEntries","primaryWorldbook","getCharWorldbookNames","primary","createWorldbook","charWorldbooks","rebindCharWorldbooks","createAndBindPrimaryWorldbook","details","entriesToInject","allSuccess","onInjectRegex","firstMessage","regexResult","regexesToInject","regexName","initEraCharacterRegexes","injectedCount","existsCount","worldbookResult","onFullSync","onLastSync","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","isOpen","rows","reactive","jsonBuffers","jsonState","safeStringify","loadVars","entries","isFinite","onToggle","discardEdits","saveEdits","txt","bad","dispatchEvent","CustomEvent","row","onInput","ok","ActionButtons","EraSettingsPanel","AboutEra","expose","__expose","isDarkMode","useUiStore","currentView","eventData","switchView","setEventData","uiStore","currentComponent","dataRef","themeManager","loadThemeSetting","darkModeValue","addEventListener","onBeforeUnmount","removeEventListener","ThemeManager","ref_key","FloatingBall","EraPanel","RightRail","vueApp","mountPoint","unloadUI","unmount","eraUiStore","attr","bottom","left","append","createApp","App","pinia","use","mount","scriptId","$div","clone","teleportStyle","ev","getButtonEvent"],"sourceRoot":""}
