_;class e{moduleName;constructor(e){this.moduleName=e}formatMessage(e,t){return`《ERA-事件监听器》「${this.moduleName}」【${e}】${String(t)}`}debug(e,t,...s){console.debug(this.formatMessage(e,t),...s)}log(e,t,...s){console.log(`%c${this.formatMessage(e,t)}`,'color: #3498db;',...s)}warn(e,t,...s){console.warn(`%c${this.formatMessage(e,t)}`,'color: #f39c12;',...s)}error(e,t,...s){const n=this.formatMessage(e,t);s.length>0?console.error(`%c${n}`,'color: #e74c3c; font-weight: bold;',...s):console.error(`%c${n}`,'color: #e74c3c; font-weight: bold;')}}(()=>{const t=new e('事件监听器');let s=0,n=Promise.resolve(),r=!1;const o=e=>{n=n.then(e).catch(e=>{t.error('enqueue',`【监听错误】${e?.message||e}`,e)})},a=e=>{const n=(...n)=>{const a=++s,c=performance&&performance.now?performance.now():Date.now();o(async()=>{const s=`[#${a}] 触发事件「${e}」 @${c.toFixed?c.toFixed(3):c}`,o=[];n.length>0&&o.push({eventArgs:n});try{if('undefined'!=typeof TavernHelper&&'function'==typeof TavernHelper.getChatMessages){const e='function'==typeof TavernHelper.getLastMessageId?TavernHelper.getLastMessageId():void 0,t='number'==typeof e&&Number.isFinite(e)&&e>=0?`0-${e}`:'0-{{lastMessageId}}',s=TavernHelper.getChatMessages(t,{include_swipes:!0});o.push({tavernMessages:s})}else r||(r=!0,t.warn('handler','TavernHelper API 不可用，无法获取聊天消息列表。'))}catch(e){t.error('handler',`获取聊天消息列表时发生错误: ${e?.message||e}`,e)}t.log('handler',s,...o)})};try{eventMakeFirst(e,n)}catch{eventOn(e,n)}},c=Object.values('undefined'!=typeof iframe_events&&iframe_events||{}),l=Object.values('undefined'!=typeof tavern_events&&tavern_events||{});c.forEach(a),l.forEach(a),o(async()=>{t.log('main',`【事件监听就绪】iframe=${c.length}，tavern=${l.length}（统一串行输出，保障顺序）`)})})();
//# sourceMappingURL=index.js.map